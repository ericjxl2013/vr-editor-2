!function i(o,s,l){function c(t,e){if(!s[t]){if(!o[t]){var n="function"==typeof require&&require;if(!e&&n)return n(t,!0);if(u)return u(t,!0);var r=new Error("Cannot find module '"+t+"'");throw r.code="MODULE_NOT_FOUND",r}var a=s[t]={exports:{}};o[t][0].call(a.exports,function(e){return c(o[t][1][e]||e)},a,a.exports,i,o,s,l)}return s[t].exports}for(var u="function"==typeof require&&require,e=0;e<l.length;e++)c(l[e]);return c}({1:[function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,o,s,l){return new(s=s||Promise)(function(n,t){function r(e){try{i(l.next(e))}catch(e){t(e)}}function a(e){try{i(l.throw(e))}catch(e){t(e)}}function i(e){var t;e.done?n(e.value):((t=e.value)instanceof s?t:new s(function(e){e(t)})).then(r,a)}i((l=l.apply(e,o||[])).next())})},V=this&&this.__generator||function(n,r){var a,i,o,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},e={next:t(0),throw:t(1),return:t(2)};return"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(t){return function(e){return function(t){if(a)throw new TypeError("Generator is already executing.");for(;s;)try{if(a=1,i&&(o=2&t[0]?i.return:t[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,t[1])).done)return o;switch(i=0,o&&(t=[2&t[0],o.value]),t[0]){case 0:case 1:o=t;break;case 4:return s.label++,{value:t[1],done:!1};case 5:s.label++,i=t[1],t=[0];continue;case 7:t=s.ops.pop(),s.trys.pop();continue;default:if(!(o=0<(o=s.trys).length&&o[o.length-1])&&(6===t[0]||2===t[0])){s=0;continue}if(3===t[0]&&(!o||t[1]>o[0]&&t[1]<o[3])){s.label=t[1];break}if(6===t[0]&&s.label<o[1]){s.label=o[1],o=t;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(t);break}o[2]&&s.ops.pop(),s.trys.pop();continue}t=r.call(n,s)}catch(e){t=[6,e],i=0}finally{a=o=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}([t,e])}}};Object.defineProperty(n,"__esModule",{value:!0}),n.BabylonLoader=void 0;var I=e("../lib"),R=e("./config"),a=(S.loadFromBabylonAsset=function(){},S.loadBabylon=function(e){var n=e.get("id"),r=null;S.babylonCacheData[n]?(r=S.babylonCacheData[n],S.parseBabylon(n,r),S.assembleBabylon(n,r)):ossfile.getJsonAsset(R.Config.projectID,e.get("id"),e.get("name"),e.get("file.hash")).then(function(e){var t=JSON.parse(e);r=t,S.babylonCacheData[n]=r,S.parseBabylon(n,r),S.assembleBabylon(n,r)})},S.parseBabylon=function(e,t){var n;t&&(n={},t.materials&&(n.materials={},t.materials.forEach(function(e){n.materials[e.id]=e})),t.geometries&&t.geometries.vertexData&&(n.geometries={},t.geometries.vertexData.forEach(function(e){n.geometries[e.id]=e})),t.meshes&&(n.meshes={},t.meshes.forEach(function(e){n.meshes[e.id]=e})),t.transformNodes&&(n.transformNodes={},t.transformNodes.forEach(function(e){n.transformNodes[e.id]=e})),S.babylonParsedData[e]=n)},S.hasBabylobData=function(e){return e in S.babylonCacheData},S.getBabylonData=function(e){return e in S.babylonCacheData?S.babylonCacheData[e]:null},S.hasParsedBabylonData=function(e){return e in S.babylonParsedData},S.getParsedBabylonData=function(e){return e in S.babylonParsedData?S.babylonParsedData[e]:null},S.meshParseRecursion=function(e,t,n,r,a){if(e){var i="";i=null!==e.parent?e.parent.id:editor.call("entities:root").get("resource_id");for(var o=e.getChildren(),s=[],l=0;l<o.length;l++)s.push(o[l].id);var c=I.Tools.radianToEulerAngle(e.rotation),u={name:e.name,resource_id:e.id,babylon_id:n[e.id],asset_id:t,parent:i,position:[e.position.x,e.position.y,e.position.z],rotation:[c.x,c.y,c.z],scale:[e.scaling.x,e.scaling.y,e.scaling.z],children:s,enabled:e.isEnabled(),checkCollisions:e.checkCollisions,pickable:e.isPickable,isVisible:e.isVisible,tags:[],type:"mesh"},h=editor.call("entities:new",u);r.push(h),a.push(h.origin);for(l=0;l<o.length;l++)S.meshParseRecursion(o[l],t,n,r,a)}},S.addSceneData=function(e,t){S.scenesData.entities[e]=t,S.scenesData.modified=S.createdAtTime()},S.updateSceneData=function(e,t){S.scenesData.entities[e]=t,S.scenesData.modified=S.createdAtTime()},S.createdAtTime=function(){var e=new Date;return e.getFullYear()+"-"+S.getRealTime(e.getMonth()+1)+"-"+S.getRealTime(e.getDate())+" "+S.getRealTime(e.getHours())+":"+S.getRealTime(e.getMinutes())},S.getRealTime=function(e){return e<10?"0"+e:e.toString()},S.createCameraWraper=function(e,t,n){var r=new BABYLON.UniversalCamera(e,new BABYLON.Vector3(0,100,-200),t);r.maxZ=2e4,r.attachControl(n,!0);var a=new I.VeryCamera(r,t,n);return a.orthoSize=.5,a},S.createLightWraper=function(e,t,n){var r=S.createLight(e,t,n);return new I.VeryLight(r,n)},S.createLight=function(e,t,n){return"point"===(e=e.toLowerCase())?new BABYLON.PointLight(t,BABYLON.Vector3.Zero(),n):"spot"===e?new BABYLON.SpotLight(t,BABYLON.Vector3.Zero(),new BABYLON.Vector3(0,-1,0),.75*Math.PI,8,n):"hemispheric"===e?new BABYLON.HemisphericLight(t,BABYLON.Vector3.Up(),n):new BABYLON.DirectionalLight(t,BABYLON.Vector3.Forward(),n)},S.loadLight=function(e,t){return null==e?null:BABYLON.Light.Parse(e,t)},S.loadReflectionProbe=function(e,t,n){return null==e?null:BABYLON.ReflectionProbe.Parse(e,t,n)},S.loadAnimation=function(e){if(null==e)return null;var t=BABYLON._TypeStore.GetClass("BABYLON.Animation");return t?t.Parse(e):null},S.loadMaterial=function(e,t,n){return null==e?null:BABYLON.Material.Parse(e,t,n)},S.loadMultiMaterial=function(e,t){return null==e?null:BABYLON.MultiMaterial.ParseMultiMaterial(e,t)},S.loadMorphTargetManager=function(e,t){return null==e?null:BABYLON.MorphTargetManager.Parse(e,t)},S.loadSkeleton=function(e,t){return null==e?null:BABYLON.Skeleton.Parse(e,t)},S.loadGeometry=function(e,t,n){return null==e?null:BABYLON.Geometry.Parse(e,t,n)},S.loadTransformNode=function(e,t,n){return null==e?null:BABYLON.TransformNode.Parse(e,t,n)},S.loadMesh=function(e,t,n){return null==e?null:BABYLON.Mesh.Parse(e,t,n)},S.loadCamera=function(e,t){return null==e?null:BABYLON.Camera.Parse(e,t)},S.loadAnimationGroup=function(e,t){return null==e?null:BABYLON.AnimationGroup.Parse(e,t)},S.setBabylonParent=function(e){for(var t,n=0,r=0,a=e.cameras.length;r<a;r++){var i=e.cameras[r];i._waitingParentId&&(i.parent=e.getLastEntryByID(i._waitingParentId),i._waitingParentId=null)}for(t=0,n=e.lights.length;t<n;t++){var o=e.lights[t];o&&o._waitingParentId&&(o.parent=e.getLastEntryByID(o._waitingParentId),o._waitingParentId=null)}for(t=0,n=e.transformNodes.length;t<n;t++){var s=e.transformNodes[t];s._waitingParentId&&(s.parent=e.getLastEntryByID(s._waitingParentId),s._waitingParentId=null)}for(t=0,n=e.meshes.length;t<n;t++){var l=e.meshes[t];l._waitingParentId&&(l.parent=e.getLastEntryByID(l._waitingParentId),l._waitingParentId=null)}},S.prefix="/assets/",S.assetsData={},S.projectData={},S.scenesData={},S.sceneIndex=0,S.babylonCacheData={},S.babylonParsedData={},S.assembleBabylon=function(N,j){return r(void 0,void 0,void 0,function(){var t,n,r,a,i,o,s,l,c,u,h,d,f,p,g,y,b,m,_,v,B,x,O,A,L,T,w,D,C,P,E;return V(this,function(e){switch(e.label){case 0:if(null===j)return[3,22];if(console.warn(j),console.log(j.meshes),console.log(j.materials),console.log(j.lights),!S.assetsData.babylon[N])return[3,21];for(r in t=S.assetsData.babylon[N].materials,n=[],t)n.push(r);a=0,e.label=1;case 1:return a<n.length?(i=n[a],t[i].asset_id&&S.assetsData.assets[t[i].asset_id]?(o=S.assetsData.assets[t[i].asset_id].data,s="",o.diffuseTexture&&o.diffuseTexture.texture_id?(l=o.diffuseTexture.texture_id,[4,ossfile.getUrl(R.Config.projectID,l,S.assetsData.assets[l].name,S.assetsData.assets[l].file.hash)]):[3,3]):[3,20]):[3,21];case 2:s=e.sent(),o.diffuseTexture.name=s,e.label=3;case 3:return o.specularTexture&&o.specularTexture.texture_id?(c=o.specularTexture.texture_id,[4,ossfile.getUrl(R.Config.projectID,c,S.assetsData.assets[c].name,S.assetsData.assets[c].file.hash)]):[3,5];case 4:s=e.sent(),o.specularTexture.name=s,e.label=5;case 5:return o.reflectionTexture&&o.reflectionTexture.texture_id?(u=o.reflectionTexture.texture_id,[4,ossfile.getUrl(R.Config.projectID,u,S.assetsData.assets[u].name,S.assetsData.assets[u].file.hash)]):[3,7];case 6:s=e.sent(),o.reflectionTexture.name=s,e.label=7;case 7:return o.refractionTexture&&o.refractionTexture.texture_id?(h=o.refractionTexture.texture_id,[4,ossfile.getUrl(R.Config.projectID,h,S.assetsData.assets[h].name,S.assetsData.assets[h].file.hash)]):[3,9];case 8:s=e.sent(),o.refractionTexture.name=s,e.label=9;case 9:return o.emissiveTexture&&o.emissiveTexture.texture_id?(d=o.emissiveTexture.texture_id,[4,ossfile.getUrl(R.Config.projectID,d,S.assetsData.assets[d].name,S.assetsData.assets[d].file.hash)]):[3,11];case 10:s=e.sent(),o.emissiveTexture.name=s,e.label=11;case 11:return o.bumpTexture&&o.bumpTexture.texture_id?(f=o.bumpTexture.texture_id,[4,ossfile.getUrl(R.Config.projectID,f,S.assetsData.assets[f].name,S.assetsData.assets[f].file.hash)]):[3,13];case 12:s=e.sent(),o.bumpTexture.name=s,e.label=13;case 13:return o.opacityTexture&&o.opacityTexture.texture_id?(p=o.opacityTexture.texture_id,[4,ossfile.getUrl(R.Config.projectID,p,S.assetsData.assets[p].name,S.assetsData.assets[p].file.hash)]):[3,15];case 14:s=e.sent(),o.opacityTexture.name=s,e.label=15;case 15:return o.ambientTexture&&o.ambientTexture.texture_id?(g=o.ambientTexture.texture_id,[4,ossfile.getUrl(R.Config.projectID,g,S.assetsData.assets[g].name,S.assetsData.assets[g].file.hash)]):[3,17];case 16:s=e.sent(),o.ambientTexture.name=s,e.label=17;case 17:return o.lightmapTexture&&o.lightmapTexture.texture_id?(y=o.lightmapTexture.texture_id,[4,ossfile.getUrl(R.Config.projectID,y,S.assetsData.assets[y].name,S.assetsData.assets[y].file.hash)]):[3,19];case 18:s=e.sent(),o.lightmapTexture.name=s,e.label=19;case 19:S.loadMaterial(o,VR.BabylonEngine.Scene,""),e.label=20;case 20:return a++,[3,1];case 21:for(j.geometries&&j.geometries.vertexData&&j.geometries.vertexData.array.forEach(function(e){S.loadGeometry(e,VR.BabylonEngine.Scene,"")}),b=[],j.transformNodes&&j.transformNodes.forEach(function(e){var t=S.loadTransformNode(e,VR.BabylonEngine.Scene,"");b.push(t)}),m=[],_=[],v={},B={},j.meshes&&(j.meshes.forEach(function(e){var t,n;S.scenesData.entities[e.id]?(t=I.GUID.create(),n=e.id,B[t]=n,e.id=t,j.meshes.forEach(function(e){e.parentId===n&&(e.parentId=t,console.log("change parent id"))})):B[e.id]=e.id}),j.meshes.forEach(function(e){var t=S.loadMesh(e,VR.BabylonEngine.Scene,"");m.push(t),v[e.id]=t})),O=x=null,"entity"===editor.call("selector:type")&&(x=editor.call("selector:items")[0]),x?x.node&&(O=x.node):x=editor.call("entities:root"),A=[],L=[],T=0,w=b.length;T<w;T++)(D=b[T])&&D._waitingParentId&&(D.parent=VR.BabylonEngine.Scene.getLastEntryByID(D._waitingParentId),D._waitingParentId=null);for(P=0,C=m.length;P<C;P++)null!==m[P]&&(m[P]._waitingParentId&&v[m[P]._waitingParentId]?m[P].parent=v[m[P]._waitingParentId]:(m[P].parent=O,_.push(m[P])),m[P]._waitingParentId=null);for(P=0;P<_.length;P++)S.meshParseRecursion(_[P],N,B,A,L);editor.call("selector:history",!1),editor.call("selector:set","entity",[editor.call("entities:get",null===(E=_[0])||void 0===E?void 0:E.id)]),editor.once("selector:change",function(){editor.call("selector:history",!0)}),editor.call("make:scene:dirty"),e.label=22;case 22:return[2]}})})},S);function S(){}n.BabylonLoader=a},{"../lib":12,"./config":2}],2:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.Config=void 0;var r=(a.addCamera=function(e){a.cameras.push(e)},a.prefix="/assets/",a.projectID="",a.projectName="",a.projectData={},a.userID="",a.username="",a.assetsData={},a.scenesData={},a.sceneIndex=0,a.sceneName="",a.tableAssetsID="",a.tableName="",a.tableData=null,a.cameras=[],a);function a(){}n.Config=r},{}],3:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.Game=void 0;var r=e("./config"),a=e("./loader"),i=(o.prototype.createScene=function(e){var t=this;this._engine&&(VR.VE_Manager.dispose(),this._engine.dispose()),this._engine=new BABYLON.Engine(this._canvas,!0),VR.BabylonEngine.Engine=this._engine;var n=this._engine;return window.addEventListener("resize",function(){n.resize()}),this._scene=new BABYLON.Scene(this._engine),VR.BabylonEngine.Scene=this._scene,VR.Time.start(),this._scene.clearColor=new BABYLON.Color4(116/255,116/255,116/255,1),n.displayLoadingUI(),editor.call("scene:raw",r.Config.scenesData,this.startVeryEngine.bind(this),e),n.hideLoadingUI(),this._scene.onKeyboardObservable.add(function(e){e.type===BABYLON.KeyboardEventTypes.KEYDOWN&&81===e.event.keyCode&&e.event.ctrlKey&&e.event.altKey&&(console.log("Ctrl + Alt + Q"),t.toggleDebug())}),this._engine.runRenderLoop(function(){t._scene&&t._scene.activeCamera&&t._scene.render()}),this},o.prototype.startVeryEngine=function(e){var t=new VR.VeryEngine;try{t.init(e,"测试项目")}catch(e){console.error(e)}var n=VR.VE_Manager.objects("测试项目");this._scene.onBeforeRenderObservable.add(function(){for(var e=0;e<n.count;e++){var t=n.getObjectID(e);n.getVeryObject(t).update()}}),this._scene.onKeyboardObservable.add(function(e){e.type===BABYLON.KeyboardEventTypes.KEYDOWN&&console.log(e.event.key)})},o.prototype.animate=function(){var n=this;return this._engine.runRenderLoop(function(){if(n._canvas.width!==n._canvas.clientWidth&&n._engine.resize(),n._scene){for(var e=0,t=r.Config.cameras.length;e<t;e++)r.Config.cameras[e].resize(!1);n._scene.render()}n._showFps&&n.updateFpsPos()}),this},o.prototype.toggleDebug=function(){var e;return this._engine&&((e=this._engine.scenes[0]).debugLayer.isVisible()?e.debugLayer.hide():e.debugLayer.show({embedMode:!0})),this},o.prototype.updateFpsPos=function(){this._fps&&(this._fps.innerHTML=this._engine.getFps().toFixed()+" fps")},o);function o(e,t){this._showFps=!0,new a.Loader,this._canvas=e,VR.BabylonEngine.Canvas=this._canvas,this._fps=t,this._table=document.getElementById("VeryTable")}n.Game=i},{"./config":2,"./loader":5}],4:[function(e,t,n){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),a=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||t.hasOwnProperty(n)||r(t,e,n)};Object.defineProperty(n,"__esModule",{value:!0}),a(e("./game"),n),a(e("./scenes"),n),a(e("./config"),n),a(e("./loader"),n),a(e("./babylonloader"),n)},{"./babylonloader":1,"./config":2,"./game":3,"./loader":5,"./scenes":6}],5:[function(e,t,n){"use strict";var p=this&&this.__awaiter||function(e,o,s,l){return new(s=s||Promise)(function(n,t){function r(e){try{i(l.next(e))}catch(e){t(e)}}function a(e){try{i(l.throw(e))}catch(e){t(e)}}function i(e){var t;e.done?n(e.value):((t=e.value)instanceof s?t:new s(function(e){e(t)})).then(r,a)}i((l=l.apply(e,o||[])).next())})},A=this&&this.__generator||function(n,r){var a,i,o,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},e={next:t(0),throw:t(1),return:t(2)};return"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(t){return function(e){return function(t){if(a)throw new TypeError("Generator is already executing.");for(;s;)try{if(a=1,i&&(o=2&t[0]?i.return:t[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,t[1])).done)return o;switch(i=0,o&&(t=[2&t[0],o.value]),t[0]){case 0:case 1:o=t;break;case 4:return s.label++,{value:t[1],done:!1};case 5:s.label++,i=t[1],t=[0];continue;case 7:t=s.ops.pop(),s.trys.pop();continue;default:if(!(o=0<(o=s.trys).length&&o[o.length-1])&&(6===t[0]||2===t[0])){s=0;continue}if(3===t[0]&&(!o||t[1]>o[0]&&t[1]<o[3])){s.label=t[1];break}if(6===t[0]&&s.label<o[1]){s.label=o[1],o=t;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(t);break}o[2]&&s.ops.pop(),s.trys.pop();continue}t=r.call(n,s)}catch(e){t=[6,e],i=0}finally{a=o=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}([t,e])}}};Object.defineProperty(n,"__esModule",{value:!0}),n.Loader=void 0;function r(){var e=this;editor.method("initAssets",function(e){e.assets&&t(e.assets)});var t=function(e){editor.call("assets:progress",.5);var t,n,r=0,a=Object.getOwnPropertyNames(e).length;for(t in e)n=e[t],editor.call("loadAsset",n,function(){r++,editor.call("assets:progress",r/a*.5+.5),a<=r&&(editor.call("assets:progress",1),editor.emit("assets:load"))})};editor.method("scene:raw",function(e,t,n){for(var r in e.entities){var a=new L.Observer(e.entities[r]);"root"!==a.get("type")&&editor.call("create:scene:element",a)}l=u.length;for(var i=c=0;i<u.length;i++)editor.call("scene:mesh:create",u[i],t,n);editor.emit("entities:load")});var i={},x={};editor.method("create:scene:element",function(e){var t,n,r,a,i;"light"===e.get("type")?((t=T.BabylonLoader.createLightWraper(e.get("subtype"),e.get("name"),VR.BabylonEngine.Scene)).light.intensity=e.has("intensity")?e.get("intensity"):1,e.has("diffuse")&&3===e.get("diffuse").length&&(t.light.diffuse=BABYLON.Color3.FromArray(e.get("diffuse"))),e.has("specular")&&3===e.get("specular").length&&(t.light.specular=BABYLON.Color3.FromArray(e.get("specular"))),t.light instanceof BABYLON.SpotLight&&(e.has("angle")&&(t.light.angle=e.get("angle")),e.has("exponent")&&(t.light.exponent=e.get("exponent"))),t.id=e.get("resource_id"),x[e.get("resource_id")]=t,e.node=t,e.has("enabled")&&t.setEnabled(e.get("enabled")),e.has("position")&&3===e.get("position").length&&(t.position=BABYLON.Vector3.FromArray(e.get("position"))),e.has("rotation")&&3===e.get("rotation").length&&(t.rotation=L.Tools.eulerAngleToRadian(BABYLON.Vector3.FromArray(e.get("rotation"))),t.type===BABYLON.Light.LIGHTTYPEID_HEMISPHERICLIGHT&&t.light.direction.copyFrom(t.up)),e.has("scale")&&3===e.get("scale").length&&(t.scaling=BABYLON.Vector3.FromArray(e.get("scale"))),O(e,t)):"camera"===e.get("type")?(n=T.BabylonLoader.createCameraWraper(e.get("name"),VR.BabylonEngine.Scene,VR.BabylonEngine.Canvas),VR.BabylonEngine.Scene.activeCameras.push(n.camera),n.id=e.get("resource_id"),x[e.get("resource_id")]=n,e.node=n,e.has("enabled")&&n.setEnabled(e.get("enabled")),e.has("position")&&3===e.get("position").length&&(n.position=BABYLON.Vector3.FromArray(e.get("position"))),e.has("rotation")&&3===e.get("rotation").length&&(n.rotation=L.Tools.eulerAngleToRadian(BABYLON.Vector3.FromArray(e.get("rotation")))),e.has("scale")&&3===e.get("scale").length&&(n.scaling=BABYLON.Vector3.FromArray(e.get("scale"))),e.has("checkCollisions")&&n.camera instanceof BABYLON.FreeCamera&&(n.camera.checkCollisions=e.get("checkCollisions")),e.has("applyGravity")&&n.camera instanceof BABYLON.FreeCamera&&(n.camera.applyGravity=e.get("applyGravity")),e.has("viewport")&&(r=e.get("viewport"))&&r.length&&4===r.length&&(n.camera.viewport=new BABYLON.Viewport(r[0],r[1],r[2],r[3])),e.has("clearColor")?(r=e.get("clearColor"))&&r.length&&4===r.length&&(n.clearColor=new BABYLON.Color4(r[0],r[1],r[2],r[3])):n.clearColor=new BABYLON.Color4(45/255,145/255,186/255,1),e.has("mode")&&(n.mode=e.get("mode")),e.has("fov")&&(n.fov=e.get("fov")),e.has("inertia")&&(n.inertia=e.get("inertia")),e.has("orthoSize")&&(n.orthoSize=e.get("orthoSize")),n.resize(!1),w.Config.addCamera(n),O(e,n)):"empty"===e.get("type")?(a=new BABYLON.TransformNode(e.get("name"),VR.BabylonEngine.Scene),(e.node=a).id=e.get("resource_id"),a.position=BABYLON.Vector3.FromArray(e.get("position")),a.rotation=L.Tools.eulerAngleToRadian(BABYLON.Vector3.FromArray(e.get("rotation"))),a.scaling=BABYLON.Vector3.FromArray(e.get("scale")),a.isEnabled(e.get("enabled")),O(e,a)):"primitive"===e.get("type")?e.get("subtype")&&"box"===e.get("subtype")?(i=BABYLON.MeshBuilder.CreateBox(e.get("name"),{size:100},VR.BabylonEngine.Scene),e.node=i,(x[e.get("resource_id")]=i).id=e.get("resource_id"),e.has("enabled")&&i.setEnabled(e.get("enabled")),e.has("position")&&3===e.get("position").length&&(i.position=BABYLON.Vector3.FromArray(e.get("position"))),e.has("rotation")&&3===e.get("rotation").length&&(i.rotation=L.Tools.eulerAngleToRadian(BABYLON.Vector3.FromArray(e.get("rotation")))),e.has("scale")&&3===e.get("scale").length&&(i.scaling=BABYLON.Vector3.FromArray(e.get("scale"))),e.has("checkCollisions")&&(i.checkCollisions=e.get("checkCollisions")),e.has("pickable")&&(i.isPickable=e.get("pickable")),e.has("isVisible")&&(i.isVisible=e.get("isVisible")),e.get("material_id"),O(e,i)):e.get("subtype")&&"sphere"===e.get("subtype")?(i=BABYLON.MeshBuilder.CreateSphere(e.get("name"),{segments:20,diameter:100},VR.BabylonEngine.Scene),e.node=i,(x[e.get("resource_id")]=i).id=e.get("resource_id"),e.has("enabled")&&i.setEnabled(e.get("enabled")),e.has("position")&&3===e.get("position").length&&(i.position=BABYLON.Vector3.FromArray(e.get("position"))),e.has("rotation")&&3===e.get("rotation").length&&(i.rotation=L.Tools.eulerAngleToRadian(BABYLON.Vector3.FromArray(e.get("rotation")))),e.has("scale")&&3===e.get("scale").length&&(i.scaling=BABYLON.Vector3.FromArray(e.get("scale"))),e.has("checkCollisions")&&(i.checkCollisions=e.get("checkCollisions")),e.has("pickable")&&(i.isPickable=e.get("pickable")),e.has("isVisible")&&(i.isVisible=e.get("isVisible")),e.get("material_id"),O(e,i)):e.get("subtype")&&"plane"===e.get("subtype")?(i=BABYLON.MeshBuilder.CreateGround(e.get("name"),{width:5e3,height:5e3,subdivisions:10},VR.BabylonEngine.Scene),e.node=i,(x[e.get("resource_id")]=i).id=e.get("resource_id"),e.has("enabled")&&i.setEnabled(e.get("enabled")),e.has("position")&&3===e.get("position").length&&(i.position=BABYLON.Vector3.FromArray(e.get("position"))),e.has("rotation")&&3===e.get("rotation").length&&(i.rotation=L.Tools.eulerAngleToRadian(BABYLON.Vector3.FromArray(e.get("rotation")))),e.has("scale")&&3===e.get("scale").length&&(i.scaling=BABYLON.Vector3.FromArray(e.get("scale"))),e.has("checkCollisions")&&(i.checkCollisions=e.get("checkCollisions")),e.has("pickable")&&(i.isPickable=e.get("pickable")),e.has("isVisible")&&(i.isVisible=e.get("isVisible")),e.get("material_id"),O(e,i)):e.get("subtype")&&"cylinder"===e.get("subtype")&&(i=BABYLON.MeshBuilder.CreateCylinder(e.get("name"),{height:200,diameter:100},VR.BabylonEngine.Scene),e.node=i,(x[e.get("resource_id")]=i).id=e.get("resource_id"),e.has("enabled")&&i.setEnabled(e.get("enabled")),e.has("position")&&3===e.get("position").length&&(i.position=BABYLON.Vector3.FromArray(e.get("position"))),e.has("rotation")&&3===e.get("rotation").length&&(i.rotation=L.Tools.eulerAngleToRadian(BABYLON.Vector3.FromArray(e.get("rotation")))),e.has("scale")&&3===e.get("scale").length&&(i.scaling=BABYLON.Vector3.FromArray(e.get("scale"))),e.has("checkCollisions")&&(i.checkCollisions=e.get("checkCollisions")),e.has("pickable")&&(i.isPickable=e.get("pickable")),e.has("isVisible")&&(i.isVisible=e.get("isVisible")),e.get("material_id"),O(e,i)):"mesh"===e.get("type")&&u.push(e)});var O=function(e,t){for(var n,r=e.get("children"),a=0;a<r.length;a++)i[r[a]]={index:a,parent:t},x[r[a]]&&o(t,x[r[a]],a);!e.get("parent")||(n=i[e.get("resource_id")])&&n.parent&&o(n.parent,t,n.index)},o=function(e,t,n){null!==t&&(t.parent=e)};editor.method("scene:mesh:create",function(e,t,n){r(e,t,n)});var l=0,c=0,u=[],h={},d={},r=function(i,o,s){return p(e,void 0,void 0,function(){var t,n,r,a=this;return A(this,function(e){return t=i.get("asset_id"),n=null,T.BabylonLoader.hasBabylobData(t)?(n=T.BabylonLoader.getParsedBabylonData(t),f(i,n),++c==l&&(l=c=0,u=[],o(s))):t in h?d[t].push(i):(h[t]=!0,d[t]=[i],r=T.BabylonLoader.assetsData.assets[t].name,ossfile.getJsonAsset(w.Config.projectID,t,r,T.BabylonLoader.assetsData.assets[t].file.hash).then(function(e){n=JSON.parse(e),T.BabylonLoader.babylonCacheData[t]=n,T.BabylonLoader.parseBabylon(t,n),T.BabylonLoader.parseBabylon(t,n),n=T.BabylonLoader.getParsedBabylonData(t),d[t].forEach(function(t){return p(a,void 0,void 0,function(){return A(this,function(e){switch(e.label){case 0:return[4,f(t,n)];case 1:return e.sent(),++c==l&&(l=c=0,u=[],o(s)),[2]}})})})})),[2]})})},f=function(v,B){return p(e,void 0,void 0,function(){var t,n,r,a,i,o,s,l,c,u,h,d,f,p,g,y,b,m,_;return A(this,function(e){switch(e.label){case 0:return B?(t=v.get("asset_id"),n=v.get("babylon_id"),B.meshes[n]?((r=B.meshes[n]).position=v.has("position")&&v.get("position")?v.get("position"):r.position,a=(a=v.get("rotation"))&&0<a.length?L.Tools.vector3ToArray(L.Tools.eulerAngleToRadian(BABYLON.Vector3.FromArray(a))):r.rotation,r.rotation=a,r.scale=v.has("scale")&&v.get("scale")?v.get("scale"):r.scal,r.name=v.has("name")&&v.get("name")?v.get("name"):r.name,r.id=v.has("resource_id")&&v.get("resource_id")?v.get("resource_id"):r.id,r.isEnabled=v.has("enabled")?v.get("enabled"):r.isEnabled,r.isVisible=v.has("isVisible")?v.get("isVisible"):r.isVisible,r.pickable=v.has("pickable")?v.get("pickable"):r.pickable,r.checkCollisions=v.has("checkCollisions")?v.get("checkCollisions"):r.checkCollisions,r.materialId=v.has("material_id")?v.get("material_id"):r.materialId,r.parentId=v.has("parent")?v.get("parent"):r.parentId,r.geometryId&&null===VR.BabylonEngine.Scene.getGeometryByID(r.geometryId)&&B.geometries&&B.geometries[r.geometryId]&&(i=B.geometries[r.geometryId],T.BabylonLoader.loadGeometry(i,VR.BabylonEngine.Scene,"")),!r.materialId||null!==VR.BabylonEngine.Scene.getMaterialByID(r.materialId)?[3,22]:T.BabylonLoader.assetsData.babylon[t]?(o=T.BabylonLoader.assetsData.babylon[t].materials)&&o[r.materialId]?(s=o[r.materialId].asset_id,T.BabylonLoader.assetsData.assets[s]?(l=T.BabylonLoader.assetsData.assets[s].data,c="",l.diffuseTexture&&l.diffuseTexture.texture_id?(u=l.diffuseTexture.texture_id,[4,ossfile.getUrl(w.Config.projectID,u,T.BabylonLoader.assetsData.assets[u].name,T.BabylonLoader.assetsData.assets[u].file.hash)]):[3,2]):[3,19]):[3,20]:[3,21]):[3,23]):[3,24];case 1:c=e.sent(),l.diffuseTexture.name=c,e.label=2;case 2:return l.specularTexture&&l.specularTexture.texture_id?(h=l.specularTexture.texture_id,[4,ossfile.getUrl(w.Config.projectID,h,T.BabylonLoader.assetsData.assets[h].name,T.BabylonLoader.assetsData.assets[h].file.hash)]):[3,4];case 3:c=e.sent(),l.specularTexture.name=c,e.label=4;case 4:return l.reflectionTexture&&l.reflectionTexture.texture_id?(d=l.reflectionTexture.texture_id,[4,ossfile.getUrl(w.Config.projectID,d,T.BabylonLoader.assetsData.assets[d].name,T.BabylonLoader.assetsData.assets[d].file.hash)]):[3,6];case 5:c=e.sent(),l.reflectionTexture.name=c,e.label=6;case 6:return l.refractionTexture&&l.refractionTexture.texture_id?(f=l.refractionTexture.texture_id,[4,ossfile.getUrl(w.Config.projectID,f,T.BabylonLoader.assetsData.assets[f].name,T.BabylonLoader.assetsData.assets[f].file.hash)]):[3,8];case 7:c=e.sent(),l.refractionTexture.name=c,e.label=8;case 8:return l.emissiveTexture&&l.emissiveTexture.texture_id?(p=l.emissiveTexture.texture_id,[4,ossfile.getUrl(w.Config.projectID,p,T.BabylonLoader.assetsData.assets[p].name,T.BabylonLoader.assetsData.assets[p].file.hash)]):[3,10];case 9:c=e.sent(),l.emissiveTexture.name=c,e.label=10;case 10:return l.bumpTexture&&l.bumpTexture.texture_id?(g=l.bumpTexture.texture_id,[4,ossfile.getUrl(w.Config.projectID,g,T.BabylonLoader.assetsData.assets[g].name,T.BabylonLoader.assetsData.assets[g].file.hash)]):[3,12];case 11:c=e.sent(),l.bumpTexture.name=c,e.label=12;case 12:return l.opacityTexture&&l.opacityTexture.texture_id?(y=l.opacityTexture.texture_id,[4,ossfile.getUrl(w.Config.projectID,y,T.BabylonLoader.assetsData.assets[y].name,T.BabylonLoader.assetsData.assets[y].file.hash)]):[3,14];case 13:c=e.sent(),l.opacityTexture.name=c,e.label=14;case 14:return l.ambientTexture&&l.ambientTexture.texture_id?(b=l.ambientTexture.texture_id,[4,ossfile.getUrl(w.Config.projectID,b,T.BabylonLoader.assetsData.assets[b].name,T.BabylonLoader.assetsData.assets[b].file.hash)]):[3,16];case 15:c=e.sent(),l.ambientTexture.name=c,e.label=16;case 16:return l.lightmapTexture&&l.lightmapTexture.texture_id?(m=l.lightmapTexture.texture_id,[4,ossfile.getUrl(w.Config.projectID,m,T.BabylonLoader.assetsData.assets[m].name,T.BabylonLoader.assetsData.assets[m].file.hash)]):[3,18];case 17:c=e.sent(),l.lightmapTexture.name=c,e.label=18;case 18:return T.BabylonLoader.loadMaterial(l,VR.BabylonEngine.Scene,""),[3,20];case 19:console.warn("scene mesh warn"),e.label=20;case 20:return[3,22];case 21:console.warn("scene mesh warn"),e.label=22;case 22:return _=T.BabylonLoader.loadMesh(r,VR.BabylonEngine.Scene,""),v.node=_,x[v.get("resource_id")]=_,O(v,_),[3,24];case 23:console.warn("scene mesh warn"),e.label=24;case 24:return[2]}})})}}var L=e("../lib"),T=e("./babylonloader"),w=e("./config");n.Loader=r},{"../lib":12,"./babylonloader":1,"./config":2}],6:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.Scenes=void 0;function r(){}n.Scenes=r},{}],7:[function(e,t,n){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),a=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||t.hasOwnProperty(n)||r(t,e,n)};Object.defineProperty(n,"__esModule",{value:!0}),a(e("./lib"),n),a(e("./game"),n)},{"./game":4,"./lib":12}],8:[function(e,t,n){"use strict";var r,a=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0}),n.AjaxRequest=n.Ajax=void 0;var i=e("../lib"),l=(o.get=function(e){return new s({url:e})},o.post=function(e,t){return new s({method:"POST",url:e,data:t})},o.put=function(e,t){return new s({method:"PUT",url:e,data:t})},o.delete=function(e){return new s({method:"DELETE",url:e})},o.param=function(e,t){o.params[e]=t},o.params={},o);function o(e){return"string"==typeof e&&(e={url:e}),new s(e)}n.Ajax=l;var c,s=(c=i.Events,a(u,c),u.prototype._onLoad=function(){if(this._progress=1,this.emit("progress",1),200===this._xhr.status||201===this._xhr.status)if(this.notJson)this.emit("load",this._xhr.status,this._xhr.responseText);else{try{var e=JSON.parse(this._xhr.responseText)}catch(e){return void this.emit("error",this._xhr.status||0,new Error("invalid json"))}this.emit("load",this._xhr.status,e)}else try{var t=(e=JSON.parse(this._xhr.responseText)).message;t=(t=t||(e.error||e.response&&e.response.error))||this._xhr.responseText,this.emit("error",this._xhr.status,t)}catch(e){this.emit("error",this._xhr.status)}},u.prototype._onError=function(e){this.emit("error",0,e)},u.prototype._onAbort=function(e){this.emit("error",0,e)},u.prototype._onProgress=function(e){var t;!e.lengthComputable||(t=e.loaded/e.total)!==this._progress&&(this._progress=t,this.emit("progress",this._progress))},u.prototype.abort=function(){this._xhr.abort()},u);function u(e){var t=c.call(this)||this;if(t._progress=0,!e)throw new Error("ajax请求无参数，请检查！");t._progress=0,t.emit("progress",t._progress),t._xhr=new XMLHttpRequest,e.cookies&&(t._xhr.withCredentials=!0),t._xhr.addEventListener("load",t._onLoad.bind(t),!1),t._xhr.upload.addEventListener("progress",t._onProgress.bind(t),!1),t._xhr.addEventListener("error",t._onError.bind(t),!1),t._xhr.addEventListener("abort",t._onAbort.bind(t),!1);var n=e.url;if(e.query&&Object.keys(e.query).length){-1===n.indexOf("?")&&(n+="?");var r=[];for(s in e.query)r.push(s+"="+e.query[s]);n+=r.join("&")}var a=n.split("{{");if(1<a.length){for(var i=1;i<a.length;i++){var o=a[i].indexOf("}}"),s=a[i].slice(0,o);void 0!==l.params[s]&&(a[i]=l.params[s]+a[i].slice(o+2))}n=a.join("")}if(t._xhr.open(e.method||"GET",n,!0),t.notJson=e.notJson||!1,e.ignoreContentType||"PUT"!==e.method&&"POST"!==e.method&&"DELETE"!==e.method||t._xhr.setRequestHeader("Content-Type","application/json"),e.headers)for(var s in e.headers)t._xhr.setRequestHeader(s,e.headers[s]);return!e.data||"string"==typeof e.data||e.data instanceof FormData||(e.data=JSON.stringify(e.data)),t._xhr.send(e.data||null),t}n.AjaxRequest=s},{"../lib":12}],9:[function(e,t,n){"use strict";var r,a=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0}),n.Editor=void 0;var i,o=e("./events"),s=(i=o.Events,a(l,i),l.prototype.method=function(e,t){if(void 0!==this._hooks[e])throw new Error("can't override hook: "+e);this._hooks[e]=t},l.prototype.methodRemove=function(e){delete this._hooks[e]},l.prototype.call=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(this._hooks[t]){e=Array.prototype.slice.call(arguments,1);try{return this._hooks[t].apply(null,e)}catch(e){console.error("%c%s %c(editor.method error)","color: #06f",t,"color: #f00"),console.error(e.stack)}}return null},l);function l(){var e=i.call(this)||this;return e._hooks={},e}n.Editor=s},{"./events":10}],10:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.EventHandle=n.Events=void 0;var r=(Object.defineProperty(a.prototype,"suspendEvents",{get:function(){return this._suspendEvents},set:function(e){this._suspendEvents=e},enumerable:!1,configurable:!0}),a.prototype.on=function(e,t){var n=this._events[e];return void 0===n?this._events[e]=[t]:-1==n.indexOf(t)&&n.push(t),new i(this,e,t)},a.prototype.once=function(e,l){var c=this,u=this.on(e,function(e,t,n,r,a,i,o,s){l.call(c,e,t,n,r,a,i,o,s),u.unbind()});return u},a.prototype.emit=function(t,e,n,r,a,i,o,s,l){if(this._suspendEvents)return this;var c=this._events[t];if(!c)return this;c=c.slice(0);for(var u=0;u<c.length;u++)if(c[u])try{c[u].call(this,e,n,r,a,i,o,s,l)}catch(e){console.info("%c%s %c(event error)","color: #06f",t,"color: #f00"),console.log(e.stack)}return this},a.prototype.unbind=function(e,t){if(e){var n,r=this._events[e];if(!r)return this;t?-1!==(n=r.indexOf(t))&&(1===r.length?delete this._events[e]:r.splice(n,1)):delete this._events[e]}else this._events={};return this},a);function a(){this._suspendEvents=!1,this._events={}}n.Events=r;var i=(o.prototype.unbind=function(){this.owner&&(this.owner.unbind(this.name,this.fn),this.owner=null,this.name=null,this.fn=null)},o.prototype.call=function(){this.fn&&this.fn.call(this.owner,arguments[0],arguments[1],arguments[2],arguments[3],arguments[4],arguments[5],arguments[6],arguments[7])},o.prototype.on=function(e,t){return this.owner.on(e,t)},o);function o(e,t,n){this.owner=e,this.name=t,this.fn=n}n.EventHandle=i},{}],11:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.GUID=void 0;var r=(a.create=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)})},a);function a(){}n.GUID=r},{}],12:[function(e,t,n){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),a=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||t.hasOwnProperty(n)||r(t,e,n)};Object.defineProperty(n,"__esModule",{value:!0}),a(e("./events"),n),a(e("./editor"),n),a(e("./observer"),n),a(e("./tools"),n),a(e("./guid"),n),a(e("./ajax"),n),a(e("./very-light"),n),a(e("./very-camera"),n)},{"./ajax":8,"./editor":9,"./events":10,"./guid":11,"./observer":13,"./tools":14,"./very-camera":15,"./very-light":16}],13:[function(e,t,n){"use strict";var r,a=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0}),n.Observer=void 0;var i,o=e("./events"),s=(i=o.Events,a(l,i),Object.defineProperty(l.prototype,"className",{get:function(){return"Observer"},enumerable:!1,configurable:!0}),l.prototype.patchData=function(e){if("object"==typeof e)for(var t in e)"object"==typeof e[t]?this.parserObject(t,t,e[t]):(this.set(t,e[t]),this._dataType[t]=!1,this._dataType2[t]=!1);else debug.warn(this.className+": 不是正确的json对象，打印：\n"+e)},l.prototype.set=function(e,t){for(var n,r=this._data[e],a=e.split("."),i="",o=0;o<a.length-1;o++)0===o?i=a[o]:i+=this.SEPARATOR+a[o];1<a.length&&this._dataType[e]?(n=parseInt(a[a.length-1]),this._data[e]=t,this._data[i][n]=t):(this._data[e]=t,this.updateChildData(e,t),this._data2[e]=t),this.emit(e+":set",t,r),this.emit("*:set",e,t,r)},l.prototype.isNumber=function(e){var t=Number(e);return!isNaN(t)},l.prototype.updateChildData=function(e,t){if(t instanceof Array){for(var n in this._data)n.startsWith(e+this.SEPARATOR)&&(delete this._data[n],delete this._dataType[n]);for(var r,a=0;a<t.length;a++)r=e+this.SEPARATOR+a.toString(),this._data[r]=t[a],this._dataType[r]=!0}},l.prototype.unset=function(e,t){if(!this.has(e))return!1;var n=this._data[e];return delete this._data[e],delete this._dataType[e],delete this._data2[e],delete this._dataType2[e],this.emit(e+":set",t,n),this.emit("*:set",e,t,n),!0},l.prototype.insert=function(e,t,n){if(!(this.has(e)&&this._data[e]instanceof Array))return!1;var r=this._data[e];return t instanceof Array&&(t=t.slice(0)),void 0===n?(r.push(t),n=r.length-1):r.splice(n,0,t),this.updateChildData(e,r),this.emit(e+":insert",t,n),this.emit("*:insert",e,t,n),!0},l.prototype.remove=function(e,t){if(!(this.has(e)&&this._data[e]instanceof Array))return!1;var n=this._data[e];if(n.length<t)return!1;var r=n[t];return n.splice(t,1),this.updateChildData(e,n),this.emit(e+":remove",r,t),this.emit("*:remove",e,r,t),!0},l.prototype.removeValue=function(e,t){if(!(this.has(e)&&this._data[e]instanceof Array))return!1;var n=this._data[e],r=n.indexOf(t);if(-1===r)return!1;var a=n[r];return n.splice(r,1),this.updateChildData(e,n),this.emit(e+":remove",a,r),this.emit("*:remove",e,a,r),!0},l.prototype.move=function(e,t,n){if(!(this.has(e)&&this._data[e]instanceof Array))return!1;var r=this._data[e];if(r.length<t||r.length<n||t===n)return!1;var a=r[t];return r.splice(t,1),-1===n&&(n=r.length),r.splice(n,0,a),this.updateChildData(e,r),this.emit(e+":move",a,n,t),this.emit("*:move",e,a,n,t),!0},l.prototype.parserObject=function(e,t,n){var r;this.set(e,n),this._dataType[e]=!1;var a=typeof n;if("object"==a&&n instanceof Array){this._dataType2[e]=!0;for(var i=0;i<n.length;i++)r=e+this.SEPARATOR+i.toString(),this.set(r,n[i]),this._dataType[r]=!0}else if("object"==a&&n instanceof Object)for(var o in n)"object"==typeof n[o]?this.parserObject(e+this.SEPARATOR+o,o,n[o]):(r=e+this.SEPARATOR+o,this.set(r,n[o]),this._dataType[r]=!1,this._dataType2[e]=!1)},l.prototype.has=function(e){return e in this._data},l.prototype.get=function(e){return e in this._data?this._data[e]:null},l.prototype.propagate=function(i){var o=this;return function(e,t,n,r){var a;o._parent&&(!o._parentKey&&o._parentField instanceof Array&&-1===o._parentField.indexOf(o)||(o._silent&&(a=o._parent.silence()),o._parent.emit(e+":"+i,t,n,r),o._parent.emit("*:"+i,e,t,n,r),o._silent&&o._parent.silenceRestore(a)))}},l.prototype.destroy=function(){this._destroyed||(this._destroyed=!0,this.emit("destroy"),this.unbind())},l);function l(e,t){var n=i.call(this)||this;if(n.SEPARATOR=".",n._dataType={},n._dataType2={},n.node=null,n.reparenting=!1,n._pathsWithDuplicates={},n.origin=e,t=t||{},n._destroyed=!1,n._path="",n._keys=[],n._data={},n._data2={},t.pathsWithDuplicates){n._pathsWithDuplicates={};for(var r=0;r<t.pathsWithDuplicates.length;r++)n._pathsWithDuplicates[t.pathsWithDuplicates[r]]=!0}return n.patchData(e),n._silent=!1,n}n.Observer=s},{"./events":10}],14:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.Tools=void 0;var r=(a.eulerAngleToRadian=function(e){var t=Math.PI/180;return e.multiplyByFloats(t,t,t)},a.radianToEulerAngle=function(e){var t=180/Math.PI;return e.multiplyByFloats(t,t,t)},a.vector3ToArray=function(e){return[e.x,e.y,e.z]},a);function a(){}n.Tools=r},{}],15:[function(e,t,n){"use strict";var r,a=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0}),n.VeryCamera=void 0;var i,o=(i=BABYLON.TransformNode,a(s,i),Object.defineProperty(s.prototype,"mode",{get:function(){return this.camera.mode},set:function(e){this.camera.mode=e},enumerable:!1,configurable:!0}),Object.defineProperty(s.prototype,"fov",{get:function(){return this.camera.fov},set:function(e){this.camera.fov=e},enumerable:!1,configurable:!0}),Object.defineProperty(s.prototype,"inertia",{get:function(){return this.camera.inertia},set:function(e){this.camera.inertia=e},enumerable:!1,configurable:!0}),Object.defineProperty(s.prototype,"orthoSize",{get:function(){return this.camera.mode===BABYLON.Camera.ORTHOGRAPHIC_CAMERA?(this._orthoSize=this.camera.orthoRight/this._scene.getEngine().getRenderWidth()/this.camera.viewport.width,this._orthoSize):0},set:function(e){this._orthoSize=e,this.camera.mode===BABYLON.Camera.ORTHOGRAPHIC_CAMERA&&(this.camera.orthoRight=e*this._scene.getEngine().getRenderWidth()*this.camera.viewport.width,this.camera.orthoLeft=-e*this._scene.getEngine().getRenderWidth()*this.camera.viewport.width,this.camera.orthoTop=e*this._scene.getEngine().getRenderHeight()*this.camera.viewport.height,this.camera.orthoBottom=-e*this._scene.getEngine().getRenderHeight()*this.camera.viewport.height)},enumerable:!1,configurable:!0}),Object.defineProperty(s.prototype,"clearColor",{get:function(){return null===this._clearColor&&(this._clearColor=new BABYLON.Color4(1,1,1,1)),this._clearColor.copyFrom(this._scene.clearColor),this._clearColor},set:function(e){this._clearColor=e,this._scene.activeCameras[0]===this.camera&&e&&this._scene.clearColor.copyFrom(e)},enumerable:!1,configurable:!0}),s.prototype.renderCamera=function(e){this._render!==e&&((this._render=e)?this.camera.viewport=this._backupViewport.clone():(this._backupViewport=this.camera.viewport.clone(),this.camera.viewport=new BABYLON.Viewport(0,0,0,0)))},s.prototype.resize=function(e){var t,n;this.camera&&this._canvas&&(this._canvas.width===this._width&&this._canvas.height===this._height||(this._width=this._canvas.width,this._height=this._canvas.height,t=this._scene.getEngine().getRenderWidth(),n=this._scene.getEngine().getRenderHeight(),this.camera.mode===BABYLON.Camera.ORTHOGRAPHIC_CAMERA&&(this.camera.orthoRight=this._orthoSize*t*this.camera.viewport.width,this.camera.orthoLeft=-this._orthoSize*t*this.camera.viewport.width,this.camera.orthoTop=this._orthoSize*n*this.camera.viewport.height,this.camera.orthoBottom=-this._orthoSize*n*this.camera.viewport.height)))},s);function s(e,t,n){var r=i.call(this,e.name,t)||this;return r._orthoSize=0,r._clearColor=null,r._backupViewport=new BABYLON.Viewport(0,0,1,1),r._render=!0,(r.camera=e).name+="-Camera",r._canvas=n,r._width=n.width,r._height=n.height,r.position.copyFrom(e.position),r.rotation.copyFrom(e.rotation),e.parent=r,e.position=BABYLON.Vector3.Zero(),e.rotation=BABYLON.Vector3.Zero(),e.inputs.clear(),r}n.VeryCamera=o},{}],16:[function(e,t,n){"use strict";var r,a=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0}),n.VeryLight=void 0;var i,o=(i=BABYLON.TransformNode,a(s,i),Object.defineProperty(s.prototype,"type",{get:function(){return this.light.getTypeID()},enumerable:!1,configurable:!0}),Object.defineProperty(s.prototype,"intensity",{get:function(){return this.light.intensity},set:function(e){this.light.intensity=e},enumerable:!1,configurable:!0}),Object.defineProperty(s.prototype,"diffuse",{get:function(){return this.light.diffuse},set:function(e){this.light.diffuse=e},enumerable:!1,configurable:!0}),Object.defineProperty(s.prototype,"specular",{get:function(){return this.light.specular},set:function(e){this.light.specular=e},enumerable:!1,configurable:!0}),Object.defineProperty(s.prototype,"angle",{get:function(){return this.light instanceof BABYLON.SpotLight?this.light.angle:0},set:function(e){this.light instanceof BABYLON.SpotLight&&(this.light.angle=e)},enumerable:!1,configurable:!0}),Object.defineProperty(s.prototype,"exponent",{get:function(){return this.light instanceof BABYLON.SpotLight?this.light.exponent:0},set:function(e){this.light instanceof BABYLON.SpotLight&&(this.light.exponent=e)},enumerable:!1,configurable:!0}),s);function s(e,t){var n=i.call(this,e.name,t)||this;return e.name+="-Light",n.light=e,n.position.copyFrom(e.getAbsolutePosition()),e.parent=n}n.VeryLight=o},{}],17:[function(e,t,n){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),a=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||t.hasOwnProperty(n)||r(t,e,n)};Object.defineProperty(n,"__esModule",{value:!0});var i=e("./game"),o=e("./lib");a(e("./index"),n);var s,l=!1,c=!1;window.editor=new o.Editor;var u;window.location.pathname.substring(9);u=window.location.pathname.substring(9),i.Config.projectID=u,ossfile.getJsonConfig(u,"assets").then(function(e){var t=JSON.parse(e);if(i.Config.assetsData=t,i.BabylonLoader.assetsData=t,editor.call("getScenes"),t.assets)for(var n in t.assets)"table"===t.assets[n].type&&(i.Config.tableAssetsID=n,i.Config.tableName=t.assets[n].name);""!==i.Config.tableAssetsID?editor.call("loadTable"):l=!0}).catch(function(e){console.error(e)}),editor.method("getScenes",function(){ossfile.getJsonConfig(u,"scenes").then(function(e){var t=JSON.parse(e),n=t.last;i.Config.scenesData=t.scenes[n],i.Config.sceneIndex=n,c=!0}).catch(function(e){console.error(e)})}),editor.method("loadTable",function(){ossfile.getJsonAsset(u,i.Config.tableAssetsID,"table").then(function(e){var t=JSON.parse(e),n=function(e){var t=document.createElement("div");t.innerHTML=e;var n=t.innerText||t.textContent;return t=null,n}(n=JSON.stringify(t));s=JSON.parse(n).table,i.Config.tableData=s,l=!0}).catch(function(e){console.log("load error: "+e)})}),function e(){var t,n;l&&c?(t=document.getElementById("renderCanvas"),n=document.getElementById("fpsLabel"),null!==t&&null!==n&&new i.Game(t,n).createScene(s).animate()):setTimeout(e,500)}()},{"./game":4,"./index":7,"./lib":12}]},{},[17]);
//# sourceMappingURL=publish.js.map
