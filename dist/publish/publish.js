!function i(o,s,l){function c(t,e){if(!s[t]){if(!o[t]){var r="function"==typeof require&&require;if(!e&&r)return r(t,!0);if(u)return u(t,!0);var n=new Error("Cannot find module '"+t+"'");throw n.code="MODULE_NOT_FOUND",n}var a=s[t]={exports:{}};o[t][0].call(a.exports,function(e){return c(o[t][1][e]||e)},a,a.exports,i,o,s,l)}return s[t].exports}for(var u="function"==typeof require&&require,e=0;e<l.length;e++)c(l[e]);return c}({1:[function(e,t,r){"use strict";var n=this&&this.__awaiter||function(e,o,s,l){return new(s=s||Promise)(function(r,t){function n(e){try{i(l.next(e))}catch(e){t(e)}}function a(e){try{i(l.throw(e))}catch(e){t(e)}}function i(e){var t;e.done?r(e.value):((t=e.value)instanceof s?t:new s(function(e){e(t)})).then(n,a)}i((l=l.apply(e,o||[])).next())})},I=this&&this.__generator||function(r,n){var a,i,o,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},e={next:t(0),throw:t(1),return:t(2)};return"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(t){return function(e){return function(t){if(a)throw new TypeError("Generator is already executing.");for(;s;)try{if(a=1,i&&(o=2&t[0]?i.return:t[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,t[1])).done)return o;switch(i=0,o&&(t=[2&t[0],o.value]),t[0]){case 0:case 1:o=t;break;case 4:return s.label++,{value:t[1],done:!1};case 5:s.label++,i=t[1],t=[0];continue;case 7:t=s.ops.pop(),s.trys.pop();continue;default:if(!(o=0<(o=s.trys).length&&o[o.length-1])&&(6===t[0]||2===t[0])){s=0;continue}if(3===t[0]&&(!o||t[1]>o[0]&&t[1]<o[3])){s.label=t[1];break}if(6===t[0]&&s.label<o[1]){s.label=o[1],o=t;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(t);break}o[2]&&s.ops.pop(),s.trys.pop();continue}t=n.call(r,s)}catch(e){t=[6,e],i=0}finally{a=o=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}([t,e])}}};Object.defineProperty(r,"__esModule",{value:!0}),r.BabylonLoader=void 0;var S=e("../lib"),j=e("./config"),a=(R.loadFromBabylonAsset=function(){},R.loadBabylon=function(e){var r=e.get("id"),n=null;R.babylonCacheData[r]?(n=R.babylonCacheData[r],R.parseBabylon(r,n),R.assembleBabylon(r,n)):ossfile.getJsonAsset(j.Config.projectID,e.get("id"),e.get("name"),e.get("file.hash")).then(function(e){var t=JSON.parse(e);n=t,R.babylonCacheData[r]=n,R.parseBabylon(r,n),R.assembleBabylon(r,n)})},R.parseBabylon=function(e,t){var r;t&&(r={},t.materials&&(r.materials={},t.materials.forEach(function(e){r.materials[e.id]=e})),t.geometries&&t.geometries.vertexData&&(r.geometries={},t.geometries.vertexData.forEach(function(e){r.geometries[e.id]=e})),t.meshes&&(r.meshes={},t.meshes.forEach(function(e){r.meshes[e.id]=e})),t.transformNodes&&(r.transformNodes={},t.transformNodes.forEach(function(e){r.transformNodes[e.id]=e})),R.babylonParsedData[e]=r)},R.hasBabylobData=function(e){return e in R.babylonCacheData},R.getBabylonData=function(e){return e in R.babylonCacheData?R.babylonCacheData[e]:null},R.hasParsedBabylonData=function(e){return e in R.babylonParsedData},R.getParsedBabylonData=function(e){return e in R.babylonParsedData?R.babylonParsedData[e]:null},R.meshParseRecursion=function(e,t,r,n,a){if(e){var i="";i=null!==e.parent?e.parent.id:editor.call("entities:root").get("resource_id");for(var o=e.getChildren(),s=[],l=0;l<o.length;l++)s.push(o[l].id);var c=S.Tools.radianToEulerAngle(e.rotation),u={name:e.name,resource_id:e.id,babylon_id:r[e.id],asset_id:t,parent:i,position:[e.position.x,e.position.y,e.position.z],rotation:[c.x,c.y,c.z],scale:[e.scaling.x,e.scaling.y,e.scaling.z],children:s,enabled:e.isEnabled(),checkCollisions:e.checkCollisions,pickable:e.isPickable,isVisible:e.isVisible,tags:[],type:"mesh"},h=editor.call("entities:new",u);n.push(h),a.push(h.origin);for(l=0;l<o.length;l++)R.meshParseRecursion(o[l],t,r,n,a)}},R.addSceneData=function(e,t){R.scenesData.entities[e]=t,R.scenesData.modified=R.createdAtTime()},R.updateSceneData=function(e,t){R.scenesData.entities[e]=t,R.scenesData.modified=R.createdAtTime()},R.createdAtTime=function(){var e=new Date;return e.getFullYear()+"-"+R.getRealTime(e.getMonth()+1)+"-"+R.getRealTime(e.getDate())+" "+R.getRealTime(e.getHours())+":"+R.getRealTime(e.getMinutes())},R.getRealTime=function(e){return e<10?"0"+e:e.toString()},R.createCameraWraper=function(e,t,r){var n=new BABYLON.UniversalCamera(e,new BABYLON.Vector3(0,100,-200),t);n.maxZ=2e4,n.attachControl(r,!0);var a=new S.VeryCamera(n,t,r);return a.orthoSize=.5,a},R.createLightWraper=function(e,t,r){var n=R.createLight(e,t,r);return new S.VeryLight(n,r)},R.createLight=function(e,t,r){return"point"===(e=e.toLowerCase())?new BABYLON.PointLight(t,BABYLON.Vector3.Zero(),r):"spot"===e?new BABYLON.SpotLight(t,BABYLON.Vector3.Zero(),new BABYLON.Vector3(0,-1,0),.75*Math.PI,8,r):"hemispheric"===e?new BABYLON.HemisphericLight(t,BABYLON.Vector3.Up(),r):new BABYLON.DirectionalLight(t,BABYLON.Vector3.Forward(),r)},R.loadLight=function(e,t){return null==e?null:BABYLON.Light.Parse(e,t)},R.loadReflectionProbe=function(e,t,r){return null==e?null:BABYLON.ReflectionProbe.Parse(e,t,r)},R.loadAnimation=function(e){if(null==e)return null;var t=BABYLON._TypeStore.GetClass("BABYLON.Animation");return t?t.Parse(e):null},R.loadMaterial=function(e,t,r){return null==e?null:BABYLON.Material.Parse(e,t,r)},R.loadMultiMaterial=function(e,t){return null==e?null:BABYLON.MultiMaterial.ParseMultiMaterial(e,t)},R.loadMorphTargetManager=function(e,t){return null==e?null:BABYLON.MorphTargetManager.Parse(e,t)},R.loadSkeleton=function(e,t){return null==e?null:BABYLON.Skeleton.Parse(e,t)},R.loadGeometry=function(e,t,r){return null==e?null:BABYLON.Geometry.Parse(e,t,r)},R.loadTransformNode=function(e,t,r){return null==e?null:BABYLON.TransformNode.Parse(e,t,r)},R.loadMesh=function(e,t,r){return null==e?null:BABYLON.Mesh.Parse(e,t,r)},R.loadCamera=function(e,t){return null==e?null:BABYLON.Camera.Parse(e,t)},R.loadAnimationGroup=function(e,t){return null==e?null:BABYLON.AnimationGroup.Parse(e,t)},R.setBabylonParent=function(e){for(var t,r=0,n=0,a=e.cameras.length;n<a;n++){var i=e.cameras[n];i._waitingParentId&&(i.parent=e.getLastEntryByID(i._waitingParentId),i._waitingParentId=null)}for(t=0,r=e.lights.length;t<r;t++){var o=e.lights[t];o&&o._waitingParentId&&(o.parent=e.getLastEntryByID(o._waitingParentId),o._waitingParentId=null)}for(t=0,r=e.transformNodes.length;t<r;t++){var s=e.transformNodes[t];s._waitingParentId&&(s.parent=e.getLastEntryByID(s._waitingParentId),s._waitingParentId=null)}for(t=0,r=e.meshes.length;t<r;t++){var l=e.meshes[t];l._waitingParentId&&(l.parent=e.getLastEntryByID(l._waitingParentId),l._waitingParentId=null)}},R.prefix="/assets/",R.assetsData={},R.projectData={},R.scenesData={},R.sceneIndex=0,R.babylonCacheData={},R.babylonParsedData={},R.assembleBabylon=function(E,V){return n(void 0,void 0,void 0,function(){var t,r,n,a,i,o,s,l,c,u,h,g,d,f,p,y,b,m,_,v,B,x,O,A,T,L,w,C,D,N,P;return I(this,function(e){switch(e.label){case 0:if(null===V)return[3,22];if(!R.assetsData.babylon[E])return[3,21];for(n in t=R.assetsData.babylon[E].materials,r=[],t)r.push(n);a=0,e.label=1;case 1:return a<r.length?(i=r[a],t[i].asset_id&&R.assetsData.assets[t[i].asset_id]?(o=R.assetsData.assets[t[i].asset_id].data,s="",o.diffuseTexture&&o.diffuseTexture.texture_id?(l=o.diffuseTexture.texture_id,[4,ossfile.getUrl(j.Config.projectID,l,R.assetsData.assets[l].name,R.assetsData.assets[l].file.hash)]):[3,3]):[3,20]):[3,21];case 2:s=e.sent(),o.diffuseTexture.name=s,e.label=3;case 3:return o.specularTexture&&o.specularTexture.texture_id?(c=o.specularTexture.texture_id,[4,ossfile.getUrl(j.Config.projectID,c,R.assetsData.assets[c].name,R.assetsData.assets[c].file.hash)]):[3,5];case 4:s=e.sent(),o.specularTexture.name=s,e.label=5;case 5:return o.reflectionTexture&&o.reflectionTexture.texture_id?(u=o.reflectionTexture.texture_id,[4,ossfile.getUrl(j.Config.projectID,u,R.assetsData.assets[u].name,R.assetsData.assets[u].file.hash)]):[3,7];case 6:s=e.sent(),o.reflectionTexture.name=s,e.label=7;case 7:return o.refractionTexture&&o.refractionTexture.texture_id?(h=o.refractionTexture.texture_id,[4,ossfile.getUrl(j.Config.projectID,h,R.assetsData.assets[h].name,R.assetsData.assets[h].file.hash)]):[3,9];case 8:s=e.sent(),o.refractionTexture.name=s,e.label=9;case 9:return o.emissiveTexture&&o.emissiveTexture.texture_id?(g=o.emissiveTexture.texture_id,[4,ossfile.getUrl(j.Config.projectID,g,R.assetsData.assets[g].name,R.assetsData.assets[g].file.hash)]):[3,11];case 10:s=e.sent(),o.emissiveTexture.name=s,e.label=11;case 11:return o.bumpTexture&&o.bumpTexture.texture_id?(d=o.bumpTexture.texture_id,[4,ossfile.getUrl(j.Config.projectID,d,R.assetsData.assets[d].name,R.assetsData.assets[d].file.hash)]):[3,13];case 12:s=e.sent(),o.bumpTexture.name=s,e.label=13;case 13:return o.opacityTexture&&o.opacityTexture.texture_id?(f=o.opacityTexture.texture_id,[4,ossfile.getUrl(j.Config.projectID,f,R.assetsData.assets[f].name,R.assetsData.assets[f].file.hash)]):[3,15];case 14:s=e.sent(),o.opacityTexture.name=s,e.label=15;case 15:return o.ambientTexture&&o.ambientTexture.texture_id?(p=o.ambientTexture.texture_id,[4,ossfile.getUrl(j.Config.projectID,p,R.assetsData.assets[p].name,R.assetsData.assets[p].file.hash)]):[3,17];case 16:s=e.sent(),o.ambientTexture.name=s,e.label=17;case 17:return o.lightmapTexture&&o.lightmapTexture.texture_id?(y=o.lightmapTexture.texture_id,[4,ossfile.getUrl(j.Config.projectID,y,R.assetsData.assets[y].name,R.assetsData.assets[y].file.hash)]):[3,19];case 18:s=e.sent(),o.lightmapTexture.name=s,e.label=19;case 19:R.loadMaterial(o,VR.BabylonEngine.Scene,""),e.label=20;case 20:return a++,[3,1];case 21:for(V.geometries&&V.geometries.vertexData&&V.geometries.vertexData.array.forEach(function(e){R.loadGeometry(e,VR.BabylonEngine.Scene,"")}),b=[],V.transformNodes&&V.transformNodes.forEach(function(e){var t=R.loadTransformNode(e,VR.BabylonEngine.Scene,"");b.push(t)}),m=[],_=[],v={},B={},V.meshes&&(V.meshes.forEach(function(e){var t,r;R.scenesData.entities[e.id]?(t=S.GUID.create(),r=e.id,B[t]=r,e.id=t,V.meshes.forEach(function(e){e.parentId===r&&(e.parentId=t)})):B[e.id]=e.id}),V.meshes.forEach(function(e){var t=R.loadMesh(e,VR.BabylonEngine.Scene,"");m.push(t),v[e.id]=t})),O=x=null,"entity"===editor.call("selector:type")&&(x=editor.call("selector:items")[0]),x?x.node&&(O=x.node):x=editor.call("entities:root"),A=[],T=[],L=0,w=b.length;L<w;L++)(C=b[L])&&C._waitingParentId&&(C.parent=VR.BabylonEngine.Scene.getLastEntryByID(C._waitingParentId),C._waitingParentId=null);for(N=0,D=m.length;N<D;N++)null!==m[N]&&(m[N]._waitingParentId&&v[m[N]._waitingParentId]?m[N].parent=v[m[N]._waitingParentId]:(m[N].parent=O,_.push(m[N])),m[N]._waitingParentId=null);for(N=0;N<_.length;N++)R.meshParseRecursion(_[N],E,B,A,T);editor.call("selector:history",!1),editor.call("selector:set","entity",[editor.call("entities:get",null===(P=_[0])||void 0===P?void 0:P.id)]),editor.once("selector:change",function(){editor.call("selector:history",!0)}),editor.call("make:scene:dirty"),e.label=22;case 22:return[2]}})})},R);function R(){}r.BabylonLoader=a},{"../lib":12,"./config":2}],2:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.Config=void 0;var n=(a.addCamera=function(e){a.cameras.push(e)},a.prefix="/assets/",a.projectID="",a.projectName="",a.projectData={},a.userID="",a.username="",a.assetsData={},a.scenesData={},a.sceneIndex=0,a.sceneName="",a.tableAssetsID="",a.tableName="",a.tableData=null,a.cameras=[],a);function a(){}r.Config=n},{}],3:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.Game=void 0;var n=e("./config"),a=e("./loader"),i=(o.prototype.createScene=function(e){var t=this;this._engine&&(VR.VE_Manager.dispose(),this._engine.dispose()),this._engine=new BABYLON.Engine(this._canvas,!0),VR.BabylonEngine.Engine=this._engine;var r=this._engine;return window.addEventListener("resize",function(){r.resize()}),this._scene=new BABYLON.Scene(this._engine),VR.BabylonEngine.Scene=this._scene,VR.Time.start(),this._scene.clearColor=new BABYLON.Color4(116/255,116/255,116/255,1),r.displayLoadingUI(),editor.call("scene:raw",n.Config.scenesData,this.startVeryEngine.bind(this),e),r.hideLoadingUI(),this._scene.onKeyboardObservable.add(function(e){e.type===BABYLON.KeyboardEventTypes.KEYDOWN&&81===e.event.keyCode&&e.event.ctrlKey&&e.event.altKey&&t.toggleDebug()}),this._engine.runRenderLoop(function(){t._scene&&t._scene.activeCamera&&t._scene.render()}),this},o.prototype.startVeryEngine=function(e){var t=new VR.VeryEngine;try{t.init(e,n.Config.projectName)}catch(e){console.error(e)}var r=VR.VE_Manager.objects(n.Config.projectName);this._scene.onBeforeRenderObservable.add(function(){for(var e=0;e<r.count;e++){var t=r.getObjectID(e);r.getVeryObject(t).update()}}),this._scene.onKeyboardObservable.add(function(e){e.type,BABYLON.KeyboardEventTypes.KEYDOWN})},o.prototype.animate=function(){var r=this;return this._engine.runRenderLoop(function(){if(r._canvas.width!==r._canvas.clientWidth&&r._engine.resize(),r._scene){for(var e=0,t=n.Config.cameras.length;e<t;e++)n.Config.cameras[e].resize(!1);r._scene.render()}r._showFps&&r.updateFpsPos()}),this},o.prototype.toggleDebug=function(){var e;return this._engine&&((e=this._engine.scenes[0]).debugLayer.isVisible()?e.debugLayer.hide():e.debugLayer.show({embedMode:!0})),this},o.prototype.updateFpsPos=function(){this._fps&&(this._fps.innerHTML=this._engine.getFps().toFixed()+" fps")},o);function o(e,t){this._showFps=!0,new a.Loader,this._canvas=e,VR.BabylonEngine.Canvas=this._canvas,this._fps=t,this._table=document.getElementById("VeryTable")}r.Game=i},{"./config":2,"./loader":5}],4:[function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),a=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||t.hasOwnProperty(r)||n(t,e,r)};Object.defineProperty(r,"__esModule",{value:!0}),a(e("./game"),r),a(e("./scenes"),r),a(e("./config"),r),a(e("./loader"),r),a(e("./babylonloader"),r)},{"./babylonloader":1,"./config":2,"./game":3,"./loader":5,"./scenes":6}],5:[function(e,t,r){"use strict";var d=this&&this.__awaiter||function(e,o,s,l){return new(s=s||Promise)(function(r,t){function n(e){try{i(l.next(e))}catch(e){t(e)}}function a(e){try{i(l.throw(e))}catch(e){t(e)}}function i(e){var t;e.done?r(e.value):((t=e.value)instanceof s?t:new s(function(e){e(t)})).then(n,a)}i((l=l.apply(e,o||[])).next())})},A=this&&this.__generator||function(r,n){var a,i,o,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},e={next:t(0),throw:t(1),return:t(2)};return"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(t){return function(e){return function(t){if(a)throw new TypeError("Generator is already executing.");for(;s;)try{if(a=1,i&&(o=2&t[0]?i.return:t[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,t[1])).done)return o;switch(i=0,o&&(t=[2&t[0],o.value]),t[0]){case 0:case 1:o=t;break;case 4:return s.label++,{value:t[1],done:!1};case 5:s.label++,i=t[1],t=[0];continue;case 7:t=s.ops.pop(),s.trys.pop();continue;default:if(!(o=0<(o=s.trys).length&&o[o.length-1])&&(6===t[0]||2===t[0])){s=0;continue}if(3===t[0]&&(!o||t[1]>o[0]&&t[1]<o[3])){s.label=t[1];break}if(6===t[0]&&s.label<o[1]){s.label=o[1],o=t;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(t);break}o[2]&&s.ops.pop(),s.trys.pop();continue}t=n.call(r,s)}catch(e){t=[6,e],i=0}finally{a=o=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}([t,e])}}};Object.defineProperty(r,"__esModule",{value:!0}),r.Loader=void 0;function n(){var e=this;editor.method("initAssets",function(e){e.assets&&t(e.assets)});var t=function(e){editor.call("assets:progress",.5);var t,r,n=0,a=Object.getOwnPropertyNames(e).length;for(t in e)r=e[t],editor.call("loadAsset",r,function(){n++,editor.call("assets:progress",n/a*.5+.5),a<=n&&(editor.call("assets:progress",1),editor.emit("assets:load"))})};editor.method("scene:raw",function(e,t,r){for(var n in e.entities){var a=new T.Observer(e.entities[n]);"root"!==a.get("type")&&editor.call("create:scene:element",a)}l=p.length;for(var i=c=0;i<p.length;i++)editor.call("scene:mesh:create",p[i],t,r);0===p.length&&t(r),editor.emit("entities:load")});var i={},x={};editor.method("create:scene:element",function(e){var t,r,n,a,i,o,s,l,c,u,h,g,d;"light"===e.get("type")?((t=L.BabylonLoader.createLightWraper(e.get("subtype"),e.get("name"),VR.BabylonEngine.Scene)).light.intensity=e.has("intensity")?e.get("intensity"):1,e.has("diffuse")&&3===e.get("diffuse").length&&(t.light.diffuse=BABYLON.Color3.FromArray(e.get("diffuse"))),e.has("specular")&&3===e.get("specular").length&&(t.light.specular=BABYLON.Color3.FromArray(e.get("specular"))),t.light instanceof BABYLON.SpotLight&&(e.has("angle")&&(t.light.angle=e.get("angle")),e.has("exponent")&&(t.light.exponent=e.get("exponent"))),t.id=e.get("resource_id"),x[e.get("resource_id")]=t,e.node=t,e.has("enabled")&&t.setEnabled(e.get("enabled")),e.has("position")&&3===e.get("position").length&&(t.position=BABYLON.Vector3.FromArray(e.get("position"))),e.has("rotation")&&3===e.get("rotation").length&&(t.rotation=T.Tools.eulerAngleToRadian(BABYLON.Vector3.FromArray(e.get("rotation"))),t.type===BABYLON.Light.LIGHTTYPEID_HEMISPHERICLIGHT&&t.light.direction.copyFrom(t.up)),e.has("scale")&&3===e.get("scale").length&&(t.scaling=BABYLON.Vector3.FromArray(e.get("scale"))),O(e,t)):"camera"===e.get("type")?(r=L.BabylonLoader.createCameraWraper(e.get("name"),VR.BabylonEngine.Scene,VR.BabylonEngine.Canvas),VR.BabylonEngine.Scene.activeCameras.push(r.camera),r.id=e.get("resource_id"),x[e.get("resource_id")]=r,e.node=r,e.has("enabled")&&r.setEnabled(e.get("enabled")),e.has("position")&&3===e.get("position").length&&(r.position=BABYLON.Vector3.FromArray(e.get("position"))),e.has("rotation")&&3===e.get("rotation").length&&(r.rotation=T.Tools.eulerAngleToRadian(BABYLON.Vector3.FromArray(e.get("rotation")))),e.has("scale")&&3===e.get("scale").length&&(r.scaling=BABYLON.Vector3.FromArray(e.get("scale"))),e.has("checkCollisions")&&r.camera instanceof BABYLON.FreeCamera&&(r.camera.checkCollisions=e.get("checkCollisions")),e.has("applyGravity")&&r.camera instanceof BABYLON.FreeCamera&&(r.camera.applyGravity=e.get("applyGravity")),e.has("viewport")&&(n=e.get("viewport"))&&n.length&&4===n.length&&(r.camera.viewport=new BABYLON.Viewport(n[0],n[1],n[2],n[3])),e.has("clearColor")?(n=e.get("clearColor"))&&n.length&&4===n.length&&(r.clearColor=new BABYLON.Color4(n[0],n[1],n[2],n[3])):r.clearColor=new BABYLON.Color4(45/255,145/255,186/255,1),e.has("mode")&&(r.mode=e.get("mode")),e.has("fov")&&(r.fov=e.get("fov")),e.has("inertia")&&(r.inertia=e.get("inertia")),e.has("orthoSize")&&(r.orthoSize=e.get("orthoSize")),r.resize(!1),w.Config.addCamera(r),O(e,r)):"empty"===e.get("type")?(a=new BABYLON.TransformNode(e.get("name"),VR.BabylonEngine.Scene),(e.node=a).id=e.get("resource_id"),a.position=BABYLON.Vector3.FromArray(e.get("position")),a.rotation=T.Tools.eulerAngleToRadian(BABYLON.Vector3.FromArray(e.get("rotation"))),a.scaling=BABYLON.Vector3.FromArray(e.get("scale")),a.isEnabled(e.get("enabled")),O(e,a)):"primitive"===e.get("type")?e.get("subtype")&&"box"===e.get("subtype")?(i=BABYLON.MeshBuilder.CreateBox(e.get("name"),{size:100},VR.BabylonEngine.Scene),e.node=i,(x[e.get("resource_id")]=i).id=e.get("resource_id"),e.has("enabled")&&i.setEnabled(e.get("enabled")),e.has("position")&&3===e.get("position").length&&(i.position=BABYLON.Vector3.FromArray(e.get("position"))),e.has("rotation")&&3===e.get("rotation").length&&(i.rotation=T.Tools.eulerAngleToRadian(BABYLON.Vector3.FromArray(e.get("rotation")))),e.has("scale")&&3===e.get("scale").length&&(i.scaling=BABYLON.Vector3.FromArray(e.get("scale"))),e.has("checkCollisions")&&(i.checkCollisions=e.get("checkCollisions")),e.has("pickable")&&(i.isPickable=e.get("pickable")),e.has("isVisible")&&(i.isVisible=e.get("isVisible")),e.get("material_id"),O(e,i)):e.get("subtype")&&"sphere"===e.get("subtype")?(i=BABYLON.MeshBuilder.CreateSphere(e.get("name"),{segments:20,diameter:100},VR.BabylonEngine.Scene),e.node=i,(x[e.get("resource_id")]=i).id=e.get("resource_id"),e.has("enabled")&&i.setEnabled(e.get("enabled")),e.has("position")&&3===e.get("position").length&&(i.position=BABYLON.Vector3.FromArray(e.get("position"))),e.has("rotation")&&3===e.get("rotation").length&&(i.rotation=T.Tools.eulerAngleToRadian(BABYLON.Vector3.FromArray(e.get("rotation")))),e.has("scale")&&3===e.get("scale").length&&(i.scaling=BABYLON.Vector3.FromArray(e.get("scale"))),e.has("checkCollisions")&&(i.checkCollisions=e.get("checkCollisions")),e.has("pickable")&&(i.isPickable=e.get("pickable")),e.has("isVisible")&&(i.isVisible=e.get("isVisible")),e.get("material_id"),O(e,i)):e.get("subtype")&&"plane"===e.get("subtype")?(i=BABYLON.MeshBuilder.CreateGround(e.get("name"),{width:5e3,height:5e3,subdivisions:10},VR.BabylonEngine.Scene),e.node=i,(x[e.get("resource_id")]=i).id=e.get("resource_id"),e.has("enabled")&&i.setEnabled(e.get("enabled")),e.has("position")&&3===e.get("position").length&&(i.position=BABYLON.Vector3.FromArray(e.get("position"))),e.has("rotation")&&3===e.get("rotation").length&&(i.rotation=T.Tools.eulerAngleToRadian(BABYLON.Vector3.FromArray(e.get("rotation")))),e.has("scale")&&3===e.get("scale").length&&(i.scaling=BABYLON.Vector3.FromArray(e.get("scale"))),e.has("checkCollisions")&&(i.checkCollisions=e.get("checkCollisions")),e.has("pickable")&&(i.isPickable=e.get("pickable")),e.has("isVisible")&&(i.isVisible=e.get("isVisible")),e.get("material_id"),O(e,i)):e.get("subtype")&&"cylinder"===e.get("subtype")&&(i=BABYLON.MeshBuilder.CreateCylinder(e.get("name"),{height:200,diameter:100},VR.BabylonEngine.Scene),e.node=i,(x[e.get("resource_id")]=i).id=e.get("resource_id"),e.has("enabled")&&i.setEnabled(e.get("enabled")),e.has("position")&&3===e.get("position").length&&(i.position=BABYLON.Vector3.FromArray(e.get("position"))),e.has("rotation")&&3===e.get("rotation").length&&(i.rotation=T.Tools.eulerAngleToRadian(BABYLON.Vector3.FromArray(e.get("rotation")))),e.has("scale")&&3===e.get("scale").length&&(i.scaling=BABYLON.Vector3.FromArray(e.get("scale"))),e.has("checkCollisions")&&(i.checkCollisions=e.get("checkCollisions")),e.has("pickable")&&(i.isPickable=e.get("pickable")),e.has("isVisible")&&(i.isVisible=e.get("isVisible")),e.get("material_id"),O(e,i)):"mesh"===e.get("type")?p.push(e):"2d-gui"===e.get("type")&&(e.get("subtype")&&"root"===e.get("subtype")?(o=BABYLON.GUI.AdvancedDynamicTexture.CreateFullscreenUI(e.get("name")),e.node=o,f(o.rootContainer,e),x[e.get("resource_id")]=o.rootContainer,O(e,o.rootContainer),VR.GUIManager.createCanvas(o)):e.get("subtype")&&"panel"===e.get("subtype")?(s=new BABYLON.GUI.Rectangle(e.get("name")),e.node=s,f(s,e),e.has("gui.color")&&(s.color=T.Tools.rgba2hsvString(e.get("gui.color"))),e.has("gui.background")&&(s.background=T.Tools.rgba2hsvString(e.get("gui.background"))),e.has("gui.thickness")&&(s.thickness=e.get("gui.thickness")),e.has("gui.cornerRadius")&&(s.cornerRadius=e.get("gui.cornerRadius")),x[e.get("resource_id")]=s,O(e,s),VR.GUIManager.addControl(s)):e.get("subtype")&&"button"===e.get("subtype")?(l=BABYLON.GUI.Button.CreateImageWithCenterTextButton(e.get("name"),"",""),e.node=l,f(l,e),e.has("gui.color")&&(l.color=T.Tools.rgba2hsvString(e.get("gui.color"))),e.has("gui.background")&&(l.background=T.Tools.rgba2hsvString(e.get("gui.background"))),e.has("gui.thickness")&&(l.thickness=e.get("gui.thickness")),e.has("gui.cornerRadius")&&(l.cornerRadius=e.get("gui.cornerRadius")),e.has("gui.text")&&(l.textBlock.text=e.get("gui.text")),e.has("gui.fontSize")&&(l.fontSize=e.get("gui.fontSize"),l.textBlock.fontSize=e.get("gui.fontSize")),e.has("gui.textColor")&&(l.textBlock.color=T.Tools.rgba2hsvString(e.get("gui.textColor"))),e.has("gui.source")&&e.get("gui.source")&&(u=e.get("gui.source"),ossfile.getUrl(w.Config.projectID,u,L.BabylonLoader.assetsData.assets[u].name,L.BabylonLoader.assetsData.assets[u].file.hash).then(function(e){l.image.source=e})),x[e.get("resource_id")]=l,O(e,l),VR.GUIManager.addControl(l)):e.get("subtype")&&"image"===e.get("subtype")?(c=new BABYLON.GUI.Image(e.get("name"),""),e.node=c,f(c,e),e.has("gui.color")&&(c.color=T.Tools.rgba2hsvString(e.get("gui.color"))),e.has("gui.source")&&e.get("gui.source")&&(u=e.get("gui.source"),ossfile.getUrl(w.Config.projectID,u,L.BabylonLoader.assetsData.assets[u].name,L.BabylonLoader.assetsData.assets[u].file.hash).then(function(e){c.source=e})),x[e.get("resource_id")]=c,O(e,c),VR.GUIManager.addControl(c)):e.get("subtype")&&"text"===e.get("subtype")?(h=new BABYLON.GUI.TextBlock(e.get("name"),""),e.node=h,f(h,e),e.has("gui.color")&&(h.color=T.Tools.rgba2hsvString(e.get("gui.color"))),e.has("gui.fontSize")&&(h.fontSize=e.get("gui.fontSize")),e.has("gui.text")&&(h.text=e.get("gui.text")),e.has("gui.textWrapping")&&(h.textWrapping=e.get("gui.textWrapping")),e.has("gui.textHorizontalAlignment")&&(h.textHorizontalAlignment=e.get("gui.textHorizontalAlignment")),e.has("gui.textVerticalAlignment")&&(h.textVerticalAlignment=e.get("gui.textVerticalAlignment")),x[e.get("resource_id")]=h,O(e,h),VR.GUIManager.addControl(h)):e.get("subtype")&&"input"===e.get("subtype")?(g=new BABYLON.GUI.InputText(e.get("name"),""),e.node=g,f(g,e),e.has("gui.color")&&(g.color=T.Tools.rgba2hsvString(e.get("gui.color"))),e.has("gui.background")&&(g.background=T.Tools.rgba2hsvString(e.get("gui.background"))),e.has("gui.thickness")&&(g.thickness=e.get("gui.thickness")),e.has("gui.fontSize")&&(g.fontSize=e.get("gui.fontSize")),e.has("gui.placeholderColor")&&(g.placeholderColor=T.Tools.rgba2hsvString(e.get("gui.placeholderColor"))),e.has("gui.placeholderText")&&(g.placeholderText=e.get("gui.placeholderText")),e.has("gui.focusedBackground")&&(g.focusedBackground=T.Tools.rgba2hsvString(e.get("gui.focusedBackground"))),e.has("gui.text")&&(g.text=e.get("gui.text")),x[e.get("resource_id")]=g,O(e,g),VR.GUIManager.addControl(g)):e.get("subtype")&&"checkbox"===e.get("subtype")&&(d=new BABYLON.GUI.RadioButton(e.get("name")),e.node=d,f(d,e),e.has("gui.color")&&(d.color=T.Tools.rgba2hsvString(e.get("gui.color"))),e.has("gui.background")&&(d.background=T.Tools.rgba2hsvString(e.get("gui.background"))),e.has("gui.thickness")&&(d.thickness=e.get("gui.thickness")),e.has("gui.isChecked")&&(d.isChecked=e.get("gui.isChecked")),x[e.get("resource_id")]=d,O(e,d),VR.GUIManager.addControl(d)))});var O=function(e,t){for(var r,n=e.get("children"),a=0;a<n.length;a++)i[n[a]]={index:a,parent:t},x[n[a]]&&o(t,x[n[a]],a,e.get("resource_id"));!e.get("parent")||(r=i[e.get("resource_id")])&&r.parent&&o(r.parent,t,r.index,e.get("resource_id"))},o=function(e,t,r,n){var a;t&&t instanceof BABYLON.Node?(null===e||e instanceof BABYLON.Node)&&(t.parent=e):t&&t instanceof BABYLON.GUI.Control&&e instanceof BABYLON.GUI.Container&&(e.addControl(t),a=e.children.pop(),e.children.splice(r,0,a))},f=function(e,t){t.has("gui.isVisible")&&(e.isVisible=t.get("gui.isVisible")),t.has("gui.x")&&(t.has("gui.xType")&&1===t.get("gui.xType")?e.left=t.get("gui.x")+"%":e.left=t.get("gui.x")+"px"),t.has("gui.y")&&(t.has("gui.yType")&&1===t.get("gui.yType")?e.top=t.get("gui.y")+"%":e.top=t.get("gui.y")+"px"),t.has("gui.width")&&(t.has("gui.widthType")&&1===t.get("gui.widthType")?e.width=t.get("gui.width")+"%":e.width=t.get("gui.width")+"px"),t.has("gui.height")&&(t.has("gui.heightType")&&1===t.get("gui.heightType")?e.height=t.get("gui.height")+"%":e.height=t.get("gui.height")+"px"),t.has("gui.scaleX")&&(e.scaleX=t.get("gui.scaleX")),t.has("gui.scaleY")&&(e.scaleY=t.get("gui.scaleY")),t.has("gui.horizontal_alignment")&&(e.horizontalAlignment=t.get("gui.horizontal_alignment")),t.has("gui.vertical_alignment")&&(e.verticalAlignment=t.get("gui.vertical_alignment")),t.has("gui.alpha")&&(e.alpha=t.get("gui.alpha")),t.has("gui.rotation")&&(e.rotation=T.Tools.eulerAngleFloatToRadian(t.get("gui.rotation")))};editor.method("scene:mesh:create",function(e,t,r){n(e,t,r)});var l=0,c=0,p=[],u={},h={},n=function(i,o,s){return d(e,void 0,void 0,function(){var t,r,n,a=this;return A(this,function(e){return t=i.get("asset_id"),r=null,L.BabylonLoader.hasBabylobData(t)?(r=L.BabylonLoader.getParsedBabylonData(t),g(i,r),++c===l&&(l=c=0,p=[],o(s))):t in u?h[t].push(i):(u[t]=!0,h[t]=[i],n=L.BabylonLoader.assetsData.assets[t].name,ossfile.getJsonAsset(w.Config.projectID,t,n,L.BabylonLoader.assetsData.assets[t].file.hash).then(function(e){r=JSON.parse(e),L.BabylonLoader.babylonCacheData[t]=r,L.BabylonLoader.parseBabylon(t,r),L.BabylonLoader.parseBabylon(t,r),r=L.BabylonLoader.getParsedBabylonData(t),h[t].forEach(function(t){return d(a,void 0,void 0,function(){return A(this,function(e){switch(e.label){case 0:return[4,g(t,r)];case 1:return e.sent(),++c==l&&(l=c=0,p=[],o(s)),[2]}})})})})),[2]})})},g=function(v,B){return d(e,void 0,void 0,function(){var t,r,n,a,i,o,s,l,c,u,h,g,d,f,p,y,b,m,_;return A(this,function(e){switch(e.label){case 0:return B?(t=v.get("asset_id"),r=v.get("babylon_id"),B.meshes[r]?((n=B.meshes[r]).position=v.has("position")&&v.get("position")?v.get("position"):n.position,a=(a=v.get("rotation"))&&0<a.length?T.Tools.vector3ToArray(T.Tools.eulerAngleToRadian(BABYLON.Vector3.FromArray(a))):n.rotation,n.rotation=a,n.scale=v.has("scale")&&v.get("scale")?v.get("scale"):n.scal,n.name=v.has("name")&&v.get("name")?v.get("name"):n.name,n.id=v.has("resource_id")&&v.get("resource_id")?v.get("resource_id"):n.id,n.isEnabled=v.has("enabled")?v.get("enabled"):n.isEnabled,n.isVisible=v.has("isVisible")?v.get("isVisible"):n.isVisible,n.pickable=v.has("pickable")?v.get("pickable"):n.pickable,n.checkCollisions=v.has("checkCollisions")?v.get("checkCollisions"):n.checkCollisions,n.materialId=v.has("material_id")?v.get("material_id"):n.materialId,n.parentId=v.has("parent")?v.get("parent"):n.parentId,n.geometryId&&null===VR.BabylonEngine.Scene.getGeometryByID(n.geometryId)&&B.geometries&&B.geometries[n.geometryId]&&(i=B.geometries[n.geometryId],L.BabylonLoader.loadGeometry(i,VR.BabylonEngine.Scene,"")),!n.materialId||null!==VR.BabylonEngine.Scene.getMaterialByID(n.materialId)?[3,22]:L.BabylonLoader.assetsData.babylon[t]?(o=L.BabylonLoader.assetsData.babylon[t].materials)&&o[n.materialId]?(s=o[n.materialId].asset_id,L.BabylonLoader.assetsData.assets[s]?(l=L.BabylonLoader.assetsData.assets[s].data,c="",l.diffuseTexture&&l.diffuseTexture.texture_id?(u=l.diffuseTexture.texture_id,[4,ossfile.getUrl(w.Config.projectID,u,L.BabylonLoader.assetsData.assets[u].name,L.BabylonLoader.assetsData.assets[u].file.hash)]):[3,2]):[3,19]):[3,20]:[3,21]):[3,23]):[3,24];case 1:c=e.sent(),l.diffuseTexture.name=c,e.label=2;case 2:return l.specularTexture&&l.specularTexture.texture_id?(h=l.specularTexture.texture_id,[4,ossfile.getUrl(w.Config.projectID,h,L.BabylonLoader.assetsData.assets[h].name,L.BabylonLoader.assetsData.assets[h].file.hash)]):[3,4];case 3:c=e.sent(),l.specularTexture.name=c,e.label=4;case 4:return l.reflectionTexture&&l.reflectionTexture.texture_id?(g=l.reflectionTexture.texture_id,[4,ossfile.getUrl(w.Config.projectID,g,L.BabylonLoader.assetsData.assets[g].name,L.BabylonLoader.assetsData.assets[g].file.hash)]):[3,6];case 5:c=e.sent(),l.reflectionTexture.name=c,e.label=6;case 6:return l.refractionTexture&&l.refractionTexture.texture_id?(d=l.refractionTexture.texture_id,[4,ossfile.getUrl(w.Config.projectID,d,L.BabylonLoader.assetsData.assets[d].name,L.BabylonLoader.assetsData.assets[d].file.hash)]):[3,8];case 7:c=e.sent(),l.refractionTexture.name=c,e.label=8;case 8:return l.emissiveTexture&&l.emissiveTexture.texture_id?(f=l.emissiveTexture.texture_id,[4,ossfile.getUrl(w.Config.projectID,f,L.BabylonLoader.assetsData.assets[f].name,L.BabylonLoader.assetsData.assets[f].file.hash)]):[3,10];case 9:c=e.sent(),l.emissiveTexture.name=c,e.label=10;case 10:return l.bumpTexture&&l.bumpTexture.texture_id?(p=l.bumpTexture.texture_id,[4,ossfile.getUrl(w.Config.projectID,p,L.BabylonLoader.assetsData.assets[p].name,L.BabylonLoader.assetsData.assets[p].file.hash)]):[3,12];case 11:c=e.sent(),l.bumpTexture.name=c,e.label=12;case 12:return l.opacityTexture&&l.opacityTexture.texture_id?(y=l.opacityTexture.texture_id,[4,ossfile.getUrl(w.Config.projectID,y,L.BabylonLoader.assetsData.assets[y].name,L.BabylonLoader.assetsData.assets[y].file.hash)]):[3,14];case 13:c=e.sent(),l.opacityTexture.name=c,e.label=14;case 14:return l.ambientTexture&&l.ambientTexture.texture_id?(b=l.ambientTexture.texture_id,[4,ossfile.getUrl(w.Config.projectID,b,L.BabylonLoader.assetsData.assets[b].name,L.BabylonLoader.assetsData.assets[b].file.hash)]):[3,16];case 15:c=e.sent(),l.ambientTexture.name=c,e.label=16;case 16:return l.lightmapTexture&&l.lightmapTexture.texture_id?(m=l.lightmapTexture.texture_id,[4,ossfile.getUrl(w.Config.projectID,m,L.BabylonLoader.assetsData.assets[m].name,L.BabylonLoader.assetsData.assets[m].file.hash)]):[3,18];case 17:c=e.sent(),l.lightmapTexture.name=c,e.label=18;case 18:return L.BabylonLoader.loadMaterial(l,VR.BabylonEngine.Scene,""),[3,20];case 19:console.warn("scene mesh warn"),e.label=20;case 20:return[3,22];case 21:console.warn("scene mesh warn"),e.label=22;case 22:return _=L.BabylonLoader.loadMesh(n,VR.BabylonEngine.Scene,""),v.node=_,x[v.get("resource_id")]=_,O(v,_),[3,24];case 23:console.warn("scene mesh warn"),e.label=24;case 24:return[2]}})})}}var T=e("../lib"),L=e("./babylonloader"),w=e("./config");r.Loader=n},{"../lib":12,"./babylonloader":1,"./config":2}],6:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.Scenes=void 0;function n(){}r.Scenes=n},{}],7:[function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),a=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||t.hasOwnProperty(r)||n(t,e,r)};Object.defineProperty(r,"__esModule",{value:!0}),a(e("./lib"),r),a(e("./game"),r)},{"./game":4,"./lib":12}],8:[function(e,t,r){"use strict";var n,a=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(r,"__esModule",{value:!0}),r.AjaxRequest=r.Ajax=void 0;var i=e("../lib"),l=(o.get=function(e){return new s({url:e})},o.post=function(e,t){return new s({method:"POST",url:e,data:t})},o.put=function(e,t){return new s({method:"PUT",url:e,data:t})},o.delete=function(e){return new s({method:"DELETE",url:e})},o.param=function(e,t){o.params[e]=t},o.params={},o);function o(e){return"string"==typeof e&&(e={url:e}),new s(e)}r.Ajax=l;var c,s=(c=i.Events,a(u,c),u.prototype._onLoad=function(){if(this._progress=1,this.emit("progress",1),200===this._xhr.status||201===this._xhr.status)if(this.notJson)this.emit("load",this._xhr.status,this._xhr.responseText);else{try{var e=JSON.parse(this._xhr.responseText)}catch(e){return void this.emit("error",this._xhr.status||0,new Error("invalid json"))}this.emit("load",this._xhr.status,e)}else try{var t=(e=JSON.parse(this._xhr.responseText)).message;t=(t=t||(e.error||e.response&&e.response.error))||this._xhr.responseText,this.emit("error",this._xhr.status,t)}catch(e){this.emit("error",this._xhr.status)}},u.prototype._onError=function(e){this.emit("error",0,e)},u.prototype._onAbort=function(e){this.emit("error",0,e)},u.prototype._onProgress=function(e){var t;!e.lengthComputable||(t=e.loaded/e.total)!==this._progress&&(this._progress=t,this.emit("progress",this._progress))},u.prototype.abort=function(){this._xhr.abort()},u);function u(e){var t=c.call(this)||this;if(t._progress=0,!e)throw new Error("ajax请求无参数，请检查！");t._progress=0,t.emit("progress",t._progress),t._xhr=new XMLHttpRequest,e.cookies&&(t._xhr.withCredentials=!0),t._xhr.addEventListener("load",t._onLoad.bind(t),!1),t._xhr.upload.addEventListener("progress",t._onProgress.bind(t),!1),t._xhr.addEventListener("error",t._onError.bind(t),!1),t._xhr.addEventListener("abort",t._onAbort.bind(t),!1);var r=e.url;if(e.query&&Object.keys(e.query).length){-1===r.indexOf("?")&&(r+="?");var n=[];for(s in e.query)n.push(s+"="+e.query[s]);r+=n.join("&")}var a=r.split("{{");if(1<a.length){for(var i=1;i<a.length;i++){var o=a[i].indexOf("}}"),s=a[i].slice(0,o);void 0!==l.params[s]&&(a[i]=l.params[s]+a[i].slice(o+2))}r=a.join("")}if(t._xhr.open(e.method||"GET",r,!0),t.notJson=e.notJson||!1,e.ignoreContentType||"PUT"!==e.method&&"POST"!==e.method&&"DELETE"!==e.method||t._xhr.setRequestHeader("Content-Type","application/json"),e.headers)for(var s in e.headers)t._xhr.setRequestHeader(s,e.headers[s]);return!e.data||"string"==typeof e.data||e.data instanceof FormData||(e.data=JSON.stringify(e.data)),t._xhr.send(e.data||null),t}r.AjaxRequest=s},{"../lib":12}],9:[function(e,t,r){"use strict";var n,a=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(r,"__esModule",{value:!0}),r.Editor=void 0;var i,o=e("./events"),s=(i=o.Events,a(l,i),l.prototype.method=function(e,t){if(void 0!==this._hooks[e])throw new Error("can't override hook: "+e);this._hooks[e]=t},l.prototype.methodRemove=function(e){delete this._hooks[e]},l.prototype.call=function(t){for(var e=[],r=1;r<arguments.length;r++)e[r-1]=arguments[r];if(this._hooks[t]){e=Array.prototype.slice.call(arguments,1);try{return this._hooks[t].apply(null,e)}catch(e){console.error("%c%s %c(editor.method error)","color: #06f",t,"color: #f00"),console.error(e.stack)}}return null},l);function l(){var e=i.call(this)||this;return e._hooks={},e}r.Editor=s},{"./events":10}],10:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.EventHandle=r.Events=void 0;var n=(Object.defineProperty(a.prototype,"suspendEvents",{get:function(){return this._suspendEvents},set:function(e){this._suspendEvents=e},enumerable:!1,configurable:!0}),a.prototype.on=function(e,t){var r=this._events[e];return void 0===r?this._events[e]=[t]:-1==r.indexOf(t)&&r.push(t),new i(this,e,t)},a.prototype.once=function(e,l){var c=this,u=this.on(e,function(e,t,r,n,a,i,o,s){l.call(c,e,t,r,n,a,i,o,s),u.unbind()});return u},a.prototype.emit=function(t,e,r,n,a,i,o,s,l){if(this._suspendEvents)return this;var c=this._events[t];if(!c)return this;c=c.slice(0);for(var u=0;u<c.length;u++)if(c[u])try{c[u].call(this,e,r,n,a,i,o,s,l)}catch(e){console.info("%c%s %c(event error)","color: #06f",t,"color: #f00"),console.log(e.stack)}return this},a.prototype.unbind=function(e,t){if(e){var r,n=this._events[e];if(!n)return this;t?-1!==(r=n.indexOf(t))&&(1===n.length?delete this._events[e]:n.splice(r,1)):delete this._events[e]}else this._events={};return this},a);function a(){this._suspendEvents=!1,this._events={}}r.Events=n;var i=(o.prototype.unbind=function(){this.owner&&(this.owner.unbind(this.name,this.fn),this.owner=null,this.name=null,this.fn=null)},o.prototype.call=function(){this.fn&&this.fn.call(this.owner,arguments[0],arguments[1],arguments[2],arguments[3],arguments[4],arguments[5],arguments[6],arguments[7])},o.prototype.on=function(e,t){return this.owner.on(e,t)},o);function o(e,t,r){this.owner=e,this.name=t,this.fn=r}r.EventHandle=i},{}],11:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.GUID=void 0;var n=(a.create=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)})},a);function a(){}r.GUID=n},{}],12:[function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),a=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||t.hasOwnProperty(r)||n(t,e,r)};Object.defineProperty(r,"__esModule",{value:!0}),a(e("./events"),r),a(e("./editor"),r),a(e("./observer"),r),a(e("./tools"),r),a(e("./guid"),r),a(e("./ajax"),r),a(e("./very-light"),r),a(e("./very-camera"),r)},{"./ajax":8,"./editor":9,"./events":10,"./guid":11,"./observer":13,"./tools":14,"./very-camera":15,"./very-light":16}],13:[function(e,t,r){"use strict";var n,a=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(r,"__esModule",{value:!0}),r.Observer=void 0;var i,o=e("./events"),s=(i=o.Events,a(l,i),Object.defineProperty(l.prototype,"className",{get:function(){return"Observer"},enumerable:!1,configurable:!0}),l.prototype.patchData=function(e){if("object"==typeof e)for(var t in e)"object"==typeof e[t]?this.parserObject(t,t,e[t]):(this.set(t,e[t]),this._dataType[t]=!1,this._dataType2[t]=!1);else debug.warn(this.className+": 不是正确的json对象，打印：\n"+e)},l.prototype.set=function(e,t){for(var r,n=this._data[e],a=e.split("."),i="",o=0;o<a.length-1;o++)0===o?i=a[o]:i+=this.SEPARATOR+a[o];1<a.length&&this._dataType[e]?(r=parseInt(a[a.length-1]),this._data[e]=t,this._data[i][r]=t):(this._data[e]=t,this.updateChildData(e,t),this._data2[e]=t),this.emit(e+":set",t,n),this.emit("*:set",e,t,n)},l.prototype.isNumber=function(e){var t=Number(e);return!isNaN(t)},l.prototype.updateChildData=function(e,t){if(t instanceof Array){for(var r in this._data)r.startsWith(e+this.SEPARATOR)&&(delete this._data[r],delete this._dataType[r]);for(var n,a=0;a<t.length;a++)n=e+this.SEPARATOR+a.toString(),this._data[n]=t[a],this._dataType[n]=!0}},l.prototype.unset=function(e,t){if(!this.has(e))return!1;var r=this._data[e];return delete this._data[e],delete this._dataType[e],delete this._data2[e],delete this._dataType2[e],this.emit(e+":set",t,r),this.emit("*:set",e,t,r),!0},l.prototype.insert=function(e,t,r){if(!(this.has(e)&&this._data[e]instanceof Array))return!1;var n=this._data[e];return t instanceof Array&&(t=t.slice(0)),void 0===r?(n.push(t),r=n.length-1):n.splice(r,0,t),this.updateChildData(e,n),this.emit(e+":insert",t,r),this.emit("*:insert",e,t,r),!0},l.prototype.remove=function(e,t){if(!(this.has(e)&&this._data[e]instanceof Array))return!1;var r=this._data[e];if(r.length<t)return!1;var n=r[t];return r.splice(t,1),this.updateChildData(e,r),this.emit(e+":remove",n,t),this.emit("*:remove",e,n,t),!0},l.prototype.removeValue=function(e,t){if(!(this.has(e)&&this._data[e]instanceof Array))return!1;var r=this._data[e],n=r.indexOf(t);if(-1===n)return!1;var a=r[n];return r.splice(n,1),this.updateChildData(e,r),this.emit(e+":remove",a,n),this.emit("*:remove",e,a,n),!0},l.prototype.move=function(e,t,r){if(!(this.has(e)&&this._data[e]instanceof Array))return!1;var n=this._data[e];if(n.length<t||n.length<r||t===r)return!1;var a=n[t];return n.splice(t,1),-1===r&&(r=n.length),n.splice(r,0,a),this.updateChildData(e,n),this.emit(e+":move",a,r,t),this.emit("*:move",e,a,r,t),!0},l.prototype.parserObject=function(e,t,r){var n;this.set(e,r),this._dataType[e]=!1;var a=typeof r;if("object"==a&&r instanceof Array){this._dataType2[e]=!0;for(var i=0;i<r.length;i++)n=e+this.SEPARATOR+i.toString(),this.set(n,r[i]),this._dataType[n]=!0}else if("object"==a&&r instanceof Object)for(var o in r)"object"==typeof r[o]?this.parserObject(e+this.SEPARATOR+o,o,r[o]):(n=e+this.SEPARATOR+o,this.set(n,r[o]),this._dataType[n]=!1,this._dataType2[e]=!1)},l.prototype.has=function(e){return e in this._data},l.prototype.get=function(e){return e in this._data?this._data[e]:null},l.prototype.propagate=function(i){var o=this;return function(e,t,r,n){var a;o._parent&&(!o._parentKey&&o._parentField instanceof Array&&-1===o._parentField.indexOf(o)||(o._silent&&(a=o._parent.silence()),o._parent.emit(e+":"+i,t,r,n),o._parent.emit("*:"+i,e,t,r,n),o._silent&&o._parent.silenceRestore(a)))}},l.prototype.destroy=function(){this._destroyed||(this._destroyed=!0,this.emit("destroy"),this.unbind())},l);function l(e,t){var r=i.call(this)||this;if(r.SEPARATOR=".",r._dataType={},r._dataType2={},r.node=null,r.reparenting=!1,r._pathsWithDuplicates={},r.origin=e,t=t||{},r._destroyed=!1,r._path="",r._keys=[],r._data={},r._data2={},t.pathsWithDuplicates){r._pathsWithDuplicates={};for(var n=0;n<t.pathsWithDuplicates.length;n++)r._pathsWithDuplicates[t.pathsWithDuplicates[n]]=!0}return r.patchData(e),r._silent=!1,r}r.Observer=s},{"./events":10}],14:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.Tools=void 0;var n=(a.eulerAngleToRadian=function(e){var t=Math.PI/180;return e.multiplyByFloats(t,t,t)},a.radianToEulerAngle=function(e){var t=180/Math.PI;return e.multiplyByFloats(t,t,t)},a.eulerAngleFloatToRadian=function(e){return e*Math.PI/180},a.radianFloatToEulerAngle=function(e){return 180*e/Math.PI},a.vector3ToArray=function(e){return[e.x,e.y,e.z]},a.quatTransfromVector3=function(e,t){var r=BABYLON.Vector3.Zero(),n=t.x,a=t.y,i=t.z,o=e.x,s=e.y,l=e.z,c=e.w,u=c*n+s*i-l*a,h=c*a+l*n-o*i,g=c*i+o*a-s*n,d=-o*n-s*a-l*i;return r.x=u*c+d*-o+h*-l-g*-s,r.y=h*c+d*-s+g*-o-u*-l,r.z=g*c+d*-l+u*-s-h*-o,r},a.quatMultiplyVector3=function(e,t){var r=2*e.x,n=2*e.y,a=2*e.z,i=e.x*r,o=e.y*n,s=e.z*a,l=e.x*n,c=e.x*a,u=e.y*a,h=e.w*r,g=e.w*n,d=e.w*a,f=BABYLON.Vector3.Zero();return f.x=(1-(o+s))*t.x+(l-d)*t.y+(c+g)*t.z,f.y=(l+d)*t.x+(1-(i+s))*t.y+(u-h)*t.z,f.z=(c-g)*t.x+(u+h)*t.y+(1-(i+o))*t.z,f},a.clampAngle=function(e,t,r){return e<-360&&(e+=360),360<e&&(e-=360),e<t?e=t:r<e&&(e=r),e},a.worldToScreenPoint=function(e,t,r,n){return BABYLON.Vector3.Project(e,BABYLON.Matrix.Identity(),t.getTransformMatrix(),r.viewport.toGlobal(n.getRenderWidth(),n.getRenderHeight()))},a.lerpVector2=function(e,t,r){var n=BABYLON.Vector2.Zero();return r<0&&(r=0),1<r&&(r=1),n.x=e.x+r*(t.x-e.x),n.y=e.y+r*(t.y-e.y),n},a.lerpVector3=function(e,t,r){var n=BABYLON.Vector3.Zero();return r<0&&(r=0),1<r&&(r=1),n.x=e.x+r*(t.x-e.x),n.y=e.y+r*(t.y-e.y),n.z=e.z+r*(t.z-e.z),n},a.lerpVector4=function(e,t,r){var n=BABYLON.Vector4.Zero();return r<0&&(r=0),1<r&&(r=1),n.x=e.x+r*(t.x-e.x),n.y=e.y+r*(t.y-e.y),n.z=e.z+r*(t.z-e.z),n.w=e.w+r*(t.w-e.w),n},a.transformLocalToWorldDirection=function(e,t){if(e){var r=e.computeWorldMatrix();return BABYLON.Vector3.TransformCoordinates(t,r).subtract(e.getAbsolutePosition())}return t},a.rgb2hsv=function(e){function t(e){return(u-e)/6/h+.5}var r,n,a,i,o=e[0]/255,s=e[1]/255,l=e[2]/255,c=0,u=Math.max(o,s,l),h=u-Math.min(o,s,l);return 0==h?c=i=0:(i=h/u,r=t(o),n=t(s),a=t(l),o===u?c=a-n:s===u?c=1/3+r-a:l===u&&(c=2/3+n-r),c<0?c+=1:1<c&&--c),[c,i,u]},a.hsv2rgb=function(e){var t=e[0],r=e[1],n=e[2],a=0,i=0,o=0,s=Math.floor(6*t),l=6*t-s,c=n*(1-r),u=n*(1-l*r),h=n*(1-(1-l)*r);switch(s%6){case 0:a=n,i=h,o=c;break;case 1:a=u,i=n,o=c;break;case 2:a=c,i=n,o=h;break;case 3:a=c,i=u,o=n;break;case 4:a=h,i=c,o=n;break;case 5:a=n,i=c,o=u}return[Math.round(255*a),Math.round(255*i),Math.round(255*o)]},a.rgba2hsvString=function(e){for(var t="#",r=0,n=(e=a.to255rgba(e)).length;r<n;r++){t+=("0"+e[r].toString(16)).slice(-2)}return t},a.hsvString2rgba=function(e){for(var t=[],r=1;r<e.length;r+=2)t.push(parseInt("0x"+e.slice(r,r+2)));return t=a.toSmallrgba(t)},a.to255rgba=function(e){var t=[];return e.forEach(function(e){t.push(255*e)}),t},a.toSmallrgba=function(e){var t=[];return e.forEach(function(e){t.push(e/255)}),t},a);function a(){}r.Tools=n},{}],15:[function(e,t,r){"use strict";var n,a=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(r,"__esModule",{value:!0}),r.VeryCamera=void 0;var i,o=(i=BABYLON.TransformNode,a(s,i),Object.defineProperty(s.prototype,"mode",{get:function(){return this.camera.mode},set:function(e){(this.camera.mode=e)===BABYLON.Camera.ORTHOGRAPHIC_CAMERA&&(this.orthoSize=this._orthoSize)},enumerable:!1,configurable:!0}),Object.defineProperty(s.prototype,"fov",{get:function(){return this.camera.fov},set:function(e){this.camera.fov=e},enumerable:!1,configurable:!0}),Object.defineProperty(s.prototype,"inertia",{get:function(){return this.camera.inertia},set:function(e){this.camera.inertia=e},enumerable:!1,configurable:!0}),Object.defineProperty(s.prototype,"orthoSize",{get:function(){return this.camera.mode===BABYLON.Camera.ORTHOGRAPHIC_CAMERA?(this._orthoSize=this.camera.orthoRight/this._scene.getEngine().getRenderWidth()/this.camera.viewport.width,this._orthoSize):0},set:function(e){this._orthoSize=e,this.camera.mode===BABYLON.Camera.ORTHOGRAPHIC_CAMERA&&(this.camera.orthoRight=e*this._scene.getEngine().getRenderWidth()*this.camera.viewport.width,this.camera.orthoLeft=-e*this._scene.getEngine().getRenderWidth()*this.camera.viewport.width,this.camera.orthoTop=e*this._scene.getEngine().getRenderHeight()*this.camera.viewport.height,this.camera.orthoBottom=-e*this._scene.getEngine().getRenderHeight()*this.camera.viewport.height)},enumerable:!1,configurable:!0}),Object.defineProperty(s.prototype,"clearColor",{get:function(){return null===this._clearColor&&(this._clearColor=new BABYLON.Color4(1,1,1,1)),this._clearColor.copyFrom(this._scene.clearColor),this._clearColor},set:function(e){this._clearColor=e,this._scene.activeCameras[0]===this.camera&&e&&this._scene.clearColor.copyFrom(e)},enumerable:!1,configurable:!0}),Object.defineProperty(s.prototype,"minZ",{get:function(){return this.camera.minZ},set:function(e){this.camera.minZ=e},enumerable:!1,configurable:!0}),Object.defineProperty(s.prototype,"maxZ",{get:function(){return this.camera.minZ},set:function(e){this.camera.maxZ=e},enumerable:!1,configurable:!0}),Object.defineProperty(s.prototype,"checkCollisions",{get:function(){return this.camera.checkCollisions},set:function(e){this.camera.checkCollisions=e},enumerable:!1,configurable:!0}),Object.defineProperty(s.prototype,"applyGravity",{get:function(){return this.camera.applyGravity},set:function(e){this.camera.applyGravity=e},enumerable:!1,configurable:!0}),s.prototype.renderCamera=function(e){this._render!==e&&((this._render=e)?this.camera.viewport=this._backupViewport.clone():(this._backupViewport=this.camera.viewport.clone(),this.camera.viewport=new BABYLON.Viewport(0,0,0,0)))},s.prototype.resize=function(e){var t,r;this.camera&&this._canvas&&(this._canvas.width===this._width&&this._canvas.height===this._height||(this._width=this._canvas.width,this._height=this._canvas.height,t=this._scene.getEngine().getRenderWidth(),r=this._scene.getEngine().getRenderHeight(),this.camera.mode===BABYLON.Camera.ORTHOGRAPHIC_CAMERA&&(this.camera.orthoRight=this._orthoSize*t*this.camera.viewport.width,this.camera.orthoLeft=-this._orthoSize*t*this.camera.viewport.width,this.camera.orthoTop=this._orthoSize*r*this.camera.viewport.height,this.camera.orthoBottom=-this._orthoSize*r*this.camera.viewport.height)))},s);function s(e,t,r){var n=i.call(this,e.name,t)||this;return n._orthoSize=0,n._clearColor=null,n._backupViewport=new BABYLON.Viewport(0,0,1,1),n._render=!0,(n.camera=e).name+="-Camera",n._canvas=r,n._width=r.width,n._height=r.height,n.position.copyFrom(e.position),n.rotation.copyFrom(e.rotation),e.parent=n,e.position=BABYLON.Vector3.Zero(),e.rotation=BABYLON.Vector3.Zero(),e.inputs.clear(),n}r.VeryCamera=o},{}],16:[function(e,t,r){"use strict";var n,a=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(r,"__esModule",{value:!0}),r.VeryLight=void 0;var i,o=(i=BABYLON.TransformNode,a(s,i),Object.defineProperty(s.prototype,"type",{get:function(){return this.light.getTypeID()},enumerable:!1,configurable:!0}),Object.defineProperty(s.prototype,"intensity",{get:function(){return this.light.intensity},set:function(e){this.light.intensity=e},enumerable:!1,configurable:!0}),Object.defineProperty(s.prototype,"diffuse",{get:function(){return this.light.diffuse},set:function(e){this.light.diffuse=e},enumerable:!1,configurable:!0}),Object.defineProperty(s.prototype,"specular",{get:function(){return this.light.specular},set:function(e){this.light.specular=e},enumerable:!1,configurable:!0}),Object.defineProperty(s.prototype,"angle",{get:function(){return this.light instanceof BABYLON.SpotLight?this.light.angle:0},set:function(e){this.light instanceof BABYLON.SpotLight&&(this.light.angle=e)},enumerable:!1,configurable:!0}),Object.defineProperty(s.prototype,"exponent",{get:function(){return this.light instanceof BABYLON.SpotLight?this.light.exponent:0},set:function(e){this.light instanceof BABYLON.SpotLight&&(this.light.exponent=e)},enumerable:!1,configurable:!0}),s);function s(e,t){var r=i.call(this,e.name,t)||this;return e.name+="-Light",r.light=e,r.position.copyFrom(e.getAbsolutePosition()),e.parent=r}r.VeryLight=o},{}],17:[function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),a=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||t.hasOwnProperty(r)||n(t,e,r)};Object.defineProperty(r,"__esModule",{value:!0});var i=e("./game"),o=e("./lib");a(e("./index"),r);var s,l=!1,c=!1;window.editor=new o.Editor;var u;window.location.pathname.substring(9);u=window.location.pathname.substring(9),i.Config.projectID=u,ossfile.login(u,document.referrer).then(function(e){"00000"===e.code?(i.Config.projectName=e.data,editor.call("getAssets")):console.error("load project error: "+e.message)}).catch(function(e){console.error("load project error: "),console.error(e)}),editor.method("getAssets",function(){ossfile.getJsonConfig(u,"assets").then(function(e){var t=JSON.parse(e);if(i.Config.assetsData=t,i.BabylonLoader.assetsData=t,editor.call("getScenes"),t.assets)for(var r in t.assets)"table"===t.assets[r].type&&(i.Config.tableAssetsID=r,i.Config.tableName=t.assets[r].name);""!==i.Config.tableAssetsID?editor.call("loadTable"):l=!0}).catch(function(e){console.error(e)})}),editor.method("getScenes",function(){ossfile.getJsonConfig(u,"scenes").then(function(e){var t=JSON.parse(e),r=t.last;i.Config.scenesData=t.scenes[r],i.Config.sceneIndex=r,i.Config.sceneName=i.Config.scenesData.name,document.title=i.Config.projectName+" - "+i.Config.sceneName+" - 万维引擎",c=!0}).catch(function(e){console.error(e)})}),editor.method("loadTable",function(){ossfile.getJsonAsset(u,i.Config.tableAssetsID,"table").then(function(e){var t=JSON.parse(e),r=function(e){var t=document.createElement("div");t.innerHTML=e;var r=t.innerText||t.textContent;return t=null,r}(r=JSON.stringify(t));s=JSON.parse(r).table,i.Config.tableData=s,l=!0}).catch(function(e){console.log("load error: "+e)})}),function e(){var t,r;l&&c?(t=document.getElementById("renderCanvas"),r=document.getElementById("fpsLabel"),null!==t&&null!==r&&new i.Game(t,r).createScene(s).animate()):setTimeout(e,500)}()},{"./game":4,"./index":7,"./lib":12}]},{},[17]);
//# sourceMappingURL=publish.js.map
