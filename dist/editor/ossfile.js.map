{"version":3,"sources":["../../node_modules/_browser-pack@6.1.0@browser-pack/_prelude.js","ajax.ts","events.ts","ossfile.ts","out.ts"],"names":["f","exports","module","define","amd","window","global","self","this","ossfile","r","e","n","t","o","i","c","require","u","a","Error","code","p","call","length","1","events_1","Ajax","get","url","AjaxRequest","post","data","method","put","delete","param","name","value","params","args","_super","Events","__extends","prototype","_onLoad","_progress","emit","_xhr","status","notJson","responseText","json","JSON","parse","ex","msg","message","error","response","_onError","evt","_onAbort","_onProgress","progress","lengthComputable","loaded","total","abort","_this","XMLHttpRequest","cookies","withCredentials","addEventListener","bind","upload","query","Object","keys","indexOf","key","push","join","parts","split","ends","slice","undefined","open","ignoreContentType","setRequestHeader","headers","FormData","stringify","send","defineProperty","_suspendEvents","val","on","fn","events","_events","EventHandle","once","arg0","arg1","arg2","arg3","arg4","arg5","arg6","arg7","unbind","console","info","log","stack","splice","owner","arguments","getSuffix","fileName","nameSplit","ajax_1","uploadFile","file","projectId","assetId","hash","__awaiter","Promise","resolve","reject","form","append","Accept","uploadJsonAsset","assetStr","mode","axios","jsonName","jsonStr","_a","sent","e_1","getJsonAsset","e_2","getUrl","getThumbnailUrl","donwLoad","document","createElement","innerHTML","download","href","body","appendChild","createEvent","initEvent","dispatchEvent","removeChild","upLoadJsonConfig","projectID","e_3","getJsonConfig","e_4","login","refer","e_5","ossfile_1"],"mappings":"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","file":"ossfile.js","sourcesContent":["(function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c=\"function\"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error(\"Cannot find module '\"+i+\"'\");throw a.code=\"MODULE_NOT_FOUND\",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u=\"function\"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()","import { Events } from \"./events\";\r\n\r\nexport class Ajax {\r\n\r\n    public constructor(args: object | string) {\r\n        if (typeof (args) === 'string')\r\n            args = { url: args };\r\n\r\n        return new AjaxRequest(args);\r\n    }\r\n\r\n    public static get(url: string): AjaxRequest {\r\n        return new AjaxRequest({ url: url });\r\n    }\r\n\r\n    public static post(url: string, data: any): AjaxRequest {\r\n        return new AjaxRequest({\r\n            method: 'POST',\r\n            url: url,\r\n            data: data\r\n        });\r\n    }\r\n\r\n    public static put(url: string, data: any): AjaxRequest {\r\n        return new AjaxRequest({\r\n            method: 'PUT',\r\n            url: url,\r\n            data: data\r\n        });\r\n    }\r\n\r\n    public static delete(url: string): AjaxRequest {\r\n        return new AjaxRequest({\r\n            method: 'DELETE',\r\n            url: url\r\n        });\r\n    }\r\n\r\n    public static params: { [key: string]: any } = {};\r\n\r\n    public static param(name: string, value: any): void {\r\n        Ajax.params[name] = value;\r\n    }\r\n\r\n}\r\n\r\n\r\nexport class AjaxRequest extends Events {\r\n\r\n    private _progress: number = 0;\r\n\r\n    private _xhr: XMLHttpRequest;\r\n\r\n    public notJson: boolean;\r\n\r\n    public constructor(args: any) {\r\n        super();\r\n\r\n        if (!args) {\r\n            throw new Error('ajax请求无参数，请检查！')\r\n        }\r\n\r\n        this._progress = 0.0;\r\n        this.emit('progress', this._progress);\r\n\r\n        this._xhr = new XMLHttpRequest();\r\n\r\n        // send cookies\r\n        if (args.cookies)\r\n            this._xhr.withCredentials = true;\r\n\r\n        // events\r\n        this._xhr.addEventListener('load', this._onLoad.bind(this), false);\r\n        // this._xhr.addEventListener('progress', this._onProgress.bind(this), false);\r\n        this._xhr.upload.addEventListener('progress', this._onProgress.bind(this), false);\r\n        this._xhr.addEventListener('error', this._onError.bind(this), false);\r\n        this._xhr.addEventListener('abort', this._onAbort.bind(this), false);\r\n\r\n        // url\r\n        let url: string = args.url;\r\n\r\n        // query\r\n        if (args.query && Object.keys(args.query).length) {\r\n            if (url.indexOf('?') === -1) {\r\n                url += '?';\r\n            }\r\n\r\n            var query = [];\r\n            for (var key in args.query) {\r\n                query.push(key + '=' + args.query[key]);\r\n            }\r\n\r\n            url += query.join('&');\r\n        }\r\n\r\n        // templating\r\n        var parts = url.split('{{');\r\n        if (parts.length > 1) {\r\n            for (var i = 1; i < parts.length; i++) {\r\n                var ends = parts[i].indexOf('}}');\r\n                var key = parts[i].slice(0, ends);\r\n\r\n                if (Ajax.params[key] === undefined)\r\n                    continue;\r\n\r\n                // replace\r\n                parts[i] = Ajax.params[key] + parts[i].slice(ends + 2);\r\n            }\r\n\r\n            url = parts.join('');\r\n        }\r\n\r\n        // open request\r\n        this._xhr.open(args.method || 'GET', url, true);\r\n\r\n        // 返回数据是否为json格式\r\n        this.notJson = args.notJson || false;\r\n\r\n        // header for PUT/POST\r\n        if (!args.ignoreContentType && (args.method === 'PUT' || args.method === 'POST' || args.method === 'DELETE'))\r\n            this._xhr.setRequestHeader('Content-Type', 'application/json');\r\n\r\n        // TODO: 权限header参数\r\n        // if (args.auth && config.accessToken) {\r\n        //     this._xhr.setRequestHeader('Authorization', 'Bearer ' + config.accessToken);\r\n        // }\r\n\r\n        if (args.headers) {\r\n            for (var key in args.headers)\r\n                this._xhr.setRequestHeader(key, args.headers[key]);\r\n        }\r\n\r\n        // stringify data if needed\r\n        if (args.data && typeof (args.data) !== 'string' && !(args.data instanceof FormData)) {\r\n            args.data = JSON.stringify(args.data);\r\n        }\r\n\r\n        // make request\r\n        this._xhr.send(args.data || null);\r\n    }\r\n\r\n    private _onLoad(): void {\r\n        this._progress = 1.0;\r\n        this.emit('progress', 1.0);\r\n\r\n        if (this._xhr.status === 200 || this._xhr.status === 201) {\r\n            if (this.notJson) {\r\n                this.emit('load', this._xhr.status, this._xhr.responseText);\r\n            } else {\r\n                try {\r\n                    var json = JSON.parse(this._xhr.responseText);\r\n                } catch (ex) {\r\n                    this.emit('error', this._xhr.status || 0, new Error('invalid json'));\r\n                    return;\r\n                }\r\n                this.emit('load', this._xhr.status, json);\r\n            }\r\n        } else {\r\n            try {\r\n                var json = JSON.parse(this._xhr.responseText);\r\n                var msg = json.message;\r\n                if (!msg) {\r\n                    msg = json.error || (json.response && json.response.error);\r\n                }\r\n\r\n                if (!msg) {\r\n                    msg = this._xhr.responseText;\r\n                }\r\n\r\n                this.emit('error', this._xhr.status, msg);\r\n            } catch (ex) {\r\n                this.emit('error', this._xhr.status);\r\n            }\r\n        }\r\n    }\r\n\r\n    private _onError(evt: any): void {\r\n        this.emit('error', 0, evt);\r\n    }\r\n\r\n    private _onAbort(evt: any): void {\r\n        this.emit('error', 0, evt);\r\n    }\r\n\r\n    private _onProgress(evt: any): void {\r\n        if (!evt.lengthComputable)\r\n            return;\r\n\r\n        var progress = evt.loaded / evt.total;\r\n\r\n        if (progress !== this._progress) {\r\n            this._progress = progress;\r\n            this.emit('progress', this._progress);\r\n        }\r\n    }\r\n\r\n    public abort(): void {\r\n        this._xhr.abort();\r\n    }\r\n\r\n\r\n}","export class Events {\r\n\r\n    // 相较于Editor，同一个函数名可包含一系列函数，不仅仅是一个，且有once功能；\r\n  \r\n    public get suspendEvents(): boolean {\r\n      return this._suspendEvents;\r\n    }\r\n    public set suspendEvents(val: boolean) {\r\n      this._suspendEvents = val;\r\n    }\r\n    private _suspendEvents: boolean = false;\r\n  \r\n    // 某个name对应的事件数组，name与Function是1对多的关系；\r\n    private _events: { [key: string]: Function[] } = {};\r\n  \r\n    public constructor() {\r\n  \r\n    }\r\n  \r\n    /**\r\n     * 添加事件数组，若name相同，则在数组末尾继续添加；\r\n     * @param name 函数名；\r\n     * @param fn 函数本体；\r\n     */\r\n    public on(name: string, fn: Function): EventHandle {\r\n      let events: Function[] = this._events[name];\r\n      if (events === undefined) {\r\n        this._events[name] = [fn];\r\n      } else {\r\n        if (events.indexOf(fn) == -1) {\r\n          events.push(fn);\r\n        }\r\n      }\r\n      return new EventHandle(this, name, fn);\r\n    }\r\n  \r\n    /**\r\n     * emit后只执行一次；\r\n     * @param name 函数名；\r\n     * @param fn 函数本体；\r\n     */\r\n    public once(name: string, fn: Function): EventHandle {\r\n      let self = this;\r\n      let evt: EventHandle = this.on(name, function (\r\n        arg0: any,\r\n        arg1: any,\r\n        arg2: any,\r\n        arg3: any,\r\n        arg4: any,\r\n        arg5: any,\r\n        arg6: any,\r\n        arg7: any\r\n      ) {\r\n        fn.call(self, arg0, arg1, arg2, arg3, arg4, arg5, arg6, arg7);\r\n        evt.unbind();\r\n      });\r\n      return evt;\r\n    }\r\n  \r\n    /**\r\n     * 执行事件；\r\n     * @param name 函数名；\r\n     * @param arg0 函数参数1，可选；\r\n     * @param arg1 函数参数2，可选；\r\n     * @param arg2 函数参数3，可选；\r\n     * @param arg3 函数参数4，可选；\r\n     * @param arg4 函数参数5，可选；\r\n     * @param arg5 函数参数6，可选；\r\n     * @param arg6 函数参数7，可选；\r\n     * @param arg7 函数参数8，可选；\r\n     */\r\n    public emit(name: string,\r\n      arg0?: any,\r\n      arg1?: any,\r\n      arg2?: any,\r\n      arg3?: any,\r\n      arg4?: any,\r\n      arg5?: any,\r\n      arg6?: any,\r\n      arg7?: any\r\n    ): Events {\r\n      if (this._suspendEvents) return this;\r\n  \r\n      let events: Function[] = this._events[name];\r\n      if (!events) return this;\r\n  \r\n      // 返回新数组\r\n      events = events.slice(0);\r\n  \r\n      for (let i: number = 0; i < events.length; i++) {\r\n        if (!events[i]) continue;\r\n        try {\r\n          events[i].call(this, arg0, arg1, arg2, arg3, arg4, arg5, arg6, arg7);\r\n        } catch (ex) {\r\n          console.info(\"%c%s %c(event error)\", \"color: #06f\", name, \"color: #f00\");\r\n          console.log(ex.stack);\r\n        }\r\n      }\r\n  \r\n      return this;\r\n    };\r\n  \r\n    /**\r\n     * 取消Events事件绑定，若name为空，则清空events；\r\n     * @param name 函数名；\r\n     * @param fn 函数本体；\r\n     */\r\n    public unbind(name?: string, fn?: Function): Events {\r\n      if (name) {\r\n        let events: Function[] = this._events[name];\r\n        if (!events) return this;\r\n  \r\n        if (fn) {\r\n          let i: number = events.indexOf(fn);\r\n          if (i !== -1) {\r\n            if (events.length === 1) {\r\n              delete this._events[name];\r\n            } else {\r\n              events.splice(i, 1);\r\n            }\r\n          }\r\n        } else {\r\n          delete this._events[name];\r\n        }\r\n      } else {\r\n        this._events = {};\r\n      }\r\n  \r\n      return this;\r\n    };\r\n  \r\n  }\r\n  \r\n  \r\n  export class EventHandle {\r\n  \r\n    public name: Nullable<string>;\r\n  \r\n    public owner: Nullable<Events>;\r\n  \r\n    public fn: Nullable<Function>;\r\n  \r\n    public constructor(owner: Events, name: string, fn: Function) {\r\n      this.owner = owner;\r\n      this.name = name;\r\n      this.fn = fn;\r\n    }\r\n  \r\n    public unbind(): void {\r\n      if (!this.owner) return;\r\n  \r\n      this.owner.unbind(this.name!, this.fn!);\r\n  \r\n      this.owner = null;\r\n      this.name = null;\r\n      this.fn = null;\r\n    }\r\n  \r\n    public call(): void {\r\n      if (!this.fn) return;\r\n  \r\n      this.fn.call(\r\n        this.owner!,\r\n        arguments[0],\r\n        arguments[1],\r\n        arguments[2],\r\n        arguments[3],\r\n        arguments[4],\r\n        arguments[5],\r\n        arguments[6],\r\n        arguments[7]\r\n      );\r\n    }\r\n  \r\n    public on(name: string, fn: Function): EventHandle {\r\n      return this.owner!.on(name, fn);\r\n    }\r\n  \r\n  }","\r\nimport { Ajax, AjaxRequest } from './ajax';\r\nlet getSuffix=function(fileName:string){\r\n    if(fileName){\r\n        let nameSplit=fileName.split('.');\r\n        if(nameSplit.length>1)\r\n            return nameSplit[1];\r\n        else\r\n            return fileName;\r\n    }\r\n    else{\r\n        return \"\";\r\n    }\r\n}\r\n\r\n/**\r\n * 上传文件\r\n * @param file 要上传的文件\r\n * @param projectId 软件id\r\n * @param assetId  文件的assetId\r\n * @param fileName  文件名\r\n * @param hash  文件hash值，若为undefined版本控制通过version序号实现\r\n */\r\nexport let uploadFile=async(file:File,projectId:string,assetId:string,fileName:string,hash?:string)=>{\r\n    return new Promise<string>(async (resolve,reject) => {\r\n        try{\r\n            var form = new FormData();\r\n            form.append('file',file);\r\n            form.append('fileName',assetId+\".\"+getSuffix(fileName));\r\n            var data = {\r\n                url: \"/api/uploadFile\",\r\n                method: 'PUT',\r\n                // auth: true,\r\n                data: form,\r\n                ignoreContentType: true,\r\n                headers: {\r\n                    Accept: 'application/json'\r\n                }\r\n            };\r\n\r\n            (<AjaxRequest>new Ajax(data)).on('load', (status: any, data: any) => {\r\n                resolve();\r\n            });\r\n            \r\n        }\r\n        catch(e){\r\n            reject(e);\r\n        }\r\n    })\r\n}\r\n\r\nlet isImage=function(fileName:string){\r\n    if(fileName.endsWith('.jpg')||fileName.endsWith('.png')||fileName.endsWith('jpeg')||fileName.endsWith('gif')){\r\n        return true;\r\n    }\r\n    else{\r\n        return false;\r\n    }\r\n}\r\n\r\n/**\r\n * 上传assetStr\r\n * @param assetStr 要上传的assetStr内容\r\n * @param projectId 软件id\r\n * @param assetId  assetStr的assetId\r\n * @param fileName  assetStr名\r\n * @param mode  若为true:本地保存的同时同步到服务器上；false:只在本地缓存\r\n * @ignore mode为true时,assetJosn可为undefined,读取本地缓存同步到服务器\r\n */\r\nexport let uploadJsonAsset=async(assetStr:string,projectId:string,assetId:string,fileName:string,mode:boolean=true)=>{\r\n    return new Promise<string>(async (resolve,reject) => {\r\n        try{\r\n            let response =await axios.post('/api/uploadJsonAsset', { jsonName:assetId+'.'+getSuffix(fileName),jsonStr:assetStr});\r\n            var data = response.data;\r\n            if (data.code === '0000') {\r\n                resolve(data.data);\r\n            }\r\n            else{\r\n                reject(data.message);\r\n            }\r\n        }\r\n        catch(e){\r\n            reject(e);\r\n        }\r\n    })\r\n}\r\n\r\n/**\r\n * 获取asset json\r\n * @param projectId 软件id\r\n * @param assetId  assetStr的assetId\r\n * @param fileName  assetStr名\r\n * @param hash  assetStr的hash值，若为undefined，版本控制按version序号处理\r\n */\r\n\r\nexport let getJsonAsset = async (projectId:string,assetId:string,fileName:string,hash?:string) => {\r\n    return new Promise<string>(async (resolve, reject) => {\r\n        try{\r\n            let response =await axios.post('/api/getJsonAsset', { jsonName:(assetId+\".\"+getSuffix(fileName)) });\r\n            var data = response.data;\r\n            if (data.code === '0000') {\r\n                resolve(data.data);\r\n            }\r\n            else{\r\n                reject(data.message);\r\n            }\r\n        }\r\n        catch(e){\r\n            reject(e);\r\n        }\r\n    });\r\n}\r\nlet urls:any={};\r\n\r\n\r\n/**\r\n * 获取文件的网址\r\n */\r\nexport let getUrl=async (projectId:string,assetId:string,fileName:string,hash:string) => {\r\n    return new Promise<string>(async (resolve, reject) => {\r\n        resolve(\"/assets/\"+assetId+\".\"+getSuffix(fileName));\r\n    })\r\n}\r\n\r\n/**\r\n * 获取图文缩略图的网址\r\n */\r\nexport let getThumbnailUrl=async (projectId:string,assetId:string,fileName:string,hash:string) => {\r\n    return new Promise<string>(async (resolve, reject) => {\r\n        resolve(\"/assets/\"+assetId+\".\"+getSuffix(fileName));\r\n    })\r\n}\r\n\r\n\r\n/**\r\n * 下载asset内容\r\n */\r\nexport let donwLoad=async(projectId:string,assetId:string,fileName:string,hash:string)=>{\r\n    let url=await getUrl(projectId,assetId,fileName,hash);\r\n    var a = document.createElement('a');\r\n    a.innerHTML = fileName;\r\n\r\n    // 指定生成的文件名\r\n    a.download = fileName;\r\n    a.href = url;\r\n\r\n    document.body.appendChild(a);\r\n\r\n    var evt = document.createEvent(\"MouseEvents\");\r\n    evt.initEvent(\"click\", false, false);\r\n\r\n    a.dispatchEvent(evt);\r\n\r\n    document.body.removeChild(a);\r\n}\r\n\r\n\r\n/**\r\n * 上传json的配置文件\r\n * @param josnStr 配置文件的string内容\r\n * @param projectId  项目id\r\n * @param jsonName  json名，不需要后缀\r\n */\r\nexport let upLoadJsonConfig = async (jsonStr: string, projectId: string,jsonName:string) => {\r\n    return new Promise<string>(async (resolve,reject) => {\r\n        try{\r\n            let response =await axios.post('/api/uploadJsonConfig', { projectID: projectId,jsonName:jsonName,jsonStr:jsonStr});\r\n            var data = response.data;\r\n            if (data.code === '0000') {\r\n                resolve(data.data);\r\n            }\r\n            else{\r\n                reject(data.message);\r\n            }\r\n        }\r\n        catch(e){\r\n            reject(e);\r\n        }\r\n    })\r\n}\r\n\r\n\r\n/**\r\n * 获取json的配置文件\r\n * @param projectId  项目id\r\n * @param jsonName  json名，不需要后缀\r\n */\r\nexport let getJsonConfig = async (projectID: string, jsonName:string) => {\r\n    return new Promise<string>(async (resolve, reject) => {\r\n        try{\r\n            let response =await axios.post('/api/getJsonConfig', { projectID: projectID,jsonName:jsonName });\r\n            var data = response.data;\r\n            if (data.code === '0000') {\r\n                resolve(data.data);\r\n            }\r\n            else{\r\n                reject(data.message);\r\n            }\r\n        }\r\n        catch(e){\r\n            reject(e);\r\n        }\r\n    });\r\n}\r\n\r\n\r\nexport let login=async(projectID:string,refer:string)=>{\r\n    return new Promise<any>(async (resolve, reject) => {\r\n        try{\r\n            let response =await axios.post(\"/api/getProject\",{ projectID: projectID});\r\n            var data = response.data;\r\n            if (data.code === '0000') {\r\n                let r:any={};\r\n                r.code=\"00000\";\r\n                r.data=data.data;\r\n                resolve(r);\r\n            }\r\n            else{\r\n                reject(data.message);\r\n            }\r\n        }\r\n        catch(e){\r\n            reject(e);\r\n        }\r\n\r\n    });\r\n\r\n}","import {getJsonAsset,getJsonConfig,uploadFile,upLoadJsonConfig,uploadJsonAsset,getUrl,getThumbnailUrl} from \"./ossfile\";\r\nmodule.exports={\r\n    getJsonAsset:getJsonAsset,\r\n    getJsonConfig:getJsonConfig,\r\n    uploadFile:uploadFile,\r\n    getUrl:getUrl,\r\n    upLoadJsonConfig:upLoadJsonConfig,\r\n    uploadJsonAsset:uploadJsonAsset,\r\n    getThumbnailUrl:getThumbnailUrl\r\n}"]}