{"version":3,"sources":["node_modules/_browser-pack@6.1.0@browser-pack/_prelude.js","node_modules/_process@0.11.10@process/browser.js","node_modules/_spark-md5@3.0.1@spark-md5/spark-md5.js","node_modules/_timers-browserify@1.4.2@timers-browserify/main.js","src/editor/Initialize-data.ts","src/editor/assets/assets-context-menu.ts","src/editor/assets/assets-create-folder.ts","src/editor/assets/assets-create-table.ts","src/editor/assets/assets-drop.ts","src/editor/assets/assets-filter.ts","src/editor/assets/assets-fs.ts","src/editor/assets/assets-panel-control.ts","src/editor/assets/assets-panel.ts","src/editor/assets/assets-preview.ts","src/editor/assets/assets-rename.ts","src/editor/assets/assets-store.ts","src/editor/assets/assets-sync.ts","src/editor/assets/assets-upload.ts","src/editor/assets/assets.ts","src/editor/assets/index.ts","src/editor/assets/keeper.ts","src/editor/attributes/assets/attributes-assets-texture.ts","src/editor/attributes/attributes-assets.ts","src/editor/attributes/attributes-entity.ts","src/editor/attributes/attributes-history.ts","src/editor/attributes/attributes-panel.ts","src/editor/attributes/attributes-reference.ts","src/editor/attributes/components/attributes-component-camera.ts","src/editor/attributes/components/attributes-component-gui.ts","src/editor/attributes/components/attributes-component-light.ts","src/editor/attributes/index.ts","src/editor/attributes/keeper.ts","src/editor/camera/camera-depth.ts","src/editor/camera/camera-preview.ts","src/editor/camera/camera-userdata.ts","src/editor/camera/camera-viewport.ts","src/editor/camera/cameras.ts","src/editor/camera/index.ts","src/editor/camera/keeper.ts","src/editor/drop.ts","src/editor/editor.ts","src/editor/entity/entities.ts","src/editor/entity/entity-create.ts","src/editor/entity/entity-delete.ts","src/editor/entity/entity-edit.ts","src/editor/entity/entity-load.ts","src/editor/entity/entity-sync.ts","src/editor/entity/entity.ts","src/editor/entity/index.ts","src/editor/entity/keeper.ts","src/editor/gizmos/UtilityLayerRenderer.ts","src/editor/gizmos/axisDragGizmo.ts","src/editor/gizmos/axisScaleGizmo.ts","src/editor/gizmos/boundingBoxGizmo.ts","src/editor/gizmos/cameraGizmo.ts","src/editor/gizmos/gizmo-center.ts","src/editor/gizmos/gizmo.ts","src/editor/gizmos/gizmoManager.ts","src/editor/gizmos/index.ts","src/editor/gizmos/lightGizmo.ts","src/editor/gizmos/planeDragGizmo.ts","src/editor/gizmos/planeRotationGizmo.ts","src/editor/gizmos/positionGizmo.ts","src/editor/gizmos/rotationGizmo.ts","src/editor/gizmos/scaleGizmo.ts","src/editor/global/config.ts","src/editor/global/index.ts","src/editor/gui/gui-manager.ts","src/editor/gui/index.ts","src/editor/gui/keeper.ts","src/editor/hierarchy/hierarchy-context-menu.ts","src/editor/hierarchy/hierarchy-control.ts","src/editor/hierarchy/hierarchy-menu.ts","src/editor/hierarchy/hierarchy-panel.ts","src/editor/hierarchy/hierarchy-search.ts","src/editor/hierarchy/index.ts","src/editor/hierarchy/keeper.ts","src/editor/hotkeys.ts","src/editor/index.ts","src/editor/initialize-after.ts","src/editor/initialize-before.ts","src/editor/layout.ts","src/editor/localstorage.ts","src/editor/middleware/component.ts","src/editor/middleware/gameobject.ts","src/editor/middleware/index.ts","src/editor/middleware/loader/babylonLoader.ts","src/editor/middleware/resource-container.ts","src/editor/middleware/transform.ts","src/editor/middleware/very-camera.ts","src/editor/middleware/very-light.ts","src/editor/pickers/index.ts","src/editor/pickers/keeper.ts","src/editor/pickers/picker-asset.ts","src/editor/pickers/picker-color.ts","src/editor/scenes/index.ts","src/editor/scenes/keeper.ts","src/editor/scenes/scenes.ts","src/editor/search.ts","src/editor/selector/index.ts","src/editor/selector/selector-history.ts","src/editor/selector/selector.ts","src/editor/settings/index.ts","src/editor/settings/keeper.ts","src/editor/settings/settings-attribute.ts","src/editor/toolbar/index.ts","src/editor/toolbar/keeper.ts","src/editor/toolbar/toolbar-camera.ts","src/editor/toolbar/toolbar-control.ts","src/editor/toolbar/toolbar-editor-settings.ts","src/editor/toolbar/toolbar-gizmos.ts","src/editor/toolbar/toolbar-help.ts","src/editor/toolbar/toolbar-history.ts","src/editor/toolbar/toolbar-logo.ts","src/editor/toolbar/toolbar-publish.ts","src/editor/toolbar/toolbar-scene.ts","src/editor/toolbar/toolbar-status.ts","src/editor/toolbar/toolbar-top-control.ts","src/editor/utility/ajax.ts","src/editor/utility/components-logos.ts","src/editor/utility/context-menu.ts","src/editor/utility/debug.ts","src/editor/utility/eventproxy.ts","src/editor/utility/guid.ts","src/editor/utility/index.ts","src/editor/utility/sha1.ts","src/editor/utility/tools.ts","src/editor/utility/uuid.ts","src/editor/viewport/index.ts","src/editor/viewport/keeper.ts","src/editor/viewport/viewport-application.ts","src/editor/viewport/viewport-drop-model.ts","src/editor/viewport/viewport-entities-observer-binding.ts","src/editor/viewport/viewport-expand.ts","src/editor/viewport/viewport-instance-create.ts","src/editor/viewport/viewport-tap.ts","src/editor/viewport/viewport.ts","src/engine/application.ts","src/engine/babylon-engine.ts","src/engine/index.ts","src/engine/very-engine.ts","src/index.ts","src/lib/events.ts","src/lib/index.ts","src/lib/observer-list.ts","src/lib/observer-sync.ts","src/lib/observer.ts","src/main.ts","src/tools/ajax.ts","src/tools/events.ts","src/tools/ossfile.ts","src/ui/bubble.ts","src/ui/button.ts","src/ui/canvas.ts","src/ui/checkbox.ts","src/ui/code.ts","src/ui/color-field.ts","src/ui/container-element.ts","src/ui/element.ts","src/ui/grid-item.ts","src/ui/grid.ts","src/ui/image-field.ts","src/ui/index.ts","src/ui/label.ts","src/ui/link.ts","src/ui/list-item.ts","src/ui/list.ts","src/ui/menu-item.ts","src/ui/menu.ts","src/ui/number-field.ts","src/ui/overlay.ts","src/ui/panel.ts","src/ui/progress.ts","src/ui/select-field.ts","src/ui/slider.ts","src/ui/text-field.ts","src/ui/textarea-field.ts","src/ui/tooltip.ts","src/ui/top/index.ts","src/ui/top/top-element-container.ts","src/ui/top/top-element-panel.ts","src/ui/top/top-element.ts","src/ui/tree-item.ts","src/ui/tree.ts"],"names":["r","e","n","t","o","i","f","c","require","u","a","Error","code","p","exports","call","length","1","module","cachedSetTimeout","cachedClearTimeout","process","defaultSetTimout","defaultClearTimeout","runTimeout","fun","setTimeout","this","clearTimeout","currentQueue","queue","draining","queueIndex","cleanUpNextTick","concat","drainQueue","timeout","len","run","marker","runClearTimeout","Item","array","noop","nextTick","args","Array","arguments","push","prototype","apply","title","browser","env","argv","version","versions","on","addListener","once","off","removeListener","removeAllListeners","emit","prependListener","prependOnceListener","listeners","name","binding","cwd","chdir","dir","umask","factory","define","amd","glob","window","self","SparkMD5","undefined","hex_chr","md5cycle","x","k","b","d","md5blk","s","md5blks","charCodeAt","md5blk_array","md51","tail","tmp","lo","hi","state","substring","toString","match","parseInt","hex","j","rhex","join","clamp","val","Math","max","min","toUtf8","str","test","unescape","encodeURIComponent","hexToBinaryString","bytes","substr","String","fromCharCode","reset","add32","ArrayBuffer","slice","from","to","num","target","targetArray","sourceArray","byteLength","begin","end","Uint8Array","set","append","appendBinary","contents","_buff","_length","_hash","raw","ret","buff","_finish","getState","hash","setState","destroy","hashBinary","content","arr","first","second","returnUInt8Array","result","buffer","subarray","utf8Str2ArrayBuffer","md51_array","Function","immediateIds","nextImmediateId","Timeout","id","clearFn","_id","_clearFn","setInterval","clearInterval","close","unref","ref","enroll","item","msecs","_idleTimeoutId","_idleTimeout","unenroll","_unrefActive","active","_onTimeout","setImmediate","fn","clearImmediate","InitializeData","_this","init","__awaiter","global_1","Config","projectID","location","pathname","refer","document","referrer","ossfile_1","login","data","_a","sent","projectName","editor","getJsonConfig","tmpStr","upLoadJsonConfig","assetStandard","assetsData","JSON","parse","babylonLoader_1","BabylonLoader","sceneStandard","sceneData","uuid_1","UUid","createUuid","createdTime","createdAtTime","stringify","tmpData","lastScene","last","scenesData","scenes","sceneIndex","console","error","message","error_1","AssetsContextMenu","currentAsset","root","engine_1","VeryEngine","customMenuItems","menu","ui_1","Menu","menuItemNewScript","MenuItem","text","icon","value","filename","boilerplate","menuItemNew","icons","upload","folder","table","cubemap","html","json","layers","material","script","shader","texture","textureatlas","model","scene","animation","audio","bundle","ICONS","assets","keys","Object","hasOwnProperty","key","get","parent","repositories","disabled","addNewMenuItem","menuItemReplace","menuItemEdit","menuItemDuplicate","menuItemDelete","style","fontWeight","asset","multiple","items","assetType","sourceId","source","hidden","indexOf","has","filter","contextMenuHandler","evt","stopPropagation","preventDefault","open","position","clientX","clientY","element","addEventListener","tree","elementTitle","innerElement","AssetsCreateFolder","method","path","currentFolder","type","preload","scope","AssetsCreateTable","tableAssetsID","warn","table_name","protocol","host","AssetsDrop","assetsPanel","drop","classList","add","AssetsFilter","filterOptions","currentPath","searchLastValue","searchTags","panelFilters","Panel","visible","filterField","search","normalSearch","bits","split","tags","merge","tag","trim","subBits","subTag","subTags","ex","tagsCheck","RegExp","toLowerCase","class","header","options","all","textureTarget","SelectField","renderChanges","remove","tooltipFilter","Tooltip","attach","align","query","file","TextField","blurOnEnter","keyChange","keyCode","searchClear","click","alt","callback","focus","createElement","innerHTML","appendChild","AssetsFs","getIds","ids","op","assetTo","move","froms","assetJsonStr","assetData","assetFile","originItem","originPath","modifiedAt","index","lastPath","closestPath","ext1","babylon","assetKeys","i_1","AssetsPanelControl","controls","enabled","btnNew","Button","rect","getBoundingClientRect","right","top","tooltipAdd","btnDelete","tooltipDelete","btnUp","tooltipUp","assetsGrid","btnThumbSize","contains","tooltipThumbSize","startsWith","AssetsPanel","dragging","draggingData","selector","prev","searching","overlay","TopElementContainer","flex","loading","Progress","progress","folders","flexShrink","width","foldable","horizontal","scroll","resizable","resizeMin","resizeMax","files","flexGrow","grid","Grid","Tree","draggable","treeRoot","TreeItem","resizeTree","resizeQueued","scrollWidth","resizeQueue","requestAnimationFrame","selected","treeScripts","assetsIndex","dragOver","gridDropBorder","treeDropBorder","hole","passThrough","addAsset","treeAppendQueue","left","innerWidth","bottom","innerHeight","log","labelNoAssets","Label","msg","scriptsIndex","assetsChanged","tooltipAsset","hoverable","tooltipShow","tooltipTarget","nodeName","parentNode","ui","flip","onAssetItemHover","tooltipTimeout","onAssetItemBlur","_ctrl","clear","searchingInProgress","searchingElement","searchingFunction","searchingBatchLimit","searchNextBatch","done","nextSibling","immediate","firstChild","multiPath","equals","appendChildFolders","closest","treeFindClosest","appendBefore","child","current","nameOld","l","childNodes","cur","aN","bN","floor","ctrl","renderQueue","renderQueueIndex","renderQueueUpdate","shift","thumbnail","render","showGridDropHighlight","clip","onAddFolder","parentFolderId","onMouseOver","dragAsset","assetPath","height","onMouseOut","pos","events","GridItem","bind","onMouseDown","onDragStart","selectorType","selectorItems","updateTask","status","getThumbnailUrl","then","response","backgroundImage","label","labelElement","textContent","evtUnused","users","removeChild","insertBefore","keepLegacyScriptsAtTop","pathOld","unbind","treeItem","ind","found","evtNameSet","valueOld","AssetsPreview","canvas","matPreviewCanvas","display","body","engine","BABYLON","Engine","Scene","clearColor","HemisphericLight","Vector3","intensity","camera","UniversalCamera","node","TransformNode","copyFrom","rotation","Zero","inputs","PI","previewSphere","MeshBuilder","CreateSphere","diameter","defaultMat","StandardMaterial","createMatPreview","matQueuing","queueElement","queueMaterialAssets","loadMaterial","_data2","newMat","isReady","Tools","CreateScreenshotUsingRenderTarget","src","waitForRender","asset_data","firstKey","secondKey","matAssetID","textureID","materialData","diffuseTexture","texture_id","prefix","specularTexture","reflectionTexture","refractionTexture","emissiveTexture","bumpTexture","opacityTexture","ambientTexture","lightmapTexture","AssetsRename","changeName","assetId","assetName","postfix","pop","endsWith","newName","oldName","undo","redo","AssetsStore","btnStore","AssetsSync","onAssetSelect","assets_data","onLoad","lib_1","Observer","count","assetsLength","getOwnPropertyNames","noSelect","evtAssetAdd","err","res","AssetsUpload","uploadJobs","fileIndex","fileCount","typeToExt","font","extToType","appendCommon","form","isNaN","size","totalSize","ossfile","assetJson","replaceMode","replaceAsset","formData","source_asset_id","meta","job","backData","getmd5","assetID","createAssetID","uploadFile","createdAt","has_thumbnail","babylon_resource","babylonKey","materials","matKey","itemData","itemKey","Promise","resolve","reject","reader","FileReader","readAsText","onload","onerror","babylonFile","matID","matData","matAssetData","asset_id","mat_id","resourceData","item_id","resource_id","uploadJsonAsset","tableStandard","len_1","asset_1","ext","candidates","order","scripts","pipeline","onceAssetLoad","fileInput","verticalAlign","textAlign","onChange","fl","removeEventListener","Assets","ObserverList","sorted","a1","b1","na","nb","positionNextClosest","find","findOne","map","__exportStar","AssetsKeeper","assets_1","assets_sync_1","assets_fs_1","assets_preview_1","assets_panel_1","assets_panel_control_1","assets_filter_1","assets_create_folder_1","assets_context_menu_1","assets_create_table_1","assets_upload_1","assets_drop_1","assets_store_1","assets_rename_1","AttributeAssetsTexture","panelsStates","sort","localeCompare","panelState","numTextures","numTextureAtlases","comma","panel","folded","headerElement","btnGetMeta","btnGetMetaVisibility","fieldWidth","link","placeholder","fieldHeight","checkDepthField","fieldDepth","checkAlphaField","fieldAlpha","checkInterlacedField","fieldInterlaced","fieldRgbm","fieldMips","reloadImage","previewContainer","preview","image","eventsPreview","fieldFiltering","enum","","nearest","linear","getUrl","config_1","Image","AttributesAssets","sourceRuntimeOptions","-1","0","fieldId","fieldName","fieldTags","runtime","fieldRuntime","fieldFailed","checkFailed","fieldType","fieldPreload","panelButtons","btnDownload","evtBtnDownloadPermissions","multi","tagType","donwLoad","AttributesEntity","panelComponents","checkingPanel","entities","checkPanel","show","queueCheckPanel","argsList","argsFieldsChanges","unlinkField","inspectEvents","argsEnabled","fieldEnabled","argsName","argsPosition","precision","step","fieldPosition","argsRotation","fieldRotation","argsScale","fieldScale","argsCheckCollisions","checkCollisions","argsIsPickable","pickable","btnAddComponent","initialize","linkField","toggleFields","onInspect","onUninspect","selectedEntities","disablePositionXY","disableRotation","disableScale","entity","toggleFieldsIfNeeded","addEvents","AttributeHistory","AttributesPanel","clearPanel","attributes","historyState","history","_parent","pathAt","paths","headerText","field","_changing","update","different","v","countUndefined","_title","_onLinkChange","historyStart","historyEnd","colorPickerOn","sliderRecords","changeField","_getItemFn","slider","stopHistory","unset","changeFieldQueue","evtColorPickStart","evtColorPick","color","evtColorPickEnd","rectPicker","rectField","evtColorToPicker","flexWrap","WebkitFlexWrap","_label","reference","tooltip","subTitle","description","linkEvents","evtPick","replace","btnAdd","innerPanel","addTag","tagsPanel","tagItems","tagIndex","tagList","records","tagNumber","insert","removeValue","onInsert","insertElement","onRemove","splice","onSet","values","itemText","sortTags","tagToString","onClickTag","TextAreaField","Slider","NumberField","allowNull","Checkbox","channels","ColorField","ImageField","panelFields","panelControls","fieldTitle","btnEdit","btnRemove","kind","oldValues","_type","renderQueued","queueRender","evtThumbnailChange","evtSceneSettings","positions","images","renderPreview","watch","watchAsset","updateThumbnail","empty","autoLoad","elementImage","ctx","getContext","clearRect","url","appendQuery","drawImage","beginPath","fillStyle","fill","updateField","dropRef","rectA","rectB","over","leave","unregister","getCurrentEntity","evtEntityPick","initialValue","maxWidth","className","Element","inspectedItems","AttributesReference","attachReference","missing","sanitize","webgl2","timerHover","timerBlur","targetPanel","evtHide","evtHover","evtBlur","hide","evtClick","attributesPanel","AttributeComponentCamera","fieldProjection","fieldFov","fieldOrthoHeight","AttributeComponentGUI","drag","drag_mode","dragType","targetType","targetSubtype","alpha","panelButton","panelContainer","panelText","panelInput","panelCheckbox","panelImage","GUI","AdvancedDynamicTexture","Rectangle","TextBlock","InputText","RadioButton","AttributeComponentLight","AttributesKeeper","attributes_panel_1","attributes_history_1","attributes_reference_1","attributes_entity_1","attributes_assets_1","attributes_assets_texture_1","attributes_component_camera_1","attributes_component_light_1","attributes_component_gui_1","CameraDepth","CameraPreview","selectedEntity","currentCamera","pinnedCamera","pinned","viewport","cameraPreviewBorder","btnPin","stopPreview","middleware_1","VeryCamera","renderCamera","CameraUserdata","CameraViewport","deltaTime","orbiting","panning","viewScene","copyFromFloats","cameraX","cameraY","initScreenPos","curScreenPos","moveSpeed","y","Distance","initPosition","angles","utility_1","radianToEulerAngle","viewCamera","CameraTargetPosition","clone","targetOnScreenPosition","storeRotation","Quaternion","FromEulerVector","eulerAngleToRadian","toEulerAngles","quatMultiplyVector3","target_position","target_rotation","dt","speed","focusing","vecA","subtract","focusPoint","flySpeed","firstUpdate","lerpVector3","focusTarget","button","up","forward","z","worldToScreenPoint","viewEngine","_lastMode","mPosition","movementX","movementY","clampAngle","mode","Camera","PERSPECTIVE_CAMERA","orthoSize","scale","delta","deltaY","point","distance","mode_type","currentDistance","tempAngle","ORTHOGRAPHIC_CAMERA","toQuaternion","getAbsolutePosition","selection","Cameras","CameraKeeper","cameras_1","camera_viewport_1","camera_preview_1","Drop","parts","partsElement","part","areas","currentType","currentData","itemOver","activate","onMouseUp","evtDragOver","evtDragLeave","_ref","dataTransfer","fixChromeFlexBox","overflow","navigator","userAgent","dropEffect","that","obj","pointerEvents","evtDrop","dropOn","depth","offsetHeight","getComputedStyle","getPropertyValue","_super","Editor","Events","__extends","_hooks","methodRemove","_i","stack","Entities","addRaw","entity_data","gameObject","createGameObject","container","addGameObject","addEntity","create","GameObject","instance","guid","setActive","_indexed","lists","ResourceContainer","entityRoot","resourceId","EntityCreate","defaultData","noHistory","parentId","entityData","createEntityDataFromEditor","subtype","createEntityInstance","typeToName","box","sphere","plane","cylinder","hemispheric","directional","spot","parentResourceId","GUID","children","isVisible","material_id","fov","inertia","ellipsoid","ellipsoidOffset","applyGravity","minZ","maxZ","priority","FromArray","scaling","isEnabled","CreateBox","isPickable","segments","CreateGround","subdivisions","CreateCylinder","parentID","newParent","createEntityDataFor2DGUI","create2DGUIEntityInstance","gui_1","GUIManager","getActiveCanvas","getActiveID","Node","Control","getContainerParent","getResourceID","uniqueId","control","Container","typeToName2DGui","input","checkbox","parent_gui","gui","xType","yType","widthType","heightType","scaleX","scaleY","horizontal_alignment","vertical_alignment","isHighlighted","background","thickness","cornerRadius","fontSize","textColor","textHorizontalAlignment","textVerticalAlignment","textWrapping","placeholderColor","placeholderText","focusedBackground","isChecked","canvas2D","CreateFullscreenUI","add2DCanvas","rootContainer","addUniqueIDIndex","rgba2hsvString","set2DGUITransform","btn","CreateImageWithCenterTextButton","textBlock","img","horizontalAlignment","verticalAlignment","EntityDelete","entitiesToDelete","resourceIds","EntityEdit","childToParent","deletedCache","updateSceneData","removeEntity","entityReferencesMap","childrenIDs","childEntity","removeEntityID","removeSceneData","select","addSceneData","origin","childResourceId","saveScene","EntityLoad","loadedEntities","hierarchyOverlay","total","EntitySync","Entity","EntityKeeper","entities_1","entity_edit_1","entity_create_1","entity_load_1","entity_sync_1","entity_delete_1","UtilityLayerRenderer","getRenderCamera","getRigParentIfPossible","_renderCamera","activeCam","originalScene","activeCameras","isRightCamera","rightCamera","setRenderCamera","cam","_getSharedGizmoLight","_sharedGizmoLight","utilityLayerScene","groundColor","Color3","Gray","defineProperty","_DefaultUtilityLayer","EngineStore","LastCreatedScene","onDisposeObservable","addOnce","_DefaultKeepDepthUtilityLayer","autoClearDepthAndStencil","_notifyObservers","prePointerInfo","pickInfo","pointerEvent","skipOnPointerObservable","onPointerObservable","notifyObservers","PointerInfo","event","_lastPointerEvents","pointerId","oldScene","_updateCamera","activeCamera","getScene","_scene","leftCamera","dispose","onPointerOutObservable","_afterRenderObserver","onAfterCameraRenderObservable","_sceneDisposeObserver","_originalPointerObserver","onPrePointerObservable","cameraToUseForPointers","recovery","setOrthoSize","_backUpOrtho","orthoRight","getEngine","getRenderWidth","orthoLeft","orthoTop","getRenderHeight","orthoBottom","handleEvents","_pointerCaptures","pickUtilitySceneFirst","shouldRender","onlyCheckPointerDownEvents","processAllEvents","Observable","mainSceneTrackerPredicate","virtual","useRightHandedSystem","_allowPostProcessClearColor","detachControl","eventState","PointerEventTypes","POINTERMOVE","POINTERUP","POINTERDOWN","POINTERDOUBLETAP","pointerX","pointerY","isPointerCaptured","originalScenePick","pointerEvent_1","utilityScenePick","ray","pickWithRay","pick","hit","pickedMesh","makeObserverTopPriority","autoClear","gizmo_1","UtilityLayerRenderer_1","AxisDragGizmo","Gizmo","_CreateArrow","arrow","CylinderBuilder","diameterTop","diameterBottom","tessellation","line","_CreateArrowInstance","getChildMeshes","mesh","createInstance","_attachedNodeChanged","dragBehavior","_isEnabled","attachedMesh","attachedNode","onSnapObservable","gizmoLayer","_pointerObserver","detach","_arrow","_coloredMaterial","_hoverMaterial","forEach","matl","dragAxis","DefaultUtilityLayer","snapDistance","diffuseColor","specularColor","lookAt","_rootMesh","scaleInPlace","currentSnapDragDistance","tmpVector","tmpSnapEvent","PointerDragBehavior","moveAttached","addBehavior","localDelta","tmpMatrix","Matrix","onDragObservable","dragSteps","getWorldMatrix","invertToRef","setTranslationFromFloats","TransformCoordinatesToRef","addInPlaceFromFloats","_worldMatrix","addTranslationFromFloats","updateCache","dragDistance","abs","normalizeToRef","_operationType","_matrixChanged","pointerInfo","_customMeshSet","m","light","includedOnlyMeshes","AxisScaleGizmo","setCustomMesh","useGizmoMaterial","uniformScaling","sensitivity","AbstractMesh","arrowMesh","BoxBuilder","arrowTail","addChild","dragStrength","snapped","scalingMatrix","scaleRatio","decompose","normalize","scaleToRef","ScalingToRef","multiply","BoundingBoxGizmo","setColor","coloredMaterial","emissiveColor","hoverColoredMaterial","_lineBoundingBox","getChildren","originalParent","PivotTools","_RemoveAndStorePivotPoint","_anchorMesh","setParent","_RestorePivotPoint","updateBoundingBox","markAsDirty","onAfterRenderObservable","_updateDummy","_selectNode","selectedMesh","_rotateSpheresParent","_scaleBoxesParent","originalSkeletonOverrideMesh","boundingMinMax","skeleton","overrideMesh","_update","rotationQuaternion","RotationYawPitchRoll","_tmpQuaternion","_tmpVector","getHierarchyBoundingVectors","ignoreChildren","includeChildPredicate","subtractToRef","_boundingDimensions","computeWorldMatrix","absolutePosition","_updateRotationSpheres","_updateScaleBoxes","_existingMeshScale","rotateSpheres","distanceFromCamera","addInPlace","Cross","normalizeToNew","Right","Up","Forward","fixedDragMeshScreenSize","rotationSphereSize","fixedDragMeshScreenSizeDistanceFactor","scaleBoxes","zeroAxisCount","scaleBoxSize","setEnabledRotationAxis","axis","setEnabled","setEnabledScaling","enable","homogeneousScaling","enableMesh","metadata","_dragMesh","enableDragBehavior","Mesh","visibility","pointerDragBehavior","useObjectOrienationForDragging","onBeforeRenderObservable","_renderObserver","MakeNotPickableAndWrapInBoundingBox","makeNotPickable","oldPos","oldRot","Epsilon","Logger","DefaultKeepDepthUtilityLayer","_scaleDragSpeed","_tmpRotationMatrix","onDragStartObservable","onScaleBoxDragObservable","onScaleBoxDragEndObservable","onRotationSphereDragObservable","onRotationSphereDragEndObservable","scalePivot","updateScale","disableLighting","lines","LinesBuilder","CreateLines","points","SphereBuilder","this_1","_dragBehavior","updateDragPlane","startingTurnDirection","totalTurnAmountOfDrag","isNonUniformWithinEpsilon","Warn","worldDragDirection","toSub","dragPlaneNormal","Dot","projectDist","RotationYawPitchRollToRef","multiplyToRef","onDragEndObservable","this_2","relativeDragDistance","deltaScale","getRotationMatrixToRef","subtractInPlace","pointerIds","rotateByQuaternionToRef","setAbsolutePosition","CameraGizmo","_cameraLinesMesh","_camera","gizmoLight","_cameraMesh","_CreateCameraMesh","_CreateCameraFrustum","_material","reservedDataStore","cameraGizmo","getProjectionMatrix","_invProjection","setPivotMatrix","onClickedObservable","cyl1","cyl2","cyl3","_Scale","alwaysSelectAsActiveMesh","_1","cameraGizmo_1","GizmosCenter","gizmoManager","GizmoManager","positionGizmoEnabled","rotationGizmoEnabled","scaleGizmoEnabled","gizmos","positionGizmo","rotationGizmo","scaleGizmo","lastCameraGizmo","tempGizmo","displayFrustum","currentItems","currentEvents","setMode","attachToMesh","attachToNode","setPosition","setRotation","eulerAngle","setScale","_scaleRatio","_attachedMesh","_attachedNode","_updateGizmoRotationToMatchAttachedMesh","effectiveNode","row","cameraPosition","dist","rate","_effectiveMesh","updateGizmoPositionToMatchAttachedMesh","getRow","toVector3","updateGizmoRotationToMatchAttachedMesh","globalPosition","devicePosition","_tempVector","_getWorldMatrixDeterminant","setAll","worldMatrix","targetCamera","transform","parentInv","localMat","bone","parent_1","invParent","boneLocalMatrix","_isCamera","_tempMatrix2","_tempMatrix1","_rightHandtoLeftHandMatrix","_tempVector2","_tempQuaternion","getClassName","_isMesh","getParent","getLocalMatrix","_beforeRenderObserver","_interactionsEnabled","RotationY","Identity","rotationGizmo_1","positionGizmo_1","scaleGizmo_1","boundingBoxGizmo_1","_defaultKeepDepthUtilityLayer","_defaultUtilityLayer","removeBehavior","boundingBoxDragBehavior","showBoundingBox","gizmo","_gizmosEnabled","boundingBoxGizmoEnabled","onAttachedToMeshObservable","onAttachedToNodeObservable","PositionGizmo","_thickness","RotationGizmo","ScaleGizmo","boundingBoxGizmo","_boundingBoxColor","clearGizmoOnEmptyPointerEvent","FromHexString","SixDofDragBehavior","attachableMeshes","attachableNodes","usePointerToAttachGizmos","LightGizmo","_light","newDirection","_lightMesh","_CreateHemisphericLightMesh","DirectionalLight","_CreateDirectionalLightMesh","SpotLight","_CreateSpotLightMesh","_CreatePointLightMesh","lightGizmo","_attachedMeshParent","freezeWorldMatrix","VeryLight","_cachedPosition","transformLocalToWorldDirection","Down","setDirection","_cachedForward","direction","DistanceSquared","hemisphere","HemisphereBuilder","CreateHemisphere","_CreateLightLines","arrowHead","levels","linePivot","PlaneDragGizmo","_CreatePlane","dragPlane","PlaneBuilder","CreatePlane","sideOrientation","_plane","PlaneRotationGizmo","planeNormal","useEulerRotation","hoverMaterial","parentMesh","CreateTorus","rotationMesh","maxDragAngle","_useAlternatePickedPointAboveMaxDragAngle","lastDragPosition","dragPlanePoint","rotationMatrix","planeNormalTowardsCamera","localPlaneNormalTowardsCamera","amountToRotate","nodeScale","nodeQuaternion","nodeTranslation","newVector","originalVector","cross","dot","angle","camVec","quaternionCoefficient","atan2","toRotationMatrix","TransformCoordinates","sin","cos","determinant","toEulerAnglesToRef","Compose","axisDragGizmo_1","planeDragGizmo_1","_meshAttached","_nodeAttached","xGizmo","yGizmo","zGizmo","xPlaneGizmo","yPlaneGizmo","zPlaneGizmo","system","coordSystem","_planarGizmoEnabled","_snapDistance","Red","Green","Blue","planarGizmoEnabled","planeRotationGizmo_1","axisScaleGizmo_1","uniformScaleGizmo","_sensitivity","_uniformScalingMesh","_octahedron","msh","Yellow","PolyhedronBuilder","CreatePolyhedron","sceneID","isSceneDirty","_2dCanvasGroup","_2dCanvasGroupID","_2dCanvasGroupDic","getCanvasFromIndex","unique_id","_uniqueID2resourceID","dragAllow","child_type","child_subtype","parent_type","parent_subtype","GUIKeeper","HierarchyContextMenu","initMenu","menuData","add-new-box","add-new-sphere","add-new-plane","add-new-cylinder","add-new-hemispheric","add-new-directional","add-new-point","add-new-spot","add-new-2d-canvas","add-new-panel","add-new-button","add-new-image","add-new-text","add-new-input","add-new-checkbox","fromData","clickableSubmenus","getSelection","initFunction","ignoreSelection","HierarchyControl","hierarchy","flexDirection","alignItems","btnDuplicate","tooltipDuplicate","HierarchyMenu","HierarchyPanel","uiItemIndex","dom","hierarchyTree","allowRenaming","componentList","dragScroll","dragTimer","dragEvt","_dragging","Number","scrollTop","scrollHeight","_dragOver","_updateDragHandle","_dragItems","outline","preserveTransform","reparenting","record","parentOld","old","parentIdOld","indOld","indNew","isRoot","getNodeByID","_b","_c","_d","next","after","appendAfter","rootParent","highlight","HierarchySearch","changing","itemsIndex","results","List","tabIndex","lastSearch","prepend","firstElement","selectNext","selectPrev","_onDeselect","inSelected","toSelect","querySelectorAll","_shift","previousSibling","addItem","ListItem","disabledClick","onStateChange","components","onContextMenu","onDblClick","performSearch","ctrlKey","HierarchyKeeper","hierarchy_panel_1","hierarchy_menu_1","hierarchy_search_1","hierarchy_context_menu_1","Hotkeys","keyMapInit","keyMap","backspace","tab","enter","pause/break","caps lock","esc","space","page up","page down","home","left arrow","up arrow","right arrow","down arrow","delete","2","3","4","5","6","7","8","9","g","h","q","w","left window key","right window key","select key","numpad 0","numpad 1","numpad 2","numpad 3","numpad 4","numpad 5","numpad 6","numpad 7","numpad 8","numpad 9","decimal point","divide","f1","f2","f3","f4","f5","f6","f7","f8","f9","f10","f11","f12","num lock","scroll lock","semi-colon","equal sign","dash","period","forward slash","grave accent","open bracket","back slash","close bracket","single quote","keyByKeyCode","keyByCode","hotkeys","keyIndex","isMac","hotkey","updateModifierKeys","KeyboardEvent","MouseEvent","shiftKey","metaKey","altKey","tagName","skipPreventDefault","InitializeAfter","entity_1","scenes_1","ScenesKeeper","camera_1","attributes_1","toolbar_1","ToolbarKeeper","settings_1","SettingsKeeper","pickers_1","PickerKeeper","viewport_1","ViewportKeeper","hotkeys_1","selector_1","localstorage_1","InitializeBefore","LocalStorage","ComponentsLogos","ContextMenu","Selector","Layout","toolbar","hierarchyPanel","TopElementPanel","panelType","collapsible","collapseHorizontally","collapsed","scrollable","viewportPanel","statusBar","ignoreClasses","ignoreElements","focusNode","blur","localStorage","getItem","setItem","transform_1","gameobject_1","Component","Transform","_transform","_guid","isEmpty","_tag","transformNode","Find","BabylonEngine","getNodeByName","FindGameObjectWithTag","FindGameObjectsWithTag","Destroy","CreateInstance","game_object","sourceMesh","addMesh","setActiveRecursively","AddComponent","very_light_1","very_camera_1","loadFromBabylonAsset","loadBabylon","dataBabylon","babylonCacheData","parseBabylon","assembleBabylon","getJsonAsset","babylonData","parsedData_1","geometries","vertexData","geometry","meshes","transformNodes","babylonParsedData","hasBabylobData","getBabylonData","hasParsedBabylonData","getParsedBabylonData","meshParseRecursion","tempMeshID","childs","myChildren","babylon_id","changeSceneName","now","Date","getFullYear","getRealTime","getMonth","getDate","getHours","getMinutes","oldData","loadLight","parsedLight","Light","Parse","loadReflectionProbe","parsedReflectionProbe","rootUrl","ReflectionProbe","loadAnimation","parsedAnimation","internalClass","_TypeStore","GetClass","loadMultiMaterial","parsedMultiMaterial","MultiMaterial","ParseMultiMaterial","loadMorphTargetManager","managerData","MorphTargetManager","loadSkeleton","parsedSkeleton","Skeleton","loadGeometry","Geometry","loadTransformNode","parsedTransformNode","loadMesh","parsedMesh","loadCamera","parsedCamera","loadAnimationGroup","parsedAnimationGroup","AnimationGroup","setBabylonParent","cache","index_1","cache_1","cameras","_waitingParentId","getLastEntryByID","lights","createCameraWraper","cameraWraper","createLightWraper","createLight","PointLight","createPrimitive","primitive","load","sceneFilename","_getFileInfo","GetFilename","GetFolderPath","projectData","mats","parsedVertexData","newTransformNodes_1","newMeshes_1","parentMeshes","tempMeshDic_1","tempMeshID_1","newID_1","oldID_1","element2","tempMesh","textureUrl","mat","Material","object","gameObjects","_mesh","_transformNode","_name","_tempVec","para","multiplyByFloats","parent_2","parent_3","parent_4","translate","translation","relativeTo","translateRelativeTo","trans","transformDirection","Space","WORLD","rotate","eulerAngles","rotateAround","transformPosition","local_position","matrix","local_direction","inverseTransformPosition","global_position","Invert","inverseTransformDirection","global_direction","pointA","pointOrigin","worldUp","detachChildren","findChild","isChildOf","getChild","tempParent","localScale","_orthoSize","_clearColor","_render","_backupViewport","Viewport","resize","_canvas","_width","_height","getTypeID","diffuse","specular","exponent","picker_color_1","PickerColor","picker_asset_1","PickerAsset","Overlay","pluralize","word","center","gridSelected","allowMultiSelection","assetSelection","assetsPanelFolded","assetsPanelFilter","assetsPanelSearch","assetsPanelFolder","idx","zIndex","gridItem","pickerType","flash","getHex","channelsNumber","toUpperCase","pickRectMouseMove","pickRect","colorHSV","directInput","rgb","hsv2rgb","fieldHex","pickRectHandle","pickHueMouseMove","pickHue","updateRects","pickOpacityMouseMove","fieldA","round","callbackHandle","callingCallaback","channel","pickRectMouseUp","pickHueMouseUp","pickOpacityMouseUp","sum","plainColor","hsv","rgb2hsv","pickHueHandle","backgroundColor","callCallback","transparent","pickRectWhite","pickRectBlack","pickOpacity","pickOpacityHandle","fieldR","fieldG","fieldB","updateHex","elementInput","Scenes","_prefix","Search","charAt","tokens","searchTokens","containsCharsTolerance","editsDistanceTolerance","subInd","edits","Infinity","subFull","sub","editsCandidate","subCandidate","searchItems","limitResults","SelectorHistory","keyByType","evtChangeFn","evtChange","rootEntity","legacyScripts","settings_attribute_1","SettingsAttribute","sceneName","settingsData","scene_name","querySelector","panelScene","toolbar_status_1","ToolbarStatus","toolbar_logo_1","ToolbarLogo","toolbar_gizmos_1","ToolbarGizmos","toolbar_history_1","ToolbarHistory","toolbar_help_1","ToolbarHelp","toolbar_control_1","ToolbarControl","toolbar_editor_settings_1","ToolbarEditorSettings","toolbar_publish_1","ToolbarPublish","toolbar_scene_1","ToolbarScene","toolbar_camera_1","ToolbarCamera","透视相机","正交相机","左视图","右视图","顶视图","底视图","前视图","后视图","combo","optionClassNamePrefix","activeGizmo","gizmoButtons","gizmo_center_1","buttonWorld","tooltipWorld","buttonFocus","tooltipFocus","buttonUndo","tooltipUndo","buttonRedo","tooltipRedo","logo","argument","jobs","jobsCount","least","updateJobs","ToolbarTopControl","buttonExpand","tooltipExpand","launch","marginRight","buttonLaunch","Ajax","AjaxRequest","post","put","param","params","_onLoad","_progress","_xhr","notJson","responseText","_onError","_onAbort","_onProgress","lengthComputable","loaded","abort","XMLHttpRequest","cookies","withCredentials","ends","ignoreContentType","setRequestHeader","headers","FormData","send","audiolistener","audiosource","sound","collision","particlesystem","rigidbody","screen","sprite","layoutgroup","layoutchild","scrollview","scrollbar","zone","2d-screen","3d-screen","text-element","image-element","group-element","userinterface","Debug","optionalParams","allow","EventProxy","ev","debug","_callbacks","subscribe","headbind","unshift","eventname","calls","list","bindForAll","ALL_EVENT","unbindForAll","trigger","both","fire","wrapper","_assign","eventnames","cb","proxy","times","flag","isOnce","_fired","_all","eventname1","eventname2","names","CONCAT","assign","fail","throw","assignAll","assignAlways","firedData","_after","group","SLICE","any","_eventname","eventName","_bind","not","handler","createWithArgs","ep","later","random","SHA1","SHA1hex","AlignSHA1","sIn","nblk","blks","rol","cnt","ft","kt","olda","oldb","oldc","oldd","olde","sha1_1","eulerAngleFloatToRadian","euler_angle","radianFloatToEulerAngle","radian","vector3ToArray","quatTransfromVector3","quat","vec3","qx","qy","qz","qw","ix","iy","iz","iw","num2","num3","num4","num5","num6","num7","num8","num9","num10","num11","num12","world_point","Project","getTransformMatrix","toGlobal","lerpVector2","vec1","vec2","Vector2","lerpVector4","Vector4","sha1","diffc","diff","rr","gg","bb","rgba","colorStr","to255rgba","hsvString2rgba","colorChange","toSmallrgba","rgba255","rgbaSmall","lastIndexOf","uri","returnUnchangedIfNoSlash","CleanUrl","axios","respone","loadBlue","animations","parsedMaterial","multiMaterials","skeletons","beginAnimation","addedGeometry","_internalTexturesCache","isLegalName","stringCompare","BaseUrl","PreprocessUrl","spark_md5_1","__importDefault","getTime","loadNext","fileReader","frOnload","frOnerror","start","currentChunk","chunkSize","readAsArrayBuffer","blobSlice","File","chunks","ceil","spark","default","viewport_application_1","ViewportApplication","viewport_entities_observer_binding_1","ViewportEntitiesObserverBinding","viewport_instance_create_1","ViewportInstanceCreate","viewport_drop_model_1","ViewportDropModel","viewport_tap_1","ViewportTap","childIndex","entitiesIndex","lightWraper","btn_1","img_1","LIGHTTYPEID_HEMISPHERICLIGHT","gizmos_1","childAndParent","viewCanvasElement","Color4","addCamera","details","insertChild","addControl","loadingBabylonFlag","toLoadEntity","assembleSceneMesh","parsedBabylon","meshID","meshData","recordRotation","materialId","geometryId","getGeometryByID","getMaterialByID","babylon_data","modelName","SceneLoader","Append","_markAllAsDirty","_markAsDirty","reparent","localPosition","localRotation","removeControl","ViewportExpand","panels","expanded","inViewport","evtMouseMove","relatedTarget","Tap","down","sx","sy","nx","lx","ny","ly","mouse","viewport_expand_1","Canvas","viewCanvas","_engine","preventDefaultOnPointerDown","preventDefaultOnPointerUp","toggleDebug","debugLayer","embedMode","expandControl","onBeforeCameraRenderObservable","temp","getCamera","enableScissor","attachControl","updateSize","backupWidth","runRenderLoop","clientWidth","clientHeight","getDeltaTime","Application","editor_1","cameraDic","_suspendEvents","_events","EventHandle","arg0","arg1","arg2","arg3","arg4","arg5","arg6","arg7","info","owner","events_1","indexof","removeByKey","removeBy","ObserverSync","_enabled","_paths","_initialize","patchData","parserObject","_dataType","_dataType2","oldValue","_data","SEPARATOR","updateChildData","isNumber","newPath","key2","propagate","_parentKey","_parentField","_silent","silence","silenceRestore","_prepare","silent","remote","_path","_keys","parentPath","parentField","parentKey","syncState","sync","_destroyed","_pathsWithDuplicates","pathsWithDuplicates","getSuffix","fileName","nameSplit","ajax_1","projectId","Accept","assetStr","jsonName","jsonStr","e_1","e_2","download","href","createEvent","initEvent","dispatchEvent","e_3","e_4","e_5","element_1","Bubble","_onClick","deactivate","tabindex","pulseCircle","centerCircle","setAttribute","_text","_onKeyDown","onselectstart","_link","_onChange","container_element_1","Code","ContainerElement","_channels","_values","elementColor","_onLink","evtLinkChannels","_setValue","_onUnlink","changed","_innerElement","_observer","disconnect","observe","_observerOptions","webkitFlexDirection","webkitFlexWrap","webkitFlexGrow","webkitFlexShrink","HTMLElement","parentElement","_observerChanged","childList","characterData","subtree","attributeOldValue","characterDataOldValue","observerTimeout","MutationObserver","_element","_evtParentDestroy","_evtParentDisable","_evtParentEnable","_parentDestroy","_parentDisable","_parentEnable","_disabledParent","_disabled","_onFlashDelay","unlink","_linkOnSet","_linkOnUnset","_selected","_selectPending","_clicked","_toggleSelectOnClick","_onSelect","toggleSelectOnClick","GridItemArgs","elements","_selecting","_onAppend","_onRemove","_multiSelect","_lastSelect","startInd","endInd","_onBeforeDeselect","multiSelect","HTMLCanvasElement","HTMLImageElement","_value","_lable","_setText","getAttribute","_unsafe","unsafe","Link","ele","LinkSchema","elementText","_allowDeselect","allowDeselect","_selectable","selectable","elementIcon","_onMouseEnter","_onTouchStart","_container","_hasChildren","_onTouchEnd","_clickableSubmenus","_onOver","_onSelectPropagate","selectedItemHasChildren","_index","hasChildren","menu_item_1","_onContextMenu","_updatePath","_onOpen","findByPath","_hovered","createItem","listItems","elementOverlay","parseFloat","toFixed","_lastValue","removeAttribute","_onInputFocus","_onInputBlur","focused","inc","_onFullSelect","_onDisable","readOnly","_onEnable","_onChangeField","pow","refocusable","_dragDiff","_dragStart","_onMouseDown","clickable","area","headerSize","_reflow","_handle","oldHandle","_handleElement","_resizeStart","_resizeLimits","headerElementTitle","self_1","_resizeMove","offsetX","offsetY","_resizeData","_resizeEnd","_resizeEvtMove","_resizeEvtEnd","changedTouches","touch","_resizeTouchId","identifier","_resizeEvtTouchMove","_resizeEvtTouchEnd","_onParent","_onNodesChanged","headerAppend","_onScroll","_targetProgress","_speed","_inner","_lastProgress","_animating","_animate","_failed","_now","valueToType","_oldValue","optionElements","elementValue","_onHoldSelect","uiElement","evtMouseDist","_onOptionSelect","pageX","pageY","evtMouseUp","evtTouchId","evtTouchEnd","schema","_updateOptions","elementFromPoint","evtTouchSecond","offsetTop","elementOptions","timerClickAway","looseActive","toggle","optionsKeys","infos","uiValue","_onOptionHover","_onOptionOut","_optionClassNamePrefix","_min","_updateHandle","_max","elementHandle","_onSlideStart","evtTouchMove","_onSlideMove","combine","_onSlideEnd","elementBar","evtKeyChange","ignoreChange","_align","_onMouseOver","_onMouseLeave","top_element_1","TopElement","_flex","_grid","_scrollable","_resizable","VALID_RESIZABLE_VALUES","_resizeHorizontally","_domResizeHandle","_createResizeHandle","_resizeMin","_resizeMax","_domContent","_domEventScroll","domContent","_getDomFromElement","_onAppendChild","referenceElement","referenceDom","elementBefore","handle","_domEventResizeStart","_domEventResizeTouchStart","_onResizeStart","_domEventResizeMove","_domEventResizeEnd","_onResizeMove","_onResizeEnd","_onResizeTouchStart","_domEventResizeTouchMove","_domEventResizeTouchEnd","_onResizeTouchMove","_onResizeTouchEnd","RESIZE_HANDLE_SIZE","top_element_container_1","_collapsible","_evtAppend","_evtRemove","_onChildrenChange","_containerContent","_collapsed","_collapseHorizontally","_containerHeader","_domHeaderTitle","_headerSize","lineHeight","_onHeaderClick","_suspendReflow","_reflowTimeout","cancelAnimationFrame","_widthBeforeCollapse","_heightBeforeCollapse","panelArgs","_onEnabledChange","_dom","oldEnabled","newEnabled","_onParentDestroy","_onParentDisable","_onParentEnable","_hidden","exposeCssProperty","observer","_onMouseOut","_domEventClick","_domEventMouseOver","_domEventMouseOut","SIMPLE_CSS_PROPERTIES","flexBasis","justifyContent","setProperty","tree_1","text_field_1","previousElementSibling","nextElementSibling","_allowDrop","htmlEle","_children","_onItemClick","_onDblClick","_onRename","currentItem","inside","selectedItem","downItem","firstElementChild","findNext","itemUp","lastItem","lastElementChild","deeper","_onDestroy","_onDragStart","appendChildren","referenceItem","removeChildren","_dragId","_dragRelease","_onMouseUp","allowDrop","tree_item_1","_onDragMove","_hoverCalculate","elementDrag","oldArea","_dragArea","oldDragOver","invalid","reordering","lookUp","lookDown","lookingUp","item_1","lookFrom","refItem","nextItem","prevItem","lastChild","defaultLevel","level","parent_5","commonParent_1","parents","findCommonParent","countChildren","scanUpForIndex","sibling","siblingItem","_onDragOver","_onDragEnd","reparentedItems","lastDraggedItem","oldParent","dragInstant","new","_onDragOut","_evtDragMove"],"mappings":"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","file":"vreditor.js","sourcesContent":["(function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c=\"function\"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error(\"Cannot find module '\"+i+\"'\");throw a.code=\"MODULE_NOT_FOUND\",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u=\"function\"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()","// shim for using process in browser\nvar process = module.exports = {};\n\n// cached from whatever global is present so that test runners that stub it\n// don't break things.  But we need to wrap it in a try catch in case it is\n// wrapped in strict mode code which doesn't define any globals.  It's inside a\n// function because try/catches deoptimize in certain engines.\n\nvar cachedSetTimeout;\nvar cachedClearTimeout;\n\nfunction defaultSetTimout() {\n    throw new Error('setTimeout has not been defined');\n}\nfunction defaultClearTimeout () {\n    throw new Error('clearTimeout has not been defined');\n}\n(function () {\n    try {\n        if (typeof setTimeout === 'function') {\n            cachedSetTimeout = setTimeout;\n        } else {\n            cachedSetTimeout = defaultSetTimout;\n        }\n    } catch (e) {\n        cachedSetTimeout = defaultSetTimout;\n    }\n    try {\n        if (typeof clearTimeout === 'function') {\n            cachedClearTimeout = clearTimeout;\n        } else {\n            cachedClearTimeout = defaultClearTimeout;\n        }\n    } catch (e) {\n        cachedClearTimeout = defaultClearTimeout;\n    }\n} ())\nfunction runTimeout(fun) {\n    if (cachedSetTimeout === setTimeout) {\n        //normal enviroments in sane situations\n        return setTimeout(fun, 0);\n    }\n    // if setTimeout wasn't available but was latter defined\n    if ((cachedSetTimeout === defaultSetTimout || !cachedSetTimeout) && setTimeout) {\n        cachedSetTimeout = setTimeout;\n        return setTimeout(fun, 0);\n    }\n    try {\n        // when when somebody has screwed with setTimeout but no I.E. maddness\n        return cachedSetTimeout(fun, 0);\n    } catch(e){\n        try {\n            // When we are in I.E. but the script has been evaled so I.E. doesn't trust the global object when called normally\n            return cachedSetTimeout.call(null, fun, 0);\n        } catch(e){\n            // same as above but when it's a version of I.E. that must have the global object for 'this', hopfully our context correct otherwise it will throw a global error\n            return cachedSetTimeout.call(this, fun, 0);\n        }\n    }\n\n\n}\nfunction runClearTimeout(marker) {\n    if (cachedClearTimeout === clearTimeout) {\n        //normal enviroments in sane situations\n        return clearTimeout(marker);\n    }\n    // if clearTimeout wasn't available but was latter defined\n    if ((cachedClearTimeout === defaultClearTimeout || !cachedClearTimeout) && clearTimeout) {\n        cachedClearTimeout = clearTimeout;\n        return clearTimeout(marker);\n    }\n    try {\n        // when when somebody has screwed with setTimeout but no I.E. maddness\n        return cachedClearTimeout(marker);\n    } catch (e){\n        try {\n            // When we are in I.E. but the script has been evaled so I.E. doesn't  trust the global object when called normally\n            return cachedClearTimeout.call(null, marker);\n        } catch (e){\n            // same as above but when it's a version of I.E. that must have the global object for 'this', hopfully our context correct otherwise it will throw a global error.\n            // Some versions of I.E. have different rules for clearTimeout vs setTimeout\n            return cachedClearTimeout.call(this, marker);\n        }\n    }\n\n\n\n}\nvar queue = [];\nvar draining = false;\nvar currentQueue;\nvar queueIndex = -1;\n\nfunction cleanUpNextTick() {\n    if (!draining || !currentQueue) {\n        return;\n    }\n    draining = false;\n    if (currentQueue.length) {\n        queue = currentQueue.concat(queue);\n    } else {\n        queueIndex = -1;\n    }\n    if (queue.length) {\n        drainQueue();\n    }\n}\n\nfunction drainQueue() {\n    if (draining) {\n        return;\n    }\n    var timeout = runTimeout(cleanUpNextTick);\n    draining = true;\n\n    var len = queue.length;\n    while(len) {\n        currentQueue = queue;\n        queue = [];\n        while (++queueIndex < len) {\n            if (currentQueue) {\n                currentQueue[queueIndex].run();\n            }\n        }\n        queueIndex = -1;\n        len = queue.length;\n    }\n    currentQueue = null;\n    draining = false;\n    runClearTimeout(timeout);\n}\n\nprocess.nextTick = function (fun) {\n    var args = new Array(arguments.length - 1);\n    if (arguments.length > 1) {\n        for (var i = 1; i < arguments.length; i++) {\n            args[i - 1] = arguments[i];\n        }\n    }\n    queue.push(new Item(fun, args));\n    if (queue.length === 1 && !draining) {\n        runTimeout(drainQueue);\n    }\n};\n\n// v8 likes predictible objects\nfunction Item(fun, array) {\n    this.fun = fun;\n    this.array = array;\n}\nItem.prototype.run = function () {\n    this.fun.apply(null, this.array);\n};\nprocess.title = 'browser';\nprocess.browser = true;\nprocess.env = {};\nprocess.argv = [];\nprocess.version = ''; // empty string to avoid regexp issues\nprocess.versions = {};\n\nfunction noop() {}\n\nprocess.on = noop;\nprocess.addListener = noop;\nprocess.once = noop;\nprocess.off = noop;\nprocess.removeListener = noop;\nprocess.removeAllListeners = noop;\nprocess.emit = noop;\nprocess.prependListener = noop;\nprocess.prependOnceListener = noop;\n\nprocess.listeners = function (name) { return [] }\n\nprocess.binding = function (name) {\n    throw new Error('process.binding is not supported');\n};\n\nprocess.cwd = function () { return '/' };\nprocess.chdir = function (dir) {\n    throw new Error('process.chdir is not supported');\n};\nprocess.umask = function() { return 0; };\n","(function (factory) {\n    if (typeof exports === 'object') {\n        // Node/CommonJS\n        module.exports = factory();\n    } else if (typeof define === 'function' && define.amd) {\n        // AMD\n        define(factory);\n    } else {\n        // Browser globals (with support for web workers)\n        var glob;\n\n        try {\n            glob = window;\n        } catch (e) {\n            glob = self;\n        }\n\n        glob.SparkMD5 = factory();\n    }\n}(function (undefined) {\n\n    'use strict';\n\n    /*\n     * Fastest md5 implementation around (JKM md5).\n     * Credits: Joseph Myers\n     *\n     * @see http://www.myersdaily.org/joseph/javascript/md5-text.html\n     * @see http://jsperf.com/md5-shootout/7\n     */\n\n    /* this function is much faster,\n      so if possible we use it. Some IEs\n      are the only ones I know of that\n      need the idiotic second function,\n      generated by an if clause.  */\n    var add32 = function (a, b) {\n        return (a + b) & 0xFFFFFFFF;\n    },\n        hex_chr = ['0', '1', '2', '3', '4', '5', '6', '7', '8', '9', 'a', 'b', 'c', 'd', 'e', 'f'];\n\n\n    function cmn(q, a, b, x, s, t) {\n        a = add32(add32(a, q), add32(x, t));\n        return add32((a << s) | (a >>> (32 - s)), b);\n    }\n\n    function md5cycle(x, k) {\n        var a = x[0],\n            b = x[1],\n            c = x[2],\n            d = x[3];\n\n        a += (b & c | ~b & d) + k[0] - 680876936 | 0;\n        a  = (a << 7 | a >>> 25) + b | 0;\n        d += (a & b | ~a & c) + k[1] - 389564586 | 0;\n        d  = (d << 12 | d >>> 20) + a | 0;\n        c += (d & a | ~d & b) + k[2] + 606105819 | 0;\n        c  = (c << 17 | c >>> 15) + d | 0;\n        b += (c & d | ~c & a) + k[3] - 1044525330 | 0;\n        b  = (b << 22 | b >>> 10) + c | 0;\n        a += (b & c | ~b & d) + k[4] - 176418897 | 0;\n        a  = (a << 7 | a >>> 25) + b | 0;\n        d += (a & b | ~a & c) + k[5] + 1200080426 | 0;\n        d  = (d << 12 | d >>> 20) + a | 0;\n        c += (d & a | ~d & b) + k[6] - 1473231341 | 0;\n        c  = (c << 17 | c >>> 15) + d | 0;\n        b += (c & d | ~c & a) + k[7] - 45705983 | 0;\n        b  = (b << 22 | b >>> 10) + c | 0;\n        a += (b & c | ~b & d) + k[8] + 1770035416 | 0;\n        a  = (a << 7 | a >>> 25) + b | 0;\n        d += (a & b | ~a & c) + k[9] - 1958414417 | 0;\n        d  = (d << 12 | d >>> 20) + a | 0;\n        c += (d & a | ~d & b) + k[10] - 42063 | 0;\n        c  = (c << 17 | c >>> 15) + d | 0;\n        b += (c & d | ~c & a) + k[11] - 1990404162 | 0;\n        b  = (b << 22 | b >>> 10) + c | 0;\n        a += (b & c | ~b & d) + k[12] + 1804603682 | 0;\n        a  = (a << 7 | a >>> 25) + b | 0;\n        d += (a & b | ~a & c) + k[13] - 40341101 | 0;\n        d  = (d << 12 | d >>> 20) + a | 0;\n        c += (d & a | ~d & b) + k[14] - 1502002290 | 0;\n        c  = (c << 17 | c >>> 15) + d | 0;\n        b += (c & d | ~c & a) + k[15] + 1236535329 | 0;\n        b  = (b << 22 | b >>> 10) + c | 0;\n\n        a += (b & d | c & ~d) + k[1] - 165796510 | 0;\n        a  = (a << 5 | a >>> 27) + b | 0;\n        d += (a & c | b & ~c) + k[6] - 1069501632 | 0;\n        d  = (d << 9 | d >>> 23) + a | 0;\n        c += (d & b | a & ~b) + k[11] + 643717713 | 0;\n        c  = (c << 14 | c >>> 18) + d | 0;\n        b += (c & a | d & ~a) + k[0] - 373897302 | 0;\n        b  = (b << 20 | b >>> 12) + c | 0;\n        a += (b & d | c & ~d) + k[5] - 701558691 | 0;\n        a  = (a << 5 | a >>> 27) + b | 0;\n        d += (a & c | b & ~c) + k[10] + 38016083 | 0;\n        d  = (d << 9 | d >>> 23) + a | 0;\n        c += (d & b | a & ~b) + k[15] - 660478335 | 0;\n        c  = (c << 14 | c >>> 18) + d | 0;\n        b += (c & a | d & ~a) + k[4] - 405537848 | 0;\n        b  = (b << 20 | b >>> 12) + c | 0;\n        a += (b & d | c & ~d) + k[9] + 568446438 | 0;\n        a  = (a << 5 | a >>> 27) + b | 0;\n        d += (a & c | b & ~c) + k[14] - 1019803690 | 0;\n        d  = (d << 9 | d >>> 23) + a | 0;\n        c += (d & b | a & ~b) + k[3] - 187363961 | 0;\n        c  = (c << 14 | c >>> 18) + d | 0;\n        b += (c & a | d & ~a) + k[8] + 1163531501 | 0;\n        b  = (b << 20 | b >>> 12) + c | 0;\n        a += (b & d | c & ~d) + k[13] - 1444681467 | 0;\n        a  = (a << 5 | a >>> 27) + b | 0;\n        d += (a & c | b & ~c) + k[2] - 51403784 | 0;\n        d  = (d << 9 | d >>> 23) + a | 0;\n        c += (d & b | a & ~b) + k[7] + 1735328473 | 0;\n        c  = (c << 14 | c >>> 18) + d | 0;\n        b += (c & a | d & ~a) + k[12] - 1926607734 | 0;\n        b  = (b << 20 | b >>> 12) + c | 0;\n\n        a += (b ^ c ^ d) + k[5] - 378558 | 0;\n        a  = (a << 4 | a >>> 28) + b | 0;\n        d += (a ^ b ^ c) + k[8] - 2022574463 | 0;\n        d  = (d << 11 | d >>> 21) + a | 0;\n        c += (d ^ a ^ b) + k[11] + 1839030562 | 0;\n        c  = (c << 16 | c >>> 16) + d | 0;\n        b += (c ^ d ^ a) + k[14] - 35309556 | 0;\n        b  = (b << 23 | b >>> 9) + c | 0;\n        a += (b ^ c ^ d) + k[1] - 1530992060 | 0;\n        a  = (a << 4 | a >>> 28) + b | 0;\n        d += (a ^ b ^ c) + k[4] + 1272893353 | 0;\n        d  = (d << 11 | d >>> 21) + a | 0;\n        c += (d ^ a ^ b) + k[7] - 155497632 | 0;\n        c  = (c << 16 | c >>> 16) + d | 0;\n        b += (c ^ d ^ a) + k[10] - 1094730640 | 0;\n        b  = (b << 23 | b >>> 9) + c | 0;\n        a += (b ^ c ^ d) + k[13] + 681279174 | 0;\n        a  = (a << 4 | a >>> 28) + b | 0;\n        d += (a ^ b ^ c) + k[0] - 358537222 | 0;\n        d  = (d << 11 | d >>> 21) + a | 0;\n        c += (d ^ a ^ b) + k[3] - 722521979 | 0;\n        c  = (c << 16 | c >>> 16) + d | 0;\n        b += (c ^ d ^ a) + k[6] + 76029189 | 0;\n        b  = (b << 23 | b >>> 9) + c | 0;\n        a += (b ^ c ^ d) + k[9] - 640364487 | 0;\n        a  = (a << 4 | a >>> 28) + b | 0;\n        d += (a ^ b ^ c) + k[12] - 421815835 | 0;\n        d  = (d << 11 | d >>> 21) + a | 0;\n        c += (d ^ a ^ b) + k[15] + 530742520 | 0;\n        c  = (c << 16 | c >>> 16) + d | 0;\n        b += (c ^ d ^ a) + k[2] - 995338651 | 0;\n        b  = (b << 23 | b >>> 9) + c | 0;\n\n        a += (c ^ (b | ~d)) + k[0] - 198630844 | 0;\n        a  = (a << 6 | a >>> 26) + b | 0;\n        d += (b ^ (a | ~c)) + k[7] + 1126891415 | 0;\n        d  = (d << 10 | d >>> 22) + a | 0;\n        c += (a ^ (d | ~b)) + k[14] - 1416354905 | 0;\n        c  = (c << 15 | c >>> 17) + d | 0;\n        b += (d ^ (c | ~a)) + k[5] - 57434055 | 0;\n        b  = (b << 21 |b >>> 11) + c | 0;\n        a += (c ^ (b | ~d)) + k[12] + 1700485571 | 0;\n        a  = (a << 6 | a >>> 26) + b | 0;\n        d += (b ^ (a | ~c)) + k[3] - 1894986606 | 0;\n        d  = (d << 10 | d >>> 22) + a | 0;\n        c += (a ^ (d | ~b)) + k[10] - 1051523 | 0;\n        c  = (c << 15 | c >>> 17) + d | 0;\n        b += (d ^ (c | ~a)) + k[1] - 2054922799 | 0;\n        b  = (b << 21 |b >>> 11) + c | 0;\n        a += (c ^ (b | ~d)) + k[8] + 1873313359 | 0;\n        a  = (a << 6 | a >>> 26) + b | 0;\n        d += (b ^ (a | ~c)) + k[15] - 30611744 | 0;\n        d  = (d << 10 | d >>> 22) + a | 0;\n        c += (a ^ (d | ~b)) + k[6] - 1560198380 | 0;\n        c  = (c << 15 | c >>> 17) + d | 0;\n        b += (d ^ (c | ~a)) + k[13] + 1309151649 | 0;\n        b  = (b << 21 |b >>> 11) + c | 0;\n        a += (c ^ (b | ~d)) + k[4] - 145523070 | 0;\n        a  = (a << 6 | a >>> 26) + b | 0;\n        d += (b ^ (a | ~c)) + k[11] - 1120210379 | 0;\n        d  = (d << 10 | d >>> 22) + a | 0;\n        c += (a ^ (d | ~b)) + k[2] + 718787259 | 0;\n        c  = (c << 15 | c >>> 17) + d | 0;\n        b += (d ^ (c | ~a)) + k[9] - 343485551 | 0;\n        b  = (b << 21 | b >>> 11) + c | 0;\n\n        x[0] = a + x[0] | 0;\n        x[1] = b + x[1] | 0;\n        x[2] = c + x[2] | 0;\n        x[3] = d + x[3] | 0;\n    }\n\n    function md5blk(s) {\n        var md5blks = [],\n            i; /* Andy King said do it this way. */\n\n        for (i = 0; i < 64; i += 4) {\n            md5blks[i >> 2] = s.charCodeAt(i) + (s.charCodeAt(i + 1) << 8) + (s.charCodeAt(i + 2) << 16) + (s.charCodeAt(i + 3) << 24);\n        }\n        return md5blks;\n    }\n\n    function md5blk_array(a) {\n        var md5blks = [],\n            i; /* Andy King said do it this way. */\n\n        for (i = 0; i < 64; i += 4) {\n            md5blks[i >> 2] = a[i] + (a[i + 1] << 8) + (a[i + 2] << 16) + (a[i + 3] << 24);\n        }\n        return md5blks;\n    }\n\n    function md51(s) {\n        var n = s.length,\n            state = [1732584193, -271733879, -1732584194, 271733878],\n            i,\n            length,\n            tail,\n            tmp,\n            lo,\n            hi;\n\n        for (i = 64; i <= n; i += 64) {\n            md5cycle(state, md5blk(s.substring(i - 64, i)));\n        }\n        s = s.substring(i - 64);\n        length = s.length;\n        tail = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0];\n        for (i = 0; i < length; i += 1) {\n            tail[i >> 2] |= s.charCodeAt(i) << ((i % 4) << 3);\n        }\n        tail[i >> 2] |= 0x80 << ((i % 4) << 3);\n        if (i > 55) {\n            md5cycle(state, tail);\n            for (i = 0; i < 16; i += 1) {\n                tail[i] = 0;\n            }\n        }\n\n        // Beware that the final length might not fit in 32 bits so we take care of that\n        tmp = n * 8;\n        tmp = tmp.toString(16).match(/(.*?)(.{0,8})$/);\n        lo = parseInt(tmp[2], 16);\n        hi = parseInt(tmp[1], 16) || 0;\n\n        tail[14] = lo;\n        tail[15] = hi;\n\n        md5cycle(state, tail);\n        return state;\n    }\n\n    function md51_array(a) {\n        var n = a.length,\n            state = [1732584193, -271733879, -1732584194, 271733878],\n            i,\n            length,\n            tail,\n            tmp,\n            lo,\n            hi;\n\n        for (i = 64; i <= n; i += 64) {\n            md5cycle(state, md5blk_array(a.subarray(i - 64, i)));\n        }\n\n        // Not sure if it is a bug, however IE10 will always produce a sub array of length 1\n        // containing the last element of the parent array if the sub array specified starts\n        // beyond the length of the parent array - weird.\n        // https://connect.microsoft.com/IE/feedback/details/771452/typed-array-subarray-issue\n        a = (i - 64) < n ? a.subarray(i - 64) : new Uint8Array(0);\n\n        length = a.length;\n        tail = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0];\n        for (i = 0; i < length; i += 1) {\n            tail[i >> 2] |= a[i] << ((i % 4) << 3);\n        }\n\n        tail[i >> 2] |= 0x80 << ((i % 4) << 3);\n        if (i > 55) {\n            md5cycle(state, tail);\n            for (i = 0; i < 16; i += 1) {\n                tail[i] = 0;\n            }\n        }\n\n        // Beware that the final length might not fit in 32 bits so we take care of that\n        tmp = n * 8;\n        tmp = tmp.toString(16).match(/(.*?)(.{0,8})$/);\n        lo = parseInt(tmp[2], 16);\n        hi = parseInt(tmp[1], 16) || 0;\n\n        tail[14] = lo;\n        tail[15] = hi;\n\n        md5cycle(state, tail);\n\n        return state;\n    }\n\n    function rhex(n) {\n        var s = '',\n            j;\n        for (j = 0; j < 4; j += 1) {\n            s += hex_chr[(n >> (j * 8 + 4)) & 0x0F] + hex_chr[(n >> (j * 8)) & 0x0F];\n        }\n        return s;\n    }\n\n    function hex(x) {\n        var i;\n        for (i = 0; i < x.length; i += 1) {\n            x[i] = rhex(x[i]);\n        }\n        return x.join('');\n    }\n\n    // In some cases the fast add32 function cannot be used..\n    if (hex(md51('hello')) !== '5d41402abc4b2a76b9719d911017c592') {\n        add32 = function (x, y) {\n            var lsw = (x & 0xFFFF) + (y & 0xFFFF),\n                msw = (x >> 16) + (y >> 16) + (lsw >> 16);\n            return (msw << 16) | (lsw & 0xFFFF);\n        };\n    }\n\n    // ---------------------------------------------------\n\n    /**\n     * ArrayBuffer slice polyfill.\n     *\n     * @see https://github.com/ttaubert/node-arraybuffer-slice\n     */\n\n    if (typeof ArrayBuffer !== 'undefined' && !ArrayBuffer.prototype.slice) {\n        (function () {\n            function clamp(val, length) {\n                val = (val | 0) || 0;\n\n                if (val < 0) {\n                    return Math.max(val + length, 0);\n                }\n\n                return Math.min(val, length);\n            }\n\n            ArrayBuffer.prototype.slice = function (from, to) {\n                var length = this.byteLength,\n                    begin = clamp(from, length),\n                    end = length,\n                    num,\n                    target,\n                    targetArray,\n                    sourceArray;\n\n                if (to !== undefined) {\n                    end = clamp(to, length);\n                }\n\n                if (begin > end) {\n                    return new ArrayBuffer(0);\n                }\n\n                num = end - begin;\n                target = new ArrayBuffer(num);\n                targetArray = new Uint8Array(target);\n\n                sourceArray = new Uint8Array(this, begin, num);\n                targetArray.set(sourceArray);\n\n                return target;\n            };\n        })();\n    }\n\n    // ---------------------------------------------------\n\n    /**\n     * Helpers.\n     */\n\n    function toUtf8(str) {\n        if (/[\\u0080-\\uFFFF]/.test(str)) {\n            str = unescape(encodeURIComponent(str));\n        }\n\n        return str;\n    }\n\n    function utf8Str2ArrayBuffer(str, returnUInt8Array) {\n        var length = str.length,\n           buff = new ArrayBuffer(length),\n           arr = new Uint8Array(buff),\n           i;\n\n        for (i = 0; i < length; i += 1) {\n            arr[i] = str.charCodeAt(i);\n        }\n\n        return returnUInt8Array ? arr : buff;\n    }\n\n    function arrayBuffer2Utf8Str(buff) {\n        return String.fromCharCode.apply(null, new Uint8Array(buff));\n    }\n\n    function concatenateArrayBuffers(first, second, returnUInt8Array) {\n        var result = new Uint8Array(first.byteLength + second.byteLength);\n\n        result.set(new Uint8Array(first));\n        result.set(new Uint8Array(second), first.byteLength);\n\n        return returnUInt8Array ? result : result.buffer;\n    }\n\n    function hexToBinaryString(hex) {\n        var bytes = [],\n            length = hex.length,\n            x;\n\n        for (x = 0; x < length - 1; x += 2) {\n            bytes.push(parseInt(hex.substr(x, 2), 16));\n        }\n\n        return String.fromCharCode.apply(String, bytes);\n    }\n\n    // ---------------------------------------------------\n\n    /**\n     * SparkMD5 OOP implementation.\n     *\n     * Use this class to perform an incremental md5, otherwise use the\n     * static methods instead.\n     */\n\n    function SparkMD5() {\n        // call reset to init the instance\n        this.reset();\n    }\n\n    /**\n     * Appends a string.\n     * A conversion will be applied if an utf8 string is detected.\n     *\n     * @param {String} str The string to be appended\n     *\n     * @return {SparkMD5} The instance itself\n     */\n    SparkMD5.prototype.append = function (str) {\n        // Converts the string to utf8 bytes if necessary\n        // Then append as binary\n        this.appendBinary(toUtf8(str));\n\n        return this;\n    };\n\n    /**\n     * Appends a binary string.\n     *\n     * @param {String} contents The binary string to be appended\n     *\n     * @return {SparkMD5} The instance itself\n     */\n    SparkMD5.prototype.appendBinary = function (contents) {\n        this._buff += contents;\n        this._length += contents.length;\n\n        var length = this._buff.length,\n            i;\n\n        for (i = 64; i <= length; i += 64) {\n            md5cycle(this._hash, md5blk(this._buff.substring(i - 64, i)));\n        }\n\n        this._buff = this._buff.substring(i - 64);\n\n        return this;\n    };\n\n    /**\n     * Finishes the incremental computation, reseting the internal state and\n     * returning the result.\n     *\n     * @param {Boolean} raw True to get the raw string, false to get the hex string\n     *\n     * @return {String} The result\n     */\n    SparkMD5.prototype.end = function (raw) {\n        var buff = this._buff,\n            length = buff.length,\n            i,\n            tail = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],\n            ret;\n\n        for (i = 0; i < length; i += 1) {\n            tail[i >> 2] |= buff.charCodeAt(i) << ((i % 4) << 3);\n        }\n\n        this._finish(tail, length);\n        ret = hex(this._hash);\n\n        if (raw) {\n            ret = hexToBinaryString(ret);\n        }\n\n        this.reset();\n\n        return ret;\n    };\n\n    /**\n     * Resets the internal state of the computation.\n     *\n     * @return {SparkMD5} The instance itself\n     */\n    SparkMD5.prototype.reset = function () {\n        this._buff = '';\n        this._length = 0;\n        this._hash = [1732584193, -271733879, -1732584194, 271733878];\n\n        return this;\n    };\n\n    /**\n     * Gets the internal state of the computation.\n     *\n     * @return {Object} The state\n     */\n    SparkMD5.prototype.getState = function () {\n        return {\n            buff: this._buff,\n            length: this._length,\n            hash: this._hash.slice()\n        };\n    };\n\n    /**\n     * Gets the internal state of the computation.\n     *\n     * @param {Object} state The state\n     *\n     * @return {SparkMD5} The instance itself\n     */\n    SparkMD5.prototype.setState = function (state) {\n        this._buff = state.buff;\n        this._length = state.length;\n        this._hash = state.hash;\n\n        return this;\n    };\n\n    /**\n     * Releases memory used by the incremental buffer and other additional\n     * resources. If you plan to use the instance again, use reset instead.\n     */\n    SparkMD5.prototype.destroy = function () {\n        delete this._hash;\n        delete this._buff;\n        delete this._length;\n    };\n\n    /**\n     * Finish the final calculation based on the tail.\n     *\n     * @param {Array}  tail   The tail (will be modified)\n     * @param {Number} length The length of the remaining buffer\n     */\n    SparkMD5.prototype._finish = function (tail, length) {\n        var i = length,\n            tmp,\n            lo,\n            hi;\n\n        tail[i >> 2] |= 0x80 << ((i % 4) << 3);\n        if (i > 55) {\n            md5cycle(this._hash, tail);\n            for (i = 0; i < 16; i += 1) {\n                tail[i] = 0;\n            }\n        }\n\n        // Do the final computation based on the tail and length\n        // Beware that the final length may not fit in 32 bits so we take care of that\n        tmp = this._length * 8;\n        tmp = tmp.toString(16).match(/(.*?)(.{0,8})$/);\n        lo = parseInt(tmp[2], 16);\n        hi = parseInt(tmp[1], 16) || 0;\n\n        tail[14] = lo;\n        tail[15] = hi;\n        md5cycle(this._hash, tail);\n    };\n\n    /**\n     * Performs the md5 hash on a string.\n     * A conversion will be applied if utf8 string is detected.\n     *\n     * @param {String}  str The string\n     * @param {Boolean} [raw] True to get the raw string, false to get the hex string\n     *\n     * @return {String} The result\n     */\n    SparkMD5.hash = function (str, raw) {\n        // Converts the string to utf8 bytes if necessary\n        // Then compute it using the binary function\n        return SparkMD5.hashBinary(toUtf8(str), raw);\n    };\n\n    /**\n     * Performs the md5 hash on a binary string.\n     *\n     * @param {String}  content The binary string\n     * @param {Boolean} [raw]     True to get the raw string, false to get the hex string\n     *\n     * @return {String} The result\n     */\n    SparkMD5.hashBinary = function (content, raw) {\n        var hash = md51(content),\n            ret = hex(hash);\n\n        return raw ? hexToBinaryString(ret) : ret;\n    };\n\n    // ---------------------------------------------------\n\n    /**\n     * SparkMD5 OOP implementation for array buffers.\n     *\n     * Use this class to perform an incremental md5 ONLY for array buffers.\n     */\n    SparkMD5.ArrayBuffer = function () {\n        // call reset to init the instance\n        this.reset();\n    };\n\n    /**\n     * Appends an array buffer.\n     *\n     * @param {ArrayBuffer} arr The array to be appended\n     *\n     * @return {SparkMD5.ArrayBuffer} The instance itself\n     */\n    SparkMD5.ArrayBuffer.prototype.append = function (arr) {\n        var buff = concatenateArrayBuffers(this._buff.buffer, arr, true),\n            length = buff.length,\n            i;\n\n        this._length += arr.byteLength;\n\n        for (i = 64; i <= length; i += 64) {\n            md5cycle(this._hash, md5blk_array(buff.subarray(i - 64, i)));\n        }\n\n        this._buff = (i - 64) < length ? new Uint8Array(buff.buffer.slice(i - 64)) : new Uint8Array(0);\n\n        return this;\n    };\n\n    /**\n     * Finishes the incremental computation, reseting the internal state and\n     * returning the result.\n     *\n     * @param {Boolean} raw True to get the raw string, false to get the hex string\n     *\n     * @return {String} The result\n     */\n    SparkMD5.ArrayBuffer.prototype.end = function (raw) {\n        var buff = this._buff,\n            length = buff.length,\n            tail = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],\n            i,\n            ret;\n\n        for (i = 0; i < length; i += 1) {\n            tail[i >> 2] |= buff[i] << ((i % 4) << 3);\n        }\n\n        this._finish(tail, length);\n        ret = hex(this._hash);\n\n        if (raw) {\n            ret = hexToBinaryString(ret);\n        }\n\n        this.reset();\n\n        return ret;\n    };\n\n    /**\n     * Resets the internal state of the computation.\n     *\n     * @return {SparkMD5.ArrayBuffer} The instance itself\n     */\n    SparkMD5.ArrayBuffer.prototype.reset = function () {\n        this._buff = new Uint8Array(0);\n        this._length = 0;\n        this._hash = [1732584193, -271733879, -1732584194, 271733878];\n\n        return this;\n    };\n\n    /**\n     * Gets the internal state of the computation.\n     *\n     * @return {Object} The state\n     */\n    SparkMD5.ArrayBuffer.prototype.getState = function () {\n        var state = SparkMD5.prototype.getState.call(this);\n\n        // Convert buffer to a string\n        state.buff = arrayBuffer2Utf8Str(state.buff);\n\n        return state;\n    };\n\n    /**\n     * Gets the internal state of the computation.\n     *\n     * @param {Object} state The state\n     *\n     * @return {SparkMD5.ArrayBuffer} The instance itself\n     */\n    SparkMD5.ArrayBuffer.prototype.setState = function (state) {\n        // Convert string to buffer\n        state.buff = utf8Str2ArrayBuffer(state.buff, true);\n\n        return SparkMD5.prototype.setState.call(this, state);\n    };\n\n    SparkMD5.ArrayBuffer.prototype.destroy = SparkMD5.prototype.destroy;\n\n    SparkMD5.ArrayBuffer.prototype._finish = SparkMD5.prototype._finish;\n\n    /**\n     * Performs the md5 hash on an array buffer.\n     *\n     * @param {ArrayBuffer} arr The array buffer\n     * @param {Boolean}     [raw] True to get the raw string, false to get the hex one\n     *\n     * @return {String} The result\n     */\n    SparkMD5.ArrayBuffer.hash = function (arr, raw) {\n        var hash = md51_array(new Uint8Array(arr)),\n            ret = hex(hash);\n\n        return raw ? hexToBinaryString(ret) : ret;\n    };\n\n    return SparkMD5;\n}));\n","var nextTick = require('process/browser.js').nextTick;\nvar apply = Function.prototype.apply;\nvar slice = Array.prototype.slice;\nvar immediateIds = {};\nvar nextImmediateId = 0;\n\n// DOM APIs, for completeness\n\nexports.setTimeout = function() {\n  return new Timeout(apply.call(setTimeout, window, arguments), clearTimeout);\n};\nexports.setInterval = function() {\n  return new Timeout(apply.call(setInterval, window, arguments), clearInterval);\n};\nexports.clearTimeout =\nexports.clearInterval = function(timeout) { timeout.close(); };\n\nfunction Timeout(id, clearFn) {\n  this._id = id;\n  this._clearFn = clearFn;\n}\nTimeout.prototype.unref = Timeout.prototype.ref = function() {};\nTimeout.prototype.close = function() {\n  this._clearFn.call(window, this._id);\n};\n\n// Does not start the time, just sets up the members needed.\nexports.enroll = function(item, msecs) {\n  clearTimeout(item._idleTimeoutId);\n  item._idleTimeout = msecs;\n};\n\nexports.unenroll = function(item) {\n  clearTimeout(item._idleTimeoutId);\n  item._idleTimeout = -1;\n};\n\nexports._unrefActive = exports.active = function(item) {\n  clearTimeout(item._idleTimeoutId);\n\n  var msecs = item._idleTimeout;\n  if (msecs >= 0) {\n    item._idleTimeoutId = setTimeout(function onTimeout() {\n      if (item._onTimeout)\n        item._onTimeout();\n    }, msecs);\n  }\n};\n\n// That's not how node.js implements it but the exposed api is the same.\nexports.setImmediate = typeof setImmediate === \"function\" ? setImmediate : function(fn) {\n  var id = nextImmediateId++;\n  var args = arguments.length < 2 ? false : slice.call(arguments, 1);\n\n  immediateIds[id] = true;\n\n  nextTick(function onNextTick() {\n    if (immediateIds[id]) {\n      // fn.call() is faster so we optimize for the common use-case\n      // @see http://jsperf.com/call-apply-segu\n      if (args) {\n        fn.apply(null, args);\n      } else {\n        fn.call(null);\n      }\n      // Prevent ids from leaking\n      exports.clearImmediate(id);\n    }\n  });\n\n  return id;\n};\n\nexports.clearImmediate = typeof clearImmediate === \"function\" ? clearImmediate : function(id) {\n  delete immediateIds[id];\n};","import { Config } from './global';\nimport { BabylonLoader } from './middleware/loader/babylonLoader';\nimport { PostParam } from '../tools/axios';\nimport { UUid } from './utility/uuid'\nimport { getJsonConfig, upLoadJsonConfig, login } from '../tools/ossfile';\n\nexport class InitializeData {\n\n    public constructor() {\n        this.init();\n    }\n    private init = async () => {\n        // TODO\n        Config.projectID = window.location.pathname.substring(8);\n        try {\n            var refer = document.referrer;\n            var data = await login(Config.projectID, refer);\n            if (data.code === '00000') {\n                Config.projectName = data.data;\n                document.title = Config.projectName + ' - 万维引擎';\n                editor.call('toolbar.project.set', Config.projectName);\n                let tmpStr = await getJsonConfig(Config.projectID, 'assets');\n                if (tmpStr === '') {\n                    // console.log(tmpStr);\n                    upLoadJsonConfig(Config.assetStandard, Config.projectID, 'assets');\n                    Config.assetsData = JSON.parse(Config.assetStandard);\n                }\n                else {\n                    Config.assetsData = JSON.parse(tmpStr);\n                }\n                //地址引用？\n                BabylonLoader.assetsData = Config.assetsData;\n                editor.call('initAssets', Config.assetsData);\n                tmpStr = await getJsonConfig(Config.projectID, 'scenes');\n                if (tmpStr === '') {\n                    tmpStr = Config.sceneStandard;\n                    var sceneData = JSON.parse(tmpStr);\n                    sceneData['scenes'][0]['id'] = UUid.createUuid().substring(0, 8);\n                    var createdTime = UUid.createdAtTime();\n                    sceneData['scenes'][0]['projectId'] = Config.projectID;\n                    sceneData['scenes'][0]['created'] = createdTime;\n                    sceneData['scenes'][0]['modified'] = createdTime;\n                    tmpStr = JSON.stringify(sceneData);\n                    upLoadJsonConfig(tmpStr, Config.projectID, 'scenes');\n                }\n                let tmpData = JSON.parse(tmpStr);\n                let lastScene: number = tmpData.last;\n                Config.scenesData = tmpData.scenes[lastScene];\n                Config.sceneIndex = lastScene;\n                BabylonLoader.scenesData = Config.scenesData;\n                BabylonLoader.sceneIndex = lastScene;\n                editor.emit('scene:raw', Config.scenesData);\n                editor.call('toolbar.scene.set', Config.scenesData.name);\n            }\n            else {\n                console.error(data.message);\n            }\n        }\n        catch (error) {\n            console.error(error);\n        }\n    }\n}","import { Menu, MenuItem } from '../../ui';\nimport { VeryEngine } from '../../engine';\nimport { Observer } from '../../lib';\n\nexport class AssetsContextMenu {\n    public constructor() {\n\n        var currentAsset: any = null;\n        // var legacyScripts = editor.call('settings:project').get('useLegacyScripts');\n        var legacyScripts = false;\n        var root = VeryEngine.root;\n\n        var customMenuItems: any = [];\n\n        // menu\n        var menu = new Menu();\n        root.append(menu);\n\n\n        // edit\n        var menuItemNewScript = new MenuItem({\n            text: 'New Script',\n            icon: '&#57864;',\n            value: 'script'\n        });\n        menuItemNewScript.on('select', function () {\n            if (legacyScripts) {\n                editor.call('sourcefiles:new');\n            } else {\n                editor.call('picker:script-create', function (filename: string) {\n                    editor.call('assets:create:script', {\n                        filename: filename,\n                        boilerplate: true\n                    });\n                });\n            }\n        });\n        menu.append(menuItemNewScript);\n\n        // new asset\n        var menuItemNew = new MenuItem({\n            text: '添加资源',\n            icon: '&#57632;',\n            value: 'new'\n        });\n        menu.append(menuItemNew);\n\n        var downloadable: any = {\n            'texture': 1,\n            'textureatlas': 1,\n            'html': 1,\n            'table': 1,\n            'shader': 1,\n            'scene': 1,\n            'json': 1,\n            'audio': 1,\n            'text': 1\n        };\n\n        var icons: any = {\n            'upload': '&#57909;',\n            'folder': '&#57657;',\n            'table': '&#57864;',\n            'cubemap': '&#57879;',\n            'html': '&#57864;',\n            'json': '&#57864;',\n            'layers': '&#57992',\n            'material': '&#57749;',\n            'script': '&#57864;',\n            'shader': '&#57864;',\n            'text': '&#57864;',\n            'texture': '&#57857;',\n            'textureatlas': '&#57857;',\n            'model': '&#57735;',\n            'scene': '&#57735;',\n            'animation': '&#57875;',\n            'audio': '&#57872;',\n            'bundle': '&#58384;'\n        };\n\n        var ICONS: any = {\n            REFERENCES: '&#57622;',\n            TEXTURE_ATLAS: '&#58162;',\n            SPRITE_ASSET: '&#58261;',\n            REPLACE: '&#57640;',\n            REIMPORT: '&#57889;',\n            DOWNLOAD: '&#57896;',\n            EDIT: '&#57648;',\n            DUPLICATE: '&#57638;',\n            DELETE: '&#57636;',\n            SCENE_SETTINGS: '&#57652;'\n        };\n\n        // var assets: any = {\n        //     'upload': '上传',\n        //     'folder': '新建文件夹',\n        //     'css': '表格',\n        //     'cubemap': 'CubeMap',\n        //     'html': 'HTML',\n        //     'json': 'JSON',\n        //     'material': '材质',\n        //     'script': 'Script',\n        //     'shader': 'Shader',\n        //     'text': 'Text'\n        // };\n\n        var assets: any = {\n            'upload': '上传',\n            'folder': '新建文件夹',\n            'table': '表格',\n            // 'material': '材质'\n        };\n\n        // if (editor.call('users:hasFlag', 'hasBundles')) {\n        //     assets.bundle = 'Asset Bundle';\n        // }\n\n        var addNewMenuItem = function (key: string, title: string) {\n            // new folder\n            var item = new MenuItem({\n                text: title,\n                icon: icons[key] || '',\n                value: key\n            });\n            item.on('select', function () {\n                var args: any = {};\n\n                if (currentAsset && currentAsset.get('type') === 'folder') {\n                    args.parent = currentAsset;\n                } else if (currentAsset === undefined) {\n                    args.parent = null;\n                }\n\n                if (key === 'upload') {\n                    editor.call('assets:upload:picker', args);\n                } else if (key === 'script') {\n                    if (legacyScripts) {\n                        editor.call('sourcefiles:new');\n                    } else {\n                        editor.call('picker:script-create', function (filename: string) {\n                            editor.call('assets:create:script', {\n                                filename: filename,\n                                boilerplate: true\n                            });\n                        });\n                    }\n                } else {\n                    editor.call('assets:create:' + key, args)\n                }\n            });\n            menuItemNew.append(item);\n\n            if (key === 'script') {\n                editor.on('repositories:load', function (repositories: any) {\n                    if (repositories.get('current') !== 'directory')\n                        item.disabled = true;\n                });\n            }\n        };\n\n        var keys = Object.keys(assets);\n        for (var i = 0; i < keys.length; i++) {\n            if (!assets.hasOwnProperty(keys[i]))\n                continue;\n\n            addNewMenuItem(keys[i], assets[keys[i]]);\n        }\n\n        // related\n        // var menuItemReferences = new MenuItem({\n        //     text: 'References',\n        //     icon: ICONS.REFERENCES,\n        //     value: 'references'\n        // });\n        // menu.append(menuItemReferences);\n\n        // Create Atlas\n        // var menuItemTextureToAtlas = new MenuItem({\n        //     text: 'Create Texture Atlas',\n        //     icon: ICONS.TEXTURE_ATLAS,\n        //     value: 'texture-to-atlas'\n        // });\n        // menu.append(menuItemTextureToAtlas);\n\n        // menuItemTextureToAtlas.on('select', function () {\n        //     editor.call('assets:textureToAtlas', currentAsset);\n        // });\n\n        // Create Sprite From Atlas\n        // var menuItemCreateSprite = new MenuItem({\n        //     text: 'Create Sprite Asset',\n        //     icon: ICONS.SPRITE_ASSET,\n        //     value: 'atlas-to-sprite'\n        // });\n        // menu.append(menuItemCreateSprite);\n\n        // menuItemCreateSprite.on('select', function () {\n        //     editor.call('assets:atlasToSprite', {\n        //         asset: currentAsset\n        //     });\n        // });\n\n        // Create Sliced Sprite From Atlas\n        // var menuItemCreateSlicedSprite = new MenuItem({\n        //     text: 'Create Sliced Sprite Asset',\n        //     icon: ICONS.SPRITE_ASSET,\n        //     value: 'atlas-to-sliced-sprite'\n        // });\n        // menu.append(menuItemCreateSlicedSprite);\n\n        // menuItemCreateSlicedSprite.on('select', function () {\n        //     editor.call('assets:atlasToSprite', {\n        //         asset: currentAsset,\n        //         sliced: true\n        //     });\n        // });\n\n        // replace\n        var replaceAvailable: any = {\n            material: true,\n            texture: true,\n            textureatlas: true,\n            model: true,\n            animation: true,\n            audio: true,\n            cubemap: true,\n            css: true,\n            html: true,\n            shader: true,\n            sprite: true,\n            json: true,\n            text: true\n        };\n        var menuItemReplace = new MenuItem({\n            text: '加载',\n            icon: ICONS.REPLACE,\n            value: 'replace'\n        });\n        menuItemReplace.on('select', function () {\n            // console.log(currentAsset)\n            // console.log(currentAsset.origin)\n            editor.call('load:from:asset', currentAsset);\n            // var id = parseInt(currentAsset.get('id'), 10);\n            // console.log(currentAsset.get('name'));\n            // editor.call('picker:asset', {\n            //     type: currentAsset.get('type'),\n            //     currentAsset: currentAsset\n            // });\n\n            // var evtPick: Nullable<EventHandle> = editor.once('picker:asset', function (asset: Observer) {\n            //     editor.call('assets:replace', currentAsset, asset);\n            //     evtPick = null;\n            // });\n\n            // editor.once('picker:asset:close', function () {\n            //     if (evtPick) {\n            //         evtPick.unbind();\n            //         evtPick = null;\n            //     }\n            // });\n        });\n        menu.append(menuItemReplace);\n\n        // var menuItemReplaceTextureToSprite = new MenuItem({\n        //     text: 'Convert Texture To Sprite',\n        //     icon: ICONS.SPRITE_ASSET,\n        //     value: 'replaceTextureToSprite'\n        // });\n        // menuItemReplaceTextureToSprite.on('select', function () {\n        //     var id = parseInt(currentAsset.get('id'), 10);\n\n        //     editor.call('picker:asset', {\n        //         type: 'sprite',\n        //         currentAsset: currentAsset\n        //     });\n\n        //     var evtPick: Nullable<EventHandle> = editor.once('picker:asset', function (asset: Observer) {\n        //         editor.call('assets:replaceTextureToSprite', currentAsset, asset);\n        //         evtPick = null;\n        //     });\n\n        //     editor.once('picker:asset:close', function () {\n        //         if (evtPick) {\n        //             evtPick.unbind();\n        //             evtPick = null;\n        //         }\n        //     });\n        // });\n        // menu.append(menuItemReplaceTextureToSprite);\n\n        // extract. Used for source assets.\n        // var menuItemExtract = new MenuItem({\n        //     text: 'Re-Import',\n        //     icon: ICONS.REIMPORT,\n        //     value: 'extract'\n        // });\n        // menuItemExtract.on('select', function () {\n        //     editor.call(\n        //         'assets:reimport',\n        //         currentAsset.get('id'),\n        //         currentAsset.get('type')\n        //     );\n        // });\n        // menu.append(menuItemExtract);\n\n        // re-import. Used for target assets.\n        // var menuItemReImport = new MenuItem({\n        //     text: 'Re-Import',\n        //     icon: ICONS.REIMPORT,\n        //     value: 're-import'\n        // });\n        // menuItemReImport.on('select', function () {\n        //     editor.call(\n        //         'assets:reimport',\n        //         currentAsset.get('id'),\n        //         currentAsset.get('type')\n        //     );\n        // });\n        // menu.append(menuItemReImport);\n\n        // download\n        // var menuItemDownload = new MenuItem({\n        //     text: '下载',\n        //     icon: ICONS.DOWNLOAD,\n        //     value: 'download'\n        // });\n        // menuItemDownload.on('select', function () {\n        //     window.open(currentAsset.get('file.url'));\n        // });\n        // menu.append(menuItemDownload);\n\n        // edit\n        var menuItemEdit = new MenuItem({\n            text: '编辑',\n            icon: ICONS.EDIT,\n            value: 'edit'\n        });\n        menuItemEdit.on('select', function () {\n            // editor.call('assets:edit', currentAsset);\n            // console.log('编辑表格');\n            // console.warn(currentAsset);\n            editor.call('assets:open-table', currentAsset.get('name'));\n\n        });\n        menu.append(menuItemEdit);\n\n        // duplicate\n        var menuItemDuplicate = new MenuItem({\n            text: '创建副本',\n            icon: ICONS.DUPLICATE,\n            value: 'duplicate'\n        });\n        menuItemDuplicate.on('select', function () {\n            editor.call('status:text', '抱歉，创建副本功能待添加！');\n            editor.call('assets:duplicate', currentAsset);\n        });\n        menu.append(menuItemDuplicate);\n\n        // delete\n        var menuItemDelete = new MenuItem({\n            text: '删除',\n            icon: ICONS.DELETE,\n            value: 'delete'\n        });\n        menuItemDelete.style!.fontWeight = '200';\n        menuItemDelete.on('select', function () {\n\n            editor.call('status:text', '抱歉，删除功能待添加！');\n            var asset = currentAsset;\n            var multiple = false;\n\n            if (asset) {\n                var assetType = asset.get('type');\n                var type = editor.call('selector:type');\n                var items;\n\n                if (type === 'asset') {\n                    items = editor.call('selector:items');\n                    for (var i = 0; i < items.length; i++) {\n                        // if the asset that was right-clicked is in the selection\n                        // then include all the other selected items in the delete\n                        // otherwise only delete the right-clicked item\n                        if (assetType === 'script' && legacyScripts) {\n                            if (\n                                items[i].get('filename') === asset.get('filename')\n                            ) {\n                                multiple = true;\n                                break;\n                            }\n                        } else if (items[i].get('id') === asset.get('id')) {\n                            multiple = true;\n                            break;\n                        }\n                    }\n                }\n\n                editor.call('assets:delete:picker', multiple ? items : [asset]);\n            }\n        });\n        menu.append(menuItemDelete);\n\n        // filter buttons\n        menu.on('open', function () {\n            menuItemNewScript.hidden = !((currentAsset === null || (currentAsset && currentAsset.get('type') === 'script')) && editor.call('assets:panel:currentFolder') === 'scripts');\n            menuItemNew.hidden = !menuItemNewScript.hidden;\n\n            if (currentAsset) {\n                // download，TODO：下载菜单\n                // menuItemDownload.hidden = true;\n                // menuItemDownload.hidden = !(\n                //     (!config.project.privateAssets ||\n                //         (config.project.privateAssets &&\n                //             editor.call('permissions:read'))) &&\n                //     currentAsset.get('type') !== 'folder' &&\n                //     (currentAsset.get('source') ||\n                //         downloadable[currentAsset.get('type')] ||\n                //         (!legacyScripts &&\n                //             currentAsset.get('type') === 'script')) &&\n                //     currentAsset.get('file.url')\n                // );\n\n                // duplicate\n                if (currentAsset.get('type') === 'material' ||\n                    currentAsset.get('type') === 'sprite') {\n                    menuItemEdit.hidden = true;\n                    if (editor.call('selector:type') === 'asset') {\n                        var items = editor.call('selector:items');\n                        menuItemDuplicate.hidden =\n                            items.length > 1 && items.indexOf(currentAsset) !== -1;\n                    } else {\n                        menuItemDuplicate.hidden = false;\n                    }\n                } else {\n                    menuItemDuplicate.hidden = true;\n                }\n\n                // edit\n                if (!currentAsset.get('source') &&\n                    ['html', 'table', 'json', 'text', 'script', 'shader'].indexOf(currentAsset.get('type')) !== -1) {\n                    if (editor.call('selector:type') === 'asset') {\n                        var items = editor.call('selector:items');\n                        menuItemEdit.hidden =\n                            items.length > 1 && items.indexOf(currentAsset) !== -1;\n                    } else {\n                        menuItemEdit.hidden = false;\n                    }\n                } else {\n                    menuItemEdit.hidden = true;\n                }\n\n                // create atlas\n                // menuItemTextureToAtlas.hidden =\n                //     currentAsset.get('type') !== 'texture' ||\n                //     currentAsset.get('source') ||\n                //     currentAsset.get('task') ||\n                //     !editor.call('permissions:write');\n\n                // create sprite\n                // menuItemCreateSprite.hidden =\n                //     currentAsset.get('type') !== 'textureatlas' ||\n                //     currentAsset.get('source') ||\n                //     currentAsset.get('task') ||\n                //     !editor.call('permissions:write');\n                // menuItemCreateSlicedSprite.hidden = menuItemCreateSprite.hidden;\n\n                // delete\n                menuItemDelete.hidden = false;\n\n                if (!currentAsset.get('source')) {\n                    // menuItemExtract.hidden = true;\n\n                    // re-import\n                    var sourceId = currentAsset.get('source_asset_id');\n                    if (sourceId) {\n                        var source = editor.call('assets:get', sourceId);\n                        if (source) {\n                            if (\n                                source.get('type') === 'scene' &&\n                                (['texture', 'material'].indexOf(\n                                    currentAsset.get('type')\n                                ) !== -1 ||\n                                    !source.get('meta'))\n                            ) {\n                                // menuItemReImport.hidden = true;\n                            } else if (\n                                currentAsset.get('type') === 'animation' &&\n                                !source.get('meta.animation.available')\n                            ) {\n                                // menuItemReImport.hidden = true;\n                            } else if (\n                                currentAsset.get('type') === 'material' &&\n                                !currentAsset.has('meta.index')\n                            ) {\n                                // menuItemReImport.hidden = true;\n                            } else {\n                                // menuItemReImport.hidden = false;\n                            }\n                        } else {\n                            // menuItemReImport.hidden = true;\n                        }\n                    } else {\n                        // menuItemReImport.hidden = true;\n                    }\n\n                    // references\n                    // var ref = editor.call('assets:used:index')[\n                    //     currentAsset.get('id')\n                    // ];\n                    // if (ref && ref.count && ref.ref) {\n                    //     menuItemReferences.hidden = false;\n                    //     menuItemReplace.hidden = replaceAvailable[\n                    //         currentAsset.get('type')\n                    //     ]\n                    //         ? false\n                    //         : true;\n                    //     menuItemReplaceTextureToSprite.hidden =\n                    //         !editor.call('users:hasFlag', 'hasTextureToSprite') ||\n                    //         currentAsset.get('type') !== 'texture';\n\n                    //     while (menuItemReferences.innerElement!.firstChild)\n                    //         (<HTMLElement>menuItemReferences.innerElement!.firstChild).ui.destroy();\n\n                    //     var menuItems: any = [];\n\n                    //     var addReferenceItem = function (type: string, id: string) {\n                    //         var menuItem = new MenuItem();\n                    //         var item: any = null;\n\n                    //         if (type === 'editorSettings') {\n                    //             menuItem.text = 'Scene Settings';\n                    //             menuItem.icon = ICONS.SCENE_SETTINGS;\n                    //             item = editor.call('settings:projectUser');\n                    //             if (!item) return;\n                    //         } else {\n                    //             if (type === 'entity') {\n                    //                 item = editor.call('entities:get', id);\n                    //                 menuItem.icon = '&#57734;';\n                    //             } else if (type === 'asset') {\n                    //                 item = editor.call('assets:get', id);\n                    //                 menuItem.icon = icons[item.get('type')] || '';\n                    //             }\n                    //             if (!item) return;\n                    //             menuItem.text = item.get('name');\n                    //         }\n\n                    //         menuItems.push({\n                    //             name: menuItem.text,\n                    //             type: type,\n                    //             element: menuItem\n                    //         });\n\n                    //         menuItem.on('select', function () {\n                    //             editor.call('selector:set', type, [item]);\n\n                    //             var folder = null;\n                    //             var path = item.get('path') || [];\n                    //             if (path.length)\n                    //                 folder = editor.call(\n                    //                     'assets:get',\n                    //                     path[path.length - 1]\n                    //                 );\n\n                    //             editor.call('assets:panel:currentFolder', folder);\n\n                    //             // unfold rendering tab\n                    //             if (type === 'editorSettings') {\n                    //                 setTimeout(function () {\n                    //                     editor.call(\n                    //                         'editorSettings:panel:unfold',\n                    //                         'rendering'\n                    //                     );\n                    //                 }, 0);\n                    //             }\n                    //         });\n                    //     };\n\n                    //     for (var key in ref.ref)\n                    //         addReferenceItem(ref.ref[key].type, key);\n\n                    //     var typeSort: any = {\n                    //         editorSettings: 1,\n                    //         asset: 2,\n                    //         entity: 3\n                    //     };\n\n                    //     menuItems.sort(function (a: any, b: any) {\n                    //         if (a.type !== b.type) {\n                    //             return typeSort[a.type] - typeSort[b.type];\n                    //         } else {\n                    //             if (a.name > b.name) {\n                    //                 return 1;\n                    //             } else if (a.name < b.name) {\n                    //                 return -1;\n                    //             } else {\n                    //                 return 0;\n                    //             }\n                    //         }\n                    //     });\n\n                    //     for (var i = 0; i < menuItems.length; i++)\n                    //         menuItemReferences.append(menuItems[i].element);\n                    // } else {\n                    //     menuItemReferences.hidden = true;\n                    //     menuItemReplace.hidden = true;\n                    //     menuItemReplaceTextureToSprite.hidden = true;\n                    // }\n                } else {\n                    // menuItemReferences.hidden = true;\n                    menuItemReplace.hidden = true;\n                    // menuItemReplaceTextureToSprite.hidden = true;\n                    // menuItemReImport.hidden = true;\n                    // menuItemExtract.hidden =\n                    //     ['scene', 'texture', 'textureatlas'].indexOf(\n                    //         currentAsset.get('type')\n                    //     ) === -1 || !currentAsset.get('meta');\n                }\n            } else {\n                // no asset\n                // menuItemExtract.hidden = true;\n                // menuItemReImport.hidden = true;\n                // menuItemDownload.hidden = true;\n                menuItemDuplicate.hidden = true;\n                menuItemEdit.hidden = true;\n                menuItemDelete.hidden = true;\n                // menuItemReferences.hidden = true;\n                menuItemReplace.hidden = true;\n                // menuItemReplaceTextureToSprite.hidden = true;\n                // menuItemTextureToAtlas.hidden = true;\n                // menuItemCreateSprite.hidden = true;\n                // menuItemCreateSlicedSprite.hidden = true;\n            }\n\n            for (var i = 0; i < customMenuItems.length; i++) {\n                if (!customMenuItems[i].filter) continue;\n\n                customMenuItems[i].hidden = !customMenuItems[i].filter(\n                    currentAsset\n                );\n            }\n        });\n\n\n\n\n        // for each asset added\n        editor.on('assets:add', function (asset: Observer) {\n\n            // get grid item\n            var item = editor.call('assets:panel:get', asset.get('id'));\n            if (!item) return;\n\n            // 右键功能\n            var contextMenuHandler = function (evt: MouseEvent) {\n                evt.stopPropagation();\n                evt.preventDefault();\n\n                // if (!editor.call('permissions:write')) return;\n                currentAsset = asset;\n                // 打开菜单\n                menu.open = true;\n                menu.position(evt.clientX + 1, evt.clientY);\n                // \n            };\n\n            // grid\n            item.element.addEventListener('contextmenu', contextMenuHandler, false);\n\n            // \n\n            // tree, 给tree item也加上右键菜单\n            if (item.tree) {\n                item.tree.elementTitle.addEventListener(\n                    'contextmenu',\n                    contextMenuHandler,\n                    false\n                );\n            }\n        });\n\n        // folders\n        editor.call('assets:panel:folders').innerElement.addEventListener('contextmenu', function (evt: MouseEvent) {\n            evt.preventDefault();\n            evt.stopPropagation();\n\n            // if (!editor.call('permissions:write'))\n            //     return;\n\n            currentAsset = undefined;\n            menu.open = true;\n            menu.position(evt.clientX + 1, evt.clientY);\n        }, false);\n\n        // files\n        editor.call('assets:panel:files').innerElement.addEventListener('contextmenu', function (evt: MouseEvent) {\n            evt.preventDefault();\n            evt.stopPropagation();\n\n            // if (!editor.call('permissions:write'))\n            //     return;\n\n            currentAsset = null;\n            menu.open = true;\n            menu.position(evt.clientX + 1, evt.clientY);\n        }, false);\n\n\n\n    }\n}","import { Config } from \"../global\";\n\nexport class AssetsCreateFolder {\n\n    public constructor() {\n\n        editor.method('assets:create:folder', function (args: any) {\n            // if (!editor.call('permissions:write'))\n            //     return;\n            // console.log('assets:create:folder');\n\n            args = args || {};\n\n            var path: string[] = [];\n            var currentFolder = editor.call('assets:panel:currentFolder');\n\n            if (currentFolder && currentFolder.get)\n                path = currentFolder.get('path').concat(currentFolder.get('id'));\n\n            var asset = {\n                name: '新建文件夹',\n                type: 'folder',\n                source: true,\n                preload: false,\n                data: null,\n                parent: (args.parent !== undefined) ? args.parent : editor.call('assets:panel:currentFolder'),\n                scope: {\n                    type: 'project',\n                    id: Config.projectID\n                },\n                path: path.join(',')\n            };\n\n            // console.log(asset);\n\n            editor.call('assets:create', asset);\n        });\n    }\n\n}","import { Observer } from '../../lib';\nimport { Config } from '../global';\n\nexport class AssetsCreateTable {\n\n\n    public constructor() {\n        editor.method('assets:create:table', function (args: any) {\n\n            if(Config.tableAssetsID !== '') {\n                console.warn('抱歉，暂时只允许创建一个表格！');\n                editor.call('status:text', '抱歉，暂时只允许创建一个表格！');\n                return;\n            }\n            // if (!editor.call('permissions:write'))\n            //     return;\n            args = args || {};\n\n            var path: string[] = [];\n            var currentFolder = editor.call('assets:panel:currentFolder');\n\n            if (currentFolder && currentFolder.get)\n                path = currentFolder.get('path').concat(currentFolder.get('id'));\n\n            var asset = {\n                name: '新表格.table',\n                type: 'table',\n                source: false,\n                preload: false,\n                parent: (args.parent !== undefined) ? args.parent : editor.call('assets:panel:currentFolder'),\n                filename: '新表格.table',\n                // file: new Blob(['{ }'], { type: 'application/json' }),\n                scope: {\n                    type: 'project',\n                    id: Config.projectID\n                },\n                path: path.join(',')\n            };\n\n            // console.warn('创建表格');\n\n            editor.call('assets:create', asset);\n        });\n\n        // TODO: 简单处理\n        editor.method('assets:open-table', (table_name: string) => {\n            // console.log(table_name);\n            window.open(window.location.protocol + '//' + window.location.host + '/table/' + Config.projectID + '?name=' + table_name + '&id=' + Config.tableAssetsID);\n        });\n\n        editor.on('assets:add', function (asset: Observer) {\n            if(asset.get('type') === 'table') {\n                Config.tableAssetsID = asset.get('id');\n                // console.log('设置表格ID：' + Config.tableAssetsID);\n            }\n        });\n\n    }\n\n}","export class AssetsDrop {\n\n    public constructor() {\n\n        var assetsPanel = editor.call('layout.assets');\n\n        var dropRef = editor.call('drop:target', {\n            ref: assetsPanel.element,\n            type: 'files',\n            drop: function (type: string, data: any) {\n                if (type !== 'files')\n                    return;\n                editor.call('assets:upload:files', data);\n            }\n        });\n\n        dropRef.element.classList.add('assets-drop-area');\n    }\n\n}","import { Observer } from \"../../lib\";\nimport { VeryEngine } from \"../../engine\";\nimport { Panel, SelectField, Tooltip, TextField } from \"../../ui\";\n\nexport class AssetsFilter {\n    public constructor() {\n\n        var root = VeryEngine.root;\n        var assetsPanel = VeryEngine.assets;\n        // var legacyScripts = editor.call('settings:project').get('useLegacyScripts');\n        var legacyScripts = false;\n        var currentFolder: any = null;\n        var currentPath: any = [];\n\n        var searchLastValue = '';\n        var searchTags: any = null;\n\n        // filters\n        var panelFilters = new Panel();\n        panelFilters.class!.add('filters');\n        assetsPanel.header.append(panelFilters);\n\n        var tagsCheck = function (asset: Observer, tags: string[]) {\n            var data = asset.get('tags');\n\n            if (!data.length)\n                return false;\n\n            // tags = pc.Tags.prototype._processArguments(tags);\n\n            if (!data.length || !tags.length)\n                return false;\n\n            for (var i = 0; i < tags.length; i++) {\n                if (tags[i].length === 1) {\n                    // single occurance\n                    if (data.indexOf(tags[i][0]) !== -1)\n                        return true;\n                } else {\n                    // combined occurance\n                    var multiple = true;\n\n                    for (var t = 0; t < tags[i].length; t++) {\n                        if (data.indexOf(tags[i][t]) !== -1)\n                            continue;\n\n                        multiple = false;\n                        break;\n                    }\n\n                    if (multiple)\n                        return true;\n                }\n            }\n\n            return false;\n        };\n\n\n\n\n\n        var filter = function (type: string, item: Observer) {\n            if (!item)\n                return false;\n\n            var visible = true;\n\n            // type\n            if (visible && filterField.value !== 'all') {\n                if (type === 'asset') {\n                    var assetType = item.get('type');\n\n                    if (assetType === 'texture') {\n                        if (item.get('source')) {\n                            assetType = 'textureSource';\n                        } else {\n                            assetType = 'textureTarget';\n                        }\n                    } else if (assetType === 'textureatlas') {\n                        if (item.get('source')) {\n                            assetType = 'textureAtlasSource';\n                        } else {\n                            assetType = 'textureAtlasTarget';\n                        }\n                    } else if (assetType === 'font') {\n                        if (item.get('source')) {\n                            assetType = 'fontSource';\n                        } else {\n                            assetType = 'fontTarget';\n                        }\n                    }\n\n                    visible = assetType === filterField.value;\n                } else if (type === 'script') {\n                    visible = filterField.value === 'script';\n                }\n            }\n\n            // query\n            if (visible && search.value) {\n                var name = (type === 'scripts') ? item : item.get(type === 'asset' ? 'name' : 'filename');\n                var normalSearch = true;\n\n                if (searchTags !== false && ((searchTags instanceof Array) || (search.value[0] === '[' && search.value.length > 2 && /^\\[.+\\]$/.test(search.value)))) {\n                    if (searchTags === null) {\n                        try {\n                            var raw = search.value.slice(1, -1);\n                            var bits = raw.split(',');\n                            var tags = [];\n                            var merge = '';\n\n                            for (var i = 0; i < bits.length; i++) {\n                                var tag = bits[i].trim();\n                                if (!tag) continue;\n\n                                if ((tag[0] === '[' && tag[tag.length - 1] !== ']') || (merge && tag[tag.length - 1] !== ']')) {\n                                    merge += tag + ',';\n                                    continue;\n                                }\n\n                                if (merge && tag[tag.length - 1] === ']') {\n                                    tag = merge + tag;\n                                    merge = '';\n                                }\n\n                                if (tag[0] === '[' && tag.length > 2 && tag[tag.length - 1] === ']') {\n                                    var subRaw = tag.slice(1, -1);\n                                    var subBits = subRaw.split(',');\n                                    if (subBits.length === 1) {\n                                        var subTag = subBits[0].trim();\n                                        if (!subTag) continue;\n                                        tags.push(subTag);\n                                    } else {\n                                        var subTags = [];\n                                        for (var s = 0; s < subBits.length; s++) {\n                                            var subTag = subBits[s].trim();\n                                            if (!subTag) continue;\n                                            subTags.push(subTag);\n                                        }\n\n                                        if (subTags.length === 0) {\n                                            continue;\n                                        } else if (subTags.length === 1) {\n                                            tags.push(subTags[0]);\n                                        } else {\n                                            tags.push(subTags);\n                                        }\n                                    }\n                                } else {\n                                    tags.push(tag);\n                                }\n                            }\n\n                            searchTags = tags;\n                            normalSearch = false;\n                        } catch (ex) {\n                            searchTags = false;\n                        }\n                    } else {\n                        normalSearch = false;\n                    }\n\n                    if (searchTags) {\n                        if (type === 'scripts' || (type === 'script' && legacyScripts)) {\n                            visible = false;\n                        } else {\n                            visible = tagsCheck(item, searchTags);\n                        }\n                    } else {\n                        normalSearch = true;\n                    }\n                } else if (search.value[0] === '*' && search.value.length > 1) {\n                    try {\n                        visible = (new RegExp(search.value.slice(1), 'i')).test(name);\n                        normalSearch = false;\n                    } catch (ex) { }\n                }\n\n                if (normalSearch) {\n                    visible = name.toLowerCase().indexOf(search.value.toLowerCase()) !== -1;\n\n                    if (!visible && type === 'asset') {\n                        var id = parseInt(search.value, 10);\n                        if (id && id.toString() === search.value)\n                            visible = parseInt(item.get('id'), 10) === id;\n                    }\n                }\n            }\n\n            // folder\n            if (visible && !search.value) {\n                if (type === 'script' || currentFolder === 'scripts') {\n                    visible = currentFolder === 'scripts' && type === 'script';\n                } else if (type === 'scripts') {\n                    visible = !currentFolder && filterField.value === 'all';\n                } else {\n                    var path = item.get('path');\n                    if (currentFolder === null) {\n                        visible = path.length === 0;\n                    } else {\n                        visible = (path.length === currentPath.length + 1) && path[path.length - 1] === currentFolder;\n                    }\n                }\n            }\n\n            return visible;\n        };\n        editor.method('assets:panel:filter:default', function () {\n            return filter;\n        });\n\n\n        // options\n        var filterOptions;\n\n        filterOptions = {\n            options: {\n                all: '所有资源',\n                material: '材质',\n                model: '模型',\n                textureTarget: '贴图',\n                table: '表格'\n            }\n        };\n\n        var filterField = new SelectField(filterOptions);\n\n        filterField.class!.add('options');\n        filterField.value = 'all';\n        filterField.renderChanges = false;\n        panelFilters.append(filterField);\n\n        filterField.on('change', function (value: string) {\n            if (value !== 'all') {\n                filterField.class!.add('not-empty');\n            } else {\n                filterField.class!.remove('not-empty');\n            }\n            // console.warn(value);\n            editor.call('assets:panel:filter', filter);\n        });\n\n        var tooltipFilter = Tooltip.attach({\n            target: filterField.element!,\n            text: '资源过滤器',\n            align: 'bottom',\n            root: root\n        });\n        filterField.on('open', function () {\n            tooltipFilter.disabled = true;\n        });\n        filterField.on('close', function () {\n            tooltipFilter.disabled = false;\n        });\n\n        editor.method('assets:filter:search', function (query?: string) {\n            if (query === undefined)\n                return search.value;\n            search.value = query;\n            return search.value;\n        });\n\n        editor.method('assets:filter:type', function (type?: string) {\n            if (type === undefined)\n                return filterField.value;\n\n            filterField.value = type || 'all';\n        });\n\n        editor.method('assets:filter:type:disabled', function (state: boolean) {\n            filterField.disabled = state;\n        });\n\n        editor.on('assets:panel:currentFolder', function (asset?: Observer | string) {\n            if (asset) {\n                if (typeof (asset) === 'string') {\n                    if (legacyScripts) {\n                        currentFolder = 'scripts';\n                    } else {\n                        currentFolder = null;\n                    }\n                    currentPath = null;\n                } else {\n                    currentFolder = asset.get('id');\n                    // currentFolder = parseInt(asset.get('id'));\n                    currentPath = asset.get('path');\n                }\n            } else {\n                currentFolder = null;\n                currentPath = null;\n            }\n\n\n            editor.call('assets:panel:filter', filter, true);\n        });\n\n        editor.on('assets:add', function (asset: Observer) {\n            if (filterField.value === 'all' && !search.value)\n                return;\n\n            if (!filter((asset.get('type') === 'script') ? 'script' : 'asset', asset))\n                editor.call('assets:panel:get', asset.get('id')).hidden = true;\n            else\n                editor.call('assets:panel:message', null); // clear possible no assets message\n        });\n\n        editor.on('sourcefiles:add', function (file: Observer) {\n            if (filterField.value === 'all' && !search.value)\n                return;\n\n            if (!filter('script', file))\n                editor.call('assets:panel:get', file.get('filename')).hidden = true;\n            else\n                editor.call('assets:panel:message', null); // clear possible no assets message\n\n        });\n\n        // search\n        var search = new TextField('搜索');\n        search.blurOnEnter = false;\n        search.keyChange = true;\n        search.class!.add('search');\n        search.renderChanges = false;\n        panelFilters.append(search);\n\n        search.element!.addEventListener('keydown', function (evt) {\n            if (evt.keyCode === 27)\n                searchClear.click();\n        }, false);\n\n        // hotkeys\n        editor.call('hotkey:register', 'assets-focus-search', {\n            key: 'a',\n            alt: true,\n            callback: function (e: any) {\n                if (editor.call('picker:isOpen:otherThan', 'curve')) return;\n                search.focus();\n            }\n        });\n\n        var searchClear = document.createElement('div');\n        searchClear.innerHTML = '&#57650;';\n        searchClear.classList.add('clear');\n        search.element!.appendChild(searchClear);\n\n        searchClear.addEventListener('click', function () {\n            search.value = '';\n        }, false);\n\n        search.on('change', function (value: string) {\n            value = value.trim();\n\n            if (searchLastValue === value)\n                return;\n\n            searchLastValue = value;\n\n            if (value) {\n                search.class!.add('not-empty');\n            } else {\n                search.class!.remove('not-empty');\n            }\n\n            searchTags = null;\n\n            editor.call('assets:panel:filter', filter);\n        });\n\n    }\n}","import { Observer } from '../../lib';\nimport { Config } from '../global';\nimport { getJsonConfig, upLoadJsonConfig } from '../../tools/ossfile';\nimport {UUid} from '../utility/uuid'\n\nexport class AssetsFs {\n\n    public constructor() {\n\n        var getIds = function (assets: Observer[]) {\n            if (!(assets instanceof Array))\n                assets = [assets];\n\n            var ids = [];\n            for (var i = 0; i < assets.length; i++)\n                ids.push(assets[i].get('id'));\n\n            return ids;\n        };\n\n        editor.method('assets:fs:delete', function (assets: Observer[]) {\n            editor.call('realtime:send', 'fs', {\n                op: 'delete',\n                ids: getIds(assets)\n            });\n        });\n\n        editor.method('assets:fs:move', async (assets: Observer[], assetTo: Observer)=> {\n            console.warn('assets:fs:move');\n            console.warn(assets);\n            console.warn(assetTo);\n            let ids = getIds(assets);\n            let to = assetTo ? assetTo.get('id') : '';\n            editor.call('realtime:send', 'fs', {\n                op: 'move',\n                ids: ids,\n                to: to\n            });\n\n            var move=ids.join(',')\n            var froms = move.split(\",\");\n            var assetJsonStr = await getJsonConfig(Config.projectID,\"assets\");\n            var assetData :any={};\n            var assetFile=JSON.parse(assetJsonStr);\n            for (var i = 0; i < froms.length; i++) {\n                var originItem = assetFile.assets[froms[i]];\n                var originPath =\n                    !originItem.path || originItem.path.length === 0\n                        ? \"root\"\n                        : originItem.path[originItem.path.length - 1];\n                if (to === \"\") {\n                    assetFile.assets[froms[i]].path = [];\n                } else {\n                    assetFile.assets[froms[i]].path = assetFile.assets[to].path.slice(0);\n                    assetFile.assets[froms[i]].path.push(to);\n                }\n                assetData[froms[i]] = assetFile.assets[froms[i]].path;\n                assetFile.assets[froms[i]].modifiedAt = UUid.createdAtTime();\n    \n                // 如果有子文件夹\n                var keys = Object.keys(assetFile.assets);\n                for (var j = 0; j < keys.length; j++) {\n                    if (\n                        keys[j] !== froms[i] &&\n                        keys[j] !== to &&\n                        assetFile.assets[keys[j]].path !== undefined &&\n                        assetFile.assets[keys[j]].path !== null\n                    ) {\n                        var index = assetFile.assets[keys[j]].path.indexOf(\n                            froms[i]\n                        );\n                        // 有文件夹\n                        if (index !== -1) {\n                            var lastPath = assetFile.assets[keys[j]].path.slice(\n                                index\n                            );\n                            if (to === \"\") {\n                                assetFile.assets[keys[j]].path = lastPath;\n                            } else {\n                                assetFile.assets[keys[j]].path = assetFile.assets[\n                                    froms[i]\n                                ].path.concat(lastPath);\n                            }\n                            assetFile.assets[keys[j]].modifiedAt = UUid.createdAtTime();\n                            assetData[keys[j]] = assetFile.assets[keys[j]].path;\n                        }\n                    }\n                }\n\n    \n                // babylon或texture改变位置后，assets数据修改\n                var item = assetFile.assets[froms[i]];\n                var closestPath =\n                    !item.path || item.path.length === 0\n                        ? \"root\"\n                        : item.path[item.path.length - 1];\n                if (item.type && item.type === \"model\") {\n                    var ext1 = item.name.split(\".\");\n                    var ext = ext1[ext1.length - 1].toLowerCase();\n                    if (ext === \"babylon\") {\n                        // 先删除\n                        if (!assetFile.babylon) {\n                            assetFile[\"babylon\"] = { path: {} };\n                        }\n                        if (!assetFile.babylon.path) {\n                            assetFile.babylon[\"path\"] = {};\n                        }\n                        if (assetFile.babylon.path[originPath]) {\n                            delete assetFile.babylon.path[originPath][froms[i]];\n                        }\n                        // 再修改\n                        if (!assetFile.babylon.path[closestPath]) {\n                            assetFile.babylon.path[closestPath] = {};\n                        }\n                        assetFile.babylon.path[closestPath][froms[i]] = true;\n                    }\n                }\n            }\n            upLoadJsonConfig(JSON.stringify(assetFile),Config.projectID,\"assets\");\n            let assetKeys = Object.keys(assetData);\n            for (let i = 0, len = assetKeys.length; i < len; i++) {\n                let asset = editor.call('assets:get', assetKeys[i]);\n                console.warn(asset);\n                if (asset) {\n                    asset.set('path', assetData[assetKeys[i]]);\n                }\n            }\n        });\n\n        editor.method('assets:fs:duplicate', function (assets: Observer[]) {\n            editor.call('realtime:send', 'fs', {\n                op: 'duplicate',\n                ids: getIds(assets)\n            });\n        });\n    }\n\n}","import { Tooltip, Menu, Panel, Button, MenuItem } from \"../../ui\";\nimport { VeryEngine } from \"../../engine\";\n\nexport class AssetsPanelControl {\n\n    public constructor() {\n\n        var root = VeryEngine.root;\n        var assetsPanel = VeryEngine.assets;\n\n        // context menu\n        var menu = new Menu();\n        root.append(menu);\n\n        // var assets: any = {\n        //     'upload': {\n        //         title: '上传',\n        //         icon: '&#57909;'\n        //     },\n        //     'folder': {\n        //         title: '新建文件夹',\n        //         icon: '&#57657;'\n        //     },\n        //     'css': {\n        //         title: '表格',\n        //         icon: '&#57864;'\n        //     },\n        //     'cubemap': {\n        //         title: 'CubeMap',\n        //         icon: '&#57879;'\n        //     },\n        //     'html': {\n        //         title: 'HTML',\n        //         icon: '&#57864;'\n        //     },\n        //     'json': {\n        //         title: 'JSON',\n        //         icon: '&#57864;'\n        //     },\n        //     'material': {\n        //         title: '材质',\n        //         icon: '&#57749;'\n        //     },\n        //     'script': {\n        //         title: 'Script',\n        //         icon: '&#57864;'\n        //     },\n        //     'shader': {\n        //         title: 'Shader',\n        //         icon: '&#57864;'\n        //     },\n        //     'text': {\n        //         title: 'Text',\n        //         icon: '&#57864;'\n        //     }\n        // };\n\n        var assets: any = {\n            'upload': {\n                title: '上传',\n                icon: '&#57909;'\n            },\n            'folder': {\n                title: '新建文件夹',\n                icon: '&#57657;'\n            },\n            'table': {\n                title: '表格',\n                icon: '&#57864;'\n            },\n            'material': {\n                title: '材质',\n                icon: '&#57749;'\n            }\n        };\n\n        // if (editor.call('users:hasFlag', 'hasBundles')) {\n        //     assets.bundle = {\n        //         title: 'Asset Bundle',\n        //         icon: '&#58384;'\n        //     };\n        // }\n\n        var addNewMenuItem = function (key: string, data: any) {\n            // new folder\n            var item = new MenuItem({\n                text: data.title,\n                icon: data.icon || '',\n                value: key\n            });\n            item.on('select', function () {\n                var args = {\n                    parent: editor.call('assets:panel:currentFolder')\n                };\n\n                if (key === 'upload') {\n                    editor.call('assets:upload:picker', args);\n                } else if (key === 'script') {\n                    if (editor.call('settings:project').get('useLegacyScripts')) {\n                        editor.call('sourcefiles:new');\n                    } else {\n                        editor.call('picker:script-create', function (filename: string) {\n                            editor.call('assets:create:script', {\n                                filename: filename,\n                                boilerplate: true\n                            });\n                        });\n                    }\n                } else {\n                    // console.log('assets:create:' + key);\n                    // console.log(args);\n                    editor.call('assets:create:' + key, args)\n                }\n            });\n            menu.append(item);\n\n            if (key === 'script') {\n                editor.on('repositories:load', function (repositories: any) {\n                    if (repositories.get('current') !== 'directory')\n                        item.disabled = true;\n                });\n            }\n        };\n\n        var keys = Object.keys(assets);\n        for (var i = 0; i < keys.length; i++) {\n            if (!assets.hasOwnProperty(keys[i]))\n                continue;\n\n            addNewMenuItem(keys[i], assets[keys[i]]);\n        }\n\n        // controls\n        var controls = new Panel();\n        // controls.enabled = false;\n        controls.class!.add('assets-controls');\n        // controls.parent = assetsPanel;\n        // assetsPanel.headerElement!.insertBefore(controls.element!, assetsPanel.headerElementTitle!.nextSibling);\n        assetsPanel.header.append(controls);\n        editor.on('permissions:writeState', function (state: boolean) {\n            controls.enabled = state;\n        });\n\n\n        // add\n        var btnNew = new Button();\n        // btnNew.hidden = !editor.call('permissions:write');\n        btnNew.class!.add('create-asset');\n        btnNew.text = '&#57632;';\n        btnNew.on('click', function (evt: MouseEvent) {\n            var rect = btnNew.element!.getBoundingClientRect();\n            menu.position(rect.right, rect.top);\n            menu.open = true;\n        });\n        controls.append(btnNew);\n\n        var tooltipAdd = Tooltip.attach({\n            target: btnNew.element!,\n            text: '添加资源',\n            align: 'bottom',\n            root: root\n        });\n        menu.on('open', function (state: boolean) {\n            tooltipAdd.disabled = state;\n        });\n\n        // delete\n        var btnDelete = new Button('&#57636;');\n        // btnDelete.hidden = !editor.call('permissions:write');\n        btnDelete.style!.fontWeight = '200';\n        btnDelete.disabled = true;\n        btnDelete.class!.add('delete');\n        btnDelete.on('click', function () {\n            if (!editor.call('permissions:write'))\n                return;\n\n            var type = editor.call('selector:type');\n            if (type !== 'asset')\n                return;\n\n            editor.call('assets:delete:picker', editor.call('selector:items'));\n        });\n        controls.append(btnDelete);\n\n        var tooltipDelete = Tooltip.attach({\n            target: btnDelete.element!,\n            text: '删除资源',\n            align: 'bottom',\n            root: root\n        });\n        tooltipDelete.class!.add('innactive');\n\n        editor.on('permissions:writeState', function (state: boolean) {\n            btnNew.hidden = !state;\n            btnDelete.hidden = !state;\n        });\n\n\n        // folder up\n        var btnUp = new Button('&#58117;');\n        btnUp.style!.fontWeight = '200';\n        btnUp.disabled = true;\n        btnUp.class!.add('up');\n        btnUp.on('click', function () {\n            var folder = editor.call('assets:panel:currentFolder');\n            if (!folder) return;\n\n            if (folder === 'scripts') {\n                editor.call('assets:panel:currentFolder', null);\n            } else {\n                var path = folder.get('path');\n                if (path.length) {\n                    var parent = editor.call('assets:get', path[path.length - 1]);\n                    if (parent) {\n                        editor.call('assets:panel:currentFolder', parent);\n                    } else {\n                        editor.call('assets:panel:currentFolder', null);\n                    }\n                } else {\n                    editor.call('assets:panel:currentFolder', null);\n                }\n            }\n        });\n        controls.append(btnUp);\n\n        editor.on('assets:panel:currentFolder', function (folder: any) {\n            if (folder) {\n                btnUp.disabled = false;\n                tooltipUp.class!.remove('innactive');\n            } else {\n                btnUp.disabled = true;\n                tooltipUp.class!.add('innactive');\n            }\n        });\n\n        var tooltipUp = Tooltip.attach({\n            target: btnUp.element!,\n            text: '上一层',\n            align: 'bottom',\n            root: root\n        });\n        tooltipUp.class!.add('innactive');\n\n\n        var assetsGrid = VeryEngine.assetsGrid;\n\n        // thumbnails size\n        var btnThumbSize = new Button('&#57669;');\n        btnThumbSize.style!.fontWeight = '200';\n        btnThumbSize.class!.add('size');\n        btnThumbSize.on('click', function () {\n            if (assetsGrid.class!.contains('small')) {\n                assetsGrid.class!.remove('small');\n                tooltipThumbSize.html = '<span style=\"color:#fff\">大图标</span> / 小图标';\n                editor.call('localStorage:set', 'editor:assets:thumbnail:size', 'large');\n            } else {\n                assetsGrid.class!.add('small');\n                tooltipThumbSize.html = '大图标 / <span style=\"color:#fff\">小图标</span>';\n                editor.call('localStorage:set', 'editor:assets:thumbnail:size', 'small');\n            }\n        });\n        controls.append(btnThumbSize);\n\n        var tooltipThumbSize = Tooltip.attach({\n            target: btnThumbSize.element!,\n            align: 'bottom',\n            root: root\n        });\n\n        var size = editor.call('localStorage:get', 'editor:assets:thumbnail:size');\n\n        if (size === 'small') {\n            assetsGrid.class!.add('small');\n            tooltipThumbSize.html = '大图标 / <span style=\"color:#fff\">小图标</span>';\n        } else {\n            assetsGrid.class!.remove('small');\n            tooltipThumbSize.html = '<span style=\"color:#fff\">大图标</span> / 小图标';\n        }\n        tooltipThumbSize.class!.add('innactive');\n\n\n        editor.on('attributes:clear', function () {\n            // btnDuplicate.disabled = true;\n            btnDelete.disabled = true;\n            tooltipDelete.class!.add('innactive');\n        });\n\n        editor.on('attributes:inspect[*]', function (type: string) {\n            if (type.startsWith('asset')) {\n                btnDelete.enabled = true;\n                tooltipDelete.class!.remove('innactive');\n            } else {\n                btnDelete.enabled = false;\n                tooltipDelete.class!.add('innactive');\n            }\n            // btnDuplicate.enabled = type === 'asset.material';\n        });\n\n        \n\n    }\n\n}","import { Panel, Progress, Tree, TreeItem, Grid, Label, Tooltip, GridItem, Menu, MenuItem, TopElementContainer, TopElementPanel } from '../../ui';\nimport { VeryEngine } from '../../engine';\nimport { Observer, ObserverList } from '../../lib';\nimport { BabylonLoader } from '../middleware/loader/babylonLoader';\nimport { getThumbnailUrl } from '../../tools/ossfile';\nimport { Config } from '../global';\n\nexport class AssetsPanel {\n\n    public constructor() {\n\n        let self = this;\n\n        var root: TopElementContainer = VeryEngine.root;\n        var assetsPanel: TopElementPanel = VeryEngine.assets;\n        var dragging: boolean = false;\n        var draggingData: any = {};\n\n\n        var legacyScripts: boolean = false;\n        var selector = {\n            type: '',\n            items: new Array<Observer>(),\n            prev: {\n                type: '',\n                items: new Array<Observer>()\n            }\n        };\n        var searching = false;\n\n\n        let overlay: TopElementContainer = new TopElementContainer({\n            flex: true\n        });\n        overlay.class!.add('progress-overlay');\n        assetsPanel.append(overlay);\n\n        var loading = new Progress();\n        loading.progress = 0.01;\n        loading.on('progress:100', function () {\n            overlay.hidden = true;\n        });\n        overlay.append(loading);\n        // TODO：隐藏\n        overlay.hidden = true;\n\n        editor.method('assets:progress', function (progress: number) {\n            loading.progress = progress;\n        });\n\n        // folders panel\n        var folders = new Panel();\n        folders.class!.add('folders');\n        folders.flexShrink = '0';\n        folders.style!.width = '200px';\n        folders.innerElement!.style.width = '200px';\n        folders.foldable = false;\n        folders.horizontal = true;\n        folders.scroll = true;\n        folders.resizable = 'right';\n        folders.resizeMin = 100;\n        folders.resizeMax = 300;\n        assetsPanel.append(folders);\n\n        editor.method('assets:panel:folders', function () {\n            return folders;\n        });\n\n        // folder\n        var files = new Panel();\n        files.class!.add('files');\n        files.flexGrow = '1';\n        files.foldable = false;\n        files.horizontal = true;\n        files.scroll = true;\n        assetsPanel.append(files);\n\n        editor.method('assets:panel:files', function () {\n            return files;\n        });\n\n        // grid\n        var grid = new Grid();\n        // grid.enabled = false;\n        grid.class!.add('assets');\n        files.append(grid);\n        VeryEngine.assetsGrid = grid;\n\n        // tree\n        var tree = new Tree();\n        // tree.enabled = false;\n        tree.draggable = false;\n        tree.class!.add('assets');\n        folders.append(tree);\n\n        // tree root，Assets根目录\n        var treeRoot = new TreeItem({\n            text: '/'\n        });\n        tree.append(treeRoot);\n        // tree.element!.appendChild(treeRoot.element!);\n        // tree.emit('append', treeRoot);\n        treeRoot.open = true;\n        treeRoot.class!.add('current');\n        treeRoot.on('select', function () {\n            treeRoot.selected = false;\n        });\n\n        // tree width resizing\n        var resizeQueued = false;\n        var resizeTree = function () {\n            resizeQueued = false;\n            tree.element!.style.width = '';\n            tree.element!.style.width = (folders.innerElement!.scrollWidth - 5) + 'px';\n        };\n        var resizeQueue = function () {\n            if (resizeQueued) return;\n            resizeQueued = true;\n            requestAnimationFrame(resizeTree);\n        };\n        folders.on('resize', resizeQueue);\n        tree.on('open', resizeQueue);\n        tree.on('close', resizeQueue);\n        setInterval(resizeQueue, 1000);\n\n        var gridScripts: GridItem;\n        var treeScripts: TreeItem;\n        var createLegacyScriptFolder = function () {\n            gridScripts = new GridItem();\n            gridScripts.class!.add('type-folder', 'scripts');\n            grid.append(gridScripts);\n\n            gridScripts.tree = treeScripts = new TreeItem({\n                text: 'scripts'\n            });\n            gridScripts.tree.class!.add('scripts');\n            gridScripts.tree.on('select', function () {\n                gridScripts.tree.selected = false;\n            });\n            treeRoot.append(gridScripts.tree);\n\n            gridScripts.on('select', function () {\n                editor.call('selector:clear');\n\n                if (!selector.type) {\n                    selector.prev.type = '';\n                    selector.prev.items = [];\n                }\n            });\n\n            // scripts open\n            gridScripts.element!.addEventListener('dblclick', function () {\n                tree.clear();\n                editor.call('assets:filter:search', '');\n                editor.call('assets:panel:currentFolder', 'scripts');\n                // change back selection\n\n                if (selector.prev.type)\n                    editor.call('selector:set', selector.prev.type, selector.prev.items);\n            }, false);\n\n            var thumbnail = gridScripts.thumbnail = document.createElement('div');\n            thumbnail.classList.add('thumbnail', 'placeholder');\n            gridScripts.element!.appendChild(thumbnail);\n\n            var icon = document.createElement('div');\n            icon.classList.add('icon');\n            gridScripts.element!.appendChild(icon);\n\n            var label = gridScripts.labelElement = document.createElement('div');\n            label.classList.add('label');\n            label.textContent = 'scripts';\n            gridScripts.element!.appendChild(label);\n\n            // context menu\n            var menu = new Menu();\n            root.append(menu);\n\n            // script\n            var menuScript = new MenuItem({\n                text: 'New Script',\n                value: 'script',\n                icon: '&#57864;'\n            });\n            menuScript.on('select', function () {\n                editor.call('sourcefiles:new');\n            });\n            menu.append(menuScript);\n\n            editor.on('repositories:load', function (repositories: Observer) {\n                if (repositories.get('current') !== 'directory')\n                    menuScript.disabled = true;\n            });\n            var onContextMenu = function (evt: MouseEvent) {\n                evt.stopPropagation();\n                evt.preventDefault();\n\n                // if (!editor.call('permissions:write'))\n                //     return;\n\n                menu.position(evt.clientX + 1, evt.clientY);\n                menu.open = true;\n            };\n            gridScripts.element!.addEventListener('contextmenu', onContextMenu, false);\n            treeScripts.elementTitle.addEventListener('contextmenu', onContextMenu, false);\n\n            resizeQueue();\n        };\n        if (legacyScripts)\n            createLegacyScriptFolder();\n\n\n        var currentFolder: Observer | string | null = null;  // assets -> Observer\n        editor.method('assets:panel:currentFolder', function (asset: Observer | string | null): Observer | string | null {\n            if (asset === undefined)\n                return currentFolder;\n\n            if (asset === currentFolder)\n                return null;\n\n            // current folder style remove\n            if (currentFolder && typeof (currentFolder) !== 'string' && assetsIndex[currentFolder.get('id')]) {\n                assetsIndex[currentFolder.get('id')].tree.class!.remove('current');\n            } else {\n                if (currentFolder === null) {\n                    treeRoot.class!.remove('current');\n                } else if (treeScripts && currentFolder === 'scripts') {\n                    treeScripts.class!.remove('current');\n                }\n            }\n\n            currentFolder = asset;\n\n            // current folder style add\n            if (currentFolder && typeof (currentFolder) !== 'string') {\n                assetsIndex[currentFolder.get('id')].tree.class!.add('current');\n\n                // open tree up\n                var path = currentFolder.get('path');\n                for (var i = 0; i < path.length; i++) {\n                    if (!assetsIndex[path[i]] || !assetsIndex[path[i]].tree)\n                        continue;\n\n                    assetsIndex[path[i]].tree.open = true;\n                }\n            } else if (currentFolder === null) {\n                treeRoot.class!.add('current');\n            } else if (treeScripts && currentFolder === 'scripts') {\n                treeScripts.class!.add('current');\n                editor.call('assets:filter:type', 'all');\n            }\n\n            if (legacyScripts)\n                gridScripts.hidden = currentFolder !== null;\n\n            editor.emit('assets:panel:currentFolder', currentFolder);\n            return currentFolder;\n        });\n\n        editor.call('hotkey:register', 'assets:fs:up', {\n            key: 'backspace',\n            callback: function () {\n                if (!currentFolder || editor.call('selector:type') !== 'asset')\n                    return;\n\n                var path = typeof (currentFolder) === 'string' ? [] : currentFolder.get('path');\n                if (path.length === 0) {\n                    editor.call('assets:panel:currentFolder', null);\n                } else {\n                    editor.call('assets:panel:currentFolder', editor.call('assets:get', path[path.length - 1]));\n                }\n            }\n        });\n\n        editor.on('drop:active', function (state: boolean, type: string, data: any) {\n            // console.log('drop:active: ' + state + ' - ' + type + ' - ' + data);\n\n            dragging = state;\n\n            if (!dragging) {\n                grid.dragOver = undefined;\n                gridDropBorder.classList.remove('active');\n                treeDropBorder.classList.remove('active');\n            }\n        });\n\n        editor.on('drop:set', function (type: string, data: any) {\n            draggingData = data;\n            // console.warn('drop:set');\n            // console.warn(draggingData);\n        });\n\n\n\n        // IDrop\n        var dropRef = editor.call('drop:target', {\n            ref: folders.element,\n            hole: true,\n            passThrough: true,\n            filter: function (type: string, data: any) {\n                return type.startsWith('asset');\n            },\n            drop: function (type: string, data: any) {\n                console.warn('drop: ' + type);\n                // console.warn(data);\n                if (!type || grid.dragOver === undefined || !type.startsWith('asset'))\n                    return;\n\n                var items = editor.call('selector:items');\n                var assets: any = [];\n\n                var addAsset = function (id: string) {\n                    var asset = editor.call('assets:get', id);\n\n                    // deselect moved asset\n                    if (items.indexOf(asset) !== -1)\n                        editor.call('selector:remove', asset);\n\n                    assets.push(asset);\n                };\n\n                if (data.ids && data.ids.length > 0) {\n                    for (var i = 0; i < data.ids.length; i++)\n                        addAsset(data.ids[i]);\n                } else {\n                    addAsset(data.id);\n                }\n                editor.call('assets:fs:move', assets, grid.dragOver);\n            }\n        });\n        dropRef.element.classList.add('assets-drop-area');\n\n        var treeAppendQueue: { [key: string]: GridItem[] } = {};\n\n\n\n        treeRoot.elementTitle.addEventListener('mouseover', function () {\n            if (!dragging || grid.dragOver === null || (!draggingData.id && !draggingData.ids))\n                return;\n\n            // already in that folder\n            var dragAsset = editor.call('assets:get', draggingData.id || draggingData.ids[0]);\n            if (!dragAsset.get('path').length)\n                return;\n\n            gridDropBorder.classList.remove('active');\n\n            var rect = treeRoot.elementTitle.getBoundingClientRect();\n            treeDropBorder.classList.add('active');\n            treeDropBorder.style.left = rect.left + 'px';\n            treeDropBorder.style.top = rect.top + 'px';\n            treeDropBorder.style.right = (window.innerWidth - rect.right) + 'px';\n            treeDropBorder.style.bottom = (window.innerHeight - rect.bottom) + 'px';\n\n            grid.dragOver = null;\n        }, false);\n\n        treeRoot.elementTitle.addEventListener('mouseout', function () {\n            if (!dragging || grid.dragOver === undefined)\n                return;\n\n            gridDropBorder.classList.remove('active');\n            treeDropBorder.classList.remove('active');\n\n            grid.dragOver = undefined;\n        }, false);\n\n\n\n\n\n\n        var dropRef2 = editor.call('drop:target', {\n            ref: files.element,\n            hole: true,\n            passThrough: true,\n            filter: function (type: string, data: any) {\n                return type.startsWith('asset');\n            },\n            drop: function (type: string, data: any) {\n\n                if (!type || grid.dragOver === undefined || !type.startsWith('asset'))\n                    return;\n\n                console.warn('drop2: ' + type);\n                console.warn(data);\n                console.log(grid.dragOver);\n\n                var assets: any = [];\n                var items = editor.call('selector:items');\n\n                // console.warn(items);\n\n                var addAsset = function (id: string) {\n                    var asset = editor.call('assets:get', id);\n                    // console.log(asset);\n\n                    // deselect moved asset\n                    if (items.indexOf(asset) !== -1)\n                        editor.call('selector:remove', asset);\n\n                    assets.push(asset);\n                };\n\n                if (data.ids && data.ids.length > 0) {\n                    for (var i = 0; i < data.ids.length; i++) {\n                        addAsset(data.ids[i]);\n                    }\n                } else {\n                    addAsset(data.id);\n                }\n\n                if (grid.dragOver.get('type') === 'folder') {\n                    editor.call('assets:fs:move', assets, grid.dragOver);\n                } else if (grid.dragOver.get('type') === 'bundle') {\n                    var countAdded = editor.call('assets:bundles:addAssets', assets, grid.dragOver);\n                    if (countAdded) {\n                        var item = assetsIndex[grid.dragOver.get('id')];\n                        item.class!.add('confirm-animation');\n                        setTimeout(function () {\n                            item.class!.remove('confirm-animation');\n                        }, 800);\n                    }\n                }\n            }\n        });\n        dropRef2.element.classList.add('assets-drop-area');\n\n        editor.on('permissions:writeState', function (state: boolean) {\n            tree.enabled = state;\n            grid.enabled = state;\n        });\n\n        var labelNoAssets = new Label(undefined, undefined, true);\n        labelNoAssets.renderChanges = false;\n        labelNoAssets.class!.add('no-assets');\n        labelNoAssets.hidden = true;\n        files.append(labelNoAssets);\n\n        editor.method('assets:panel:message', function (msg: string) {\n            labelNoAssets.text = msg;\n            labelNoAssets.hidden = !msg;\n        });\n\n        var scriptsIndex: { [key: string]: GridItem } = {};\n        var assetsIndex: { [key: string]: GridItem } = {};\n        var assetsChanged = false;\n        editor.method('assets:grid:assetsIndex', () => {\n            return assetsIndex;\n        });\n        // grid.assetsIndex = assetsIndex;\n\n        var gridDropBorder = document.createElement('div');\n        gridDropBorder.classList.add('assets-drop-border');\n        root.append(gridDropBorder);\n\n        var treeDropBorder = document.createElement('div');\n        treeDropBorder.classList.add('assets-drop-border');\n        root.append(treeDropBorder);\n\n        var tooltipAsset = new Tooltip({\n            text: 'Asset',\n            align: 'top',\n            hoverable: false\n        });\n        root.append(tooltipAsset);\n\n        var tooltipTarget: any = null;\n        var tooltipTimeout: any = null;\n\n        var tooltipShow = function () {\n            if (!tooltipTarget)\n                return;\n\n            while (tooltipTarget && tooltipTarget.nodeName !== 'LI' && !tooltipTarget.classList.contains('ui-grid-item'))\n                tooltipTarget = tooltipTarget.parentNode;\n\n            if (!tooltipTarget || !tooltipTarget.ui)\n                return;\n\n            var rect = tooltipTarget.getBoundingClientRect();\n            var off = 16;\n\n            if (rect.width < 64) off = rect.width / 2;\n            tooltipAsset.flip = rect.left + off > window.innerWidth / 2;\n            if (tooltipAsset.flip) {\n                tooltipAsset.position(rect.right - off, rect.bottom);\n            } else {\n                tooltipAsset.position(rect.left + off, rect.bottom);\n            }\n\n            tooltipAsset.text = tooltipTarget.ui.asset.get('name');\n            tooltipAsset.hidden = false;\n        };\n\n        var onAssetItemHover = function (evt: MouseEvent) {\n            if (tooltipTimeout) {\n                clearTimeout(tooltipTimeout);\n                tooltipTimeout = null;\n            }\n\n            tooltipTarget = evt.target;\n            tooltipTimeout = setTimeout(tooltipShow, 300);\n        };\n\n        var onAssetItemBlur = function () {\n            tooltipAsset.hidden = true;\n\n            if (tooltipTimeout) {\n                clearTimeout(tooltipTimeout);\n                tooltipTimeout = null;\n            }\n        };\n\n        var onAssetItemRemove = function () {\n            // if (!tooltipTarget || !tooltipTarget.ui || tooltipTarget.ui.asset !== this)\n            //     return;\n\n            if (!tooltipTarget || !tooltipTarget.ui)\n                return;\n\n            onAssetItemBlur();\n        };\n\n        grid.innerElement!.addEventListener('mousewheel', function () {\n            tooltipAsset.hidden = true;\n\n            if (tooltipTimeout) {\n                clearTimeout(tooltipTimeout);\n                tooltipTimeout = null;\n            }\n        }, false);\n\n        tree.on('select', function (item: TreeItem) {\n            if (assetsChanged)\n                return;\n\n            if (item.asset) {\n                if (!Tree._ctrl || !Tree._ctrl()) {\n                    if (currentFolder !== item.asset) {\n                        item.selected = false;\n                    } else {\n                        editor.call('selector:set', 'asset', [item.asset]);\n                    }\n                } else {\n                    editor.call('selector:add', 'asset', item.asset);\n                }\n            }\n\n            if (!item.asset) {\n                if (item === treeRoot) {\n                    editor.call('assets:filter:search', '');\n                    editor.call('assets:panel:currentFolder', null);\n                } else if (item === treeScripts) {\n                    editor.call('assets:filter:search', '');\n                    editor.call('assets:panel:currentFolder', 'scripts');\n                }\n                return;\n            }\n\n            if (!Tree._ctrl || !Tree._ctrl()) {\n                editor.call('assets:filter:search', '');\n                editor.call('assets:panel:currentFolder', item.asset);\n            }\n        });\n\n        tree.on('deselect', function (item: TreeItem) {\n            if (assetsChanged)\n                return;\n\n            if (item.asset)\n                editor.call('selector:remove', item.asset);\n        });\n\n        grid.on('select', function (item: GridItem) {\n\n            if (assetsChanged)\n                return;\n\n            // console.log('grid select');\n\n            if (item.asset) {\n                editor.call('selector:add', 'asset', item.asset);\n            }\n            // TODO\n            // } else if (item.script) {\n            //     editor.call('selector:add', 'asset', item.script);\n            // }\n        });\n\n        grid.on('deselect', function (item: GridItem) {\n\n            // console.error('grid deselect');\n\n            if (assetsChanged)\n                return;\n\n            if (item.asset) {\n                // console.error(item);\n                // console.error(item.asset);\n                editor.call('selector:remove', item.asset);\n            }\n            // } else if (item.script) {\n            //     editor.call('selector:remove', item.script);\n            // }\n        });\n\n        editor.on('selector:change', function (type: string, items: Observer[]) {\n            assetsChanged = true;\n\n            selector.prev.type = selector.type;\n            selector.prev.items = selector.items;\n\n            selector.type = editor.call('selector:type');\n            selector.items = editor.call('selector:items');\n\n            // console.error('type: ' + type);\n            // console.error(items);\n\n            if (type === 'asset') {\n                tree.clear();\n                items = items.slice(0);\n                var assets: GridItem[] = [];\n\n                for (var i = 0; i < items.length; i++) {\n                    if (legacyScripts && items[i].get('type') === 'script') {\n                        assets.push(scriptsIndex[items[i].get('filename')]);\n                    } else {\n                        assets.push(assetsIndex[items[i].get('id')]);\n                        if (assets[i].tree) {\n                            assets[i].tree.selected = true;\n\n                            // open tree up\n                            var path = items[i].get('path');\n                            for (var n = 0; n < path.length; n++) {\n                                if (!assetsIndex[path[n]] || !assetsIndex[path[n]].tree)\n                                    continue;\n                                assetsIndex[path[n]].tree.open = true;\n                            }\n                        }\n                    }\n                }\n\n                grid.selected = assets;\n            } else {\n                if ((legacyScripts && !(gridScripts.selected && grid.selected.length === 1)) || selector.type !== 'asset')\n                    grid.selected = [];\n\n                tree.clear();\n            }\n\n            assetsChanged = false;\n        });\n\n        // return grid\n        editor.method('assets:grid', function () {\n            return grid;\n        });\n\n        var searchingInProgress = false;\n        var searchingElement: any = null;\n        var searchingFunction: any = null;\n        var searchingBatchLimit = 512;\n\n        var searchNextBatch = function () {\n            var done = 0;\n\n            while (searchingElement && (searchingBatchLimit === 0 || done < searchingBatchLimit)) {\n                var item = searchingElement.ui;\n\n                if (item) {\n                    if (item.asset) {\n                        item.hidden = !searchingFunction('asset', item.asset);\n                    } else if (item.script) {\n                        item.hidden = !searchingFunction('script', item.script);\n                    }\n                    done++;\n                }\n\n                searchingElement = searchingElement.nextSibling;\n            }\n\n            if (!searchingElement) {\n                searchingInProgress = false;\n            } else {\n                requestAnimationFrame(searchNextBatch);\n            }\n        };\n\n        // filter assets in grid\n        editor.method('assets:panel:filter', function (fn: Function, immediate: boolean) {\n            if (!fn)\n                fn = editor.call('assets:panel:filter:default');\n\n            labelNoAssets.hidden = true;\n\n            // 获取grid的第一个元素（所有grid的集合）\n            searchingElement = grid.element!.firstChild;\n            searchingFunction = fn;\n\n            var type = editor.call('assets:filter:type');\n            var search = editor.call('assets:filter:search');\n\n            if (!search || immediate) {\n                searchingBatchLimit = 0;\n            } else {\n                searchingBatchLimit = 512;\n            }\n\n            if (!searchingInProgress) {\n                searchingInProgress = true;\n                requestAnimationFrame(searchNextBatch);\n            }\n\n            // navigate to selected assets folder\n            if (searching && !search) {\n                searching = false;\n\n                if (selector.type === 'asset') {\n                    var script = legacyScripts && selector.items[0].get('type') === 'script';\n                    var path = script ? [] : selector.items[0].get('path');\n                    var multiPath = false;\n                    for (var i = 1; i < selector.items.length; i++) {\n                        var item = selector.items[i];\n                        if (script !== (item.get('type') === 'script') || (!script && !path.equals(item.get('path')))) {\n                            multiPath = true;\n                            break;\n                        }\n                    }\n\n                    if (!multiPath) {\n                        if (path.length) {\n                            editor.call('assets:panel:currentFolder', editor.call('assets:get', path[path.length - 1]));\n                            assetsIndex[selector.items[0].get('id')].element!.focus();\n                        } else if (script) {\n                            editor.call('assets:panel:currentFolder', 'scripts');\n                        } else {\n                            editor.call('assets:panel:currentFolder', null);\n                        }\n\n                    }\n                }\n            }\n\n            if (search)\n                searching = true;\n\n            if (legacyScripts)\n                gridScripts.hidden = !fn('scripts', 'scripts');\n        });\n\n        // get grid item by id\n        editor.method('assets:panel:get', function (id: string) {\n            return assetsIndex[id] || scriptsIndex[id];\n        });\n\n        // 插入子文件夹，如果有的话\n        var appendChildFolders = function (item: GridItem) {\n            var queue = treeAppendQueue[item.asset.get('id')];\n            if (!queue || !queue.length)\n                return;\n\n            for (var i = 0; i < queue.length; i++) {\n                var closest = treeFindClosest(item.tree, queue[i].tree);\n                if (closest === -1) {\n                    item.tree!.append(queue[i].tree);\n                } else {\n                    item.tree!.appendBefore(queue[i].tree, <TreeItem>(item.tree.child(closest).ui));\n                }\n                appendChildFolders(queue[i]);\n            }\n\n            delete treeAppendQueue[item.asset.get('id')];\n        };\n\n        var treeFindClosest = function (parent: TreeItem, current: TreeItem, nameOld?: string): number {\n\n            // 文件改变之前的名字\n            nameOld = nameOld || current.text;\n            // ChildNode -> 当前parent下的其他item\n            var l = Array.prototype.slice.call(parent.element!.childNodes, 1);\n            // if (item === treeRoot && legacyScripts)\n            //   l = l.slice(1);\n            // if (parent === treeRoot)\n            //     l = l.slice(1);\n\n            var min = 0;\n            var max = l.length - 1;\n            var cur: number = -1;\n            var a, i;\n            var aN: string = '';\n            var bN: string = '';\n\n            if (l.length === 0)  // 当前没有item，直接在末尾插入item\n                return -1;\n\n            // TODO: a没有赋值啊\n            if (((a === current) ? nameOld.toLowerCase() : l[0].ui.text.toLowerCase()) === bN)\n                return 0;\n\n            while (min <= max) {\n                cur = Math.floor((min + max) / 2); // 二分法\n                a = l[cur];\n\n                aN = (a === current) ? nameOld.toLowerCase() : a.ui.text.toLowerCase();\n                bN = current.text.toLowerCase();\n\n                if (aN > bN) {\n                    max = cur - 1;\n                } else if (aN < bN) {\n                    min = cur + 1;\n                } else {\n                    return cur;\n                }\n            }\n\n            // if (aN.localeCompare(bN) > 0) {\n            //     return cur;\n            // }\n\n            if (aN > bN) return cur;\n\n            if ((cur + 1) === l.length)\n                return -1;\n\n            return cur + 1;\n        };\n\n        // select all hotkey\n        // ctrl + a\n        editor.call('hotkey:register', 'asset:select-all', {\n            ctrl: true,\n            key: 'a',\n            callback: function () {\n                var assets = [];\n\n                for (var key in assetsIndex) {\n                    if (!assetsIndex[key].hidden)\n                        assets.push(assetsIndex[key].asset);\n                }\n\n                for (var key in scriptsIndex) {\n                    if (!scriptsIndex[key].hidden)\n                        assets.push(scriptsIndex[key].script);\n                }\n\n                if (assets.length) {\n                    editor.call('selector:set', 'asset', assets);\n                } else {\n                    editor.call('selector:clear');\n                }\n            }\n        });\n\n        var renderQueue: any = [];\n        var renderQueueIndex: { [key: string]: boolean } = {};\n\n        var renderQueueUpdate = function () {\n            requestAnimationFrame(renderQueueUpdate);\n\n            if (!renderQueue.length)\n                return;\n\n            var items = 0;\n            while (items < 4 && renderQueue.length) {\n                items++;\n                var id = renderQueue.shift();\n                delete renderQueueIndex[id];\n\n                if (!assetsIndex[id] || !assetsIndex[id].thumbnail || !assetsIndex[id].thumbnail.render)\n                    continue;\n\n                assetsIndex[id].thumbnail.render();\n            }\n        };\n        requestAnimationFrame(renderQueueUpdate);\n\n        var renderQueueAdd = function (asset: Observer) {\n            var id = asset.get('id');\n            if (renderQueueIndex[id])\n                return;\n\n            if (!assetsIndex[id] || !assetsIndex[id].thumbnail || !assetsIndex[id].thumbnail.render)\n                return;\n\n            renderQueueIndex[id] = true;\n            renderQueue.push(id);\n        };\n\n        var renderQueueRemove = function (asset: Observer) {\n            var id = asset.get('id');\n            if (!renderQueueIndex[id])\n                return;\n\n            var ind = renderQueue.indexOf(id);\n            if (ind !== -1)\n                renderQueue.splice(ind, 1);\n\n            delete renderQueueIndex[id];\n        };\n\n        var showGridDropHighlight = function (item: GridItem) {\n            var clip = files.element!.getBoundingClientRect();\n            var rect = item.element!.getBoundingClientRect();\n            var top = Math.max(rect.top, clip.top);\n            var bottom = Math.min(rect.bottom, clip.bottom);\n\n            if ((bottom - top) > 8) {\n                gridDropBorder.classList.add('active');\n                gridDropBorder.style.left = rect.left + 'px';\n                gridDropBorder.style.top = top + 'px';\n                gridDropBorder.style.right = (window.innerWidth - rect.right) + 'px';\n                gridDropBorder.style.bottom = (window.innerHeight - bottom) + 'px';\n            }\n        };\n\n\n        var showTreeDropHighlight = function (item: GridItem) {\n            var clip = files.element!.getBoundingClientRect();\n            var rect = item.tree!.elementTitle.getBoundingClientRect();\n            var top = Math.max(rect.top, clip.top);\n            var bottom = Math.min(rect.bottom, clip.bottom);\n            if (rect.height && (bottom - top) > 4) {\n                treeDropBorder.classList.add('active');\n                treeDropBorder.style.left = rect.left + 'px';\n                treeDropBorder.style.top = top + 'px';\n                treeDropBorder.style.right = (window.innerWidth - rect.right) + 'px';\n                treeDropBorder.style.bottom = (window.innerHeight - bottom) + 'px';\n            }\n        };\n\n        // Called when a folder asset is added\n        var onAddFolder = function (asset: Observer, item: GridItem) {\n            item.tree = new TreeItem({\n                text: asset.get('name')\n            });\n            item.tree.asset = asset;\n\n\n            var path: string[] = asset.get('path');\n            var parent;\n\n            if (path.length && path.length > 0) {\n                var parentFolderId: string = path[path.length - 1];\n                if (assetsIndex[parentFolderId]) {\n                    parent = assetsIndex[parentFolderId].tree;\n                } else {\n                    if (!treeAppendQueue[parentFolderId])\n                        treeAppendQueue[parentFolderId] = [];\n\n                    treeAppendQueue[parentFolderId].push(item);\n                }\n            } else {\n                parent = treeRoot;\n                // console.warn(path);\n            }\n\n            // console.warn(item.text);\n\n            if (parent) {\n                var closest = treeFindClosest(parent, item.tree);\n                if (closest === -1) {\n                    parent.append(item.tree);\n                } else {\n                    parent.appendBefore(item.tree, <TreeItem>(parent.child(closest).ui));\n                }\n\n                appendChildFolders(item);\n            }\n\n            var onMouseOver = function () {\n                if (!dragging || grid.dragOver === asset)\n                    return;\n\n                // console.log('onMouseOver1');\n                // console.log(draggingData);\n                // console.log(grid.dragOver);\n\n                // don't allow to drag on it self\n                if (draggingData.ids && draggingData.ids.length > 0) {\n                    // multi-drag\n                    if (draggingData.ids.indexOf(asset.get('id') !== -1))\n                        return;\n                } else if (draggingData.id) {\n                    // single-drag\n                    // console.warn(asset.get('id'));\n                    if (asset.get('id') === draggingData.id)\n                        return;\n                } else {\n                    // script file drag\n                    return;\n                }\n\n                // console.log('onMouseOver2');\n\n                // already in that folder\n                var dragAsset = editor.call('assets:get', draggingData.id || draggingData.ids[0]);\n                var path = dragAsset.get('path');\n                if (path.length && path[path.length - 1] === asset.get('id'))\n                    return;\n\n                // don't allow dragging into own child\n                if (draggingData.ids && draggingData.ids.length > 0) {\n                    // multi-drag\n                    var assetPath = asset.get('path');\n                    for (var i = 0; i < draggingData.ids.length; i++) {\n                        if (assetPath.indexOf(draggingData.ids[i]) !== -1)\n                            return;\n                    }\n                } else {\n                    // single-drag\n                    if (asset.get('path').indexOf(dragAsset.get('id')) !== -1)\n                        return;\n                }\n\n                // console.log('onMouseOver3');\n\n                showGridDropHighlight(item);\n                showTreeDropHighlight(item);\n\n                grid.dragOver = asset;\n            };\n\n\n            var onMouseOut = function () {\n                if (!dragging || grid.dragOver !== asset)\n                    return;\n\n                gridDropBorder.classList.remove('active');\n                treeDropBorder.classList.remove('active');\n                grid.dragOver = undefined;\n            };\n\n            // draggable\n            item.tree.elementTitle.draggable = true;\n\n            item.element!.addEventListener('mouseout', onMouseOut, false);\n            item.tree.elementTitle.addEventListener('mouseout', onMouseOut, false);\n\n            item.element!.addEventListener('mouseover', onMouseOver, false);\n            item.tree.elementTitle.addEventListener('mouseover', onMouseOver, false);\n        };\n\n        // Called when a script asset is added\n        var onAddScript = function (asset: Observer, item: GridItem, events: any) {\n            events.push(editor.on('assets[' + asset.get('id') + ']:scripts:collide', function (script: any) {\n                item.class!.add('scripts-collide');\n            }));\n            events.push(editor.on('assets[' + asset.get('id') + ']:scripts:resolve', function (script: any) {\n                item.class!.remove('scripts-collide');\n            }));\n        };\n\n        var onAddBundle = function (asset: Observer, item: GridItem) {\n            var confirmElement = document.createElement('div');\n            confirmElement.classList.add('confirm');\n            confirmElement.classList.add('thumbnail');\n            item.element!.appendChild(confirmElement);\n\n            var onMouseOver = function () {\n                if (!dragging || grid.dragOver === asset)\n                    return;\n\n                if (!draggingData.ids && !draggingData.id) {\n                    // script file drag\n                    return;\n                }\n\n                var assetIds = (draggingData.ids && draggingData.ids.length > 0) ? draggingData.ids.slice() : [draggingData.id];\n\n                // don't allow to drag on it self\n                if (assetIds.indexOf(asset.get('id')) !== -1) {\n                    return;\n                }\n\n                // make sure we'fe found at least 1 valid asset\n                var valid = false;\n                var bundleAssets = asset.get('data.assets');\n                for (var i = 0; i < assetIds.length; i++) {\n                    var draggedAsset = editor.call('assets:get', assetIds[i]);\n                    if (!draggedAsset) continue;\n                    if (bundleAssets.indexOf(draggedAsset.get('id')) !== -1) continue;\n\n                    if (!draggedAsset.get('source')) {\n                        var type = draggedAsset.get('type');\n                        if (['folder', 'script', 'bundle'].indexOf(type) === -1) {\n                            valid = true;\n                            break;\n                        }\n                    }\n                }\n\n                if (!valid) return;\n\n                showGridDropHighlight(item);\n\n                grid.dragOver = asset;\n            };\n\n            var onMouseOut = function () {\n                if (!dragging || grid.dragOver !== asset)\n                    return;\n\n                gridDropBorder.classList.remove('active');\n                grid.dragOver = undefined;\n            };\n\n            item.element!.addEventListener('mouseout', onMouseOut, false);\n            item.element!.addEventListener('mouseover', onMouseOver, false);\n        };\n\n\n\n        editor.on('assets:add', function (asset: Observer, pos: number) {\n\n\n            var events: any = [];\n            var item = new GridItem();\n            item.asset = asset;\n            item.class!.add('type-' + asset.get('type'));\n\n            item.element!.addEventListener('mouseover', onAssetItemHover, false);\n            item.element!.addEventListener('mouseout', onAssetItemBlur, false);\n\n            asset.once('destroy', onAssetItemRemove.bind(asset));\n\n            var onMouseDown = function (evt: MouseEvent) {\n\n                evt.stopPropagation();\n            };\n\n            var onDragStart = function (evt: DragEvent) {\n                evt.preventDefault();\n                evt.stopPropagation();\n\n                // if (!editor.call('permissions:write'))\n                //     return;\n\n                var type = 'asset.' + asset.get('type');\n                var data = {\n                    id: asset.get('id'),\n                    ids: new Array<number>()\n                };\n\n                var selectorType = editor.call('selector:type');\n                var selectorItems = editor.call('selector:items');\n\n                if (selectorType === 'asset' && selectorItems.length > 1) {\n                    var path = selectorItems[0].get('path');\n\n                    if (selectorItems.indexOf(asset) !== -1) {\n                        var ids = [];\n                        for (var i = 0; i < selectorItems.length; i++) {\n                            // don't allow multi-path dragging\n                            if (path.length !== selectorItems[i].get('path').length || path[path.length - 1] !== selectorItems[i].get('path')[path.length - 1])\n                                return;\n\n                            ids.push(selectorItems[i].get('id'));\n                        }\n\n                        type = 'assets';\n                        data = {\n                            id: '',\n                            ids: ids\n                        };\n                    }\n                }\n\n                // console.log(type);\n                // console.log(data);\n                // console.log(selectorType);\n                // console.log(selectorItems);\n\n                editor.call('drop:set', type, data);\n                editor.call('drop:activate', true);\n            };\n\n            if (asset.get('type') === 'folder') {\n                onAddFolder(asset, item);\n                item.tree!.elementTitle.addEventListener('mousedown', onMouseDown, false);\n                item.tree.elementTitle.addEventListener('dragstart', onDragStart, false);\n            } else if (asset.get('type') === 'script') {\n                onAddScript(asset, item, events);\n            } else if (asset.get('type') === 'bundle') {\n                // onAddBundle(asset, item, events);\n            }\n\n            var updateTask = function () {\n                var status = asset.get('task');\n                item.class!.remove('task', 'failed', 'running');\n                if (status && typeof (status) === 'string' && status[0] !== '{') {\n                    item.class!.add('task', status);\n                }\n            };\n\n            // add task status\n            updateTask();\n            asset.on('task:set', updateTask);\n\n            item.element!.draggable = true;\n            item.element!.addEventListener('mousedown', onMouseDown, false);\n            item.element!.addEventListener('dragstart', onDragStart, false);\n\n\n            assetsIndex[asset.get('id')] = item;\n\n            // source\n            if (asset.get('source'))\n                item.class!.add('source');\n\n            // TODO：assets过滤器功能\n            // console.log(editor.call('assets:panel:filter:default'));\n            if (!editor.call('assets:panel:filter:default')('asset', asset)) {\n                // console.log('assets:panel:filter:default');\n                item.hidden = true;\n            }\n\n\n            var fileSize = asset.get('file.size');\n\n            if (!asset.get('source')) {\n                // update thumbnails change\n                asset.on('thumbnails.m:set', function (value: string) {\n                    // if (value.startsWith('/api')) {\n                    //     // value = value.appendQuery('t=' + asset.get('file.hash'));\n                    //     value = Tools.appendQuery(value, 't=' + asset.get('file.hash'));\n                    // }\n                    getThumbnailUrl(Config.projectID, asset.get('id'), asset.get('name'), asset.get('file.hash')).then(response => {\n                        thumbnail.style.backgroundImage = 'url(\"' + response + '\")';\n                    });\n                    // thumbnail.style.backgroundImage = 'url(' + value + ')';\n                    thumbnail.classList.remove('placeholder');\n                });\n\n                asset.on('thumbnails.m:unset', function () {\n                    thumbnail.style.backgroundImage = 'none';\n                    thumbnail.classList.add('placeholder');\n                });\n            }\n\n            // folder open\n            if (asset.get('type') === 'folder') {\n                // 文件夹双击\n                item.element!.addEventListener('dblclick', function () {\n                    tree.clear();\n                    item.tree.open = true;\n                    editor.call('assets:filter:search', '');\n                    editor.call('assets:panel:currentFolder', item.asset);\n\n                    // change back selection\n                    if (selector.type)\n                        editor.call('selector:set', selector.prev.type, selector.prev.items);\n                }, false);\n            }\n\n            // open sprite editor for textureatlas and sprite assets\n            if (asset.get('type') === 'sprite' || asset.get('type') === 'textureatlas') {\n                item.element!.addEventListener('dblclick', function () {\n                    editor.call('picker:sprites', item.asset);\n                }, false);\n            }\n\n\n            var thumbnail: any;\n            var evtSceneSettings: any;\n            var evtAssetChanged: any;\n\n            if (asset.get('type') === 'material' || asset.get('type') === 'models' || asset.get('type') === 'sprite' || (asset.get('type') === 'font') && !asset.get('source')) {\n                var queuedRender = false;\n\n                thumbnail = document.createElement('img');\n                // thumbnail.changed = true;\n                thumbnail.width = 64;\n                thumbnail.height = 64;\n\n                if (asset.get('type') !== 'sprite') {\n                    thumbnail.classList.add('flipY');\n                }\n\n                editor.call('material:preview', thumbnail, asset);\n\n                // let htmlCanvas = document.createElement('canvas');\n                // htmlCanvas.width = 64;\n                // htmlCanvas.height = 64;\n                // htmlCanvas.style.display = 'none';\n                // document.body.append(htmlCanvas);\n\n                // // TODO: 需要按队列渲染，不然异步流程导致同时开的webgl context太多，会崩溃\n                // let engine = new BABYLON.Engine(htmlCanvas, true);\n                // let scene = new BABYLON.Scene(engine);\n\n                // // scene.clearColor = BABYLON.Color4.FromColor3(BABYLON.Color3.Green());\n                // scene.clearColor.a = 0;\n\n                // var light = new BABYLON.DirectionalLight('light', new BABYLON.Vector3(45, 45, 0), scene);\n\n                // var camera = new BABYLON.ArcRotateCamera('PreviewCamera', 10, 10, 10, new BABYLON.Vector3(0, 0, 0), scene);\n                // // camera.setPosition(new BABYLON.Vector3(20, 200, 400));\n\n                // camera.attachControl(htmlCanvas, true);\n                // camera.lowerBetaLimit = 0.1;\n                // camera.upperBetaLimit = (Math.PI / 2) * 0.99;\n                // camera.lowerRadiusLimit = 150;\n\n                // let box = BABYLON.MeshBuilder.CreateSphere('__previewSphere', { diameter: 80 }, scene);\n\n                // // engine.runRenderLoop(() => {\n                // //     if (scene) {\n                // //         scene.render();\n                // //     }\n                // // });\n\n                // scene.render();\n                // // TODO: 需要更新\n                // BABYLON.Tools.CreateScreenshotUsingRenderTarget(engine, camera, 64, (data: string) => {\n                //     console.log(data);\n                //     thumbnail.src = data;\n                // });\n\n                // engine.dispose();\n\n\n\n\n\n            } else {\n                thumbnail = document.createElement('div');\n                // (<HTMLElement>thumbnail).widt\n            }\n\n            item.thumbnail = thumbnail;\n            thumbnail.classList.add('thumbnail');\n            item.element!.appendChild(thumbnail);\n\n            if (asset.has('has_thumbnail') && asset.get('has_thumbnail') === true && !asset.get('source')) {\n\n                getThumbnailUrl(Config.projectID, asset.get('id'), asset.get('name'), asset.get('file.hash')).then(response => {\n                    thumbnail.style.backgroundImage = 'url(\"' + response + '\")';\n                });\n            } else {\n                thumbnail.classList.add('placeholder');\n            }\n\n            var icon = document.createElement('div');\n            icon.classList.add('icon');\n            item.element!.appendChild(icon);\n\n            var label = item.labelElement = document.createElement('div');\n            label.classList.add('label');\n            label.textContent = asset.get('name');\n            item.element!.appendChild(label);\n\n            var users = item.users = document.createElement('div');\n            users.classList.add('users');\n            item.element!.appendChild(users);\n\n            // update name/filename change\n            events.push(asset.on('name:set', function (name: string, nameOld: string) {\n                // grid\n                label.textContent = asset.get('name');\n                // tree\n                if (item.tree) {\n                    item.tree.text = asset.get('name');\n\n                    // resort element (move match alphabetical order)\n                    var parent = <TreeItem>item.tree.parent;\n                    item.tree.parent!.element!.removeChild(item.tree.element!);\n                    var closest = treeFindClosest(parent, item.tree, nameOld);\n                    if (closest === -1) {\n                        parent.element!.appendChild(item.tree.element!);\n                    } else {\n                        parent.element!.insertBefore(item.tree.element!, parent.child(closest));\n                    }\n\n                    resizeQueue();\n                }\n\n                keepLegacyScriptsAtTop();\n            }));\n\n            events.push(asset.on('path:set', function (path: string, pathOld: string) {\n                // show or hide based on filters\n                item.hidden = !editor.call('assets:panel:filter:default')('asset', asset);\n\n                // console.log(path + ' -- ' + pathOld);\n                // console.log(item.hidden);\n\n                if (item.tree) {\n                    if (!pathOld.length || !path.length || path[path.length - 1] !== pathOld[pathOld.length - 1]) {\n                        (<TreeItem>item.tree.parent!).remove(item.tree);\n                        var parent;\n\n                        if (path.length) {\n                            parent = assetsIndex[path[path.length - 1]].tree;\n                        } else {\n                            parent = treeRoot;\n                        }\n\n                        var closest = treeFindClosest(parent, item.tree);\n                        if (closest === -1) {\n                            parent.append(item.tree);\n                        } else {\n                            parent.appendBefore(item.tree, <TreeItem>(parent.child(closest).ui));\n                        }\n                    }\n\n                    if (currentFolder === asset) {\n                        // console.error('emit');\n                        editor.emit('assets:panel:currentFolder', currentFolder);\n                    }\n\n                }\n\n                keepLegacyScriptsAtTop();\n            }));\n\n            if (!asset.get('source')) {\n                // used event\n                var evtUnused = editor.on('assets:used:' + asset.get('id'), function (state: boolean) {\n                    if (state) {\n                        item.class!.remove('unused');\n                    } else {\n                        item.class!.add('unused');\n                    }\n                });\n                // used state\n                if (!editor.call('assets:used:get', asset.get('id')))\n                    item.class!.add('unused');\n\n                // clean events\n                item.once('destroy', function () {\n                    evtUnused.unbind();\n                });\n            }\n\n            // clean events\n            item.once('destroy', function () {\n                editor.call('selector:remove', asset);\n\n                for (var i = 0; i < events.length; i++)\n                    events[i].unbind();\n                events = null;\n\n                delete assetsIndex[asset.get('id')];\n\n                if (evtSceneSettings)\n                    evtSceneSettings.unbind();\n\n                if (evtAssetChanged)\n                    evtAssetChanged.unbind();\n            });\n\n            // grid.append(item);\n            // append to grid\n            var assets: ObserverList = editor.call('assets:raw');\n            if (pos === -1 || !assets.data[pos + 1]) {\n                grid.append(item);\n            } else {\n                grid.appendBefore(item, assetsIndex[assets.data[pos + 1].get('id')]);\n            }\n\n            resizeQueue();\n\n            keepLegacyScriptsAtTop();\n\n        });\n\n        var keepLegacyScriptsAtTop = function () {\n            if (!legacyScripts)\n                return;\n\n            // resort scripts folder in grid\n            gridScripts.element!.parentNode!.removeChild(gridScripts.element!);\n            var first = grid.element!.firstChild;\n            if (first) {\n                grid.element!.insertBefore(gridScripts.element!, first);\n            } else {\n                grid.element!.appendChild(gridScripts.element!);\n            }\n\n            // resort scripts folder in tree\n            treeScripts.element!.parentNode!.removeChild(treeScripts.element!);\n            var next = treeRoot.elementTitle.nextSibling;\n            if (next) {\n                treeRoot.element!.insertBefore(treeScripts.element!, next);\n            } else {\n                treeRoot.element!.appendChild(treeScripts.element!);\n            }\n        };\n\n        editor.on('assets:move', function (asset: Observer, pos: number) {\n            var item = assetsIndex[asset.get('id')];\n            // remove\n            grid.element!.removeChild(item.element!);\n            // append\n            if (pos === -1) {\n                // to end\n                grid.append(item);\n            } else {\n                // before another element\n                grid.appendBefore(item, assetsIndex[editor.call('assets:raw').data[pos + 1].get('id')]);\n            }\n        });\n\n        editor.on('assets:remove', function (asset: Observer) {\n            var treeItem = assetsIndex[asset.get('id')].tree;\n            if (treeItem) {\n                if (treeItem.parent)\n                    (<TreeItem>treeItem.parent).remove(treeItem);\n                treeItem.destroy();\n            }\n\n            assetsIndex[asset.get('id')].destroy();\n\n            resizeQueue();\n\n            // reselect current directory, if selected was removed\n            if (currentFolder && typeof (currentFolder) !== 'string') {\n                var id = currentFolder.get('id');\n                var path = asset.get('path');\n                var ind = path.indexOf(id);\n                if (id === asset.get('id') || ind !== -1) {\n                    if (ind === -1)\n                        ind = path.length - 1;\n\n                    var found = false;\n                    var i = ind + 1;\n                    while (i--) {\n                        if (assetsIndex[path[i]]) {\n                            found = true;\n                            editor.call('assets:panel:currentFolder', assetsIndex[path[i]].asset);\n                            break;\n                        }\n                    }\n\n                    if (!found)\n                        editor.call('assets:panel:currentFolder', null);\n                }\n            }\n        });\n\n        var addSourceFile = function (file: Observer) {\n            file.set('type', 'script');\n\n            var item = new GridItem();\n            item.script = file;\n            item.class!.add('type-script');\n            grid.append(item);\n\n            if (!editor.call('assets:panel:filter:default')('script', file)) {\n                item.hidden = true;\n            }\n\n\n            scriptsIndex[file.get('filename')] = item;\n\n            var thumbnail = document.createElement('div');\n            thumbnail.classList.add('thumbnail', 'placeholder');\n            item.element!.appendChild(thumbnail);\n\n            var icon = document.createElement('div');\n            icon.classList.add('icon');\n            item.element!.appendChild(icon);\n\n            var label = item.labelElement = document.createElement('div');\n            label.classList.add('label');\n            label.textContent = file.get('filename');\n            item.element!.appendChild(label);\n\n            var users = item.users = document.createElement('div');\n            users.classList.add('users');\n            item.element!.appendChild(users);\n\n            // update name/filename change\n            var evtNameSet = file.on('filename:set', function (value: string, valueOld: string) {\n                label.textContent = value;\n                scriptsIndex[value] = item;\n                delete scriptsIndex[valueOld];\n            });\n            item.on('destroy', function () {\n                editor.call('selector:remove', file);\n                evtNameSet.unbind();\n                delete scriptsIndex[file.get('filename')];\n            });\n            file.on('destroy', function () {\n                item.destroy();\n            });\n\n            editor.call('drop:item', {\n                element: item.element,\n                type: 'asset.script',\n                data: {\n                    filename: file.get('filename')\n                }\n            });\n        };\n        var removeSourceFile = function (file: Observer) {\n            file.destroy();\n        };\n\n        editor.on('sourcefiles:add', addSourceFile);\n        editor.on('sourcefiles:remove', removeSourceFile);\n\n\n    }\n\n\n\n\n}","import { Observer } from \"../../lib\";\nimport { BabylonLoader } from \"../middleware/loader/babylonLoader\";\n\nexport class AssetsPreview {\n\n\n    constructor() {\n\n\n\n        editor.method('preview:render', function (asset: Observer, width: number, height: number, canvas: HTMLCanvasElement, args: any) {\n            width = width || 1;\n            height = height || 1;\n\n            // render\n            editor.call('preview:' + asset.get('type') + ':render', asset, width, height, canvas, args);\n        });\n\n\n        let matPreviewCanvas = document.createElement('canvas');\n        matPreviewCanvas.width = 64;\n        matPreviewCanvas.height = 64;\n        matPreviewCanvas.style.display = 'none';\n        document.body.append(matPreviewCanvas);\n\n        // TODO: 需要按队列渲染，不然异步流程导致同时开的webgl context太多，会崩溃\n        let engine = new BABYLON.Engine(matPreviewCanvas, true);\n        let scene = new BABYLON.Scene(engine);\n\n        // scene.clearColor = BABYLON.Color4.FromColor3(BABYLON.Color3.Green());\n        scene.clearColor.a = 0;\n\n        // let light = new BABYLON.DirectionalLight('__previewlight', new BABYLON.Vector3(1, 1, 3), scene);\n        let light = new BABYLON.HemisphericLight('__previewlight', new BABYLON.Vector3(-3, 1, -5), scene);\n        light.intensity = 0.6;\n\n        var camera = new BABYLON.UniversalCamera('__previewCamera', new BABYLON.Vector3(0, 62, -120), scene);\n        var node = new BABYLON.TransformNode('__previewNode', scene);\n        node.position.copyFrom(camera.position);\n        node.rotation.copyFrom(camera.rotation);\n        camera.parent = node;\n        camera.position = BABYLON.Vector3.Zero();\n        camera.rotation = BABYLON.Vector3.Zero();\n        camera.inputs.clear();\n        node.rotation.x = 27.2 * Math.PI / 180;\n        // camera.setTarget(BABYLON.Vector3.Zero());\n\n        let previewSphere = BABYLON.MeshBuilder.CreateSphere('__previewSphere', { diameter: 100 }, scene);\n\n        let defaultMat = new BABYLON.StandardMaterial('__previewShere', scene);\n        // defaultMat.diffuseColor = BABYLON.Color3.Green();\n        previewSphere.material = defaultMat;\n        // engine.runRenderLoop(() => {\n        //     if (scene) {\n        //         scene.render();\n        //     }\n        // });\n\n\n        // engine.dispose();\n\n        let queueMaterialAssets: any[] = [];\n        let matQueuing: boolean = false;\n\n        let createMatPreview = async() => {\n            matQueuing = true;\n\n            while (queueMaterialAssets.length > 0) {\n                let queueElement = queueMaterialAssets.shift();\n                // console.error(queueElement[1]._data2.data);\n                let newMat =await BabylonLoader.loadMaterial(queueElement[1]._data2.data, scene, '');\n                // console.warn(newMat);\n                if (newMat) {\n                    previewSphere.material = newMat;\n                } else {\n                    previewSphere.material = defaultMat;\n                }\n\n                if (scene.isReady()) {\n                    // 球改一下\n                    // (<BABYLON.StandardMaterial>previewSphere.material).diffuseColor = new BABYLON.Color3(Math.random(), Math.random(), Math.random());\n                    scene.render();\n                    // TODO: 需要更新\n                    BABYLON.Tools.CreateScreenshotUsingRenderTarget(engine, camera, 64, (data: string) => {\n                        // console.log(data);\n                        queueElement[0].src = data;\n                    });\n                } else {\n                    setTimeout(() => {\n                        waitForRender(queueElement[0]);\n                    }, 300);\n                    matQueuing = false;\n                    return;\n                }\n            }\n\n            matQueuing = false;\n        }\n\n\n        let waitForRender = (element: any) => {\n            if (scene.isReady()) {\n                scene.render();\n                // TODO: 需要更新\n                BABYLON.Tools.CreateScreenshotUsingRenderTarget(engine, camera, 64, (data: string) => {\n                    // console.log(data);\n                    element.src = data;\n                });\n                setTimeout(createMatPreview, 0);\n            } else {\n                setTimeout(() => {\n                    waitForRender(element);\n                }, 300);\n            }\n        };\n\n        editor.method('material:preview', (thumbnail: any, asset: Observer) => {\n            queueMaterialAssets.push([thumbnail, asset]);\n\n        });\n\n        editor.method('material:preview:start', () => {\n            if (!matQueuing) {\n                // console.warn('入口打开material preview');\n                // console.warn(asset);\n                setTimeout(createMatPreview, 0);\n            } else {\n                // console.warn('中间排队material preview');\n            }\n        });\n\n        // TODO: 简易处理\n        editor.method('material:preview:assemble', (asset_data: any) => {\n            if (asset_data && asset_data.babylon) {\n                for (let firstKey in asset_data.babylon) {\n                    if (asset_data.babylon[firstKey]['materials']) {\n                        let materialData = asset_data.babylon[firstKey]['materials'];\n                        for (let secondKey in materialData) {\n                            if (materialData[secondKey]['asset_id']) {\n                                let matAssetID = materialData[secondKey]['asset_id'];\n\n                                if (materialData[secondKey]['diffuseTexture']) {\n                                    let textureID = asset_data.assets[matAssetID].data.diffuseTexture.texture_id;\n                                    asset_data.assets[matAssetID].data.diffuseTexture.name = BabylonLoader.prefix + textureID + '/' + asset_data.assets[textureID].name;\n                                }\n\n                                if (materialData[secondKey]['specularTexture']) {\n                                    let textureID = asset_data.assets[matAssetID].data.specularTexture.texture_id;\n                                    asset_data.assets[matAssetID].data.specularTexture.name = BabylonLoader.prefix + textureID + '/' + asset_data.assets[textureID].name;\n                                }\n\n                                if (materialData[secondKey]['reflectionTexture']) {\n                                    let textureID = asset_data.assets[matAssetID].data.reflectionTexture.texture_id;\n                                    asset_data.assets[matAssetID].data.reflectionTexture.name = BabylonLoader.prefix + textureID + '/' + asset_data.assets[textureID].name;\n                                }\n\n                                if (materialData[secondKey]['refractionTexture']) {\n                                    let textureID = asset_data.assets[matAssetID].data.refractionTexture.texture_id;\n                                    asset_data.assets[matAssetID].data.refractionTexture.name = BabylonLoader.prefix + textureID + '/' + asset_data.assets[textureID].name;\n                                }\n\n                                if (materialData[secondKey]['emissiveTexture']) {\n                                    let textureID = asset_data.assets[matAssetID].data.emissiveTexture.texture_id;\n                                    asset_data.assets[matAssetID].data.emissiveTexture.name = BabylonLoader.prefix + textureID + '/' + asset_data.assets[textureID].name;\n                                }\n\n                                if (materialData[secondKey]['bumpTexture']) {\n                                    let textureID = asset_data.assets[matAssetID].data.bumpTexture.texture_id;\n                                    asset_data.assets[matAssetID].data.bumpTexture.name = BabylonLoader.prefix + textureID + '/' + asset_data.assets[textureID].name;\n                                }\n\n                                if (materialData[secondKey]['opacityTexture']) {\n                                    let textureID = asset_data.assets[matAssetID].data.opacityTexture.texture_id;\n                                    asset_data.assets[matAssetID].data.opacityTexture.name = BabylonLoader.prefix + textureID + '/' + asset_data.assets[textureID].name;\n                                }\n\n                                if (materialData[secondKey]['ambientTexture']) {\n                                    let textureID = asset_data.assets[matAssetID].data.ambientTexture.texture_id;\n                                    asset_data.assets[matAssetID].data.ambientTexture.name = BabylonLoader.prefix + textureID + '/' + asset_data.assets[textureID].name;\n                                }\n\n                                if (materialData[secondKey]['lightmapTexture']) {\n                                    let textureID = asset_data.assets[matAssetID].data.lightmapTexture.texture_id;\n                                    asset_data.assets[matAssetID].data.lightmapTexture.name = BabylonLoader.prefix + textureID + '/' + asset_data.assets[textureID].name;\n                                }\n                            }\n\n                        }\n                    }\n                }\n            }\n        });\n\n\n\n    }\n\n\n\n}","import { Observer } from '../../lib';\nimport { AjaxRequest, Ajax } from '../utility';\nimport { Config } from '../global';\nimport {getJsonConfig,upLoadJsonConfig} from \"../../tools/ossfile\";\nimport {UUid} from '../utility/uuid'\n\nexport class AssetsRename {\n\n    public constructor() {\n\n        var changeName = async (assetId: string, assetName: string)=> {\n            var assetJsonStr = await getJsonConfig(Config.projectID,\"assets\");\n            var assetFile=JSON.parse(assetJsonStr);\n            assetFile.assets[assetId].name = assetName;\n            if (assetFile.assets[assetId].file !== null &&assetFile.assets[assetId].file !== undefined)\n            {\n                var postfix = assetFile.assets[assetId].file.filename\n                    .split(\".\")\n                    .pop();\n                if (assetName.endsWith(postfix)) {\n                    assetFile.assets[assetId].file.filename = assetName;\n                } else {\n                    assetFile.assets[assetId].file.filename =\n                    assetName + \".\" + postfix;\n                }\n\n                assetFile.assets[assetId].modifiedAt = UUid.createdAtTime();\n            }\n            upLoadJsonConfig(JSON.stringify(assetFile),Config.projectID,\"assets\");\n            let asset = editor.call('assets:get',assetId);\n            // console.log(asset);\n            if(asset) {\n                asset.set('name', assetName);\n            }\n        }\n\n        editor.method('assets:rename', function (asset: Observer, newName: string) {\n            var oldName = asset.get('name');\n            var id = asset.get('id');\n            editor.call('history:add', {\n                name: 'asset rename',\n                undo: function () {\n                    if (editor.call('assets:get', id)) {\n                        changeName(id, oldName);\n                    }\n                },\n                redo: function () {\n                    if (editor.call('assets:get', id)) {\n                        changeName(id, newName);\n                    }\n                }\n            });\n\n            changeName(id, newName);\n        });\n\n\n    }\n\n}","import { Button } from \"../../ui\";\nimport { VeryEngine } from \"../../engine\";\n\nexport class AssetsStore {\n\n    public constructor() {\n\n        var assetsPanel = VeryEngine.assets;\n\n        var btnStore = new Button('说明文档');\n        btnStore.class!.add('store');\n        assetsPanel.header.append(btnStore);\n\n        btnStore.on('click', function () {\n            window.open('http://doc.veryengine.cn/readme/web/?#/12', '_blank');\n        });\n    }\n}","import { Observer } from '../../lib';\n\nexport class AssetsSync {\n\n    public constructor() {\n\n        editor.method('initAssets', (assets_data: any) => {\n            if(assets_data.assets) {\n                onLoad(assets_data.assets);\n                editor.call('material:preview:assemble', assets_data);\n                editor.call('material:preview:start');\n            }\n                \n        });\n\n        // Asseting, uniqueId为assets索引id\n        editor.method('loadAsset', function (asset_data: any, callback: any) {\n\n            var assetData = asset_data;\n\n            // if (assetData.file) {\n            //     // 生成资源所在url，这里并没有开始加载资源\n            //     assetData.file.url = getFileUrl(assetData.id, assetData.revision, assetData.file.filename);\n\n            //     if (assetData.file.variants) {\n            //         for (var key in assetData.file.variants) {\n            //             assetData.file.variants[key].url = getFileUrl(assetData.id, assetData.revision, assetData.file.variants[key].filename);\n            //         }\n            //     }\n            // }\n\n            var asset = new Observer(assetData);\n            editor.call('assets:add', asset);\n            // console.log('load: ' + asset.get('name'));\n\n            if (callback)\n                callback(asset);\n        });\n\n        // 加载assets数据，data为assets数据\n        var onLoad = function (data: any) {\n            editor.call('assets:progress', 0.5);\n\n            var count = 0;\n            let assetsLength: number = Object.getOwnPropertyNames(data).length;\n            // 加载Asset资源\n            var load = function (asset_data: any) {\n                editor.call('loadAsset', asset_data, function () {\n                    count++;\n                    editor.call('assets:progress', (count / assetsLength) * 0.5 + 0.5);\n                    if (count >= assetsLength) {\n                        editor.call('assets:progress', 1);\n                        editor.emit('assets:load');\n                    }\n                });\n            };\n\n            for (let key in data) {\n                load(data[key]);\n            }\n\n        };\n\n\n\n        var onAssetSelect = function (asset: Observer) {\n            editor.call('selector:set', 'asset', [asset]);\n\n            // navigate to folder too\n            var path = asset.get('path');\n            if (path.length) {\n                editor.call('assets:panel:currentFolder', editor.call('assets:get', path[path.length - 1]));\n            } else {\n                editor.call('assets:panel:currentFolder', null);\n            }\n        };\n\n        // create asset\n        editor.method('assets:create', function (data: any, fn: any, noSelect: boolean) {\n            var evtAssetAdd: any;\n\n            if (!noSelect) {\n                editor.once('selector:change', function () {\n                    if (evtAssetAdd) {\n                        evtAssetAdd.unbind();\n                        evtAssetAdd = null;\n                    }\n                });\n            }\n\n            editor.call('assets:uploadFile', data, function (err: Error, res: any) {\n                if (err) {\n                    editor.call('status:error', err);\n\n                    // TODO\n                    // disk allowance error\n\n                    if (fn) fn(err);\n\n                    return;\n                }\n\n                if (!noSelect) {\n                    var asset = editor.call('assets:get', res.id);\n                    if (asset) {\n                        onAssetSelect(asset);\n                    } else {\n                        evtAssetAdd = editor.once('assets:add[' + res.id + ']', onAssetSelect);\n                    }\n                }\n\n                if (fn) fn(err, res.id);\n            });\n        });\n\n\n\n\n    }\n}","import { VeryEngine } from '../../engine';\nimport { Observer } from '../../lib';\nimport { Config } from '../global';\nimport { UUid } from '../utility/uuid';\nimport { BabylonLoader } from '../middleware/loader/babylonLoader';\n\n\nexport class AssetsUpload {\n\n    public constructor() {\n\n        // 当前任务记录\n        var uploadJobs = 0;\n        var assetFile: any = {};\n        var fileIndex = 0;\n        var fileCount = 0;\n        var userSettings: any = editor.call('settings:projectUser');\n        // var legacyScripts = editor.call('settings:project').get('useLegacyScripts');\n        var legacyScripts = false;\n\n        var targetExtensions: { [key: string]: boolean } = {\n            'jpg': true,\n            'jpeg': true,\n            'png': true,\n            'gif': true,\n            'table': true,\n            'html': true,\n            'json': true,\n            'xml': true,\n            'txt': true,\n            'vert': true,\n            'frag': true,\n            'glsl': true,\n            'mp3': true,\n            'ogg': true,\n            'wav': true,\n            'mp4': true,\n            'm4a': true,\n            'js': true,\n            'atlas': true,\n            'babylon': true\n        };\n\n        var typeToExt: { [key: string]: string[] } = {\n            'model': ['fbx', 'dae', 'obj', '3ds', 'babylon'],\n            'data': ['txt', 'xml', 'atlas', 'table'],\n            'html': ['html'],\n            'json': ['json'],\n            'texture': ['tif', 'tga', 'png', 'jpg', 'jpeg', 'gif', 'bmp', 'dds', 'hdr', 'exr'],\n            'audio': ['wav', 'mp3', 'mp4', 'ogg', 'm4a'],\n            'shader': ['glsl', 'frag', 'vert'],\n            'script': ['js'],\n            'font': ['ttf', 'ttc', 'otf', 'dfont']\n        };\n\n\n        var extToType: { [key: string]: string } = {};\n        for (var type in typeToExt) {\n            for (var i = 0; i < typeToExt[type].length; i++) {\n                extToType[typeToExt[type][i]] = type;\n            }\n        }\n\n\n        editor.method('assets:canUploadFiles', function (files: any) {\n            // check usage first\n            var totalSize = 0;\n            for (var i = 0; i < files.length; i++) {\n                totalSize += files[i].size;\n            }\n            // 计算用户当前空间用量，假如要限制每个用户的空间大小，超过则不允许再上传\n            // return config.owner.size + totalSize <= config.owner.diskAllowance;\n\n            console.log('资源总容量：' + (totalSize / 1024 / 1024));\n\n            return true;\n        });\n\n\n        var appendCommon = function (form: any, args: any) {\n            // parent folder\n            if (args.parent) {\n                if (args.parent instanceof Observer) {\n                    form.parent = args.parent.get('id');\n                } else {\n                    var id = parseInt(args.parent, 10);\n                    if (!isNaN(id))\n                        form.parent = (id + '');\n                }\n            }\n\n            // filename\n            if (args.filename) {\n                form.filename = args.filename;\n            }\n            if (args.name) {\n                form.name = args.name;\n            }\n            // file\n            if (args.file && args.file.size) {\n                form.file = args.file, (args.filename || args.name);\n            }\n\n            return form;\n        };\n\n        var create = function (args: any) {\n            var formData: any = {};\n            if (!args.type) {\n                console.error('\\'type\\' required for upload request');\n            }\n            formData.type = args.type;\n            if (args.tags) {\n                formData.tags = args.tags.join('\\n');\n            }\n            if (args.source_asset_id) {\n                formData.source_asset_id = args.source_asset_id;\n            }\n            if (args.data) {\n                formData.data = JSON.stringify(args.data);\n            }\n            if (args.meta) {\n                formData.meta = JSON.stringify(args.meta);\n            }\n            formData.preload = args.preload === undefined ? true : args.preload;\n            formData = appendCommon(formData, args);\n            return formData;\n        }\n\n        var update = function (assetId: string, args: any) {\n            var form: any = {};\n            form.assetId = assetId;\n            form = appendCommon(form, args);\n            return form;\n        };\n\n        editor.method('assets:uploadFile', async (args: any, fn?: Function) => {\n            // 单独处理创建表格或者文件夹类，不需要等待所有文件上传完毕后再修改asset josn\n            if (fileCount == 0) {\n                fileCount = 1;\n                var assetJson = await ossfile.getJsonConfig(Config.projectID, 'assets');\n                assetFile = JSON.parse(assetJson);\n            }\n            var form: any = {};\n            let replaceMode: boolean = false;\n            if (args.asset && args.type && args.type !== 'model') {\n                var assetId = args.asset.get('id');\n                form = update(assetId, args);\n                replaceMode = true;\n                form.replaceAsset = assetId;\n                if (args.type) {\n                    form.type = args.type;\n                }\n            } else {\n                form = create(args);\n            }\n\n            form.projectID = Config.projectID;\n            form.path = args.path;\n\n            var job = ++uploadJobs;\n            editor.call('status:job', 'asset-upload:' + job, 0);\n\n            // 上传新资源\n            if (!replaceMode) {\n                var backData = [];\n                var assetData: any = {};\n                if (form.file) {\n                    if (form.file.length == undefined) {\n                        var hash = await UUid.getmd5(form.file);\n                        var assetID = UUid.createAssetID();\n\n                        // TODO: 上传文件入口，异常处理？？？\n                        await ossfile.uploadFile(form.file, Config.projectID, assetID, form.name, hash);\n\n                        var createdAt = UUid.createdAtTime();\n                        assetData = {\n                            id: assetID,\n                            type: form.type,\n                            createdAt: createdAt,\n                            modifiedAt: createdAt,\n                            name: form.name,\n                            preload: form.preload,\n                            has_thumbnail: false,\n                            scope: {\n                                type: 'project',\n                                id: form.projectID,\n                            },\n                            file: {\n                                filename: form.file.name,\n                                size: form.file.size,\n                                hash: hash,\n                            },\n                            data: null,\n                            path: form.path === '' ? [] : form.path.split(','),\n                        };\n                        // 最近的文件夹path值\n                        var closestPath = !assetData.path || assetData.path.length === 0 ? 'root' : assetData.path[assetData.path.length - 1];\n                        if (!assetFile.assets) {\n                            assetFile['assets'] = {};\n                        }\n                        // 与babylon文件进行索引\n                        if (form.type === 'texture') {\n                            assetData['has_thumbnail'] = true;\n\n                            if (assetFile.assets[assetID] === undefined) {\n                                assetFile.assets[assetID] = assetData;\n                            }\n                            backData.push(assetData);\n\n                            // 添加resource 信息\n                            if (!assetFile.babylon_resource) {\n                                assetFile['babylon_resource'] = {};\n                            }\n                            // babylon_resource path信息\n                            if (!assetFile.babylon_resource[closestPath]) {\n                                assetFile.babylon_resource[closestPath] = {};\n                            }\n                            assetFile.babylon_resource[closestPath][assetID] = true;\n                            // 关联babylon material\n                            if (!assetFile.babylon) {\n                                assetFile['babylon'] = { path: {} };\n                            }\n                            if (assetFile.babylon.path[closestPath]) {\n                                var babylons = assetFile.babylon.path[closestPath];\n                                for (var babylonKey in babylons) {\n                                    if (\n                                        assetFile.babylon[babylonKey] &&\n                                        assetFile.babylon[babylonKey].materials\n                                    ) {\n                                        var itemData =\n                                            assetFile.babylon[babylonKey].materials;\n                                        for (var matKey in itemData) {\n                                            for (var itemKey in itemData[matKey]) {\n                                                if (itemKey === 'asset_id') {\n                                                    continue;\n                                                }\n                                                // 关联判断,bingo\n                                                if (\n                                                    itemData[matKey][itemKey] ===\n                                                    form.name\n                                                ) {\n                                                    // 修改material参数\n                                                    if (\n                                                        itemData[matKey]['asset_id'] &&\n                                                        assetFile.assets[\n                                                        itemData[matKey]['asset_id']\n                                                        ]\n                                                    ) {\n                                                        assetFile.assets[\n                                                            itemData[matKey]['asset_id']\n                                                        ].data[itemKey][\n                                                            'texture_id'\n                                                        ] = assetID;\n                                                    }\n                                                }\n                                            }\n                                        }\n                                    }\n                                }\n                            }\n                        }\n                        else if (form.type === 'model') {\n                            if (assetFile.assets[assetID] === undefined) {\n                                assetFile.assets[assetID] = assetData;\n                            }\n                            backData.push(assetData);\n\n                            var ext1 = form.file.name.split('.');\n                            var ext = ext1[ext1.length - 1].toLowerCase();\n\n                            // babylon文件解析\n                            if (ext === 'babylon') {\n                                if (!assetFile.babylon) {\n                                    assetFile['babylon'] = { path: {} };\n                                }\n                                // resource 信息\n                                if (!assetFile.babylon_resource) {\n                                    assetFile['babylon_resource'] = {};\n                                }\n                                // babylon path信息\n                                if (!assetFile.babylon.path[closestPath]) {\n                                    assetFile.babylon.path[closestPath] = {};\n                                }\n                                assetFile.babylon.path[closestPath][assetID] = true;\n                                // babylon material信息\n                                assetFile.babylon[assetID] = { materials: {} };\n                                // 读取文件\n                                var babylonFile;\n                                babylonFile = await new Promise<string>((resolve, reject) => {\n                                    var reader = new FileReader();\n                                    reader.readAsText(form.file, 'utf-8');\n                                    reader.onload = function (e) {\n                                        resolve(reader.result!.toString());\n                                    };\n                                    reader.onerror = function (err) {\n                                        reject(err);\n                                    }\n                                })\n                                babylonFile = JSON.parse(babylonFile);\n                                if (babylonFile.materials) {\n                                    for (\n                                        var i = 0, len = babylonFile.materials.length;\n                                        i < len;\n                                        i++\n                                    ) {\n                                        var matID = UUid.createAssetID();\n                                        var matData = babylonFile.materials[i];\n                                        var matAssetData = {\n                                            id: matID,\n                                            type: 'material',\n                                            createdAt: createdAt,\n                                            modifiedAt: createdAt,\n                                            name: matData.name,\n                                            preload: false,\n                                            has_thumbnail: false,\n                                            scope: {\n                                                type: 'project',\n                                                id: form.projectID,\n                                            },\n                                            file: null,\n                                            data: matData,\n                                            path: assetData.path,\n                                        };\n                                        // 更新整体数据\n                                        if (assetFile.assets[matID] === undefined) {\n                                            assetFile.assets[matID] = matAssetData;\n                                        }\n                                        backData.push(matAssetData);\n                                        // 更新\n                                        assetFile.babylon[assetID]['materials'][\n                                            matData.id\n                                        ] = {\n                                            asset_id: matID,\n                                        };\n                                        // 检测texture\n                                        if (matData.diffuseTexture) {\n                                            assetFile.babylon[assetID]['materials'][\n                                                matData.id\n                                            ]['diffuseTexture'] =\n                                                matData.diffuseTexture.name;\n                                        }\n                                        if (matData.specularTexture) {\n                                            assetFile.babylon[assetID]['materials'][\n                                                matData.id\n                                            ]['specularTexture'] =\n                                                matData.specularTexture.name;\n                                        }\n                                        if (matData.reflectionTexture) {\n                                            assetFile.babylon[assetID]['materials'][\n                                                matData.id\n                                            ]['reflectionTexture'] =\n                                                matData.reflectionTexture.name;\n                                        }\n                                        if (matData.refractionTexture) {\n                                            assetFile.babylon[assetID]['materials'][\n                                                matData.id\n                                            ]['refractionTexture'] =\n                                                matData.refractionTexture.name;\n                                        }\n                                        if (matData.emissiveTexture) {\n                                            assetFile.babylon[assetID]['materials'][\n                                                matData.id\n                                            ]['emissiveTexture'] =\n                                                matData.emissiveTexture.name;\n                                        }\n                                        if (matData.bumpTexture) {\n                                            assetFile.babylon[assetID]['materials'][\n                                                matData.id\n                                            ]['bumpTexture'] = matData.bumpTexture.name;\n                                        }\n                                        if (matData.opacityTexture) {\n                                            assetFile.babylon[assetID]['materials'][\n                                                matData.id\n                                            ]['opacityTexture'] =\n                                                matData.opacityTexture.name;\n                                        }\n                                        if (matData.ambientTexture) {\n                                            assetFile.babylon[assetID]['materials'][\n                                                matData.id\n                                            ]['ambientTexture'] =\n                                                matData.ambientTexture.name;\n                                        }\n                                        if (matData.lightmapTexture) {\n                                            assetFile.babylon[assetID]['materials'][\n                                                matData.id\n                                            ]['lightmapTexture'] =\n                                                matData.lightmapTexture.name;\n                                        }\n                                    }\n                                }\n\n                                // texture关联\n                                if (assetFile.babylon_resource[closestPath]) {\n                                    var resourceData =\n                                        assetFile.babylon_resource[closestPath];\n                                    var matData = assetFile.babylon[assetID]['materials'];\n                                    for (var mat_id in matData) {\n                                        for (var item_id in matData[mat_id]) {\n                                            if (item_id === 'asset_id') continue;\n                                            for (var resource_id in resourceData) {\n                                                // 条件成立\n                                                if (\n                                                    assetFile.assets[resource_id].name ===\n                                                    matData[mat_id][item_id]\n                                                ) {\n                                                    assetFile.assets[\n                                                        matData[mat_id]['asset_id']\n                                                    ].data[item_id][\n                                                        'texture_id'\n                                                    ] = resource_id;\n                                                }\n                                            }\n                                        }\n                                    }\n                                }\n                            }\n                        }\n                    }\n                    else {\n                        for (var i = 0; i < form.file.length; i++) {\n                            console.error('上传资源未知情况！！！！！');\n                            console.error(form.file[i]);\n                        }\n                    }\n                }\n                else {\n                    if (form.type === 'folder') {\n                        var assetID = UUid.createAssetID();\n                        var createdAt = UUid.createdAtTime();\n                        assetData = {\n                            id: assetID,\n                            type: form.type,\n                            createdAt: createdAt,\n                            modifiedAt: createdAt,\n                            name: form.name,\n                            preload: form.preload,\n                            has_thumbnail: false,\n                            scope: {\n                                type: 'project',\n                                id: form.projectID,\n                            },\n                            file: null,\n                            data: null,\n                            path:\n                                form.path === '' ? [] : form.path.split(','),\n                        };\n                        if (!assetFile.assets) {\n                            assetFile['assets'] = {};\n                        }\n                        if (assetFile.assets[assetID] === undefined) {\n                            assetFile.assets[assetID] = assetData;\n                        }\n                        backData.push(assetData);\n                    }\n                    else if (form.type === 'table') {\n                        var assetID = UUid.createAssetID();\n                        var createdAt = UUid.createdAtTime();\n                        await ossfile.uploadJsonAsset(Config.tableStandard, form.projectID, assetID, 'table');\n\n                        var createdAt = UUid.createdAtTime();\n                        assetData = {\n                            id: assetID,\n                            type: form.type,\n                            createdAt: createdAt,\n                            modifiedAt: createdAt,\n                            name: form.name,\n                            preload: form.preload !== undefined ? form.preload : false,\n                            has_thumbnail: false,\n                            scope: {\n                                type: 'project',\n                                id: form.projectID,\n                            },\n                            file: {\n                                filename: form.name,\n                                size: 0,\n                                hash: UUid.createUuid(),\n                            },\n                            data: null,\n                            path:\n                                form.path === '' ? [] : form.path.split(','),\n                        };\n                        if (!assetFile.assets) {\n                            assetFile['assets'] = {};\n                        }\n                        if (assetFile.assets[assetID] === undefined) {\n                            assetFile.assets[assetID] = assetData;\n                        }\n                        backData.push(assetData);\n                    }\n                }\n                // 更新asset data关联数据\n                BabylonLoader.assetsData.babylon = assetFile.babylon;\n                BabylonLoader.assetsData.babylon_resource = assetFile.babylon_resource;\n\n                for (let i = 0, len = backData.length; i < len; i++) {\n                    // asset data也要更新\n                    BabylonLoader.assetsData.assets[backData[i].id] = backData[i];\n                    var asset = new Observer(backData[i]);\n                    editor.call('assets:add', asset);\n                }\n\n                // TODO：简易更新material preview数据\n                editor.call('material:preview:assemble', BabylonLoader.assetsData);\n                editor.call('material:preview:start');\n            }\n            else {\n                var assetData: any = {};\n                if (form.type === 'texture' && form.file) {\n                    var hash = await UUid.getmd5(form.file);\n                    await ossfile.uploadFile(form.file, Config.projectID, form.assetId, form.name, hash);\n                    assetFile.assets[form.assetId].modifiedAt = UUid.createdAtTime();\n                    assetFile.assets[form.assetId].file['size'] = form.file.size;\n                    assetFile.assets[form.assetId].file['hash'] = hash;\n                    assetData = assetFile.assets[form.assetId];\n                } else if (form.type === 'model') {\n                    // 待定，先不覆盖，直接上传新的数据\n                }\n                if (assetData) {\n                    let asset: Observer = editor.call('assets:get', assetData.id);\n                    if (asset && asset.get('type') === 'texture') {\n                        asset.set('modifiedAt', assetData.modifiedAt);\n                        asset.set('file.size', assetData.file.size);\n                        asset.set('file.hash', assetData.file.hash);\n                        asset.emit('thumbnails.m:set', assetData.name + '?' + assetData.file.hash);\n                        // console.log('更新图片');\n                    }\n                }\n            }\n            fileIndex++;\n            if (fileIndex === fileCount) {\n                console.log('所有文件上传完成');\n                ossfile.upLoadJsonConfig(JSON.stringify(assetFile), Config.projectID, 'assets');\n                fileIndex = 0; fileCount = 0;\n                assetFile = {};\n            }\n\n            // Ajax.post(url, form);\n\n            // 上传数据，具体入口\n            // Ajax(data)\n            //     .on('load', function (status, data) {\n            //         editor.call('status:job', 'asset-upload:' + job);\n            //         if (fn) {\n            //             fn(null, data);\n            //         }\n            //     })\n            //     .on('progress', function (progress) {\n            //         editor.call('status:job', 'asset-upload:' + job, progress);\n            //     })\n            //     .on('error', function (status, data) {\n            //         if (/Disk allowance/.test(data)) {\n            //             data += '. <a href='/upgrade' target='_blank'>UPGRADE</a> to get more disk space.';\n            //         }\n\n            //         editor.call('status:error', data);\n            //         editor.call('status:job', 'asset-upload:' + job);\n            //         if (fn) {\n            //             fn(data);\n            //         }\n            //     });\n        });\n\n        editor.method('assets:upload:files', function (files: FileList) {\n            if (fileCount != 0) {\n                console.error('上一次上传指令还未执行完成');\n                return;\n            }\n\n            if (!editor.call('assets:canUploadFiles', files)) {\n                // var msg = 'Disk allowance exceeded. <a href='/upgrade' target='_blank'>UPGRADE</a> to get more disk space.';\n                // editor.call('status:error', msg);\n                return;\n            }\n\n            var currentFolder = editor.call('assets:panel:currentFolder');\n\n            // 遍历每一个文件\n            fileCount = files.length;\n            fileIndex = 0;\n            for (var i = 0; i < files.length; i++) {\n                var path: string[] = [];\n\n                if (currentFolder && currentFolder.get)\n                    path = currentFolder.get('path').concat(currentFolder.get('id'));\n\n                var source = false;\n                var ext1: string[] = files[i].name.split('.');\n                if (ext1.length === 1)\n                    continue;\n\n                var ext: string = ext1[ext1.length - 1].toLowerCase();\n\n                var type = extToType[ext] || 'binary';\n\n                var source = type !== 'binary' && !targetExtensions[ext];\n\n\n                // 同一文件夹重名文件覆盖\n                var sourceAsset = null;\n                var candidates = editor.call('assets:find', function (item: Observer) {\n                    // check files in current folder only\n                    if (item.get('path').join(',') !== path.join(','))\n                        return false;\n\n                    if (files[i].name === item.get('name')) {\n                        return true;\n                    }\n\n                    //     // try locate source when dropping on its targets\n                    //     if (source && !item.get('source') && item.get('source_asset_id')) {\n                    //         var itemSource = editor.call('assets:get', item.get('source_asset_id'));\n                    //         if (itemSource && itemSource.get('type') === type && itemSource.get('name').toLowerCase() === files[i].name.toLowerCase()) {\n                    //             sourceAsset = itemSource;\n                    //             return false;\n                    //         }\n                    //     }\n\n\n                    //     if (item.get('source') === source && item.get('name').toLowerCase() === files[i].name.toLowerCase()) {\n                    //         // we want the same type or try to replace a texture atlas with the same name if one exists\n                    //         if (item.get('type') === type || (type === 'texture' && item.get('type') === 'textureatlas')) {\n                    //             return true;\n                    //         }\n                    //     }\n\n                    return false;\n                });\n\n\n                // candidates contains [index, asset] entries. Each entry\n                // represents an asset that could be overwritten by the uploaded asset.\n                // Use the first candidate by default (or undefined if the array is empty).\n                // If we are uploading a texture try to find a textureatlas candidate and\n                // if one exists then overwrite the textureatlas instead.\n                // var asset = candidates[0];\n                // if (type === 'texture') {\n                //     for (var j = 0; j < candidates.length; j++) {\n                //         if (candidates[j][1].get('type') === 'textureatlas') {\n                //             asset = candidates[j];\n                //             type = 'textureatlas';\n                //             break;\n                //         }\n                //     }\n                // }\n\n                var data = null;\n                if (ext === 'js') {\n                    data = {\n                        order: 100,\n                        scripts: {}\n                    };\n                }\n\n                editor.call('assets:uploadFile', {\n                    asset: (candidates && candidates.length > 0) ? candidates[0][1] : null,\n                    // asset: null,\n                    file: files[i],\n                    type: type,\n                    path: path.join(','),\n                    name: files[i].name,\n                    parent: editor.call('assets:panel:currentFolder'),\n                    pipeline: true,\n                    data: data,\n                    // meta: asset ? asset[1].get('meta') : null,\n                    meta: null\n                }, function (err: Error, data: any) {\n                    var onceAssetLoad = function (asset: Observer) {\n                        var url = asset.get('file.url');\n                        if (url) {\n                            editor.call('scripts:parse', asset);\n                        } else {\n                            asset.once('file.url:set', function () {\n                                editor.call('scripts:parse', asset);\n                            });\n                        }\n                    };\n\n                    var asset = editor.call('assets:get', data.id);\n                    if (asset) {\n                        onceAssetLoad(asset);\n                    } else {\n                        editor.once('assets:add[' + data.id + ']', onceAssetLoad);\n                    }\n                });\n            }\n        });\n\n\n\n        // 上传文件或文件夹，文件上传入口\n        editor.method('assets:upload:picker', function (args: any) {\n            args = args || {};\n\n            var parent = args.parent || editor.call('assets:panel:currentFolder');\n\n            var fileInput = document.createElement('input');\n            fileInput.type = 'file';\n            // 服务器需要识别此name\n            fileInput.name = 'file';\n            // fileInput.accept = '';\n            fileInput.multiple = true;\n            fileInput.style.display = 'none';\n            fileInput.style.verticalAlign = 'middle';\n            fileInput.style.textAlign = 'center';\n            VeryEngine.assets.append(fileInput);\n\n            var onChange = function () {\n                ossfile.getJsonConfig(Config.projectID, 'assets').then(assetJsonStr => {\n                    assetFile = JSON.parse(assetJsonStr);\n                    editor.call('assets:upload:files', fileInput.files);\n                    // 上传文件以后，开始做一些处理\n                    // 解析.babylon文件，初步处理以后上传给服务器\n\n                    var fl = fileInput.files!.length;\n                    var i = 0;\n\n                    while (i < fl) {\n                        // localize file var in the loop\n                        var file = fileInput.files![i];\n                        // console.log('name: ' + file.name);\n                        // console.warn('type: ' + file.type);\n                        // console.warn('size: ' + file.size);\n                        // console.warn('lastModified: ' + file.lastModified);\n                        i++;\n                    }\n\n                    fileInput.value = '';\n                    fileInput.removeEventListener('change', onChange);\n                    fileInput.parentNode!.removeChild(fileInput);\n                })\n            };\n\n            fileInput.addEventListener('change', onChange, false);\n            fileInput.click();\n\n        });\n    }\n}","import { ObserverList, Observer } from \"../../lib\";\n\nexport class Assets {\n\n    public constructor() {\n\n        // var uniqueIdToItemId: any = {};\n\n        // assets资源排序：folder资源排列在最前面，按文件夹名字排列；其他资源按name进行后续排序;\n        var assets = new ObserverList({\n            id: 'id',\n            sorted: function (a: Observer, b: Observer): number {\n                let a1: boolean = a.get('type') === 'folder';\n                let b1: boolean = b.get('type') === 'folder';\n\n                if (a1 !== b1) {\n                    if (a1 && !b1) return -1; else return 1;\n                }\n\n                let na: string = a.get('name').toLowerCase();\n                let nb: string = b.get('name').toLowerCase();\n\n                if (na === nb) {\n                    return 0;\n                } else if (na > nb) {\n                    return 1;\n                } else {\n                    return -1;\n                }\n                // return a.get('name').toLowerCase().localeCompare(b.get('name').toLowerCase(), 'en');\n            }\n        });\n\n        // return assets ObserverList\n        editor.method('assets:raw', function () {\n            return assets;\n        });\n\n        // allow adding assets\n        editor.method('assets:add', function (asset: Observer) {\n            // uniqueIdToItemId[asset.get('uniqueId')] = asset.get('id');\n\n            var pos = assets.add(asset);\n\n            if (pos === null)\n                return;\n\n            asset.on('name:set', function (name: string, nameOld: string) {\n                name = name.toLowerCase();\n                nameOld = nameOld.toLowerCase();\n\n                var ind = assets.data.indexOf(asset);\n                var pos = assets.positionNextClosest(asset, function (a: Observer, b: Observer) {\n                    let a1: boolean = a.get('type') === 'folder';\n                    let b1: boolean = b.get('type') === 'folder';\n\n                    if (a1 !== b1) {\n                        if (a1 && !b1) return -1; else return 1;\n                    }\n\n                    let na: string = a.get('name').toLowerCase();\n                    let nb: string = b.get('name').toLowerCase();\n\n                    if (na === nb) {\n                        return 0;\n                    } else if (na > nb) {\n                        return 1;\n                    } else {\n                        return -1;\n                    }\n                    // return a.get('name').toLowerCase().localeCompare(b.get('name').toLowerCase(), 'en');\n                });\n\n                if (pos === -1 && (ind + 1) == assets.data.length)\n                    return;\n\n                if (ind !== -1 && (ind + 1 === pos) || (ind === pos))\n                    return;\n\n                if (ind < pos)\n                    pos--;\n\n                assets.move(asset, pos);\n                editor.emit('assets:move', asset, pos);\n            });\n\n            // publish added asset\n            editor.emit('assets:add[' + asset.get('id') + ']', asset, pos);\n            editor.emit('assets:add', asset, pos);\n        });\n\n        // allow removing assets\n        editor.method('assets:remove', function (asset: Observer) {\n            assets.remove(asset);\n        });\n\n        // remove all assets\n        editor.method('assets:clear', function () {\n            assets.clear();\n            editor.emit('assets:clear');\n\n            // uniqueIdToItemId = {};\n        });\n\n        // get asset by id\n        editor.method('assets:get', function (id: string) {\n            return assets.get(id);\n        });\n\n        // get asset by unique id\n        // editor.method('assets:getUnique', function (uniqueId: string) {\n        //     var id = uniqueIdToItemId[uniqueId];\n        //     return id ? assets.get(id) : null;\n        // });\n\n        // find assets by function\n        editor.method('assets:find', function (fn: Function) {\n            return assets.find(fn);\n        });\n\n        // find one asset by function\n        editor.method('assets:findOne', function (fn: Function) {\n            return assets.findOne(fn);\n        });\n\n        editor.method('assets:map', function (fn: Function) {\n            assets.map(fn);\n        });\n\n        editor.method('assets:list', function () {\n            return assets.array();\n        });\n\n        // publish remove asset\n        assets.on('remove', function (asset: Observer) {\n            asset.destroy();\n            editor.emit('assets:remove', asset);\n            editor.emit('assets:remove[' + asset.get('id') + ']');\n\n            // delete uniqueIdToItemId[asset.get('uniqueId')];\n        });\n\n\n    }\n}","export * from './assets';\nexport * from './assets-fs';\nexport * from './assets-sync';\nexport * from './assets-preview';\nexport * from './assets-panel';\nexport * from './assets-preview';\nexport * from './assets-panel-control';\nexport * from  './assets-context-menu';\nexport * from './assets-filter';\nexport * from './assets-upload';\nexport * from './assets-drop';\nexport * from './assets-store';\nexport * from './assets-create-folder';\nexport * from './assets-create-table';\nexport * from './assets-rename';\nexport * from './keeper';","import { AssetsPanel } from \"./assets-panel\";\nimport { AssetsPanelControl } from \"./assets-panel-control\";\nimport { AssetsFilter } from \"./assets-filter\";\nimport { AssetsUpload } from \"./assets-upload\";\nimport { AssetsStore } from \"./assets-store\";\nimport { AssetsContextMenu } from \"./assets-context-menu\";\nimport { TestAssets } from \"./test\";\nimport { Assets } from \"./assets\";\nimport { AssetsCreateFolder } from \"./assets-create-folder\";\nimport { AssetsSync } from \"./assets-sync\";\nimport { AssetsDrop } from \"./assets-drop\";\nimport { AssetsCreateTable } from \"./assets-create-table\";\nimport { AssetsRename } from \"./assets-rename\";\nimport { AssetsFs } from \"./assets-fs\";\nimport { AssetsPreview } from \"./assets-preview\";\n\nexport class  AssetsKeeper {\n\n\n    constructor() {\n        let assets = new Assets();\n\n        let syncAssets = new AssetsSync();\n        new AssetsFs();\n        new AssetsPreview();\n        let assetPanel = new AssetsPanel();\n        let panelControl = new AssetsPanelControl();\n        let filter = new AssetsFilter();\n\n        let createFolder = new AssetsCreateFolder();\n        let contextMenu = new AssetsContextMenu();\n\n        let createTable = new AssetsCreateTable();\n\n        let upload = new AssetsUpload();\n\n        let drop = new AssetsDrop();\n\n        let library = new AssetsStore();\n\n        new AssetsRename();\n\n\n\n        // let test = new TestAssets();\n\n        \n        \n    }\n\n\n}","import { Observer } from \"../../../lib\";\nimport { Button } from \"../../../ui\";\nimport { BabylonLoader } from \"../../middleware/loader/babylonLoader\";\nimport {getUrl} from \"../../../tools/ossfile\"\nimport { Config } from \"../../global/config\";\n\nexport class AttributeAssetsTexture {\n\n    public constructor() {\n\n        var panelsStates: any = {};\n\n        editor.on('attributes:inspect[asset]', function (assets: Observer[]) {\n\n            // console.error('attributes:inspect[asset]');\n            // console.error(assets);\n\n            for (var i = 0; i < assets.length; i++) {\n                if (assets[i].get('type') !== 'texture' && assets[i].get('type') !== 'textureatlas' || assets[i].get('source'))\n                    return;\n            }\n\n            var events: any = [];\n\n            var ids: string[] = [];\n            for (var i = 0; i < assets.length; i++)\n                ids.push(assets[i].get('id'));\n\n            let id = ids.sort(function (a: string, b: string) {\n                return a.localeCompare(b);\n            }).join(',');\n\n            var panelState = panelsStates[id];\n            var panelStateNew = false;\n            if (!panelState) {\n                panelStateNew = true;\n                panelState = panelsStates[id] = {};\n\n                panelState['texture'] = false;\n                panelState['compression'] = false;\n            }\n\n            // 多个材质，改变属性面板标题\n            if (assets.length > 1) {\n                var numTextures = 0;\n                var numTextureAtlases = 0;\n                for (var i = 0; i < assets.length; i++) {\n                    if (assets[i].get('type') === 'texture') {\n                        numTextures++;\n                    } else {\n                        numTextureAtlases++;\n                    }\n                }\n                var msg = '';\n                var comma = '';\n                // if (numTextures) {\n                //     msg += numTextures + ' Texture' + (numTextures > 1 ? 's' : '');\n                //     comma = ', ';\n                // }\n                if (numTextures) {\n                    msg += numTextures + '张贴图';\n                    comma = ', ';\n                }\n                if (numTextureAtlases) {\n                    msg += comma + numTextureAtlases + ' Texture Atlas' + (numTextureAtlases > 1 ? 'es' : '');\n                }\n                editor.call('attributes:header', msg);\n            }\n\n            // properties panel\n            var panel = editor.call('attributes:addPanel', {\n                name: '贴图',\n                foldable: true,\n                folded: panelState['texture']\n            });\n            panel.class.add('component');\n            panel.on('fold', function () { panelState['texture'] = true; });\n            panel.on('unfold', function () { panelState['texture'] = false; });\n            // reference\n            editor.call('attributes:reference:attach', 'asset:texture:asset', panel, panel.headerElement);\n\n            // Calculate Meta按钮，暂时没用其实\n            var btnGetMeta = new Button('Calculate Meta');\n            btnGetMeta.class!.add('calculate-meta', 'large-with-icon');\n            var btnGetMetaVisibility = function () {\n                var visible = false;\n                for (var i = 0; i < assets.length; i++) {\n                    if (!visible && !assets[i].get('meta'))\n                        visible = true;\n                }\n                btnGetMeta.hidden = !visible;\n            };\n            btnGetMeta.on('click', function () {\n                if (!editor.call('permissions:write'))\n                    return;\n\n                for (var i = 0; i < assets.length; i++) {\n                    if (assets[i].get('meta'))\n                        continue;\n\n                    editor.call('realtime:send', 'pipeline', {\n                        name: 'meta',\n                        id: assets[i].get('uniqueId')\n                    });\n                }\n                btnGetMeta.enabled = false;\n            });\n            panel.append(btnGetMeta);\n\n            btnGetMetaVisibility();\n            for (var i = 0; i < assets.length; i++) {\n                if (btnGetMeta.hidden && !assets[i].get('meta'))\n                    btnGetMeta.hidden = false;\n\n                events.push(assets[i].on('meta:set', function () {\n                    btnGetMetaVisibility();\n                }));\n                events.push(assets[i].on('meta:unset', function () {\n                    btnGetMeta.hidden = false;\n                }));\n            }\n\n            // width\n            var fieldWidth = editor.call('attributes:addField', {\n                parent: panel,\n                name: 'Width',\n                link: assets,\n                path: 'meta.width',\n                placeholder: 'pixels'\n            });\n            // reference\n            editor.call('attributes:reference:attach', 'asset:texture:width', fieldWidth.parent.innerElement.firstChild.ui);\n\n            // height\n            var fieldHeight = editor.call('attributes:addField', {\n                parent: panel,\n                name: 'Height',\n                link: assets,\n                path: 'meta.height',\n                placeholder: 'pixels'\n            });\n            // reference\n            editor.call('attributes:reference:attach', 'asset:texture:height', fieldHeight.parent.innerElement.firstChild.ui);\n\n            // depth\n            var fieldDepth = editor.call('attributes:addField', {\n                parent: panel,\n                name: 'Depth',\n                link: assets,\n                path: 'meta.depth',\n                placeholder: 'bit'\n            });\n            var checkDepthField = function () {\n                if (!fieldDepth.value)\n                    fieldDepth.element.innerHTML = 'unknown';\n            };\n            checkDepthField();\n            fieldDepth.on('change', checkDepthField);\n            // reference\n            editor.call('attributes:reference:attach', 'asset:texture:depth', fieldDepth.parent.innerElement.firstChild.ui);\n\n            // alpha\n            var fieldAlpha = editor.call('attributes:addField', {\n                parent: panel,\n                name: 'Alpha',\n                link: assets,\n                path: 'meta.alpha'\n            });\n            var checkAlphaField = function () {\n                if (!fieldAlpha.value)\n                    fieldAlpha.element.innerHTML = 'false';\n            };\n            checkAlphaField();\n            fieldAlpha.on('change', checkAlphaField);\n            // reference\n            editor.call('attributes:reference:attach', 'asset:texture:alpha', fieldAlpha.parent.innerElement.firstChild.ui);\n\n            // interlaced\n            var fieldInterlaced = editor.call('attributes:addField', {\n                parent: panel,\n                name: 'Interlaced',\n                link: assets,\n                path: 'meta.interlaced'\n            });\n            var checkInterlacedField = function () {\n                if (!fieldInterlaced.value)\n                    fieldInterlaced.element.innerHTML = 'false';\n            };\n            checkInterlacedField();\n            fieldInterlaced.on('change', checkInterlacedField);\n            // reference\n            editor.call('attributes:reference:attach', 'asset:texture:interlaced', fieldInterlaced.parent.innerElement.firstChild.ui);\n\n\n            // rgbm\n            var fieldRgbm = editor.call('attributes:addField', {\n                parent: panel,\n                name: 'Rgbm',\n                link: assets,\n                path: 'data.rgbm',\n                type: 'checkbox'\n            });\n            // reference\n            editor.call('attributes:reference:attach', 'asset:texture:rgbm', fieldRgbm.parent.innerElement.firstChild.ui);\n\n            // mipmaps\n            var fieldMips = editor.call('attributes:addField', {\n                parent: panel,\n                name: 'Mipmaps',\n                link: assets,\n                path: 'data.mipmaps',\n                type: 'checkbox'\n            });\n            // reference\n            editor.call('attributes:reference:attach', 'asset:texture:mipmaps', fieldMips.parent.innerElement.firstChild.ui);\n\n            // filtering\n            var fieldFiltering = editor.call('attributes:addField', {\n                parent: panel,\n                name: 'Filtering',\n                type: 'string',\n                enum: {\n                    '': '...',\n                    'nearest': 'Point',\n                    'linear': 'Linear'\n                }\n            });\n            // reference\n            editor.call('attributes:reference:attach', 'asset:texture:filtering', fieldFiltering.parent.innerElement.firstChild.ui);\n\n\n\n\n            // preview\n            if (assets.length === 1) {\n\n                var root = editor.call('attributes.rootPanel');\n\n                var reloadImage = function () {\n                    // if (assets[0].get('file.url') && assets[0].get('file.hash')) {\n                    //     image.src = assets[0].get('file.url').appendQuery('t=' + assets[0].get('file.hash'));\n                    //     previewContainer.style.display = '';\n                    // } else {\n                    //     previewContainer.style.display = 'none';\n                    // }\n\n                    if (assets[0].get('file')) {\n                        getUrl(Config.projectID,assets[0].get('id'),assets[0].get('name'),assets[0].get('file.hash')).then(response=>{\n                            image.src = response;\n                            previewContainer.style.display = '';\n                        })\n                    } else {\n                        previewContainer.style.display = 'none';\n                    }\n                };\n\n                var previewContainer = document.createElement('div');\n                previewContainer.classList.add('asset-preview-container');\n\n                var preview = document.createElement('div');\n                preview.classList.add('asset-preview');\n                var image = new Image();\n                image.onload = function () {\n                    root.class.add('animate');\n                    preview.style.backgroundImage = 'url(\"' + image.src + '\")';\n                };\n                reloadImage();\n                previewContainer.appendChild(preview);\n\n                preview.addEventListener('click', function () {\n                    if (root.element.classList.contains('large')) {\n                        root.element.classList.remove('large');\n                    } else {\n                        root.element.classList.add('large');\n                    }\n                }, false);\n\n                root.class.add('asset-preview');\n                root.element.insertBefore(previewContainer, root.innerElement);\n\n                var eventsPreview: any[] = [];\n                eventsPreview.push(assets[0].on('file.hash:set', reloadImage));\n                eventsPreview.push(assets[0].on('file.url:set', reloadImage));\n\n                panel.on('destroy', function () {\n                    for (var i = 0; i < eventsPreview.length; i++)\n                        eventsPreview[i].unbind();\n                    previewContainer.parentNode!.removeChild(previewContainer);\n                    root.class.remove('asset-preview', 'animate');\n                });\n            }\n\n            panel.once('destroy', function () {\n                for (var i = 0; i < events.length; i++)\n                    events[i].unbind();\n            });\n\n\n        });\n\n\n\n    }\n\n}","import { Panel, Button } from \"../../ui\";\nimport { Observer } from \"../../lib\";\nimport { BabylonLoader } from \"../middleware/loader/babylonLoader\";\nimport {donwLoad} from \"../../tools/ossfile\";\nimport { Config } from \"../global\";\n\nexport class AttributesAssets {\n    public constructor() {\n\n        var sourceRuntimeOptions = {\n            '-1': 'various',\n            '0': 'yes',\n            '1': 'no'\n        };\n\n        var editableTypes = {\n            'script': 1,\n            'table': 1,\n            'html': 1,\n            'shader': 1,\n            'text': 1,\n            'json': 1\n        };\n\n        var legacyScripts = false;\n\n\n        var assetsPanel: Nullable<Panel> = null;\n\n\n        editor.on('attributes:inspect[asset]', function (assets: Observer[]) {\n            var events: any = [];\n\n            // unfold panel\n            var panel = editor.call('attributes.rootPanel');\n            if (panel.folded)\n                panel.folded = false;\n\n            var multi = assets.length > 1;\n            var type = ((assets[0].get('source') && assets[0].get('type') !== 'folder') ? 'source ' : '') + assets[0].get('type');\n\n            if (multi) {\n                editor.call('attributes:header', assets.length + ' assets');\n\n                for (var i = 0; i < assets.length; i++) {\n                    if (type !== ((assets[0].get('source') && assets[0].get('type') !== 'folder') ? 'source ' : '') + assets[i].get('type')) {\n                        type = '';\n                        break;\n                    }\n                }\n            } else {\n                editor.call('attributes:header', type);\n            }\n\n            // panel\n            var panel = editor.call('attributes:addPanel');\n            panel.class.add('component');\n            assetsPanel = panel;\n            panel.once('destroy', function () {\n                assetsPanel = null;\n\n                for (var i = 0; i < events.length; i++)\n                    events[i].unbind();\n\n                events = null;\n            });\n\n            // 暂时不考虑\n            /*\n            var allBundles = editor.call('assets:bundles:list');\n            var bundlesEnum = { \"\": \"\" };\n            for (var i = 0; i < allBundles.length; i++) {\n                bundlesEnum[allBundles[i].get('id')] = allBundles[i].get('name');\n            }\n            */\n\n            if (multi) {\n                var fieldFilename = editor.call('attributes:addField', {\n                    parent: panel,\n                    name: 'Assets',\n                    value: assets.length\n                });\n\n                var scriptSelected = false;\n\n\n\n            } else {\n\n                if (legacyScripts && assets[0].get('type') === 'script') {\n                    // filename\n                    var fieldFilename = editor.call('attributes:addField', {\n                        parent: panel,\n                        name: 'Filename',\n                        // type: 'string',\n                        link: assets[0],\n                        path: 'filename'\n                    });\n                    // reference\n                    editor.call('attributes:reference:attach', 'asset:script:filename', fieldFilename.parent.innerElement.firstChild.ui);\n\n                } else {\n                    // id\n                    var fieldId = editor.call('attributes:addField', {\n                        parent: panel,\n                        name: 'ID',\n                        link: assets[0],\n                        path: 'id'\n                    });\n                    // reference\n                    editor.call('attributes:reference:attach', 'asset:id', fieldId.parent.innerElement.firstChild.ui);\n\n                    // name\n                    var fieldName = editor.call('attributes:addField', {\n                        parent: panel,\n                        name: '名字',\n                        type: 'string',\n                        value: assets[0].get('name')\n                    });\n                    events.push(assets[0].on('name:set', function (newName: string) {\n                        fieldName.value = newName;\n                    }));\n                    events.push(fieldName.on('change', function (newName: string) {\n                        // console.log('newName: ' + newName);\n                        // console.log('name: ' + assets[0].get('name'));\n                        if (newName !== assets[0].get('name')) {\n                            editor.call('assets:rename', assets[0], newName);\n                        }\n                    }));\n                    fieldName.class.add('asset-name');\n                    // reference\n                    editor.call('attributes:reference:attach', 'asset:name', fieldName.parent.innerElement.firstChild.ui);\n\n                    if (!assets[0].get('source') && assets[0].get('type') !== 'folder') {\n                        // tags\n                        var fieldTags = editor.call('attributes:addField', {\n                            parent: panel,\n                            name: 'Tags',\n                            placeholder: 'Add Tag',\n                            type: 'tags',\n                            tagType: 'string',\n                            link: assets[0],\n                            path: 'tags'\n                        });\n                        // reference\n                        editor.call('attributes:reference:attach', 'asset:tags', fieldTags.parent.parent.innerElement.firstChild.ui);\n                    }\n\n                    // runtime\n                    var runtime = sourceRuntimeOptions[assets[0].get('source') ? '1' : '0'];\n                    // var runtime = sourceRuntimeOptions['0'];\n                    if (assets[0].get('type') === 'folder')\n                        runtime = sourceRuntimeOptions['1'];\n\n                    var fieldRuntime = editor.call('attributes:addField', {\n                        parent: panel,\n                        name: 'Runtime',\n                        value: runtime\n                    });\n                    // reference\n                    editor.call('attributes:reference:attach', 'asset:runtime', fieldRuntime.parent.innerElement.firstChild.ui);\n\n                    // taskInfo\n                    var fieldFailed = editor.call('attributes:addField', {\n                        parent: panel,\n                        name: 'Failed',\n                        link: assets[0],\n                        path: 'taskInfo'\n                    });\n                    fieldFailed.class.add('error');\n\n                    var checkFailed = function () {\n                        fieldFailed.parent.hidden = assets[0].get('task') !== 'failed' || !assets[0].get('taskInfo');\n                    };\n                    checkFailed();\n\n                    events.push(assets[0].on('task:set', checkFailed));\n                    events.push(assets[0].on('taskInfo:set', checkFailed));\n                    events.push(assets[0].on('taskInfo:unset', checkFailed));\n\n                }\n\n                // type\n                var fieldType = editor.call('attributes:addField', {\n                    parent: panel,\n                    name: 'Type',\n                    value: type\n                });\n                // reference\n                editor.call('attributes:reference:attach', 'asset:type', fieldType.parent.innerElement.firstChild.ui);\n                // reference type\n                if (!assets[0].get('source'))\n                    editor.call('attributes:reference:asset:' + assets[0].get('type') + ':asset:attach', fieldType);\n\n                if (!(legacyScripts && assets[0].get('type') === 'script') && assets[0].get('type') !== 'folder' && !assets[0].get('source')) {\n                    // preload\n                    var fieldPreload = editor.call('attributes:addField', {\n                        parent: panel,\n                        name: 'Preload',\n                        type: 'checkbox',\n                        link: assets[0],\n                        path: 'preload'\n                    });\n                    fieldPreload.parent.class.add('preload');\n                    editor.call('attributes:reference:attach', 'asset:preload', fieldPreload.parent.innerElement.firstChild.ui);\n                }\n\n\n\n\n                // size\n                /*\n                if (assets[0].has('file') || assets[0].get('type') === 'bundle') {\n                    var size = assets[0].get('type') === 'bundle' ? editor.call('assets:bundles:calculateSize', assets[0]) : assets[0].get('file.size');\n                    var fieldSize = editor.call('attributes:addField', {\n                        parent: panel,\n                        name: 'Size',\n                        value: bytesToHuman(size)\n                    });\n\n                    var evtSize = [];\n                    evtSize.push(assets[0].on('file:set', function (value) {\n                        fieldSize.text = bytesToHuman(value ? value.size : 0);\n                    }));\n\n                    evtSize.push(assets[0].on('file.size:set', function (value) {\n                        fieldSize.text = bytesToHuman(value);\n                    }));\n\n                    if (assets[0].get('type') === 'bundle') {\n                        var recalculateSize = function () {\n                            fieldSize.text = bytesToHuman(editor.call('assets:bundles:calculateSize', assets[0]));\n                        };\n\n                        evtSize.push(assets[0].on('data.assets:set', recalculateSize));\n                        evtSize.push(assets[0].on('data.assets:insert', recalculateSize));\n                        evtSize.push(assets[0].on('data.assets:remove', recalculateSize));\n                    }\n\n                    panel.once('destroy', function () {\n                        for (var i = 0; i < evtSize.length; i++) {\n                            evtSize[i].unbind();\n                        }\n                        evtSize.length = 0;\n                    });\n\n                    // reference\n                    editor.call('attributes:reference:attach', 'asset:size', fieldSize.parent.innerElement.firstChild.ui);\n                }\n                */\n\n                // 下载区域按钮\n                var panelButtons = new Panel();\n                panelButtons.class!.add('buttons');\n                panel.append(panelButtons);\n\n                // download\n                if (assets[0].get('type') !== 'folder' && !(legacyScripts && assets[0].get('type') === 'script') && assets[0].get('type') !== 'sprite') {\n                    // download\n                    var btnDownload = new Button();\n\n                    btnDownload.hidden = !editor.call('permissions:read');\n                    var evtBtnDownloadPermissions = editor.on('permissions:set:' + 'id', function () {\n                        btnDownload.hidden = !editor.call('permissions:read');\n                    });\n\n                    btnDownload.text = '下载';\n                    btnDownload.class!.add('download-asset', 'large-with-icon');\n                    btnDownload.element!.addEventListener('click', function (evt) {\n                        // if (btnDownload.prevent)\n                        //     return;\n\n                        // 下载\n                        if (assets[0].get('source') || assets[0].get('type') === 'texture' || assets[0].get('type') === 'audio'||assets[0].get('type') === 'model') {\n                            donwLoad(Config.projectID,assets[0].get('id'),assets[0].get('name'),assets[0].get('file.hash'));\n                        } else {\n                            window.open('/api/assets/' + assets[0].get('id') + '/download?branchId=' + 'id');\n                        }\n                    });\n                    panelButtons.append(btnDownload);\n\n                    btnDownload.once('destroy', function () {\n                        evtBtnDownloadPermissions.unbind();\n                    });\n                }\n\n\n\n\n\n\n            }\n        });\n\n\n\n\n\n        editor.on('attributes:assets:toggleInfo', function (enabled: boolean) {\n            if (assetsPanel) {\n                assetsPanel.hidden = !enabled;\n            }\n        });\n\n        editor.method('attributes:assets:panel', function () {\n            return assetsPanel;\n        });\n    }\n}","import { Panel, Button, Menu, MenuItem, Label } from '../../ui';\nimport { Observer } from '../../lib';\n\nexport class AttributesEntity {\n\n\n\n\n    public constructor() {\n\n        var panelComponents: any;\n\n        editor.method('attributes:entity.panelComponents', function () {\n            return panelComponents;\n        });\n\n        editor.method('attributes:entity:addComponentPanel', function (args: any) {\n            var title = args.title;\n            var name = args.name;\n            var entities = args.entities;\n            var events: any = [];\n\n            // panel\n            var panel = editor.call('attributes:addPanel', {\n                parent: panelComponents,\n                name: title\n            });\n            panel.class.add('component', 'entity', name);\n            // reference\n            // editor.call('attributes:reference:' + name + ':attach', panel, panel.headerElementTitle);\n\n            // show/hide panel\n            var checkingPanel: boolean;\n            var checkPanel = function () {\n                checkingPanel = false;\n\n                var show = entities[0].get('type') === name;\n                for (var i = 1; i < entities.length; i++) {\n                    if (show !== entities[i].get('type') === name) {\n                        show = false;\n                        break;\n                    }\n                }\n\n                panel.disabled = !show;\n                panel.hidden = !show;\n            };\n            var queueCheckPanel = function () {\n                if (checkingPanel)\n                    return;\n\n                checkingPanel = true;\n                setTimeout(checkPanel);\n            }\n            checkPanel();\n            for (var i = 0; i < entities.length; i++) {\n                events.push(entities[i].on('components.' + name + ':set', queueCheckPanel));\n                events.push(entities[i].on('components.' + name + ':unset', queueCheckPanel));\n            }\n            panel.once('destroy', function () {\n                // console.log('panel destroy');\n                for (var i = 0; i < entities.length; i++)\n                    events[i].unbind();\n            });\n\n            // remove\n            // var fieldRemove = new Button();\n\n            // fieldRemove.hidden = !editor.call('permissions:write');\n            // events.push(editor.on('permissions:writeState', function (state: boolean) {\n            //     fieldRemove.hidden = !state;\n            // }));\n\n            // fieldRemove.class!.add('component-remove');\n            // fieldRemove.on('click', function () {\n            //     var records: any = [];\n\n            //     for (var i = 0; i < entities.length; i++) {\n            //         records.push({\n            //             get: entities[i].history._getItemFn,\n            //             value: entities[i].get('components.' + name)\n            //         });\n\n            //         entities[i].history.enabled = false;\n            //         entities[i].unset('components.' + name);\n            //         entities[i].history.enabled = true;\n            //     }\n\n            // editor.call('history:add', {\n            //     name: 'entities.set[components.' + name + ']',\n            //     undo: function () {\n            //         for (var i = 0; i < records.length; i++) {\n            //             var item = records[i].get();\n            //             if (!item)\n            //                 continue;\n\n            //             item.history.enabled = false;\n            //             item.set('components.' + name, records[i].value);\n            //             item.history.enabled = true;\n            //         }\n            //     },\n            //     redo: function () {\n            //         for (var i = 0; i < records.length; i++) {\n            //             var item = records[i].get();\n            //             if (!item)\n            //                 continue;\n\n            //             item.history.enabled = false;\n            //             item.unset('components.' + name);\n            //             item.history.enabled = true;\n            //         }\n            //     }\n            // });\n            // });\n            // panel.headerAppend(fieldRemove);\n\n            // enable/disable\n            // var fieldEnabled = editor.call('attributes:addField', {\n            //     panel: panel,\n            //     type: 'checkbox',\n            //     link: entities,\n            //     path: 'components.' + name + '.enabled'\n            // });\n            // fieldEnabled.class.remove('tick');\n            // fieldEnabled.class.add('component-toggle');\n            // fieldEnabled.element.parentNode.removeChild(fieldEnabled.element);\n            // panel.headerAppend(fieldEnabled);\n\n            // // toggle-label\n            // var labelEnabled = new Label();\n            // labelEnabled.renderChanges = false;\n            // labelEnabled.class!.add('component-toggle-label');\n            // panel.headerAppend(labelEnabled);\n            // labelEnabled.text = fieldEnabled.value ? 'On' : 'Off';\n            // fieldEnabled.on('change', function (value: any) {\n            //     labelEnabled.text = value ? 'On' : 'Off';\n            // });\n\n            return panel;\n        });\n\n\n\n        var items: any = null;\n        var argsList: any = [];\n        var argsFieldsChanges: any = [];\n\n\n        // initialize fields\n        var initialize = function () {\n            items = {};\n\n            // console.warn('initialize');\n\n            // panel\n            var panel = items.panel = editor.call('attributes:addPanel');\n            panel.class.add('component');\n\n\n            // enabled\n            var argsEnabled = {\n                parent: panel,\n                // name: 'Enabled',\n                name: '激活',\n                type: 'checkbox',\n                path: 'enabled'\n            };\n            items.fieldEnabled = editor.call('attributes:addField', argsEnabled);\n            // TODO: 帮助文档链接\n            // editor.call('attributes:reference:attach', 'entity:enabled', items.fieldEnabled.parent.innerElement.firstChild.ui);\n            argsList.push(argsEnabled);\n            argsFieldsChanges.push(items.fieldEnabled);\n\n\n            // name\n            var argsName = {\n                parent: panel,\n                name: '名字',\n                // name: 'Name',\n                type: 'string',\n                trim: true,\n                path: 'name'\n            };\n            items.fieldName = editor.call('attributes:addField', argsName);\n            items.fieldName.class.add('entity-name');\n            // editor.call('attributes:reference:attach', 'entity:name', items.fieldName.parent.innerElement.firstChild.ui);\n            argsList.push(argsName);\n            argsFieldsChanges.push(items.fieldName);\n\n\n            // tags\n            // var argsTags = {\n            //     parent: panel,\n            //     name: 'Tags',\n            //     placeholder: 'Add Tag',\n            //     type: 'tags',\n            //     tagType: 'string',\n            //     path: 'tags'\n            // };\n            // items.fieldTags = editor.call('attributes:addField', argsTags);\n            // // editor.call('attributes:reference:attach', 'entity:tags', items.fieldTags.parent.parent.innerElement.firstChild.ui);\n            // argsList.push(argsTags);\n\n\n            // position\n            var argsPosition = {\n                parent: panel,\n                name: '位置',\n                // name: 'Position',\n                placeholder: ['X', 'Y', 'Z'],\n                precision: 3,\n                step: 0.05,\n                type: 'vec3',\n                path: 'position'\n            };\n            items.fieldPosition = editor.call('attributes:addField', argsPosition);\n            // editor.call('attributes:reference:attach', 'entity:position', items.fieldPosition[0].parent.innerElement.firstChild.ui);\n            argsList.push(argsPosition);\n            argsFieldsChanges = argsFieldsChanges.concat(items.fieldPosition);\n\n            // rotation\n            var argsRotation = {\n                parent: panel,\n                name: '角度',\n                // name: 'Rotation',\n                placeholder: ['X', 'Y', 'Z'],\n                precision: 2,\n                step: 0.1,\n                type: 'vec3',\n                path: 'rotation'\n            };\n            items.fieldRotation = editor.call('attributes:addField', argsRotation);\n            // editor.call('attributes:reference:attach', 'entity:rotation', items.fieldRotation[0].parent.innerElement.firstChild.ui);\n            argsList.push(argsRotation);\n            argsFieldsChanges = argsFieldsChanges.concat(items.fieldRotation);\n\n\n            // scale\n            var argsScale = {\n                parent: panel,\n                name: '比例',\n                // name: 'Scale',\n                placeholder: ['X', 'Y', 'Z'],\n                precision: 3,\n                step: 0.05,\n                type: 'vec3',\n                path: 'scale'\n            };\n            items.fieldScale = editor.call('attributes:addField', argsScale);\n            // editor.call('attributes:reference:attach', 'entity:scale', items.fieldScale[0].parent.innerElement.firstChild.ui);\n            argsList.push(argsScale);\n            argsFieldsChanges = argsFieldsChanges.concat(items.fieldScale);\n\n            // checkCollisions\n            var argsCheckCollisions = {\n                parent: panel,\n                // name: 'Enabled',\n                name: '碰撞检测',\n                type: 'checkbox',\n                path: 'checkCollisions'\n            };\n            items.checkCollisions = editor.call('attributes:addField', argsCheckCollisions);\n            // TODO: 帮助文档链接\n            // editor.call('attributes:reference:attach', 'entity:enabled', items.fieldEnabled.parent.innerElement.firstChild.ui);\n            argsList.push(argsCheckCollisions);\n            argsFieldsChanges.push(items.checkCollisions);\n\n            // isPickable\n            var argsIsPickable = {\n                parent: panel,\n                // name: 'Enabled',\n                name: '可选中',\n                type: 'checkbox',\n                path: 'pickable'\n            };\n            items.pickable = editor.call('attributes:addField', argsIsPickable);\n            // TODO: 帮助文档链接\n            // editor.call('attributes:reference:attach', 'entity:enabled', items.fieldEnabled.parent.innerElement.firstChild.ui);\n            argsList.push(argsIsPickable);\n            argsFieldsChanges.push(items.pickable);\n\n\n            // components panel\n            panelComponents = items.panelComponents = editor.call('attributes:addPanel');\n\n            // add component\n            var btnAddComponent = items.btnAddComponent = new Button();\n\n            // btnAddComponent.hidden = !editor.call('permissions:write');\n            // editor.on('permissions:writeState', function (state: boolean) {\n            //     btnAddComponent.hidden = !state;\n            // });\n\n            // btnAddComponent.text = 'Add Component';\n            btnAddComponent.text = 'To Be Continued';\n            btnAddComponent.class!.add('add-component');\n            btnAddComponent.style!.textAlign = 'center';\n            // btnAddComponent.on('click', function (evt: MouseEvent) {\n            //     menuAddComponent.position(evt.clientX, evt.clientY);\n            //     menuAddComponent.open = true;\n            // });\n            panel.append(btnAddComponent);\n        };\n\n        // before clearing inspector, preserve elements\n        editor.on('attributes:beforeClear', function () {\n            // console.error('attributes:beforeClear');\n            // unlink fields\n            for (var i = 0; i < argsList.length; i++) {\n                argsList[i].link = null;\n                argsList[i].unlinkField();\n            }\n\n            // console.log('attributes:beforeClear');\n            // console.log(items.panel);\n            if (!items || !items.panel || !items.panel.parent)\n                return;\n            // console.log(items.panel.parent);\n            // console.log('attributes:beforeClear');\n\n            // remove panel from inspector\n            items.panel.parent.remove(items.panel);\n\n            // clear components\n            items.panelComponents.parent.remove(items.panelComponents);\n            // console.warn(items.panelComponents);\n            items.panelComponents.clear();\n\n\n        });\n\n        var inspectEvents: any = [];\n\n        // link data to fields when inspecting\n        editor.on('attributes:inspect[entity]', function (entities: Observer[]) {\n            // console.log('attributes:inspect[entity]');\n            if (entities.length > 1) {\n                editor.call('attributes:header', entities.length + '个物体');\n            } else {\n                editor.call('attributes:header', '物体属性');\n            }\n\n            if (!items)\n                initialize();\n            // console.warn(items);\n\n            // console.log('entity');\n\n            var root = editor.call('attributes.rootPanel');\n\n            if (!items.panel.parent)\n                root.append(items.panel);\n\n            if (!items.panelComponents.parent)\n                root.append(items.panelComponents);\n\n            // disable renderChanges\n            for (var i = 0; i < argsFieldsChanges.length; i++)\n                argsFieldsChanges[i].renderChanges = false;\n\n            // link fields\n            for (var i = 0; i < argsList.length; i++) {\n                argsList[i].link = entities;\n                argsList[i].linkField();\n            }\n\n            // enable renderChanges\n            for (var i = 0; i < argsFieldsChanges.length; i++)\n                argsFieldsChanges[i].renderChanges = true;\n\n            // disable fields if needed\n            toggleFields(entities);\n\n            if (entities.length === 1 && entities[0].get('type') === '2d-gui') {\n                items.panel.element.style.display = 'none';\n            } else {\n                items.panel.element.style.display = 'block';\n            }\n\n            onInspect(entities);\n        });\n\n        editor.on('attributes:clear', function () {\n            onUninspect();\n        });\n\n        var toggleFields = function (selectedEntities: Observer[]) {\n            var disablePositionXY = false;\n            var disableRotation = false;\n            var disableScale = false;\n\n            for (var i = 0, len = selectedEntities.length; i < len; i++) {\n                var entity = selectedEntities[i];\n\n                // disable rotation / scale for 2D screens\n                if (entity.get('components.screen.screenSpace')) {\n                    disableRotation = true;\n                    disableScale = true;\n                }\n\n                // disable position on the x/y axis for elements that are part of a layout group\n                if (editor.call('entities:layout:isUnderControlOfLayoutGroup', entity)) {\n                    disablePositionXY = true;\n                }\n            }\n\n            items.fieldPosition[0].enabled = !disablePositionXY;\n            items.fieldPosition[1].enabled = !disablePositionXY;\n\n            for (var i = 0; i < 3; i++) {\n                items.fieldRotation[i].enabled = !disableRotation;\n                items.fieldScale[i].enabled = !disableScale;\n\n                items.fieldRotation[i].renderChanges = !disableRotation;\n                items.fieldScale[i].renderChanges = !disableScale;\n            }\n\n        };\n\n        var onInspect = function (entities: Observer[]) {\n            onUninspect();\n\n            var addEvents = function (entity: Observer) {\n                inspectEvents.push(entity.on('*:set', function (path: string) {\n                    if (/components.screen.screenSpace/.test(path) ||\n                        /^parent/.test(path) ||\n                        /components.layoutchild.excludeFromLayout/.test(path)) {\n                        toggleFieldsIfNeeded(entity);\n                    }\n                }));\n            };\n\n            var toggleFieldsIfNeeded = function (entity: Observer) {\n                if (editor.call('selector:has', entity))\n                    toggleFields(editor.call('selector:items'));\n            };\n\n\n            for (var i = 0, len = entities.length; i < len; i++) {\n                addEvents(entities[i]);\n            }\n        };\n\n        var onUninspect = function () {\n            for (var i = 0; i < inspectEvents.length; i++) {\n                inspectEvents[i].unbind();\n            }\n\n            inspectEvents.length = 0;\n\n        };\n\n\n    }\n\n}","export class AttributeHistory {\n\n  public constructor() {\n\n  }\n\n}","import { Panel, Label, Progress, Element, TextField, Button, TextAreaField, Slider, NumberField, Checkbox, ColorField, ImageField, Code, SelectField, TopElementPanel } from \"../../ui\";\nimport { VeryEngine } from \"../../engine\";\nimport { Observer } from \"../../lib\";\nimport { getThumbnailUrl } from \"../../tools/ossfile\";\nimport { Config } from \"../global\";\n\nexport class AttributesPanel {\n\n\n    public root: TopElementPanel;\n\n    // private inspectedItems: EventHandle[] = [];\n\n    public title: string = '属性面板';\n\n    public constructor() {\n        this.root = VeryEngine.attributes;\n\n        let self = this;\n\n        let clearPanel = () => {\n            editor.emit('attributes:beforeClear');\n            // console.warn(this.root);\n            // console.log('clear panel');\n            this.root.clear();\n            editor.emit('attributes:clear');\n        };\n\n        // set header\n        editor.method('attributes:header', (text: string) => {\n            if (text.toLowerCase() === 'texture') {\n                text = '贴图';\n            } else if (text.toLowerCase() === 'material') {\n                text = '材质';\n            } else if (text.toLowerCase() === 'model') {\n                text = '模型';\n            } else if (text.toLowerCase() === 'folder') {\n                text = '文件夹';\n            }\n            self.root.headerText = text;\n        });\n\n        // return root panel\n        editor.method('attributes.rootPanel', function () {\n            return self.root;\n        });\n\n        // add panel\n        editor.method('attributes:addPanel', function (args: AddPanelArgs) {\n            args = args || {};\n\n            // panel\n            let panel = new Panel(args.name || '');\n            // parent\n            (args.parent || self.root).append(panel);\n\n            // folding\n            panel.foldable = args.foldable || args.folded || false;\n            panel.folded = args.folded || false;\n\n            return panel;\n        });\n\n        // TODO\n        var historyState = function (item: any, state: boolean) {\n            if (item.history !== undefined) {\n                if (typeof (item.history) === 'boolean') {\n                    item.history = state;\n                } else {\n                    item.history.enabled = state;\n                }\n            } else {\n                if (item._parent && item._parent.history !== undefined) {\n                    item._parent.history.enabled = state;\n                }\n            }\n        };\n\n        // get the right path from args\n        var pathAt = function (args: any, index: number) {\n            return (args.paths && args.paths.length > 0) ? args.paths[index] : args.path;\n        };\n\n        editor.method('attributes:linkField', function (args: any) {\n            var changeField, changeFieldQueue;\n            args.field._changing = false;\n            var events: any = [];\n\n            if (!(args.link instanceof Array))\n                args.link = [args.link];\n\n            var update = function () {\n                var different = false;\n                var path = pathAt(args, 0);\n                // console.log(args.link[0].has(path));\n                // console.log(args.link[0].get(path));\n                // console.error(args.link[0].get('rotation'));\n                // console.error(args.link[0].has('rotation.0'));\n                // console.error(args.link[0].has('rotation'));\n\n\n                var value = args.link[0].has(path) ? args.link[0].get(path) : undefined;\n                // console.warn(args.link[0]);\n                // console.warn('path: ' + path);\n                // console.warn(value);\n                if (args.type === 'rgb') {\n                    if (value) {\n                        for (var i = 1; i < args.link.length; i++) {\n                            path = pathAt(args, i);\n                            if (!value.equals(args.link[i].get(path))) {\n                                value = null;\n                                different = true;\n                                break;\n                            }\n                        }\n                    }\n                    if (value) {\n                        value = value.map(function (v: number) {\n                            return Math.floor(v * 255);\n                        });\n                    }\n                } else if (args.type === 'asset') {\n                    var countUndefined = value === undefined ? 1 : 0;\n                    for (var i = 1; i < args.link.length; i++) {\n                        path = pathAt(args, i);\n                        if (!args.link[i].has(path)) {\n                            countUndefined++;\n                            continue;\n                        }\n\n                        var val = args.link[i].get(path);\n\n                        if ((value || 0) !== (args.link[i].get(path) || 0)) {\n                            if (value !== undefined) {\n                                value = args.enum ? '' : null;\n                                different = true;\n                                break;\n                            }\n                        }\n\n                        value = val;\n                    }\n\n                    if (countUndefined && countUndefined != args.link.length) {\n                        args.field.class.add('star');\n                        if (! /^\\* /.test(args.field._title.text))\n                            args.field._title.text = '* ' + args.field._title.text;\n                    } else {\n                        args.field.class.remove('star');\n                        if (/^\\* /.test(args.field._title.text))\n                            args.field._title.text = args.field._title.text.substring(2);\n                    }\n\n                    if (different) {\n                        args.field.class.add('null');\n                        args.field._title.text = 'various';\n                    } else {\n                        args.field.class.remove('null');\n                    }\n                } else if (args.type === 'entity' || !args.type) {\n                    for (var i = 1; i < args.link.length; i++) {\n                        path = pathAt(args, i);\n                        if (value !== args.link[i].get(path)) {\n                            value = 'various';\n                            different = true;\n                            break;\n                        }\n                    }\n                    if (different) {\n                        args.field.class.add('null');\n                        args.field.text = 'various';\n                    } else {\n                        args.field.class.remove('null');\n                    }\n                } else {\n                    // console.error(value);\n                    // console.error(args.link);\n                    // var valueFound = false;\n                    // for (var i = 0; i < args.link.length; i++) {\n                    //     path = pathAt(args, i);\n                    //     console.error(path);\n                    //     if (!args.link[i].has(path))\n                    //         continue;\n\n                    //     if (!valueFound) {\n                    //         console.error(path);\n                    //         valueFound = true;\n                    //         value = args.link[i].get(path);\n                    //     } else {\n\n                    //         var v = args.link[i].get(path);\n                    //         console.error(args.link[i]);\n                    //         console.error(v);\n                    //         if ((value || 0) !== (v || 0)) {\n                    //             value = args.enum ? '' : null;\n                    //             different = true;\n                    //             break;\n                    //         }\n                    //     }\n                    // }\n                    // console.error(value);\n                }\n\n                args.field._changing = true;\n                args.field.value = value;\n\n\n                if (args.type === 'checkbox')\n                    args.field._onLinkChange(value);\n\n                args.field._changing = false;\n\n                // TODO\n                // if (args.enum) {\n                //     var opt = args.field.optionElements[''];\n                //     if (opt) opt.style.display = value !== '' ? 'none' : '';\n                // } else {\n                //     args.field.proxy = value == null ? '...' : null;\n                // }\n            };\n\n            changeField = function (value: any) {\n                if (args.field._changing)\n                    return;\n\n                // TODO\n                if (args.enum) {\n                    // var opt = this.optionElements[''];\n                    // if (opt) opt.style.display = value !== '' ? 'none' : '';\n                } else {\n                    // this.proxy = value === null ? '...' : null;\n                }\n\n                if (args.trim)\n                    value = value.trim();\n\n                if (args.type === 'rgb') {\n                    // console.error(value);\n                    value = value.map(function (v: number) {\n                        return v / 255;\n                    });\n                } else if (args.type === 'asset') {\n                    args.field.class.remove('null');\n                }\n\n                var items: any = [];\n\n                // set link value\n                args.field._changing = true;\n                if (args.type === 'string' && args.trim)\n                    args.field.value = value;\n\n                for (var i = 0; i < args.link.length; i++) {\n                    var path = pathAt(args, i);\n                    if (!args.link[i].has(path)) continue;\n\n                    items.push({\n                        get: args.link[i].history !== undefined ? args.link[i].history._getItemFn : null,\n                        item: args.link[i],\n                        value: args.link[i].has(path) ? args.link[i].get(path) : undefined\n                    });\n\n                    historyState(args.link[i], false);\n                    args.link[i].set(path, value);\n                    historyState(args.link[i], true);\n                }\n                args.field._changing = false;\n\n                // history\n                if (args.type !== 'rgb' && !args.slider && !args.stopHistory) {\n                    editor.call('history:add', {\n                        name: pathAt(args, 0),\n                        undo: function () {\n                            var different = false;\n                            for (var i = 0; i < items.length; i++) {\n                                var path = pathAt(args, i);\n                                var item;\n                                if (items[i].get) {\n                                    item = items[i].get();\n                                    if (!item)\n                                        continue;\n                                } else {\n                                    item = items[i].item;\n                                }\n\n                                if (!different && items[0].value !== items[i].value)\n                                    different = true;\n\n                                historyState(item, false);\n                                if (items[i].value === undefined)\n                                    item.unset(path);\n                                else\n                                    item.set(path, items[i].value);\n                                historyState(item, true);\n                            }\n\n                            if (different) {\n                                args.field.class.add('null');\n                            } else {\n                                args.field.class.remove('null');\n                            }\n                        },\n                        redo: function () {\n                            for (var i = 0; i < items.length; i++) {\n                                var path = pathAt(args, i);\n                                var item;\n                                if (items[i].get) {\n                                    item = items[i].get();\n                                    if (!item)\n                                        continue;\n                                } else {\n                                    item = items[i].item;\n                                }\n\n                                historyState(item, false);\n                                if (value === undefined)\n                                    item.unset(path);\n                                else\n                                    item.set(path, value);\n                                item.set(path, value);\n                                historyState(item, true);\n                            }\n\n                            args.field.class.remove('null');\n                        }\n                    });\n                }\n            };\n\n            changeFieldQueue = function () {\n                // console.log('changeFieldQueue');\n\n                if (args.field._changing)\n                    return;\n\n                args.field._changing = true;\n                setTimeout(function () {\n                    args.field._changing = false;\n                    update();\n                }, 0);\n            };\n\n            var historyStart: any, historyEnd: any;\n\n            if (args.type === 'rgb' || args.slider) {\n                historyStart = function () {\n                    var items = [];\n\n                    for (var i = 0; i < args.link.length; i++) {\n                        var v = args.link[i].get(pathAt(args, i));\n                        if (v instanceof Array)\n                            v = v.slice(0);\n\n                        items.push({\n                            get: args.link[i].history !== undefined ? args.link[i].history._getItemFn : null,\n                            item: args.link[i],\n                            value: v\n                        });\n                    }\n\n                    return items;\n                };\n\n                historyEnd = function (items: any, value: any) {\n                    // history\n                    editor.call('history:add', {\n                        name: pathAt(args, 0),\n                        undo: function () {\n                            for (var i = 0; i < items.length; i++) {\n                                var item;\n                                if (items[i].get) {\n                                    item = items[i].get();\n                                    if (!item)\n                                        continue;\n                                } else {\n                                    item = items[i].item;\n                                }\n\n                                historyState(item, false);\n                                item.set(pathAt(args, i), items[i].value);\n                                historyState(item, true);\n                            }\n                        },\n                        redo: function () {\n                            for (var i = 0; i < items.length; i++) {\n                                var item;\n                                if (items[i].get) {\n                                    item = items[i].get();\n                                    if (!item)\n                                        continue;\n                                } else {\n                                    item = items[i].item;\n                                }\n\n                                historyState(item, false);\n                                item.set(pathAt(args, i), value);\n                                historyState(item, true);\n                            }\n                        }\n                    });\n                };\n            }\n\n            if (args.type === 'rgb') {\n                var colorPickerOn = false;\n                events.push(args.field.on('click', function () {\n                    colorPickerOn = true;\n\n                    // set picker color\n                    editor.call('picker:color', args.field.value);\n\n                    var items: any = [];\n\n                    // picking starts\n                    var evtColorPickStart = editor.on('picker:color:start', function () {\n                        items = historyStart();\n                    });\n\n                    // picked color\n                    var evtColorPick = editor.on('picker:color', function (color: any) {\n                        // console.error(color);\n                        args.field.value = color;\n                    });\n\n                    var evtColorPickEnd = editor.on('picker:color:end', function () {\n                        historyEnd(items.slice(0), args.field.value.map(function (v: number) {\n                            return v / 255;\n                        }));\n                    });\n\n                    // position picker\n                    var rectPicker = editor.call('picker:color:rect');\n                    var rectField = args.field.element.getBoundingClientRect();\n                    editor.call('picker:color:position', rectField.left - rectPicker.width, rectField.top);\n\n                    // color changed, update picker\n                    var evtColorToPicker = args.field.on('change', function () {\n                        // TODO\n                        editor.call('picker:color:set', args.field.value);\n                    });\n\n                    // picker closed\n                    editor.once('picker:color:close', function () {\n                        evtColorPick.unbind();\n                        evtColorPickStart.unbind();\n                        evtColorPickEnd.unbind();\n                        evtColorToPicker.unbind();\n                        colorPickerOn = false;\n                        args.field.element.focus();\n                    });\n                }));\n\n                // close picker if field destroyed\n                args.field.once('destroy', function () {\n                    if (colorPickerOn)\n                        editor.call('picker:color:close');\n                });\n            } else if (args.slider) {\n                var sliderRecords: any;\n\n                events.push(args.field.on('start', function () {\n                    sliderRecords = historyStart();\n                }));\n\n                events.push(args.field.on('end', function () {\n                    historyEnd(sliderRecords.slice(0), args.field.value);\n                }));\n            }\n\n            update();\n            events.push(args.field.on('change', changeField));\n            // 数据关联设置入口\n            for (var i = 0; i < args.link.length; i++) {\n                events.push(args.link[i].on(pathAt(args, i) + ':set', changeFieldQueue));\n                events.push(args.link[i].on(pathAt(args, i) + ':unset', changeFieldQueue));\n            }\n            events.push(args.field.once('destroy', function () {\n                for (var i = 0; i < events.length; i++)\n                    events[i].unbind();\n            }));\n            // ?历史记录回溯用?\n            return events;\n        });\n\n        // add field\n        editor.method('attributes:addField', function (args: any) {\n\n            // parent panel，父物体\n            var panel = args.panel;\n\n            if (!panel) {\n                panel = new Panel();\n                panel.flexWrap = 'nowrap';\n                panel.WebkitFlexWrap = 'nowrap';\n                panel.style.display = '';\n                panel.innerElement.style.display = 'flex';\n\n                if (args.type) {\n                    panel.class.add('field-' + args.type);\n                } else {\n                    panel.class.add('field');\n                }\n\n                (args.parent || self.root).append(panel);\n            }\n\n            var label: Nullable<Label> = null;\n            if (args.name) {\n                label = new Label(args.name);\n                label.class!.add('label-field');\n                panel._label = label;\n                panel.append(label);\n\n                // 帮助链接\n                if (args.reference) {\n                    var tooltip = label.tooltip = editor.call('attributes:reference', {\n                        element: label.element,\n                        title: args.reference.title,\n                        subTitle: args.reference.subTitle,\n                        description: args.reference.description\n                    });\n\n                    tooltip.attach({\n                        target: label,\n                        element: label.element\n                    });\n                }\n            }\n\n            var field: any;\n\n            args.linkEvents = [];\n\n            // if we provide multiple paths for a single Observer then turn args.link into an array\n            if (args.paths && args.paths instanceof Array && args.link && !(args.link instanceof Array)) {\n                var link = args.link;\n                args.link = [];\n                for (var i = 0; i < args.paths.length; i++) {\n                    args.link.push(link);\n                }\n            }\n\n            // link数据模型与UI\n            var linkField = args.linkField = function () {\n                if (args.link) {\n                    var link = function (field: any, path?: any) {\n                        var data = {\n                            field: field,\n                            type: args.type,\n                            slider: args.slider,\n                            enum: args.enum,\n                            link: args.link,\n                            trim: args.trim,\n                            name: args.name,\n                            stopHistory: args.stopHistory,\n                            paths: new Array<any>(),\n                            path: ''\n                        };\n\n                        if (!path) {\n                            path = args.paths || args.path;\n                        }\n\n                        if (path instanceof Array) {\n                            data.paths = path;\n                        } else {\n                            data.path = path;\n                        }\n\n                        // console.log(data);\n\n                        args.linkEvents = args.linkEvents.concat(editor.call('attributes:linkField', data));\n                        // console.log(data);\n                        // console.warn(args.linkEvents);\n\n                        // Give the field a uniquely addressable css class that we can target from Selenium\n                        if (field.element && typeof path === 'string') {\n                            field.element.classList.add('field-path-' + path.replace(/\\./g, '-'));\n                        }\n                    };\n\n                    if (field instanceof Array) {\n                        for (var i = 0; i < field.length; i++) {\n                            var paths = args.paths;\n\n                            if (paths) {\n                                paths = paths.map(function (p: string) {\n                                    return p + '.' + i.toString();\n                                });\n                            }\n\n                            // console.error(field[i]);\n                            // console.error(paths || (args.path + '.' + i));\n\n                            // vec3类型在这里path添加后缀\n                            link(field[i], paths || (args.path + '.' + i));\n                        }\n                    } else {\n                        link(field);\n                    }\n                }\n            };\n\n            var unlinkField = args.unlinkField = function () {\n                for (var i = 0; i < args.linkEvents.length; i++)\n                    args.linkEvents[i].unbind();\n\n                args.linkEvents = [];\n            };\n\n\n            switch (args.type) {\n                case 'string':\n                    if (args.enum) {\n                        field = new SelectField({\n                            options: args.enum\n                        });\n                    } else {\n                        field = new TextField();\n                    }\n\n                    field.value = args.value || '';\n                    field.flexGrow = 1;\n\n                    if (args.placeholder)\n                        field.placeholder = args.placeholder;\n\n                    linkField();\n\n                    panel.append(field);\n                    break;\n\n                case 'tags':\n                    // TODO: why isn't this in a seperate class/file???\n\n                    var innerPanel = new Panel();\n                    var tagType = args.tagType || 'string';\n\n                    if (args.enum) {\n                        field = new SelectField({\n                            options: args.enum,\n                            type: tagType\n                        });\n                        field.renderChanges = false;\n                        field.on('change', function (value: string) {\n                            if (tagType === 'string') {\n                                if (!value) return;\n\n                                value = value.trim();\n                            }\n\n                            addTag(value);\n                            field.value = '';\n                        });\n\n                        innerPanel.append(field);\n\n                    } else {\n                        field = new TextField();\n                        field.blurOnEnter = false;\n                        field.renderChanges = false;\n\n                        field.element.addEventListener('keydown', function (evt: KeyboardEvent) {\n                            if (evt.keyCode !== 13 || !field.value)\n                                return;\n\n                            addTag(field.value.trim());\n                            field.value = '';\n                        });\n\n                        innerPanel.append(field);\n\n                        var btnAdd = new Button('&#57632');\n                        btnAdd.flexGrow = '0';\n                        btnAdd.on('click', function () {\n                            if (!field.value)\n                                return;\n\n                            addTag(field.value.trim());\n                            field.value = '';\n                        });\n                        innerPanel.append(btnAdd);\n                    }\n\n\n                    var tagsPanel = new Panel();\n                    tagsPanel.class!.add('tags');\n                    tagsPanel.flex = true;\n                    innerPanel.append(tagsPanel);\n\n                    var tagItems: { [key: string]: HTMLElement } = {};\n                    var tagIndex: { [key: string]: number } = {};\n                    var tagList: any = [];\n\n\n                    var removeTag = function (tag: string) {\n                        if (tagType === 'string' && !tag) {\n                            return;\n                        } else if (tag === null || tag === undefined) {\n                            return;\n                        }\n\n                        if (!tagIndex.hasOwnProperty(tag))\n                            return;\n\n                        var records: any = [];\n\n                        for (var i = 0; i < args.link.length; i++) {\n                            var path = pathAt(args, i);\n                            if (args.link[i].get(path).indexOf(tag) === -1)\n                                continue;\n\n                            records.push({\n                                get: args.link[i].history !== undefined ? args.link[i].history._getItemFn : null,\n                                item: args.link[i],\n                                path: path,\n                                value: tag\n                            });\n\n                            historyState(args.link[i], false);\n                            args.link[i].removeValue(path, tag);\n                            historyState(args.link[i], true);\n                        }\n\n                        if (!args.stopHistory) {\n                            editor.call('history:add', {\n                                name: pathAt(args, 0),\n                                undo: function () {\n                                    for (var i = 0; i < records.length; i++) {\n                                        var item;\n                                        if (records[i].get) {\n                                            item = records[i].get();\n                                            if (!item)\n                                                continue;\n                                        } else {\n                                            item = records[i].item;\n                                        }\n\n                                        historyState(item, false);\n                                        item.insert(records[i].path, records[i].value);\n                                        historyState(item, true);\n                                    }\n                                },\n                                redo: function () {\n                                    for (var i = 0; i < records.length; i++) {\n                                        var item;\n                                        if (records[i].get) {\n                                            item = records[i].get();\n                                            if (!item)\n                                                continue;\n                                        } else {\n                                            item = records[i].item;\n                                        }\n\n                                        historyState(item, false);\n                                        item.removeValue(records[i].path, records[i].value);\n                                        historyState(item, true);\n                                    }\n                                }\n                            });\n                        }\n                    };\n\n                    var addTag = function (tag: string) {\n                        var records: any = [];\n                        let tagNumber: number = 0;\n\n                        // convert to number if needed\n                        if (args.tagType === 'number') {\n                            tagNumber = parseInt(tag, 10);\n                            if (isNaN(tagNumber))\n                                return;\n                        }\n\n                        for (var i = 0; i < args.link.length; i++) {\n                            var path = pathAt(args, i);\n                            if (args.link[i].get(path).indexOf(tagNumber) !== -1)\n                                continue;\n\n                            records.push({\n                                get: args.link[i].history !== undefined ? args.link[i].history._getItemFn : null,\n                                item: args.link[i],\n                                path: path,\n                                value: tagNumber\n                            });\n\n                            historyState(args.link[i], false);\n                            args.link[i].insert(path, tagNumber);\n                            historyState(args.link[i], true);\n                        }\n\n                        if (!args.stopHistory) {\n                            editor.call('history:add', {\n                                name: pathAt(args, 0),\n                                undo: function () {\n                                    for (var i = 0; i < records.length; i++) {\n                                        var item;\n                                        if (records[i].get) {\n                                            item = records[i].get();\n                                            if (!item)\n                                                continue;\n                                        } else {\n                                            item = records[i].item;\n                                        }\n\n                                        historyState(item, false);\n                                        item.removeValue(records[i].path, records[i].value);\n                                        historyState(item, true);\n                                    }\n                                },\n                                redo: function () {\n                                    for (var i = 0; i < records.length; i++) {\n                                        var item;\n                                        if (records[i].get) {\n                                            item = records[i].get();\n                                            if (!item)\n                                                continue;\n                                        } else {\n                                            item = records[i].item;\n                                        }\n\n                                        historyState(item, false);\n                                        item.insert(records[i].path, records[i].value);\n                                        historyState(item, true);\n                                    }\n                                }\n                            });\n                        }\n                    };\n\n                    var onInsert = function (tag: string) {\n                        if (!tagIndex.hasOwnProperty(tag)) {\n                            tagIndex[tag] = 0;\n                            tagList.push(tag);\n                        }\n\n                        tagIndex[tag]++;\n                        insertElement(tag);\n                    };\n\n                    var onRemove = function (tag: string) {\n                        if (!tagIndex[tag])\n                            return;\n\n                        tagIndex[tag]--;\n\n                        if (!tagIndex[tag]) {\n                            tagsPanel.innerElement!.removeChild(tagItems[tag]);\n                            var ind = tagList.indexOf(tag);\n                            if (ind !== -1)\n                                tagList.splice(ind, 1);\n\n                            delete tagItems[tag];\n                            delete tagIndex[tag];\n                        } else {\n                            if (tagIndex[tag] === args.link.length) {\n                                tagItems[tag].classList.remove('partial');\n                            } else {\n                                tagItems[tag].classList.add('partial');\n                            }\n                        }\n                    };\n\n                    // when tag field is initialized\n                    var onSet = function (values: string[]) {\n                        for (var i = 0; i < values.length; i++) {\n                            var value = values[i];\n                            onInsert(value);\n                        }\n                    };\n\n                    var insertElement = function (tag: string) {\n                        if (!tagItems[tag]) {\n                            sortTags();\n\n                            var item = document.createElement('div');\n                            tagItems[tag] = item;\n                            item.classList.add('tag');\n                            var itemText = document.createElement('span');\n                            itemText.textContent = args.tagToString ? args.tagToString(tag) : tag;\n                            item.appendChild(itemText);\n\n                            // the original tag value before tagToString is called. Useful\n                            // if the tag value is an id for example\n                            // item.originalValue = tag;\n\n                            // attach click handler on text part of the tag - bind the listener\n                            // to the tag item so that `this` refers to that tag in the listener\n                            if (args.onClickTag) {\n                                itemText.addEventListener('click', args.onClickTag.bind(item));\n                            }\n\n                            var icon = document.createElement('span');\n                            icon.innerHTML = '&#57650;';\n                            icon.classList.add('icon');\n                            // icon.tag = tag;\n                            icon.addEventListener('click', function () {\n                                if (innerPanel.disabled)\n                                    return;\n\n                                // removeTag(icon.tag);\n                            }, false);\n                            item.appendChild(icon);\n\n                            var ind = tagList.indexOf(tag);\n                            if (tagItems[tagList[ind + 1]]) {\n                                tagsPanel.appendBefore(item, tagItems[tagList[ind + 1]]);\n                            } else {\n                                tagsPanel.append(item);\n                            }\n                        }\n\n                        if (tagIndex[tag] === args.link.length) {\n                            tagItems[tag].classList.remove('partial');\n                        } else {\n                            tagItems[tag].classList.add('partial');\n                        }\n                    };\n\n                    var sortTags = function () {\n                        tagList.sort(function (a: string, b: string) {\n                            if (args.tagToString) {\n                                a = args.tagToString(a);\n                                b = args.tagToString(b);\n                            }\n\n                            if (a > b) {\n                                return 1;\n                            } else if (a < b) {\n                                return -1;\n                            } else {\n                                return 0;\n                            }\n                        });\n                    };\n\n                    if (args.placeholder)\n                        field.placeholder = args.placeholder;\n\n                    // list\n                    args.linkEvents = [];\n\n                    args.linkField = function () {\n                        if (args.link) {\n                            if (!(args.link instanceof Array))\n                                args.link = [args.link];\n\n                            for (var i = 0; i < args.link.length; i++) {\n                                var path = pathAt(args, i);\n                                var tags = args.link[i].get(path);\n\n                                args.linkEvents.push(args.link[i].on(path + ':set', onSet));\n                                args.linkEvents.push(args.link[i].on(path + ':insert', onInsert));\n                                args.linkEvents.push(args.link[i].on(path + ':remove', onRemove));\n\n                                if (!tags)\n                                    continue;\n\n                                for (var t = 0; t < tags.length; t++) {\n                                    if (tagType === 'string' && !tags[t]) {\n                                        continue;\n                                    } else if (tags[t] === null || tags[t] === undefined) {\n                                        continue;\n                                    }\n\n                                    if (!tagIndex.hasOwnProperty(tags[t])) {\n                                        tagIndex[tags[t]] = 0;\n                                        tagList.push(tags[t]);\n                                    }\n\n                                    tagIndex[tags[t]]++;\n                                }\n                            }\n                        }\n\n                        sortTags();\n\n                        for (var i = 0; i < tagList.length; i++)\n                            insertElement(tagList[i]);\n                    };\n\n                    args.unlinkField = function () {\n                        for (var i = 0; i < args.linkEvents.length; i++)\n                            args.linkEvents[i].unbind();\n\n                        args.linkEvents = [];\n\n                        for (var key in tagItems)\n                            tagsPanel.innerElement!.removeChild(tagItems[key]);\n\n                        tagList = [];\n                        tagIndex = {};\n                        tagItems = {};\n                    };\n\n                    args.linkField();\n\n                    panel.once('destroy', args.unlinkField);\n\n                    panel.append(innerPanel);\n                    break;\n\n                case 'text':\n                    field = new TextAreaField();\n\n                    field.value = args.value || '';\n                    field.flexGrow = 1;\n\n                    if (args.placeholder)\n                        field.placeholder = args.placeholder;\n\n                    linkField();\n\n                    panel.append(field);\n                    break;\n\n                case 'number':\n                    if (args.enum) {\n                        field = new SelectField({\n                            options: args.enum,\n                            type: 'number'\n                        });\n                    } else if (args.slider) {\n                        field = new Slider();\n                    } else {\n                        field = new NumberField();\n                    }\n\n                    field.value = args.value || 0;\n                    field.flexGrow = 1;\n\n                    if (args.allowNull) {\n                        field.allowNull = true;\n                    }\n\n                    if (args.placeholder)\n                        field.placeholder = args.placeholder;\n\n                    if (args.precision != null)\n                        field.precision = args.precision;\n\n                    if (args.step != null)\n                        field.step = args.step;\n\n                    if (args.min != null)\n                        field.min = args.min;\n\n                    if (args.max != null)\n                        field.max = args.max;\n\n                    linkField();\n\n                    panel.append(field);\n                    break;\n\n                case 'checkbox':\n                    // 多项选择\n                    if (args.enum) {\n                        field = new SelectField({\n                            options: args.enum,\n                            type: 'boolean'\n                        });\n                        field.flexGrow = 1;\n                    } else {\n                        field = new Checkbox();\n                    }\n\n                    field.value = args.value || 0;\n                    field.class.add('tick');\n\n                    linkField();\n\n                    panel.append(field);\n                    break;\n\n                case 'vec2':\n                case 'vec3':\n                case 'vec4':\n                    // 长度是2、是3还是4\n                    var channels = parseInt(args.type[3], 10);\n                    field = [];\n\n                    for (var i = 0; i < channels; i++) {\n                        field[i] = new NumberField();\n                        field[i].flexGrow = 1;\n                        field[i].style.width = '24px';\n                        field[i].value = (args.value && args.value[i]) || 0;\n                        panel.append(field[i]);\n\n                        if (args.placeholder)\n                            field[i].placeholder = args.placeholder[i];\n\n                        if (args.precision != null)\n                            field[i].precision = args.precision;\n\n                        if (args.step != null)\n                            field[i].step = args.step;\n\n                        if (args.min != null)\n                            field[i].min = args.min;\n\n                        if (args.max != null)\n                            field[i].max = args.max;\n\n                        // if (args.link)\n                        //     field[i].link(args.link, args.path + '.' + i);\n                    }\n\n                    linkField();\n                    break;\n                case 'rgb':\n                    field = new ColorField();\n\n                    if (args.channels != null)\n                        field.channels = args.channels;\n\n                    linkField();\n\n                    // console.log(field.channels);\n                    // console.log(field.value);\n\n                    var colorPickerOn = false;\n                    field.on('click', function () {\n                        colorPickerOn = true;\n                        var first = true;\n\n                        // set picker color\n                        editor.call('picker:color', field.value);\n\n                        // picking starts\n                        var evtColorPickStart = editor.on('picker:color:start', function () {\n                            first = true;\n                        });\n\n                        // picked color\n                        var evtColorPick = editor.on('picker:color', function (color: number[]) {\n                            first = false;\n                            field.value = color;\n                            // console.log(color);\n                        });\n\n                        // position picker\n                        var rectPicker = editor.call('picker:color:rect');\n                        var rectField = field.element.getBoundingClientRect();\n                        editor.call('picker:color:position', rectField.left - rectPicker.width, rectField.top);\n\n                        // color changed, update picker\n                        var evtColorToPicker = field.on('change', function () {\n                            editor.call('picker:color:set', field.value);\n                        });\n\n                        // picker closed\n                        editor.once('picker:color:close', function () {\n                            evtColorPick.unbind();\n                            evtColorPickStart.unbind();\n                            evtColorToPicker.unbind();\n                            colorPickerOn = false;\n                            field.element.focus();\n                        });\n                    });\n\n                    // close picker if field destroyed\n                    field.on('destroy', function () {\n                        if (colorPickerOn)\n                            editor.call('picker:color:close');\n                    });\n\n                    panel.append(field);\n                    break;\n\n                case 'asset':\n                    // field = new ImageField(args.kind === 'material' || args.kind === 'model' || args.kind === 'cubemap' || args.kind === 'font' || args.kind === 'sprite'\n                    // );\n                    field = new ImageField();\n                    var evtPick: any;\n\n                    if (label !== null) {\n                        label.renderChanges = false;\n                        field._label = label;\n\n                        label.style!.width = '32px';\n                        label.flexGrow = '1';\n                    }\n\n\n                    var panelFields = document.createElement('div');\n                    panelFields.classList.add('top');\n\n                    var panelControls = document.createElement('div');\n                    panelControls.classList.add('controls');\n\n                    var fieldTitle = field._title = new Label();\n                    fieldTitle.text = 'Empty';\n                    fieldTitle.parent = panel;\n                    fieldTitle.flexGrow = '1';\n                    fieldTitle.placeholder = '...';\n\n                    var btnEdit = new Button('&#57648;');\n                    btnEdit.disabled = true;\n                    btnEdit.parent = panel;\n                    btnEdit.flexGrow = '0';\n\n                    var btnRemove = new Button('&#57650;');\n                    btnRemove.disabled = true;\n                    btnRemove.parent = panel;\n                    btnRemove.flexGrow = '0';\n\n                    fieldTitle.on('click', function () {\n                        // console.log(field.value);\n                        var asset = editor.call('assets:get', field.value);\n                        // console.log(asset);\n                        editor.call('picker:asset', {\n                            type: args.kind,\n                            currentAsset: asset\n                        });\n\n                        evtPick = editor.once('picker:asset', function (asset: Observer) {\n                            var oldValues: { [key: string]: Observer } = {};\n                            if (args.onSet && args.link && args.link instanceof Array) {\n                                for (var i = 0; i < args.link.length; i++) {\n                                    var id = 0;\n                                    if (args.link[i]._type === 'asset') {\n                                        id = args.link[i].get('id');\n                                    } else if (args.link[i]._type === 'entity') {\n                                        id = args.link[i].get('resource_id');\n                                    } else {\n                                        continue;\n                                    }\n\n                                    oldValues[id] = args.link[i].get(pathAt(args, i));\n                                }\n                            }\n\n                            field.emit('beforechange', asset.get('id'));\n                            field.value = asset.get('id');\n                            evtPick = null;\n                            if (args.onSet) args.onSet(asset, oldValues);\n                        });\n\n                        editor.once('picker:asset:close', function () {\n                            if (evtPick) {\n                                evtPick.unbind();\n                                evtPick = null;\n                            }\n                            field.element.focus();\n                        });\n                    });\n\n                    // TODO: 改\n                    field.on('click', function () {\n                        // fieldTitle.emit('click');\n                        // console.warn('click');\n                        // console.warn(field.value);\n\n                        if (!field.value)\n                            return;\n\n                        var asset = editor.call('assets:get', field.value);\n                        if (!asset) return;\n                        editor.call('selector:set', 'asset', [asset]);\n\n                        var path = asset.get('path');\n                        if (path.length) {\n                            editor.call('assets:panel:currentFolder', editor.call('assets:get', path[path.length - 1]));\n                        } else {\n                            editor.call('assets:panel:currentFolder', null);\n                        }\n                    });\n                    btnEdit.on('click', function () {\n                        field.emit('click');\n                        // console.warn('click');\n                        // console.warn(field.value);\n\n                        // if (!field.value)\n                        //     return;\n\n                        // var asset = editor.call('assets:get', field.value);\n                        // if (!asset) return;\n                        // editor.call('selector:set', 'asset', [asset]);\n\n                        // var path = asset.get('path');\n                        // if (path.length) {\n                        //     editor.call('assets:panel:currentFolder', editor.call('assets:get', path[path.length - 1]));\n                        // } else {\n                        //     editor.call('assets:panel:currentFolder', null);\n                        // }\n                    });\n\n                    btnRemove.on('click', function () {\n                        field.emit('beforechange', null);\n                        field.value = null;\n                    });\n\n                    var watch: any = null;\n                    var watchAsset: any = null;\n                    var renderQueued: any;\n                    var queueRender: any;\n\n                    var evtThumbnailChange: any;\n                    var updateThumbnail = function (empty?: any) {\n                        var asset = editor.call('assets:get', field.value);\n\n                        if (watch) {\n                            editor.call('assets:' + watchAsset.get('type') + ':unwatch', watchAsset, watch);\n                            watchAsset = watch = null;\n                        }\n\n                        if (empty) {\n                            field.image = '';\n                        } else if (!asset) {\n                            field.image = '/editor/static/asset-placeholder-texture.png';\n                        } else {\n                            // console.log(asset);\n                            getThumbnailUrl(Config.projectID, asset.get('id'), asset.get('name'), asset.get('file.hash')).then(response => {\n                                field.image = response;\n                            });\n\n                            // if (asset.has('thumbnails.m')) {\n                            //     var src = asset.get('thumbnails.m');\n                            //     if (src.startsWith('data:image/png;base64')) {\n                            //         field.image = asset.get('thumbnails.m');\n                            //     } else {\n                            //         field.image = asset.get('thumbnails.m').appendQuery('t=' + asset.get('file.hash'));\n                            //     }\n                            // } else {\n                            //     field.image = '/editor/static/asset-placeholder-' + asset.get('type') + '.png';\n                            // }\n\n                            if (args.kind === 'material' || args.kind === 'model' || args.kind === 'cubemap' || args.kind == 'font' || args.kind === 'sprite') {\n                                watchAsset = asset;\n                                watch = editor.call('assets:' + args.kind + ':watch', {\n                                    asset: watchAsset,\n                                    autoLoad: true,\n                                    callback: queueRender\n                                });\n                            }\n                        }\n\n                        if (queueRender)\n                            queueRender();\n                    };\n\n                    if (args.kind === 'material' || args.kind === 'model' || args.kind === 'font' || args.kind === 'sprite') {\n                        if (args.kind !== 'sprite') {\n                            field.elementImage.classList.add('flipY');\n                        }\n\n                        var renderPreview = function () {\n                            renderQueued = false;\n\n                            if (watchAsset) {\n                                // render\n                                editor.call('preview:render', watchAsset, 128, 128, field.elementImage);\n                            } else {\n                                var ctx = field.elementImage.ctx;\n                                if (!ctx)\n                                    ctx = field.elementImage.ctx = field.elementImage.getContext('2d');\n\n                                ctx.clearRect(0, 0, field.elementImage.width, field.elementImage.height);\n                            }\n                        };\n\n                        renderPreview();\n\n                        queueRender = function () {\n                            if (renderQueued) return;\n                            renderQueued = true;\n                            requestAnimationFrame(renderPreview);\n                        };\n\n                        var evtSceneSettings: any = editor.on('preview:scene:changed', queueRender);\n\n                        field.once('destroy', function () {\n                            evtSceneSettings.unbind();\n                            evtSceneSettings = null;\n\n                            if (watch) {\n                                editor.call('assets:' + watchAsset.get('type') + ':unwatch', watchAsset, watch);\n                                watchAsset = watch = null;\n                            }\n                        });\n                    } else if (args.kind === 'cubemap') {\n                        field.elementImage.width = 60;\n                        field.elementImage.height = 60;\n\n                        var positions = [[30, 22], [0, 22], [15, 7], [15, 37], [15, 22], [45, 22]];\n                        var images: any = [null, null, null, null, null, null];\n\n                        var renderPreview = function () {\n                            renderQueued = false;\n\n                            var ctx = field.elementImage.ctx;\n                            if (!ctx)\n                                ctx = field.elementImage.ctx = field.elementImage.getContext('2d');\n\n                            ctx.clearRect(0, 0, field.elementImage.width, field.elementImage.height);\n\n                            if (watchAsset) {\n                                for (var i = 0; i < 6; i++) {\n                                    var id = watchAsset.get('data.textures.' + i);\n                                    var image: any = null;\n\n                                    if (id) {\n                                        var texture = editor.call('assets:get', id);\n                                        if (texture) {\n                                            var hash = texture.get('file.hash');\n                                            if (images[i] && images[i].hash === hash) {\n                                                image = images[i];\n                                            } else {\n                                                var url = texture.get('thumbnails.s');\n\n                                                if (images[i])\n                                                    images[i].onload = null;\n\n                                                images[i] = null;\n\n                                                if (url) {\n                                                    image = images[i] = new Image();\n                                                    image.hash = hash;\n                                                    image.onload = queueRender;\n                                                    image.src = url.appendQuery('t=' + hash);\n                                                }\n                                            }\n                                        } else if (images[i]) {\n                                            images[i].onload = null;\n                                            images[i] = null;\n                                        }\n                                    } else if (images[i]) {\n                                        images[i].onload = null;\n                                        images[i] = null;\n                                    }\n\n                                    if (image) {\n                                        ctx.drawImage(image, positions[i][0], positions[i][1], 15, 15);\n                                    } else {\n                                        ctx.beginPath();\n                                        ctx.rect(positions[i][0], positions[i][1], 15, 15);\n                                        ctx.fillStyle = '#000';\n                                        ctx.fill();\n                                    }\n                                }\n                            }\n                        };\n\n                        renderPreview();\n\n                        queueRender = function () {\n                            if (renderQueued) return;\n                            renderQueued = true;\n                            requestAnimationFrame(renderPreview);\n                        };\n\n                        field.once('destroy', function () {\n                            if (watch) {\n                                editor.call('assets:cubemap:unwatch', watchAsset, watch);\n                                watchAsset = watch = null;\n                            }\n                        });\n                    }\n\n                    linkField();\n\n                    var updateField = function () {\n                        var value = field.value;\n\n                        fieldTitle.text = field.class.contains('null') ? 'various' : 'Empty';\n\n                        btnEdit.disabled = !value;\n                        btnRemove.disabled = !value && !field.class.contains('null');\n\n                        if (evtThumbnailChange) {\n                            evtThumbnailChange.unbind();\n                            evtThumbnailChange = null;\n                        }\n\n                        if (!value) {\n                            if (field.class.contains('star'))\n                                fieldTitle.text = '* ' + fieldTitle.text;\n\n                            field.empty = true;\n                            updateThumbnail(true);\n\n                            return;\n                        }\n\n                        field.empty = false;\n\n                        var asset = editor.call('assets:get', value);\n\n                        if (!asset)\n                            return updateThumbnail();\n\n                        evtThumbnailChange = asset.on('file.hash.m:set', updateThumbnail);\n                        updateThumbnail();\n\n                        fieldTitle.text = asset.get('name');\n\n                        if (field.class.contains('star'))\n                            fieldTitle.text = '* ' + fieldTitle.text;\n                    };\n                    field.on('change', updateField);\n\n                    if (args.value)\n                        field.value = args.value;\n\n                    updateField();\n\n                    var dropRef = editor.call('drop:target', {\n                        ref: panel.element,\n                        filter: function (type: string, data: any) {\n                            var rectA = self.root.innerElement!.getBoundingClientRect();\n                            var rectB = panel.element.getBoundingClientRect();\n                            return data.id && (args.kind === '*' || type === 'asset.' + args.kind) && parseInt(data.id, 10) !== field.value && !editor.call('assets:get', parseInt(data.id, 10)).get('source') && rectB.top > rectA.top && rectB.bottom < rectA.bottom;\n                        },\n                        drop: function (type: string, data: any) {\n                            if ((args.kind !== '*' && type !== 'asset.' + args.kind) || editor.call('assets:get', parseInt(data.id, 10)).get('source'))\n                                return;\n\n                            var oldValues: any = {};\n                            if (args.onSet && args.link && args.link instanceof Array) {\n                                for (var i = 0; i < args.link.length; i++) {\n                                    var id = 0;\n                                    if (args.link[i]._type === 'asset') {\n                                        id = args.link[i].get('id');\n                                    } else if (args.link[i]._type === 'entity') {\n                                        id = args.link[i].get('resource_id');\n                                    } else {\n                                        continue;\n                                    }\n\n                                    oldValues[id] = args.link[i].get(pathAt(args, i));\n                                }\n                            }\n\n                            field.emit('beforechange', parseInt(data.id, 10));\n                            field.value = parseInt(data.id, 10);\n\n                            if (args.onSet) {\n                                var asset = editor.call('assets:get', parseInt(data.id, 10));\n                                if (asset) args.onSet(asset, oldValues);\n                            }\n                        },\n                        over: function (type: string, data: any) {\n                            if (args.over)\n                                args.over(type, data);\n                        },\n                        leave: function () {\n                            if (args.leave)\n                                args.leave();\n                        }\n                    });\n                    field.on('destroy', function () {\n                        dropRef.unregister();\n                        if (evtThumbnailChange) {\n                            evtThumbnailChange.unbind();\n                            evtThumbnailChange = null;\n                        }\n                    });\n\n                    // thumbnail\n                    panel.append(field);\n                    // right side\n                    panel.append(panelFields);\n                    // controls\n                    panelFields.appendChild(panelControls);\n                    // label\n                    if (label) {\n                        panel.innerElement.removeChild(label.element);\n                        panelControls.appendChild(label.element!);\n                    }\n                    panelControls.classList.remove('label-field');\n                    // edit\n                    panelControls.appendChild(btnEdit.element!);\n                    // remove\n                    panelControls.appendChild(btnRemove.element!);\n\n                    // title\n                    panelFields.appendChild(fieldTitle.element!);\n                    break;\n\n                // entity picker\n                case 'entity':\n                    field = new Label();\n                    field.class.add('add-entity');\n                    field.flexGrow = 1;\n                    field.class.add('null');\n\n                    field.text = 'Select Entity';\n                    field.placeholder = '...';\n\n                    panel.append(field);\n\n                    var icon = document.createElement('span');\n                    icon.classList.add('icon');\n\n                    icon.addEventListener('click', function (e) {\n                        e.stopPropagation();\n\n                        // if (editor.call('permissions:write'))\n                        //     field.text = '';\n                    });\n\n                    field.on('change', function (value: string) {\n                        if (value) {\n                            var entity = editor.call('entities:get', value);\n                            if (!entity) {\n                                field.text = null;\n                                return;\n                            }\n\n                            field.element.innerHTML = entity.get('name');\n                            field.element.appendChild(icon);\n                            field.placeholder = '';\n\n                            if (value !== 'various')\n                                field.class.remove('null');\n                        } else {\n                            field.element.innerHTML = 'Select Entity';\n                            field.placeholder = '...';\n                            field.class.add('null');\n                        }\n                    });\n\n                    linkField();\n\n                    var getCurrentEntity = function () {\n                        var entity = null;\n                        if (args.link) {\n                            if (!(args.link instanceof Array)) {\n                                args.link = [args.link];\n                            }\n\n                            // get initial value only if it's the same for all\n                            // links otherwise set it to null\n                            for (var i = 0, len = args.link.length; i < len; i++) {\n                                var val = args.link[i].get(pathAt(args, i));\n                                if (entity !== val) {\n                                    if (entity) {\n                                        entity = null;\n                                        break;\n                                    } else {\n                                        entity = val;\n                                    }\n                                }\n                            }\n                        }\n\n                        return entity;\n                    };\n\n                    field.on('click', function () {\n                        var evtEntityPick: Nullable<EventHandle> = editor.once('picker:entity', function (entity: Observer) {\n                            field.text = entity ? entity.get('resource_id') : null;\n                            evtEntityPick = null;\n                        });\n\n                        var initialValue = getCurrentEntity();\n\n                        editor.call('picker:entity', initialValue, args.filter || null);\n\n                        editor.once('picker:entity:close', function () {\n                            if (evtEntityPick) {\n                                evtEntityPick.unbind();\n                                evtEntityPick = null;\n                            }\n                        });\n                    });\n\n                    // highlight on hover\n                    field.on('hover', function () {\n                        var entity = getCurrentEntity();\n                        if (!entity) return;\n\n                        editor.call('entities:panel:highlight', entity, true);\n\n                        field.once('blur', function () {\n                            editor.call('entities:panel:highlight', entity, false);\n                        });\n\n                        field.once('click', function () {\n                            editor.call('entities:panel:highlight', entity, false);\n                        });\n                    });\n\n                    var dropRef = editor.call('drop:target', {\n                        ref: field.element,\n                        filter: function (type: string, data: any) {\n                            var rectA = self.root.innerElement!.getBoundingClientRect();\n                            var rectB = field.element.getBoundingClientRect();\n                            return type === 'entity' && data.resource_id !== field.value && rectB.top > rectA.top && rectB.bottom < rectA.bottom;\n                        },\n                        drop: function (type: string, data: any) {\n                            if (type !== 'entity')\n                                return;\n\n                            field.value = data.resource_id;\n                        },\n                        over: function (type: string, data: any) {\n                            if (args.over)\n                                args.over(type, data);\n                        },\n                        leave: function () {\n                            if (args.leave)\n                                args.leave();\n                        }\n                    });\n                    field.on('destroy', function () {\n                        dropRef.unregister();\n                    });\n\n                    break;\n\n                case 'image':\n                    panel.flex = false;\n\n                    field = new Image();\n                    field.style.maxWidth = '100%';\n                    field.style.display = 'block';\n                    field.src = args.src;\n\n                    panel.append(field);\n                    break;\n\n                case 'progress':\n                    field = new Progress();\n                    field.flexGrow = 1;\n\n                    panel.append(field);\n                    break;\n\n                case 'button':\n                    field = new Button();\n                    field.flexGrow = 1;\n                    field.text = args.text || 'Button';\n                    panel.append(field);\n                    break;\n\n                case 'element':\n                    field = args.element;\n                    panel.append(field);\n                    break;\n\n                case 'array':\n                    field = editor.call('attributes:addArray', args);\n                    panel.append(field);\n\n                    break;\n\n                default:\n                    field = new Label();\n                    field.flexGrow = '1';\n                    field.text = args.value || '';\n                    field.class.add('selectable');\n\n                    if (args.placeholder)\n                        field.placeholder = args.placeholder;\n\n                    linkField();\n\n                    panel.append(field);\n                    break;\n\n            }\n\n            if (args.className && field instanceof Element) {\n                field.class!.add(args.className);\n            }\n\n            return field;\n        });\n\n\n\n\n        var inspectedItems: any[] = [];\n\n\n        editor.on('attributes:clear', function () {\n            for (let i = 0; i < inspectedItems.length; i++) {\n                inspectedItems[i].unbind();\n            }\n            inspectedItems = [];\n        });\n\n        editor.method('attributes:inspect', function (type: string, item: Observer) {\n            clearPanel();\n\n            // clear if destroyed\n            inspectedItems.push(item.once('destroy', function () {\n                editor.call('attributes:clear');\n            }));\n\n            self.root.headerText = type;\n\n            editor.emit('attributes:inspect[' + type + ']', [item]);\n            editor.emit('attributes:inspect[*]', type, [item]);\n        });\n\n\n        editor.on('selector:change', function (type: string, items: Observer[]) {\n            clearPanel();\n\n            // console.warn('selector:change：type --- ' + type + '* length --- ' + items.length);\n\n            // nothing selected\n            if (items.length === 0) {\n                let label = new Label('请选择物体或资源');\n                label.style!.display = 'block';\n                label.style!.textAlign = 'center';\n                label.style!.width = '100%';\n                // label.style!.height = '22px';\n                self.root.append(label);\n                self.root.headerText = self.title;\n                return;\n            }\n\n            // console.warn('选择类型：' + type);\n            // console.warn(items);\n\n            // clear if destroyed\n            for (let i = 0; i < items.length; i++) {\n                // TODO：当前item为空\n                // console.error(type);\n                // if (type === 'entity') {\n                //     GizmosCenter.attach(items[i].node);\n                // }\n                // console.error(items[i]);\n                inspectedItems.push(items[i].once('destroy', function () {\n                    editor.call('attributes:clear');\n                }));\n            }\n\n            self.root.headerText = type;\n\n            // console.error(type);\n            // console.error(items);\n\n            editor.emit('attributes:inspect[' + type + ']', items);\n            editor.emit('attributes:inspect[*]', type, items);\n        });\n\n        // 初始时，默认没有选中物体\n        editor.emit('selector:change', null, []);\n\n\n\n        // clearing\n        editor.method('attributes:clear', clearPanel);\n\n    }\n\n\n\n\n\n\n\n}\n\n\nexport interface AddPanelArgs {\n    name?: string;\n    parent?: Panel;\n    foldable?: boolean;\n    folded?: boolean;\n}","import { Tooltip, Panel, Element, TopElementContainer, TopElementPanel } from \"../../ui\";\nimport { VeryEngine } from \"../../engine\";\n\n// 属性参考说明Tooltip\nexport class AttributesReference {\n\n  public root: TopElementContainer;\n  public attributesPanel: TopElementPanel;\n\n  public index: { [key: string]: Tooltip } = {};\n  public missing: { [key: string]: boolean } = {};\n\n\n  public constructor() {\n\n    this.root = VeryEngine.root;\n    this.attributesPanel = VeryEngine.attributes;\n\n    this.init();\n  }\n\n\n  private init(): void {\n\n    let self = this;\n\n    // TODO\n    editor.method('attributes:reference:add', function (args: any) {\n      self.index[args.name] = editor.call('attributes:reference', args);\n    });\n\n    editor.method('attributes:reference:attach', function (name: string, target: HTMLElement, element: Element, panel?: Panel) {\n      let tooltip = self.index[name];\n\n      if (!tooltip) {\n        if (!self.missing[name]) {\n          self.missing[name] = true;\n        //   console.log('reference', name, 'is not defined');\n        }\n        return;\n      }\n\n      tooltip.attachReference({\n        target: target,\n        panel: panel,\n        element: element || target.ui\n      });\n\n      return tooltip;\n    });\n\n    editor.method('attributes:reference:template', function (args: any) {\n      let html = '';\n\n      if (args.title)\n        html += '<h1>' + self.sanitize(args.title) + '</h1>';\n      if (args.subTitle)\n        html += '<h2>' + self.sanitize(args.subTitle) + '</h2>';\n      if (args.webgl2)\n        html += '<div class=\"tag\">WebGL 2.0 Only</div>';\n      if (args.description) {\n        let description = self.sanitize(args.description);\n        description = description.replace(/\\n/g, '<br />'); // new lines\n        description = description.replace(/&lt;b&gt;/g, '<b>').replace(/&lt;\\/b&gt;/g, '</b>'); // bold\n        html += '<p>' + description + '</p>';\n      }\n      if (args.code)\n        html += '<pre class=\"ui-code\">' + self.sanitize(args.code) + '</pre>';\n      if (args.url)\n        html += '<a class=\"reference\" href=\"' + self.sanitize(args.url) + '\" target=\"_blank\">API Reference</a>';\n\n      return html;\n    });\n\n\n    editor.method('attributes:reference', function (args: any) {\n      let tooltip = new Tooltip({\n        align: 'right'\n      });\n      tooltip.hoverable = true;\n      tooltip.class!.add('reference');\n\n      tooltip.html = editor.call('attributes:reference:template', args);\n\n      // let links = {};\n      let timerHover: any = null;\n      let timerBlur: any = null;\n\n      // 重写该方法\n      tooltip.attachReference = function (args: any) {\n        let target = args.target;\n        let element = args.element;\n        let targetPanel = args.panel || self.attributesPanel;\n\n        let show = function () {\n          if (!target || target.hidden) return;\n          tooltip.position(targetPanel.element.getBoundingClientRect().left, element.getBoundingClientRect().top + 16);\n          tooltip.hidden = false;\n        };\n\n        let evtHide = function () {\n          if (timerHover !== null) clearTimeout(timerHover);\n          if (timerBlur !== null) clearTimeout(timerBlur);\n          tooltip.hidden = true;\n        };\n\n        let evtHover = function () {\n          if (timerBlur !== null) clearTimeout(timerBlur);\n          timerHover = setTimeout(show, 500);\n        };\n\n        let evtBlur = function () {\n          if (timerHover !== null) clearTimeout(timerHover);\n          timerBlur = setTimeout(hide, 200);\n        };\n\n        let evtClick = function () {\n          if (timerHover !== null) clearTimeout(timerHover);\n          if (timerBlur !== null) clearTimeout(timerBlur);\n          show();\n        };\n\n        target.on('hide', evtHide);\n\n        target.once('destroy', function () {\n          element.removeEventListener('mouseover', evtHover);\n          element.removeEventListener('mouseout', evtBlur);\n          element.removeEventListener('click', evtClick);\n          target.unbind('hide', evtHide);\n          target = null;\n          element = null;\n          if (timerHover !== null) clearTimeout(timerHover);\n          if (timerBlur !== null) clearTimeout(timerBlur);\n          tooltip.hidden = true;\n        });\n\n        element.addEventListener('mouseover', evtHover, false);\n        element.addEventListener('mouseout', evtBlur, false);\n        element.addEventListener('click', evtClick, false);\n      };\n\n      let hide = function () {\n        tooltip.hidden = true;\n      };\n\n      tooltip.on('hover', function () {\n        clearTimeout(timerBlur);\n      });\n\n      self.root.append(tooltip);\n\n      return tooltip;\n    });\n  }\n\n\n  private sanitize(str: string) {\n    return str.replace(/</g, '&lt;').replace(/>/g, '&gt;');\n  };\n\n\n}","import { Label } from \"../../../ui\";\nimport { Observer } from \"../../../lib\";\n\nexport class AttributeComponentCamera {\n\n    public constructor() {\n        editor.on('attributes:inspect[entity]', function (entities: Observer[]) {\n            if (entities.length !== 1 || entities[0].get('type') !== 'camera')\n                return;\n\n            // console.log('attributes:inspect[entity] camera');\n\n            var panelComponents = editor.call('attributes:entity.panelComponents');\n            if (!panelComponents)\n                return;\n\n            var projectSettings = editor.call('settings:project');\n\n            var panel = editor.call('attributes:entity:addComponentPanel', {\n                title: '摄像机属性',\n                name: 'camera',\n                entities: entities\n            });\n\n\n            // clearColorBuffer\n            // var fieldClearColorBuffer = editor.call('attributes:addField', {\n            //     parent: panel,\n            //     type: 'checkbox',\n            //     name: 'Clear Buffers',\n            //     link: entities,\n            //     path: 'components.camera.clearColorBuffer'\n            // });\n            // // label\n            // var label = new Label('Color');\n            // label.class!.add('label-infield');\n            // label.style!.paddingRight = '12px';\n            // fieldClearColorBuffer.parent.append(label);\n            // reference\n            // editor.call('attributes:reference:attach', 'camera:clearColorBuffer', label);\n\n            // camera.clearColor\n            var fieldClearColor = editor.call('attributes:addField', {\n                parent: panel,\n                name: '背景色',\n                type: 'rgb',\n                link: entities,\n                path: 'clearColor'\n            });\n            // fieldClearColor.parent.hidden = !(fieldClearColorBuffer.value || fieldClearColorBuffer.class.contains('null'));\n            // fieldClearColorBuffer.on('change', function (value: any) {\n            //     fieldClearColor.parent.hidden = !(value || fieldClearColorBuffer.class!.contains('null'));\n            // });\n            // reference\n            // editor.call('attributes:reference:attach', 'camera:clearColor', fieldClearColor.parent.innerElement.firstChild.ui);\n\n            // camera.projection\n            var fieldProjection = editor.call('attributes:addField', {\n                parent: panel,\n                name: '相机类型',\n                type: 'number',\n                enum: [\n                    { v: 0, t: '透视相机' }, // pc.PROJECTION_PERSPECTIVE\n                    { v: 1, t: '正交相机' } // pc.PROJECTION_ORTHOGRAPHIC\n                ],\n                link: entities,\n                path: 'mode'\n            });\n            // reference\n            // editor.call('attributes:reference:attach', 'camera:projection', fieldProjection.parent.innerElement.firstChild.ui);\n\n            // camera.fov\n            var fieldFov = editor.call('attributes:addField', {\n                parent: panel,\n                name: '视野角度',\n                // placeholder: '\\u00B0',\n                placeholder: '弧度',\n                type: 'number',\n                precision: 2,\n                step: 1,\n                min: 0,\n                link: entities,\n                path: 'fov'\n            });\n            fieldFov.style.width = '32px';\n            fieldFov.parent.hidden = fieldProjection.value !== 0 && fieldProjection.value !== '';\n            fieldProjection.on('change', function (value: any) {\n                fieldFov.parent.hidden = value !== 0 && value !== '';\n            });\n            // reference\n            // editor.call('attributes:reference:attach', 'camera:fov', fieldFov.parent.innerElement.firstChild.ui);\n\n            // fov slider\n            var fieldFovSlider = editor.call('attributes:addField', {\n                panel: fieldFov.parent,\n                precision: 2,\n                step: 1,\n                min: 0,\n                max: Math.PI / 2,\n                type: 'number',\n                slider: true,\n                link: entities,\n                path: 'fov'\n            });\n            fieldFovSlider.flexGrow = 4;\n\n            // camera.orthoHeight\n            var fieldOrthoHeight = editor.call('attributes:addField', {\n                parent: panel,\n                name: '视野宽度',\n                type: 'number',\n                link: entities,\n                path: 'orthoSize'\n            });\n            fieldOrthoHeight.parent.hidden = fieldProjection.value !== 1 && fieldProjection.value !== '';\n            fieldProjection.on('change', function (value: any) {\n                fieldOrthoHeight.parent.hidden = value !== 1 && value !== '';\n            });\n            // reference\n            // editor.call('attributes:reference:attach', 'camera:orthoHeight', fieldOrthoHeight.parent.innerElement.firstChild.ui);\n\n            // nearClip\n            var fieldNearClip = editor.call('attributes:addField', {\n                parent: panel,\n                name: '近平面',\n                // placeholder: 'Near',\n                type: 'number',\n                precision: 2,\n                step: .1,\n                min: -100000,\n                link: entities,\n                path: 'minZ'\n            });\n            fieldNearClip.style.width = '32px';\n            // reference\n            // editor.call('attributes:reference:attach', 'camera:clip', fieldNearClip.parent.innerElement.firstChild.ui);\n\n\n            // farClip\n            var fieldFarClip = editor.call('attributes:addField', {\n                parent: panel,\n                name: '远平面',\n                // placeholder: '远平面',\n                type: 'number',\n                precision: 2,\n                step: .1,\n                min: 0,\n                link: entities,\n                path: 'maxZ'\n            });\n            fieldFarClip.style.width = '32px';\n\n            // camera.rect\n            var fieldRect = editor.call('attributes:addField', {\n                parent: panel,\n                name: 'Viewport',\n                placeholder: ['X', 'Y', 'W', 'H'],\n                type: 'vec4',\n                precision: 3,\n                step: 0.01,\n                min: 0,\n                max: 1,\n                link: entities,\n                path: 'viewport'\n            });\n            // reference\n            // editor.call('attributes:reference:attach', 'camera:rect', fieldRect[0].parent.innerElement.firstChild.ui);\n\n            var fieldGravity = editor.call('attributes:addField', {\n                parent: panel,\n                name: '启用重力',\n                type: 'checkbox',\n                link: entities,\n                path: 'applyGravity'\n            });\n\n        });\n    }\n\n\n}","import { Observer } from \"../../../lib\";\r\n\r\nexport class AttributeComponentGUI {\r\n\r\n    public constructor() {\r\n\r\n        editor.method('item:drag:allow', (drag: Nullable<Observer>, target: Nullable<Observer>, drag_mode: string) => {\r\n            if (!drag || !target) return true;\r\n            let dragType = drag.get('type');\r\n            let targetType = target.get('type');\r\n            if (dragType === '2d-gui') {\r\n                let dragSubtype = drag.get('subtype');\r\n                if (dragSubtype === 'root') {\r\n                    if (targetType === 'root' && drag_mode === 'inside') {\r\n                        return true;\r\n                    } else if (drag_mode !== 'inside') {\r\n                        if (editor.call('entities:root').get('resource_id') === target.get('parent')) {\r\n                            return true;\r\n                        } else {\r\n                            return false;\r\n                        }\r\n                    } else {\r\n                        return false;\r\n                    }\r\n                } else {\r\n                    if (targetType === '2d-gui') {\r\n                        let targetSubtype = target.get('subtype');\r\n                        if (drag_mode === 'inside') {\r\n                            if (targetSubtype === 'root' || targetSubtype === 'panel') {\r\n                                return true;\r\n                            } else {\r\n                                return false;\r\n                            }\r\n                        } else {\r\n                            if (targetSubtype === 'root') {\r\n                                return false;\r\n                            } else {\r\n                                return true;\r\n                            }\r\n                        }\r\n                    } else {\r\n                        return false;\r\n                    }\r\n                }\r\n            } else {\r\n                if (targetType === '2d-gui') {\r\n                    let targetSubtype = target.get('subtype');\r\n                    if (targetSubtype === 'root') {\r\n                        if (drag_mode === 'inside') {\r\n                            return false;\r\n                        } else {\r\n                            return true;\r\n                        }\r\n                    } else {\r\n                        return false;\r\n                    }\r\n                } else {\r\n                    return true;\r\n                }\r\n            }\r\n            return true;\r\n        });\r\n\r\n        /*\r\n        var handleTextureHover = function (path: string) {\r\n            var valueOld = null;\r\n            var events = [];\r\n\r\n            return {\r\n                over: function (type: string, data) {\r\n                    var i;\r\n\r\n                    if (previewTexturesHover !== null)\r\n                        previewTexturesHover[path] = parseInt(data.id, 10);\r\n\r\n                    var texture = app.assets.get(parseInt(data.id, 10));\r\n                    app.assets.load(texture);\r\n\r\n                    var attachTexture = function (ind) {\r\n                        var engineAsset = app.assets.get(parseInt(assets[ind].get('id'), 10));\r\n                        app.assets.load(engineAsset);\r\n\r\n                        if (engineAsset && engineAsset.resource) {\r\n                            valueOld[ind] = engineAsset.resource[path];\r\n\r\n                            if (texture.resource) {\r\n                                engineAsset.resource[path] = texture.resource;\r\n                                engineAsset.resource.update();\r\n                            } else {\r\n                                var evt = {\r\n                                    asset: texture,\r\n                                    fn: function () {\r\n                                        engineAsset.resource[path] = texture.resource;\r\n                                        engineAsset.resource.update();\r\n                                    }\r\n                                };\r\n                                events.push(evt);\r\n                                texture.once('load', evt.fn);\r\n                            }\r\n                        }\r\n                    };\r\n\r\n                    valueOld = [];\r\n                    for (i = 0; i < assets.length; i++)\r\n                        attachTexture(i);\r\n\r\n                    editor.call('viewport:render');\r\n\r\n                    if (queueRender)\r\n                        queueRender();\r\n                },\r\n                leave: function () {\r\n                    var i;\r\n                    if (previewTexturesHover !== null)\r\n                        previewTexturesHover = {};\r\n\r\n                    if (queueRender)\r\n                        queueRender();\r\n\r\n                    if (valueOld === null) return;\r\n\r\n                    for (i = 0; i < events.length; i++)\r\n                        events[i].asset.off('load', events[i].fn);\r\n                    events = [];\r\n\r\n                    for (i = 0; i < assets.length; i++) {\r\n                        var engineAsset = app.assets.get(parseInt(assets[i].get('id'), 10));\r\n                        app.assets.load(engineAsset);\r\n\r\n                        if (engineAsset && engineAsset.resource) {\r\n                            engineAsset.resource[path] = valueOld[i];\r\n                            engineAsset.resource.update();\r\n                        }\r\n                    }\r\n                    editor.call('viewport:render');\r\n                    valueOld = null;\r\n                }\r\n            };\r\n        };\r\n        */\r\n\r\n        /*\r\n        var rgxExtension = /\\.[a-z]+$/;\r\n        var bulkSlots: any = {\r\n            'ao': ['a', 'ao', 'ambient', 'ambientocclusion', 'gma', 'gmat', 'gmao', 'gmaa', 'rma', 'rmat', 'rmao', 'rmaa'],\r\n            'diffuse': ['d', 'diff', 'diffuse', 'albedo', 'color', 'rgb', 'rgba'],\r\n            'specular': ['s', 'spec', 'specular'],\r\n            'metalness': ['m', 'met', 'metal', 'metalness', 'gma', 'gmat', 'gmao', 'gmaa', 'rma', 'rmat', 'rmao', 'rmaa'],\r\n            'gloss': ['g', 'gloss', 'glossiness', 'gma', 'gmat', 'gmao', 'gmaa', 'rma', 'rmat', 'rmao', 'rmaa'],\r\n            'emissive': ['e', 'emissive'],\r\n            'opacity': ['o', 't', 'opacity', 'alpha', 'transparency', 'gmat', 'gmao', 'gmaa', 'rgba', 'rmat', 'rmao', 'rmaa'],\r\n            'normal': ['n', 'norm', 'normal', 'normals'],\r\n            'height': ['p', 'h', 'height', 'parallax', 'bump'],\r\n            'light': ['l', 'lm', 'light', 'lightmap']\r\n        };\r\n        var postfixToSlot: any = {};\r\n        for (let key in bulkSlots) {\r\n            for (let i = 0; i < bulkSlots[key].length; i++) {\r\n                postfixToSlot[bulkSlots[key][i]] = postfixToSlot[bulkSlots[key][i]] || [];\r\n                postfixToSlot[bulkSlots[key][i]].push(key);\r\n            }\r\n        }\r\n\r\n        var tokenizeFilename = function (filename: string) {\r\n            filename = filename.trim().toLowerCase();\r\n\r\n            if (!filename)\r\n                return;\r\n\r\n            // drop extension\r\n            var ext = filename.match(rgxExtension);\r\n            if (ext) filename = filename.slice(0, -ext[0].length);\r\n\r\n            if (!filename)\r\n                return;\r\n\r\n            var parts = filename.split(/(\\-|_|\\.)/g);\r\n            var tokens = [];\r\n\r\n            for (var i = 0; i < parts.length; i++) {\r\n                if (parts[i] === '-' || parts[i] === '_' || parts[i] === '.')\r\n                    continue;\r\n\r\n                tokens.push(parts[i]);\r\n            }\r\n\r\n            if (!tokens.length)\r\n                return;\r\n\r\n            if (tokens.length === 1)\r\n                return ['', tokens[0]];\r\n\r\n            var left = tokens.slice(0, -1).join('');\r\n            var right = tokens[tokens.length - 1];\r\n\r\n            return [left, right];\r\n        };\r\n\r\n        var onTextureBulkSet = function (asset: Observer, oldValues: any, slot: string) {\r\n            var tokens = tokenizeFilename(asset.get('name'));\r\n            if (!tokens)\r\n                return;\r\n\r\n            if (bulkSlots[slot].indexOf(tokens[1]) === -1)\r\n                return;\r\n\r\n            var path = asset.get('path');\r\n            var textures = editor.call('assets:find', function (texture: Observer) {\r\n                return texture.get('type') === 'texture' && !texture.get('source') && texture.get('path').equals(path);\r\n            });\r\n\r\n            var candidates: any = {};\r\n            for (var i = 0; i < textures.length; i++) {\r\n                var t = tokenizeFilename(textures[i][1].get('name'));\r\n\r\n                if (!t || t[0] !== tokens[0] || !postfixToSlot[t[1]])\r\n                    continue;\r\n\r\n                for (var s = 0; s < postfixToSlot[t[1]].length; s++) {\r\n                    if (postfixToSlot[t[1]][s] === slot)\r\n                        continue;\r\n\r\n                    candidates[postfixToSlot[t[1]][s]] = {\r\n                        texture: textures[i][1],\r\n                        postfix: t[1]\r\n                    };\r\n                }\r\n            }\r\n\r\n            if (!Object.keys(candidates).length)\r\n                return;\r\n\r\n            var records: any = [];\r\n\r\n            for (var a = 0; a < assets.length; a++) {\r\n                if (oldValues[assets[a].get('id')])\r\n                    continue;\r\n\r\n                var history = assets[a].history.enabled;\r\n                assets[a].history.enabled = false;\r\n\r\n                for (var s in candidates) {\r\n                    var key = 'data.' + s + 'Map';\r\n\r\n                    if (assets[a].get(key))\r\n                        continue;\r\n\r\n                    var panel = texturePanels[s];\r\n                    if (panel) panel.folded = false;\r\n\r\n                    var id = parseInt(candidates[s].texture.get('id'), 10);\r\n                    assets[a].set(key, id);\r\n\r\n                    records.push({\r\n                        id: assets[a].get('id'),\r\n                        key: key,\r\n                        value: id,\r\n                        old: null\r\n                    });\r\n\r\n                    if (s === 'ao') {\r\n                        // ao can be in third color channel\r\n                        if (/^(g|r)ma/.test(candidates[s].postfix)) {\r\n                            var channel = assets[a].get('data.aoMapChannel');\r\n                            if (channel !== 'b') {\r\n                                assets[a].set('data.aoMapChannel', 'b');\r\n\r\n                                records.push({\r\n                                    id: assets[a].get('id'),\r\n                                    key: 'data.aoMapChannel',\r\n                                    value: 'b',\r\n                                    old: channel\r\n                                });\r\n                            }\r\n                        }\r\n                    } else if (s === 'metalness') {\r\n                        // use metalness\r\n                        if (!assets[a].get('data.useMetalness')) {\r\n                            assets[a].set('data.useMetalness', true);\r\n\r\n                            records.push({\r\n                                id: assets[a].get('id'),\r\n                                key: 'data.useMetalness',\r\n                                value: true,\r\n                                old: false\r\n                            });\r\n                        }\r\n\r\n                        // metalness to maximum\r\n                        var metalness = assets[a].get('data.metalness');\r\n                        if (metalness !== 1) {\r\n                            assets[a].set('data.metalness', 1.0);\r\n\r\n                            records.push({\r\n                                id: assets[a].get('id'),\r\n                                key: 'data.metalness',\r\n                                value: 1.0,\r\n                                old: metalness\r\n                            });\r\n                        }\r\n\r\n                        // metalness can be in second color channel\r\n                        if (/^(g|r)ma/.test(candidates[s].postfix)) {\r\n                            var channel = assets[a].get('data.metalnessMapChannel');\r\n                            if (channel !== 'g') {\r\n                                assets[a].set('data.metalnessMapChannel', 'g');\r\n\r\n                                records.push({\r\n                                    id: assets[a].get('id'),\r\n                                    key: 'data.metalnessMapChannel',\r\n                                    value: 'g',\r\n                                    old: channel\r\n                                });\r\n                            }\r\n                        }\r\n                    } else if (s === 'gloss') {\r\n                        // gloss to maximum\r\n                        var shininess = assets[a].get('data.shininess');\r\n                        if (shininess !== 100) {\r\n                            assets[a].set('data.shininess', 100.0);\r\n\r\n                            records.push({\r\n                                id: assets[a].get('id'),\r\n                                key: 'data.shininess',\r\n                                value: 100.0,\r\n                                old: shininess\r\n                            });\r\n                        }\r\n\r\n                        // gloss shall be in first color channel\r\n                        var channel = assets[a].get('data.glossMapChannel');\r\n                        if (channel !== 'r') {\r\n                            assets[a].set('data.glossMapChannel', 'r');\r\n\r\n                            records.push({\r\n                                id: assets[a].get('id'),\r\n                                key: 'data.glossMapChannel',\r\n                                value: 'r',\r\n                                old: channel\r\n                            });\r\n                        }\r\n                    } else if (s === 'opacity') {\r\n                        // opacity can be in fourth color channel\r\n                        if (/^(gma|rma|rgb)(t|o|a)$/.test(candidates[s].postfix)) {\r\n                            var channel = assets[a].get('data.opacityMapChannel');\r\n                            if (channel !== 'a') {\r\n                                assets[a].set('data.opacityMapChannel', 'a');\r\n\r\n                                records.push({\r\n                                    id: assets[a].get('id'),\r\n                                    key: 'data.opacityMapChannel',\r\n                                    value: 'a',\r\n                                    old: channel\r\n                                });\r\n                            }\r\n                        }\r\n                    }\r\n                }\r\n\r\n                assets[a].history.enabled = history;\r\n            }\r\n\r\n            // if (records.length) {\r\n            //     editor.call('history:add', {\r\n            //         name: 'material textures auto-bind',\r\n            //         undo: function () {\r\n            //             for (var i = 0; i < records.length; i++) {\r\n            //                 var asset = editor.call('assets:get', records[i].id);\r\n            //                 if (!asset)\r\n            //                     continue;\r\n\r\n            //                 var history = asset.history.enabled;\r\n            //                 asset.history.enabled = false;\r\n            //                 asset.set(records[i].key, records[i].old);\r\n            //                 asset.history.enabled = history;\r\n            //             }\r\n            //         },\r\n            //         redo: function () {\r\n            //             for (var i = 0; i < records.length; i++) {\r\n            //                 var asset = editor.call('assets:get', records[i].id);\r\n            //                 if (!asset)\r\n            //                     continue;\r\n\r\n            //                 var history = asset.history.enabled;\r\n            //                 asset.history.enabled = false;\r\n            //                 asset.set(records[i].key, records[i].value);\r\n            //                 asset.history.enabled = history;\r\n            //             }\r\n            //         }\r\n            //     });\r\n            // }\r\n        };\r\n        */\r\n\r\n        editor.on('attributes:inspect[entity]', function (entities: Observer[]) {\r\n            if (entities.length !== 1 || entities[0].get('type') !== '2d-gui')\r\n                return;\r\n\r\n            // console.log('attributes:inspect[entity] GUI');\r\n\r\n            var panelComponents = editor.call('attributes:entity.panelComponents');\r\n            if (!panelComponents)\r\n                return;\r\n\r\n            // console.warn(panelComponents);\r\n            if (entities.length === 1) {\r\n                editor.call('attributes:header', 'GUI属性');\r\n            }\r\n\r\n            var projectSettings = editor.call('settings:project');\r\n\r\n            var panel = editor.call('attributes:entity:addComponentPanel', {\r\n                title: '2D界面属性',\r\n                name: '2d-gui',\r\n                entities: entities\r\n            });\r\n\r\n            // 隐藏小标题\r\n            panel.headerElement.style.display = 'none';\r\n\r\n            // isVisible\r\n            var isVisible = editor.call('attributes:addField', {\r\n                parent: panel,\r\n                name: '激活',\r\n                type: 'checkbox',\r\n                link: entities,\r\n                path: 'gui.isVisible'\r\n            });\r\n\r\n            // name\r\n            var name = editor.call('attributes:addField', {\r\n                parent: panel,\r\n                name: '名字',\r\n                type: 'string',\r\n                trim: true,\r\n                link: entities,\r\n                path: 'name'\r\n            });\r\n\r\n            // xType\r\n            var xType = editor.call('attributes:addField', {\r\n                parent: panel,\r\n                name: '位置X单位类型',\r\n                type: 'number',\r\n                enum: [\r\n                    { v: 0, t: '像素' }, // pc.PROJECTION_PERSPECTIVE\r\n                    { v: 1, t: '百分比' } // pc.PROJECTION_ORTHOGRAPHIC\r\n                ],\r\n                link: entities,\r\n                path: 'gui.xType'\r\n            });\r\n\r\n            // x\r\n            var x = editor.call('attributes:addField', {\r\n                parent: panel,\r\n                name: '位置X',\r\n                type: 'number',\r\n                link: entities,\r\n                path: 'gui.x'\r\n            });\r\n\r\n            // yType\r\n            var yType = editor.call('attributes:addField', {\r\n                parent: panel,\r\n                name: '位置Y单位类型',\r\n                type: 'number',\r\n                enum: [\r\n                    { v: 0, t: '像素' }, // pc.PROJECTION_PERSPECTIVE\r\n                    { v: 1, t: '百分比' } // pc.PROJECTION_ORTHOGRAPHIC\r\n                ],\r\n                link: entities,\r\n                path: 'gui.yType'\r\n            });\r\n\r\n            // y\r\n            var y = editor.call('attributes:addField', {\r\n                parent: panel,\r\n                name: '位置Y',\r\n                type: 'number',\r\n                link: entities,\r\n                path: 'gui.y'\r\n            });\r\n\r\n            // widthType\r\n            var widthType = editor.call('attributes:addField', {\r\n                parent: panel,\r\n                name: '宽度单位类型',\r\n                type: 'number',\r\n                enum: [\r\n                    { v: 0, t: '像素' }, // pc.PROJECTION_PERSPECTIVE\r\n                    { v: 1, t: '百分比' } // pc.PROJECTION_ORTHOGRAPHIC\r\n                ],\r\n                link: entities,\r\n                path: 'gui.widthType'\r\n            });\r\n\r\n            // width\r\n            var width = editor.call('attributes:addField', {\r\n                parent: panel,\r\n                name: '宽度',\r\n                type: 'number',\r\n                link: entities,\r\n                path: 'gui.width'\r\n            });\r\n\r\n            // heightType\r\n            var heightType = editor.call('attributes:addField', {\r\n                parent: panel,\r\n                name: '高度单位类型',\r\n                type: 'number',\r\n                enum: [\r\n                    { v: 0, t: '像素' },\r\n                    { v: 1, t: '百分比' }\r\n                ],\r\n                link: entities,\r\n                path: 'gui.heightType'\r\n            });\r\n\r\n            // height\r\n            var height = editor.call('attributes:addField', {\r\n                parent: panel,\r\n                name: '高度',\r\n                type: 'number',\r\n                link: entities,\r\n                path: 'gui.height'\r\n            });\r\n\r\n            // horizontal_alignment\r\n            var horizontal_alignment = editor.call('attributes:addField', {\r\n                parent: panel,\r\n                name: '水平对齐方式',\r\n                type: 'number',\r\n                enum: [\r\n                    { v: 0, t: '居左' },\r\n                    { v: 1, t: '居右' },\r\n                    { v: 2, t: '居中' }\r\n                ],\r\n                link: entities,\r\n                path: 'gui.horizontal_alignment'\r\n            });\r\n\r\n            // vertical_alignment\r\n            var vertical_alignment = editor.call('attributes:addField', {\r\n                parent: panel,\r\n                name: '垂直对齐方式',\r\n                type: 'number',\r\n                enum: [\r\n                    { v: 0, t: '居上' },\r\n                    { v: 1, t: '居下' },\r\n                    { v: 2, t: '居中' }\r\n                ],\r\n                link: entities,\r\n                path: 'gui.vertical_alignment'\r\n            });\r\n\r\n            // alpha\r\n            var alpha = editor.call('attributes:addField', {\r\n                parent: panel,\r\n                name: '透明度',\r\n                // placeholder: '\\u00B0',\r\n                // placeholder: '弧度',\r\n                type: 'number',\r\n                precision: 2,\r\n                step: 1,\r\n                min: 0,\r\n                link: entities,\r\n                path: 'gui.alpha'\r\n            });\r\n            alpha.style.width = '32px';\r\n\r\n            // alpha slider\r\n            var alphaSlider = editor.call('attributes:addField', {\r\n                panel: alpha.parent,\r\n                precision: 2,\r\n                step: 1,\r\n                min: 0,\r\n                max: 1,\r\n                type: 'number',\r\n                slider: true,\r\n                link: entities,\r\n                path: 'gui.alpha'\r\n            });\r\n            alphaSlider.flexGrow = 4;\r\n\r\n            // rotation\r\n            var rotation = editor.call('attributes:addField', {\r\n                parent: panel,\r\n                name: '旋转角度',\r\n                // placeholder: '\\u00B0',\r\n                // placeholder: '弧度',\r\n                type: 'number',\r\n                precision: 2,\r\n                step: 1,\r\n                min: 0,\r\n                link: entities,\r\n                path: 'gui.rotation'\r\n            });\r\n            rotation.style.width = '32px';\r\n\r\n            // rotation slider\r\n            var rotationSlider = editor.call('attributes:addField', {\r\n                panel: rotation.parent,\r\n                precision: 2,\r\n                step: 1,\r\n                min: 0,\r\n                max: 360,\r\n                type: 'number',\r\n                slider: true,\r\n                link: entities,\r\n                path: 'gui.rotation'\r\n            });\r\n            rotationSlider.flexGrow = 4;\r\n\r\n            // isVisible\r\n            var isHighlighted = editor.call('attributes:addField', {\r\n                parent: panel,\r\n                name: '显示元素边界',\r\n                type: 'checkbox',\r\n                link: entities,\r\n                path: 'gui.isHighlighted'\r\n            });\r\n\r\n            if (entities[0].node instanceof BABYLON.GUI.AdvancedDynamicTexture) {\r\n\r\n                // zIndex\r\n                // var zIndex = editor.call('attributes:addField', {\r\n                //     parent: panelButton,\r\n                //     name: '画布深度',\r\n                //     type: 'number',\r\n                //     link: entities,\r\n                //     path: 'gui.zIndex'\r\n                // });\r\n\r\n            } else if (entities[0].node instanceof BABYLON.GUI.Button) {\r\n\r\n                var panelButton = editor.call('attributes:entity:addComponentPanel', {\r\n                    title: '按钮 Button',\r\n                    name: '2d-gui',\r\n                    entities: entities\r\n                });\r\n\r\n                // background color\r\n                var backgroundColor = editor.call('attributes:addField', {\r\n                    parent: panelButton,\r\n                    name: '背景色',\r\n                    type: 'rgb',\r\n                    link: entities,\r\n                    path: 'gui.background'\r\n                });\r\n\r\n                // foreground color\r\n                var foregroundColor = editor.call('attributes:addField', {\r\n                    parent: panelButton,\r\n                    name: '边框色',\r\n                    type: 'rgb',\r\n                    link: entities,\r\n                    path: 'gui.color'\r\n                });\r\n\r\n                // text color\r\n                var textColor = editor.call('attributes:addField', {\r\n                    parent: panelButton,\r\n                    name: '字体颜色',\r\n                    type: 'rgb',\r\n                    link: entities,\r\n                    path: 'gui.textColor'\r\n                });\r\n\r\n                // text\r\n                var text = editor.call('attributes:addField', {\r\n                    parent: panelButton,\r\n                    name: '文字',\r\n                    type: 'string',\r\n                    trim: false,\r\n                    link: entities,\r\n                    path: 'gui.text'\r\n                });\r\n\r\n                // fontSize\r\n                var fontSize = editor.call('attributes:addField', {\r\n                    parent: panelButton,\r\n                    name: '字体大小',\r\n                    type: 'number',\r\n                    link: entities,\r\n                    path: 'gui.fontSize'\r\n                });\r\n\r\n                var image = editor.call('attributes:addField', {\r\n                    parent: panelButton,\r\n                    type: 'asset',\r\n                    kind: 'texture',\r\n                    name: '图片',\r\n                    link: entities,\r\n                    path: 'gui.source',\r\n                    // over: fieldDiffuseMapHover.over,\r\n                    // leave: fieldDiffuseMapHover.leave,\r\n                    onSet: function (asset: Observer, oldValues: any) {\r\n                        // console.error(asset);\r\n                        // console.error(oldValues);\r\n                        // onTextureBulkSet(asset, oldValues, 'source');\r\n                    }\r\n                });\r\n\r\n                // thickness\r\n                var thickness = editor.call('attributes:addField', {\r\n                    parent: panelButton,\r\n                    name: '边框厚度',\r\n                    type: 'number',\r\n                    link: entities,\r\n                    path: 'gui.thickness'\r\n                });\r\n\r\n                // cornerRadius\r\n                var cornerRadius = editor.call('attributes:addField', {\r\n                    parent: panelButton,\r\n                    name: '边框圆角半径',\r\n                    type: 'number',\r\n                    link: entities,\r\n                    path: 'gui.cornerRadius'\r\n                });\r\n            } else if (entities[0].node instanceof BABYLON.GUI.Rectangle) {\r\n                var panelContainer = editor.call('attributes:entity:addComponentPanel', {\r\n                    title: '容器 Container',\r\n                    name: '2d-gui',\r\n                    entities: entities\r\n                });\r\n\r\n                // background color\r\n                var backgroundColor = editor.call('attributes:addField', {\r\n                    parent: panelContainer,\r\n                    name: '背景色',\r\n                    type: 'rgb',\r\n                    link: entities,\r\n                    path: 'gui.background'\r\n                });\r\n\r\n                // foreground color\r\n                var foregroundColor = editor.call('attributes:addField', {\r\n                    parent: panelContainer,\r\n                    name: '边框色',\r\n                    type: 'rgb',\r\n                    link: entities,\r\n                    path: 'gui.color'\r\n                });\r\n\r\n                // thickness\r\n                var thickness = editor.call('attributes:addField', {\r\n                    parent: panelContainer,\r\n                    name: '边框厚度',\r\n                    type: 'number',\r\n                    link: entities,\r\n                    path: 'gui.thickness'\r\n                });\r\n\r\n                // cornerRadius\r\n                var cornerRadius = editor.call('attributes:addField', {\r\n                    parent: panelContainer,\r\n                    name: '边框圆角半径',\r\n                    type: 'number',\r\n                    link: entities,\r\n                    path: 'gui.cornerRadius'\r\n                });\r\n\r\n            } else if (entities[0].node instanceof BABYLON.GUI.TextBlock) {\r\n                var panelText = editor.call('attributes:entity:addComponentPanel', {\r\n                    title: '文字 Text',\r\n                    name: '2d-gui',\r\n                    entities: entities\r\n                });\r\n\r\n                // foreground color\r\n                var foregroundColor = editor.call('attributes:addField', {\r\n                    parent: panelText,\r\n                    name: '文字颜色',\r\n                    type: 'rgb',\r\n                    link: entities,\r\n                    path: 'gui.color'\r\n                });\r\n\r\n                // text\r\n                var text = editor.call('attributes:addField', {\r\n                    parent: panelText,\r\n                    name: '文字',\r\n                    type: 'string',\r\n                    trim: false,\r\n                    link: entities,\r\n                    path: 'gui.text'\r\n                });\r\n\r\n                // fontSize\r\n                var fontSize = editor.call('attributes:addField', {\r\n                    parent: panelText,\r\n                    name: '字体大小',\r\n                    type: 'number',\r\n                    link: entities,\r\n                    path: 'gui.fontSize'\r\n                });\r\n\r\n                // textHorizontalAlignment\r\n                var textHorizontalAlignment = editor.call('attributes:addField', {\r\n                    parent: panelText,\r\n                    name: '文字水平对齐',\r\n                    type: 'number',\r\n                    enum: [\r\n                        { v: 0, t: '居左' },\r\n                        { v: 1, t: '居右' },\r\n                        { v: 2, t: '居中' }\r\n                    ],\r\n                    link: entities,\r\n                    path: 'gui.textHorizontalAlignment'\r\n                });\r\n\r\n                // textVerticalAlignment\r\n                var textVerticalAlignment = editor.call('attributes:addField', {\r\n                    parent: panelText,\r\n                    name: '文字垂直对齐',\r\n                    type: 'number',\r\n                    enum: [\r\n                        { v: 0, t: '居上' },\r\n                        { v: 1, t: '居下' },\r\n                        { v: 2, t: '居中' }\r\n                    ],\r\n                    link: entities,\r\n                    path: 'gui.textVerticalAlignment'\r\n                });\r\n\r\n                // textWrapping\r\n                var textWrapping = editor.call('attributes:addField', {\r\n                    parent: panelText,\r\n                    name: '文字环绕方式',\r\n                    type: 'number',\r\n                    enum: [\r\n                        { v: 0, t: '裁剪显示' },\r\n                        { v: 1, t: '自动换行' },\r\n                        { v: 2, t: '省略显示' }\r\n                    ],\r\n                    link: entities,\r\n                    path: 'gui.textWrapping'\r\n                });\r\n\r\n            } else if (entities[0].node instanceof BABYLON.GUI.InputText) {\r\n                var panelInput = editor.call('attributes:entity:addComponentPanel', {\r\n                    title: '输入框 Input',\r\n                    name: '2d-gui',\r\n                    entities: entities\r\n                });\r\n\r\n                // background color\r\n                var backgroundColor = editor.call('attributes:addField', {\r\n                    parent: panelInput,\r\n                    name: '背景色',\r\n                    type: 'rgb',\r\n                    link: entities,\r\n                    path: 'gui.background'\r\n                });\r\n\r\n                // foreground color\r\n                var foregroundColor = editor.call('attributes:addField', {\r\n                    parent: panelInput,\r\n                    name: '文字颜色',\r\n                    type: 'rgb',\r\n                    link: entities,\r\n                    path: 'gui.color'\r\n                });\r\n\r\n                // text\r\n                var text = editor.call('attributes:addField', {\r\n                    parent: panelInput,\r\n                    name: '文字',\r\n                    type: 'string',\r\n                    trim: false,\r\n                    link: entities,\r\n                    path: 'gui.text'\r\n                });\r\n\r\n                // fontSize\r\n                var fontSize = editor.call('attributes:addField', {\r\n                    parent: panelInput,\r\n                    name: '字体大小',\r\n                    type: 'number',\r\n                    link: entities,\r\n                    path: 'gui.fontSize'\r\n                });\r\n\r\n                // placeholderText\r\n                var placeholderText = editor.call('attributes:addField', {\r\n                    parent: panelInput,\r\n                    name: '预留文字',\r\n                    type: 'string',\r\n                    trim: false,\r\n                    link: entities,\r\n                    path: 'gui.placeholderText'\r\n                });\r\n\r\n                // placeholderColor\r\n                var placeholderColor = editor.call('attributes:addField', {\r\n                    parent: panelInput,\r\n                    name: '预留文字颜色',\r\n                    type: 'rgb',\r\n                    link: entities,\r\n                    path: 'gui.placeholderColor'\r\n                });\r\n\r\n                // focusedBackground\r\n                var focusedBackground = editor.call('attributes:addField', {\r\n                    parent: panelInput,\r\n                    name: '聚焦背景色',\r\n                    type: 'rgb',\r\n                    link: entities,\r\n                    path: 'gui.focusedBackground'\r\n                });\r\n\r\n                // thickness\r\n                var thickness = editor.call('attributes:addField', {\r\n                    parent: panelInput,\r\n                    name: '边框厚度',\r\n                    type: 'number',\r\n                    link: entities,\r\n                    path: 'gui.thickness'\r\n                });\r\n            } else if (entities[0].node instanceof BABYLON.GUI.RadioButton) {\r\n                var panelCheckbox = editor.call('attributes:entity:addComponentPanel', {\r\n                    title: '复选框 Checkbox',\r\n                    name: '2d-gui',\r\n                    entities: entities\r\n                });\r\n\r\n                // background color\r\n                var backgroundColor = editor.call('attributes:addField', {\r\n                    parent: panelCheckbox,\r\n                    name: '背景色',\r\n                    type: 'rgb',\r\n                    link: entities,\r\n                    path: 'gui.background'\r\n                });\r\n\r\n                // foreground color\r\n                var foregroundColor = editor.call('attributes:addField', {\r\n                    parent: panelCheckbox,\r\n                    name: '前景色',\r\n                    type: 'rgb',\r\n                    link: entities,\r\n                    path: 'gui.color'\r\n                });\r\n\r\n                // value\r\n                var value = editor.call('attributes:addField', {\r\n                    parent: panelCheckbox,\r\n                    name: '值',\r\n                    type: 'checkbox',\r\n                    link: entities,\r\n                    path: 'gui.isChecked'\r\n                });\r\n\r\n                // thickness\r\n                var thickness = editor.call('attributes:addField', {\r\n                    parent: panelInput,\r\n                    name: '边框厚度',\r\n                    type: 'number',\r\n                    link: entities,\r\n                    path: 'gui.thickness'\r\n                });\r\n            } else if (entities[0].node instanceof BABYLON.GUI.Image) {\r\n                var panelImage = editor.call('attributes:entity:addComponentPanel', {\r\n                    title: '图片 Image',\r\n                    name: '2d-gui',\r\n                    entities: entities\r\n                });\r\n\r\n                // image\r\n                // var fieldDiffuseMapHover = handleTextureHover('diffuseMap');\r\n                var image = editor.call('attributes:addField', {\r\n                    parent: panelImage,\r\n                    type: 'asset',\r\n                    kind: 'texture',\r\n                    name: '图片',\r\n                    link: entities,\r\n                    path: 'gui.source',\r\n                    // over: fieldDiffuseMapHover.over,\r\n                    // leave: fieldDiffuseMapHover.leave,\r\n                    onSet: function (asset: Observer, oldValues: any) {\r\n                        // console.error(asset);\r\n                        // console.error(oldValues);\r\n                        // onTextureBulkSet(asset, oldValues, 'source');\r\n                    }\r\n                });\r\n                // fieldDiffuseMap.parent.class.add('channel');\r\n                // fieldDiffuseMap.on('change', function (value: any) {\r\n                //     fieldDiffuseOffset[0].parent.hidden = filterDiffuseOffset();\r\n                //     fieldDiffuseTiling[0].parent.hidden = filterDiffuseTiling();\r\n                // });\r\n            }\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n        });\r\n    }\r\n\r\n\r\n}","import { Observer } from \"../../../lib\";\r\n\r\nexport class AttributeComponentLight {\r\n\r\n    public constructor() {\r\n\r\n        editor.on('attributes:inspect[entity]', function (entities: Observer[]) {\r\n            if (entities.length !== 1 || entities[0].get('type') !== 'light')\r\n                return;\r\n\r\n            // console.log('attributes:inspect[entity] light');\r\n\r\n            var panelComponents = editor.call('attributes:entity.panelComponents');\r\n            if (!panelComponents)\r\n                return;\r\n\r\n            var projectSettings = editor.call('settings:project');\r\n\r\n            var panel = editor.call('attributes:entity:addComponentPanel', {\r\n                title: '灯光属性',\r\n                name: 'light',\r\n                entities: entities\r\n            });\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n        });\r\n\r\n    }\r\n\r\n\r\n}","export * from './attributes-panel';\nexport * from './attributes-entity';\nexport * from './attributes-history';\nexport * from './attributes-reference';\nexport * from './attributes-assets';\nexport * from './components/attributes-component-camera';\nexport * from './components/attributes-component-light';\nexport * from './components/attributes-component-gui';\nexport * from './keeper';","import { AttributesPanel } from \"./attributes-panel\";\nimport { AttributesReference } from \"./attributes-reference\";\nimport { AttributesEntity } from \"./attributes-entity\";\nimport { AttributesAssets } from \"./attributes-assets\";\nimport { AttributeHistory } from \"./attributes-history\";\nimport { AttributeAssetsTexture } from \"./assets/attributes-assets-texture\";\nimport { AttributeComponentCamera } from \"./components/attributes-component-camera\";\nimport { AttributeComponentLight } from \"./components/attributes-component-light\";\nimport { AttributeComponentGUI } from \"./components/attributes-component-gui\";\n\nexport class AttributesKeeper {\n    public constructor() {\n\n        let attributesPanel = new AttributesPanel();\n\n        let attributesHistory = new AttributeHistory();\n\n        let attributesReference = new AttributesReference();\n\n        let attributesEntity = new AttributesEntity();\n\n        let attributesAsset = new AttributesAssets();\n\n        let attributesAssetsTexture = new AttributeAssetsTexture();\n\n        new AttributeComponentCamera();\n        new AttributeComponentLight();\n        new AttributeComponentGUI();\n\n    }\n}","export class CameraDepth {\n\n\n    public constructor() {\n\n    }\n\n}","import { Observer } from \"../../lib\";\nimport { Button, Tooltip } from \"../../ui\";\nimport { VeryCamera } from \"../middleware\";\n\nexport class CameraPreview {\n\n    public constructor() {\n\n        var selectedEntity: Nullable<Observer> = null; // currently selected entity\n        var currentCamera: Nullable<VeryCamera> = null;  // current camera rendering to viewport\n        var renderCamera = false;\n        var pinnedCamera: Nullable<VeryCamera> = null;   // camera that is currently pinned in preview\n        let previewing: boolean = false;\n        let pinned: boolean = false;\n\n        var viewport = editor.call('layout.viewport');\n\n        var cameraPreviewBorder = document.createElement('div');\n        cameraPreviewBorder.classList.add('camera-preview');\n        cameraPreviewBorder.classList.add('clickable');\n\n        // var btnPin = new Button('&#57636;');\n        var btnPin = new Button('&#58177;');\n\n        btnPin.class!.add('pin');\n        cameraPreviewBorder.appendChild(btnPin.element!);\n\n        btnPin.on('click', function (evt: MouseEvent) {\n            evt.stopPropagation();\n\n            if (pinnedCamera) {\n                pinnedCamera = null;\n                btnPin.class!.remove('active');\n                pinned = false;\n                if(!selectedEntity) {\n                    stopPreview();\n                }\n            } else {\n                pinnedCamera = currentCamera;\n                btnPin.class!.add('active');\n                pinned = true;\n            }\n            // updateCameraState();\n        });\n\n        Tooltip.attach({\n            target: btnPin.element!,\n            text: '锁定画面',\n            align: 'left',\n            root: editor.call('layout.root')\n        });\n\n        viewport.append(cameraPreviewBorder);\n\n\n        editor.on('selector:change', function (type: string, items: Observer[]) {\n            // console.warn(type);\n            // console.warn(items);\n            if (type === 'entity' && items && items.length === 1) {\n                selectedEntity = items[0];\n                if (selectedEntity.node instanceof VeryCamera) {\n\n                    if(currentCamera) {\n                        if(currentCamera === selectedEntity.node) {\n                            return;\n                        } else {\n                            stopPreview();\n                        }\n                    }\n\n                    currentCamera = selectedEntity.node;\n                    currentCamera.renderCamera(true);\n                    previewing = true;\n                    if (!cameraPreviewBorder.classList.contains('active')) {\n                        cameraPreviewBorder.classList.add('active');\n                    }\n                    if(pinned) pinnedCamera = currentCamera;\n                } else {\n                    selectedEntity = null;\n                    if(!pinned) {\n                        stopPreview();\n                    } \n                }\n            } else {\n                selectedEntity = null;\n                if(!pinned) {\n                    stopPreview();\n                }\n            }\n        });\n\n        let stopPreview = () => {\n            if (currentCamera) currentCamera.renderCamera(false);\n            currentCamera = null;\n            previewing = false;\n            if (cameraPreviewBorder.classList.contains('active')) {\n                cameraPreviewBorder.classList.remove('active');\n            }\n        };\n\n    }\n\n}","export class CameraUserdata {\n\n\n    public constructor() {\n\n    }\n\n}","import { Observer } from \"../../lib\";\nimport { VeryEngine } from \"../../engine\";\nimport { Tools } from \"../utility\";\n\nexport class CameraViewport {\n\n\n\n    public constructor() {\n        var orbiting = false;\n        var panning = false;\n        let zooming = false;\n\n        let deltaTime: number = 0.02;\n\n        let target = new BABYLON.TransformNode('__viewCameraTarget__', VeryEngine.viewScene);\n        target.position.copyFromFloats(0, 0, 0);\n        target.rotation.copyFromFloats(0, 0, 0);\n        let MouseWheelSensitivity = 1; //滚轮灵敏度设置\n        let MouseZoomMin = 0.1; //相机距离最小值\n        let MouseZoomMax = 10000; //相机距离最大值\n\n        let moveSpeed = 1; //相机跟随速度（中键平移时），采用平滑模式时起作用，越大则运动越平滑\n\n        let wheelSpeed = 0.01;\n\n        let xSpeed = 250.0; //旋转视角时相机x轴转速\n        let ySpeed = 120.0; //旋转视角时相机y轴转速\n\n        let yMinLimit = -360;\n        let yMaxLimit = 360;\n\n        let x = 0.0; //存储相机的euler角\n        let y = 0.0; //存储相机的euler角\n\n        let StandardDistance = 300;\n        let Distance = 300; //相机和target之间的距离，因为相机的Z轴总是指向target，也就是相机z轴方向上的距离\n        let targetOnScreenPosition: BABYLON.Vector3; //目标的屏幕坐标，第三个值为z轴距离\n        let storeRotation: BABYLON.Quaternion; //存储相机的姿态四元数\n        let CameraTargetPosition: BABYLON.Vector3; //target的位置\n        let initPosition: BABYLON.Vector3 = BABYLON.Vector3.Zero(); //平移时用于存储平移的起点位置\n        let cameraX: BABYLON.Vector3; //相机的x轴方向向量\n        let cameraY: BABYLON.Vector3; //相机的y轴方向向量\n        let cameraZ: BABYLON.Vector3; //相机的z轴方向向量\n\n        let initScreenPos: BABYLON.Vector3; //中键刚按下时鼠标的屏幕坐标（第三个值其实没什么用）\n        let curScreenPos: BABYLON.Vector3; //当前鼠标的屏幕坐标（第三个值其实没什么用）\n\n        //这里就是设置一下初始的相机视角以及一些其他变量，这里的x和y。。。是和下面getAxis的mouse x与mouse y对应\n\n        var angles = Tools.radianToEulerAngle(VeryEngine.viewCamera.rotation);\n        x = angles.y;\n        y = angles.x;\n        CameraTargetPosition = target.position.clone();\n        targetOnScreenPosition = target.position.clone();\n\n        storeRotation = BABYLON.Quaternion.FromEulerVector(Tools.eulerAngleToRadian(new BABYLON.Vector3(y + 60, x, 0)));\n        VeryEngine.viewCamera.rotation = storeRotation.toEulerAngles(); //设置相机姿态\n\n        let position: BABYLON.Vector3 = Tools.quatMultiplyVector3(storeRotation, new BABYLON.Vector3(0.0, 0.0, -Distance)).add(CameraTargetPosition); //四元数表示一个旋转，四元数乘以向量相当于把向量旋转对应角度，然后加上目标物体的位置就是相机位置了\n        VeryEngine.viewCamera.position.copyFrom(position); //设置相机位置\n\n\n        editor.method('viewport:camera:initilize', (target_position: BABYLON.Vector3, target_rotation: BABYLON.Vector3) => {\n\n        });\n\n        editor.on('viewport:update', function (dt: number) {\n            // 毫秒变成秒\n            deltaTime = dt * 0.001;\n\n            // 聚焦\n            if (focusing) {\n\n                var pos = VeryEngine.viewCamera.position.clone();\n                var dist = vecA.copyFrom(pos).subtract(focusPoint).length();\n                // vecA.copyFrom(pos);\n                if (dist > 0.1) {\n                    var speed = Math.min(1.0, Math.min(1.0, flySpeed * ((firstUpdate ? 1 / 60 : deltaTime * 1.8) / (1 / 60))));\n                    vecA = Tools.lerpVector3(pos, focusPoint, speed);\n                    VeryEngine.viewCamera.position.copyFrom(vecA);\n                } else {\n                    VeryEngine.viewCamera.position.copyFrom(focusPoint);\n                    // VeryEngine.viewCamera.position.copyFrom(focusTarget);\n                    focusing = false;\n                    editor.emit('camera:focus:end', focusTarget, vecA.copyFrom(focusTarget).subtract(VeryEngine.viewCamera.position).length());\n                    // editor.once('viewport:postUpdate', function () {\n                    //     editor.call('camera:history:stop', focusCamera);\n                    // });\n                }\n\n                firstUpdate = false;\n            }\n\n        });\n\n        editor.on('viewport:mouse:down', function (evt: MouseEvent, rect: DOMRect) {\n            if (!focusing) {\n                // 鼠标中键按下，平移允许\n                if (evt.button === 1) {\n                    panning = true;\n\n                    cameraX = VeryEngine.viewCamera.right;\n                    cameraY = VeryEngine.viewCamera.up;\n                    cameraZ = VeryEngine.viewCamera.forward;\n\n                    initScreenPos = new BABYLON.Vector3(evt.clientX - rect.left, rect.height - evt.clientY, targetOnScreenPosition.z);\n\n                    // targetOnScreenPosition.z为目标物体到相机xmidbuttonDownPositiony平面的法线距离\n                    targetOnScreenPosition = Tools.worldToScreenPoint(CameraTargetPosition, VeryEngine.viewScene, VeryEngine.viewCamera.camera, VeryEngine.viewEngine);\n\n                    initPosition.copyFrom(CameraTargetPosition);\n                }\n\n                // 鼠标右键按下，旋转允许\n                if (evt.button === 2) {\n                    orbiting = true;\n                    if(_lastMode !== '透视相机' && _lastMode !== '正交相机') {\n                        editor.call('camera:ortho:set');\n                        _lastMode = '正交相机';\n                    }\n                }\n            }\n        });\n\n        editor.on('viewport:mouse:up', function (evt: MouseEvent, rect: DOMRect) {\n            // 鼠标中键抬起，平移停止\n            if (evt.button === 1) {\n                panning = false;\n                //平移结束把cameraTargetPosition的位置更新一下，不然会影响缩放与旋转功能\n                CameraTargetPosition.copyFrom(target.position);\n            }\n\n            // 鼠标右键抬起，旋转停止\n            if (evt.button === 2) {\n                orbiting = false;\n            }\n        });\n\n        editor.on('viewport:mouse:move', function (evt: MouseEvent, rect: DOMRect) {\n            if (!focusing) {\n                if (orbiting) {\n                    x += evt.movementX * xSpeed * 0.002;\n                    y -= -evt.movementY * ySpeed * 0.002;\n                    y = Tools.clampAngle(y, yMinLimit, yMaxLimit);\n                    storeRotation = BABYLON.Quaternion.FromEulerVector(Tools.eulerAngleToRadian(new BABYLON.Vector3(y + 60, x, 0)));\n                    position = Tools.quatMultiplyVector3(storeRotation, new BABYLON.Vector3(0.0, 0.0, -Distance)).add(CameraTargetPosition);\n                    VeryEngine.viewCamera.rotation = storeRotation.toEulerAngles(); //设置相机姿态\n                    VeryEngine.viewCamera.position.copyFrom(position);\n                }\n\n                if (panning) {\n                    // console.warn(evt);\n                    // console.error(rect);\n                    curScreenPos = new BABYLON.Vector3(evt.clientX - rect.left, rect.height - evt.clientY, targetOnScreenPosition.z);\n                    //0.01这个系数是控制平移的速度，要根据相机和目标物体的distance来灵活选择\n                    if (VeryEngine.viewCamera.mode === BABYLON.Camera.PERSPECTIVE_CAMERA) {\n                        moveSpeed = 1;\n                    } else {\n                        if (VeryEngine.viewCamera.orthoSize < 0.05) {\n                            moveSpeed = 0.4;\n                        } else {\n                            moveSpeed = 1;\n                        }\n                    }\n\n                    target.position = initPosition.subtract(cameraX.scale(curScreenPos.x - initScreenPos.x).add(cameraY.scale(curScreenPos.y - initScreenPos.y)).scale(1 * moveSpeed));\n\n                    //重新计算位置\n                    let mPosition = Tools.quatMultiplyVector3(storeRotation, new BABYLON.Vector3(0.0, 0.0, -Distance)).add(target.position);\n                    VeryEngine.viewCamera.position.copyFrom(mPosition);\n                }\n            }\n\n\n        });\n\n        editor.on('viewport:mouse:wheel', function (evt: WheelEvent, rect: DOMRect) {\n            if (!focusing) {\n                if (VeryEngine.viewCamera.mode === BABYLON.Camera.PERSPECTIVE_CAMERA) {\n                    if (Distance >= MouseZoomMin && Distance <= MouseZoomMax) {\n                        Distance += evt.deltaY * MouseWheelSensitivity * 0.1;\n                    }\n                    if (Distance < MouseZoomMin) {\n                        Distance = MouseZoomMin;\n                    }\n                    if (Distance > MouseZoomMax) {\n                        Distance = MouseZoomMax;\n                    }\n\n                    // console.log('distance: ' + Distance);\n                    // console.log('delta: ' + (evt.deltaY * MouseWheelSensitivity * 0.1));\n                    position = Tools.quatMultiplyVector3(storeRotation, new BABYLON.Vector3(0.0, 0.0, -Distance)).add(CameraTargetPosition);\n                    VeryEngine.viewCamera.position.copyFrom(position);\n                } else {\n                    wheelSpeed = 0.5;\n                    if (Distance >= MouseZoomMin && Distance <= MouseZoomMax) {\n                        Distance += evt.deltaY * MouseWheelSensitivity * 0.1 * wheelSpeed;\n                    }\n                    if (Distance < MouseZoomMin) {\n                        Distance = MouseZoomMin;\n                    }\n                    if (Distance > MouseZoomMax) {\n                        Distance = MouseZoomMax;\n                    }\n\n                    // console.log('distance: ' + Distance);\n                    // console.log('delta: ' + (evt.deltaY * MouseWheelSensitivity * 0.1));\n\n                    let delta = evt.deltaY * MouseWheelSensitivity * 0.1 * 0.0012;\n\n                    if (VeryEngine.viewCamera.orthoSize > 0.01 || (VeryEngine.viewCamera.orthoSize <= 0.01 && delta > 0)) {\n                        VeryEngine.viewCamera.orthoSize += delta;\n                        position = Tools.quatMultiplyVector3(storeRotation, new BABYLON.Vector3(0.0, 0.0, -Distance)).add(CameraTargetPosition);\n                    VeryEngine.viewCamera.position.copyFrom(position);\n                    }\n                    if (VeryEngine.viewCamera.orthoSize <= 0.01) {\n                        VeryEngine.viewCamera.orthoSize = 0.01;\n                    }\n\n                    // console.warn(VeryEngine.viewCamera.orthoSize);\n                }\n            }\n        });\n\n\n\n        var focusTarget = BABYLON.Vector3.Zero();\n        var focusPoint = BABYLON.Vector3.Zero();\n        var focusOrthoHeight = 0;\n        // var focusCamera;\n        var focusing = false;\n        var firstUpdate = false;\n        var flySpeed = 0.25;\n        var vecA = BABYLON.Vector3.Zero();\n        var vecB = BABYLON.Vector3.Zero();\n\n\n        editor.method('camera:focus', function (point: BABYLON.Vector3, distance: number) {\n            // var camera = editor.call('camera:current');\n\n            focusing = true;\n            firstUpdate = true;\n\n            focusTarget.copyFrom(point);\n            CameraTargetPosition.copyFrom(focusTarget);\n            Distance = distance;\n            vecA = Tools.quatMultiplyVector3(storeRotation, new BABYLON.Vector3(0.0, 0.0, -Distance)).add(CameraTargetPosition);\n\n            focusPoint.copyFrom(vecA);\n\n            editor.emit('camera:focus', point, distance);\n        });\n\n        editor.method('camera:focus:stop', function () {\n            if (!focusing)\n                return;\n            focusing = false;\n            // var camera = editor.call('camera:current');\n            // editor.emit('camera:focus:end', focusTarget, vecA.copyFrom(focusTarget).subtract(camera.getPosition()).length());\n            // editor.once('viewport:postUpdate', function () {\n            //     editor.call('camera:history:stop', focusCamera);\n            // });\n        });\n\n        editor.on('camera:focus:end', (target_position: BABYLON.Vector3, distance: number) => {\n            // angles = Tools.radianToEulerAngle(VeryEngine.viewCamera.rotation);\n            // x = angles.y;\n            // y = angles.x;\n            target.position.copyFrom(target_position);\n            // CameraTargetPosition = target.position.clone();\n            // targetOnScreenPosition = target.position.clone();\n            Distance = distance;\n            // storeRotation = BABYLON.Quaternion.FromEulerVector(Tools.eulerAngleToRadian(new BABYLON.Vector3(y + 60, x, 0)));\n            // VeryEngine.viewCamera.rotation = storeRotation.toEulerAngles(); //设置相机姿态\n\n            // let position: BABYLON.Vector3 = Tools.quatMultiplyVector3(storeRotation, new BABYLON.Vector3(0.0, 0.0, -Distance)).add(CameraTargetPosition); //四元数表示一个旋转，四元数乘以向量相当于把向量旋转对应角度，然后加上目标物体的位置就是相机位置了\n            // VeryEngine.viewCamera.position = position.clone(); //设置相机位置\n        });\n\n        let _lastMode: string = '透视相机';\n        editor.method('camera:change:mode', (mode_type: string) => {\n            if (mode_type !== _lastMode) {\n                if (mode_type === '透视相机') {\n                    VeryEngine.viewCamera.mode = BABYLON.Camera.PERSPECTIVE_CAMERA;\n                } else {\n                    let currentDistance = Distance;\n                    if (_lastMode === '透视相机') {\n                        currentDistance = StandardDistance;\n                        VeryEngine.viewCamera.mode = BABYLON.Camera.ORTHOGRAPHIC_CAMERA;\n                    }\n\n                    if (mode_type === '正交相机') {\n\n                    } else if (mode_type === '左视图') {\n                        VeryEngine.viewCamera.rotation = Tools.eulerAngleToRadian(new BABYLON.Vector3(0, 90, 0));\n                    } else if (mode_type === '右视图') {\n                        VeryEngine.viewCamera.rotation = Tools.eulerAngleToRadian(new BABYLON.Vector3(0, -90, 0));\n                    } else if (mode_type === '顶视图') {\n                        VeryEngine.viewCamera.rotation = Tools.eulerAngleToRadian(new BABYLON.Vector3(90, 0, 0));\n                    } else if (mode_type === '底视图') {\n                        VeryEngine.viewCamera.rotation = Tools.eulerAngleToRadian(new BABYLON.Vector3(-90, 0, 0));\n                    } else if (mode_type === '前视图') {\n                        VeryEngine.viewCamera.rotation = Tools.eulerAngleToRadian(new BABYLON.Vector3(0, 180, 0));\n                    } else if (mode_type === '后视图') {\n                        VeryEngine.viewCamera.rotation = Tools.eulerAngleToRadian(new BABYLON.Vector3(0, 0, 0));\n                    }\n\n                    storeRotation = VeryEngine.viewCamera.rotation.toQuaternion();\n                    var tempAngle = Tools.radianToEulerAngle(VeryEngine.viewCamera.rotation);\n                    x = tempAngle.y;\n                    y = tempAngle.x - 60;\n\n                    editor.call('camera:focus', target.getAbsolutePosition(), currentDistance);\n                }\n\n\n                _lastMode = mode_type;\n            }\n        });\n\n\n        editor.method('viewport:focus', function () {\n            var selection = editor.call('selection:aabb');\n            if (!selection) return;\n\n            // var camera = editor.call('camera:current');\n\n            // aabb\n            // var distance = Math.max(aabb.halfExtents.x, Math.max(aabb.halfExtents.y, aabb.halfExtents.z));\n            // // fov\n            // distance = (distance / Math.tan(0.5 * camera.camera.fov * Math.PI / 180.0));\n            // // extra space\n            // distance = distance * 1.1 + 1;\n\n            // VeryEngine.viewCamera.position.copyFrom(selection);\n            editor.call('camera:focus', selection, 300);\n        });\n\n        editor.method('selection:aabb', function () {\n            if (editor.call('selector:type') !== 'entity')\n                return null;\n\n            return editor.call('entities:aabb', editor.call('selector:items'));\n        });\n\n        // TODO: 当前以物体位置简单处理，distance参数也是固定的\n        editor.method('entities:aabb', function (items: Observer[]) {\n            if (!items)\n                return null;\n            if (!(items instanceof Array))\n                items = [items];\n\n            if (items[items.length - 1].node) {\n                return items[items.length - 1].node.getAbsolutePosition().clone();\n            } else {\n                return null;\n            }\n\n            // aabb.center.set(0, 0, 0);\n            // aabb.halfExtents.copy(defaultSizeSmall);\n\n            // // calculate aabb for selected entities\n            // for (var i = 0; i < items.length; i++) {\n            //     var entity = items[i].entity;\n\n            //     if (!entity)\n            //         continue;\n\n            //     aabbA.center.copy(entity.getPosition());\n            //     aabbA.halfExtents.copy(defaultSizeSmall);\n            //     calculateChildAABB(entity);\n\n            //     if (i === 0) {\n            //         aabb.copy(aabbA);\n            //     } else {\n            //         aabb.add(aabbA);\n            //     }\n            // }\n\n            // return aabb;\n        });\n\n\n\n    }\n\n\n\n}","export class Cameras {\n\n    public constructor() {\n\n    }\n\n}","export * from './cameras';\nexport * from './camera-viewport';\nexport * from './camera-userdata';\nexport * from './camera-depth';\nexport * from './camera-preview';\nexport * from './keeper';","import { Cameras } from \"./cameras\";\nimport { CameraDepth } from \"./camera-depth\";\nimport { CameraPreview } from \"./camera-preview\";\nimport { CameraUserdata } from \"./camera-userdata\";\nimport { CameraViewport } from \"./camera-viewport\";\n\nexport class CameraKeeper {\n\n    public constructor() {\n\n        new Cameras();\n        new CameraViewport();\n        // new CameraUserdata();\n        // new CameraDepth();\n        new CameraPreview();\n\n    }\n\n\n}","export class Drop {\n    public constructor() {\n\n        // overlay\n        var overlay = document.createElement('div');\n        overlay.classList.add('drop-overlay');\n        editor.call('layout.root').append(overlay);\n\n        // var imgDrag = new Image();\n        // // imgDrag.src = 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAACWCAYAAAAfduJyAAAAFUlEQVQoU2NkYGBgYBwlRsNgJKQDAOAfAJflUZweAAAAAElFTkSuQmCC';\n        // // imgDrag.style.display = 'none';\n\n        var parts = ['top', 'right', 'bottom', 'left'];\n        var partsElement: HTMLElement[] = [];\n        for (var i = 0; i < parts.length; i++) {\n            var part = document.createElement('div');\n            part.classList.add('drop-overlay-hole-part', parts[i]);\n            editor.call('layout.root').append(part);\n            partsElement.push(part);\n        }\n\n        // areas\n        var areas = document.createElement('div');\n        areas.classList.add('drop-areas');\n        editor.call('layout.root').append(areas);\n\n        var active: boolean = false;\n        var currentType = '';\n        var currentData = {};\n        var currentElement = null;\n        var dragOver = false;\n        var items: any = [];\n        var itemOver: Nullable<HTMLElement> = null;\n\n        var activate = function (state: boolean) {\n            if (!editor.call('permissions:write'))\n                return;\n\n            if (active === state)\n                return;\n\n            active = state;\n\n            if (active) {\n                overlay.classList.add('active');\n                areas.classList.add('active');\n                editor.call('cursor:set', 'grabbing');\n            } else {\n                overlay.classList.remove('active');\n                areas.classList.remove('active');\n                dragOver = false;\n                currentType = '';\n                currentData = {};\n                editor.emit('drop:set', currentType, currentData);\n                editor.call('cursor:clear');\n            }\n\n            var onMouseUp = function () {\n                window.removeEventListener('mouseup', onMouseUp);\n                activate(false);\n            };\n            window.addEventListener('mouseup', onMouseUp, false);\n\n            editor.emit('drop:active', active);\n        };\n\n        editor.method('drop:activate', activate);\n        editor.method('drop:active', function () {\n            return active;\n        });\n\n        // prevent drop file of redirecting\n        window.addEventListener('dragenter', function (evt) {\n            evt.preventDefault();\n\n            // console.log('dragenter');\n\n            if (!editor.call('permissions:write'))\n                return;\n\n            if (dragOver) return;\n            dragOver = true;\n\n            if (!currentType) {\n                currentType = 'files';\n                editor.emit('drop:set', currentType, currentData);\n            }\n\n            activate(true);\n        }, false);\n\n        window.addEventListener('dragover', function (evt: DragEvent) {\n            evt.preventDefault();\n\n            // console.log('dragover');\n\n            if (!editor.call('permissions:write'))\n                return;\n\n            evt.dataTransfer!.dropEffect = 'move';\n\n            if (dragOver) return;\n            dragOver = true;\n\n            activate(true);\n        }, false);\n\n        window.addEventListener('dragleave', function (evt) {\n            evt.preventDefault();\n\n            // console.log('dragleave');\n\n            if (evt.clientX !== 0 || evt.clientY !== 0)\n                return;\n\n            if (!editor.call('permissions:write'))\n                return;\n\n            if (!dragOver) return;\n            dragOver = false;\n\n            setTimeout(function () {\n                if (dragOver)\n                    return;\n\n                activate(false);\n            }, 0);\n        }, false);\n\n        window.addEventListener('drop', function (evt) {\n\n            evt.preventDefault();\n\n            // console.log('drop');\n\n            activate(false);\n        }, false);\n\n        var evtDragOver = function (e: DragEvent | MouseEvent) {\n            e.preventDefault();\n            e.stopPropagation();\n            (<HTMLElement>e.target).classList.add('over');\n\n            if (itemOver && itemOver !== e.target)\n                evtDragLeave.call(itemOver, e);\n\n            itemOver = <HTMLElement>e.target;\n\n            if (itemOver._ref && itemOver._ref.over && currentType) {\n                var data = currentData;\n                if (currentType == 'files' && (<DragEvent>e).dataTransfer)\n                    data = (<DragEvent>e).dataTransfer!.files;\n                itemOver._ref.over(currentType, data);\n            }\n        };\n\n        var evtDragLeave = function (e: DragEvent | MouseEvent) {\n            if (e) e.preventDefault();\n            (<HTMLElement>e.target).classList.remove('over');\n\n            let that: HTMLElement = <HTMLElement>e.target;\n\n            if (that._ref && that._ref.leave && currentType)\n                that._ref.leave();\n\n            if (itemOver === <HTMLElement>e.target)\n                itemOver = null;\n        };\n\n        var fixChromeFlexBox = function (item: HTMLElement) {\n            // workaround for chrome\n            // for z-index + flex-grow weird reflow bug\n            // need to force reflow in next frames\n\n            // if (!window.chrome)\n            //     return;\n\n            // 不准确，这个参数用户可修改\n            if (window.navigator.userAgent.indexOf('Chrome') < 0) {\n                return;\n            }\n\n            // if (window.MessageEvent && !document.getBoxObjectFor)\n            //     return;\n\n            // only for those who have flexgrow\n            var flex = item.style.flexGrow;\n            if (flex) {\n                // changing overflow triggers reflow\n                var overflow = item.style.overflow;\n                item.style.overflow = 'hidden';\n                // need to skip 2 frames, 1 is not enough\n                requestAnimationFrame(function () {\n                    requestAnimationFrame(function () {\n                        // change back to what it was\n                        item.style.overflow = overflow;\n                    });\n                });\n            }\n        };\n\n        editor.method('drop:target', function (obj: IDrop) {\n            // console.log('drop:target');\n\n            items.push(obj);\n            obj.element = document.createElement('div');\n            obj.element._ref = obj;\n            obj.element.classList.add('drop-area');\n            if (obj.hole)\n                obj.element.classList.add('hole');\n\n            if (obj.passThrough)\n                obj.element.style.pointerEvents = 'none';\n\n            areas.appendChild(obj.element);\n\n            obj.evtDrop = function (e: DragEvent | MouseEvent) {\n                e.preventDefault();\n\n                // console.log('obj.evtDrop');\n\n                if (!currentType)\n                    return;\n\n                // leave event\n                if (obj.element!.classList.contains('over')) {\n                    if (obj.leave && currentType) obj.leave();\n                    obj.element!.classList.remove('over');\n                }\n\n                var data = currentData;\n                if (currentType == 'files' && (<DragEvent>e).dataTransfer)\n                    data = (<DragEvent>e).dataTransfer!.files;\n\n                // console.log(currentType);\n                // console.log(data);\n                if (obj.drop)\n                    obj.drop(currentType, data);\n            };\n\n            obj.element.addEventListener('dragenter', evtDragOver, false);\n            obj.element.addEventListener('mouseenter', evtDragOver, false);\n\n            obj.element.addEventListener('dragleave', evtDragLeave, false);\n            obj.element.addEventListener('mouseleave', evtDragLeave, false);\n\n            var dropOn = obj.element;\n            if (obj.passThrough)\n                dropOn = obj.ref!;\n\n            dropOn.addEventListener('drop', obj.evtDrop, false);\n            dropOn.addEventListener('mouseup', obj.evtDrop, false);\n\n            obj.unregister = function () {\n                if (!obj.element!.classList.contains('drop-area'))\n                    return;\n\n                obj.element!.removeEventListener('dragenter', evtDragOver);\n                obj.element!.removeEventListener('mouseenter', evtDragOver);\n\n                obj.element!.removeEventListener('dragleave', evtDragLeave);\n                obj.element!.removeEventListener('mouseleave', evtDragLeave);\n\n                dropOn.removeEventListener('drop', obj.evtDrop!);\n                dropOn.removeEventListener('mouseup', obj.evtDrop!);\n\n                var ind = items.indexOf(obj);\n                if (ind !== -1)\n                    items.splice(ind, 1);\n\n                if (obj.ref!.classList.contains('drop-ref-highlight')) {\n                    obj.ref!.classList.remove('drop-ref-highlight');\n                    fixChromeFlexBox(obj.ref!);\n                }\n\n                obj.element!.classList.remove('drop-area');\n                areas.removeChild(obj.element!);\n            };\n\n            return obj;\n        });\n\n        editor.method('drop:item', function (args: any) {\n            args.element.draggable = true;\n\n            // console.log('drop:item');\n\n            args.element.addEventListener('mousedown', function (evt: MouseEvent) {\n                evt.stopPropagation();\n            }, false);\n\n            args.element.addEventListener('dragstart', function (evt: DragEvent) {\n                evt.preventDefault();\n                evt.stopPropagation();\n\n                if (!editor.call('permissions:write'))\n                    return;\n\n                currentType = args.type;\n                currentData = args.data;\n                itemOver = null;\n                editor.emit('drop:set', currentType, currentData);\n\n                activate(true);\n            }, false);\n        });\n\n        editor.method('drop:set', function (type: string, data: any) {\n            currentType = type || '',\n                currentData = data || {};\n\n            // console.log('drop:set');\n\n            editor.emit('drop:set', currentType, currentData);\n        });\n\n\n        editor.on('drop:active', function (state: boolean) {\n            areas.style.pointerEvents = '';\n\n            // console.log('drop:active +' + state);\n\n            if (state) {\n                var bottom = 0;\n                var top = window.innerHeight;\n                var left = window.innerWidth;\n                var right = 0;\n\n                for (var i = 0; i < items.length; i++) {\n                    var visible = !items[i].disabled;\n\n                    // console.log('visible: ' + visible);\n                    // console.log('currentType: ' + currentType);\n                    // console.log(currentData);\n\n                    if (visible) {\n                        if (items[i].filter) {\n                            visible = items[i].filter(currentType, currentData);\n                        } else if (items[i].type !== currentType) {\n                            visible = false;\n                        }\n                    }\n                    // console.log('visible: ' + visible);\n\n                    if (visible) {\n                        var rect = items[i].ref.getBoundingClientRect();\n                        var depth = 4;\n                        var parent = items[i].ref;\n                        while (depth--) {\n                            if (!rect.width || !rect.height || !parent.offsetHeight || window.getComputedStyle(parent).getPropertyValue('visibility') === 'hidden') {\n                                visible = false;\n                                break;\n                            }\n                            parent = parent.parentNode;\n                        }\n                    }\n\n                    if (visible) {\n                        items[i].element.style.display = 'block';\n\n                        if (items[i].hole) {\n                            items[i].element.style.left = (rect.left + 2) + 'px';\n                            items[i].element.style.top = (rect.top + 2) + 'px';\n                            items[i].element.style.width = (rect.width - 4) + 'px';\n                            items[i].element.style.height = (rect.height - 4) + 'px';\n\n                            overlay.classList.remove('active');\n\n                            if (top > rect.top)\n                                top = rect.top;\n\n                            if (bottom < rect.bottom)\n                                bottom = rect.bottom;\n\n                            if (left > rect.left)\n                                left = rect.left;\n\n                            if (right < rect.right)\n                                right = rect.right;\n\n                            partsElement[0].classList.add('active');\n                            partsElement[0].style.height = top + 'px';\n\n                            partsElement[1].classList.add('active');\n                            partsElement[1].style.top = top + 'px';\n                            partsElement[1].style.bottom = (window.innerHeight - bottom) + 'px';\n                            partsElement[1].style.width = (window.innerWidth - right) + 'px';\n\n                            partsElement[2].classList.add('active');\n                            partsElement[2].style.height = (window.innerHeight - bottom) + 'px';\n\n                            partsElement[3].classList.add('active');\n                            partsElement[3].style.top = top + 'px';\n                            partsElement[3].style.bottom = (window.innerHeight - bottom) + 'px';\n                            partsElement[3].style.width = left + 'px';\n\n                            if (items[i].passThrough)\n                                areas.style.pointerEvents = 'none';\n                        } else {\n                            items[i].element.style.left = (rect.left + 1) + 'px';\n                            items[i].element.style.top = (rect.top + 1) + 'px';\n                            items[i].element.style.width = (rect.width - 2) + 'px';\n                            items[i].element.style.height = (rect.height - 2) + 'px';\n                            items[i].ref.classList.add('drop-ref-highlight');\n                        }\n                    } else {\n                        items[i].element.style.display = 'none';\n\n                        if (items[i].ref.classList.contains('drop-ref-highlight')) {\n                            items[i].ref.classList.remove('drop-ref-highlight');\n                            fixChromeFlexBox(items[i].ref);\n                        }\n                    }\n                }\n            } else {\n                for (var i = 0; i < parts.length; i++)\n                    partsElement[i].classList.remove('active');\n\n                for (var i = 0; i < items.length; i++) {\n                    if (!items[i].ref.classList.contains('drop-ref-highlight'))\n                        continue;\n\n                    items[i].ref.classList.remove('drop-ref-highlight');\n                    fixChromeFlexBox(items[i].ref);\n                }\n            }\n        });\n\n\n    }\n}\n\nexport interface IDrop {\n    ref?: HTMLElement;\n    type?: string;\n    hole?: boolean;\n    passThrough?: boolean;\n    filter?: (type: string, data: any) => boolean;\n    drop?: (type: string, data: any) => void;\n    over?: (type: string, data: any) => void;\n    leave?: () => void;\n    element?: HTMLElement;\n    evtDrop?: (e: DragEvent | MouseEvent) => void;\n    unregister?: () => void;\n}","import { Events } from '../lib';\n\nexport class Editor extends Events {\n\n  // 相较于Events，同一个函数名只可代表一个函数；\n\n  // 某个name对应的某个事件，name与Function是1对1的关系；\n  private _hooks: { [key: string]: Function } = {};\n\n  public constructor() {\n    super();\n  }\n\n  /**\n   * 添加全局函数，函数名与函数本体一一对应，不能重名；\n   * @param name 函数名；\n   * @param fn 函数本体；\n   */\n  public method(name: string, fn: Function): void {\n    if (this._hooks[name] !== undefined) {\n      throw new Error(\"can't override hook: \" + name);\n    }\n    this._hooks[name] = fn;\n  };\n\n  /**\n   * 移除某个函数；\n   * @param name 函数名；\n   */\n  public methodRemove(name: string): void {\n    delete this._hooks[name];\n  };\n\n  /**\n   * 执行某个函数；\n   * @param name 函数名；\n   */\n  public call(name: string, ...args: any[]): any {\n    if (this._hooks[name]) {\n      var args = Array.prototype.slice.call(arguments, 1);\n\n      try {\n        return this._hooks[name].apply(null, args);\n      } catch (ex) {\n        console.error(\n          \"%c%s %c(editor.method error)\",\n          \"color: #06f\",\n          name,\n          \"color: #f00\"\n        );\n        console.error(ex.stack);\n      }\n    }\n    return null;\n  };\n}","import { Entity } from \"./entity\";\nimport { GameObject, ResourceContainer } from \"../middleware\";\nimport { Observer, ObserverList } from \"../../lib\";\n\nexport class Entities {\n    public lists: Entity[] = [];\n    private _indexed: { [key: string]: Entity } = {};\n\n    private container: ResourceContainer;\n\n    public constructor() {\n        this.container = new ResourceContainer();\n\n\n\n        var entities = new ObserverList({\n            id: 'resource_id'\n        });\n\n        var entityRoot: Nullable<Observer> = null;\n\n        // on adding\n        entities.on('add', function (entity: Observer) {\n            editor.emit('entities:add', entity, entity === entityRoot);\n        });\n\n        // on removing\n        entities.on('remove', function (entity: Observer) {\n            editor.emit('entities:remove', entity);\n            entity.destroy();\n            // entity.entity = null;\n        });\n\n        // allow adding entity\n        editor.method('entities:add', function (entity: Observer) {\n            if (entity.get('root'))\n                entityRoot = entity;\n\n            entities.add(entity);\n        });\n\n        // allow remove entity\n        editor.method('entities:remove', function (entity: Observer) {\n            entities.remove(entity);\n        });\n\n        // remove all entities\n        editor.method('entities:clear', function () {\n            entities.clear();\n        });\n\n        // get entity\n        editor.method('entities:get', function (resourceId: string) {\n            return entities.get(resourceId);\n        });\n\n\n        // list entities\n        editor.method('entities:list', function () {\n            return entities.array();\n        });\n\n\n        // get root entity\n        editor.method('entities:root', function () {\n            return entityRoot;\n        });\n\n\n\n\n\n    }\n\n    // 1.建立基本的数据格式；\n    // 2.串联hierarchy，包括基本的菜单；\n    // 3.尝试建立property；\n    // 4.串联Assets结构与UI；\n\n    public addRaw(entity_data: any): void {\n        // console.log('***entity-data***');\n        // console.log(entity_data);\n\n        // 目标，创建babylon scene资源\n        // Editor模式和Publish模式有何异同？\n        // Editor需要有一个Observer的中间层，需要建立层级关系，需要记录增改删除操作\n        // Publish可以从scene数据直接加载资源即可；\n\n        let gameObject = this.createGameObject(entity_data);\n\n\n        // add component\n\n        // children\n\n        // parent\n\n        this.container.addGameObject(gameObject);\n    }\n\n    public addEntity(entity: Observer): void {\n\n    }\n\n\n    private create(entity: Observer): GameObject {\n\n        let type: string = entity.get('type');\n        type = type.toLowerCase();\n        if (type === 'root') {\n            // 不需要生成\n\n        } else if (type === 'mesh') {\n            // 模型\n\n            // 首先加载数据，生成babylon mesh数据结构\n            // 提取地址，http或者其他方式加载\n            // Http下载，加入回调函数处理，查看babylon默认的处理方式；\n            // scenes数据如何从Assets数据中拿数据，到babylon中间件中寻找缓存\n\n        } else if (type === 'empty') {\n            // 空物体\n\n        } else if (type === 'camera') {\n            // node作为父物体\n\n        } else if (type === 'light') {\n            // node作为父物体\n\n        } else if (type === 'particle') {\n            // 貌似没有相对应的结构\n\n        } else if (type === 'sprite') {\n            // 貌似没有相对应的结构\n\n\n        }\n\n\n        // 根据要求生成GameObject\n        let instance = new GameObject(entity.get('name'));\n\n        return instance;\n    }\n\n    private createGameObject(entity: any): GameObject {\n        // TODO: 解析是node还是mesh\n        // 设置name\n        let instance = new GameObject(entity.name);\n        // 设置guid\n        instance.guid = entity.resource_id;\n\n        // 设置位置\n        // 设置角度\n        // 设置比例值\n        // 设置enable ? 不存在的情况\n        instance.setActive(entity.enabled);\n        // 设置visiable\n\n        // 设置tags\n\n        return instance;\n    }\n\n    public add(item: Entity): void { }\n\n    public has(item: Entity): boolean {\n        return false;\n    }\n\n    public set(index: string, item: Entity): void { }\n\n    public get(index: string): Nullable<Entity> {\n        return this._indexed[index];\n    }\n\n    public indexOf(item: Entity): number {\n        return this.lists.indexOf(item);\n    }\n}\n","import { VeryEngine } from '../../engine';\nimport { Observer } from '../../lib';\nimport { GUIManager } from '../gui';\nimport { GUID, Tools } from '../utility';\n\nexport class EntityCreate {\n\n\n    public constructor() {\n\n        var createNewEntityData = function (defaultData: any, parentResourceId: string) {\n            var entityData = {\n                name: defaultData.name || '空物体',\n                tags: [],\n                enabled: true,\n                resource_id: defaultData.resource_id || GUID.create(),\n                parent: parentResourceId,\n                children: Array<string>(),\n                position: defaultData.position || [0, 0, 0],\n                rotation: defaultData.rotation || [0, 0, 0],\n                scale: defaultData.scale || [1, 1, 1],\n                // components: defaultData.components || {},\n                // __postCreationCallback: defaultData.postCreationCallback,\n                root: false,\n                type: defaultData.type,\n                asset: defaultData.asset || ''\n            };\n\n            // if (defaultData.children) {\n            //     for (var i = 0; i < defaultData.children.length; i++) {\n            //         var childEntityData = createNewEntityData(defaultData.children[i], entityData.resource_id);\n            //         entityData.children.push(childEntityData);\n            //     }\n            // }\n\n            return entityData;\n        };\n\n\n        editor.method('entity:new:babylon', (defaultData: any) => {\n            defaultData = defaultData || {};\n            // var parent = defaultData.parent;\n            // var parent = editor.call('entities:root');\n\n            // if (parent === '' || parent === undefined) {\n            //     parent = editor.call('entities:root').get('resource_id');\n            // }\n\n            // console.log(editor.call('entities:root'));\n            // console.log(defaultData.parent);\n            // console.log(defaultData);\n\n            // var data = createNewEntityData(defaultData, parent.get('resource_id'));\n\n            // create new Entity data\n            var entity = new Observer(defaultData);\n\n            editor.call('entities:add', entity);\n            // editor.call('entities:addEntity', entity, parent, !defaultData.noSelect);\n\n            return entity;\n        });\n\n        editor.method('entities:new', function (defaultData: any) {\n            // get root if parent is null\n            defaultData = defaultData || {};\n            // var parent = defaultData.parent || editor.call('entities:root');\n\n            // TODO: 一堆mesh过来，有的创建了，有的没创建怎么办\n            var parent = editor.call('entities:get', defaultData.parent) || editor.call('entities:root');\n\n            // var data = createNewEntityData(defaultData, parent.get('resource_id'));\n\n            var selectorType: string, selectorItems: Observer[];\n\n            if (!defaultData.noHistory) {\n                selectorType = editor.call('selector:type');\n                selectorItems = editor.call('selector:items');\n                if (selectorType === 'entity') {\n                    // TODO\n                    for (var i = 0; i < selectorItems.length; i++)\n                        selectorItems[i] = selectorItems[i].get('resource_id');\n                }\n            }\n\n            // create new Entity data\n            // console.error(defaultData);\n            var entity = new Observer(defaultData);\n\n            editor.call('entities:addEntity', entity, parent, !defaultData.noSelect);\n            // console.error(entity);\n            // history\n            if (!defaultData.noHistory) {\n                var resourceId = entity.get('resource_id');\n                var parentId = parent.get('resource_id');\n\n                editor.call('history:add', {\n                    name: 'new entity ' + resourceId,\n                    undo: function () {\n                        var entity = editor.call('entities:get', resourceId);\n                        if (!entity)\n                            return;\n\n                        editor.call('entities:removeEntity', entity);\n\n                        if (selectorType === 'entity' && selectorItems.length) {\n                            var items = [];\n                            for (var i = 0; i < selectorItems.length; i++) {\n                                var item = editor.call('entities:get', selectorItems[i]);\n                                if (item)\n                                    items.push(item);\n                            }\n\n                            if (items.length) {\n                                editor.call('selector:history', false);\n                                editor.call('selector:set', selectorType, items);\n                                editor.once('selector:change', function () {\n                                    editor.call('selector:history', true);\n                                });\n                            }\n                        }\n                    },\n                    redo: function () {\n                        var parent = editor.call('entities:get', parentId);\n                        if (!parent)\n                            return;\n\n                        // var entity = new Observer(data);\n                        var entity = new Observer(defaultData);\n                        editor.call('entities:addEntity', entity, parent, true);\n                    }\n                });\n            }\n\n            return entity;\n        });\n\n        editor.method('entities:editor:new', function (defaultData: any) {\n\n            defaultData = defaultData || {};\n\n            // console.log('type: ' + defaultData.type);\n            // console.warn(defaultData.parent);\n\n            let parent = defaultData.parent || editor.call('entities:root');\n\n            if (defaultData.type) {\n\n                let entityData = createEntityDataFromEditor(defaultData.type, defaultData.subtype, parent.get('resource_id'));\n                var entity = new Observer(entityData);\n                let instance = createEntityInstance(defaultData.type, defaultData.subtype, entity);\n\n                editor.call('entities:addEntity', entity, parent, !defaultData.noSelect);\n\n                editor.call('selector:set', 'entity', [entity]);\n\n                // if (defaultData.type === 'empty') {\n\n                // } else if (defaultData.type === 'primitive') {\n                //     if (defaultData.subtype === 'box') {\n\n                //     } else if (defaultData.subtype === 'sphere') {\n\n                //     } else if (defaultData.subtype === 'plane') {\n\n                //     } else if (defaultData.subtype === 'cylinder') {\n\n                //     }\n                // } else if (defaultData.type === 'light') {\n                //     if (defaultData.subtype === 'hemispheric') {\n\n                //     } else if (defaultData.subtype === 'directional') {\n\n                //     } else if (defaultData.subtype === 'point') {\n\n                //     } else if (defaultData.subtype === 'spot') {\n\n                //     }\n                // } else if (defaultData.type === 'camera') {\n\n                // }\n            }\n\n\n        });\n\n\n        let typeToName: { [key: string]: string } = {\n            'empty': '空物体',\n            'box': '立方体',\n            'sphere': '球体',\n            'plane': '平面',\n            'cylinder': '圆柱体',\n            'hemispheric': '环境光',\n            'directional': '平行光',\n            'point': '点光源',\n            'spot': '聚光灯',\n            'camera': '摄像机'\n        }\n\n\n        let createEntityDataFromEditor = (type: string, subtype: string, parentResourceId: string) => {\n\n            var entityData: { [key: string]: any } = {\n                name: typeToName[type] || typeToName[subtype] || '空物体',\n                type: type,\n                subtype: subtype,\n                resource_id: GUID.create(),\n                parent: parentResourceId,\n                position: [0, 0, 0],\n                rotation: [0, 0, 0],\n                scale: [1, 1, 1],\n                enabled: true,\n                tags: Array<string>(),\n                children: Array<string>(),\n            };\n\n            if (type === 'primitive') {\n                entityData.checkCollisions = false;\n                entityData.pickable = true;\n                entityData.isVisible = true;\n                entityData.material_id = '';\n            } else if (type === 'light') {\n                entityData.position = [300, 300, 300];\n                if (subtype === 'directional') {\n                    entityData.rotation = [50, -30, 0];\n                }\n            } else if (type === 'camera') {\n                entityData.position = [0, 100, -200];\n                entityData.mode = 0;\n                entityData.fov = 0.8;\n                entityData.inertia = 0.9;\n                entityData.orthoSize = 0.5;\n                entityData.ellipsoid = [0.5, 1, 0.5];\n                entityData.ellipsoidOffset = [0, 0, 0];\n                entityData.checkCollisions = true;\n                entityData.applyGravity = true;\n                entityData.minZ = 1;\n                entityData.maxZ = 20000;\n                entityData.priority = 0;\n                entityData.viewport = [0, 0, 1, 1];\n                entityData.clearColor = [0.176, 0.569, 0.729, 1];\n            }\n\n            return entityData;\n        }\n\n        let createEntityInstance = (type: string, subtype: string, entity: Observer) => {\n\n            if (type === 'empty') {\n                let empty = new BABYLON.TransformNode(entity.get('name'), VeryEngine.viewScene);\n                entity.node = empty;\n                empty.id = entity.get('resource_id');\n                empty.position = BABYLON.Vector3.FromArray(entity.get('position'));\n                empty.rotation = Tools.eulerAngleToRadian(BABYLON.Vector3.FromArray(entity.get('rotation')));\n                empty.scaling = BABYLON.Vector3.FromArray(entity.get('scale'));\n                empty.isEnabled(entity.get('enabled'));\n                return empty;\n            } else if (type === 'primitive') {\n                if (subtype === 'box') {\n                    var box = BABYLON.MeshBuilder.CreateBox(entity.get('name'), { size: 100 }, VeryEngine.viewScene);\n                    entity.node = box;\n                    box.id = entity.get('resource_id');\n                    box.position = BABYLON.Vector3.FromArray(entity.get('position'));\n                    box.rotation = Tools.eulerAngleToRadian(BABYLON.Vector3.FromArray(entity.get('rotation')));\n                    box.scaling = BABYLON.Vector3.FromArray(entity.get('scale'));\n                    if (entity.has('checkCollisions')) {\n                        box.checkCollisions = entity.get('checkCollisions');\n                    }\n                    if (entity.has('pickable')) {\n                        box.isPickable = entity.get('pickable');\n                    }\n                    if (entity.has('isVisible')) {\n                        box.isVisible = entity.get('isVisible');\n                    }\n                    return box;\n                } else if (subtype === 'sphere') {\n                    var sphere = BABYLON.MeshBuilder.CreateSphere(entity.get('name'), { segments: 20, diameter: 100 }, VeryEngine.viewScene);\n                    entity.node = sphere;\n                    sphere.id = entity.get('resource_id');\n                    sphere.position = BABYLON.Vector3.FromArray(entity.get('position'));\n                    sphere.rotation = Tools.eulerAngleToRadian(BABYLON.Vector3.FromArray(entity.get('rotation')));\n                    sphere.scaling = BABYLON.Vector3.FromArray(entity.get('scale'));\n                    if (entity.has('checkCollisions')) {\n                        sphere.checkCollisions = entity.get('checkCollisions');\n                    }\n                    if (entity.has('pickable')) {\n                        sphere.isPickable = entity.get('pickable');\n                    }\n                    if (entity.has('isVisible')) {\n                        sphere.isVisible = entity.get('isVisible');\n                    }\n                    return sphere;\n                } else if (subtype === 'plane') {\n                    var plane = BABYLON.MeshBuilder.CreateGround(entity.get('name'), { width: 5000, height: 5000, subdivisions: 10 }, VeryEngine.viewScene);\n                    entity.node = plane;\n                    plane.id = entity.get('resource_id');\n                    plane.position = BABYLON.Vector3.FromArray(entity.get('position'));\n                    plane.rotation = Tools.eulerAngleToRadian(BABYLON.Vector3.FromArray(entity.get('rotation')));\n                    plane.scaling = BABYLON.Vector3.FromArray(entity.get('scale'));\n                    if (entity.has('checkCollisions')) {\n                        plane.checkCollisions = entity.get('checkCollisions');\n                    }\n                    if (entity.has('pickable')) {\n                        plane.isPickable = entity.get('pickable');\n                    }\n                    if (entity.has('isVisible')) {\n                        plane.isVisible = entity.get('isVisible');\n                    }\n                    return plane;\n                } else if (subtype === 'cylinder') {\n                    var cylinder = BABYLON.MeshBuilder.CreateCylinder(entity.get('name'), { height: 200, diameter: 100 }, VeryEngine.viewScene);\n                    entity.node = cylinder;\n                    cylinder.id = entity.get('resource_id');\n                    cylinder.position = BABYLON.Vector3.FromArray(entity.get('position'));\n                    cylinder.rotation = Tools.eulerAngleToRadian(BABYLON.Vector3.FromArray(entity.get('rotation')));\n                    cylinder.scaling = BABYLON.Vector3.FromArray(entity.get('scale'));\n                    if (entity.has('checkCollisions')) {\n                        cylinder.checkCollisions = entity.get('checkCollisions');\n                    }\n                    if (entity.has('pickable')) {\n                        cylinder.isPickable = entity.get('pickable');\n                    }\n                    if (entity.has('isVisible')) {\n                        cylinder.isVisible = entity.get('isVisible');\n                    }\n                    return cylinder;\n                }\n            }\n            return null;\n        }\n\n        editor.method('entities:2D-GUI:new', function (defaultData: any) {\n\n            defaultData = defaultData || {};\n\n            // console.log('type: ' + defaultData.type);\n            // console.warn(defaultData.parent);\n\n            let parent = defaultData.parent || editor.call('entities:root');\n\n            // 若为root\n            // // 若为sub root\n            // 直接创建sub root；\n            // // 若为其他element\n            if (parent.get('type') === 'root') {\n                if (defaultData.subtype === 'root') {\n                    let entityData = createEntityDataFor2DGUI(defaultData.type, defaultData.subtype, parent.get('resource_id'));\n                    var entity = new Observer(entityData);\n                    let instance = create2DGUIEntityInstance(defaultData.type, defaultData.subtype, entity);\n\n                    editor.call('entities:addEntity', entity, parent, !defaultData.noSelect);\n\n                    editor.call('selector:set', 'entity', [entity]);\n                } else {\n                    // 其他ui元素\n                    let activeCanvas = GUIManager.getActiveCanvas();\n                    if (activeCanvas) {\n                        let id = GUIManager.getActiveID();\n                        let newParent = editor.call('entities:get', id);\n                        let entityData = createEntityDataFor2DGUI(defaultData.type, defaultData.subtype, newParent.get('resource_id'));\n                        var entity = new Observer(entityData);\n                        let instance = create2DGUIEntityInstance(defaultData.type, defaultData.subtype, entity);\n\n                        editor.call('entities:addEntity', entity, newParent, !defaultData.noSelect);\n\n                        editor.call('selector:set', 'entity', [entity]);\n                    } else {\n                        // 先创建canvas\n                        editor.call('entities:2D-GUI:new', { parent: editor.call('entities:root'), type: '2d-gui', subtype: 'root' });\n                        let activeCanvas = GUIManager.getActiveCanvas();\n                        let id = GUIManager.getActiveID();\n                        let newParent = editor.call('entities:get', id);\n                        let entityData = createEntityDataFor2DGUI(defaultData.type, defaultData.subtype, newParent.get('resource_id'));\n                        var entity = new Observer(entityData);\n                        let instance = create2DGUIEntityInstance(defaultData.type, defaultData.subtype, entity);\n\n                        editor.call('entities:addEntity', entity, newParent, !defaultData.noSelect);\n\n                        editor.call('selector:set', 'entity', [entity]);\n                    }\n                }\n            } else {\n                if (defaultData.subtype === 'root') {\n                    let newParent = editor.call('entities:root');\n                    let entityData = createEntityDataFor2DGUI(defaultData.type, defaultData.subtype, newParent.get('resource_id'));\n                    var entity = new Observer(entityData);\n                    let instance = create2DGUIEntityInstance(defaultData.type, defaultData.subtype, entity);\n\n                    editor.call('entities:addEntity', entity, newParent, !defaultData.noSelect);\n\n                    editor.call('selector:set', 'entity', [entity]);\n                } else {\n                    if (parent.node instanceof BABYLON.Node) {\n                        // 其他ui元素\n                        let activeCanvas = GUIManager.getActiveCanvas();\n                        if (activeCanvas) {\n                            let id = GUIManager.getActiveID();\n                            let newParent = editor.call('entities:get', id);\n                            let entityData = createEntityDataFor2DGUI(defaultData.type, defaultData.subtype, newParent.get('resource_id'));\n                            var entity = new Observer(entityData);\n                            let instance = create2DGUIEntityInstance(defaultData.type, defaultData.subtype, entity);\n\n                            editor.call('entities:addEntity', entity, newParent, !defaultData.noSelect);\n\n                            editor.call('selector:set', 'entity', [entity]);\n                        } else {\n                            // 先创建canvas\n                            editor.call('entities:2D-GUI:new', { parent: editor.call('entities:root'), type: '2d-gui', subtype: 'root' });\n                            let activeCanvas = GUIManager.getActiveCanvas();\n                            let id = GUIManager.getActiveID();\n                            let newParent = editor.call('entities:get', id);\n                            let entityData = createEntityDataFor2DGUI(defaultData.type, defaultData.subtype, newParent.get('resource_id'));\n                            var entity = new Observer(entityData);\n                            let instance = create2DGUIEntityInstance(defaultData.type, defaultData.subtype, entity);\n\n                            editor.call('entities:addEntity', entity, newParent, !defaultData.noSelect);\n\n                            editor.call('selector:set', 'entity', [entity]);\n                        }\n                    } else if (parent.node instanceof BABYLON.GUI.AdvancedDynamicTexture) {\n                        let entityData = createEntityDataFor2DGUI(defaultData.type, defaultData.subtype, parent.get('resource_id'));\n                        var entity = new Observer(entityData);\n                        let instance = create2DGUIEntityInstance(defaultData.type, defaultData.subtype, entity);\n\n                        editor.call('entities:addEntity', entity, parent, !defaultData.noSelect);\n\n                        editor.call('selector:set', 'entity', [entity]);\n                    } else if (parent.node instanceof BABYLON.GUI.Control) {\n                        if (parent.node instanceof BABYLON.GUI.Rectangle && !(parent.node instanceof BABYLON.GUI.Button)) {\n                            let entityData = createEntityDataFor2DGUI(defaultData.type, defaultData.subtype, parent.get('resource_id'));\n                            var entity = new Observer(entityData);\n                            let instance = create2DGUIEntityInstance(defaultData.type, defaultData.subtype, entity);\n\n                            editor.call('entities:addEntity', entity, parent, !defaultData.noSelect);\n\n                            editor.call('selector:set', 'entity', [entity]);\n                        } else {\n                            // 获取父物体，只允许rectangle，button不允许，根据ui container元素获取entity\n                            // console.error((<BABYLON.GUI.Control>(parent.node)).parent);\n                            let container = getContainerParent(<BABYLON.GUI.Control>(parent.node));\n                            // console.warn(container);\n                            if (container) {\n                                let parentID = GUIManager.getResourceID(container.uniqueId);\n                                // console.log(parentID);\n                                if (parentID) {\n                                    let newParent = editor.call('entities:get', parentID);\n                                    if (newParent) {\n                                        let entityData = createEntityDataFor2DGUI(defaultData.type, defaultData.subtype, newParent.get('resource_id'));\n                                        var entity = new Observer(entityData);\n                                        let instance = create2DGUIEntityInstance(defaultData.type, defaultData.subtype, entity);\n\n                                        editor.call('entities:addEntity', entity, newParent, !defaultData.noSelect);\n\n                                        editor.call('selector:set', 'entity', [entity]);\n                                    }\n                                }\n                            }\n                        }\n                    } else {\n                        console.error('当前类型还未考虑');\n                        console.error(parent.node);\n                    }\n                }\n            }\n\n        });\n\n        let getContainerParent = (control: BABYLON.GUI.Control): BABYLON.GUI.Rectangle | BABYLON.GUI.AdvancedDynamicTexture | null => {\n            if (control.parent === null) return null;\n            if (control.parent instanceof BABYLON.GUI.Container && control.parent.name === 'root' && !control.parent.parent) {\n                return control.parent.host;\n            } else if (control.parent instanceof BABYLON.GUI.Rectangle && !(control.parent instanceof BABYLON.GUI.Button)) {\n                return control.parent;\n            } else {\n                return getContainerParent(control.parent!);\n            }\n        }\n\n        let typeToName2DGui: { [key: string]: string } = {\n            'root': '2D画布',\n            'panel': '容器',\n            'button': '按钮',\n            'image': '图片',\n            'text': '文字',\n            'input': '输入框',\n            'checkbox': '复选框'\n        }\n\n        let createEntityDataFor2DGUI = (type: string, subtype: string, parentResourceId: string) => {\n            var entityData: { [key: string]: any } = {\n                name: typeToName2DGui[type] || typeToName2DGui[subtype] || '2D画布',\n                type: type,\n                subtype: subtype,\n                resource_id: GUID.create(),\n                enabled: true,\n                parent: parentResourceId,\n                parent_gui: parentResourceId,\n                gui: {\n                    isVisible: true,\n                    xType: 0,\n                    x: 0,\n                    yType: 0,\n                    y: 0,\n                    widthType: 0,\n                    width: 100,\n                    heightType: 0,\n                    height: 30,\n                    scaleX: 1,\n                    scaleY: 1,\n                    horizontal_alignment: 2,\n                    vertical_alignment: 2,\n                    alpha: 1,\n                    color: [1, 1, 1, 1],\n                    rotation: 0,\n                    isHighlighted: false\n                },\n                children: Array<string>(),\n            };\n\n            if (subtype === 'root') {\n                entityData.gui.widthType = 1;\n                entityData.gui.width = 100;\n                entityData.gui.heightType = 1;\n                entityData.gui.height = 100;\n                // entityData.gui.zIndex = 0;\n            } else if (subtype === 'panel') {\n                entityData.gui.widthType = 1;\n                entityData.gui.width = 60;\n                entityData.gui.heightType = 1;\n                entityData.gui.height = 80;\n                entityData.gui.color = [1, 1, 1, 1];\n                entityData.gui.background = [1, 1, 1, 0.3922];\n                entityData.gui.thickness = 1;\n                entityData.gui.cornerRadius = 10;\n\n            } else if (subtype === 'button') {\n                entityData.gui.widthType = 0;\n                entityData.gui.width = 120;\n                entityData.gui.heightType = 0;\n                entityData.gui.height = 30;\n                entityData.gui.color = [1, 1, 1, 1];\n                entityData.gui.background = [1, 1, 1, 1];\n                entityData.gui.thickness = 1;\n                entityData.gui.cornerRadius = 4;\n                entityData.gui.text = '按钮';\n                entityData.gui.fontSize = 18;\n                entityData.gui.textColor = [0, 0, 0, 1];\n                entityData.gui.source = '';\n            } else if (subtype === 'image') {\n                entityData.gui.widthType = 0;\n                entityData.gui.width = 100;\n                entityData.gui.heightType = 0;\n                entityData.gui.height = 100;\n                entityData.gui.color = [1, 1, 1, 1];\n                entityData.gui.source = '';\n\n            } else if (subtype === 'text') {\n                entityData.gui.widthType = 0;\n                entityData.gui.width = 160;\n                entityData.gui.heightType = 0;\n                entityData.gui.height = 30;\n                entityData.gui.color = [0, 0, 0, 1];\n                entityData.gui.fontSize = 18;\n                entityData.gui.text = '文字';\n                entityData.gui.textHorizontalAlignment = 0;\n                entityData.gui.textVerticalAlignment = 2;\n                entityData.gui.textWrapping = 1;\n\n            } else if (subtype === 'input') {\n                entityData.gui.widthType = 0;\n                entityData.gui.width = 160;\n                entityData.gui.heightType = 0;\n                entityData.gui.height = 30;\n                entityData.gui.color = [0, 0, 0, 1];\n                entityData.gui.background = [1, 1, 1, 1];\n                entityData.gui.thickness = 1;\n                entityData.gui.fontSize = 18;\n                entityData.gui.placeholderColor = [0, 0, 0, 0.3922];\n                entityData.gui.placeholderText = '输入...';\n                entityData.gui.focusedBackground = [0.502, 0.502, 0.502, 1];\n                entityData.gui.text = '';\n\n            } else if (subtype === 'checkbox') {\n                entityData.gui.widthType = 0;\n                entityData.gui.width = 20;\n                entityData.gui.heightType = 0;\n                entityData.gui.height = 20;\n                entityData.gui.color = [0.502, 0.502, 0.502, 1];\n                entityData.gui.background = [1, 1, 1, 1];\n                entityData.gui.thickness = 2;\n                entityData.gui.isChecked = true;\n            }\n\n            return entityData;\n        };\n\n        let create2DGUIEntityInstance = (type: string, subtype: string, entity: Observer) => {\n\n            if (subtype === 'root') {\n                let canvas2D = BABYLON.GUI.AdvancedDynamicTexture.CreateFullscreenUI(entity.get('name'));\n                GUIManager.add2DCanvas(entity.get('resource_id'), canvas2D);\n                entity.node = canvas2D;\n                // console.log(canvas2D.uniqueId + ': ' + entity.get('resource_id'));\n                // if (entity.has('gui.zIndex')) {\n                //     canvas2D.rootContainer.zIndex = entity.get('gui.zIndex');\n                // }\n                if (entity.has('gui.isHighlighted')) {\n                    canvas2D.rootContainer.isHighlighted = entity.get('gui.isHighlighted');\n                }\n                GUIManager.addUniqueIDIndex(canvas2D.uniqueId, entity.get('resource_id'));\n                return canvas2D;\n            } else if (subtype === 'panel') {\n                let panel = new BABYLON.GUI.Rectangle(entity.get('name'));\n                entity.node = panel;\n                if (entity.has('gui.color')) {\n                    panel.color = Tools.rgba2hsvString(entity.get('gui.color'));\n                }\n                if (entity.has('gui.background')) {\n                    panel.background = Tools.rgba2hsvString(entity.get('gui.background'));\n                }\n                set2DGUITransform(panel, entity);\n                if (entity.has('gui.thickness')) {\n                    panel.thickness = entity.get('gui.thickness')\n                }\n                if (entity.has('gui.cornerRadius')) {\n                    panel.cornerRadius = entity.get('gui.cornerRadius')\n                }\n                return panel;\n            } else if (subtype === 'button') {\n                let btn = BABYLON.GUI.Button.CreateImageWithCenterTextButton(entity.get('name'), '', '');\n                entity.node = btn;\n                if (entity.has('gui.color')) {\n                    btn.color = Tools.rgba2hsvString(entity.get('gui.color'));\n                }\n                if (entity.has('gui.background')) {\n                    btn.background = Tools.rgba2hsvString(entity.get('gui.background'));\n                }\n                set2DGUITransform(btn, entity);\n                if (entity.has('gui.thickness')) {\n                    btn.thickness = entity.get('gui.thickness')\n                }\n                if (entity.has('gui.cornerRadius')) {\n                    btn.cornerRadius = entity.get('gui.cornerRadius')\n                }\n                if (entity.has('gui.text')) {\n                    btn.textBlock!.text = entity.get('gui.text')\n                }\n                if (entity.has('gui.fontSize')) {\n                    btn.fontSize = entity.get('gui.fontSize');\n                    btn.textBlock!.fontSize = entity.get('gui.fontSize');\n                }\n                if (entity.has('gui.textColor')) {\n                    btn.textBlock!.color = Tools.rgba2hsvString(entity.get('gui.textColor'));\n                }\n                return btn;\n            } else if (subtype === 'image') {\n                let img = new BABYLON.GUI.Image(entity.get('name'), '');\n                entity.node = img;\n                if (entity.has('gui.color')) {\n                    img.color = Tools.rgba2hsvString(entity.get('gui.color'));\n                }\n                set2DGUITransform(img, entity);\n                return img;\n            } else if (subtype === 'text') {\n                let text = new BABYLON.GUI.TextBlock(entity.get('name'), '');\n                entity.node = text;\n                if (entity.has('gui.color')) {\n                    text.color = Tools.rgba2hsvString(entity.get('gui.color'));\n                }\n                set2DGUITransform(text, entity);\n                if (entity.has('gui.fontSize')) {\n                    text.fontSize = entity.get('gui.fontSize');\n                }\n                if (entity.has('gui.text')) {\n                    text.text = entity.get('gui.text');\n                }\n                if (entity.has('gui.textWrapping')) {\n                    text.textWrapping = entity.get('gui.textWrapping');\n                }\n                if (entity.has('gui.textHorizontalAlignment')) {\n                    text.textHorizontalAlignment = entity.get('gui.textHorizontalAlignment');\n                }\n                if (entity.has('gui.textVerticalAlignment')) {\n                    text.textVerticalAlignment = entity.get('gui.textVerticalAlignment');\n                }\n                return text;\n            } else if (subtype === 'input') {\n                let input = new BABYLON.GUI.InputText(entity.get('name'), '');\n                entity.node = input;\n                if (entity.has('gui.color')) {\n                    input.color = Tools.rgba2hsvString(entity.get('gui.color'));\n                }\n                if (entity.has('gui.background')) {\n                    input.background = Tools.rgba2hsvString(entity.get('gui.background'));\n                }\n                set2DGUITransform(input, entity);\n                if (entity.has('gui.thickness')) {\n                    input.thickness = entity.get('gui.thickness')\n                }\n                if (entity.has('gui.fontSize')) {\n                    input.fontSize = entity.get('gui.fontSize');\n                }\n                if (entity.has('gui.placeholderColor')) {\n                    input.placeholderColor = Tools.rgba2hsvString(entity.get('gui.placeholderColor'));\n                }\n                if (entity.has('gui.placeholderText')) {\n                    input.placeholderText = entity.get('gui.placeholderText');\n                }\n                if (entity.has('gui.focusedBackground')) {\n                    input.focusedBackground = Tools.rgba2hsvString(entity.get('gui.focusedBackground'));\n                }\n                if (entity.has('gui.text')) {\n                    input.text = entity.get('gui.text');\n                }\n                return input;\n            } else if (subtype === 'checkbox') {\n                let checkbox = new BABYLON.GUI.RadioButton(entity.get('name'));\n                entity.node = checkbox;\n                if (entity.has('gui.color')) {\n                    checkbox.color = Tools.rgba2hsvString(entity.get('gui.color'));\n                }\n                if (entity.has('gui.background')) {\n                    checkbox.background = Tools.rgba2hsvString(entity.get('gui.background'));\n                }\n\n                set2DGUITransform(checkbox, entity);\n                if (entity.has('gui.thickness')) {\n                    checkbox.thickness = entity.get('gui.thickness')\n                }\n                if (entity.has('gui.isChecked')) {\n                    checkbox.isChecked = entity.get('gui.isChecked')\n                }\n                return checkbox;\n            }\n            return null;\n        }\n\n        let set2DGUITransform = (control: BABYLON.GUI.Control, entity: Observer) => {\n            if (entity.has('gui.x')) {\n                if (entity.has('gui.xType') && entity.get('gui.xType') === 1) {\n                    control.left = entity.get('gui.x') + '%';\n                } else {\n                    control.left = entity.get('gui.x') + 'px';\n                }\n            }\n            if (entity.has('gui.y')) {\n                if (entity.has('gui.yType') && entity.get('gui.yType') === 1) {\n                    control.top = entity.get('gui.y') + '%';\n                } else {\n                    control.top = entity.get('gui.y') + 'px';\n                }\n            }\n            if (entity.has('gui.width')) {\n                if (entity.has('gui.widthType') && entity.get('gui.widthType') === 1) {\n                    control.width = entity.get('gui.width') + '%';\n                } else {\n                    control.width = entity.get('gui.width') + 'px';\n                }\n            }\n            if (entity.has('gui.height')) {\n                if (entity.has('gui.heightType') && entity.get('gui.heightType') === 1) {\n                    control.height = entity.get('gui.height') + '%';\n                } else {\n                    control.height = entity.get('gui.height') + 'px';\n                }\n            }\n            if (entity.has('gui.scaleX')) {\n                control.scaleX = entity.get('gui.scaleX');\n            }\n            if (entity.has('gui.scaleY')) {\n                control.scaleY = entity.get('gui.scaleY');\n            }\n            if (entity.has('gui.horizontal_alignment')) {\n                control.horizontalAlignment = entity.get('gui.horizontal_alignment');\n            }\n            if (entity.has('gui.vertical_alignment')) {\n                control.verticalAlignment = entity.get('gui.vertical_alignment');\n            }\n            if (entity.has('gui.isHighlighted')) {\n                control.isHighlighted = entity.get('gui.isHighlighted');\n            }\n        }\n\n    }\n\n\n\n}","import { Observer } from \"../../lib\";\n\nexport class EntityDelete {\n\n\n    public constructor() {\n        editor.method('entities:delete', function (entities: Observer[]) {\n            var records: any = [];\n            var entitiesToDelete: Observer[] = [];\n            var i;\n            var parent;\n\n            // index entities\n            var resourceIds: { [key: string]: Observer } = {};\n            for (i = 0; i < entities.length; i++) {\n                resourceIds[entities[i].get('resource_id')] = entities[i];\n            }\n\n            // find out if entity has ancestor\n            for (i = 0; i < entities.length; i++) {\n                var child = false;\n                parent = editor.call('entities:getParentResourceId', entities[i].get('resource_id'));\n\n                while (!child && parent) {\n                    if (resourceIds[parent]) {\n                        child = true;\n                    } else {\n                        parent = editor.call('entities:getParentResourceId', parent);\n                    }\n                }\n\n                if (!child) {\n                    entitiesToDelete.push(entities[i]);\n                }\n            }\n\n            // delete only top level entities\n            entities = entitiesToDelete;\n\n            for (i = 0; i < entities.length; i++) {\n                var resourceId = entities[i].get('resource_id');\n                var parentId = editor.call('entities:getParentResourceId', resourceId);\n                var ind;\n                if (parentId) {\n                    parent = editor.call('entities:get', parentId);\n                    if (parent) {\n                        ind = parent.get('children').indexOf(resourceId);\n                    }\n                }\n\n                records.push({\n                    resourceId: resourceId,\n                    parentId: parentId,\n                    ind: ind,\n                    data: entities[i]._data2\n                });\n            }\n\n            // Build a map of all entity reference properties in the graph. This is\n            // effectively a snapshot of the entity references as they were at the point of deletion,\n            // so that they can be re-constituted later if the deletion is undone.\n            // var entityReferencesMap = {};\n            // recursivelySearchForEntityReferences(editor.call('entities:root'), entityReferencesMap);\n\n            // remove the entities from the scene\n            for (i = 0; i < entities.length; i++) {\n                editor.call('entities:removeEntity', entities[i], null);\n            }\n\n            // sort records by index\n            // so that entities are re-added\n            // in the correct order in undo\n            records.sort(function (a: any, b: any) {\n                return a.ind - b.ind;\n            });\n\n\n            // TODO: history\n        });\n    }\n\n\n}","import { Observer } from \"../../lib\";\nimport { BabylonLoader } from \"../middleware/loader/babylonLoader\";\n\nexport class EntityEdit {\n\n\n    public constructor() {\n\n        let childToParent: { [key: string]: string } = {};\n        // 为回退作准备\n        let deletedCache: { [key: string]: any } = {};\n\n        // 更新entity数据，不做具体实例处理\n        editor.on('entities:add', function (entity: Observer) {\n            // console.log('entity-edit-children');\n            var children = entity.get('children');\n            for (var i = 0; i < children.length; i++)\n                childToParent[children[i]] = entity.get('resource_id');\n\n            entity.on('children:insert', function (value: string) {\n                // console.warn('children:insert in entity-edit');\n                childToParent[value] = entity.get('resource_id');\n                BabylonLoader.updateSceneData(entity.get('resource_id'), entity._data2);\n                editor.call('make:scene:dirty');\n            });\n            entity.on('children:remove', function (value: string) {\n                // console.warn('children:remove in entity-edit');\n                delete childToParent[value];\n                BabylonLoader.updateSceneData(entity.get('resource_id'), entity._data2);\n                editor.call('make:scene:dirty');\n            });\n        });\n\n        var updateEntityReferenceFields = function (entityReferencesMap: any, oldValue: string, newValue: any) {\n            var referencesToThisEntity = entityReferencesMap[oldValue];\n            if (!referencesToThisEntity) return;\n\n            referencesToThisEntity.forEach(function (reference: any) {\n                var sourceEntity = editor.call('entities:get', reference.sourceEntityGuid);\n                if (!sourceEntity) return;\n\n                var prevHistory = sourceEntity.history.enabled;\n                sourceEntity.history.enabled = false;\n                sourceEntity.set('components.' + reference.componentName + '.' + reference.fieldName, newValue);\n                sourceEntity.history.enabled = prevHistory;\n            });\n        };\n\n\n        var addEntity = function (entity: Observer, parent: Observer, select: boolean, ind: number | undefined, entityReferencesMap: any) {\n            entityReferencesMap = entityReferencesMap || {};\n            // ind = ind || 0;\n\n            childToParent[entity.get('resource_id')] = parent.get('resource_id');\n\n            var children = entity.get('children');\n            if (children.length)\n                entity.set('children', []);\n\n            // call add event\n            editor.call('entities:add', entity);\n\n            // console.error(entity);\n\n\n\n            // TODO: 上传到服务器\n            // shareDb \n            // editor.call('realtime:scene:op', {\n            //     p: ['entities', entity.get('resource_id')],\n            //     oi: entity.origin\n            // });\n\n            // this is necessary for the entity to be added to the tree view\n            // parent.history.enabled = false;\n            // 添加tree item 菜单入口\n            parent.insert('children', entity.get('resource_id'), ind);\n            // console.warn(parent);\n\n\n\n            // parent.history.enabled = true;\n\n            // if (select) {\n            //     setTimeout(function () {\n            //         editor.call('selector:history', false);\n            //         editor.call('selector:set', 'entity', [entity]);\n            //         editor.once('selector:change', function () {\n            //             editor.call('selector:history', true);\n            //         });\n            //     }, 0);\n            // }\n\n            // add children too\n            // children.forEach(function (childIdOrData: any) {\n            //     var data;\n\n            //     // If we've been provided an id, we're re-creating children from the deletedCache\n            //     if (typeof childIdOrData === 'string') {\n            //         data = deletedCache[childIdOrData];\n            //         if (!data) {\n            //             return;\n            //         }\n            //         // If we've been provided an object, we're creating children for a new entity\n            //     } \n\n            //     var child = new Observer(data);\n            //     // TODO\n            //     addEntity(child, entity, false, 0, entityReferencesMap);\n            // });\n\n            BabylonLoader.addSceneData(entity.get('resource_id'), entity.origin);\n\n            // Hook up any entity references which need to be pointed to this newly created entity\n            // (happens when addEntity() is being called during the undoing of a deletion). In order\n            // to force components to respond to the setter call even when they are running in other\n            // tabs or in the Launch window, we unfortunately have to use a setTimeout() hack :(\n            // var guid = entity.get('resource_id');\n\n            // First set all entity reference fields targeting this guid to null\n            // TODO: 待定，更新属性菜单\n            // updateEntityReferenceFields(entityReferencesMap, guid, null);\n            // setTimeout(function () {\n            //     // Then update the same fields to target the guid again\n            //     updateEntityReferenceFields(entityReferencesMap, guid, guid);\n            // }, 0);\n\n            // if (entity.get('__postCreationCallback')) {\n            //     entity.get('__postCreationCallback')(entity);\n            // }\n        };\n\n        var removeEntity = function (entity: Observer, entityReferencesMap: any) {\n            entityReferencesMap = entityReferencesMap || {};\n            // deletedCache[entity.get('resource_id')] = entity.json();\n            deletedCache[entity.get('resource_id')] = entity._data2;\n\n            // Nullify any entity references which currently point to this guid\n            // updateEntityReferenceFields(entityReferencesMap, entity.get('resource_id'), null);\n\n            // remove children\n            // console.log(entity.get('children'));\n            let childrenIDs = entity.get('children');\n            if (childrenIDs && childrenIDs.length > 0) {\n                childrenIDs = childrenIDs.slice(0);\n                for (let i = 0, len = childrenIDs.length; i < len; i++) {\n                    var childEntity = editor.call('entities:get', childrenIDs[i]);\n                    if (!childEntity)\n                        return;\n                    removeEntity(childEntity, entityReferencesMap);\n                }\n            }\n\n            if (editor.call('selector:type') === 'entity' && editor.call('selector:items').indexOf(entity) !== -1) {\n                editor.call('selector:history', false);\n                editor.call('selector:remove', entity);\n                // TODO：选择历史记录\n                editor.once('selector:change', function () {\n                    editor.call('selector:history', true);\n                });\n            }\n\n            // remove from parent\n            var parentId = childToParent[entity.get('resource_id')];\n            if (parentId) {\n                var parent = editor.call('entities:get', parentId);\n                if (parent) {\n                    // parent.history.enabled = false;\n                    parent.removeValue('children', entity.get('resource_id'));\n                    // parent.history.enabled = true;\n                }\n            }\n            let removeEntityID = entity.get('resource_id');\n            // call remove method\n            editor.call('entities:remove', entity);\n\n            // 更新scene数据\n            BabylonLoader.removeSceneData(removeEntityID);\n            editor.call('make:scene:dirty');\n\n        };\n\n\n        editor.method('entities:addEntity', addEntity);\n        editor.method('entities:removeEntity', removeEntity);\n\n        editor.method('entities:getParentResourceId', function (childResourceId: string) {\n            return childToParent[childResourceId];\n        });\n\n        editor.method('entities:updateChildToParentIndex', function (childResourceId: string, parentResourceId: string) {\n            childToParent[childResourceId] = parentResourceId;\n        });\n\n        editor.method('entities:getFromDeletedCache', function (resourceId: string) {\n            return deletedCache[resourceId];\n        });\n\n\n        editor.method('save:scene', () => {\n            BabylonLoader.saveScene();\n        });\n\n\n    }\n}","import { Entities } from './entities';\nimport { Observer } from '../../lib';\nimport { Loader } from '../middleware/loader';\nimport { TopElementContainer, Progress } from '../../ui';\n\nexport class EntityLoad {\n\n    public loadedEntities: boolean = false;\n\n    // private _entities: Entities = new Entities();\n\n    public constructor() {\n\n        var hierarchyOverlay = new TopElementContainer({\n            flex: true\n        });\n        hierarchyOverlay.class!.add('progress-overlay');\n        editor.call('layout.hierarchy').append(hierarchyOverlay);\n\n        var p = new Progress();\n        p.on('progress:100', function () {\n            hierarchyOverlay.hidden = true;\n        });\n        hierarchyOverlay.append(p);\n        p.hidden = true;\n\n        var loadedEntities = false;\n\n        editor.method('entities:loaded', function () {\n            return loadedEntities;\n        });\n\n\n        editor.on('scene:raw', function (data: any) {\n            // editor.call('selector:clear');\n            // editor.call('entities:clear');\n            // editor.call('attributes:clear');\n\n            // console.log(data);\n\n            var total = Object.keys(data.entities).length;\n            var i = 0;\n\n            // list\n            for (var key in data.entities) {\n                let entity = new Observer(data.entities[key]);\n                editor.call('entities:add', entity);\n                p.progress = (++i / total) * 0.8 + 0.1;\n                if (!data.entities[key].root) {\n                    editor.call('create:scene:element', entity);\n                }\n            }\n\n            p.progress = 1;\n\n            loadedEntities = true;\n            editor.emit('entities:load');\n        });\n\n        editor.call('attributes:clear');\n\n        editor.on('scene:unload', function () {\n            editor.call('entities:clear');\n            editor.call('attributes:clear');\n        });\n\n        editor.on('scene:beforeload', function () {\n            hierarchyOverlay.hidden = false;\n            p.hidden = false;\n            p.progress = 0.1;\n        });\n\n\n\n\n\n\n        \n\n    }\n\n\n\n\n    /*\n    public scene_raw(row_data: any): void {\n        // 解析entity\n\n        // 清空\n        // editor.call('selector:clear');\n        // editor.call('entities:clear');\n        // editor.call('attributes:clear');\n\n        // Loader.append(row_data);\n\n        // 加载进度条计算\n        var total = Object.keys(row_data.entities).length;\n        var i = 0;\n\n        // list 挨个解析\n        for (var key in row_data.entities) {\n            // 是否需要加入一个中间结构\n            this._entities.addRaw(row_data.entities[key]);\n            let entity = new Observer(row_data.entities[key]);\n            // debug.warn(entity.get('name'));\n            // debug.warn(entity.get('resource_id'));\n            // if (entity.has('components.rigidbody')) {\n            //     debug.warn(entity.get('components.rigidbody.type'));\n            // }\n\n            // editor.call('entities:add', new Observer(data.entities[key]));\n            // p.progress = (++i / total) * 0.8 + 0.1;\n        }\n\n        // p.progress = 1;\n\n        this.loadedEntities = true;\n\n        // 解析完成，其他面板设置\n        editor.emit('entities:load');\n    }\n    */\n\n}","export class EntitySync {\n\n\n    public constructor() {\n\n    }\n\n}","export class Entity {\n\n\n  public constructor() {\n\n  }\n\n\n  public get(str: string) {\n    \n  }\n\n  \n\n}","export * from './entity';\nexport * from './entities';\nexport * from './entity-load';\nexport * from './entity-create';\nexport * from './entity-sync';\nexport * from './entity-edit';\nexport * from './entity-delete';\nexport * from './keeper';","import { EntityLoad } from \"./entity-load\";\nimport { Entities } from \"./entities\";\nimport { EntityCreate } from \"./entity-create\";\nimport { EntitySync } from \"./entity-sync\";\nimport { EntityEdit } from \"./entity-edit\";\nimport { EntityDelete } from \"./entity-delete\";\n\nexport class EntityKeeper {\n\n    public constructor() {\n\n        new Entities();\n\n        new EntityEdit();\n\n        new EntityCreate();\n\n        new EntityLoad();\n\n        new EntitySync();\n\n        new EntityDelete();\n\n\n        \n\n    }\n\n\n\n}","// import { IDisposable, Scene } from \"../scene\";\n// import { Nullable } from \"../types\";\n// import { Observable, Observer } from \"../Misc/observable\";\n// import { PointerInfoPre, PointerInfo, PointerEventTypes } from \"../Events/pointerEvents\";\n// import { PickingInfo } from \"../Collisions/pickingInfo\";\n// import { AbstractMesh } from \"../Meshes/abstractMesh\";\n// import { EngineStore } from \"../Engines/engineStore\";\n// import { HemisphericLight } from '../Lights/hemisphericLight';\n// import { Vector3 } from '../Maths/math.vector';\n// import { Camera } from '../Cameras/camera';\n// import { Color3 } from '../Maths/math.color';\n\n/**\n * Renders a layer on top of an existing scene\n */\nexport class UtilityLayerRenderer implements BABYLON.IDisposable {\n    private _pointerCaptures: { [pointerId: number]: boolean } = {};\n    private _lastPointerEvents: { [pointerId: number]: boolean } = {};\n    private static _DefaultUtilityLayer: Nullable<UtilityLayerRenderer> = null;\n    private static _DefaultKeepDepthUtilityLayer: Nullable<UtilityLayerRenderer> = null;\n    private _sharedGizmoLight: Nullable<BABYLON.HemisphericLight> = null;\n\n    private _renderCamera: Nullable<BABYLON.Camera> = null;\n\n    /**\n     * Gets the camera that is used to render the utility layer (when not set, this will be the last active camera)\n     * @param getRigParentIfPossible if the current active camera is a rig camera, should its parent camera be returned\n     * @returns the camera that is used when rendering the utility layer\n     */\n    public getRenderCamera(getRigParentIfPossible?: boolean) {\n        if (this._renderCamera) {\n            return this._renderCamera;\n        } else {\n            let activeCam: BABYLON.Camera;\n            if (this.originalScene.activeCameras.length > 1) {\n                // activeCam = this.originalScene.activeCameras[this.originalScene.activeCameras.length - 1];\n                activeCam = this.originalScene.activeCameras[0];\n            } else {\n                activeCam = <BABYLON.Camera>(this.originalScene.activeCamera!);\n            }\n\n            if (getRigParentIfPossible && activeCam && activeCam.isRightCamera) {\n                return activeCam.rightCamera!;\n            }\n            return activeCam;\n        }\n    }\n    /**\n     * Sets the camera that should be used when rendering the utility layer (If set to null the last active camera will be used)\n     * @param cam the camera that should be used when rendering the utility layer\n     */\n    public setRenderCamera(cam: Nullable<BABYLON.Camera>) {\n        this._renderCamera = cam;\n    }\n\n    /**\n     * @hidden\n     * Light which used by gizmos to get light shading\n     */\n    public _getSharedGizmoLight(): BABYLON.HemisphericLight {\n        if (!this._sharedGizmoLight) {\n            this._sharedGizmoLight = new BABYLON.HemisphericLight(\"shared gizmo light\", new BABYLON.Vector3(0, 1, 0), this.utilityLayerScene);\n            this._sharedGizmoLight.intensity = 2;\n            this._sharedGizmoLight.groundColor = BABYLON.Color3.Gray();\n        }\n        return this._sharedGizmoLight;\n    }\n\n    /**\n     * If the picking should be done on the utility layer prior to the actual scene (Default: true)\n     */\n    public pickUtilitySceneFirst = true;\n    /**\n     * A shared utility layer that can be used to overlay objects into a scene (Depth map of the previous scene is cleared before drawing on top of it)\n     */\n    public static get DefaultUtilityLayer(): UtilityLayerRenderer {\n        if (UtilityLayerRenderer._DefaultUtilityLayer == null) {\n            UtilityLayerRenderer._DefaultUtilityLayer = new UtilityLayerRenderer(BABYLON.EngineStore.LastCreatedScene!);\n            UtilityLayerRenderer._DefaultUtilityLayer.originalScene.onDisposeObservable.addOnce(() => {\n                UtilityLayerRenderer._DefaultUtilityLayer = null;\n            });\n        }\n        return UtilityLayerRenderer._DefaultUtilityLayer;\n    }\n    /**\n     * A shared utility layer that can be used to embed objects into a scene (Depth map of the previous scene is not cleared before drawing on top of it)\n     */\n    public static get DefaultKeepDepthUtilityLayer(): UtilityLayerRenderer {\n        if (UtilityLayerRenderer._DefaultKeepDepthUtilityLayer == null) {\n            UtilityLayerRenderer._DefaultKeepDepthUtilityLayer = new UtilityLayerRenderer(BABYLON.EngineStore.LastCreatedScene!);\n            UtilityLayerRenderer._DefaultKeepDepthUtilityLayer.utilityLayerScene.autoClearDepthAndStencil = false;\n            UtilityLayerRenderer._DefaultKeepDepthUtilityLayer.originalScene.onDisposeObservable.addOnce(() => {\n                UtilityLayerRenderer._DefaultKeepDepthUtilityLayer = null;\n            });\n        }\n        return UtilityLayerRenderer._DefaultKeepDepthUtilityLayer;\n    }\n\n    /**\n     * The scene that is rendered on top of the original scene\n     */\n    public utilityLayerScene: BABYLON.Scene;\n\n    /**\n     *  If the utility layer should automatically be rendered on top of existing scene\n    */\n    public shouldRender: boolean = true;\n    /**\n     * If set to true, only pointer down onPointerObservable events will be blocked when picking is occluded by original scene\n     */\n    public onlyCheckPointerDownEvents = true;\n\n    /**\n     * If set to false, only pointerUp, pointerDown and pointerMove will be sent to the utilityLayerScene (false by default)\n     */\n    public processAllEvents = false;\n\n    /**\n     * Observable raised when the pointer move from the utility layer scene to the main scene\n     */\n    public onPointerOutObservable = new BABYLON.Observable<number>();\n\n    /** Gets or sets a predicate that will be used to indicate utility meshes present in the main scene */\n    public mainSceneTrackerPredicate: Nullable<(mesh: Nullable<BABYLON.AbstractMesh>) => boolean> = null;\n\n    private _afterRenderObserver: Nullable<BABYLON.Observer<BABYLON.Camera>>;\n    private _sceneDisposeObserver: Nullable<BABYLON.Observer<BABYLON.Scene>>;\n    private _originalPointerObserver: Nullable<BABYLON.Observer<BABYLON.PointerInfoPre>> = null;\n    /**\n     * Instantiates a UtilityLayerRenderer\n     * @param originalScene the original scene that will be rendered on top of\n     * @param handleEvents boolean indicating if the utility layer should handle events\n     */\n    constructor(\n        /** the original scene that will be rendered on top of */\n        public originalScene: BABYLON.Scene,\n        handleEvents: boolean = true) {\n        // Create scene which will be rendered in the foreground and remove it from being referenced by engine to avoid interfering with existing app\n        this.utilityLayerScene = new BABYLON.Scene(originalScene.getEngine(), { virtual: true });\n        this.utilityLayerScene.useRightHandedSystem = originalScene.useRightHandedSystem;\n        this.utilityLayerScene._allowPostProcessClearColor = false;\n\n        // Detach controls on utility scene, events will be fired by logic below to handle picking priority\n        this.utilityLayerScene.detachControl();\n\n        if (handleEvents) {\n            this._originalPointerObserver = originalScene.onPrePointerObservable.add((prePointerInfo, eventState) => {\n                if (!this.utilityLayerScene.activeCamera) {\n                    return;\n                }\n                if (!this.processAllEvents) {\n                    if (prePointerInfo.type !== BABYLON.PointerEventTypes.POINTERMOVE\n                        && prePointerInfo.type !== BABYLON.PointerEventTypes.POINTERUP\n                        && prePointerInfo.type !== BABYLON.PointerEventTypes.POINTERDOWN\n                        && prePointerInfo.type !== BABYLON.PointerEventTypes.POINTERDOUBLETAP) {\n                        return;\n                    }\n                }\n                this.utilityLayerScene.pointerX = originalScene.pointerX;\n                this.utilityLayerScene.pointerY = originalScene.pointerY;\n                let pointerEvent = <PointerEvent>(prePointerInfo.event);\n                if (originalScene!.isPointerCaptured(pointerEvent.pointerId)) {\n                    this._pointerCaptures[pointerEvent.pointerId] = false;\n                    return;\n                }\n\n                var utilityScenePick = prePointerInfo.ray ? this.utilityLayerScene.pickWithRay(prePointerInfo.ray) : this.utilityLayerScene.pick(originalScene.pointerX, originalScene.pointerY);\n                if (!prePointerInfo.ray && utilityScenePick) {\n                    prePointerInfo.ray = utilityScenePick.ray;\n                }\n\n                // always fire the prepointer oversvable\n                this.utilityLayerScene.onPrePointerObservable.notifyObservers(prePointerInfo);\n\n                // allow every non pointer down event to flow to the utility layer\n                if (this.onlyCheckPointerDownEvents && prePointerInfo.type != BABYLON.PointerEventTypes.POINTERDOWN) {\n                    if (!prePointerInfo.skipOnPointerObservable) {\n                        this.utilityLayerScene.onPointerObservable.notifyObservers(new BABYLON.PointerInfo(prePointerInfo.type, prePointerInfo.event, utilityScenePick), prePointerInfo.type);\n                    }\n                    if (prePointerInfo.type === BABYLON.PointerEventTypes.POINTERUP && this._pointerCaptures[pointerEvent.pointerId]) {\n                        this._pointerCaptures[pointerEvent.pointerId] = false;\n                    }\n                    return;\n                }\n\n                if (this.utilityLayerScene.autoClearDepthAndStencil || this.pickUtilitySceneFirst) {\n                    // If this layer is an overlay, check if this layer was hit and if so, skip pointer events for the main scene\n                    if (utilityScenePick && utilityScenePick.hit) {\n\n                        if (!prePointerInfo.skipOnPointerObservable) {\n                            this.utilityLayerScene.onPointerObservable.notifyObservers(new BABYLON.PointerInfo(prePointerInfo.type, prePointerInfo.event, utilityScenePick), prePointerInfo.type);\n                        }\n                        prePointerInfo.skipOnPointerObservable = true;\n                    }\n                } else {\n                    var originalScenePick = prePointerInfo.ray ? originalScene.pickWithRay(prePointerInfo.ray) : originalScene.pick(originalScene.pointerX, originalScene.pointerY);\n                    let pointerEvent = <PointerEvent>(prePointerInfo.event);\n\n                    // If the layer can be occluded by the original scene, only fire pointer events to the first layer that hit they ray\n                    if (originalScenePick && utilityScenePick) {\n\n                        // No pick in utility scene\n                        if (utilityScenePick.distance === 0 && originalScenePick.pickedMesh) {\n                            if (this.mainSceneTrackerPredicate && this.mainSceneTrackerPredicate(originalScenePick.pickedMesh)) {\n                                // We touched an utility mesh present in the main scene\n                                this._notifyObservers(prePointerInfo, originalScenePick, pointerEvent);\n                                prePointerInfo.skipOnPointerObservable = true;\n                            } else if (prePointerInfo.type === BABYLON.PointerEventTypes.POINTERDOWN) {\n                                this._pointerCaptures[pointerEvent.pointerId] = true;\n                            } else if (this._lastPointerEvents[pointerEvent.pointerId]) {\n                                // We need to send a last pointerup to the utilityLayerScene to make sure animations can complete\n                                this.onPointerOutObservable.notifyObservers(pointerEvent.pointerId);\n                                delete this._lastPointerEvents[pointerEvent.pointerId];\n                            }\n                        } else if (!this._pointerCaptures[pointerEvent.pointerId] && (utilityScenePick.distance < originalScenePick.distance || originalScenePick.distance === 0)) {\n                            // We pick something in utility scene or the pick in utility is closer than the one in main scene\n                            this._notifyObservers(prePointerInfo, utilityScenePick, pointerEvent);\n                            // If a previous utility layer set this, do not unset this\n                            if (!prePointerInfo.skipOnPointerObservable) {\n                                prePointerInfo.skipOnPointerObservable = utilityScenePick.distance > 0;\n                            }\n                        } else if (!this._pointerCaptures[pointerEvent.pointerId] && (utilityScenePick.distance > originalScenePick.distance)) {\n                            // We have a pick in both scenes but main is closer than utility\n\n                            // We touched an utility mesh present in the main scene\n                            if (this.mainSceneTrackerPredicate && this.mainSceneTrackerPredicate(originalScenePick.pickedMesh)) {\n                                this._notifyObservers(prePointerInfo, originalScenePick, pointerEvent);\n                                prePointerInfo.skipOnPointerObservable = true;\n                            } else if (this._lastPointerEvents[pointerEvent.pointerId]) {\n                                // We need to send a last pointerup to the utilityLayerScene to make sure animations can complete\n                                this.onPointerOutObservable.notifyObservers(pointerEvent.pointerId);\n                                delete this._lastPointerEvents[pointerEvent.pointerId];\n                            }\n                        }\n\n                        if (prePointerInfo.type === BABYLON.PointerEventTypes.POINTERUP && this._pointerCaptures[pointerEvent.pointerId]) {\n                            this._pointerCaptures[pointerEvent.pointerId] = false;\n                        }\n                    }\n                }\n            });\n\n            // As a newly added utility layer will be rendered over the screen last, it's pointer events should be processed first\n            if (this._originalPointerObserver) {\n                originalScene.onPrePointerObservable.makeObserverTopPriority(this._originalPointerObserver);\n            }\n        }\n\n        // Render directly on top of existing scene without clearing\n        this.utilityLayerScene.autoClear = false;\n\n        this._afterRenderObserver = this.originalScene.onAfterCameraRenderObservable.add((camera) => {\n            // Only render when the render camera finishes rendering\n            if (this.shouldRender && camera == this.getRenderCamera()) {\n                this.render();\n            }\n        });\n\n        this._sceneDisposeObserver = this.originalScene.onDisposeObservable.add(() => {\n            this.dispose();\n        });\n\n        this._updateCamera();\n    }\n\n    private _notifyObservers(prePointerInfo: BABYLON.PointerInfoPre, pickInfo: BABYLON.PickingInfo, pointerEvent: PointerEvent) {\n        if (!prePointerInfo.skipOnPointerObservable) {\n            this.utilityLayerScene.onPointerObservable.notifyObservers(new BABYLON.PointerInfo(prePointerInfo.type, prePointerInfo.event, pickInfo), prePointerInfo.type);\n            this._lastPointerEvents[pointerEvent.pointerId] = true;\n        }\n    }\n\n    /**\n     * Renders the utility layers scene on top of the original scene\n     */\n    public render() {\n        this._updateCamera();\n        if (this.utilityLayerScene.activeCamera) {\n            // if (this.utilityLayerScene.activeCamera.mode === BABYLON.Camera.ORTHOGRAPHIC_CAMERA) {\n            //     this.orthoSize(this.utilityLayerScene.activeCamera);\n            // }\n            // // Set the camera's scene to utility layers scene\n            var oldScene = this.utilityLayerScene.activeCamera.getScene();\n            var camera = this.utilityLayerScene.activeCamera;\n            camera._scene = this.utilityLayerScene;\n            if (camera.leftCamera) {\n                camera.leftCamera._scene = this.utilityLayerScene;\n            }\n            if (camera.rightCamera) {\n                camera.rightCamera._scene = this.utilityLayerScene;\n            }\n\n            this.utilityLayerScene.render(false);\n\n            // Reset camera's scene back to original\n            camera._scene = oldScene;\n            if (camera.leftCamera) {\n                camera.leftCamera._scene = oldScene;\n            }\n            if (camera.rightCamera) {\n                camera.rightCamera._scene = oldScene;\n            }\n            // if (this.utilityLayerScene.activeCamera.mode === BABYLON.Camera.ORTHOGRAPHIC_CAMERA) {\n            //     this.orthoSize(this.utilityLayerScene.activeCamera, true);\n            // }\n        }\n\n    }\n\n    /**\n     * Disposes of the renderer\n     */\n    public dispose() {\n        this.onPointerOutObservable.clear();\n\n        if (this._afterRenderObserver) {\n            this.originalScene.onAfterCameraRenderObservable.remove(this._afterRenderObserver);\n        }\n        if (this._sceneDisposeObserver) {\n            this.originalScene.onDisposeObservable.remove(this._sceneDisposeObserver);\n        }\n        if (this._originalPointerObserver) {\n            this.originalScene.onPrePointerObservable.remove(this._originalPointerObserver);\n        }\n        this.utilityLayerScene.dispose();\n    }\n\n    private _updateCamera() {\n        let camera = this.getRenderCamera();\n        \n        this.utilityLayerScene.cameraToUseForPointers = camera\n        // console.warn(this.utilityLayerScene.cameraToUseForPointers);\n        this.utilityLayerScene.activeCamera = camera;\n\n    }\n\n    private _backUpOrtho: number = 0;\n    private orthoSize(camera: BABYLON.Camera, recovery: boolean = false) {\n        if (camera.mode === BABYLON.Camera.ORTHOGRAPHIC_CAMERA) {\n            if (recovery) {\n                this.setOrthoSize(camera, this._backUpOrtho);\n            } else {\n                this._backUpOrtho = camera.orthoRight! / this.utilityLayerScene.getEngine().getRenderWidth();\n                // console.log('1: ' + this._backUpOrtho);\n                this.setOrthoSize(camera, 0.5);\n                // console.log('2: ' + camera.orthoRight! / this.utilityLayerScene.getEngine().getRenderWidth());\n            }\n        } \n    }\n\n    private setOrthoSize(camera: BABYLON.Camera, val: number) {\n        if (camera.mode === BABYLON.Camera.ORTHOGRAPHIC_CAMERA) {\n            camera.orthoRight = val * this.utilityLayerScene.getEngine().getRenderWidth();\n            camera.orthoLeft = -val * this.utilityLayerScene.getEngine().getRenderWidth();\n            camera.orthoTop = val * this.utilityLayerScene.getEngine().getRenderHeight();\n            camera.orthoBottom = -val * this.utilityLayerScene.getEngine().getRenderHeight();\n        }\n    }\n}\n","// import { Observer, Observable } from \"../Misc/observable\";\n// import { Nullable } from \"../types\";\n// import { PointerInfo } from \"../Events/pointerEvents\";\n// import { Vector3, Matrix } from \"../Maths/math.vector\";\n// import { TransformNode } from \"../Meshes/transformNode\";\n// import { Node } from \"../node\";\n// import { Mesh } from \"../Meshes/mesh\";\n// import { LinesMesh } from \"../Meshes/linesMesh\";\n// import { CylinderBuilder } from \"../Meshes/Builders/cylinderBuilder\";\n// import { PointerDragBehavior } from \"../Behaviors/Meshes/pointerDragBehavior\";\nimport { Gizmo } from \"./gizmo\";\n// import { UtilityLayerRenderer } from \"../Rendering/utilityLayerRenderer\";\n// import { StandardMaterial } from \"../Materials/standardMaterial\";\n// import { Scene } from \"../scene\";\nimport { PositionGizmo } from \"./positionGizmo\";\nimport { UtilityLayerRenderer } from \"./UtilityLayerRenderer\";\n// import { Color3 } from '../Maths/math.color';\n/**\n * Single axis drag gizmo\n */\nexport class AxisDragGizmo extends Gizmo {\n    /**\n     * Drag behavior responsible for the gizmos dragging interactions\n     */\n    public dragBehavior: BABYLON.PointerDragBehavior;\n    private _pointerObserver: Nullable<BABYLON.Observer<BABYLON.PointerInfo>> = null;\n    /**\n     * Drag distance in babylon units that the gizmo will snap to when dragged (Default: 0)\n     */\n    public snapDistance = 0;\n    /**\n     * Event that fires each time the gizmo snaps to a new location.\n     * * snapDistance is the the change in distance\n     */\n    public onSnapObservable = new BABYLON.Observable<{ snapDistance: number }>();\n\n    private _isEnabled: boolean = true;\n    private _parent: Nullable<PositionGizmo> = null;\n\n    private _arrow: BABYLON.TransformNode;\n    private _coloredMaterial: BABYLON.StandardMaterial;\n    private _hoverMaterial: BABYLON.StandardMaterial;\n\n    /** @hidden */\n    public static _CreateArrow(scene: BABYLON.Scene, material: BABYLON.StandardMaterial, thickness: number = 1): BABYLON.TransformNode {\n        var arrow = new BABYLON.TransformNode(\"arrow\", scene);\n        var cylinder = BABYLON.CylinderBuilder.CreateCylinder(\"cylinder\", { diameterTop: 0, height: 0.075, diameterBottom: 0.0375 * (1 + (thickness - 1) / 4), tessellation: 96 }, scene);\n        var line = BABYLON.CylinderBuilder.CreateCylinder(\"cylinder\", { diameterTop: 0.005 * thickness, height: 0.275, diameterBottom: 0.005 * thickness, tessellation: 96 }, scene);\n        line.material = material;\n        cylinder.parent = arrow;\n        line.parent = arrow;\n\n        // Position arrow pointing in its drag axis\n        cylinder.material = material;\n        cylinder.rotation.x = Math.PI / 2;\n        cylinder.position.z += 0.3;\n        line.position.z += 0.275 / 2;\n        line.rotation.x = Math.PI / 2;\n        return arrow;\n    }\n\n    /** @hidden */\n    public static _CreateArrowInstance(scene: BABYLON.Scene, arrow: BABYLON.TransformNode): BABYLON.TransformNode {\n        const instance = new BABYLON.TransformNode(\"arrow\", scene);\n        for (const mesh of arrow.getChildMeshes()) {\n            const childInstance = (mesh as BABYLON.Mesh).createInstance(mesh.name);\n            childInstance.parent = instance;\n        }\n        return instance;\n    }\n\n    /**\n     * Creates an AxisDragGizmo\n     * @param gizmoLayer The utility layer the gizmo will be added to\n     * @param dragAxis The axis which the gizmo will be able to drag on\n     * @param color The color of the gizmo\n     * @param thickness display gizmo axis thickness\n     */\n    constructor(dragAxis: BABYLON.Vector3, color: BABYLON.Color3 = BABYLON.Color3.Gray(), gizmoLayer: UtilityLayerRenderer = UtilityLayerRenderer.DefaultUtilityLayer, parent: Nullable<PositionGizmo> = null, thickness: number = 1) {\n        super(gizmoLayer);\n        this._parent = parent;\n        // Create Material\n        this._coloredMaterial = new BABYLON.StandardMaterial(\"\", gizmoLayer.utilityLayerScene);\n        this._coloredMaterial.diffuseColor = color;\n        this._coloredMaterial.specularColor = color.subtract(new BABYLON.Color3(0.1, 0.1, 0.1));\n\n        this._hoverMaterial = new BABYLON.StandardMaterial(\"\", gizmoLayer.utilityLayerScene);\n        this._hoverMaterial.diffuseColor = color.add(new BABYLON.Color3(0.3, 0.3, 0.3));\n\n        // Build mesh on root node\n        this._arrow = AxisDragGizmo._CreateArrow(gizmoLayer.utilityLayerScene, this._coloredMaterial, thickness);\n\n        this._arrow.lookAt(this._rootMesh.position.add(dragAxis));\n        this._arrow.scaling.scaleInPlace(1 / 3);\n        this._arrow.parent = this._rootMesh;\n\n        var currentSnapDragDistance = 0;\n        var tmpVector = new BABYLON.Vector3();\n        var tmpSnapEvent = { snapDistance: 0 };\n        // Add drag behavior to handle events when the gizmo is dragged\n        this.dragBehavior = new BABYLON.PointerDragBehavior({ dragAxis: dragAxis });\n        this.dragBehavior.moveAttached = false;\n        this._rootMesh.addBehavior(this.dragBehavior);\n\n        var localDelta = new BABYLON.Vector3();\n        var tmpMatrix = new BABYLON.Matrix();\n        this.dragBehavior.onDragObservable.add((event) => {\n            if (this.attachedNode) {\n                // Convert delta to local translation if it has a parent\n                if (this.attachedNode.parent) {\n                    this.attachedNode.parent.getWorldMatrix().invertToRef(tmpMatrix);\n                    tmpMatrix.setTranslationFromFloats(0, 0, 0);\n                    BABYLON.Vector3.TransformCoordinatesToRef(event.delta, tmpMatrix, localDelta);\n                } else {\n                    localDelta.copyFrom(event.delta);\n                }\n                \n                // Snapping logic\n                if (this.snapDistance == 0) {\n                    if ((this.attachedNode as any).position) { // Required for nodes like lights\n                        (this.attachedNode as any).position.addInPlaceFromFloats(localDelta.x, localDelta.y, localDelta.z);\n                    }\n                    // use _worldMatrix to not force a matrix update when calling GetWorldMatrix especialy with Cameras\n                    this.attachedNode._worldMatrix.addTranslationFromFloats(localDelta.x, localDelta.y, localDelta.z);\n                    this.attachedNode.updateCache();\n                } else {\n                    currentSnapDragDistance += event.dragDistance;\n                    if (Math.abs(currentSnapDragDistance) > this.snapDistance) {\n                        var dragSteps = Math.floor(Math.abs(currentSnapDragDistance) / this.snapDistance);\n                        currentSnapDragDistance = currentSnapDragDistance % this.snapDistance;\n                        localDelta.normalizeToRef(tmpVector);\n                        tmpVector.scaleInPlace(this.snapDistance * dragSteps);\n                        this.attachedNode._worldMatrix.addTranslationFromFloats(tmpVector.x, tmpVector.y, tmpVector.z);\n                        this.attachedNode.updateCache();\n                        tmpSnapEvent.snapDistance = this.snapDistance * dragSteps;\n                        this.onSnapObservable.notifyObservers(tmpSnapEvent);\n                    }\n                }\n                this._operationType = 'translate';\n                this._matrixChanged();\n            }\n        });\n\n        this._pointerObserver = gizmoLayer.utilityLayerScene.onPointerObservable.add((pointerInfo) => {\n            if (this._customMeshSet) {\n                return;\n            }\n            var isHovered = pointerInfo.pickInfo && (this._rootMesh.getChildMeshes().indexOf(<BABYLON.Mesh>pointerInfo.pickInfo.pickedMesh) != -1);\n            var material = isHovered ? this._hoverMaterial : this._coloredMaterial;\n            this._rootMesh.getChildMeshes().forEach((m) => {\n                m.material = material;\n                if ((<BABYLON.LinesMesh>m).color) {\n                    (<BABYLON.LinesMesh>m).color = material.diffuseColor;\n                }\n            });\n        });\n\n        var light = gizmoLayer._getSharedGizmoLight();\n        light.includedOnlyMeshes = light.includedOnlyMeshes.concat(this._rootMesh.getChildMeshes(false));\n    }\n    protected _attachedNodeChanged(value: Nullable<BABYLON.Node>) {\n        if (this.dragBehavior) {\n            this.dragBehavior.enabled = value ? true : false;\n        }\n    }\n\n    /**\n     * If the gizmo is enabled\n     */\n    public set isEnabled(value: boolean) {\n        this._isEnabled = value;\n        if (!value) {\n            this.attachedMesh = null;\n            this.attachedNode = null;\n        }\n        else {\n            if (this._parent) {\n                this.attachedMesh = this._parent.attachedMesh;\n                this.attachedNode = this._parent.attachedNode;\n            }\n        }\n    }\n    public get isEnabled(): boolean {\n        return this._isEnabled;\n    }\n\n    /**\n     * Disposes of the gizmo\n     */\n    public dispose() {\n        this.onSnapObservable.clear();\n        this.gizmoLayer.utilityLayerScene.onPointerObservable.remove(this._pointerObserver);\n        this.dragBehavior.detach();\n        if (this._arrow) {\n            this._arrow.dispose();\n        }\n        [this._coloredMaterial, this._hoverMaterial].forEach((matl) => {\n            if (matl) {\n                matl.dispose();\n            }\n        });\n        super.dispose();\n    }\n}\n","// import { Observer, Observable } from \"../Misc/observable\";\n// import { Nullable } from \"../types\";\n// import { PointerInfo } from \"../Events/pointerEvents\";\n// import { Vector3, Matrix } from \"../Maths/math.vector\";\n// import { AbstractMesh } from \"../Meshes/abstractMesh\";\n// import { Node } from \"../node\";\n// import { Mesh } from \"../Meshes/mesh\";\n// import { LinesMesh } from \"../Meshes/linesMesh\";\n// import { BoxBuilder } from \"../Meshes/Builders/boxBuilder\";\n// import { CylinderBuilder } from \"../Meshes/Builders/cylinderBuilder\";\n// import { StandardMaterial } from \"../Materials/standardMaterial\";\n// import { PointerDragBehavior } from \"../Behaviors/Meshes/pointerDragBehavior\";\nimport { Gizmo } from \"./gizmo\";\n// import { UtilityLayerRenderer } from \"../Rendering/utilityLayerRenderer\";\nimport { ScaleGizmo } from \"./scaleGizmo\";\nimport { UtilityLayerRenderer } from \"./UtilityLayerRenderer\";\n// import { Color3 } from '../Maths/math.color';\n\n/**\n * Single axis scale gizmo\n */\nexport class AxisScaleGizmo extends Gizmo {\n    /**\n     * Drag behavior responsible for the gizmos dragging interactions\n     */\n    public dragBehavior: BABYLON.PointerDragBehavior;\n    private _pointerObserver: Nullable<BABYLON.Observer<BABYLON.PointerInfo>> = null;\n    /**\n     * Scale distance in babylon units that the gizmo will snap to when dragged (Default: 0)\n     */\n    public snapDistance = 0;\n    /**\n     * Event that fires each time the gizmo snaps to a new location.\n     * * snapDistance is the the change in distance\n     */\n    public onSnapObservable = new BABYLON.Observable<{ snapDistance: number }>();\n    /**\n     * If the scaling operation should be done on all axis (default: false)\n     */\n    public uniformScaling = false;\n    /**\n     * Custom sensitivity value for the drag strength\n     */\n    public sensitivity = 1;\n\n    private _isEnabled: boolean = true;\n    private _parent: Nullable<ScaleGizmo> = null;\n\n    private _arrow: BABYLON.AbstractMesh;\n    private _coloredMaterial: BABYLON.StandardMaterial;\n    private _hoverMaterial: BABYLON.StandardMaterial;\n\n    /**\n     * Creates an AxisScaleGizmo\n     * @param gizmoLayer The utility layer the gizmo will be added to\n     * @param dragAxis The axis which the gizmo will be able to scale on\n     * @param color The color of the gizmo\n     * @param thickness display gizmo axis thickness\n     */\n    constructor(dragAxis: BABYLON.Vector3, color: BABYLON.Color3 = BABYLON.Color3.Gray(), gizmoLayer: UtilityLayerRenderer = UtilityLayerRenderer.DefaultUtilityLayer, parent: Nullable<ScaleGizmo> = null, thickness: number = 1) {\n        super(gizmoLayer);\n        this._parent = parent;\n        // Create Material\n        this._coloredMaterial = new BABYLON.StandardMaterial(\"\", gizmoLayer.utilityLayerScene);\n        this._coloredMaterial.diffuseColor = color;\n        this._coloredMaterial.specularColor = color.subtract(new BABYLON.Color3(0.1, 0.1, 0.1));\n\n        this._hoverMaterial = new BABYLON.StandardMaterial(\"\", gizmoLayer.utilityLayerScene);\n        this._hoverMaterial.diffuseColor = color.add(new BABYLON.Color3(0.3, 0.3, 0.3));\n\n        // Build mesh on root node\n        this._arrow = new BABYLON.AbstractMesh(\"\", gizmoLayer.utilityLayerScene);\n        var arrowMesh = BABYLON.BoxBuilder.CreateBox(\"yPosMesh\", { size: 0.4 * (1 + (thickness - 1) / 4) }, gizmoLayer.utilityLayerScene);\n        var arrowTail = BABYLON.CylinderBuilder.CreateCylinder(\"cylinder\", { diameterTop: 0.005 * thickness, height: 0.275, diameterBottom: 0.005 * thickness, tessellation: 96 }, gizmoLayer.utilityLayerScene);\n        arrowTail.material = this._coloredMaterial;\n        this._arrow.addChild(arrowMesh);\n        this._arrow.addChild(arrowTail);\n\n        // Position arrow pointing in its drag axis\n        arrowMesh.scaling.scaleInPlace(0.1);\n        arrowMesh.material = this._coloredMaterial;\n        arrowMesh.rotation.x = Math.PI / 2;\n        arrowMesh.position.z += 0.3;\n        arrowTail.position.z += 0.275 / 2;\n        arrowTail.rotation.x = Math.PI / 2;\n        this._arrow.lookAt(this._rootMesh.position.add(dragAxis));\n        this._rootMesh.addChild(this._arrow);\n        this._arrow.scaling.scaleInPlace(1 / 3);\n\n        // Add drag behavior to handle events when the gizmo is dragged\n        this.dragBehavior = new BABYLON.PointerDragBehavior({ dragAxis: dragAxis });\n        this.dragBehavior.moveAttached = false;\n        this._rootMesh.addBehavior(this.dragBehavior);\n\n        var currentSnapDragDistance = 0;\n        var tmpVector = new BABYLON.Vector3();\n        var tmpSnapEvent = { snapDistance: 0 };\n        this.dragBehavior.onDragObservable.add((event) => {\n            if (this.attachedNode) {\n                // Drag strength is modified by the scale of the gizmo (eg. for small objects like boombox the strength will be increased to match the behavior of larger objects)\n                var dragStrength = this.sensitivity * event.dragDistance * ((this.scaleRatio * 3) / this._rootMesh.scaling.length());\n\n                // Snapping logic\n                var snapped = false;\n                var dragSteps = 0;\n                if (this.uniformScaling) {\n                    this.attachedNode.getWorldMatrix().decompose(tmpVector);\n                    tmpVector.normalize();\n                    if (tmpVector.y < 0) {\n                        tmpVector.scaleInPlace(-1);\n                    }\n                } else {\n                    tmpVector.copyFrom(dragAxis);\n                }\n                if (this.snapDistance == 0) {\n                    tmpVector.scaleToRef(dragStrength, tmpVector);\n                } else {\n                    currentSnapDragDistance += dragStrength;\n                    if (Math.abs(currentSnapDragDistance) > this.snapDistance) {\n                        dragSteps = Math.floor(Math.abs(currentSnapDragDistance) / this.snapDistance);\n                        if (currentSnapDragDistance < 0) {\n                            dragSteps *= -1;\n                        }\n                        currentSnapDragDistance = currentSnapDragDistance % this.snapDistance;\n                        tmpVector.scaleToRef(this.snapDistance * dragSteps, tmpVector);\n                        snapped = true;\n                    } else {\n                        tmpVector.scaleInPlace(0);\n                    }\n                }\n\n                const scalingMatrix = new BABYLON.Matrix();\n                BABYLON.Matrix.ScalingToRef(1 + tmpVector.x, 1 + tmpVector.y, 1 + tmpVector.z, scalingMatrix);\n                this.attachedNode.getWorldMatrix().copyFrom(scalingMatrix.multiply(this.attachedNode.getWorldMatrix()));\n\n                if (snapped) {\n                    tmpSnapEvent.snapDistance = this.snapDistance * dragSteps;\n                    this.onSnapObservable.notifyObservers(tmpSnapEvent);\n                }\n                this._operationType = 'scale';\n                this._matrixChanged();\n            }\n        });\n\n        this._pointerObserver = gizmoLayer.utilityLayerScene.onPointerObservable.add((pointerInfo) => {\n            if (this._customMeshSet) {\n                return;\n            }\n            var isHovered = pointerInfo.pickInfo && (this._rootMesh.getChildMeshes().indexOf(<BABYLON.Mesh>pointerInfo.pickInfo.pickedMesh) != -1);\n            var material = isHovered ? this._hoverMaterial : this._coloredMaterial;\n            this._rootMesh.getChildMeshes().forEach((m) => {\n                m.material = material;\n                if ((<BABYLON.LinesMesh>m).color) {\n                    (<BABYLON.LinesMesh>m).color = material.diffuseColor;\n                }\n            });\n        });\n\n        var light = gizmoLayer._getSharedGizmoLight();\n        light.includedOnlyMeshes = light.includedOnlyMeshes.concat(this._rootMesh.getChildMeshes());\n    }\n\n    protected _attachedNodeChanged(value: Nullable<BABYLON.Node>) {\n        if (this.dragBehavior) {\n            this.dragBehavior.enabled = value ? true : false;\n        }\n    }\n\n    /**\n * If the gizmo is enabled\n */\n    public set isEnabled(value: boolean) {\n        this._isEnabled = value;\n        if (!value) {\n            this.attachedMesh = null;\n            this.attachedNode = null;\n        }\n        else {\n            if (this._parent) {\n                this.attachedMesh = this._parent.attachedMesh;\n                this.attachedNode = this._parent.attachedNode;\n            }\n        }\n    }\n    public get isEnabled(): boolean {\n        return this._isEnabled;\n    }\n\n    /**\n     * Disposes of the gizmo\n     */\n    public dispose() {\n        this.onSnapObservable.clear();\n        this.gizmoLayer.utilityLayerScene.onPointerObservable.remove(this._pointerObserver);\n        this.dragBehavior.detach();\n        if (this._arrow) {\n            this._arrow.dispose();\n        }\n        [this._coloredMaterial, this._hoverMaterial].forEach((matl) => {\n            if (matl) {\n                matl.dispose();\n            }\n        });\n        super.dispose();\n    }\n\n    /**\n     * Disposes and replaces the current meshes in the gizmo with the specified mesh\n     * @param mesh The mesh to replace the default mesh of the gizmo\n     * @param useGizmoMaterial If the gizmo's default material should be used (default: false)\n     */\n    public setCustomMesh(mesh: BABYLON.Mesh, useGizmoMaterial: boolean = false) {\n        super.setCustomMesh(mesh);\n        if (useGizmoMaterial) {\n            this._rootMesh.getChildMeshes().forEach((m) => {\n                m.material = this._coloredMaterial;\n                if ((<BABYLON.LinesMesh>m).color) {\n                    (<BABYLON.LinesMesh>m).color = this._coloredMaterial.diffuseColor;\n                }\n            });\n            this._customMeshSet = false;\n        }\n    }\n}\n","// import { Observer, Observable } from \"../Misc/observable\";\n// import { Logger } from \"../Misc/logger\";\n// import { Nullable } from \"../types\";\n// import { PointerInfo } from \"../Events/pointerEvents\";\n// import { Scene } from \"../scene\";\n// import { Quaternion, Matrix, Vector3 } from \"../Maths/math.vector\";\n// import { AbstractMesh } from \"../Meshes/abstractMesh\";\n// import { Mesh } from \"../Meshes/mesh\";\n// import { SphereBuilder } from \"../Meshes/Builders/sphereBuilder\";\n// import { BoxBuilder } from \"../Meshes/Builders/boxBuilder\";\n// import { LinesBuilder } from \"../Meshes/Builders/linesBuilder\";\n// import { PointerDragBehavior } from \"../Behaviors/Meshes/pointerDragBehavior\";\nimport { Gizmo } from \"./gizmo\";\nimport { UtilityLayerRenderer } from \"./UtilityLayerRenderer\";\n// import { UtilityLayerRenderer } from \"../Rendering/utilityLayerRenderer\";\n// import { StandardMaterial } from \"../Materials/standardMaterial\";\n// import { PivotTools } from \"../Misc/pivotTools\";\n// import { Color3 } from '../Maths/math.color';\n\n// import \"../Meshes/Builders/boxBuilder\";\n// import { LinesMesh } from '../Meshes/linesMesh';\n// import { Epsilon } from '../Maths/math.constants';\n\n/**\n * Bounding box gizmo\n */\nexport class BoundingBoxGizmo extends Gizmo {\n    private _lineBoundingBox: BABYLON.AbstractMesh;\n    private _rotateSpheresParent: BABYLON.AbstractMesh;\n    private _scaleBoxesParent: BABYLON.AbstractMesh;\n    private _boundingDimensions = new BABYLON.Vector3(1, 1, 1);\n    private _renderObserver: Nullable<BABYLON.Observer<BABYLON.Scene>> = null;\n    private _pointerObserver: Nullable<BABYLON.Observer<BABYLON.PointerInfo>> = null;\n    private _scaleDragSpeed = 0.2;\n\n    private _tmpQuaternion = new BABYLON.Quaternion();\n    private _tmpVector = new BABYLON.Vector3(0, 0, 0);\n    private _tmpRotationMatrix = new BABYLON.Matrix();\n    /**\n     * If child meshes should be ignored when calculating the boudning box. This should be set to true to avoid perf hits with heavily nested meshes (Default: false)\n     */\n    public ignoreChildren = false;\n    /**\n     * Returns true if a descendant should be included when computing the bounding box. When null, all descendants are included. If ignoreChildren is set this will be ignored. (Default: null)\n     */\n    public includeChildPredicate: Nullable<(abstractMesh: BABYLON.AbstractMesh) => boolean> = null;\n\n    /**\n     * The size of the rotation spheres attached to the bounding box (Default: 0.1)\n     */\n    public rotationSphereSize = 0.1;\n    /**\n     * The size of the scale boxes attached to the bounding box (Default: 0.1)\n     */\n    public scaleBoxSize = 0.1;\n    /**\n     * If set, the rotation spheres and scale boxes will increase in size based on the distance away from the camera to have a consistent screen size (Default: false)\n     */\n    public fixedDragMeshScreenSize = false;\n\n    /**\n     * The distance away from the object which the draggable meshes should appear world sized when fixedDragMeshScreenSize is set to true (default: 10)\n     */\n    public fixedDragMeshScreenSizeDistanceFactor = 10;\n    /**\n     * Fired when a rotation sphere or scale box is dragged\n     */\n    public onDragStartObservable = new BABYLON.Observable<{}>();\n    /**\n     * Fired when a scale box is dragged\n     */\n    public onScaleBoxDragObservable = new BABYLON.Observable<{}>();\n    /**\n      * Fired when a scale box drag is ended\n     */\n    public onScaleBoxDragEndObservable = new BABYLON.Observable<{}>();\n    /**\n     * Fired when a rotation sphere is dragged\n     */\n    public onRotationSphereDragObservable = new BABYLON.Observable<{}>();\n    /**\n     * Fired when a rotation sphere drag is ended\n     */\n    public onRotationSphereDragEndObservable = new BABYLON.Observable<{}>();\n    /**\n     * Relative bounding box pivot used when scaling the attached node. When null object with scale from the opposite corner. 0.5,0.5,0.5 for center and 0.5,0,0.5 for bottom (Default: null)\n     */\n    public scalePivot: Nullable<BABYLON.Vector3> = null;\n\n    /**\n     * Mesh used as a pivot to rotate the attached node\n     */\n    private _anchorMesh: BABYLON.AbstractMesh;\n\n    private _existingMeshScale = new BABYLON.Vector3();\n\n    // Dragging\n    private _dragMesh: Nullable<BABYLON.Mesh> = null;\n    private pointerDragBehavior = new BABYLON.PointerDragBehavior();\n\n    private coloredMaterial: BABYLON.StandardMaterial;\n    private hoverColoredMaterial: BABYLON.StandardMaterial;\n\n    /**\n     * Sets the color of the bounding box gizmo\n     * @param color the color to set\n     */\n    public setColor(color: BABYLON.Color3) {\n        this.coloredMaterial.emissiveColor = color;\n        this.hoverColoredMaterial.emissiveColor = color.clone().add(new BABYLON.Color3(0.3, 0.3, 0.3));\n        this._lineBoundingBox.getChildren().forEach((l) => {\n            if ((l as BABYLON.LinesMesh).color) {\n                (l as BABYLON.LinesMesh).color = color;\n            }\n        });\n    }\n    /**\n     * Creates an BoundingBoxGizmo\n     * @param gizmoLayer The utility layer the gizmo will be added to\n     * @param color The color of the gizmo\n     */\n    constructor(color: BABYLON.Color3 = BABYLON.Color3.Gray(), gizmoLayer: UtilityLayerRenderer = UtilityLayerRenderer.DefaultKeepDepthUtilityLayer) {\n        super(gizmoLayer);\n\n        // Do not update the gizmo's scale so it has a fixed size to the object its attached to\n        this.updateScale = false;\n\n        this._anchorMesh = new BABYLON.AbstractMesh(\"anchor\", gizmoLayer.utilityLayerScene);\n        // Create Materials\n        this.coloredMaterial = new BABYLON.StandardMaterial(\"\", gizmoLayer.utilityLayerScene);\n        this.coloredMaterial.disableLighting = true;\n        this.hoverColoredMaterial = new BABYLON.StandardMaterial(\"\", gizmoLayer.utilityLayerScene);\n        this.hoverColoredMaterial.disableLighting = true;\n\n        // Build bounding box out of lines\n        this._lineBoundingBox = new BABYLON.AbstractMesh(\"\", gizmoLayer.utilityLayerScene);\n        this._lineBoundingBox.rotationQuaternion = new BABYLON.Quaternion();\n        var lines = [];\n        lines.push(BABYLON.LinesBuilder.CreateLines(\"lines\", { points: [new BABYLON.Vector3(0, 0, 0), new BABYLON.Vector3(this._boundingDimensions.x, 0, 0)] }, gizmoLayer.utilityLayerScene));\n        lines.push(BABYLON.LinesBuilder.CreateLines(\"lines\", { points: [new BABYLON.Vector3(0, 0, 0), new BABYLON.Vector3(0, this._boundingDimensions.y, 0)] }, gizmoLayer.utilityLayerScene));\n        lines.push(BABYLON.LinesBuilder.CreateLines(\"lines\", { points: [new BABYLON.Vector3(0, 0, 0), new BABYLON.Vector3(0, 0, this._boundingDimensions.z)] }, gizmoLayer.utilityLayerScene));\n        lines.push(BABYLON.LinesBuilder.CreateLines(\"lines\", { points: [new BABYLON.Vector3(this._boundingDimensions.x, 0, 0), new BABYLON.Vector3(this._boundingDimensions.x, this._boundingDimensions.y, 0)] }, gizmoLayer.utilityLayerScene));\n        lines.push(BABYLON.LinesBuilder.CreateLines(\"lines\", { points: [new BABYLON.Vector3(this._boundingDimensions.x, 0, 0), new BABYLON.Vector3(this._boundingDimensions.x, 0, this._boundingDimensions.z)] }, gizmoLayer.utilityLayerScene));\n        lines.push(BABYLON.LinesBuilder.CreateLines(\"lines\", { points: [new BABYLON.Vector3(0, this._boundingDimensions.y, 0), new BABYLON.Vector3(this._boundingDimensions.x, this._boundingDimensions.y, 0)] }, gizmoLayer.utilityLayerScene));\n        lines.push(BABYLON.LinesBuilder.CreateLines(\"lines\", { points: [new BABYLON.Vector3(0, this._boundingDimensions.y, 0), new BABYLON.Vector3(0, this._boundingDimensions.y, this._boundingDimensions.z)] }, gizmoLayer.utilityLayerScene));\n        lines.push(BABYLON.LinesBuilder.CreateLines(\"lines\", { points: [new BABYLON.Vector3(0, 0, this._boundingDimensions.z), new BABYLON.Vector3(this._boundingDimensions.x, 0, this._boundingDimensions.z)] }, gizmoLayer.utilityLayerScene));\n        lines.push(BABYLON.LinesBuilder.CreateLines(\"lines\", { points: [new BABYLON.Vector3(0, 0, this._boundingDimensions.z), new BABYLON.Vector3(0, this._boundingDimensions.y, this._boundingDimensions.z)] }, gizmoLayer.utilityLayerScene));\n        lines.push(BABYLON.LinesBuilder.CreateLines(\"lines\", { points: [new BABYLON.Vector3(this._boundingDimensions.x, this._boundingDimensions.y, this._boundingDimensions.z), new BABYLON.Vector3(0, this._boundingDimensions.y, this._boundingDimensions.z)] }, gizmoLayer.utilityLayerScene));\n        lines.push(BABYLON.LinesBuilder.CreateLines(\"lines\", { points: [new BABYLON.Vector3(this._boundingDimensions.x, this._boundingDimensions.y, this._boundingDimensions.z), new BABYLON.Vector3(this._boundingDimensions.x, 0, this._boundingDimensions.z)] }, gizmoLayer.utilityLayerScene));\n        lines.push(BABYLON.LinesBuilder.CreateLines(\"lines\", { points: [new BABYLON.Vector3(this._boundingDimensions.x, this._boundingDimensions.y, this._boundingDimensions.z), new BABYLON.Vector3(this._boundingDimensions.x, this._boundingDimensions.y, 0)] }, gizmoLayer.utilityLayerScene));\n        lines.forEach((l) => {\n            l.color = color;\n            l.position.addInPlace(new BABYLON.Vector3(-this._boundingDimensions.x / 2, -this._boundingDimensions.y / 2, -this._boundingDimensions.z / 2));\n            l.isPickable = false;\n            this._lineBoundingBox.addChild(l);\n        });\n        this._rootMesh.addChild(this._lineBoundingBox);\n\n        this.setColor(color);\n\n        // Create rotation spheres\n        this._rotateSpheresParent = new BABYLON.AbstractMesh(\"\", gizmoLayer.utilityLayerScene);\n        this._rotateSpheresParent.rotationQuaternion = new BABYLON.Quaternion();\n        for (let i = 0; i < 12; i++) {\n            let sphere = BABYLON.SphereBuilder.CreateSphere(\"\", { diameter: 1 }, gizmoLayer.utilityLayerScene);\n            sphere.rotationQuaternion = new BABYLON.Quaternion();\n            sphere.material = this.coloredMaterial;\n\n            // Drag behavior\n            var _dragBehavior = new BABYLON.PointerDragBehavior({});\n            _dragBehavior.moveAttached = false;\n            _dragBehavior.updateDragPlane = false;\n            sphere.addBehavior(_dragBehavior);\n            let startingTurnDirection = new BABYLON.Vector3(1, 0, 0);\n            let totalTurnAmountOfDrag = 0;\n            _dragBehavior.onDragStartObservable.add(() => {\n                startingTurnDirection.copyFrom(sphere.forward);\n                totalTurnAmountOfDrag = 0;\n            });\n            _dragBehavior.onDragObservable.add((event) => {\n                this.onRotationSphereDragObservable.notifyObservers({});\n                if (this.attachedMesh) {\n                    var originalParent = this.attachedMesh.parent;\n                    if (originalParent && ((originalParent as BABYLON.Mesh).scaling && (originalParent as BABYLON.Mesh).scaling.isNonUniformWithinEpsilon(0.001))) {\n                        BABYLON.Logger.Warn(\"BoundingBoxGizmo controls are not supported on child meshes with non-uniform parent scaling\");\n                        return;\n                    }\n                    BABYLON.PivotTools._RemoveAndStorePivotPoint(this.attachedMesh);\n\n                    var worldDragDirection = startingTurnDirection;\n\n                    // Project the world right on to the drag plane\n                    var toSub = event.dragPlaneNormal.scale(BABYLON.Vector3.Dot(event.dragPlaneNormal, worldDragDirection));\n                    var dragAxis = worldDragDirection.subtract(toSub).normalizeToNew();\n\n                    // project drag delta on to the resulting drag axis and rotate based on that\n                    var projectDist = BABYLON.Vector3.Dot(dragAxis, event.delta) < 0 ? Math.abs(event.delta.length()) : -Math.abs(event.delta.length());\n\n                    // Make rotation relative to size of mesh.\n                    projectDist = (projectDist / this._boundingDimensions.length()) * this._anchorMesh.scaling.length();\n\n                    // Rotate based on axis\n                    if (!this.attachedMesh.rotationQuaternion) {\n                        this.attachedMesh.rotationQuaternion = BABYLON.Quaternion.RotationYawPitchRoll(this.attachedMesh.rotation.y, this.attachedMesh.rotation.x, this.attachedMesh.rotation.z);\n                    }\n                    if (!this._anchorMesh.rotationQuaternion) {\n                        this._anchorMesh.rotationQuaternion = BABYLON.Quaternion.RotationYawPitchRoll(this._anchorMesh.rotation.y, this._anchorMesh.rotation.x, this._anchorMesh.rotation.z);\n                    }\n\n                    // Do not allow the object to turn more than a full circle\n                    totalTurnAmountOfDrag += projectDist;\n                    if (Math.abs(totalTurnAmountOfDrag) <= 2 * Math.PI) {\n                        if (i >= 8) {\n                            BABYLON.Quaternion.RotationYawPitchRollToRef(0, 0, projectDist, this._tmpQuaternion);\n                        } else if (i >= 4) {\n                            BABYLON.Quaternion.RotationYawPitchRollToRef(projectDist, 0, 0, this._tmpQuaternion);\n                        } else {\n                            BABYLON.Quaternion.RotationYawPitchRollToRef(0, projectDist, 0, this._tmpQuaternion);\n                        }\n\n                        // Rotate around center of bounding box\n                        this._anchorMesh.addChild(this.attachedMesh);\n                        this._anchorMesh.rotationQuaternion!.multiplyToRef(this._tmpQuaternion, this._anchorMesh.rotationQuaternion!);\n                        this._anchorMesh.removeChild(this.attachedMesh);\n                        this.attachedMesh.setParent(originalParent);\n                    }\n                    this.updateBoundingBox();\n\n                    BABYLON.PivotTools._RestorePivotPoint(this.attachedMesh);\n                }\n                this._updateDummy();\n            });\n\n            // Selection/deselection\n            _dragBehavior.onDragStartObservable.add(() => {\n                this.onDragStartObservable.notifyObservers({});\n                this._selectNode(sphere);\n            });\n            _dragBehavior.onDragEndObservable.add(() => {\n                this.onRotationSphereDragEndObservable.notifyObservers({});\n                this._selectNode(null);\n                this._updateDummy();\n            });\n\n            this._rotateSpheresParent.addChild(sphere);\n        }\n        this._rootMesh.addChild(this._rotateSpheresParent);\n\n        // Create scale cubes\n        this._scaleBoxesParent = new BABYLON.AbstractMesh(\"\", gizmoLayer.utilityLayerScene);\n        this._scaleBoxesParent.rotationQuaternion = new BABYLON.Quaternion();\n        for (var i = 0; i < 3; i++) {\n            for (var j = 0; j < 3; j++) {\n                for (var k = 0; k < 3; k++) {\n                    // create box for relevant axis\n                    let zeroAxisCount = ((i === 1) ? 1 : 0) + ((j === 1) ? 1 : 0) + ((k === 1) ? 1 : 0);\n                    if (zeroAxisCount === 1 || zeroAxisCount === 3) {\n                        continue;\n                    }\n\n                    let box = BABYLON.BoxBuilder.CreateBox(\"\", { size: 1 }, gizmoLayer.utilityLayerScene);\n                    box.material = this.coloredMaterial;\n                    box.metadata = zeroAxisCount === 2; // None homogenous scale handle\n\n                    // Dragging logic\n                    let dragAxis = new BABYLON.Vector3(i - 1, j - 1, k - 1).normalize();\n                    var _dragBehavior = new BABYLON.PointerDragBehavior({ dragAxis: dragAxis });\n                    _dragBehavior.updateDragPlane = false;\n                    _dragBehavior.moveAttached = false;\n                    box.addBehavior(_dragBehavior);\n                    _dragBehavior.onDragObservable.add((event) => {\n                        this.onScaleBoxDragObservable.notifyObservers({});\n                        if (this.attachedMesh) {\n                            var originalParent = this.attachedMesh.parent;\n                            if (originalParent && ((originalParent as BABYLON.Mesh).scaling && (originalParent as BABYLON.Mesh).scaling.isNonUniformWithinEpsilon(0.001))) {\n                                BABYLON.Logger.Warn(\"BoundingBoxGizmo controls are not supported on child meshes with non-uniform parent scaling\");\n                                return;\n                            }\n                            BABYLON.PivotTools._RemoveAndStorePivotPoint(this.attachedMesh);\n                            var relativeDragDistance = (event.dragDistance / this._boundingDimensions.length()) * this._anchorMesh.scaling.length();\n                            var deltaScale = new BABYLON.Vector3(relativeDragDistance, relativeDragDistance, relativeDragDistance);\n                            if (zeroAxisCount === 2) {\n                                // scale on 1 axis when using the anchor box in the face middle\n                                deltaScale.x *= Math.abs(dragAxis.x);\n                                deltaScale.y *= Math.abs(dragAxis.y);\n                                deltaScale.z *= Math.abs(dragAxis.z);\n                            }\n                            deltaScale.scaleInPlace(this._scaleDragSpeed);\n                            this.updateBoundingBox();\n                            if (this.scalePivot) {\n                                this.attachedMesh.getWorldMatrix().getRotationMatrixToRef(this._tmpRotationMatrix);\n                                // Move anchor to desired pivot point (Bottom left corner + dimension/2)\n                                this._boundingDimensions.scaleToRef(0.5, this._tmpVector);\n                                BABYLON.Vector3.TransformCoordinatesToRef(this._tmpVector, this._tmpRotationMatrix, this._tmpVector);\n                                this._anchorMesh.position.subtractInPlace(this._tmpVector);\n                                this._boundingDimensions.multiplyToRef(this.scalePivot, this._tmpVector);\n                                BABYLON.Vector3.TransformCoordinatesToRef(this._tmpVector, this._tmpRotationMatrix, this._tmpVector);\n                                this._anchorMesh.position.addInPlace(this._tmpVector);\n                            } else {\n                                // Scale from the position of the opposite corner\n                                box.absolutePosition.subtractToRef(this._anchorMesh.position, this._tmpVector);\n                                this._anchorMesh.position.subtractInPlace(this._tmpVector);\n                            }\n\n                            this._anchorMesh.addChild(this.attachedMesh);\n                            this._anchorMesh.scaling.addInPlace(deltaScale);\n                            if (this._anchorMesh.scaling.x < 0 || this._anchorMesh.scaling.y < 0 || this._anchorMesh.scaling.z < 0) {\n                                this._anchorMesh.scaling.subtractInPlace(deltaScale);\n                            }\n                            this._anchorMesh.removeChild(this.attachedMesh);\n                            this.attachedMesh.setParent(originalParent);\n                            BABYLON.PivotTools._RestorePivotPoint(this.attachedMesh);\n                        }\n                        this._updateDummy();\n                    });\n\n                    // Selection/deselection\n                    _dragBehavior.onDragStartObservable.add(() => {\n                        this.onDragStartObservable.notifyObservers({});\n                        this._selectNode(box);\n                    });\n                    _dragBehavior.onDragEndObservable.add(() => {\n                        this.onScaleBoxDragEndObservable.notifyObservers({});\n                        this._selectNode(null);\n                        this._updateDummy();\n                    });\n\n                    this._scaleBoxesParent.addChild(box);\n                }\n            }\n        }\n        this._rootMesh.addChild(this._scaleBoxesParent);\n\n        // Hover color change\n        var pointerIds = new Array<BABYLON.AbstractMesh>();\n        this._pointerObserver = gizmoLayer.utilityLayerScene.onPointerObservable.add((pointerInfo) => {\n            if (!pointerIds[(<PointerEvent>pointerInfo.event).pointerId]) {\n                this._rotateSpheresParent.getChildMeshes().concat(this._scaleBoxesParent.getChildMeshes()).forEach((mesh) => {\n                    if (pointerInfo.pickInfo && pointerInfo.pickInfo.pickedMesh == mesh) {\n                        pointerIds[(<PointerEvent>pointerInfo.event).pointerId] = mesh;\n                        mesh.material = this.hoverColoredMaterial;\n                    }\n                });\n            } else {\n                if (pointerInfo.pickInfo && pointerInfo.pickInfo.pickedMesh != pointerIds[(<PointerEvent>pointerInfo.event).pointerId]) {\n                    pointerIds[(<PointerEvent>pointerInfo.event).pointerId].material = this.coloredMaterial;\n                    delete pointerIds[(<PointerEvent>pointerInfo.event).pointerId];\n                }\n            }\n        });\n\n        // Update bounding box positions\n        this._renderObserver = this.gizmoLayer.originalScene.onBeforeRenderObservable.add(() => {\n            // Only update the bouding box if scaling has changed\n            if (this.attachedMesh && !this._existingMeshScale.equals(this.attachedMesh.scaling)) {\n                this.updateBoundingBox();\n            } else if (this.fixedDragMeshScreenSize) {\n                this._updateRotationSpheres();\n                this._updateScaleBoxes();\n            }\n\n            // If dragg mesh is enabled and dragging, update the attached mesh pose to match the drag mesh\n            if (this._dragMesh && this.attachedMesh && this.pointerDragBehavior.dragging) {\n                this._lineBoundingBox.position.rotateByQuaternionToRef(this._rootMesh.rotationQuaternion!, this._tmpVector);\n                this.attachedMesh.setAbsolutePosition(this._dragMesh.position.add(this._tmpVector.scale(-1)));\n            }\n        });\n        this.updateBoundingBox();\n    }\n\n    protected _attachedNodeChanged(value: Nullable<BABYLON.AbstractMesh>) {\n        if (value) {\n            // Reset anchor mesh to match attached mesh's scale\n            // This is needed to avoid invalid box/sphere position on first drag\n            BABYLON.PivotTools._RemoveAndStorePivotPoint(value);\n            var originalParent = value.parent;\n            this._anchorMesh.addChild(value);\n            this._anchorMesh.removeChild(value);\n            value.setParent(originalParent);\n            BABYLON.PivotTools._RestorePivotPoint(value);\n            this.updateBoundingBox();\n            value.getChildMeshes(false).forEach((m) => {\n                m.markAsDirty(\"scaling\");\n            });\n\n            this.gizmoLayer.utilityLayerScene.onAfterRenderObservable.addOnce(() => {\n                this._updateDummy();\n            });\n        }\n    }\n\n    private _selectNode(selectedMesh: Nullable<BABYLON.Mesh>) {\n        this._rotateSpheresParent.getChildMeshes()\n            .concat(this._scaleBoxesParent.getChildMeshes()).forEach((m) => {\n                m.isVisible = (!selectedMesh || m == selectedMesh);\n            });\n    }\n\n    /**\n     * Updates the bounding box information for the Gizmo\n     */\n    public updateBoundingBox() {\n        if (this.attachedMesh) {\n            BABYLON.PivotTools._RemoveAndStorePivotPoint(this.attachedMesh);\n\n            // Store original parent\n            var originalParent = this.attachedMesh.parent;\n            this.attachedMesh.setParent(null);\n\n            // Store original skelton override mesh\n            var originalSkeletonOverrideMesh = null;\n            if (this.attachedMesh.skeleton) {\n                originalSkeletonOverrideMesh = this.attachedMesh.skeleton.overrideMesh;\n                this.attachedMesh.skeleton.overrideMesh = null;\n            }\n\n            this._update();\n\n            // Rotate based on axis\n            if (!this.attachedMesh.rotationQuaternion) {\n                this.attachedMesh.rotationQuaternion = BABYLON.Quaternion.RotationYawPitchRoll(this.attachedMesh.rotation.y, this.attachedMesh.rotation.x, this.attachedMesh.rotation.z);\n            }\n            if (!this._anchorMesh.rotationQuaternion) {\n                this._anchorMesh.rotationQuaternion = BABYLON.Quaternion.RotationYawPitchRoll(this._anchorMesh.rotation.y, this._anchorMesh.rotation.x, this._anchorMesh.rotation.z);\n            }\n            this._anchorMesh.rotationQuaternion.copyFrom(this.attachedMesh.rotationQuaternion);\n\n            // Store original position and reset mesh to origin before computing the bounding box\n            this._tmpQuaternion.copyFrom(this.attachedMesh.rotationQuaternion);\n            this._tmpVector.copyFrom(this.attachedMesh.position);\n            this.attachedMesh.rotationQuaternion.set(0, 0, 0, 1);\n            this.attachedMesh.position.set(0, 0, 0);\n\n            // Update bounding dimensions/positions\n            var boundingMinMax = this.attachedMesh.getHierarchyBoundingVectors(!this.ignoreChildren, this.includeChildPredicate);\n            boundingMinMax.max.subtractToRef(boundingMinMax.min, this._boundingDimensions);\n\n            // Update gizmo to match bounding box scaling and rotation\n            // The position set here is the offset from the origin for the boundingbox when the attached mesh is at the origin\n            // The position of the gizmo is then set to the attachedMesh in gizmo._update\n            this._lineBoundingBox.scaling.copyFrom(this._boundingDimensions);\n            this._lineBoundingBox.position.set((boundingMinMax.max.x + boundingMinMax.min.x) / 2, (boundingMinMax.max.y + boundingMinMax.min.y) / 2, (boundingMinMax.max.z + boundingMinMax.min.z) / 2);\n            this._rotateSpheresParent.position.copyFrom(this._lineBoundingBox.position);\n            this._scaleBoxesParent.position.copyFrom(this._lineBoundingBox.position);\n            this._lineBoundingBox.computeWorldMatrix();\n            this._anchorMesh.position.copyFrom(this._lineBoundingBox.absolutePosition);\n\n            // Restore position/rotation values\n            this.attachedMesh.rotationQuaternion.copyFrom(this._tmpQuaternion);\n            this.attachedMesh.position.copyFrom(this._tmpVector);\n\n            // Restore original parent\n            this.attachedMesh.setParent(originalParent);\n\n            // Restore original skeleton override mesh\n            if (this.attachedMesh.skeleton) {\n                this.attachedMesh.skeleton.overrideMesh = originalSkeletonOverrideMesh;\n            }\n        }\n\n        this._updateRotationSpheres();\n        this._updateScaleBoxes();\n\n        if (this.attachedMesh) {\n            this._existingMeshScale.copyFrom(this.attachedMesh.scaling);\n            BABYLON.PivotTools._RestorePivotPoint(this.attachedMesh);\n        }\n    }\n\n    private _updateRotationSpheres() {\n        var rotateSpheres = this._rotateSpheresParent.getChildMeshes();\n        for (var i = 0; i < 3; i++) {\n            for (var j = 0; j < 2; j++) {\n                for (var k = 0; k < 2; k++) {\n                    var index = ((i * 4) + (j * 2)) + k;\n                    if (i == 0) {\n                        rotateSpheres[index].position.set(this._boundingDimensions.x / 2, this._boundingDimensions.y * j, this._boundingDimensions.z * k);\n                        rotateSpheres[index].position.addInPlace(new BABYLON.Vector3(-this._boundingDimensions.x / 2, -this._boundingDimensions.y / 2, -this._boundingDimensions.z / 2));\n                        rotateSpheres[index].lookAt(BABYLON.Vector3.Cross(rotateSpheres[index].position.normalizeToNew(), BABYLON.Vector3.Right()).normalizeToNew().add(rotateSpheres[index].position));\n                    }\n                    if (i == 1) {\n                        rotateSpheres[index].position.set(this._boundingDimensions.x * j, this._boundingDimensions.y / 2, this._boundingDimensions.z * k);\n                        rotateSpheres[index].position.addInPlace(new BABYLON.Vector3(-this._boundingDimensions.x / 2, -this._boundingDimensions.y / 2, -this._boundingDimensions.z / 2));\n                        rotateSpheres[index].lookAt(BABYLON.Vector3.Cross(rotateSpheres[index].position.normalizeToNew(), BABYLON.Vector3.Up()).normalizeToNew().add(rotateSpheres[index].position));\n                    }\n                    if (i == 2) {\n                        rotateSpheres[index].position.set(this._boundingDimensions.x * j, this._boundingDimensions.y * k, this._boundingDimensions.z / 2);\n                        rotateSpheres[index].position.addInPlace(new BABYLON.Vector3(-this._boundingDimensions.x / 2, -this._boundingDimensions.y / 2, -this._boundingDimensions.z / 2));\n                        rotateSpheres[index].lookAt(BABYLON.Vector3.Cross(rotateSpheres[index].position.normalizeToNew(), BABYLON.Vector3.Forward()).normalizeToNew().add(rotateSpheres[index].position));\n                    }\n                    if (this.fixedDragMeshScreenSize && this.gizmoLayer.utilityLayerScene.activeCamera) {\n                        rotateSpheres[index].absolutePosition.subtractToRef(this.gizmoLayer.utilityLayerScene.activeCamera.position, this._tmpVector);\n                        var distanceFromCamera = this.rotationSphereSize * this._tmpVector.length() / this.fixedDragMeshScreenSizeDistanceFactor;\n                        rotateSpheres[index].scaling.set(distanceFromCamera, distanceFromCamera, distanceFromCamera);\n                    } else {\n                        rotateSpheres[index].scaling.set(this.rotationSphereSize, this.rotationSphereSize, this.rotationSphereSize);\n                    }\n                }\n            }\n        }\n    }\n\n    private _updateScaleBoxes() {\n        var scaleBoxes = this._scaleBoxesParent.getChildMeshes();\n        var index = 0;\n        for (var i = 0; i < 3; i++) {\n            for (var j = 0; j < 3; j++) {\n                for (var k = 0; k < 3; k++) {\n                    let zeroAxisCount = ((i === 1) ? 1 : 0) + ((j === 1) ? 1 : 0) + ((k === 1) ? 1 : 0);\n                    if (zeroAxisCount === 1 || zeroAxisCount === 3) {\n                        continue;\n                    }\n                    if (scaleBoxes[index]) {\n                        scaleBoxes[index].position.set(this._boundingDimensions.x * (i / 2), this._boundingDimensions.y * (j / 2), this._boundingDimensions.z * (k / 2));\n                        scaleBoxes[index].position.addInPlace(new BABYLON.Vector3(-this._boundingDimensions.x / 2, -this._boundingDimensions.y / 2, -this._boundingDimensions.z / 2));\n                        if (this.fixedDragMeshScreenSize && this.gizmoLayer.utilityLayerScene.activeCamera) {\n                            scaleBoxes[index].absolutePosition.subtractToRef(this.gizmoLayer.utilityLayerScene.activeCamera.position, this._tmpVector);\n                            var distanceFromCamera = this.scaleBoxSize * this._tmpVector.length() / this.fixedDragMeshScreenSizeDistanceFactor;\n                            scaleBoxes[index].scaling.set(distanceFromCamera, distanceFromCamera, distanceFromCamera);\n                        } else {\n                            scaleBoxes[index].scaling.set(this.scaleBoxSize, this.scaleBoxSize, this.scaleBoxSize);\n                        }\n                    }\n                    index++;\n                }\n            }\n        }\n    }\n\n    /**\n     * Enables rotation on the specified axis and disables rotation on the others\n     * @param axis The list of axis that should be enabled (eg. \"xy\" or \"xyz\")\n     */\n    public setEnabledRotationAxis(axis: string) {\n        this._rotateSpheresParent.getChildMeshes().forEach((m, i) => {\n            if (i < 4) {\n                m.setEnabled(axis.indexOf(\"x\") != -1);\n            } else if (i < 8) {\n                m.setEnabled(axis.indexOf(\"y\") != -1);\n            } else {\n                m.setEnabled(axis.indexOf(\"z\") != -1);\n            }\n        });\n    }\n\n    /**\n     * Enables/disables scaling\n     * @param enable if scaling should be enabled\n     * @param homogeneousScaling defines if scaling should only be homogeneous\n     */\n    public setEnabledScaling(enable: boolean, homogeneousScaling = false) {\n        this._scaleBoxesParent.getChildMeshes().forEach((m, i) => {\n            let enableMesh = enable;\n            // Disable heterogenous scale handles if requested.\n            if (homogeneousScaling && m.metadata === true) {\n                enableMesh = false;\n            }\n            m.setEnabled(enableMesh);\n        });\n    }\n\n    private _updateDummy() {\n        if (this._dragMesh) {\n            this._dragMesh.position.copyFrom(this._lineBoundingBox.getAbsolutePosition());\n            this._dragMesh.scaling.copyFrom(this._lineBoundingBox.scaling);\n            this._dragMesh.rotationQuaternion!.copyFrom(this._rootMesh.rotationQuaternion!);\n        }\n    }\n\n    /**\n     * Enables a pointer drag behavior on the bounding box of the gizmo\n     */\n    public enableDragBehavior() {\n        this._dragMesh = BABYLON.Mesh.CreateBox(\"dummy\", 1, this.gizmoLayer.utilityLayerScene);\n        this._dragMesh.visibility = 0;\n        this._dragMesh.rotationQuaternion = new BABYLON.Quaternion();\n        this.pointerDragBehavior.useObjectOrienationForDragging = false;\n        this._dragMesh.addBehavior(this.pointerDragBehavior);\n    }\n\n    /**\n     * Disposes of the gizmo\n     */\n    public dispose() {\n        this.gizmoLayer.utilityLayerScene.onPointerObservable.remove(this._pointerObserver);\n        this.gizmoLayer.originalScene.onBeforeRenderObservable.remove(this._renderObserver);\n        this._lineBoundingBox.dispose();\n        this._rotateSpheresParent.dispose();\n        this._scaleBoxesParent.dispose();\n        if (this._dragMesh) {\n            this._dragMesh.dispose();\n        }\n        super.dispose();\n    }\n\n    /**\n     * Makes a mesh not pickable and wraps the mesh inside of a bounding box mesh that is pickable. (This is useful to avoid picking within complex geometry)\n     * @param mesh the mesh to wrap in the bounding box mesh and make not pickable\n     * @returns the bounding box mesh with the passed in mesh as a child\n     */\n    public static MakeNotPickableAndWrapInBoundingBox(mesh: BABYLON.Mesh): BABYLON.Mesh {\n        var makeNotPickable = (root: BABYLON.AbstractMesh) => {\n            root.isPickable = false;\n            root.getChildMeshes().forEach((c) => {\n                makeNotPickable(c);\n            });\n        };\n        makeNotPickable(mesh);\n\n        // Reset position to get boudning box from origin with no rotation\n        if (!mesh.rotationQuaternion) {\n            mesh.rotationQuaternion = BABYLON.Quaternion.RotationYawPitchRoll(mesh.rotation.y, mesh.rotation.x, mesh.rotation.z);\n        }\n        var oldPos = mesh.position.clone();\n        var oldRot = mesh.rotationQuaternion.clone();\n        mesh.rotationQuaternion.set(0, 0, 0, 1);\n        mesh.position.set(0, 0, 0);\n\n        // Update bounding dimensions/positions\n        var box = BABYLON.BoxBuilder.CreateBox(\"box\", { size: 1 }, mesh.getScene());\n        var boundingMinMax = mesh.getHierarchyBoundingVectors();\n        boundingMinMax.max.subtractToRef(boundingMinMax.min, box.scaling);\n\n        // Adjust scale to avoid undefined behavior when adding child\n        if (box.scaling.y === 0) {\n            box.scaling.y = BABYLON.Epsilon;\n        }\n        if (box.scaling.x === 0) {\n            box.scaling.x = BABYLON.Epsilon;\n        }\n        if (box.scaling.z === 0) {\n            box.scaling.z = BABYLON.Epsilon;\n        }\n\n        box.position.set((boundingMinMax.max.x + boundingMinMax.min.x) / 2, (boundingMinMax.max.y + boundingMinMax.min.y) / 2, (boundingMinMax.max.z + boundingMinMax.min.z) / 2);\n\n        // Restore original positions\n        mesh.addChild(box);\n        mesh.rotationQuaternion.copyFrom(oldRot);\n        mesh.position.copyFrom(oldPos);\n\n        // Reverse parenting\n        mesh.removeChild(box);\n\n        box.addChild(mesh);\n        box.visibility = 0;\n        return box;\n    }\n    /**\n     * CustomMeshes are not supported by this gizmo\n     * @param mesh The mesh to replace the default mesh of the gizmo\n     */\n    public setCustomMesh(mesh: BABYLON.Mesh) {\n        BABYLON.Logger.Error(\"Custom meshes are not supported on this gizmo\");\n    }\n}\n","import { VeryCamera } from \"../middleware\";\n// import { Nullable } from \"../types\";\n// import { Vector3 } from \"../Maths/math.vector\";\n// import { Color3 } from '../Maths/math.color';\n// import { Mesh } from \"../Meshes/mesh\";\nimport { Gizmo } from \"./gizmo\";\nimport { UtilityLayerRenderer } from \"./UtilityLayerRenderer\";\n// import { UtilityLayerRenderer } from \"../Rendering/utilityLayerRenderer\";\n// import { StandardMaterial } from '../Materials/standardMaterial';\n// import { Scene } from '../scene';\n// import { Camera } from '../Cameras/camera';\n// import { BoxBuilder } from \"../Meshes/Builders/boxBuilder\";\n// import { CylinderBuilder } from '../Meshes/Builders/cylinderBuilder';\n// import { Matrix } from '../Maths/math';\n// import { LinesBuilder } from \"../Meshes/Builders/linesBuilder\";\n// import { PointerEventTypes, PointerInfo } from '../Events/pointerEvents';\n// import { Observer, Observable } from \"../Misc/observable\";\n\n/**\n * Gizmo that enables viewing a camera\n */\nexport class CameraGizmo extends Gizmo {\n    private _cameraMesh!: BABYLON.Mesh;\n    private _cameraLinesMesh!: BABYLON.Mesh;\n    private _material: BABYLON.StandardMaterial;\n    private _pointerObserver: Nullable<BABYLON.Observer<BABYLON.PointerInfo>> = null;\n\n    /**\n     * Event that fires each time the gizmo is clicked\n     */\n    public onClickedObservable = new BABYLON.Observable<BABYLON.Camera>();\n\n    /**\n     * Creates a CameraGizmo\n     * @param gizmoLayer The utility layer the gizmo will be added to\n     */\n    constructor(gizmoLayer: UtilityLayerRenderer = UtilityLayerRenderer.DefaultUtilityLayer) {\n        super(gizmoLayer);\n\n        this._material = new BABYLON.StandardMaterial(\"cameraGizmoMaterial\", this.gizmoLayer.utilityLayerScene);\n        this._material.diffuseColor = new BABYLON.Color3(0.5, 0.5, 0.5);\n        this._material.specularColor = new BABYLON.Color3(0.1, 0.1, 0.1);\n\n        this._pointerObserver = gizmoLayer.utilityLayerScene.onPointerObservable.add((pointerInfo) => {\n            if (!this._camera) {\n                return;\n            }\n\n            var isHovered = pointerInfo.pickInfo && (this._rootMesh.getChildMeshes().indexOf(<BABYLON.Mesh>pointerInfo.pickInfo.pickedMesh) != -1);\n            if (isHovered && pointerInfo.event.button === 0) {\n\n                if (this._camera.parent && this._camera.parent instanceof VeryCamera) {\n                    var entity = editor.call('entities:get', this._camera.parent.id);\n                    // console.error(entity);\n                    if (entity) {\n                        editor.call('selector:set', 'entity', [entity]);\n                    } else {\n                        console.error('失败');\n                    }\n                }\n                this.onClickedObservable.notifyObservers(this._camera);\n            }\n        }, BABYLON.PointerEventTypes.POINTERDOWN);\n    }\n    private _camera: Nullable<BABYLON.Camera> = null;\n\n    /** Gets or sets a boolean indicating if frustum lines must be rendered (true by default)) */\n    public get displayFrustum() {\n        return this._cameraLinesMesh.isEnabled();\n    }\n    public set displayFrustum(value) {\n        this._cameraLinesMesh.setEnabled(value);\n    }\n\n    /**\n     * The camera that the gizmo is attached to\n     */\n    public set camera(camera: Nullable<BABYLON.Camera>) {\n        this._camera = camera;\n        this.attachedNode = camera;\n        if (camera) {\n            // Create the mesh for the given camera\n            if (this._cameraMesh) {\n                this._cameraMesh.dispose();\n            }\n            if (this._cameraLinesMesh) {\n                this._cameraLinesMesh.dispose();\n            }\n            this._cameraMesh = CameraGizmo._CreateCameraMesh(this.gizmoLayer.utilityLayerScene);\n            this._cameraLinesMesh = CameraGizmo._CreateCameraFrustum(this.gizmoLayer.utilityLayerScene);\n\n            this._cameraMesh.getChildMeshes(false).forEach((m) => {\n                m.material = this._material;\n            });\n            this._cameraMesh.parent = this._rootMesh;\n\n            this._cameraLinesMesh.parent = this._rootMesh;\n\n            if (this.gizmoLayer.utilityLayerScene.activeCamera && this.gizmoLayer.utilityLayerScene.activeCamera.maxZ < camera.maxZ * 1.5) {\n                this.gizmoLayer.utilityLayerScene.activeCamera.maxZ = camera.maxZ * 1.5;\n            }\n\n            if (!this.attachedNode!.reservedDataStore) {\n                this.attachedNode!.reservedDataStore = {};\n            }\n            this.attachedNode!.reservedDataStore.cameraGizmo = this;\n\n            // Add lighting to the camera gizmo\n            var gizmoLight = this.gizmoLayer._getSharedGizmoLight();\n            gizmoLight.includedOnlyMeshes = gizmoLight.includedOnlyMeshes.concat(this._cameraMesh.getChildMeshes(false));\n\n            this._update();\n        }\n    }\n\n    public get camera() {\n        return this._camera;\n    }\n\n    /**\n     * Gets the material used to render the camera gizmo\n     */\n    public get material() {\n        return this._material;\n    }\n    /**\n     * @hidden\n     * Updates the gizmo to match the attached mesh's position/rotation\n     */\n\n    protected _update() {\n        super._update();\n        if (!this._camera) {\n            return;\n        }\n\n        // frustum matrix\n        this._camera.getProjectionMatrix().invertToRef(this._invProjection);\n        this._cameraLinesMesh.setPivotMatrix(this._invProjection, false);\n\n        this._cameraLinesMesh.scaling.x = 1 / this._rootMesh.scaling.x;\n        this._cameraLinesMesh.scaling.y = 1 / this._rootMesh.scaling.y;\n        this._cameraLinesMesh.scaling.z = 1 / this._rootMesh.scaling.z;\n\n        // take care of coordinate system in camera scene to properly display the mesh with the good Y axis orientation in this scene\n        this._cameraMesh.parent = null;\n        this._cameraMesh.rotation.y = Math.PI * 0.5 * (this._camera.getScene().useRightHandedSystem ? 1 : -1);\n        this._cameraMesh.parent = this._rootMesh;\n    }\n\n    // Static helper methods\n    private static _Scale = 0.05;\n    private _invProjection = new BABYLON.Matrix();\n\n    /**\n     * Disposes of the camera gizmo\n     */\n    public dispose() {\n        this.onClickedObservable.clear();\n        this.gizmoLayer.utilityLayerScene.onPointerObservable.remove(this._pointerObserver);\n        if (this._cameraMesh) {\n            this._cameraMesh.dispose();\n        }\n        if (this._cameraLinesMesh) {\n            this._cameraLinesMesh.dispose();\n        }\n        this._material.dispose();\n        super.dispose();\n    }\n\n    private static _CreateCameraMesh(scene: BABYLON.Scene) {\n        var root = new BABYLON.Mesh(\"rootCameraGizmo\", scene);\n\n        var mesh = new BABYLON.Mesh(root.name, scene);\n        mesh.parent = root;\n\n        var box = BABYLON.BoxBuilder.CreateBox(root.name, { width: 1.0, height: 0.8, depth: 0.5 }, scene);\n        box.parent = mesh;\n\n        var cyl1 = BABYLON.CylinderBuilder.CreateCylinder(root.name, { height: 0.5, diameterTop: 0.8, diameterBottom: 0.8 }, scene);\n        cyl1.parent = mesh;\n        cyl1.position.y = 0.3;\n        cyl1.position.x = -0.6;\n        cyl1.rotation.x = Math.PI * 0.5;\n\n        var cyl2 = BABYLON.CylinderBuilder.CreateCylinder(root.name, { height: 0.5, diameterTop: 0.6, diameterBottom: 0.6 }, scene);\n        cyl2.parent = mesh;\n        cyl2.position.y = 0.5;\n        cyl2.position.x = 0.4;\n        cyl2.rotation.x = Math.PI * 0.5;\n\n        var cyl3 = BABYLON.CylinderBuilder.CreateCylinder(root.name, { height: 0.5, diameterTop: 0.5, diameterBottom: 0.5 }, scene);\n        cyl3.parent = mesh;\n        cyl3.position.y = 0.0;\n        cyl3.position.x = 0.6;\n        cyl3.rotation.z = Math.PI * 0.5;\n\n        root.scaling.scaleInPlace(CameraGizmo._Scale);\n        mesh.position.x = -0.9;\n\n        return root;\n    }\n\n    private static _CreateCameraFrustum(scene: BABYLON.Scene) {\n        var root = new BABYLON.Mesh(\"rootCameraGizmo\", scene);\n        var mesh = new BABYLON.Mesh(root.name, scene);\n        mesh.parent = root;\n\n        for (var y = 0; y < 4; y += 2) {\n            for (var x = 0; x < 4; x += 2) {\n                var line = BABYLON.LinesBuilder.CreateLines(\"lines\", { points: [new BABYLON.Vector3(-1 + x, -1 + y, -1), new BABYLON.Vector3(-1 + x, -1 + y, 1)] }, scene);\n                line.parent = mesh;\n                line.alwaysSelectAsActiveMesh = true;\n                line.isPickable = false;\n                var line = BABYLON.LinesBuilder.CreateLines(\"lines\", { points: [new BABYLON.Vector3(-1, -1 + x, -1 + y), new BABYLON.Vector3(1, -1 + x, -1 + y)] }, scene);\n                line.parent = mesh;\n                line.alwaysSelectAsActiveMesh = true;\n                line.isPickable = false;\n                var line = BABYLON.LinesBuilder.CreateLines(\"lines\", { points: [new BABYLON.Vector3(-1 + x, -1, -1 + y), new BABYLON.Vector3(-1 + x, 1, -1 + y)] }, scene);\n                line.parent = mesh;\n                line.alwaysSelectAsActiveMesh = true;\n                line.isPickable = false;\n            }\n        }\n\n        return root;\n    }\n}","import { Observer } from \"../../lib\";\nimport { GizmoManager } from \".\";\nimport { Tools } from \"../utility\";\nimport { VeryCamera, VeryLight } from \"../middleware\";\nimport { CameraGizmo } from \"./cameraGizmo\";\n\nexport class GizmosCenter {\n\n    public static mode: number = 0;\n    public static gizmoManager: GizmoManager;\n\n    public static currentItems: Observer[] = [];\n    public static currentEvents: EventHandle[] = [];\n\n\n    public constructor() {\n\n    }\n\n    public static init(scene: BABYLON.Scene) {\n        GizmosCenter.gizmoManager = new GizmoManager(scene);\n        GizmosCenter.gizmoManager.positionGizmoEnabled = true;\n        GizmosCenter.gizmoManager.rotationGizmoEnabled = true;\n        GizmosCenter.gizmoManager.scaleGizmoEnabled = true;\n        GizmosCenter.gizmoManager.gizmos.positionGizmo!.scaleRatio = 1.5;\n        GizmosCenter.gizmoManager.gizmos.rotationGizmo!.scaleRatio = 1.5;\n        GizmosCenter.gizmoManager.gizmos.scaleGizmo!.scaleRatio = 1.5;\n        GizmosCenter.gizmoManager.positionGizmoEnabled = false;\n        GizmosCenter.gizmoManager.rotationGizmoEnabled = false;\n        GizmosCenter.gizmoManager.scaleGizmoEnabled = false;\n\n        let lastCameraGizmo: Nullable<CameraGizmo> = null;\n\n        editor.on('selector:change', (type: string, items: Observer[]) => {\n            GizmosCenter.clear();\n            if (type === 'entity') {\n                if (items && items.length === 0) {\n                    return;\n                }\n                let node;\n                if (items.length === 1) {\n                    node = items[0].node;\n                    // GizmosCenter.attach(node);\n                } else {\n                    // 创建一个空物体作为所有物体的父物体；\n                    // 记录原始父物体；\n                    node = items[items.length - 1].node;\n                }\n                if(node instanceof BABYLON.Node) {\n                    GizmosCenter.attach(node);\n                } else {\n                    GizmosCenter.attach(null);\n                    return;\n                }\n                // Camera Gizmo处理\n                if (node && node instanceof VeryCamera) {\n                    let tempGizmo = editor.call('gizmo:get', node.id);\n                    if (tempGizmo === lastCameraGizmo) {\n                        return;\n                    } else {\n                        if (lastCameraGizmo) {\n                            lastCameraGizmo.displayFrustum = false;\n                            lastCameraGizmo = null;\n                        }\n                    }\n                    if (tempGizmo && tempGizmo instanceof CameraGizmo) {\n                        tempGizmo.displayFrustum = true;\n                        lastCameraGizmo = tempGizmo;\n                    }\n                } else {\n                    if (lastCameraGizmo) {\n                        lastCameraGizmo.displayFrustum = false;\n                        lastCameraGizmo = null;\n                    }\n                }\n                this.currentItems = items;\n                for (let i = 0; i < this.currentItems.length; i++) {\n                    this.currentEvents.push(this.currentItems[i].on('position:set', (val: any) => { }));\n                    this.currentEvents.push(this.currentItems[i].on('position.0:set', (val: any) => { }));\n                    this.currentEvents.push(this.currentItems[i].on('position.1:set', (val: any) => { }));\n                    this.currentEvents.push(this.currentItems[i].on('position.2:set', (val: any) => { }));\n                    this.currentEvents.push(this.currentItems[i].on('rotation:set', (val: any) => { }));\n                    this.currentEvents.push(this.currentItems[i].on('rotation.0:set', (val: any) => { }));\n                    this.currentEvents.push(this.currentItems[i].on('rotation.1:set', (val: any) => { }));\n                    this.currentEvents.push(this.currentItems[i].on('rotation.2:set', (val: any) => { }));\n                    this.currentEvents.push(this.currentItems[i].on('scale:set', (val: any) => { }));\n                    this.currentEvents.push(this.currentItems[i].on('scale.0:set', (val: any) => { }));\n                    this.currentEvents.push(this.currentItems[i].on('scale.1:set', (val: any) => { }));\n                    this.currentEvents.push(this.currentItems[i].on('scale.2:set', (val: any) => { }));\n                }\n            }\n        });\n\n\n\n    }\n\n    public static setMode(m: number): void {\n        this.mode = m;\n        if (this.mode == 0) {\n            this.gizmoManager.positionGizmoEnabled = true;\n            this.gizmoManager.rotationGizmoEnabled = false;\n            this.gizmoManager.scaleGizmoEnabled = false;\n        } else if (this.mode === 1) {\n            this.gizmoManager.positionGizmoEnabled = false;\n            this.gizmoManager.rotationGizmoEnabled = true;\n            this.gizmoManager.scaleGizmoEnabled = false;\n        } else {\n            this.gizmoManager.positionGizmoEnabled = false;\n            this.gizmoManager.rotationGizmoEnabled = false;\n            this.gizmoManager.scaleGizmoEnabled = true;\n        }\n    }\n\n    public static attach(mesh: Nullable<BABYLON.Node>): void {\n        // if (mesh instanceof VeryLight) {\n        //     this.gizmoManager.attachToNode(mesh.light);\n        // }\n        // else \n        if (mesh instanceof BABYLON.AbstractMesh) {\n            this.gizmoManager.attachToMesh(mesh);\n        } else {\n            this.gizmoManager.attachToNode(mesh);\n        }\n\n        this.setMode(this.mode);\n    }\n\n\n    public static setPosition(pos: BABYLON.Vector3): void {\n        if (this.currentItems) {\n            if (this.currentItems.length === 1) {\n                this.currentItems[0].set('position.0', pos.x);\n                this.currentItems[0].set('position.1', pos.y);\n                this.currentItems[0].set('position.2', pos.z);\n            } else {\n                // TODO\n                this.currentItems[this.currentItems.length - 1].set('position.0', pos.x);\n                this.currentItems[this.currentItems.length - 1].set('position.1', pos.y);\n                this.currentItems[this.currentItems.length - 1].set('position.2', pos.z);\n            }\n        }\n    }\n\n    public static setRotation(rotation: BABYLON.Vector3): void {\n        let eulerAngle = Tools.radianToEulerAngle(rotation);\n        if (this.currentItems) {\n            if (this.currentItems.length === 1) {\n                this.currentItems[0].set('rotation.0', eulerAngle.x);\n                this.currentItems[0].set('rotation.1', eulerAngle.y);\n                this.currentItems[0].set('rotation.2', eulerAngle.z);\n            } else {\n                // TODO\n                this.currentItems[this.currentItems.length - 1].set('rotation.0', eulerAngle.x);\n                this.currentItems[this.currentItems.length - 1].set('rotation.1', eulerAngle.y);\n                this.currentItems[this.currentItems.length - 1].set('rotation.2', eulerAngle.z);\n            }\n        }\n    }\n\n    public static setScale(scale: BABYLON.Vector3): void {\n        if (this.currentItems) {\n            if (this.currentItems.length === 1) {\n                this.currentItems[0].set('scale.0', scale.x);\n                this.currentItems[0].set('scale.1', scale.y);\n                this.currentItems[0].set('scale.2', scale.z);\n            } else {\n                // TODO\n                this.currentItems[this.currentItems.length - 1].set('scale.0', scale.x);\n                this.currentItems[this.currentItems.length - 1].set('scale.1', scale.y);\n                this.currentItems[this.currentItems.length - 1].set('scale.2', scale.z);\n            }\n        }\n    }\n\n    public static clear(): void {\n        this.gizmoManager.attachToMesh(null);\n        if (this.currentEvents && this.currentEvents.length > 0) {\n            for (let i = 0; i < this.currentEvents.length; i++)\n                this.currentEvents[i].unbind();\n        }\n        this.currentEvents = [];\n        this.currentItems = [];\n    }\n\n\n\n}","// import { Observer } from \"../Misc/observable\";\n// import { Nullable } from \"../types\";\n// import { WebVRFreeCamera } from \"../Cameras/VR/webVRCamera\";\n// import { Scene, IDisposable } from \"../scene\";\n// import { Quaternion, Vector3, Matrix } from \"../Maths/math.vector\";\n// import { AbstractMesh } from \"../Meshes/abstractMesh\";\n// import { Mesh } from \"../Meshes/mesh\";\n// import { Camera } from \"../Cameras/camera\";\n// import { TargetCamera } from \"../Cameras/targetCamera\";\n// import { Node } from \"../node\";\n// import { Bone } from \"../Bones/bone\";\n// import { UtilityLayerRenderer } from \"../Rendering/utilityLayerRenderer\";\n// import { TransformNode } from '../Meshes/transformNode';\n\nimport { GizmosCenter } from \".\";\nimport { UtilityLayerRenderer } from \"./UtilityLayerRenderer\";\n\n\n/**\n * Renders gizmos on top of an existing scene which provide controls for position, rotation, etc.\n */\nexport class Gizmo implements BABYLON.IDisposable {\n    /**\n     * The root mesh of the gizmo\n     */\n    public _rootMesh: BABYLON.Mesh;\n    private _attachedMesh: Nullable<BABYLON.AbstractMesh> = null;\n    private _attachedNode: Nullable<BABYLON.Node> = null;\n\n    /**\n     * Ratio for the scale of the gizmo (Default: 1)\n     */\n    protected _scaleRatio = 1;\n\n    protected _operationType: string = '';\n\n    /**\n     * Ratio for the scale of the gizmo (Default: 1)\n     */\n    public set scaleRatio(value: number) {\n        this._scaleRatio = value;\n    }\n\n    public get scaleRatio() {\n        return this._scaleRatio;\n    }\n    /**\n     * If a custom mesh has been set (Default: false)\n     */\n    protected _customMeshSet = false;\n    /**\n     * Mesh that the gizmo will be attached to. (eg. on a drag gizmo the mesh that will be dragged)\n     * * When set, interactions will be enabled\n     */\n    public get attachedMesh() {\n        return this._attachedMesh;\n    }\n    public set attachedMesh(value: Nullable<BABYLON.AbstractMesh>) {\n        this._attachedMesh = value;\n        if (value) {\n            this._attachedNode = value;\n        }\n        this._rootMesh.setEnabled(value ? true : false);\n        this._attachedNodeChanged(value);\n    }\n    /**\n     * Node that the gizmo will be attached to. (eg. on a drag gizmo the mesh, bone or NodeTransform that will be dragged)\n     * * When set, interactions will be enabled\n     */\n    public get attachedNode() {\n        return this._attachedNode;\n    }\n    public set attachedNode(value: Nullable<BABYLON.Node>) {\n        this._attachedNode = value;\n        this._attachedMesh = null;\n        this._rootMesh.setEnabled(value ? true : false);\n        this._attachedNodeChanged(value);\n    }\n\n    /**\n     * Disposes and replaces the current meshes in the gizmo with the specified mesh\n     * @param mesh The mesh to replace the default mesh of the gizmo\n     */\n    public setCustomMesh(mesh: BABYLON.Mesh) {\n        if (mesh.getScene() != this.gizmoLayer.utilityLayerScene) {\n            throw \"When setting a custom mesh on a gizmo, the custom meshes scene must be the same as the gizmos (eg. gizmo.gizmoLayer.utilityLayerScene)\";\n        }\n        this._rootMesh.getChildMeshes().forEach((c) => {\n            c.dispose();\n        });\n        mesh.parent = this._rootMesh;\n        this._customMeshSet = true;\n    }\n\n    protected _updateGizmoRotationToMatchAttachedMesh = true;\n\n    /**\n     * If set the gizmo's rotation will be updated to match the attached mesh each frame (Default: true)\n     */\n    public set updateGizmoRotationToMatchAttachedMesh(value: boolean) {\n        this._updateGizmoRotationToMatchAttachedMesh = value;\n    }\n    public get updateGizmoRotationToMatchAttachedMesh() {\n        return this._updateGizmoRotationToMatchAttachedMesh;\n    }\n    /**\n     * If set the gizmo's position will be updated to match the attached mesh each frame (Default: true)\n     */\n    public updateGizmoPositionToMatchAttachedMesh = true;\n    /**\n     * When set, the gizmo will always appear the same size no matter where the camera is (default: true)\n     */\n    public updateScale = true;\n    protected _interactionsEnabled = true;\n    protected _attachedNodeChanged(value: Nullable<BABYLON.Node>) {\n    }\n\n    private _beforeRenderObserver: Nullable<BABYLON.Observer<BABYLON.Scene>>;\n    private _tempQuaternion = new BABYLON.Quaternion(0, 0, 0, 1);\n    private _tempVector = new BABYLON.Vector3();\n    private _tempVector2 = new BABYLON.Vector3();\n    private _tempMatrix1 = new BABYLON.Matrix();\n    private _tempMatrix2 = new BABYLON.Matrix();\n    private _rightHandtoLeftHandMatrix = BABYLON.Matrix.RotationY(Math.PI);\n\n    /**\n     * Creates a gizmo\n     * @param gizmoLayer The utility layer the gizmo will be added to\n     */\n    constructor(\n        /** The utility layer the gizmo will be added to */\n        public gizmoLayer: UtilityLayerRenderer = UtilityLayerRenderer.DefaultUtilityLayer) {\n\n        this._rootMesh = new BABYLON.Mesh(\"gizmoRootNode\", gizmoLayer.utilityLayerScene);\n        this._rootMesh.rotationQuaternion = BABYLON.Quaternion.Identity();\n\n        this._beforeRenderObserver = this.gizmoLayer.utilityLayerScene.onBeforeRenderObservable.add(() => {\n            this._update();\n        });\n    }\n\n    /**\n     * Updates the gizmo to match the attached mesh's position/rotation\n     */\n    protected _update() {\n        if (this.attachedNode) {\n            var effectiveNode = this.attachedNode;\n            if (this.attachedMesh) {\n                effectiveNode = this.attachedMesh._effectiveMesh || this.attachedNode;\n            }\n\n            // Position\n            if (this.updateGizmoPositionToMatchAttachedMesh) {\n                const row = effectiveNode.getWorldMatrix().getRow(3);\n                const position = row ? row.toVector3() : new BABYLON.Vector3(0, 0, 0);\n                this._rootMesh.position.copyFrom(position);\n            }\n\n            // Rotation\n            if (this.updateGizmoRotationToMatchAttachedMesh) {\n                effectiveNode.getWorldMatrix().decompose(undefined, this._rootMesh.rotationQuaternion!);\n            }\n            else {\n                if (this._rootMesh.rotationQuaternion) {\n                    this._rootMesh.rotationQuaternion!.set(0, 0, 0, 1);\n                } else {\n                    this._rootMesh.rotation = BABYLON.Vector3.Zero();\n                }\n            }\n\n            // Scale\n            if (this.updateScale) {\n                const activeCamera = this.gizmoLayer.utilityLayerScene.activeCamera!;\n                var cameraPosition = activeCamera.globalPosition;\n                if ((<BABYLON.WebVRFreeCamera>activeCamera).devicePosition) {\n                    cameraPosition = (<BABYLON.WebVRFreeCamera>activeCamera).devicePosition;\n                }\n                if (activeCamera.mode === BABYLON.Camera.PERSPECTIVE_CAMERA) {\n                    this._rootMesh.position.subtractToRef(cameraPosition, this._tempVector);\n                    var dist = this._tempVector.length() * this.scaleRatio;\n                    this._rootMesh.scaling.set(dist, dist, dist);\n                } else {\n                    // 正交相机比例处理\n                    let rate = this.scaleRatio * 600;\n                    let ortho: number;\n                    if (activeCamera.orthoRight) {\n                        ortho = activeCamera.orthoRight / this.gizmoLayer.utilityLayerScene.getEngine().getRenderWidth();\n                    } else {\n                        ortho = 1;\n                    }\n                    rate *= 2.2 * ortho;\n                    this._rootMesh.scaling.set(rate, rate, rate);\n                }\n\n                // Account for handedness, similar to Matrix.decompose\n                if (effectiveNode._getWorldMatrixDeterminant() < 0) {\n                    this._rootMesh.scaling.y *= -1;\n                }\n            } else {\n                this._rootMesh.scaling.setAll(this.scaleRatio);\n            }\n        }\n    }\n\n    /**\n     * computes the rotation/scaling/position of the transform once the Node world matrix has changed.\n     * @param value Node, TransformNode or mesh\n     */\n    protected _matrixChanged() {\n        if (!this._attachedNode) {\n            return;\n        }\n\n        if ((<BABYLON.Camera>this._attachedNode)._isCamera) {\n            var camera = this._attachedNode as BABYLON.Camera;\n            var worldMatrix;\n            var worldMatrixUC;\n            if (camera.parent) {\n                var parentInv = this._tempMatrix2;\n                camera.parent._worldMatrix.invertToRef(parentInv);\n                this._attachedNode._worldMatrix.multiplyToRef(parentInv, this._tempMatrix1);\n                worldMatrix = this._tempMatrix1;\n            } else {\n                worldMatrix = this._attachedNode._worldMatrix;\n            }\n\n            if (camera.getScene().useRightHandedSystem) {\n                // avoid desync with RH matrix computation. Otherwise, rotation of PI around Y axis happens each frame resulting in axis flipped because worldMatrix is computed as inverse of viewMatrix.\n                this._rightHandtoLeftHandMatrix.multiplyToRef(worldMatrix, this._tempMatrix2);\n                worldMatrixUC = this._tempMatrix2;\n            } else {\n                worldMatrixUC = worldMatrix;\n            }\n\n            worldMatrixUC.decompose(this._tempVector2, this._tempQuaternion, this._tempVector);\n\n            var inheritsTargetCamera = this._attachedNode.getClassName() === \"FreeCamera\"\n                || this._attachedNode.getClassName() === \"FlyCamera\"\n                || this._attachedNode.getClassName() === \"ArcFollowCamera\"\n                || this._attachedNode.getClassName() === \"TargetCamera\"\n                || this._attachedNode.getClassName() === \"TouchCamera\"\n                || this._attachedNode.getClassName() === \"UniversalCamera\";\n\n            if (inheritsTargetCamera) {\n                var targetCamera = this._attachedNode as BABYLON.TargetCamera;\n                targetCamera.rotation = this._tempQuaternion.toEulerAngles();\n\n                if (targetCamera.rotationQuaternion) {\n                    targetCamera.rotationQuaternion.copyFrom(this._tempQuaternion);\n                }\n            }\n\n            camera.position.copyFrom(this._tempVector);\n        } else if ((<BABYLON.Mesh>this._attachedNode)._isMesh || this._attachedNode.getClassName() === \"AbstractMesh\" || this._attachedNode.getClassName() === \"TransformNode\" || this._attachedNode.getClassName() === \"InstancedMesh\") {\n            var transform = this._attachedNode as BABYLON.TransformNode;\n            if (transform.parent) {\n                var parentInv = this._tempMatrix1;\n                var localMat = this._tempMatrix2;\n                transform.parent.getWorldMatrix().invertToRef(parentInv);\n                this._attachedNode._worldMatrix.multiplyToRef(parentInv, localMat);\n                localMat.decompose(transform.scaling, this._tempQuaternion, transform.position);\n            } else {\n                this._attachedNode._worldMatrix.decompose(transform.scaling, this._tempQuaternion, transform.position);\n            }\n            if (transform.rotationQuaternion) {\n                transform.rotationQuaternion.copyFrom(this._tempQuaternion);\n            } else {\n                transform.rotation = this._tempQuaternion.toEulerAngles();\n            }\n            // console.warn(this._operationType);\n            if (this._operationType === 'translate' || this._operationType === 'plane') {\n                GizmosCenter.setPosition(transform.position);\n            } else if (this._operationType === 'rotate') {\n                GizmosCenter.setRotation(transform.rotation);\n            } else if (this._operationType === 'scale') {\n\n            }\n        } else if (this._attachedNode.getClassName() === \"Bone\") {\n            var bone = this._attachedNode as BABYLON.Bone;\n            const parent = bone.getParent();\n\n            if (parent) {\n                var invParent = this._tempMatrix1;\n                var boneLocalMatrix = this._tempMatrix2;\n                parent.getWorldMatrix().invertToRef(invParent);\n                bone.getWorldMatrix().multiplyToRef(invParent, boneLocalMatrix);\n                var lmat = bone.getLocalMatrix();\n                lmat.copyFrom(boneLocalMatrix);\n                bone.markAsDirty();\n            }\n        }\n    }\n\n    /**\n     * Disposes of the gizmo\n     */\n    public dispose() {\n        this._rootMesh.dispose();\n        if (this._beforeRenderObserver) {\n            this.gizmoLayer.utilityLayerScene.onBeforeRenderObservable.remove(this._beforeRenderObserver);\n        }\n    }\n}\n","// import { Observer, Observable } from \"../Misc/observable\";\n// import { Nullable } from \"../types\";\n// import { PointerInfo, PointerEventTypes } from \"../Events/pointerEvents\";\n// import { Scene, IDisposable } from \"../scene\";\n// import { Node } from \"../node\";\n// import { AbstractMesh } from \"../Meshes/abstractMesh\";\n// import { UtilityLayerRenderer } from \"../Rendering/utilityLayerRenderer\";\n// import { Color3 } from '../Maths/math.color';\n// import { SixDofDragBehavior } from \"../Behaviors/Meshes/sixDofDragBehavior\";\n\nimport { Gizmo } from \"./gizmo\";\nimport { RotationGizmo } from \"./rotationGizmo\";\nimport { PositionGizmo } from \"./positionGizmo\";\nimport { ScaleGizmo } from \"./scaleGizmo\";\nimport { BoundingBoxGizmo } from \"./boundingBoxGizmo\";\nimport { Observer } from \"../../lib\";\nimport { GizmosCenter } from \".\";\nimport { UtilityLayerRenderer } from \"./UtilityLayerRenderer\";\n\n/**\n * Helps setup gizmo's in the scene to rotate/scale/position nodes\n */\nexport class GizmoManager implements BABYLON.IDisposable {\n    /**\n     * Gizmo's created by the gizmo manager, gizmo will be null until gizmo has been enabled for the first time\n     */\n    public gizmos: { positionGizmo: Nullable<PositionGizmo>, rotationGizmo: Nullable<RotationGizmo>, scaleGizmo: Nullable<ScaleGizmo>, boundingBoxGizmo: Nullable<BoundingBoxGizmo> };\n\n    /** When true, the gizmo will be detached from the current object when a pointer down occurs with an empty picked mesh */\n    public clearGizmoOnEmptyPointerEvent = false;\n\n    /** Fires an event when the manager is attached to a mesh */\n    public onAttachedToMeshObservable = new BABYLON.Observable<Nullable<BABYLON.AbstractMesh>>();\n\n    /** Fires an event when the manager is attached to a node */\n    public onAttachedToNodeObservable = new BABYLON.Observable<Nullable<BABYLON.Node>>();\n\n    private _gizmosEnabled = { positionGizmo: false, rotationGizmo: false, scaleGizmo: false, boundingBoxGizmo: false };\n    private _pointerObserver: Nullable<BABYLON.Observer<BABYLON.PointerInfo>> = null;\n    private _attachedMesh: Nullable<BABYLON.AbstractMesh> = null;\n    private _attachedNode: Nullable<BABYLON.Node> = null;\n    private _boundingBoxColor = BABYLON.Color3.FromHexString(\"#0984e3\");\n    private _defaultUtilityLayer: UtilityLayerRenderer;\n    private _defaultKeepDepthUtilityLayer: UtilityLayerRenderer;\n    private _thickness: number = 1;\n    /**\n     * When bounding box gizmo is enabled, this can be used to track drag/end events\n     */\n    public boundingBoxDragBehavior = new BABYLON.SixDofDragBehavior();\n    /**\n     * Array of meshes which will have the gizmo attached when a pointer selected them. If null, all meshes are attachable. (Default: null)\n     */\n    public attachableMeshes: Nullable<Array<BABYLON.AbstractMesh>> = null;\n    /**\n     * Array of nodes which will have the gizmo attached when a pointer selected them. If null, all nodes are attachable. (Default: null)\n     */\n    public attachableNodes: Nullable<Array<BABYLON.Node>> = null;\n    /**\n     * If pointer events should perform attaching/detaching a gizmo, if false this can be done manually via attachToMesh/attachToNode. (Default: true)\n     */\n    public usePointerToAttachGizmos = true;\n\n    /**\n     * Utility layer that the bounding box gizmo belongs to\n     */\n    public get keepDepthUtilityLayer() {\n        return this._defaultKeepDepthUtilityLayer;\n    }\n\n    /**\n     * Utility layer that all gizmos besides bounding box belong to\n     */\n    public get utilityLayer() {\n        return this._defaultUtilityLayer;\n    }\n\n    /**\n     * Instatiates a gizmo manager\n     * @param scene the scene to overlay the gizmos on top of\n     * @param thickness display gizmo axis thickness\n     */\n    constructor(private scene: BABYLON.Scene, thickness: number = 1) {\n        this._defaultKeepDepthUtilityLayer = new UtilityLayerRenderer(scene);\n        this._defaultKeepDepthUtilityLayer.utilityLayerScene.autoClearDepthAndStencil = false;\n        this._defaultUtilityLayer = new UtilityLayerRenderer(scene);\n        this._thickness = thickness;\n        this.gizmos = { positionGizmo: null, rotationGizmo: null, scaleGizmo: null, boundingBoxGizmo: null };\n\n        // Instatiate/dispose gizmos based on pointer actions\n        this._pointerObserver = scene.onPointerObservable.add((pointerInfo) => {\n            if (!this.usePointerToAttachGizmos) {\n                return;\n            }\n            if (pointerInfo.type == BABYLON.PointerEventTypes.POINTERDOWN) {\n                // 只支持鼠标左键选择\n                if (pointerInfo.pickInfo && pointerInfo.event.button === 0 && pointerInfo.pickInfo.pickedMesh) {\n                    // if (mesh === null) {\n                    //     GizmosCenter.clear();\n                    //     console.log('clear gizmos');\n                    // } else {\n                    //     console.log('pick mesh');\n                    //     // GizmosCenter.attach(mesh);\n                    //     var entity = editor.call('entities:get', mesh.id);\n                    //     console.error(entity);\n                    //     if (entity) {\n                    //         editor.call('selector:set', 'entity', [entity]);\n                    //     } else {\n                    //         console.error('失败');\n                    //     }\n                    // }\n\n                    // TODO: 选择方式重新确定\n                    var node: Nullable<BABYLON.Node> = pointerInfo.pickInfo.pickedMesh;\n                    // if (this.attachableMeshes == null) {\n                    //     // Attach to the most parent node\n                    //     while (node && node.parent != null) {\n                    //         node = node.parent;\n                    //     }\n                    // } else {\n                    //     // Attach to the parent node that is an attachableMesh\n                    //     var found = false;\n                    //     this.attachableMeshes.forEach((mesh) => {\n                    //         if (node && (node == mesh || node.isDescendantOf(mesh))) {\n                    //             node = mesh;\n                    //             found = true;\n                    //         }\n                    //     });\n                    //     if (!found) {\n                    //         node = null;\n                    //     }\n                    // }\n                    if (node instanceof BABYLON.AbstractMesh) {\n                        // if (this._attachedMesh != node) {\n                        //     this.attachToMesh(node);\n                        // }\n\n                        // console.log('pick mesh');\n                        // GizmosCenter.attach(mesh);\n                        var entity = editor.call('entities:get', node.id);\n                        // console.error(entity);\n                        if (entity) {\n                            editor.call('selector:set', 'entity', [entity]);\n                        } else {\n                            console.error('失败');\n                        }\n                    } else {\n                        if (this.clearGizmoOnEmptyPointerEvent) {\n                            // this.attachToMesh(null);\n                            GizmosCenter.clear();\n                        }\n                    }\n                } else {\n                    if (this.clearGizmoOnEmptyPointerEvent) {\n                        GizmosCenter.clear();\n                    }\n                }\n            }\n        });\n\n        this.initialize();\n    }\n\n\n    // public coordSystem: string = 'local';\n    private initialize(): void {\n        let self = this;\n\n        editor.on('selector:change', (type: string, items: Observer[]) => {\n\n        });\n\n        // editor.on('gizmo:coordSystem', function (system: string) {\n        //     if (self.coordSystem === system)\n        //         return;\n        //     self.coordSystem = system;\n        //     var rot = getGizmoRotation();\n        //     if (rot)\n        //         editor.call('gizmo:rotate:rotation', rot[0], rot[1], rot[2]);\n        //     var vec = getGizmoPosition();\n        //     if (vec)\n        //         editor.call('gizmo:rotate:position', vec.x, vec.y, vec.z);\n        // });\n\n\n    }\n\n    /**\n     * Attaches a set of gizmos to the specified mesh\n     * @param mesh The mesh the gizmo's should be attached to\n     */\n    public attachToMesh(mesh: Nullable<BABYLON.AbstractMesh>) {\n        if (this._attachedMesh) {\n            this._attachedMesh.removeBehavior(this.boundingBoxDragBehavior);\n            this._attachedMesh.showBoundingBox = false;\n        }\n        if (this._attachedNode) {\n            this._attachedNode.removeBehavior(this.boundingBoxDragBehavior);\n        }\n        this._attachedMesh = mesh;\n        if (this._attachedMesh) {\n            this._attachedMesh.showBoundingBox = true;\n        }\n        this._attachedNode = null;\n        for (var key in this.gizmos) {\n            var gizmo = <Nullable<Gizmo>>((<any>this.gizmos)[key]);\n            if (gizmo && (<any>this._gizmosEnabled)[key]) {\n                gizmo.attachedMesh = mesh;\n            }\n        }\n        if (this.boundingBoxGizmoEnabled && this._attachedMesh) {\n            this._attachedMesh.addBehavior(this.boundingBoxDragBehavior);\n        }\n        this.onAttachedToMeshObservable.notifyObservers(mesh);\n    }\n\n    /**\n     * Attaches a set of gizmos to the specified node\n     * @param node The node the gizmo's should be attached to\n     */\n    public attachToNode(node: Nullable<BABYLON.Node>) {\n        if (this._attachedMesh) {\n            this._attachedMesh.removeBehavior(this.boundingBoxDragBehavior);\n            this._attachedMesh.showBoundingBox = false;\n        }\n        if (this._attachedNode) {\n            this._attachedNode.removeBehavior(this.boundingBoxDragBehavior);\n        }\n        this._attachedMesh = null;\n        this._attachedNode = node;\n        for (var key in this.gizmos) {\n            var gizmo = <Nullable<Gizmo>>((<any>this.gizmos)[key]);\n            if (gizmo && (<any>this._gizmosEnabled)[key]) {\n                gizmo.attachedNode = node;\n            }\n        }\n        if (this.boundingBoxGizmoEnabled && this._attachedNode) {\n            this._attachedNode.addBehavior(this.boundingBoxDragBehavior);\n        }\n        this.onAttachedToNodeObservable.notifyObservers(node);\n    }\n\n    /**\n     * If the position gizmo is enabled\n     */\n    public set positionGizmoEnabled(value: boolean) {\n        if (value) {\n            if (!this.gizmos.positionGizmo) {\n                this.gizmos.positionGizmo = new PositionGizmo(this._defaultUtilityLayer, this._thickness);\n            }\n            if (this._attachedNode) {\n                this.gizmos.positionGizmo.attachedNode = this._attachedNode;\n            } else {\n                this.gizmos.positionGizmo.attachedMesh = this._attachedMesh;\n            }\n        } else if (this.gizmos.positionGizmo) {\n            this.gizmos.positionGizmo.attachedNode = null;\n        }\n        this._gizmosEnabled.positionGizmo = value;\n    }\n    public get positionGizmoEnabled(): boolean {\n        return this._gizmosEnabled.positionGizmo;\n    }\n    /**\n     * If the rotation gizmo is enabled\n     */\n    public set rotationGizmoEnabled(value: boolean) {\n        if (value) {\n            if (!this.gizmos.rotationGizmo) {\n                this.gizmos.rotationGizmo = new RotationGizmo(this._defaultUtilityLayer, 32, false, this._thickness);\n            }\n            if (this._attachedNode) {\n                this.gizmos.rotationGizmo.attachedNode = this._attachedNode;\n            } else {\n                this.gizmos.rotationGizmo.attachedMesh = this._attachedMesh;\n            }\n        } else if (this.gizmos.rotationGizmo) {\n            this.gizmos.rotationGizmo.attachedNode = null;\n        }\n        this._gizmosEnabled.rotationGizmo = value;\n    }\n    public get rotationGizmoEnabled(): boolean {\n        return this._gizmosEnabled.rotationGizmo;\n    }\n    /**\n     * If the scale gizmo is enabled\n     */\n    public set scaleGizmoEnabled(value: boolean) {\n        if (value) {\n            this.gizmos.scaleGizmo = this.gizmos.scaleGizmo || new ScaleGizmo(this._defaultUtilityLayer, this._thickness);\n            if (this._attachedNode) {\n                this.gizmos.scaleGizmo.attachedNode = this._attachedNode;\n            } else {\n                this.gizmos.scaleGizmo.attachedMesh = this._attachedMesh;\n            }\n        } else if (this.gizmos.scaleGizmo) {\n            this.gizmos.scaleGizmo.attachedNode = null;\n        }\n        this._gizmosEnabled.scaleGizmo = value;\n    }\n    public get scaleGizmoEnabled(): boolean {\n        return this._gizmosEnabled.scaleGizmo;\n    }\n    /**\n     * If the boundingBox gizmo is enabled\n     */\n    public set boundingBoxGizmoEnabled(value: boolean) {\n        if (value) {\n            this.gizmos.boundingBoxGizmo = this.gizmos.boundingBoxGizmo || new BoundingBoxGizmo(this._boundingBoxColor, this._defaultKeepDepthUtilityLayer);\n            if (this._attachedMesh) {\n                this.gizmos.boundingBoxGizmo.attachedMesh = this._attachedMesh;\n            } else {\n                this.gizmos.boundingBoxGizmo.attachedNode = this._attachedNode;\n            }\n\n            if (this._attachedMesh) {\n                this._attachedMesh.removeBehavior(this.boundingBoxDragBehavior);\n                this._attachedMesh.addBehavior(this.boundingBoxDragBehavior);\n            } else if (this._attachedNode) {\n                this._attachedNode.removeBehavior(this.boundingBoxDragBehavior);\n                this._attachedNode.addBehavior(this.boundingBoxDragBehavior);\n            }\n        } else if (this.gizmos.boundingBoxGizmo) {\n            if (this._attachedMesh) {\n                this._attachedMesh.removeBehavior(this.boundingBoxDragBehavior);\n            } else if (this._attachedNode) {\n                this._attachedNode.removeBehavior(this.boundingBoxDragBehavior);\n            }\n            this.gizmos.boundingBoxGizmo.attachedNode = null;\n        }\n        this._gizmosEnabled.boundingBoxGizmo = value;\n    }\n    public get boundingBoxGizmoEnabled(): boolean {\n        return this._gizmosEnabled.boundingBoxGizmo;\n    }\n\n    /**\n     * Disposes of the gizmo manager\n     */\n    public dispose() {\n        this.scene.onPointerObservable.remove(this._pointerObserver);\n        for (var key in this.gizmos) {\n            var gizmo = <Nullable<Gizmo>>((<any>this.gizmos)[key]);\n            if (gizmo) {\n                gizmo.dispose();\n            }\n        }\n        this._defaultKeepDepthUtilityLayer.dispose();\n        this._defaultUtilityLayer.dispose();\n        this.boundingBoxDragBehavior.detach();\n        this.onAttachedToMeshObservable.clear();\n    }\n}","export * from \"./axisDragGizmo\";\nexport * from \"./axisScaleGizmo\";\nexport * from \"./boundingBoxGizmo\";\nexport * from \"./gizmo\";\nexport * from \"./gizmoManager\";\nexport * from \"./planeRotationGizmo\";\nexport * from \"./positionGizmo\";\nexport * from \"./rotationGizmo\";\nexport * from \"./scaleGizmo\";\nexport * from \"./lightGizmo\";\nexport * from \"./cameraGizmo\";\nexport * from \"./planeDragGizmo\";\nexport * from './gizmo-center';","import { VeryLight } from \"../middleware\";\nimport { Tools } from \"../utility\";\n// import { Nullable } from \"../types\";\n// import { Vector3, Quaternion } from \"../Maths/math.vector\";\n// import { Color3 } from '../Maths/math.color';\n// import { AbstractMesh } from \"../Meshes/abstractMesh\";\n// import { Mesh } from \"../Meshes/mesh\";\nimport { Gizmo } from \"./gizmo\";\nimport { UtilityLayerRenderer } from \"./UtilityLayerRenderer\";\n// import { UtilityLayerRenderer } from \"../Rendering/utilityLayerRenderer\";\n\n// import { StandardMaterial } from '../Materials/standardMaterial';\n// import { Light } from '../Lights/light';\n// import { Scene } from '../scene';\n// import { HemisphericLight } from '../Lights/hemisphericLight';\n// import { DirectionalLight } from '../Lights/directionalLight';\n// import { SphereBuilder } from '../Meshes/Builders/sphereBuilder';\n// import { HemisphereBuilder } from '../Meshes/Builders/hemisphereBuilder';\n// import { SpotLight } from '../Lights/spotLight';\n// import { TransformNode } from '../Meshes/transformNode';\n// import { PointerEventTypes, PointerInfo } from '../Events/pointerEvents';\n// import { Observer, Observable } from \"../Misc/observable\";\n\n/**\n * Gizmo that enables viewing a light\n */\nexport class LightGizmo extends Gizmo {\n    private _lightMesh!: BABYLON.Mesh;\n    private _material: BABYLON.StandardMaterial;\n    private _cachedPosition = new BABYLON.Vector3();\n    private _cachedForward = new BABYLON.Vector3(0, 0, 1);\n    private _attachedMeshParent: BABYLON.TransformNode;\n    private _pointerObserver: Nullable<BABYLON.Observer<BABYLON.PointerInfo>> = null;\n\n    /**\n     * Event that fires each time the gizmo is clicked\n     */\n    public onClickedObservable = new BABYLON.Observable<BABYLON.Light>();\n\n    /**\n     * Creates a LightGizmo\n     * @param gizmoLayer The utility layer the gizmo will be added to\n     */\n    constructor(gizmoLayer: UtilityLayerRenderer = UtilityLayerRenderer.DefaultUtilityLayer) {\n        super(gizmoLayer);\n        this.attachedMesh = new BABYLON.AbstractMesh(\"\", this.gizmoLayer.utilityLayerScene);\n        this._attachedMeshParent = new BABYLON.TransformNode(\"parent\", this.gizmoLayer.utilityLayerScene);\n\n        this.attachedMesh.parent = this._attachedMeshParent;\n        this._material = new BABYLON.StandardMaterial(\"light\", this.gizmoLayer.utilityLayerScene);\n        this._material.diffuseColor = new BABYLON.Color3(0.5, 0.5, 0.5);\n        this._material.specularColor = new BABYLON.Color3(0.1, 0.1, 0.1);\n\n        this._pointerObserver = gizmoLayer.utilityLayerScene.onPointerObservable.add((pointerInfo) => {\n            if (!this._light) {\n                return;\n            }\n\n            var isHovered = pointerInfo.pickInfo && (this._rootMesh.getChildMeshes().indexOf(<BABYLON.Mesh>pointerInfo.pickInfo.pickedMesh) != -1);\n            if (isHovered && pointerInfo.event.button === 0) {\n                // console.warn('pick light: ' + this._light.name);\n                // 选择到light父物体\n                if (this._light.parent && this._light.parent instanceof VeryLight) {\n                    var entity = editor.call('entities:get', this._light.parent.id);\n                    // console.error(entity);\n                    if (entity) {\n                        editor.call('selector:set', 'entity', [entity]);\n                    } else {\n                        console.error('失败');\n                    }\n                }\n                this.onClickedObservable.notifyObservers(this._light);\n            }\n        }, BABYLON.PointerEventTypes.POINTERDOWN);\n    }\n    private _light: Nullable<BABYLON.Light> = null;\n\n    /**\n     * The light that the gizmo is attached to\n     */\n    public set light(light: Nullable<BABYLON.Light>) {\n        this._light = light;\n        if (light) {\n            // Create the mesh for the given light type\n            if (this._lightMesh) {\n                this._lightMesh.dispose();\n            }\n\n            if (light instanceof BABYLON.HemisphericLight) {\n                this._lightMesh = LightGizmo._CreateHemisphericLightMesh(this.gizmoLayer.utilityLayerScene);\n            } else if (light instanceof BABYLON.DirectionalLight) {\n                this._lightMesh = LightGizmo._CreateDirectionalLightMesh(this.gizmoLayer.utilityLayerScene);\n            } else if (light instanceof BABYLON.SpotLight) {\n                this._lightMesh = LightGizmo._CreateSpotLightMesh(this.gizmoLayer.utilityLayerScene);\n            } else {\n                this._lightMesh = LightGizmo._CreatePointLightMesh(this.gizmoLayer.utilityLayerScene);\n            }\n            this._lightMesh.getChildMeshes(false).forEach((m) => {\n                m.material = this._material;\n            });\n            this._lightMesh.parent = this._rootMesh;\n\n            // Add lighting to the light gizmo\n            var gizmoLight = this.gizmoLayer._getSharedGizmoLight();\n            gizmoLight.includedOnlyMeshes = gizmoLight.includedOnlyMeshes.concat(this._lightMesh.getChildMeshes(false));\n\n            this._lightMesh.rotationQuaternion = new BABYLON.Quaternion();\n\n            if (!this.attachedMesh!.reservedDataStore) {\n                this.attachedMesh!.reservedDataStore = {};\n            }\n            this.attachedMesh!.reservedDataStore.lightGizmo = this;\n\n            if (light.parent) {\n                // this._attachedMeshParent.freezeWorldMatrix(light.parent.getWorldMatrix());\n                this._attachedMeshParent.freezeWorldMatrix();\n            }\n\n\n\n            if (light.parent && light.parent instanceof VeryLight) {\n                if (light instanceof BABYLON.HemisphericLight) {\n                    this.attachedMesh!.position.copyFrom(light.parent.position);\n                    this.attachedMesh!.computeWorldMatrix(true);\n                    this._cachedPosition.copyFrom(this.attachedMesh!.position);\n\n                    let newDirection = Tools.transformLocalToWorldDirection(light.parent, BABYLON.Vector3.Down());\n                    // this.attachedMesh!.setDirection((light as any).direction);\n                    this.attachedMesh!.setDirection(newDirection);\n                    this.attachedMesh!.computeWorldMatrix(true);\n                    this._cachedForward.copyFrom(this.attachedMesh!.forward);\n\n                } else {\n                    if ((light as any).position) {\n                        this.attachedMesh!.position.copyFrom(light.parent.position);\n                        this.attachedMesh!.computeWorldMatrix(true);\n                        this._cachedPosition.copyFrom(this.attachedMesh!.position);\n                    }\n\n                    if ((light as any).direction) {\n                        let newDirection = Tools.transformLocalToWorldDirection(light, (light as any).direction);\n                        // this.attachedMesh!.setDirection((light as any).direction);\n                        this.attachedMesh!.setDirection(newDirection);\n                        this.attachedMesh!.computeWorldMatrix(true);\n                        this._cachedForward.copyFrom(this.attachedMesh!.forward);\n                    }\n                }\n            } else {\n                // Get update position and direction if the light has it\n                if ((light as any).position) {\n                    this.attachedMesh!.position.copyFrom((light as any).position);\n                    this.attachedMesh!.computeWorldMatrix(true);\n                    this._cachedPosition.copyFrom(this.attachedMesh!.position);\n                }\n\n                if ((light as any).direction) {\n                    this.attachedMesh!.setDirection((light as any).direction);\n                    this.attachedMesh!.computeWorldMatrix(true);\n                    this._cachedForward.copyFrom(this.attachedMesh!.forward);\n                }\n            }\n\n\n            this._update();\n        }\n    }\n    public get light() {\n        return this._light;\n    }\n\n    /**\n     * Gets the material used to render the light gizmo\n     */\n    public get material() {\n        return this._material;\n    }\n\n    /**\n     * @hidden\n     * Updates the gizmo to match the attached mesh's position/rotation\n     */\n    protected _update() {\n        super._update();\n        if (!this._light) {\n            return;\n        }\n\n        if (this._light.parent) {\n            // this._attachedMeshParent.freezeWorldMatrix(this._light.parent.getWorldMatrix());\n            this._attachedMeshParent.freezeWorldMatrix();\n        }\n\n\n\n        // 更改light rotation\n        if (this._light.parent && this._light.parent instanceof VeryLight) {\n\n            if (this._light instanceof BABYLON.HemisphericLight) {\n\n                // If the gizmo is moved update the light otherwise update the gizmo to match the light\n                if (!this.attachedMesh!.position.equals(this._cachedPosition)) {\n                    // update light to match gizmo\n                    this._light.parent.position.copyFrom(this.attachedMesh!.position);\n                    this._cachedPosition.copyFrom(this.attachedMesh!.position);\n                } else {\n                    // update gizmo to match light\n                    this.attachedMesh!.position.copyFrom(this._light.parent.position);\n                    // console.log((this._light as any).getAbsolutePosition());\n                    this.attachedMesh!.computeWorldMatrix(true);\n                    this._cachedPosition.copyFrom(this.attachedMesh!.position);\n                }\n\n                let newDirection = Tools.transformLocalToWorldDirection(this._light.parent, BABYLON.Vector3.Up());\n                \n                // If the gizmo is moved update the light otherwise update the gizmo to match the light\n                if (BABYLON.Vector3.DistanceSquared(this.attachedMesh!.forward, this._cachedForward) > 0.0001) {\n                    // update light to match gizmo\n                    // TODO\n                    // newDirection.copyFrom(this.attachedMesh!.forward);\n                    // (<BABYLON.HemisphericLight>this.light).direction.copyFrom(newDirection);\n                    this._cachedForward.copyFrom(this.attachedMesh!.forward);\n                } else if (BABYLON.Vector3.DistanceSquared(this.attachedMesh!.forward, newDirection) > 0.0001) {\n                    // console.log('hemi');\n                    // update gizmo to match light\n                    this.attachedMesh!.setDirection(newDirection);\n                    this.attachedMesh!.computeWorldMatrix(true);\n                    this._cachedForward.copyFrom(this.attachedMesh!.forward);\n                    (<BABYLON.HemisphericLight>this.light).direction.copyFrom(this._light.parent.up);\n                }\n            } else {\n                if ((this._light as any).position) {\n                    // If the gizmo is moved update the light otherwise update the gizmo to match the light\n                    if (!this.attachedMesh!.position.equals(this._cachedPosition)) {\n                        // update light to match gizmo\n                        (this._light as any).position.copyFrom(this.attachedMesh!.position);\n                        this._cachedPosition.copyFrom(this.attachedMesh!.position);\n                    } else {\n                        // update gizmo to match light\n                        this.attachedMesh!.position.copyFrom(this._light.parent.position);\n                        // console.log((this._light as any).getAbsolutePosition());\n                        this.attachedMesh!.computeWorldMatrix(true);\n                        this._cachedPosition.copyFrom(this.attachedMesh!.position);\n                    }\n                }\n\n                // console.log((this._light as any).direction);\n                if ((this._light as any).direction) {\n                    let newDirection = Tools.transformLocalToWorldDirection(this._light, (this._light as any).direction);\n                    // If the gizmo is moved update the light otherwise update the gizmo to match the light\n                    if (BABYLON.Vector3.DistanceSquared(this.attachedMesh!.forward, this._cachedForward) > 0.0001) {\n                        console.log('light');\n                        // update light to match gizmo\n                        newDirection.copyFrom(this.attachedMesh!.forward);\n                        this._cachedForward.copyFrom(this.attachedMesh!.forward);\n                    } else if (BABYLON.Vector3.DistanceSquared(this.attachedMesh!.forward, newDirection) > 0.0001) {\n                        // update gizmo to match light\n                        this.attachedMesh!.setDirection(newDirection);\n                        this.attachedMesh!.computeWorldMatrix(true);\n                        this._cachedForward.copyFrom(this.attachedMesh!.forward);\n                    }\n                }\n            }\n\n        } else {\n            if ((this._light as any).position) {\n                // If the gizmo is moved update the light otherwise update the gizmo to match the light\n                if (!this.attachedMesh!.position.equals(this._cachedPosition)) {\n                    // update light to match gizmo\n                    (this._light as any).position.copyFrom(this.attachedMesh!.position);\n                    this._cachedPosition.copyFrom(this.attachedMesh!.position);\n                } else {\n                    // update gizmo to match light\n                    this.attachedMesh!.position.copyFrom((this._light as any).position);\n                    // console.log((this._light as any).getAbsolutePosition());\n                    this.attachedMesh!.computeWorldMatrix(true);\n                    this._cachedPosition.copyFrom(this.attachedMesh!.position);\n                }\n            }\n\n            if ((this._light as any).direction) {\n                // If the gizmo is moved update the light otherwise update the gizmo to match the light\n                if (BABYLON.Vector3.DistanceSquared(this.attachedMesh!.forward, this._cachedForward) > 0.0001) {\n                    // update light to match gizmo\n                    (this._light as any).direction.copyFrom(this.attachedMesh!.forward);\n                    this._cachedForward.copyFrom(this.attachedMesh!.forward);\n                } else if (BABYLON.Vector3.DistanceSquared(this.attachedMesh!.forward, (this._light as any).direction) > 0.0001) {\n                    // update gizmo to match light\n                    this.attachedMesh!.setDirection((this._light as any).direction);\n                    this.attachedMesh!.computeWorldMatrix(true);\n                    this._cachedForward.copyFrom(this.attachedMesh!.forward);\n                }\n            }\n        }\n    }\n\n    // Static helper methods\n    private static _Scale = 0.007;\n\n    /**\n     * Creates the lines for a light mesh\n     */\n    private static _CreateLightLines = (levels: number, scene: BABYLON.Scene) => {\n        var distFromSphere = 1.2;\n\n        var root = new BABYLON.Mesh(\"root\", scene);\n        root.rotation.x = Math.PI / 2;\n\n        // Create the top line, this will be cloned for all other lines\n        var linePivot = new BABYLON.Mesh(\"linePivot\", scene);\n        linePivot.parent = root;\n        var line = BABYLON.Mesh.CreateCylinder(\"line\", 2, 0.2, 0.3, 6, 1, scene);\n        line.position.y = line.scaling.y / 2 + distFromSphere;\n        line.parent = linePivot;\n\n        if (levels < 2) {\n            return linePivot;\n        }\n        for (var i = 0; i < 4; i++) {\n            var l = linePivot.clone(\"lineParentClone\")!;\n            l.rotation.z = Math.PI / 4;\n            l.rotation.y = (Math.PI / 2) + (Math.PI / 2 * i);\n\n            l.getChildMeshes()[0].scaling.y = 0.5;\n            l.getChildMeshes()[0].scaling.x = l.getChildMeshes()[0].scaling.z = 0.8;\n            l.getChildMeshes()[0].position.y = l.getChildMeshes()[0].scaling.y / 2 + distFromSphere;\n        }\n\n        if (levels < 3) {\n            return root;\n        }\n        for (var i = 0; i < 4; i++) {\n            var l = linePivot.clone(\"linePivotClone\");\n            l.rotation.z = Math.PI / 2;\n            l.rotation.y = (Math.PI / 2 * i);\n        }\n\n        if (levels < 4) {\n            return root;\n        }\n        for (var i = 0; i < 4; i++) {\n            var l = linePivot.clone(\"linePivotClone\");\n            l.rotation.z = Math.PI + (Math.PI / 4);\n            l.rotation.y = (Math.PI / 2) + (Math.PI / 2 * i);\n\n            l.getChildMeshes()[0].scaling.y = 0.5;\n            l.getChildMeshes()[0].scaling.x = l.getChildMeshes()[0].scaling.z = 0.8;\n            l.getChildMeshes()[0].position.y = l.getChildMeshes()[0].scaling.y / 2 + distFromSphere;\n        }\n\n        if (levels < 5) {\n            return root;\n        }\n        var l = linePivot.clone(\"linePivotClone\");\n        l.rotation.z = Math.PI;\n\n        return root;\n    }\n\n    /**\n     * Disposes of the light gizmo\n     */\n    public dispose() {\n        this.onClickedObservable.clear();\n        this.gizmoLayer.utilityLayerScene.onPointerObservable.remove(this._pointerObserver);\n        this._material.dispose();\n        super.dispose();\n        this._attachedMeshParent.dispose();\n    }\n\n    private static _CreateHemisphericLightMesh(scene: BABYLON.Scene) {\n        var root = new BABYLON.Mesh(\"hemisphereLight\", scene);\n        var hemisphere = BABYLON.HemisphereBuilder.CreateHemisphere(root.name, { segments: 10, diameter: 1 }, scene);\n        hemisphere.position.z = -0.15;\n        hemisphere.rotation.x = Math.PI / 2;\n        hemisphere.parent = root;\n\n        var lines = this._CreateLightLines(3, scene);\n        lines.parent = root;\n        lines.position.z - 0.15;\n\n        root.scaling.scaleInPlace(LightGizmo._Scale);\n        root.rotation.x = Math.PI / 2;\n\n        return root;\n    }\n\n    private static _CreatePointLightMesh(scene: BABYLON.Scene) {\n        var root = new BABYLON.Mesh(\"pointLight\", scene);\n        var sphere = BABYLON.SphereBuilder.CreateSphere(root.name, { segments: 10, diameter: 1 }, scene);\n        sphere.rotation.x = Math.PI / 2;\n        sphere.parent = root;\n\n        var lines = this._CreateLightLines(5, scene);\n        lines.parent = root;\n        root.scaling.scaleInPlace(LightGizmo._Scale);\n        root.rotation.x = Math.PI / 2;\n\n        return root;\n    }\n\n    private static _CreateSpotLightMesh(scene: BABYLON.Scene) {\n        var root = new BABYLON.Mesh(\"spotLight\", scene);\n        var sphere = BABYLON.SphereBuilder.CreateSphere(root.name, { segments: 10, diameter: 1 }, scene);\n        sphere.parent = root;\n\n        var hemisphere = BABYLON.HemisphereBuilder.CreateHemisphere(root.name, { segments: 10, diameter: 2 }, scene);\n        hemisphere.parent = root;\n        hemisphere.rotation.x = -Math.PI / 2;\n\n        var lines = this._CreateLightLines(2, scene);\n        lines.parent = root;\n        root.scaling.scaleInPlace(LightGizmo._Scale);\n        root.rotation.x = Math.PI / 2;\n\n        return root;\n    }\n\n    private static _CreateDirectionalLightMesh(scene: BABYLON.Scene) {\n        var root = new BABYLON.Mesh(\"directionalLight\", scene);\n\n        var mesh = new BABYLON.Mesh(root.name, scene);\n        mesh.parent = root;\n        var sphere = BABYLON.SphereBuilder.CreateSphere(root.name, { diameter: 1.2, segments: 10 }, scene);\n        sphere.parent = mesh;\n\n        var line = BABYLON.Mesh.CreateCylinder(root.name, 6, 0.3, 0.3, 6, 1, scene);\n        line.parent = mesh;\n\n        var left = line.clone(root.name)!;\n        left.scaling.y = 0.5;\n        left.position.x += 1.25;\n\n        var right = line.clone(root.name)!;\n        right.scaling.y = 0.5;\n        right.position.x += -1.25;\n\n        var arrowHead = BABYLON.Mesh.CreateCylinder(root.name, 1, 0, 0.6, 6, 1, scene);\n        arrowHead.position.y += 3;\n        arrowHead.parent = mesh;\n\n        var left = arrowHead.clone(root.name);\n        left.position.y = 1.5;\n        left.position.x += 1.25;\n\n        var right = arrowHead.clone(root.name);\n        right.position.y = 1.5;\n        right.position.x += -1.25;\n\n        mesh.scaling.scaleInPlace(LightGizmo._Scale);\n        mesh.rotation.z = Math.PI / 2;\n        mesh.rotation.y = Math.PI / 2;\n        return root;\n    }\n}","// import { Observer, Observable } from \"../Misc/observable\";\n// import { Nullable } from \"../types\";\n// import { PointerInfo } from \"../Events/pointerEvents\";\n// import { Vector3, Matrix } from \"../Maths/math.vector\";\n// import { Color3 } from '../Maths/math.color';\n// import { TransformNode } from \"../Meshes/transformNode\";\n// import { Node } from \"../node\";\n// import { Mesh } from \"../Meshes/mesh\";\n// import { PlaneBuilder } from \"../Meshes/Builders/planeBuilder\";\n// import { PointerDragBehavior } from \"../Behaviors/Meshes/pointerDragBehavior\";\nimport { Gizmo } from \"./gizmo\";\n// import { UtilityLayerRenderer } from \"../Rendering/utilityLayerRenderer\";\n// import { StandardMaterial } from \"../Materials/standardMaterial\";\n// import { Scene } from \"../scene\";\nimport { PositionGizmo } from \"./positionGizmo\";\nimport { UtilityLayerRenderer } from \"./UtilityLayerRenderer\";\n/**\n * Single plane drag gizmo\n */\nexport class PlaneDragGizmo extends Gizmo {\n    /**\n     * Drag behavior responsible for the gizmos dragging interactions\n     */\n    public dragBehavior: BABYLON.PointerDragBehavior;\n    private _pointerObserver: Nullable<BABYLON.Observer<BABYLON.PointerInfo>> = null;\n    /**\n     * Drag distance in babylon units that the gizmo will snap to when dragged (Default: 0)\n     */\n    public snapDistance = 0;\n    /**\n     * Event that fires each time the gizmo snaps to a new location.\n     * * snapDistance is the the change in distance\n     */\n    public onSnapObservable = new BABYLON.Observable<{ snapDistance: number }>();\n\n    private _plane: BABYLON.TransformNode;\n    private _coloredMaterial: BABYLON.StandardMaterial;\n    private _hoverMaterial: BABYLON.StandardMaterial;\n\n    private _isEnabled: boolean = false;\n    private _parent: Nullable<PositionGizmo> = null;\n\n    /** @hidden */\n    public static _CreatePlane(scene: BABYLON.Scene, material: BABYLON.StandardMaterial): BABYLON.TransformNode {\n        var plane = new BABYLON.TransformNode(\"plane\", scene);\n\n        //make sure plane is double sided\n        var dragPlane = BABYLON.PlaneBuilder.CreatePlane(\"dragPlane\", { width: .1375, height: .1375, sideOrientation: 2 }, scene);\n        // var dragPlane = BABYLON.MeshBuilder.CreateGround(\"dragPlane\", { width: .1375, height: .1375 }, scene)\n        // .CreatePlane(\"dragPlane\", .1375, scene, undefined, 2);\n        dragPlane.material = material;\n        dragPlane.parent = plane;\n        return plane;\n    }\n\n    /** @hidden */\n    public static _CreateArrowInstance(scene: BABYLON.Scene, arrow: BABYLON.TransformNode): BABYLON.TransformNode {\n        const instance = new BABYLON.TransformNode(\"arrow\", scene);\n        for (const mesh of arrow.getChildMeshes()) {\n            const childInstance = (mesh as BABYLON.Mesh).createInstance(mesh.name);\n            childInstance.parent = instance;\n        }\n        return instance;\n    }\n\n    /**\n     * Creates a PlaneDragGizmo\n     * @param gizmoLayer The utility layer the gizmo will be added to\n     * @param dragPlaneNormal The axis normal to which the gizmo will be able to drag on\n     * @param color The color of the gizmo\n     */\n    constructor(dragPlaneNormal: BABYLON.Vector3, color: BABYLON.Color3 = BABYLON.Color3.Gray(), gizmoLayer: UtilityLayerRenderer = UtilityLayerRenderer.DefaultUtilityLayer, parent: Nullable<PositionGizmo> = null) {\n        super(gizmoLayer);\n        this._parent = parent;\n        // Create Material\n        this._coloredMaterial = new BABYLON.StandardMaterial(\"\", gizmoLayer.utilityLayerScene);\n        this._coloredMaterial.diffuseColor = color;\n        this._coloredMaterial.specularColor = color.subtract(new BABYLON.Color3(0.1, 0.1, 0.1));\n        this._coloredMaterial.alpha = 0.5;\n\n        this._hoverMaterial = new BABYLON.StandardMaterial(\"\", gizmoLayer.utilityLayerScene);\n        this._hoverMaterial.diffuseColor = color.add(new BABYLON.Color3(0.3, 0.3, 0.3));\n        this._hoverMaterial.alpha = 0.4;\n\n        // Build plane mesh on root node\n        this._plane = PlaneDragGizmo._CreatePlane(gizmoLayer.utilityLayerScene, this._coloredMaterial);\n\n        this._plane.lookAt(this._rootMesh.position.add(dragPlaneNormal));\n        this._plane.scaling.scaleInPlace(1 / 6);\n        this._plane.parent = this._rootMesh;\n        \n        if(dragPlaneNormal.x > 0) {\n            this._plane.position = new BABYLON.Vector3(0, .1375 / 12, .1375 / 12);\n        } else if(dragPlaneNormal.y > 0) {\n            this._plane.position = new BABYLON.Vector3(.1375 / 12, 0, .1375 / 12);\n        } else {\n            this._plane.position = new BABYLON.Vector3(.1375 / 12, .1375 / 12, 0);\n        }\n\n        var currentSnapDragDistance = 0;\n        var tmpVector = new BABYLON.Vector3();\n        var tmpSnapEvent = { snapDistance: 0 };\n        // Add dragPlaneNormal drag behavior to handle events when the gizmo is dragged\n        this.dragBehavior = new BABYLON.PointerDragBehavior({ dragPlaneNormal: dragPlaneNormal });\n        this.dragBehavior.moveAttached = false;\n        this._rootMesh.addBehavior(this.dragBehavior);\n\n        var localDelta = new BABYLON.Vector3();\n        var tmpMatrix = new BABYLON.Matrix();\n        this.dragBehavior.onDragObservable.add((event) => {\n            if (this.attachedNode) {\n                // Convert delta to local translation if it has a parent\n                if (this.attachedNode.parent) {\n                    this.attachedNode.parent.computeWorldMatrix().invertToRef(tmpMatrix);\n                    tmpMatrix.setTranslationFromFloats(0, 0, 0);\n                    BABYLON.Vector3.TransformCoordinatesToRef(event.delta, tmpMatrix, localDelta);\n                } else {\n                    localDelta.copyFrom(event.delta);\n                }\n                // Snapping logic\n                if (this.snapDistance == 0) {\n                    this.attachedNode.getWorldMatrix().addTranslationFromFloats(localDelta.x, localDelta.y, localDelta.z);\n                } else {\n                    currentSnapDragDistance += event.dragDistance;\n                    if (Math.abs(currentSnapDragDistance) > this.snapDistance) {\n                        var dragSteps = Math.floor(Math.abs(currentSnapDragDistance) / this.snapDistance);\n                        currentSnapDragDistance = currentSnapDragDistance % this.snapDistance;\n                        localDelta.normalizeToRef(tmpVector);\n                        tmpVector.scaleInPlace(this.snapDistance * dragSteps);\n                        this.attachedNode.getWorldMatrix().addTranslationFromFloats(tmpVector.x, tmpVector.y, tmpVector.z);\n                        tmpSnapEvent.snapDistance = this.snapDistance * dragSteps;\n                        this.onSnapObservable.notifyObservers(tmpSnapEvent);\n                    }\n                }\n                this._operationType = 'plane';\n                this._matrixChanged();\n            }\n        });\n\n        this._pointerObserver = gizmoLayer.utilityLayerScene.onPointerObservable.add((pointerInfo) => {\n            if (this._customMeshSet) {\n                return;\n            }\n            var isHovered = pointerInfo.pickInfo && (this._rootMesh.getChildMeshes().indexOf(<BABYLON.Mesh>pointerInfo.pickInfo.pickedMesh) != -1);\n            var material = isHovered ? this._hoverMaterial : this._coloredMaterial;\n            this._rootMesh.getChildMeshes().forEach((m) => {\n                m.material = material;\n            });\n        });\n\n        var light = gizmoLayer._getSharedGizmoLight();\n        light.includedOnlyMeshes = light.includedOnlyMeshes.concat(this._rootMesh.getChildMeshes(false));\n    }\n    protected _attachedNodeChanged(value: Nullable<BABYLON.Node>) {\n        if (this.dragBehavior) {\n            this.dragBehavior.enabled = value ? true : false;\n        }\n    }\n\n    /**\n     * If the gizmo is enabled\n     */\n    public set isEnabled(value: boolean) {\n        this._isEnabled = value;\n        if (!value) {\n            this.attachedNode = null;\n        }\n        else {\n            if (this._parent) {\n                this.attachedNode = this._parent.attachedNode;\n            }\n        }\n    }\n    public get isEnabled(): boolean {\n        return this._isEnabled;\n    }\n    /**\n     * Disposes of the gizmo\n     */\n    public dispose() {\n        this.onSnapObservable.clear();\n        this.gizmoLayer.utilityLayerScene.onPointerObservable.remove(this._pointerObserver);\n        this.dragBehavior.detach();\n        super.dispose();\n        if (this._plane) {\n            this._plane.dispose();\n        }\n        [this._coloredMaterial, this._hoverMaterial].forEach((matl) => {\n            if (matl) {\n                matl.dispose();\n            }\n        });\n    }\n}","// import { Observer, Observable } from \"../Misc/observable\";\n// import { Nullable } from \"../types\";\n// import { PointerInfo } from \"../Events/pointerEvents\";\n// import { Quaternion, Matrix, Vector3 } from \"../Maths/math.vector\";\n// import { Color3 } from '../Maths/math.color';\n// import { AbstractMesh } from \"../Meshes/abstractMesh\";\n// import { Mesh } from \"../Meshes/mesh\";\n// import { Node } from \"../node\";\n// import { LinesMesh } from \"../Meshes/linesMesh\";\n// import { PointerDragBehavior } from \"../Behaviors/Meshes/pointerDragBehavior\";\nimport { Gizmo } from \"./gizmo\";\n// import { UtilityLayerRenderer } from \"../Rendering/utilityLayerRenderer\";\n// import { StandardMaterial } from \"../Materials/standardMaterial\";\n\n// import \"../Meshes/Builders/linesBuilder\";\nimport { RotationGizmo } from \"./rotationGizmo\";\nimport { UtilityLayerRenderer } from \"./UtilityLayerRenderer\";\n\n/**\n * Single plane rotation gizmo\n */\nexport class PlaneRotationGizmo extends Gizmo {\n    /**\n     * Drag behavior responsible for the gizmos dragging interactions\n     */\n    public dragBehavior: BABYLON.PointerDragBehavior;\n    private _pointerObserver: Nullable<BABYLON.Observer<BABYLON.PointerInfo>> = null;\n\n    /**\n     * Rotation distance in radians that the gizmo will snap to (Default: 0)\n     */\n    public snapDistance = 0;\n    /**\n     * Event that fires each time the gizmo snaps to a new location.\n     * * snapDistance is the the change in distance\n     */\n    public onSnapObservable = new BABYLON.Observable<{ snapDistance: number }>();\n\n    private _isEnabled: boolean = true;\n    private _parent: Nullable<RotationGizmo> = null;\n\n    /**\n     * Creates a PlaneRotationGizmo\n     * @param gizmoLayer The utility layer the gizmo will be added to\n     * @param planeNormal The normal of the plane which the gizmo will be able to rotate on\n     * @param color The color of the gizmo\n     * @param tessellation Amount of tessellation to be used when creating rotation circles\n     * @param useEulerRotation Use and update Euler angle instead of quaternion\n     * @param thickness display gizmo axis thickness\n     */\n    constructor(planeNormal: BABYLON.Vector3, color: BABYLON.Color3 = BABYLON.Color3.Gray(), gizmoLayer: UtilityLayerRenderer = UtilityLayerRenderer.DefaultUtilityLayer, tessellation = 32, parent: Nullable<RotationGizmo> = null, useEulerRotation = false, thickness: number = 1) {\n        super(gizmoLayer);\n        this._parent = parent;\n        // Create Material\n        var coloredMaterial = new BABYLON.StandardMaterial(\"\", gizmoLayer.utilityLayerScene);\n        coloredMaterial.diffuseColor = color;\n        coloredMaterial.specularColor = color.subtract(new BABYLON.Color3(0.1, 0.1, 0.1));\n\n        var hoverMaterial = new BABYLON.StandardMaterial(\"\", gizmoLayer.utilityLayerScene);\n        hoverMaterial.diffuseColor = color.add(new BABYLON.Color3(0.3, 0.3, 0.3));\n\n        // Build mesh on root node\n        var parentMesh = new BABYLON.AbstractMesh(\"\", gizmoLayer.utilityLayerScene);\n\n        let drag = BABYLON.Mesh.CreateTorus(\"\", 0.6, 0.03 * thickness, tessellation, gizmoLayer.utilityLayerScene);\n        drag.visibility = 0;\n        let rotationMesh = BABYLON.Mesh.CreateTorus(\"\", 0.6, 0.005 * thickness, tessellation, gizmoLayer.utilityLayerScene);\n        rotationMesh.material = coloredMaterial;\n\n        // Position arrow pointing in its drag axis\n        rotationMesh.rotation.x = Math.PI / 2;\n        drag.rotation.x = Math.PI / 2;\n        parentMesh.addChild(rotationMesh);\n        parentMesh.addChild(drag);\n        parentMesh.lookAt(this._rootMesh.position.add(planeNormal));\n\n        this._rootMesh.addChild(parentMesh);\n        parentMesh.scaling.scaleInPlace(1 / 3);\n        // Add drag behavior to handle events when the gizmo is dragged\n        this.dragBehavior = new BABYLON.PointerDragBehavior({ dragPlaneNormal: planeNormal });\n        this.dragBehavior.moveAttached = false;\n        this.dragBehavior.maxDragAngle = Math.PI * 9 / 20;\n        this.dragBehavior._useAlternatePickedPointAboveMaxDragAngle = true;\n        this._rootMesh.addBehavior(this.dragBehavior);\n\n        var lastDragPosition = new BABYLON.Vector3();\n\n        this.dragBehavior.onDragStartObservable.add((e) => {\n            if (this.attachedNode) {\n                lastDragPosition.copyFrom(e.dragPlanePoint);\n            }\n        });\n\n        var rotationMatrix = new BABYLON.Matrix();\n        var planeNormalTowardsCamera = new BABYLON.Vector3();\n        var localPlaneNormalTowardsCamera = new BABYLON.Vector3();\n\n        var tmpSnapEvent = { snapDistance: 0 };\n        var currentSnapDragDistance = 0;\n        var tmpMatrix = new BABYLON.Matrix();\n        var amountToRotate = new BABYLON.Quaternion();\n        this.dragBehavior.onDragObservable.add((event) => {\n            if (this.attachedNode) {\n                // Calc angle over full 360 degree (https://stackoverflow.com/questions/43493711/the-angle-between-two-3d-vectors-with-a-result-range-0-360)\n                var nodeScale = new BABYLON.Vector3(1, 1, 1);\n                var nodeQuaternion = new BABYLON.Quaternion(0, 0, 0, 1);\n                var nodeTranslation = new BABYLON.Vector3(0, 0, 0);\n                this.attachedNode.getWorldMatrix().decompose(nodeScale, nodeQuaternion, nodeTranslation);\n\n                var newVector = event.dragPlanePoint.subtract(nodeTranslation).normalize();\n                var originalVector = lastDragPosition.subtract(nodeTranslation).normalize();\n                var cross = BABYLON.Vector3.Cross(newVector, originalVector);\n                var dot = BABYLON.Vector3.Dot(newVector, originalVector);\n                var angle = Math.atan2(cross.length(), dot);\n                planeNormalTowardsCamera.copyFrom(planeNormal);\n                localPlaneNormalTowardsCamera.copyFrom(planeNormal);\n                if (this.updateGizmoRotationToMatchAttachedMesh) {\n                    nodeQuaternion.toRotationMatrix(rotationMatrix);\n                    localPlaneNormalTowardsCamera = BABYLON.Vector3.TransformCoordinates(planeNormalTowardsCamera, rotationMatrix);\n                }\n                // Flip up vector depending on which side the camera is on\n                if (gizmoLayer.utilityLayerScene.activeCamera) {\n                    var camVec = gizmoLayer.utilityLayerScene.activeCamera.position.subtract(nodeTranslation);\n                    if (BABYLON.Vector3.Dot(camVec, localPlaneNormalTowardsCamera) > 0) {\n                        planeNormalTowardsCamera.scaleInPlace(-1);\n                        localPlaneNormalTowardsCamera.scaleInPlace(-1);\n                    }\n                }\n                var halfCircleSide = BABYLON.Vector3.Dot(localPlaneNormalTowardsCamera, cross) > 0.0;\n                if (halfCircleSide) { angle = -angle; }\n\n                // Snapping logic\n                var snapped = false;\n                if (this.snapDistance != 0) {\n                    currentSnapDragDistance += angle;\n                    if (Math.abs(currentSnapDragDistance) > this.snapDistance) {\n                        var dragSteps = Math.floor(Math.abs(currentSnapDragDistance) / this.snapDistance);\n                        if (currentSnapDragDistance < 0) {\n                            dragSteps *= -1;\n                        }\n                        currentSnapDragDistance = currentSnapDragDistance % this.snapDistance;\n                        angle = this.snapDistance * dragSteps;\n                        snapped = true;\n                    } else {\n                        angle = 0;\n                    }\n                }\n\n                // Convert angle and axis to quaternion (http://www.euclideanspace.com/maths/geometry/rotations/conversions/angleToQuaternion/index.htm)\n                var quaternionCoefficient = Math.sin(angle / 2);\n                amountToRotate.set(planeNormalTowardsCamera.x * quaternionCoefficient, planeNormalTowardsCamera.y * quaternionCoefficient, planeNormalTowardsCamera.z * quaternionCoefficient, Math.cos(angle / 2));\n\n                // If the meshes local scale is inverted (eg. loaded gltf file parent with z scale of -1) the rotation needs to be inverted on the y axis\n                if (tmpMatrix.determinant() > 0) {\n                    var tmpVector = new BABYLON.Vector3();\n                    amountToRotate.toEulerAnglesToRef(tmpVector);\n                    BABYLON.Quaternion.RotationYawPitchRollToRef(tmpVector.y, -tmpVector.x, -tmpVector.z, amountToRotate);\n                }\n\n                if (this.updateGizmoRotationToMatchAttachedMesh) {\n                    // Rotate selected mesh quaternion over fixed axis\n                    nodeQuaternion.multiplyToRef(amountToRotate, nodeQuaternion);\n                } else {\n                    // Rotate selected mesh quaternion over rotated axis\n                    amountToRotate.multiplyToRef(nodeQuaternion, nodeQuaternion);\n                }\n\n                // recompose matrix\n                this.attachedNode.getWorldMatrix().copyFrom(BABYLON.Matrix.Compose(nodeScale, nodeQuaternion, nodeTranslation));\n\n                lastDragPosition.copyFrom(event.dragPlanePoint);\n                if (snapped) {\n                    tmpSnapEvent.snapDistance = angle;\n                    this.onSnapObservable.notifyObservers(tmpSnapEvent);\n                }\n                this._operationType = 'rotate';\n                this._matrixChanged();\n            }\n        });\n\n        this._pointerObserver = gizmoLayer.utilityLayerScene.onPointerObservable.add((pointerInfo) => {\n            if (this._customMeshSet) {\n                return;\n            }\n            var isHovered = pointerInfo.pickInfo && (this._rootMesh.getChildMeshes().indexOf(<BABYLON.Mesh>pointerInfo.pickInfo.pickedMesh) != -1);\n            var material = isHovered ? hoverMaterial : coloredMaterial;\n            this._rootMesh.getChildMeshes().forEach((m) => {\n                m.material = material;\n                if ((<BABYLON.LinesMesh>m).color) {\n                    (<BABYLON.LinesMesh>m).color = material.diffuseColor;\n                }\n            });\n        });\n\n        var light = gizmoLayer._getSharedGizmoLight();\n        light.includedOnlyMeshes = light.includedOnlyMeshes.concat(this._rootMesh.getChildMeshes(false));\n    }\n\n    protected _attachedNodeChanged(value: Nullable<BABYLON.Node>) {\n        if (this.dragBehavior) {\n            this.dragBehavior.enabled = value ? true : false;\n        }\n    }\n\n    /**\n         * If the gizmo is enabled\n         */\n    public set isEnabled(value: boolean) {\n        this._isEnabled = value;\n        if (!value) {\n            this.attachedMesh = null;\n        }\n        else {\n            if (this._parent) {\n                this.attachedMesh = this._parent.attachedMesh;\n            }\n        }\n    }\n    public get isEnabled(): boolean {\n        return this._isEnabled;\n    }\n    /**\n     * Disposes of the gizmo\n     */\n    public dispose() {\n        this.onSnapObservable.clear();\n        this.gizmoLayer.utilityLayerScene.onPointerObservable.remove(this._pointerObserver);\n        this.dragBehavior.detach();\n        super.dispose();\n    }\n}","// import { Logger } from \"../Misc/logger\";\n// import { Observable } from \"../Misc/observable\";\n// import { Nullable } from \"../types\";\n// import { Vector3 } from \"../Maths/math.vector\";\n// import { Color3 } from '../Maths/math.color';\n// import { AbstractMesh } from \"../Meshes/abstractMesh\";\n// import { Node } from \"../node\";\n// import { Mesh } from \"../Meshes/mesh\";\nimport { Gizmo } from \"./gizmo\";\nimport { AxisDragGizmo } from \"./axisDragGizmo\";\nimport { PlaneDragGizmo } from \"./planeDragGizmo\";\nimport { UtilityLayerRenderer } from \"./UtilityLayerRenderer\";\n// import { UtilityLayerRenderer } from \"../Rendering/utilityLayerRenderer\";\n/**\n * Gizmo that enables dragging a mesh along 3 axis\n */\nexport class PositionGizmo extends Gizmo {\n    /**\n     * Internal gizmo used for interactions on the x axis\n     */\n    public xGizmo: AxisDragGizmo;\n    /**\n     * Internal gizmo used for interactions on the y axis\n     */\n    public yGizmo: AxisDragGizmo;\n    /**\n     * Internal gizmo used for interactions on the z axis\n     */\n    public zGizmo: AxisDragGizmo;\n    /**\n     * Internal gizmo used for interactions on the yz plane\n     */\n    public xPlaneGizmo: PlaneDragGizmo;\n    /**\n     * Internal gizmo used for interactions on the xz plane\n     */\n    public yPlaneGizmo: PlaneDragGizmo;\n    /**\n     * Internal gizmo used for interactions on the xy plane\n     */\n    public zPlaneGizmo: PlaneDragGizmo;\n\n    /**\n     * private variables\n     */\n    private _meshAttached: Nullable<BABYLON.AbstractMesh> = null;\n    private _nodeAttached: Nullable<BABYLON.Node> = null;\n    private _snapDistance!: number;\n\n    /** Fires an event when any of it's sub gizmos are dragged */\n    public onDragStartObservable = new BABYLON.Observable();\n    /** Fires an event when any of it's sub gizmos are released from dragging */\n    public onDragEndObservable = new BABYLON.Observable();\n\n    /**\n     * If set to true, planar drag is enabled\n     */\n    private _planarGizmoEnabled = false;\n\n    public get attachedMesh() {\n        return this._meshAttached;\n    }\n    public set attachedMesh(mesh: Nullable<BABYLON.AbstractMesh>) {\n        this._meshAttached = mesh;\n        this._nodeAttached = mesh;\n        [this.xGizmo, this.yGizmo, this.zGizmo, this.xPlaneGizmo, this.yPlaneGizmo, this.zPlaneGizmo].forEach((gizmo) => {\n            if (gizmo.isEnabled) {\n                gizmo.attachedMesh = mesh;\n            }\n            else {\n                gizmo.attachedMesh = null;\n            }\n        });\n    }\n\n    public get attachedNode() {\n        return this._nodeAttached;\n    }\n    public set attachedNode(node: Nullable<BABYLON.Node>) {\n        this._meshAttached = null;\n        this._nodeAttached = null;\n        [this.xGizmo, this.yGizmo, this.zGizmo, this.xPlaneGizmo, this.yPlaneGizmo, this.zPlaneGizmo].forEach((gizmo) => {\n            if (gizmo.isEnabled) {\n                gizmo.attachedNode = node;\n            }\n            else {\n                gizmo.attachedNode = null;\n            }\n        });\n    }\n    /**\n     * Creates a PositionGizmo\n     * @param gizmoLayer The utility layer the gizmo will be added to\n      @param thickness display gizmo axis thickness\n     */\n    constructor(gizmoLayer: UtilityLayerRenderer = UtilityLayerRenderer.DefaultUtilityLayer, thickness: number = 1) {\n        super(gizmoLayer);\n        this.xGizmo = new AxisDragGizmo(new BABYLON.Vector3(1, 0, 0), BABYLON.Color3.Red().scale(0.5), gizmoLayer, this, thickness);\n        this.yGizmo = new AxisDragGizmo(new BABYLON.Vector3(0, 1, 0), BABYLON.Color3.Green().scale(0.5), gizmoLayer, this, thickness);\n        this.zGizmo = new AxisDragGizmo(new BABYLON.Vector3(0, 0, 1), BABYLON.Color3.Blue().scale(0.5), gizmoLayer, this, thickness);\n\n        this.xPlaneGizmo = new PlaneDragGizmo(new BABYLON.Vector3(1, 0, 0), BABYLON.Color3.Red().scale(0.5), this.gizmoLayer, this);\n        this.yPlaneGizmo = new PlaneDragGizmo(new BABYLON.Vector3(0, 1, 0), BABYLON.Color3.Green().scale(0.5), this.gizmoLayer, this);\n        this.zPlaneGizmo = new PlaneDragGizmo(new BABYLON.Vector3(0, 0, 1), BABYLON.Color3.Blue().scale(0.5), this.gizmoLayer, this);\n\n        this.onDragEndObservable.add(() => {\n            // console.log('position drag 结束');\n            // console.error(gizmoLayer.utilityLayerScene.rootNodes);\n        });\n        // Relay drag events\n        [this.xGizmo, this.yGizmo, this.zGizmo, this.xPlaneGizmo, this.yPlaneGizmo, this.zPlaneGizmo].forEach((gizmo) => {\n            gizmo.dragBehavior.onDragStartObservable.add(() => {\n                this.onDragStartObservable.notifyObservers({});\n            });\n            gizmo.dragBehavior.onDragEndObservable.add(() => {\n                this.onDragEndObservable.notifyObservers({});\n            });\n        });\n\n        this.planarGizmoEnabled = true;\n        // this.updateGizmoRotationToMatchAttachedMesh = false;\n        this.attachedMesh = null;\n\n        this.initialize();\n    }\n\n    public coordSystem: string = 'local';\n    private initialize(): void {\n        let self = this;\n        editor.on('gizmo:coordSystem', function (system: string) {\n            if (self.coordSystem === system)\n                return;\n\n            self.coordSystem = system;\n\n            if (self.coordSystem === 'world') {\n                self.updateGizmoRotationToMatchAttachedMesh = false;\n            } else {\n                self.updateGizmoRotationToMatchAttachedMesh = true;\n            }\n            // console.log('position: ' + self.updateGizmoRotationToMatchAttachedMesh);\n        });\n    }\n\n    /**\n     * If the planar drag gizmo is enabled\n     * setting this will enable/disable XY, XZ and YZ planes regardless of individual gizmo settings.\n     */\n    public set planarGizmoEnabled(value: boolean) {\n        this._planarGizmoEnabled = value;\n        [this.xPlaneGizmo, this.yPlaneGizmo, this.zPlaneGizmo].forEach((gizmo) => {\n            if (gizmo) {\n                gizmo.isEnabled = value;\n                if (value) {\n                    if (gizmo.attachedMesh) {\n                        gizmo.attachedMesh = this.attachedMesh;\n                    } else {\n                        gizmo.attachedNode = this.attachedNode;\n                    }\n\n                }\n            }\n        }, this);\n    }\n    public get planarGizmoEnabled(): boolean {\n        return this._planarGizmoEnabled;\n    }\n\n    public set updateGizmoRotationToMatchAttachedMesh(value: boolean) {\n        this._updateGizmoRotationToMatchAttachedMesh = value;\n        [this.xGizmo, this.yGizmo, this.zGizmo, this.xPlaneGizmo, this.yPlaneGizmo, this.zPlaneGizmo].forEach((gizmo) => {\n            if (gizmo) {\n                gizmo.updateGizmoRotationToMatchAttachedMesh = value;\n            }\n        });\n    }\n    public get updateGizmoRotationToMatchAttachedMesh() {\n        return this._updateGizmoRotationToMatchAttachedMesh;\n    }\n\n    /**\n     * Drag distance in babylon units that the gizmo will snap to when dragged (Default: 0)\n     */\n    public set snapDistance(value: number) {\n        this._snapDistance = value;\n        [this.xGizmo, this.yGizmo, this.zGizmo, this.xPlaneGizmo, this.yPlaneGizmo, this.zPlaneGizmo].forEach((gizmo) => {\n            if (gizmo) {\n                gizmo.snapDistance = value;\n            }\n        });\n    }\n    public get snapDistance() {\n        return this._snapDistance;\n    }\n\n    /**\n     * Ratio for the scale of the gizmo (Default: 1)\n     */\n    public set scaleRatio(value: number) {\n        this._scaleRatio = value;\n        [this.xGizmo, this.yGizmo, this.zGizmo, this.xPlaneGizmo, this.yPlaneGizmo, this.zPlaneGizmo].forEach((gizmo) => {\n            if (gizmo) {\n                gizmo.scaleRatio = value;\n            }\n        });\n    }\n    public get scaleRatio() {\n        return this._scaleRatio;\n    }\n\n    /**\n     * Disposes of the gizmo\n     */\n    public dispose() {\n        [this.xGizmo, this.yGizmo, this.zGizmo, this.xPlaneGizmo, this.yPlaneGizmo, this.zPlaneGizmo].forEach((gizmo) => {\n            if (gizmo) {\n                gizmo.dispose();\n            }\n        });\n        this.onDragStartObservable.clear();\n        this.onDragEndObservable.clear();\n    }\n\n    /**\n     * CustomMeshes are not supported by this gizmo\n     * @param mesh The mesh to replace the default mesh of the gizmo\n     */\n    public setCustomMesh(mesh: BABYLON.Mesh) {\n        BABYLON.Logger.Error(\"Custom meshes are not supported on this gizmo, please set the custom meshes on the gizmos contained within this one (gizmo.xGizmo, gizmo.yGizmo, gizmo.zGizmo,gizmo.xPlaneGizmo, gizmo.yPlaneGizmo, gizmo.zPlaneGizmo)\");\n    }\n}\n","// import { Logger } from \"../Misc/logger\";\n// import { Observable } from \"../Misc/observable\";\n// import { Nullable } from \"../types\";\n// import { Vector3 } from \"../Maths/math.vector\";\n// import { Color3 } from '../Maths/math.color';\n// import { AbstractMesh } from \"../Meshes/abstractMesh\";\n// import { Mesh } from \"../Meshes/mesh\";\nimport { Gizmo } from \"./gizmo\";\nimport { PlaneRotationGizmo } from \"./planeRotationGizmo\";\nimport { UtilityLayerRenderer } from \"./UtilityLayerRenderer\";\n// import { UtilityLayerRenderer } from \"../Rendering/utilityLayerRenderer\";\n// import { Node } from \"../node\";\n/**\n * Gizmo that enables rotating a mesh along 3 axis\n */\nexport class RotationGizmo extends Gizmo {\n    /**\n     * Internal gizmo used for interactions on the x axis\n     */\n    public xGizmo: PlaneRotationGizmo;\n    /**\n     * Internal gizmo used for interactions on the y axis\n     */\n    public yGizmo: PlaneRotationGizmo;\n    /**\n     * Internal gizmo used for interactions on the z axis\n     */\n    public zGizmo: PlaneRotationGizmo;\n\n    /** Fires an event when any of it's sub gizmos are dragged */\n    public onDragStartObservable = new BABYLON.Observable();\n    /** Fires an event when any of it's sub gizmos are released from dragging */\n    public onDragEndObservable = new BABYLON.Observable();\n\n    private _meshAttached!: Nullable<BABYLON.AbstractMesh>;\n    private _nodeAttached!: Nullable<BABYLON.Node>;\n\n    public get attachedMesh() {\n        return this._meshAttached;\n    }\n    public set attachedMesh(mesh: Nullable<BABYLON.AbstractMesh>) {\n        this._meshAttached = mesh;\n        this._nodeAttached = mesh;\n        [this.xGizmo, this.yGizmo, this.zGizmo].forEach((gizmo) => {\n            if (gizmo.isEnabled) {\n                gizmo.attachedMesh = mesh;\n            }\n            else {\n                gizmo.attachedMesh = null;\n            }\n        });\n    }\n\n    public get attachedNode() {\n        return this._nodeAttached;\n    }\n    public set attachedNode(node: Nullable<BABYLON.Node>) {\n        this._meshAttached = null;\n        this._nodeAttached = node;\n        [this.xGizmo, this.yGizmo, this.zGizmo].forEach((gizmo) => {\n            if (gizmo.isEnabled) {\n                gizmo.attachedNode = node;\n            }\n            else {\n                gizmo.attachedNode = null;\n            }\n        });\n    }\n    /**\n     * Creates a RotationGizmo\n     * @param gizmoLayer The utility layer the gizmo will be added to\n     * @param tessellation Amount of tessellation to be used when creating rotation circles\n     * @param useEulerRotation Use and update Euler angle instead of quaternion\n     * @param thickness display gizmo axis thickness\n     */\n    constructor(gizmoLayer: UtilityLayerRenderer = UtilityLayerRenderer.DefaultUtilityLayer, tessellation = 32, useEulerRotation = false, thickness: number = 1) {\n        super(gizmoLayer);\n        this.xGizmo = new PlaneRotationGizmo(new BABYLON.Vector3(1, 0, 0), BABYLON.Color3.Red().scale(0.5), gizmoLayer, tessellation, this, useEulerRotation, thickness);\n        this.yGizmo = new PlaneRotationGizmo(new BABYLON.Vector3(0, 1, 0), BABYLON.Color3.Green().scale(0.5), gizmoLayer, tessellation, this, useEulerRotation, thickness);\n        this.zGizmo = new PlaneRotationGizmo(new BABYLON.Vector3(0, 0, 1), BABYLON.Color3.Blue().scale(0.5), gizmoLayer, tessellation, this, useEulerRotation, thickness);\n\n        // Relay drag events\n        [this.xGizmo, this.yGizmo, this.zGizmo].forEach((gizmo) => {\n            gizmo.dragBehavior.onDragStartObservable.add(() => {\n                this.onDragStartObservable.notifyObservers({});\n            });\n            gizmo.dragBehavior.onDragEndObservable.add(() => {\n                this.onDragEndObservable.notifyObservers({});\n            });\n        });\n\n        // this._updateGizmoRotationToMatchAttachedMesh = false;\n\n        this.attachedMesh = null;\n        this.attachedNode = null;\n        this.initialize();\n    }\n\n    public coordSystem: string = 'local';\n    private initialize(): void {\n        let self = this;\n        editor.on('gizmo:coordSystem', function (system: string) {\n            if (self.coordSystem === system)\n                return;\n\n            self.coordSystem = system;\n\n            if (self.coordSystem === 'world') {\n                self.updateGizmoRotationToMatchAttachedMesh = false;\n            } else {\n                self.updateGizmoRotationToMatchAttachedMesh = true;\n            }\n\n            // console.log('rotate: ' + self.updateGizmoRotationToMatchAttachedMesh);\n        });\n    }\n\n    public set updateGizmoRotationToMatchAttachedMesh(value: boolean) {\n        if (this.xGizmo) {\n            this.xGizmo.updateGizmoRotationToMatchAttachedMesh = value;\n            this.yGizmo.updateGizmoRotationToMatchAttachedMesh = value;\n            this.zGizmo.updateGizmoRotationToMatchAttachedMesh = value;\n        }\n    }\n    public get updateGizmoRotationToMatchAttachedMesh() {\n        return this.xGizmo.updateGizmoRotationToMatchAttachedMesh;\n    }\n\n    /**\n     * Drag distance in babylon units that the gizmo will snap to when dragged (Default: 0)\n     */\n    public set snapDistance(value: number) {\n        if (this.xGizmo) {\n            this.xGizmo.snapDistance = value;\n            this.yGizmo.snapDistance = value;\n            this.zGizmo.snapDistance = value;\n        }\n    }\n    public get snapDistance() {\n        return this.xGizmo.snapDistance;\n    }\n\n    /**\n     * Ratio for the scale of the gizmo (Default: 1)\n     */\n    public set scaleRatio(value: number) {\n        if (this.xGizmo) {\n            this.xGizmo.scaleRatio = value;\n            this.yGizmo.scaleRatio = value;\n            this.zGizmo.scaleRatio = value;\n        }\n    }\n    public get scaleRatio() {\n        return this.xGizmo.scaleRatio;\n    }\n\n    /**\n     * Disposes of the gizmo\n     */\n    public dispose() {\n        this.xGizmo.dispose();\n        this.yGizmo.dispose();\n        this.zGizmo.dispose();\n        this.onDragStartObservable.clear();\n        this.onDragEndObservable.clear();\n    }\n\n    /**\n     * CustomMeshes are not supported by this gizmo\n     * @param mesh The mesh to replace the default mesh of the gizmo\n     */\n    public setCustomMesh(mesh: BABYLON.Mesh) {\n        BABYLON.Logger.Error(\"Custom meshes are not supported on this gizmo, please set the custom meshes on the gizmos contained within this one (gizmo.xGizmo, gizmo.yGizmo, gizmo.zGizmo)\");\n    }\n}\n","// import { Logger } from \"../Misc/logger\";\n// import { Observable } from \"../Misc/observable\";\n// import { Nullable } from \"../types\";\n// import { Vector3 } from \"../Maths/math.vector\";\n// import { Color3 } from '../Maths/math.color';\n// import { AbstractMesh } from \"../Meshes/abstractMesh\";\n// import { PolyhedronBuilder } from \"../Meshes/Builders/polyhedronBuilder\";\nimport { Gizmo } from \"./gizmo\";\nimport { AxisScaleGizmo } from \"./axisScaleGizmo\";\nimport { UtilityLayerRenderer } from \"./UtilityLayerRenderer\";\n// import { UtilityLayerRenderer } from \"../Rendering/utilityLayerRenderer\";\n// import { Mesh } from \"../Meshes/mesh\";\n// import { Node } from \"../node\";\n// /**\n//  * Gizmo that enables scaling a mesh along 3 axis\n//  */\nexport class ScaleGizmo extends Gizmo {\n    /**\n     * Internal gizmo used for interactions on the x axis\n     */\n    public xGizmo: AxisScaleGizmo;\n    /**\n     * Internal gizmo used for interactions on the y axis\n     */\n    public yGizmo: AxisScaleGizmo;\n    /**\n     * Internal gizmo used for interactions on the z axis\n     */\n    public zGizmo: AxisScaleGizmo;\n\n    /**\n     * Internal gizmo used to scale all axis equally\n     */\n    public uniformScaleGizmo: AxisScaleGizmo;\n\n    private _meshAttached: Nullable<BABYLON.AbstractMesh> = null;\n    private _nodeAttached: Nullable<BABYLON.Node> = null;\n    private _snapDistance!: number;\n    private _uniformScalingMesh: BABYLON.Mesh;\n    private _octahedron: BABYLON.Mesh;\n    private _sensitivity: number = 1;\n\n    /** Fires an event when any of it's sub gizmos are dragged */\n    public onDragStartObservable = new BABYLON.Observable();\n    /** Fires an event when any of it's sub gizmos are released from dragging */\n    public onDragEndObservable = new BABYLON.Observable();\n\n    public get attachedMesh() {\n        return this._meshAttached;\n    }\n    public set attachedMesh(mesh: Nullable<BABYLON.AbstractMesh>) {\n        this._meshAttached = mesh;\n        this._nodeAttached = mesh;\n        [this.xGizmo, this.yGizmo, this.zGizmo, this.uniformScaleGizmo].forEach((gizmo) => {\n            if (gizmo.isEnabled) {\n                gizmo.attachedMesh = mesh;\n            }\n            else {\n                gizmo.attachedMesh = null;\n            }\n        });\n    }\n\n    public get attachedNode() {\n        return this._nodeAttached;\n    }\n    public set attachedNode(node: Nullable<BABYLON.Node>) {\n        this._meshAttached = null;\n        this._nodeAttached = node;\n        [this.xGizmo, this.yGizmo, this.zGizmo, this.uniformScaleGizmo].forEach((gizmo) => {\n            if (gizmo.isEnabled) {\n                gizmo.attachedNode = node;\n            }\n            else {\n                gizmo.attachedNode = null;\n            }\n        });\n    }\n\n    /**\n     * Creates a ScaleGizmo\n     * @param gizmoLayer The utility layer the gizmo will be added to\n     * @param thickness display gizmo axis thickness\n     */\n    constructor(gizmoLayer: UtilityLayerRenderer = UtilityLayerRenderer.DefaultUtilityLayer, thickness: number = 1) {\n        super(gizmoLayer);\n        this.xGizmo = new AxisScaleGizmo(new BABYLON.Vector3(1, 0, 0), BABYLON.Color3.Red().scale(0.5), gizmoLayer, this, thickness);\n        this.yGizmo = new AxisScaleGizmo(new BABYLON.Vector3(0, 1, 0), BABYLON.Color3.Green().scale(0.5), gizmoLayer, this, thickness);\n        this.zGizmo = new AxisScaleGizmo(new BABYLON.Vector3(0, 0, 1), BABYLON.Color3.Blue().scale(0.5), gizmoLayer, this, thickness);\n\n        // Create uniform scale gizmo\n        this.uniformScaleGizmo = new AxisScaleGizmo(new BABYLON.Vector3(0, 1, 0), BABYLON.Color3.Yellow().scale(0.5), gizmoLayer, this);\n        this.uniformScaleGizmo.updateGizmoRotationToMatchAttachedMesh = false;\n        this.uniformScaleGizmo.uniformScaling = true;\n        this._uniformScalingMesh = BABYLON.PolyhedronBuilder.CreatePolyhedron(\"\", { type: 1 }, this.uniformScaleGizmo.gizmoLayer.utilityLayerScene);\n        this._uniformScalingMesh.scaling.scaleInPlace(0.02);\n        this._uniformScalingMesh.visibility = 0;\n        this._octahedron = BABYLON.PolyhedronBuilder.CreatePolyhedron(\"\", { type: 1 }, this.uniformScaleGizmo.gizmoLayer.utilityLayerScene);\n        this._octahedron.scaling.scaleInPlace(0.007);\n        this._uniformScalingMesh.addChild(this._octahedron);\n        this.uniformScaleGizmo.setCustomMesh(this._uniformScalingMesh, true);\n        var light = gizmoLayer._getSharedGizmoLight();\n        light.includedOnlyMeshes = light.includedOnlyMeshes.concat(this._octahedron);\n\n        // Relay drag events\n        [this.xGizmo, this.yGizmo, this.zGizmo, this.uniformScaleGizmo].forEach((gizmo) => {\n            gizmo.dragBehavior.onDragStartObservable.add(() => {\n                this.onDragStartObservable.notifyObservers({});\n            });\n            gizmo.dragBehavior.onDragEndObservable.add(() => {\n                this.onDragEndObservable.notifyObservers({});\n            });\n        });\n\n        this.attachedMesh = null;\n        this.attachedNode = null;\n        this.initialize();\n    }\n\n    public coordSystem: string = 'local';\n    private initialize(): void {\n        let self = this;\n        editor.on('gizmo:coordSystem', function (system: string) {\n            if (self.coordSystem === system)\n                return;\n\n            self.coordSystem = system;\n\n            // if (self.coordSystem === 'world') {\n            //     self.updateGizmoRotationToMatchAttachedMesh = false;\n            // } else {\n            //     self.updateGizmoRotationToMatchAttachedMesh = true;\n            // }\n        });\n    }\n\n    public set updateGizmoRotationToMatchAttachedMesh(value: boolean) {\n        if (!value) {\n            BABYLON.Logger.Warn(\"Setting updateGizmoRotationToMatchAttachedMesh = false on scaling gizmo is not supported.\");\n        }\n        else {\n            this._updateGizmoRotationToMatchAttachedMesh = value;\n            [this.xGizmo, this.yGizmo, this.zGizmo, this.uniformScaleGizmo].forEach((gizmo) => {\n                if (gizmo) {\n                    gizmo.updateGizmoRotationToMatchAttachedMesh = value;\n                }\n            });\n        }\n    }\n    public get updateGizmoRotationToMatchAttachedMesh() {\n        return this._updateGizmoRotationToMatchAttachedMesh;\n    }\n\n    /**\n     * Drag distance in babylon units that the gizmo will snap to when dragged (Default: 0)\n     */\n    public set snapDistance(value: number) {\n        this._snapDistance = value;\n        [this.xGizmo, this.yGizmo, this.zGizmo, this.uniformScaleGizmo].forEach((gizmo) => {\n            if (gizmo) {\n                gizmo.snapDistance = value;\n            }\n        });\n    }\n    public get snapDistance() {\n        return this._snapDistance;\n    }\n\n    /**\n     * Ratio for the scale of the gizmo (Default: 1)\n     */\n    public set scaleRatio(value: number) {\n        this._scaleRatio = value;\n        [this.xGizmo, this.yGizmo, this.zGizmo, this.uniformScaleGizmo].forEach((gizmo) => {\n            if (gizmo) {\n                gizmo.scaleRatio = value;\n            }\n        });\n    }\n    public get scaleRatio() {\n        return this._scaleRatio;\n    }\n\n    /**\n     * Sensitivity factor for dragging (Default: 1)\n     */\n    public set sensitivity(value: number) {\n        this._sensitivity = value;\n        [this.xGizmo, this.yGizmo, this.zGizmo, this.uniformScaleGizmo].forEach((gizmo) => {\n            if (gizmo) {\n                gizmo.sensitivity = value;\n            }\n        });\n    }\n    public get sensitivity() {\n        return this._sensitivity;\n    }\n\n    /**\n     * Disposes of the gizmo\n     */\n    public dispose() {\n        [this.xGizmo, this.yGizmo, this.zGizmo, this.uniformScaleGizmo].forEach((gizmo) => {\n            if (gizmo) {\n                gizmo.dispose();\n            }\n        });\n        this.onDragStartObservable.clear();\n        this.onDragEndObservable.clear();\n\n        [this._uniformScalingMesh, this._octahedron].forEach((msh) => {\n            if (msh) {\n                msh.dispose();\n            }\n        });\n    }\n}\n","export class Config{\n\n    public static projectID: string = 'projectID';\n    public static projectName: string;\n    public static scenesData: any;\n    public static sceneIndex: number = 0;\n    public static sceneID: string = 'sceneID';\n    public static sceneName: string;\n    public static lastScene: string;\n    public static userID: number;\n    public static username: string;\n\n    public static assetsData: any;\n\n    public static isSceneDirty: boolean = false;\n\n\n    public static x: number = 4;\n    public static y: number = 291;\n    public static width: number = 444;\n    public static height: number = 250;\n\n    // TODO: 暂时只允许加载一个表格\n    public static tableAssetsID: string = '';\n    public static assetStandard=\"{\\\"assets\\\":{},\\\"geometry\\\":{},\\\"babylon\\\":{\\\"path\\\":{}},\\\"babylon_resource\\\":{}}\";\n    public static sceneStandard=\"{\\\"scenes\\\":[{\\\"id\\\":\\\"33a884dd\\\",\\\"projectId\\\":\\\"2af1e58b\\\",\\\"name\\\":\\\"新建场景\\\",\\\"created\\\":\\\"2020-07-04 18:00\\\",\\\"modified\\\":\\\"2020-07-04 18:00\\\",\\\"entities\\\":{\\\"799f7762-3ef2-4564-a59b-c0ae959a90ce\\\":{\\\"name\\\":\\\"新建场景\\\",\\\"type\\\":\\\"root\\\",\\\"root\\\":true,\\\"parent\\\":null,\\\"resource_id\\\":\\\"799f7762-3ef2-4564-a59b-c0ae959a90ce\\\",\\\"tags\\\":[],\\\"enabled\\\":true,\\\"scale\\\":[1,1,1],\\\"position\\\":[0,0,0],\\\"rotation\\\":[0,0,0],\\\"children\\\":[\\\"5e7ecc24-75b7-445a-b381-a66bd7699163\\\",\\\"3109cca1-b962-4fd5-a83a-0b28719d2616\\\",\\\"3e8d0d21-726a-427d-bf34-7baaebdff54c\\\"],\\\"asset_id\\\":\\\"\\\",\\\"babylon_id\\\":\\\"\\\"},\\\"5e7ecc24-75b7-445a-b381-a66bd7699163\\\":{\\\"name\\\":\\\"主相机\\\",\\\"type\\\":\\\"camera\\\",\\\"parent\\\":\\\"799f7762-3ef2-4564-a59b-c0ae959a90ce\\\",\\\"resource_id\\\":\\\"5e7ecc24-75b7-445a-b381-a66bd7699163\\\",\\\"tags\\\":[],\\\"enabled\\\":true,\\\"scale\\\":[1,1,1],\\\"position\\\":[0,100,-200],\\\"rotation\\\":[0,0,0],\\\"mode\\\":0,\\\"fov\\\":0.8,\\\"inertia\\\":0.9,\\\"orthoSize\\\":0.5,\\\"children\\\":[],\\\"ellipsoid\\\":[0.5,1,0.5],\\\"ellipsoidOffset\\\":[0,0,0],\\\"checkCollisions\\\":true,\\\"applyGravity\\\":true,\\\"minZ\\\":1,\\\"maxZ\\\":20000,\\\"priority\\\":0,\\\"viewport\\\":[0,0,1,1],\\\"clearColor\\\":[0.176,0.569,0.729,1]},\\\"3109cca1-b962-4fd5-a83a-0b28719d2616\\\":{\\\"name\\\":\\\"环境光\\\",\\\"type\\\":\\\"light\\\",\\\"parent\\\":\\\"799f7762-3ef2-4564-a59b-c0ae959a90ce\\\",\\\"resource_id\\\":\\\"3109cca1-b962-4fd5-a83a-0b28719d2616\\\",\\\"tags\\\":[],\\\"subtype\\\":\\\"hemispheric\\\",\\\"enabled\\\":true,\\\"position\\\":[300,300,300],\\\"rotation\\\":[0,0,0],\\\"scale\\\":[1,1,1],\\\"children\\\":[]},\\\"3e8d0d21-726a-427d-bf34-7baaebdff54c\\\":{\\\"name\\\":\\\"立方体\\\",\\\"type\\\":\\\"primitive\\\",\\\"subtype\\\":\\\"box\\\",\\\"resource_id\\\":\\\"3e8d0d21-726a-427d-bf34-7baaebdff54c\\\",\\\"babylon_id\\\":\\\"\\\",\\\"asset_id\\\":\\\"\\\",\\\"parent\\\":\\\"799f7762-3ef2-4564-a59b-c0ae959a90ce\\\",\\\"position\\\":[0,0,0],\\\"rotation\\\":[0,0,0],\\\"scale\\\":[1,1,1],\\\"children\\\":[],\\\"enabled\\\":true,\\\"checkCollisions\\\":false,\\\"pickable\\\":true,\\\"isVisible\\\":true,\\\"tags\\\":[],\\\"material_id\\\":\\\"\\\"}}}],\\\"last\\\":0}\";\n    public static tableStandard=\"{\\\"table\\\":[[\\\"对象/模板对象\\\",\\\"触发激活条件\\\",\\\"触发名\\\",\\\"触发参数\\\",\\\"逻辑条件\\\",\\\"变量定义/状态定义和赋值\\\",\\\"响应名\\\",\\\"响应参数/变量赋值\\\",\\\"关联状态\\\"],[\\\"\\\",\\\"\\\",\\\"\\\",\\\"\\\",\\\"\\\",\\\"\\\",\\\"\\\",\\\"\\\",\\\"\\\"],[\\\"\\\",\\\"\\\",\\\"\\\",\\\"\\\",\\\"\\\",\\\"\\\",\\\"\\\",\\\"\\\",\\\"\\\"],[\\\"\\\",\\\"\\\",\\\"\\\",\\\"\\\",\\\"\\\",\\\"\\\",\\\"\\\",\\\"\\\",\\\"\\\"],[\\\"\\\",\\\"\\\",\\\"\\\",\\\"\\\",\\\"\\\",\\\"\\\",\\\"\\\",\\\"\\\",\\\"\\\"],[\\\"\\\",\\\"\\\",\\\"\\\",\\\"\\\",\\\"\\\",\\\"\\\",\\\"\\\",\\\"\\\",\\\"\\\"],[\\\"\\\",\\\"\\\",\\\"\\\",\\\"\\\",\\\"\\\",\\\"\\\",\\\"\\\",\\\"\\\",\\\"\\\"],[\\\"\\\",\\\"\\\",\\\"\\\",\\\"\\\",\\\"\\\",\\\"\\\",\\\"\\\",\\\"\\\",\\\"\\\"],[\\\"\\\",\\\"\\\",\\\"\\\",\\\"\\\",\\\"\\\",\\\"\\\",\\\"\\\",\\\"\\\",\\\"\\\"],[\\\"\\\",\\\"\\\",\\\"\\\",\\\"\\\",\\\"\\\",\\\"\\\",\\\"\\\",\\\"\\\",\\\"\\\"],[\\\"\\\",\\\"\\\",\\\"\\\",\\\"\\\",\\\"\\\",\\\"\\\",\\\"\\\",\\\"\\\",\\\"\\\"],[\\\"\\\",\\\"\\\",\\\"\\\",\\\"\\\",\\\"\\\",\\\"\\\",\\\"\\\",\\\"\\\",\\\"\\\"],[\\\"\\\",\\\"\\\",\\\"\\\",\\\"\\\",\\\"\\\",\\\"\\\",\\\"\\\",\\\"\\\",\\\"\\\"],[\\\"\\\",\\\"\\\",\\\"\\\",\\\"\\\",\\\"\\\",\\\"\\\",\\\"\\\",\\\"\\\",\\\"\\\"],[\\\"\\\",\\\"\\\",\\\"\\\",\\\"\\\",\\\"\\\",\\\"\\\",\\\"\\\",\\\"\\\",\\\"\\\"],[\\\"\\\",\\\"\\\",\\\"\\\",\\\"\\\",\\\"\\\",\\\"\\\",\\\"\\\",\\\"\\\",\\\"\\\"],[\\\"\\\",\\\"\\\",\\\"\\\",\\\"\\\",\\\"\\\",\\\"\\\",\\\"\\\",\\\"\\\",\\\"\\\"],[\\\"\\\",\\\"\\\",\\\"\\\",\\\"\\\",\\\"\\\",\\\"\\\",\\\"\\\",\\\"\\\",\\\"\\\"],[\\\"\\\",\\\"\\\",\\\"\\\",\\\"\\\",\\\"\\\",\\\"\\\",\\\"\\\",\\\"\\\",\\\"\\\"],[\\\"\\\",\\\"\\\",\\\"\\\",\\\"\\\",\\\"\\\",\\\"\\\",\\\"\\\",\\\"\\\",\\\"\\\"],[\\\"\\\",\\\"\\\",\\\"\\\",\\\"\\\",\\\"\\\",\\\"\\\",\\\"\\\",\\\"\\\",\\\"\\\"],[\\\"\\\",\\\"\\\",\\\"\\\",\\\"\\\",\\\"\\\",\\\"\\\",\\\"\\\",\\\"\\\",\\\"\\\"],[\\\"\\\",\\\"\\\",\\\"\\\",\\\"\\\",\\\"\\\",\\\"\\\",\\\"\\\",\\\"\\\",\\\"\\\"],[\\\"\\\",\\\"\\\",\\\"\\\",\\\"\\\",\\\"\\\",\\\"\\\",\\\"\\\",\\\"\\\",\\\"\\\"],[\\\"\\\",\\\"\\\",\\\"\\\",\\\"\\\",\\\"\\\",\\\"\\\",\\\"\\\",\\\"\\\",\\\"\\\"],[\\\"\\\",\\\"\\\",\\\"\\\",\\\"\\\",\\\"\\\",\\\"\\\",\\\"\\\",\\\"\\\",\\\"\\\"],[\\\"\\\",\\\"\\\",\\\"\\\",\\\"\\\",\\\"\\\",\\\"\\\",\\\"\\\",\\\"\\\",\\\"\\\"],[\\\"\\\",\\\"\\\",\\\"\\\",\\\"\\\",\\\"\\\",\\\"\\\",\\\"\\\",\\\"\\\",\\\"\\\"],[\\\"\\\",\\\"\\\",\\\"\\\",\\\"\\\",\\\"\\\",\\\"\\\",\\\"\\\",\\\"\\\",\\\"\\\"],[\\\"\\\",\\\"\\\",\\\"\\\",\\\"\\\",\\\"\\\",\\\"\\\",\\\"\\\",\\\"\\\",\\\"\\\"],[\\\"\\\",\\\"\\\",\\\"\\\",\\\"\\\",\\\"\\\",\\\"\\\",\\\"\\\",\\\"\\\",\\\"\\\"],[\\\"\\\",\\\"\\\",\\\"\\\",\\\"\\\",\\\"\\\",\\\"\\\",\\\"\\\",\\\"\\\",\\\"\\\"],[\\\"\\\",\\\"\\\",\\\"\\\",\\\"\\\",\\\"\\\",\\\"\\\",\\\"\\\",\\\"\\\",\\\"\\\"],[\\\"\\\",\\\"\\\",\\\"\\\",\\\"\\\",\\\"\\\",\\\"\\\",\\\"\\\",\\\"\\\",\\\"\\\"],[\\\"\\\",\\\"\\\",\\\"\\\",\\\"\\\",\\\"\\\",\\\"\\\",\\\"\\\",\\\"\\\",\\\"\\\"],[\\\"\\\",\\\"\\\",\\\"\\\",\\\"\\\",\\\"\\\",\\\"\\\",\\\"\\\",\\\"\\\",\\\"\\\"],[\\\"\\\",\\\"\\\",\\\"\\\",\\\"\\\",\\\"\\\",\\\"\\\",\\\"\\\",\\\"\\\",\\\"\\\"],[\\\"\\\",\\\"\\\",\\\"\\\",\\\"\\\",\\\"\\\",\\\"\\\",\\\"\\\",\\\"\\\",\\\"\\\"],[\\\"\\\",\\\"\\\",\\\"\\\",\\\"\\\",\\\"\\\",\\\"\\\",\\\"\\\",\\\"\\\",\\\"\\\"],[\\\"\\\",\\\"\\\",\\\"\\\",\\\"\\\",\\\"\\\",\\\"\\\",\\\"\\\",\\\"\\\",\\\"\\\"],[\\\"\\\",\\\"\\\",\\\"\\\",\\\"\\\",\\\"\\\",\\\"\\\",\\\"\\\",\\\"\\\",\\\"\\\"],[\\\"\\\",\\\"\\\",\\\"\\\",\\\"\\\",\\\"\\\",\\\"\\\",\\\"\\\",\\\"\\\",\\\"\\\"],[\\\"\\\",\\\"\\\",\\\"\\\",\\\"\\\",\\\"\\\",\\\"\\\",\\\"\\\",\\\"\\\",\\\"\\\"],[\\\"\\\",\\\"\\\",\\\"\\\",\\\"\\\",\\\"\\\",\\\"\\\",\\\"\\\",\\\"\\\",\\\"\\\"],[\\\"\\\",\\\"\\\",\\\"\\\",\\\"\\\",\\\"\\\",\\\"\\\",\\\"\\\",\\\"\\\",\\\"\\\"],[\\\"\\\",\\\"\\\",\\\"\\\",\\\"\\\",\\\"\\\",\\\"\\\",\\\"\\\",\\\"\\\",\\\"\\\"],[\\\"\\\",\\\"\\\",\\\"\\\",\\\"\\\",\\\"\\\",\\\"\\\",\\\"\\\",\\\"\\\",\\\"\\\"]]}\";\n\n    public constructor () {\n\n    }\n\n}","export * from './config';","export class GUIManager {\r\n\r\n    public constructor() {\r\n\r\n    }\r\n\r\n\r\n    private static _2dCanvasGroup: BABYLON.GUI.AdvancedDynamicTexture[] = [];\r\n    private static _2dCanvasGroupID: string[] = [];\r\n    private static _2dCanvasGroupDic: { [key: string]: BABYLON.GUI.AdvancedDynamicTexture } = {};\r\n\r\n    private static _uniqueID2resourceID: { [key: number]: string } = {};\r\n\r\n    public static add2DCanvas(id: string, canvas: BABYLON.GUI.AdvancedDynamicTexture) {\r\n        this._2dCanvasGroup.push(canvas);\r\n        this._2dCanvasGroupID.push(id);\r\n        this._2dCanvasGroupDic[id] = canvas;\r\n    }\r\n\r\n    public static getActiveCanvas(): Nullable<BABYLON.GUI.AdvancedDynamicTexture> {\r\n        if (GUIManager._2dCanvasGroup && GUIManager._2dCanvasGroup.length > 0) {\r\n            return GUIManager._2dCanvasGroup[GUIManager._2dCanvasGroup.length - 1];\r\n        } else {\r\n            return null;\r\n        }\r\n    }\r\n\r\n    public static getActiveID(): string {\r\n        if (GUIManager._2dCanvasGroupID && GUIManager._2dCanvasGroupID.length > 0) {\r\n            return GUIManager._2dCanvasGroupID[GUIManager._2dCanvasGroupID.length - 1];\r\n        } else {\r\n            return '';\r\n        }\r\n    }\r\n\r\n    public static getCanvasFromIndex(index: number): Nullable<BABYLON.GUI.AdvancedDynamicTexture> {\r\n        if (GUIManager._2dCanvasGroup && GUIManager._2dCanvasGroup.length > 0) {\r\n            if (index >= 0 && index < GUIManager._2dCanvasGroup.length) {\r\n                return GUIManager._2dCanvasGroup[index];\r\n            } else {\r\n                return null;\r\n            }\r\n        } else {\r\n            return null;\r\n        }\r\n    }\r\n\r\n    public static addUniqueIDIndex(unique_id: number, resource_id: string): void {\r\n        GUIManager._uniqueID2resourceID[unique_id] = resource_id;\r\n    }\r\n\r\n    public static getResourceID(unique_id: number): string {\r\n        return GUIManager._uniqueID2resourceID[unique_id] ? GUIManager._uniqueID2resourceID[unique_id] : '';\r\n    }\r\n    \r\n    public static dragAllow(child_type: string, child_subtype: string, parent_type: string, parent_subtype: string): boolean {\r\n        \r\n\r\n        return false;\r\n    }\r\n\r\n}","export * from './gui-manager';\r\n\r\nexport * from './keeper';","export class GUIKeeper {\r\n\r\n    public constructor() {\r\n\r\n    }\r\n    \r\n}","import { Panel, MenuItem, Menu, MenuItemArgs, TreeItem } from \"../../ui\";\nimport { Observer } from \"../../lib\";\n\nexport class HierarchyContextMenu {\n\n    public root: Panel;\n    public clickableSubmenus: boolean;\n    public menu!: Menu;\n    public customMenuItems: MenuItemArgs[] = [];\n    public entity!: Observer;\n    public items: Observer[] = [];\n\n\n    public constructor() {\n        this.root = editor.call('layout.root');\n\n        this.clickableSubmenus = /clickableContextSubmenus=true/.test(location.search);\n\n        this.initMenu();\n        this.initFunction();\n\n    }\n\n\n    private initMenu(): void {\n        let that = this;\n        var menuData: { [key: string]: ContextMenuArgs } = {};\n\n        menuData['new-empty'] = {\n            title: '创建空物体',\n            className: 'menu-item-new-entity',\n            icon: '&#57632;',\n            select: () => {\n                editor.call('entities:editor:new', { parent: that.items[0], type: 'empty', subtype: '' });\n            }\n            // filter: function () {\n            //   return that.items.length === 1;\n            // },\n            // select: function () {\n            //   editor.call('entities:new', { parent: that.items[0] });\n            // },\n            // \n            // items: editor.call('menu:entities:new', function () { return that.items[0]; })\n        };\n\n        menuData['add-primitive'] = {\n            title: '创建3D物体',\n            className: 'menu-item-primitive-sub-menu',\n            icon: '&#57736;',\n            items: {\n                'add-new-box': {\n                    title: '立方体',\n                    className: 'menu-item-add-box-primitive',\n                    icon: '&#57736;',\n                    select: () => {\n                        editor.call('entities:editor:new', { parent: that.items[0], type: 'primitive', subtype: 'box' });\n                    }\n                },\n                'add-new-sphere': {\n                    title: '球',\n                    className: 'menu-item-add-sphere-primitive',\n                    icon: '&#57736;',\n                    select: () => {\n                        editor.call('entities:editor:new', { parent: that.items[0], type: 'primitive', subtype: 'sphere' });\n                    }\n                },\n                'add-new-plane': {\n                    title: '平面',\n                    className: 'menu-item-add-plane-primitive',\n                    icon: '&#57736;',\n                    select: () => {\n                        editor.call('entities:editor:new', { parent: that.items[0], type: 'primitive', subtype: 'plane' });\n                    }\n                },\n                'add-new-cylinder': {\n                    title: '圆柱体',\n                    className: 'menu-item-add-cylinder-primitive',\n                    icon: '&#57736;',\n                    select: () => {\n                        editor.call('entities:editor:new', { parent: that.items[0], type: 'primitive', subtype: 'cylinder' });\n                    }\n                }\n            }\n        };\n\n        menuData['add-new-light'] = {\n            title: '创建灯光',\n            className: 'menu-item-light-sub-menu',\n            icon: '&#57748;',\n            filter: () => {\n                return false;\n            },\n            items: {\n                'add-new-hemispheric': {\n                    title: '环境光',\n                    className: 'menu-item-add-directional-light',\n                    icon: '&#57748;',\n                    select: () => {\n                        editor.call('entities:editor:new', { parent: that.items[0], type: 'light', subtype: 'hemispheric' });\n                    }\n                },\n                'add-new-directional': {\n                    title: '平行光',\n                    className: 'menu-item-add-directional-light',\n                    icon: '&#57746;',\n                    select: () => {\n                        editor.call('entities:editor:new', { parent: that.items[0], type: 'light', subtype: 'directional' });\n                    }\n                },\n                'add-new-point': {\n                    title: '点光源',\n                    className: 'menu-item-add-point-light',\n                    icon: '&#57745;',\n                    select: () => {\n                        editor.call('entities:editor:new', { parent: that.items[0], type: 'light', subtype: 'point' });\n                    }\n                },\n                'add-new-spot': {\n                    title: '聚光灯',\n                    className: 'menu-item-add-spot-light',\n                    icon: '&#57747;',\n                    select: () => {\n                        editor.call('entities:editor:new', { parent: that.items[0], type: 'light', subtype: 'spot' });\n                    }\n                }\n            }\n        };\n\n        menuData['add-new-camera'] = {\n            title: '创建摄像机',\n            className: 'menu-item-add-camera',\n            icon: '&#57874;',\n            filter: () => {\n                return false;\n            },\n            select: () => {\n                editor.call('entities:editor:new', { parent: that.items[0], type: 'camera', subtype: '' });\n            }\n        };\n\n        menuData['add-new-2d-gui'] = {\n            title: '创建2D界面',\n            className: 'menu-item-add-2d-gui',\n            icon: '&#58371;',\n            // filter: () => {\n            //     return false;\n            // },\n            items: {\n                'add-new-2d-canvas': {\n                    title: '2D画布',\n                    className: 'menu-item-add-2d-canvas',\n                    icon: '&#58232;',\n                    select: () => {\n                        editor.call('entities:2D-GUI:new', { parent: that.items[0], type: '2d-gui', subtype: 'root' });\n                    }\n                },\n                'add-new-panel': {\n                    title: '容器',\n                    className: 'menu-item-add-panel',\n                    icon: '&#58232;',\n                    select: () => {\n                        // 使用rectangle充当panel，比container多了圆角；\n                        editor.call('entities:2D-GUI:new', { parent: that.items[0], type: '2d-gui', subtype: 'panel' });\n                    }\n                },\n                'add-new-button': {\n                    title: '按钮',\n                    className: 'menu-item-add-button',\n                    icon: '&#58373;',\n                    select: () => {\n                        editor.call('entities:2D-GUI:new', { parent: that.items[0], type: '2d-gui', subtype: 'button' });\n                    }\n                },\n                'add-new-image': {\n                    title: '图片',\n                    className: 'menu-item-add-image',\n                    icon: '&#58005;',\n                    select: () => {\n                        editor.call('entities:2D-GUI:new', { parent: that.items[0], type: '2d-gui', subtype: 'image' });\n                    }\n                },\n                'add-new-text': {\n                    title: '文字',\n                    className: 'menu-item-add-text',\n                    icon: '&#58374;',\n                    select: () => {\n                        editor.call('entities:2D-GUI:new', { parent: that.items[0], type: '2d-gui', subtype: 'text' });\n                    }\n                },\n                'add-new-input': {\n                    title: '输入框',\n                    className: 'menu-item-add-input',\n                    icon: '&#58374;',\n                    select: () => {\n                        editor.call('entities:2D-GUI:new', { parent: that.items[0], type: '2d-gui', subtype: 'input' });\n                    }\n                },\n                'add-new-checkbox': {\n                    title: '复选框',\n                    className: 'menu-item-add-checkbox',\n                    icon: '&#57910;',\n                    select: () => {\n                        editor.call('entities:2D-GUI:new', { parent: that.items[0], type: '2d-gui', subtype: 'checkbox' });\n                    }\n                }\n            }\n        };\n\n        menuData['duplicate'] = {\n            title: '创建副本',\n            className: 'menu-item-duplicate',\n            icon: '&#57638;',\n            filter: () => {\n                return false;\n            },\n            // hide: function () {\n            //   if (that.items.length === 1) {\n            //     return !that.items[0].get('enabled');\n            //   } else {\n            //     var disabled = that.items[0].get('enabled');\n            //     for (var i = 1; i < that.items.length; i++) {\n            //       if (disabled !== that.items[i].get('enabled'))\n            //         return false;\n            //     }\n            //     return !disabled;\n            //   }\n            // },\n            // select: function () {\n            //   setField('enabled', false);\n            // }\n        };\n\n        menuData['delete'] = {\n            title: '删除',\n            className: 'menu-item-delete',\n            icon: '&#57636;',\n            select: function () {\n              editor.call('entities:delete', that.items);\n            }\n        };\n\n\n        // menu\n        this.menu = Menu.fromData(menuData, { clickableSubmenus: this.clickableSubmenus });\n        this.root.append(this.menu);\n\n        // this.menu.on('open', function () {\n        //   var selection = getSelection();\n\n        //   for (var i = 0; i < that.customMenuItems.length; i++) {\n        //     if (!that.customMenuItems[i].filter)\n        //       continue;\n\n        //     that.customMenuItems[i].hidden = !that.customMenuItems[i].filter(selection);\n        //   }\n        // });\n\n    }\n\n\n    private getSelection() {\n        var selection = editor.call('selector:items');\n\n        if (selection.indexOf(this.entity) !== -1) {\n            return selection;\n        } else {\n            return [this.entity];\n        }\n    }\n\n\n    private initFunction(): void {\n\n        let that = this;\n\n        // TODO\n        // editor.method('entities:contextmenu:add', function (data: MenuItemArgs) {\n        //   var item = new MenuItem({\n        //     text: data.text,\n        //     icon: data.icon,\n        //     value: data.value,\n        //     hasChildren: !!(data.items && Object.keys(data.items).length > 0),\n        //     clickableSubmenus: that.clickableSubmenus\n        //   });\n\n        //   item.on('select', function () {\n        //     data.select.call(item, getSelection());\n        //   });\n\n        //   var parent = data.parent || that.menu;\n        //   parent.append(item);\n\n        //   if (data.filter)\n        //     item.filter = data.filter;\n\n        //   that.customMenuItems.push(item);\n\n        //   return item;\n        // });\n\n        editor.method('entities:contextmenu:open', function (item: Observer, x: number, y: number, ignoreSelection: boolean) {\n\n            if (!that.menu) return;\n            that.entity = item;\n            if (ignoreSelection) {\n                that.items = [];\n            } else {\n                that.items = that.getSelection();\n            }\n\n            // console.log(item.get('name'));\n\n            that.menu.open = true;\n            that.menu.position(x + 1, y);\n\n            return true;\n        });\n\n        // get the entity that was right-clicked when opening the context menu\n        editor.method('entities:contextmenu:entity', function () {\n            return that.entity;\n        });\n\n        // for each entity added\n        editor.on('entities:add', function (item: Observer) {\n            // get tree item\n            var treeItem = editor.call('entities:panel:get', item.get('resource_id'));\n            if (!treeItem) return;\n\n            // attach contextmenu event\n            treeItem.element!.addEventListener('contextmenu', function (evt: MouseEvent) {\n                // console.log(\"context click: \" + item.element!.innerText);\n                let openned = editor.call('entities:contextmenu:open', item, evt.clientX, evt.clientY);\n\n                if (openned) {\n                    evt.preventDefault();\n                    evt.stopPropagation();\n                }\n            });\n        });\n\n    }\n\n}\n\n\nexport interface ContextMenuArgs {\n    title?: string;\n    className?: string;\n    icon?: string;\n    filter?: () => boolean;\n    hide?: () => boolean;\n    select?: () => void;\n    items?: any;\n}","import { VeryEngine } from \"../../engine\";\nimport { Panel, Button, Tooltip, TopElementContainer, TopElementPanel } from \"../../ui\";\nimport { Observer } from \"../../lib\";\n\nexport class HierarchyControl {\n\n    public constructor() {\n\n        let root: TopElementContainer = VeryEngine.root;\n        let panel: TopElementPanel = VeryEngine.hierarchy;\n\n        // 层级菜单控制菜单\n        let controls = new TopElementContainer({\n            flex: true,\n            flexDirection: 'row',\n            alignItems: 'center',\n            // hidden: !editor.call('permissions:write')\n        });\n        controls.class!.add('hierarchy-controls');\n\n        // TODO: 分享项目给他人时，是否允许修改\n        // controls.hidden = !editor.call('permissions:write');\n        // editor.on('permissions:writeState', function (state: boolean) {\n        //     controls.hidden = !state;\n        // });\n\n        panel.header.append(controls);\n\n        // controls add\n        let btnAdd: Button = new Button('&#57632;');\n        btnAdd.class!.add('add');\n        btnAdd.on('click', function () {\n            // menuEntities.open = true;\n            // let rect = btnAdd.element.getBoundingClientRect();\n            // menuEntities.position(rect.left, rect.top);\n        });\n        controls.append(btnAdd);\n\n        Tooltip.attach({\n            target: btnAdd.element!,\n            text: '添加',\n            align: 'top',\n            root: root\n        });\n\n        editor.on('attributes:clear', function () {\n            btnDuplicate.disabled = true;\n            btnDelete.disabled = true;\n            tooltipDelete.class!.add('innactive');\n            tooltipDuplicate.class!.add('innactive');\n        });\n\n\n        // controls duplicate\n        let btnDuplicate: Button = new Button('&#57638;');\n        btnDuplicate.disabled = true;\n        btnDuplicate.class!.add('duplicate');\n        btnDuplicate.on('click', function () {\n            let type = editor.call('selector:type');\n            let items = editor.call('selector:items');\n\n            if (type === 'entity' && items.length)\n                editor.call('entities:duplicate', items);\n        });\n        controls.append(btnDuplicate);\n\n        let tooltipDuplicate = Tooltip.attach({\n            target: btnDuplicate.element!,\n            text: '复制',\n            align: 'top',\n            root: root\n        });\n        tooltipDuplicate.class!.add('innactive');\n\n        // controls delete (Button)\n        let btnDelete: Button = new Button('&#57636;');\n        btnDelete.class!.add('delete');\n        btnDelete.style!.fontWeight = '200';\n        btnDelete.on('click', function () {\n            let type = editor.call('selector:type');\n            if (type !== 'entity')\n                return;\n            editor.call('entities:delete', editor.call('selector:items'));\n        });\n        controls.append(btnDelete);\n\n        let tooltipDelete = Tooltip.attach({\n            target: btnDelete.element!,\n            text: '删除',\n            align: 'top',\n            root: root\n        });\n        tooltipDelete.class!.add('innactive');\n\n        // TODO: Menu\n        // let menuEntities = ui.Menu.fromData(editor.call('menu:entities:new'));\n        // root.append(menuEntities);\n\n        \n\n        // TODO: 选择到了hierarchy的scene一行\n        editor.on('attributes:inspect[*]', function (type: string, items: Observer[]) {\n            var root = editor.call('entities:root');\n\n            if (type === 'entity' && items[0] !== root) {\n                btnDelete.enabled = true;\n                btnDuplicate.enabled = true;\n                tooltipDelete.class!.remove('innactive');\n                tooltipDuplicate.class!.remove('innactive');\n            } else {\n                btnDelete.enabled = false;\n                btnDuplicate.enabled = false;\n                tooltipDelete.class!.add('innactive');\n                tooltipDuplicate.class!.add('innactive');\n            }\n        });\n\n    }\n}","export class HierarchyMenu {\n\n\n\n  public constructor () {\n    let componentsLogos = editor.call('components:logos');\n\n    \n\n  }\n\n\n\n\n}","import { Panel, Button, Tooltip, Tree, TreeItem, TopElementPanel, ReparentDragItems } from '../../ui';\nimport { VeryEngine } from '../../engine';\nimport { HierarchySearch } from './hierarchy-search';\nimport { HierarchyMenu } from './hierarchy-menu';\nimport { HierarchyContextMenu } from './hierarchy-context-menu';\nimport { Observer } from '../../lib';\nimport { Config } from '../global';\nimport { BabylonLoader } from '../middleware/loader/babylonLoader';\n\nexport class HierarchyPanel {\n\n    // hierarchy index\n    private uiItemIndex: { [key: string]: TreeItem } = {};\n\n\n    public constructor() {\n\n        let self = this;\n        // left control\n        // hierarchy index\n        // let uiItemIndex: any = {};\n        let awaitingParent: any = {};\n        let panel: TopElementPanel = VeryEngine.hierarchy;\n\n        let hierarchy: Tree = new Tree();\n        VeryEngine.hierarchyTree = hierarchy;\n\n        let rootParent: TreeItem;\n\n        // TODO: hierarchy权限管理，有些人可看不可编辑；\n        // hierarchy.allowRenaming = editor.call('permissions:write');\n        hierarchy.draggable = hierarchy.allowRenaming;\n        hierarchy.class!.add('hierarchy');\n        panel.append(hierarchy);\n\n        let resizeQueued = false;\n        let resizeTree = function () {\n            resizeQueued = false;\n            hierarchy.element!.style.width = '';\n            hierarchy.element!.style.width = (panel.content.dom!.scrollWidth - 5) + 'px';\n        };\n        let resizeQueue = function () {\n            if (resizeQueued) return;\n            resizeQueued = true;\n            requestAnimationFrame(resizeTree);\n        };\n        panel.on('resize', resizeQueue);\n        hierarchy.on('open', resizeQueue);\n        hierarchy.on('close', resizeQueue);\n        setInterval(resizeQueue, 1000);\n\n        // return hierarchy\n        editor.method('entities:hierarchy', function () {\n            return hierarchy;\n        });\n\n        // list item selected\n        hierarchy.on('select', function (item: TreeItem) {\n            // open items till parent\n            let parent = item.parent;\n            while (parent && parent instanceof TreeItem) {\n                parent.open = true;\n                parent = parent.parent;\n            }\n            // focus\n            item.elementTitle.focus();\n            // add selection\n            // TODO\n            // console.log('hierarchy 面板选中entity');\n            // console.log(item.entity);\n\n            // TODO: 当前entity为undefined\n            editor.call('selector:add', 'entity', item.entity);\n        });\n\n        // list item deselected\n        hierarchy.on('deselect', function (item: TreeItem) {\n            // TODO:\n            // console.log('selector:remove entity');\n            editor.call('selector:remove', item.entity);\n        });\n\n        // scrolling on drag\n        let dragScroll = 0;\n        let dragTimer: NodeJS.Timer | null = null;;\n        let dragLastEvt;\n        let dragEvt = function (evt: MouseEvent) {\n            if (!hierarchy._dragging) {\n                clearInterval(Number(dragTimer));\n                window.removeEventListener('mousemove', dragEvt);\n                return;\n            }\n            let rect = panel.content.dom!.getBoundingClientRect();\n\n            if ((evt.clientY - rect.top) < 32 && panel.content.dom!.scrollTop > 0) {\n                dragScroll = -1;\n            } else if ((rect.bottom - evt.clientY) < 32 && (panel.content.dom!.scrollHeight - (rect.height + panel.content.dom!.scrollTop)) > 0) {\n                dragScroll = 1;\n            } else {\n                dragScroll = 0;\n            }\n        };\n\n        hierarchy.on('dragstart', function () {\n            dragTimer = setInterval(function () {\n                if (dragScroll === 0)\n                    return;\n\n                panel.content.dom!.scrollTop += dragScroll * 8;\n                hierarchy._dragOver = null;\n                hierarchy._updateDragHandle();\n            }, 1000 / 60);\n\n            dragScroll = 0;\n            window.addEventListener('mousemove', dragEvt, false);\n\n            // TODO:\n            // console.log('get drag TreeItem entity resourceId');\n\n            let resourceId = hierarchy._dragItems[0].entity.get('resource_id');\n            editor.call('drop:set', 'entity', { resource_id: resourceId });\n            editor.call('drop:activate', true);\n        });\n\n        hierarchy.on('dragend', function () {\n            // console.log('hierarchy panel drag end');\n            editor.call('drop:activate', false);\n            editor.call('drop:set');\n        });\n\n        // TODO\n        let target = editor.call('drop:target', {\n            ref: panel.content.dom,\n            type: 'entity',\n            hole: true,\n            passThrough: true\n        });\n        target.element.style.outline = 'none';\n\n        // let classList = ['tree-item-entity', 'entity-id-' + 'ids-to-be-done', 'c-model'];\n        // if (isRoot) {\n        //   classList.push('tree-item-root');\n        // }\n\n        // let rootElement = new TreeItem({\n        //     text: 'Scene',\n        //     classList: classList\n        // });\n        // rootElement.class!.remove('c-model');\n        // hierarchy.element!.appendChild(rootElement.element!);\n        // hierarchy.emit('append', rootElement);\n\n\n        /*\n        for (let i: number = 0; i < 10; i++) {\n          let element1 = new TreeItem({\n            text: '物体名' + (i + 1),\n            classList: classList\n          });\n          editor.emit('entities:add', element1);\n          hierarchy.emit('append', element1);\n          rootElement.append(element1);\n    \n          for (let k = 0; k < 5; k++) {\n            let element2 = new TreeItem({\n              text: '子物体名' + (k + 1),\n              classList: classList\n            });\n            editor.emit('entities:add', element2);\n            hierarchy.emit('append', element2);\n            element1.append(element2);\n            for (let x = 0; x < 5; x++) {\n              let element3 = new TreeItem({\n                text: '二级子物体' + (x + 1),\n                classList: classList\n              });\n              editor.emit('entities:add', element3);\n              hierarchy.emit('append', element3);\n    \n              element2.append(element3);\n    \n            }\n          }\n        }\n        */\n\n        // reparenting\n        hierarchy.on('reparent', function (items: ReparentDragItems[]) {\n            var records: any = [];\n\n            var preserveTransform = !Tree._ctrl || !Tree._ctrl();\n\n            // make records and collect relevant data\n            for (var i = 0; i < items.length; i++) {\n                if (items[i].item.entity.reparenting)\n                    continue;\n\n                var record: any = {\n                    item: items[i].item,\n                    parent: (<TreeItem>items[i].item.parent!).entity,\n                    entity: items[i].item.entity,\n                    parentOld: (<TreeItem>items[i].old!).entity,\n                    resourceId: items[i].item.entity.get('resource_id'),\n                    parentId: (<TreeItem>items[i].item.parent).entity.get('resource_id'),\n                    parentIdOld: (<TreeItem>items[i].old!).entity.get('resource_id')\n                };\n\n                if (record.entity.get('type') === '2d-gui') {\n                    // relative entity\n                    record.indOld = record.parentOld.get('children').indexOf(record.resourceId);\n\n                    record.indNew = Array.prototype.indexOf.call(record.item.parent.element.childNodes, record.item.element) - 1;\n\n                    records.push(record);\n                } else {\n                    if (preserveTransform && record.entity) {\n                        record.position = record.entity.node.position.clone();\n                        record.rotation = record.entity.node.rotation.clone();\n                    }\n\n                    // relative entity\n                    record.indOld = record.parentOld.get('children').indexOf(record.resourceId);\n\n                    // console.error(record.parent);\n                    // console.error(record.entity);\n                    // console.error(record.parentOld);\n                    // console.warn(record.item);\n                    // console.warn(record.item.parent);\n                    // console.warn(record.item.parent.element);\n                    // console.warn(record.item.parent.element.childNodes);\n\n                    record.indNew = Array.prototype.indexOf.call(record.item.parent.element.childNodes, record.item.element) - 1;\n\n                    // console.warn(record.indNew);\n\n                    records.push(record);\n                }\n            }\n\n            for (var i = 0; i < records.length; i++) {\n                var record = records[i];\n\n                record.entity.reparenting = true;\n\n                // console.warn(record);\n\n                // record.parent.history.enabled = false;\n                // record.parentOld.history.enabled = false;\n                // record.entity.history.enabled = false;\n\n                if (record.parent === record.parentOld) {\n                    // move\n                    record.parent.removeValue('children', record.resourceId);\n                    record.parent.insert('children', record.resourceId, record.indNew + ((record.indNew > record.indOld) ? (records.length - 1 - i) : 0));\n                } else {\n                    // reparenting\n\n                    // remove from old parent\n                    record.parentOld.removeValue('children', record.resourceId);\n\n                    // add to new parent children\n                    if (record.indNew !== -1) {\n                        // before other item\n                        record.parent.insert('children', record.resourceId, record.indNew);\n                    } else {\n                        // at the end\n                        record.parent.insert('children', record.resourceId);\n                    }\n\n                    // set parent\n                    record.entity.set('parent', record.parentId);\n                }\n\n                // console.error(record);\n\n                BabylonLoader.updateSceneData(record.parentOld.get('resource_id'), record.parentOld._data2);\n                BabylonLoader.updateSceneData(record.parent.get('resource_id'), record.parent._data2);\n                BabylonLoader.updateSceneData(record.entity.get('resource_id'), record.entity._data2);\n                editor.call('make:scene:dirty');\n\n                if (preserveTransform && record.position) {\n                    // record.entity.node.position = record.position;\n                    // record.entity.node.rotation = record.rotation;\n\n                    // var localPosition = record.entity.node.position;\n                    // var localRotation = record.entity.node.rotation;\n                    // record.entity.set('position', [localPosition.x, localPosition.y, localPosition.z]);\n                    // record.entity.set('rotation', [localRotation.x, localRotation.y, localRotation.z]);\n                }\n\n                // record.parent.history.enabled = true;\n                // record.parentOld.history.enabled = true;\n                // record.entity.history.enabled = true;\n                record.entity.reparenting = false;\n            }\n\n            // TODO: history\n\n            resizeQueue();\n            // editor.call('viewport:render');\n        });\n\n        // selector add\n        editor.on('selector:add', function (entity: Observer, type: string) {\n            if (type !== 'entity')\n                return;\n\n            self.uiItemIndex[entity.get('resource_id')].selected = true;\n        });\n\n        // selector remove\n        editor.on('selector:remove', function (entity: Observer, type: string) {\n\n            if (type !== 'entity')\n                return;\n\n            self.uiItemIndex[entity.get('resource_id')].selected = false;\n        });\n\n        // selector change\n        editor.on('selector:change', function (type: string, items: Observer[]) {\n            if (type !== 'entity') {\n                hierarchy.clear();\n            } else {\n                var selected = hierarchy.selected;\n                var ids: any = {};\n\n                // build index of selected items\n                for (var i = 0; i < items.length; i++) {\n                    ids[items[i].get('resource_id')] = true;\n                };\n\n                // deselect unselected items\n                for (var i = 0; i < selected.length; i++) {\n                    if (!ids[selected[i].entity.get('resource_id')])\n                        selected[i].selected = false;\n                }\n            }\n        });\n\n\n        // entity removed\n        editor.on('entities:remove', function (entity: Observer) {\n            self.uiItemIndex[entity.get('resource_id')].destroy();\n            resizeQueue();\n        });\n\n\n        // element.append();\n        var componentList: any;\n        // entity added\n        editor.on('entities:add', function (entity: Observer, isRoot: boolean) {\n\n            // console.log('add hierarchy entity: ' + entity.get('name'));\n            if (entity.get('type') === 'transformnode' || entity.get('type') === 'mesh') {\n                entity.node = VeryEngine.viewScene.getNodeByID(entity.get('resource_id'));\n            }\n            var classList = ['tree-item-entity', 'entity-id-' + entity.get('resource_id')];\n            if (isRoot) {\n                classList.push('tree-item-root');\n            }\n\n            var element = new TreeItem({\n                text: entity.get('name'),\n                classList: classList\n            });\n\n            if (!isRoot) {\n                if (entity.get('type') === 'camera') {\n                    element.class?.add('c-camera');\n                } else if (entity.get('type') === 'light') {\n                    element.class?.add('c-light');\n                } else if (entity.get('type') === '2d-gui') {\n                    element.class?.add('c-element');\n                } else {\n                    element.class?.add('c-model');\n                }\n            }\n\n\n            element.entity = entity;\n\n            if (entity.get('type') === '2d-gui') {\n                element.enabled = entity.get('gui.isVisible');\n            } else {\n                element.enabled = entity.get('enabled');\n            }\n\n\n            if (!componentList)\n                componentList = editor.call('components:list');\n\n            // entity.reparenting = false;\n\n            // index\n            self.uiItemIndex[entity.get('resource_id')] = element;\n\n            // name change\n            entity.on('name:set', function (value: string) {\n                element.text = value;\n                resizeQueue();\n            });\n\n            entity.on('enabled:set', function (value: boolean) {\n                // console.log('enabled:set');\n                // console.log(value);\n                element.enabled = value;\n            });\n\n            entity.on('gui.isVisible:set', function (value: boolean) {\n                // console.warn('gui.isVisible:set');\n                // console.warn(value);\n                element.enabled = value;\n            });\n\n            entity.on('children:move', function (value: string, ind: number, indOld: number) {\n                var item = self.uiItemIndex[value];\n                if (!item || item.entity.reparenting)\n                    return;\n\n                element.remove(item);\n\n                var next = self.uiItemIndex[entity.get('children.' + (ind + 1))];\n                var after = null;\n                let isNext: boolean = next ? true : false;\n                if (next === item) {\n                    // next = null;\n                    isNext = false;\n\n                    if (ind > 0)\n                        after = self.uiItemIndex[entity.get('children.' + ind)]\n                }\n\n                if (item.parent)\n                    (<TreeItem>item.parent).remove(item);\n\n                if (next) {\n                    element.appendBefore(item, next);\n                } else if (after) {\n                    element.appendAfter(item, after);\n                } else {\n                    element.append(item);\n                }\n            });\n\n            // remove children\n            entity.on('children:remove', function (value: string) {\n                var item = self.uiItemIndex[value];\n                if (!item || item.entity.reparenting)\n                    return;\n\n                element.remove(item);\n            });\n\n            // add children\n            entity.on('children:insert', function (value: string, ind: number) {\n\n                // console.warn('children:insert in hierarchy-panel');\n                var item = self.uiItemIndex[value];\n\n                if (!item || item.entity.reparenting)\n                    return;\n\n                if (item.parent)\n                    (<TreeItem>item.parent).remove(item);\n\n                var next = self.uiItemIndex[entity.get('children.' + (ind + 1))];\n                if (next) {\n                    element.appendBefore(item, next);\n                } else {\n                    element.append(item);\n                }\n            });\n\n            // collaborators\n            var users = element.users = document.createElement('span');\n            users.classList.add('users');\n            element.elementTitle.appendChild(users);\n\n            // if (entity.get('root')) {\n            //     // root\n            //     hierarchy.append(element);\n            //     element.open = true;\n            // } else {\n            //     if(entity.get('parent') === editor.call('entities:root').get('resource_id')) {\n            //         rootParent.append(element);\n            //     }\n            // }\n\n            // var children = entity.get('children');\n            // if (children.length) {\n            //     for (var c = 0; c < children.length; c++) {\n            //         var child = self.uiItemIndex[children[c]];\n            //         if (!child) {\n            //             var err = 'Cannot find child entity ' + children[c];\n            //             editor.call('status:error', err);\n            //             console.error(err);\n            //             continue;\n            //         }\n            //         element.append(child);\n            //     }\n            // }\n\n            resizeQueue();\n\n        });\n\n\n        // append all treeItems according to child order\n        // 加载scene数据后，统一运行一遍，设定tree item\n        editor.on('entities:load', function (upload?: boolean) {\n            var entities = editor.call('entities:list');\n\n            // var datas: any = {};\n\n            // var path1: string = '';\n            // var path2: string = '';\n            for (var i = 0; i < entities.length; i++) {\n                var entity = entities[i];\n                // if (upload) {\n                //     datas[entity.get('resource_id')] = entity.origin;\n                // }\n\n                // console.warn(entity.get('resource_id'));\n\n                // if (entity.get('asset') && entity.get('asset2')) {\n                //     path1 = entity.get('asset');\n                //     path2 = entity.get('asset2');\n                // }\n\n                var element = self.uiItemIndex[entity.get('resource_id')];\n\n                if (entity.get('root')) {\n                    // root\n                    hierarchy.append(element);\n                    element.open = true;\n                    rootParent = element;\n                }\n                // else {\n                //     if (entity.get('parent') === '') {\n                //         rootParent.append(element);\n                //     }\n                // }\n\n                var children = entity.get('children');\n                if (children.length) {\n                    for (var c = 0; c < children.length; c++) {\n                        var child = self.uiItemIndex[children[c]];\n                        if (!child) {\n                            var err = '父物体： ' + entity.get('name') + '，hierarchy菜单无法关联到子物体，子物体ID：' + children[c];\n                            editor.call('status:error', err);\n                            console.error(err);\n                            continue;\n                        }\n                        element.append(child);\n                    }\n                }\n            }\n\n            // if (upload) {\n            //     axios.post('/api/addScene', { projectID: Config.projectID, entities: datas, path1: path1, path2: path2 })\n            //         .then(response => {\n            //             var data = response.data;\n            //             if (data.code === '0000') {\n            //                 console.log(data.data);\n            //             } else {\n            //                 console.error(data.message);\n            //             }\n            //         })\n            //         .catch(\n            //             error => {\n            //                 console.error(error);\n            //             }\n\n            //         );\n            // }\n\n            // if (path1 && path2 && !upload) {\n            //     editor.call('loadTempModel2', path1, path2);\n            // }\n        });\n\n\n        // deleting entity\n        editor.on('entity:delete', function (entity: Observer) {\n            editor.call('entities:remove', entity);\n        });\n\n        // get entity item\n        editor.method('entities:panel:get', function (resourceId: string) {\n            return self.uiItemIndex[resourceId];\n        });\n\n        // highlight entity\n        editor.method('entities:panel:highlight', function (resourceId: string, highlight: boolean) {\n            var item = self.uiItemIndex[resourceId];\n            if (!item) return;\n\n            if (highlight)\n                item.class!.add('highlight');\n            else\n                item.class!.remove('highlight');\n        });\n\n    }\n\n}","import { List, TextField, ListItem, Panel, Tree, TopElementPanel } from \"../../ui\";\nimport { VeryEngine } from \"../../engine\";\nimport { Observer } from \"../../lib\";\n\nexport class HierarchySearch {\n\n\n    public constructor() {\n\n        editor.method('entities:fuzzy-search', function (query: string) {\n            var items = [];\n            var entities = editor.call('entities:list');\n\n            for (var i = 0; i < entities.length; i++)\n                items.push([entities[i].get('name'), entities[i]]);\n\n            return editor.call('search:items', items, query);\n        });\n\n\n        let panel: TopElementPanel = VeryEngine.hierarchy;\n        let hierarchy: Tree = editor.call('entities:hierarchy');\n        var changing = false;\n        var itemsIndex: { [key: string]: ListItem } = {};\n\n        // 结果列表\n        let results = new List();\n        results.element!.tabIndex = 0;\n        results.hidden = true;\n        results.class!.add('search-results');\n        panel.append(results);\n\n        var lastSearch = '';\n        var search = new TextField('搜索');\n        search.blurOnEnter = false;\n        search.keyChange = true;\n        search.class!.add('search');\n        search.renderChanges = false;\n        panel.prepend(search)\n        // panel.element!.insertBefore(search.element!, panel.innerElement);\n\n        var searchClear = document.createElement('div');\n        searchClear.innerHTML = '&#57650;';\n        searchClear.classList.add('clear');\n        search.element!.appendChild(searchClear);\n\n        searchClear.addEventListener('click', function () {\n            search.value = '';\n        }, false);\n\n\n\n        // clear on escape\n        results.element!.addEventListener('keydown', function (evt) {\n            if (evt.keyCode === 27) { // esc\n                searchClear.click();\n            } else if (evt.keyCode === 13) { // enter\n                // 搜索结果出现以后，按下enter键\n                if (!results.selected) {\n                    var firstElement = results.element!.firstChild;\n                    if (firstElement && (<HTMLElement>firstElement).ui && (<ListItem>(<HTMLElement>firstElement).ui).entity)\n                        editor.call('selector:set', 'entity', [(<ListItem>(<HTMLElement>firstElement).ui).entity]);\n                }\n                search.value = '';\n\n            } else if (evt.keyCode === 40) { // down\n                selectNext();\n                evt.stopPropagation();\n\n            } else if (evt.keyCode === 38) { // up\n                selectPrev();\n                evt.stopPropagation();\n            }\n        }, false);\n\n        // deselecting\n        results.unbind('deselect', results._onDeselect);\n        results._onDeselect = function (item: ListItem) {\n            var ind = results.selected.indexOf(item);\n            if (ind !== -1) results.selected.splice(ind, 1);\n\n            if (this._changing)\n                return;\n\n            if (List._ctrl && List._ctrl()) {\n\n            } else {\n                this._changing = true;\n\n                var items = editor.call('selector:type') === 'entity' && editor.call('selector:items') || [];\n                var inSelected = items.indexOf(item.entity) !== -1;\n\n                if (items.length >= 2 && inSelected) {\n                    var selected = this.selected;\n                    for (var i = 0; i < selected.length; i++)\n                        selected[i].selected = false;\n\n                    item.selected = true;\n                }\n\n                this._changing = false;\n            }\n\n            this.emit('change');\n        };\n        results.on('deselect', results._onDeselect);\n\n        // results selection change\n        results.on('change', function () {\n            if (changing)\n                return;\n\n            if (results.selected) {\n                editor.call('selector:set', 'entity', results.selected.map(function (item) {\n                    return item.entity;\n                }));\n            } else {\n                editor.call('selector:clear');\n            }\n        });\n\n        // selector change\n        editor.on('selector:change', function (type: string, items: Observer[]) {\n            if (changing)\n                return;\n\n            changing = true;\n\n            if (type === 'entity') {\n                results.selected = [];\n\n                for (var i = 0; i < items.length; i++) {\n                    var item = itemsIndex[items[i].get('resource_id')];\n                    if (!item) continue;\n                    item.selected = true;\n                }\n            } else {\n                results.selected = [];\n            }\n\n            changing = false;\n        });\n\n        var selectNext = function () {\n            // list item\n            var children = results.element!.children;\n\n            // could be nothing or only one item to select\n            if (!children.length)\n                return;\n\n            var toSelect = null;\n            // 被选择的item\n            var items = results.element!.querySelectorAll('.ui-list-item.selected');\n            var multi = (List._ctrl && List._ctrl()) || (List._shift && List._shift());\n\n            if (items.length) {\n                var last = items[items.length - 1];\n                var next = last.nextSibling; // 下一个list item\n                if (next) {\n                    // select next\n                    toSelect = (<HTMLElement>next).ui;\n                } else {\n                    // loop through\n                    if (!multi) toSelect = (<HTMLElement>children[0]).ui;\n                }\n            } else {\n                // select first\n                toSelect = (<HTMLElement>children[0]).ui;\n            }\n\n            if (toSelect) {\n                if (!multi) results.selected = [];\n                (<ListItem>toSelect).selected = true;\n            }\n        };\n\n        var selectPrev = function () {\n            var children = results.element!.children;\n\n            // could be nothing or only one item to select\n            if (!children.length)\n                return;\n\n            var toSelect = null;\n            var items = results.element!.querySelectorAll('.ui-list-item.selected');\n            var multi = (List._ctrl && List._ctrl()) || (List._shift && List._shift());\n\n            if (items.length) {\n                var first = items[0];\n                var prev = first.previousSibling;\n                if (prev) {\n                    // select previous\n                    toSelect = (<HTMLElement>prev).ui;\n                } else {\n                    // loop through\n                    if (!multi) toSelect = (<HTMLElement>children[children.length - 1]).ui;\n                }\n            } else {\n                // select last\n                toSelect = (<HTMLElement>children[children.length - 1]).ui;\n            }\n\n            if (toSelect) {\n                if (!multi) results.selected = [];\n                (<ListItem>toSelect).selected = true;\n            }\n        };\n\n        search.element!.addEventListener('keydown', function (evt: KeyboardEvent) {\n            if (evt.keyCode === 27) {\n                searchClear.click();\n\n            } else if (evt.keyCode === 13) {\n                if (!results.selected.length) {\n                    var firstElement = results.element!.firstChild;\n                    if (firstElement && (<HTMLElement>firstElement).ui && (<ListItem>(<HTMLElement>firstElement).ui).entity)\n                        editor.call('selector:set', 'entity', [(<ListItem>(<HTMLElement>firstElement).ui).entity]);\n                }\n                search.value = '';\n\n            } else if (evt.keyCode === 40) { // down\n                editor.call('hotkey:updateModifierKeys', evt);\n                selectNext();\n                evt.stopPropagation();\n                evt.preventDefault();\n\n            } else if (evt.keyCode === 38) { // up\n                editor.call('hotkey:updateModifierKeys', evt);\n                selectPrev();\n                evt.stopPropagation();\n                evt.preventDefault();\n\n            } else if (evt.keyCode === 65 && evt.ctrlKey) { // ctrl + a\n                var toSelect: ListItem[] = [];\n\n                var items = results.element!.querySelectorAll('.ui-list-item');\n                for (var i = 0; i < items.length; i++)\n                    toSelect.push(<ListItem>(<HTMLElement>items[i]).ui);\n\n                results.selected = toSelect;\n\n                evt.stopPropagation();\n                evt.preventDefault();\n            }\n        }, false);\n\n\n        // if entity added, check if it maching query\n        editor.on('entities:add', function (entity: Observer) {\n            var query = search.value.trim();\n            if (!query)\n                return;\n\n            var items = [[entity.get('name'), entity]];\n            var result = editor.call('search:items', items, query);\n\n            if (!result.length)\n                return;\n\n            performSearch();\n        });\n\n        var addItem = function (entity: Observer) {\n            var events: any = [];\n\n            var item = new ListItem(entity.get('name'));\n            item.disabledClick = true;\n            item.entity = entity;\n\n            if (entity.get('children').length)\n                item.class!.add('container');\n\n            // relate to tree item\n            var treeItem = editor.call('entities:panel:get', entity.get('resource_id'));\n\n            item.disabled = treeItem.disabled;\n\n            var onStateChange = function () {\n                item.disabled = treeItem.disabled;\n            };\n\n            events.push(treeItem.on('enable', onStateChange));\n            events.push(treeItem.on('disable', onStateChange));\n\n            var onNameSet = function (name: string) {\n                item.text = name;\n            };\n            // TODO\n            events.push(entity.on('name:set', onNameSet));\n\n            // icon\n            var components = Object.keys(entity.get('components'));\n            for (var c = 0; c < components.length; c++)\n                item.class!.add('c-' + components[c]);\n\n            var onContextMenu = function (evt: MouseEvent) {\n                var openned = editor.call('entities:contextmenu:open', entity, evt.clientX, evt.clientY);\n\n                if (openned) {\n                    evt.preventDefault();\n                    evt.stopPropagation();\n                }\n            };\n\n            var onDblClick = function (evt: MouseEvent) {\n                search.value = '';\n                editor.call('selector:set', 'entity', [entity]);\n\n                evt.stopPropagation();\n                evt.preventDefault();\n            };\n\n            item.element!.addEventListener('contextmenu', onContextMenu);\n            item.element!.addEventListener('dblclick', onDblClick);\n\n            events.push(item.once('destroy', function () {\n                for (var i = 0; i < events.length; i++)\n                    events[i].unbind();\n                events = null;\n\n                item.element!.removeEventListener('contextmenu', onContextMenu);\n                item.element!.removeEventListener('dblclick', onDblClick);\n            }));\n\n            events.push(treeItem.once('destroy', function () {\n                // if entity removed, perform search again\n                performSearch();\n            }));\n\n            return item;\n        };\n\n        var performSearch = function () {\n            var query = lastSearch;\n\n            // clear results list\n            results.clear();\n            itemsIndex = {};\n\n            if (query) {\n                var result = editor.call('entities:fuzzy-search', query);\n\n                hierarchy.hidden = true;\n                results.hidden = false;\n\n                var selected = [];\n                if (editor.call('selector:type') === 'entity')\n                    selected = editor.call('selector:items');\n\n                for (var i = 0; i < result.length; i++) {\n                    var item = addItem(result[i]);\n\n                    itemsIndex[result[i].get('resource_id')] = item;\n\n                    if (selected.indexOf(result[i]) !== -1)\n                        item.selected = true;\n\n                    results.append(item);\n                }\n            } else {\n                results.hidden = true;\n                hierarchy.hidden = false;\n            }\n        };\n\n        search.on('change', function (value: string) {\n            value = value.trim();\n\n            if (lastSearch === value) return;\n            lastSearch = value;\n\n            if (value) {\n                search.class!.add('not-empty');\n            } else {\n                search.class!.remove('not-empty');\n            }\n\n            performSearch();\n        });\n\n    }\n\n\n}","export * from './keeper';\nexport * from './hierarchy-panel';\nexport * from './hierarchy-menu';\nexport * from './hierarchy-control';\nexport * from './hierarchy-search';\n\n\nexport * from './hierarchy-context-menu';","import { Panel, Button, Tooltip, Tree, TreeItem } from '../../ui';\nimport { VeryEngine } from '../../engine';\nimport { HierarchySearch } from './hierarchy-search';\nimport { HierarchyMenu } from './hierarchy-menu';\nimport { HierarchyContextMenu } from './hierarchy-context-menu';\nimport { HierarchyPanel } from './hierarchy-panel';\nimport { HierarchyControl } from './hierarchy-control';\n\nexport class HierarchyKeeper {\n\n  // public hierarchyMain: Panel;\n\n  public constructor() {\n    // this.hierarchyMain = new Panel();\n    // this.hierarchyMain.class!.add('hierarchy-controls');\n    // this.hierarchyMain.parent = VeryEngine.hierarchyPanel;\n    // VeryEngine.hierarchyPanel.headerAppend(this.hierarchyMain);\n    // // console.log('hierarchy-controls');\n\n    // // controls delete (Button)\n    // let btnDelete: Button = new Button('&#57636;');\n    // btnDelete.class!.add('delete');\n    // btnDelete.style!.fontWeight = '200';\n    // btnDelete.on('click', function () {\n    //   let type = editor.call('selector:type');\n    //   if (type !== 'entity')\n    //     return;\n    //   editor.call('entities:delete', editor.call('selector:items'));\n    // });\n    // this.hierarchyMain.append(btnDelete);\n\n    // let tooltipDelete = Tooltip.attach({\n    //   target: btnDelete.element!,\n    //   text: '删除',\n    //   align: 'top',\n    //   root: VeryEngine.rootPanel\n    // });\n    // tooltipDelete.class!.add('innactive');\n\n    // // controls duplicate\n    // let btnDuplicate: Button = new Button('&#57638;');\n    // btnDuplicate.disabled = true;\n    // btnDuplicate.class!.add('duplicate');\n    // btnDuplicate.on('click', function () {\n    //   let type = editor.call('selector:type');\n    //   let items = editor.call('selector:items');\n\n    //   if (type === 'entity' && items.length)\n    //     editor.call('entities:duplicate', items);\n    // });\n    // this.hierarchyMain.append(btnDuplicate);\n\n    // let tooltipDuplicate = Tooltip.attach({\n    //   target: btnDuplicate.element!,\n    //   text: '复制',\n    //   align: 'top',\n    //   root: VeryEngine.rootPanel\n    // });\n    // tooltipDuplicate.class!.add('innactive');\n\n    // // TODO: Menu\n    // // let menuEntities = ui.Menu.fromData(editor.call('menu:entities:new'));\n    // // root.append(menuEntities);\n\n    // // controls add\n    // let btnAdd: Button = new Button('&#57632;');\n    // btnAdd.class!.add('add');\n    // btnAdd.on('click', function () {\n    //   // menuEntities.open = true;\n    //   // let rect = btnAdd.element.getBoundingClientRect();\n    //   // menuEntities.position(rect.left, rect.top);\n    // });\n    // this.hierarchyMain.append(btnAdd);\n\n    // Tooltip.attach({\n    //   target: btnAdd.element!,\n    //   text: '添加',\n    //   align: 'top',\n    //   root: VeryEngine.rootPanel\n    // });\n\n    // hierarchy panel\n    let hierarchyMainPanel = new HierarchyPanel();\n\n    // 全局菜单\n    let contextMenuLogo = new HierarchyMenu();\n    // let controlMenu = new HierarchyControl();\n\n    // 搜索区域：Search Field\n    let searchField = new HierarchySearch();\n\n    \n\n    let contextMenu = new HierarchyContextMenu();\n\n  }\n\n\n}","import { BabylonLoader } from \"./middleware/loader/babylonLoader\";\n\nexport class Hotkeys {\n\n    public static ctrl: boolean = false;\n    public static shift: boolean = false;\n    public static alt: boolean = false;\n\n    private hotkeys: { [key: string]: HotKeyArgs } = {};\n    private keyIndex: { [key: string]: string[] } = {};\n    // private keysDown = {};\n\n    private isMac: boolean = navigator.userAgent.indexOf('Mac OS X') !== -1;\n\n    private keyByKeyCode: { [key: number]: string } = {};\n    private keyByCode: { [key: string]: string } = {};\n\n    private keyMap: { [key: string]: { keyCode: number, code: string | string[] } } = {};\n\n    public constructor() {\n        this.keyMapInit();\n\n        let self = this;\n\n        editor.method('hotkey:register', function (name: string, args: HotKeyArgs) {\n            self.hotkeys[name] = args;\n\n            // keys list\n            let keys: string[] = [args.ctrl ? '1' : '0', args.alt ? '1' : '0', args.shift ? '1' : '0'];\n\n            // map keyCode to key\n            if (typeof (args.key) === 'number')\n                args.key = self.keyByKeyCode[args.key];\n\n            // unknown key\n            if (!args.key) {\n                console.error('未知的hotkeys: ' + name + ', ' + args.key);\n                return;\n            }\n\n            keys.push(args.key);\n\n            args.index = keys.join('+');\n\n            if (!self.keyIndex[args.index])\n                self.keyIndex[args.index] = [];\n\n            self.keyIndex[args.index].push(name);\n        });\n\n        editor.method('hotkey:unregister', function (name: string) {\n            let hotkey: HotKeyArgs = self.hotkeys[name];\n            if (!hotkey) return;\n\n            if (self.keyIndex[hotkey.index!].length === 1) {\n                delete self.keyIndex[hotkey.index!];\n            } else {\n                self.keyIndex[hotkey.index!].splice(self.keyIndex[hotkey.index!].indexOf(name), 1);\n            }\n\n            delete self.hotkeys[name];\n        });\n\n\n        editor.method('hotkey:shift', function () {\n            return Hotkeys.shift;\n        });\n\n        editor.method('hotkey:ctrl', function () {\n            return Hotkeys.ctrl;\n        });\n\n        editor.method('hotkey:alt', function () {\n            return Hotkeys.alt;\n        });\n\n        let updateModifierKeys: (evt: Event) => void = function (evt: Event): void {\n            if (evt instanceof KeyboardEvent || evt instanceof MouseEvent) {\n                // console.warn(evt);\n                Hotkeys.shift = evt.shiftKey;\n                Hotkeys.ctrl = evt.ctrlKey || evt.metaKey;\n                Hotkeys.alt = evt.altKey;\n            }\n        };\n        editor.method('hotkey:updateModifierKeys', updateModifierKeys);\n\n        window.addEventListener('keydown', function (evt: KeyboardEvent) {\n            if (evt.target) {\n                let tag: string = (<HTMLElement>evt.target).tagName;\n                if (/(input)|(textarea)/i.test(tag) && !(<HTMLElement>evt.target).classList.contains('hotkeys'))\n                    return;\n            }\n\n            updateModifierKeys(evt);\n\n            let key: string = evt.code ? self.keyByCode[evt.code] : self.keyByKeyCode[evt.keyCode];\n\n            if (evt.keyCode === 92 || evt.keyCode === 93)\n                return;\n\n            let index: string = [Hotkeys.ctrl ? '1' : '0', Hotkeys.alt ? '1' : '0', Hotkeys.shift ? '1' : '0', key].join('+');\n\n            if (self.keyIndex[index]) {\n                let skipPreventDefault: boolean = false;\n                for (let i: number = 0; i < self.keyIndex[index].length; i++) {\n                    if (!skipPreventDefault && self.hotkeys[self.keyIndex[index][i]].skipPreventDefault)\n                        skipPreventDefault = true;\n\n                    self.hotkeys[self.keyIndex[index][i]].callback(evt);\n                }\n                if (!skipPreventDefault)\n                    evt.preventDefault();\n            }\n        }, false);\n\n        // Returns Ctrl or Cmd for Mac\n        editor.method('hotkey:ctrl:string', function () {\n            return self.isMac ? 'Cmd' : 'Ctrl';\n        });\n\n\n        window.addEventListener('keyup', updateModifierKeys, false);\n        window.addEventListener('mousedown', updateModifierKeys, false);\n        window.addEventListener('mouseup', updateModifierKeys, false);\n        window.addEventListener('click', updateModifierKeys, false);\n\n        // save scene\n        editor.call('hotkey:register', 'save:scene', {\n            key: 's',\n            ctrl: true,\n            callback: function () {\n                editor.call('save:scene');\n            }\n        });\n\n    }\n\n\n    private keyMapInit(): void {\n        this.keyMap = {\n            'backspace': {\n                keyCode: 8,\n                code: 'Backspace'\n            },\n            'tab': {\n                keyCode: 9,\n                code: 'Tab',\n            },\n            'enter': {\n                keyCode: 13,\n                code: ['enter', 'NumpadEnter', 'Enter'],\n            },\n            'shift': {\n                keyCode: 16,\n                code: ['ShiftLeft', 'ShiftRight'],\n            },\n            'ctrl': {\n                keyCode: 17,\n                code: ['CtrlLeft', 'CtrlRight'],\n            },\n            'alt': {\n                keyCode: 18,\n                code: ['AltLeft', 'AltRight'],\n            },\n            'pause/break': {\n                keyCode: 19,\n                code: 'Pause',\n            },\n            'caps lock': {\n                keyCode: 20,\n                code: 'CapsLock',\n            },\n            'esc': {\n                keyCode: 27,\n                code: 'Escape',\n            },\n            'space': {\n                keyCode: 32,\n                code: 'Space',\n            },\n            'page up': {\n                keyCode: 33,\n                code: 'PageUp'\n            },\n            'page down': {\n                keyCode: 34,\n                code: 'PageDown'\n            },\n            'end': {\n                keyCode: 35,\n                code: 'End'\n            },\n            'home': {\n                keyCode: 36,\n                code: 'Home'\n            },\n            'left arrow': {\n                keyCode: 37,\n                code: 'ArrowLeft'\n            },\n            'up arrow': {\n                keyCode: 38,\n                code: 'ArrowUp'\n            },\n            'right arrow': {\n                keyCode: 39,\n                code: 'ArrowRight'\n            },\n            'down arrow': {\n                keyCode: 40,\n                code: 'ArrowDown'\n            },\n            'insert': {\n                keyCode: 45,\n                code: 'Insert'\n            },\n            'delete': {\n                keyCode: 46,\n                code: 'Delete'\n            },\n            '0': {\n                keyCode: 48,\n                code: 'Digit0'\n            },\n            '1': {\n                keyCode: 49,\n                code: 'Digit1'\n            },\n            '2': {\n                keyCode: 50,\n                code: 'Digit2'\n            },\n            '3': {\n                keyCode: 51,\n                code: 'Digit3'\n            },\n            '4': {\n                keyCode: 52,\n                code: 'Digit4'\n            },\n            '5': {\n                keyCode: 53,\n                code: 'Digit5'\n            },\n            '6': {\n                keyCode: 54,\n                code: 'Digit6'\n            },\n            '7': {\n                keyCode: 55,\n                code: 'Digit7'\n            },\n            '8': {\n                keyCode: 56,\n                code: 'Digit8'\n            },\n            '9': {\n                keyCode: 57,\n                code: 'Digit9'\n            },\n            'a': {\n                keyCode: 65,\n                code: 'KeyA'\n            },\n            'b': {\n                keyCode: 66,\n                code: 'KeyB'\n            },\n            'c': {\n                keyCode: 67,\n                code: 'KeyC'\n            },\n            'd': {\n                keyCode: 68,\n                code: 'KeyD'\n            },\n            'e': {\n                keyCode: 69,\n                code: 'KeyE'\n            },\n            'f': {\n                keyCode: 70,\n                code: 'KeyF'\n            },\n            'g': {\n                keyCode: 71,\n                code: 'KeyG'\n            },\n            'h': {\n                keyCode: 72,\n                code: 'KeyH'\n            },\n            'i': {\n                keyCode: 73,\n                code: 'KeyI'\n            },\n            'j': {\n                keyCode: 74,\n                code: 'KeyJ'\n            },\n            'k': {\n                keyCode: 75,\n                code: 'KeyK'\n            },\n            'l': {\n                keyCode: 76,\n                code: 'KeyL'\n            },\n            'm': {\n                keyCode: 77,\n                code: 'KeyM'\n            },\n            'n': {\n                keyCode: 78,\n                code: 'KeyN'\n            },\n            'o': {\n                keyCode: 79,\n                code: 'KeyO'\n            },\n            'p': {\n                keyCode: 80,\n                code: 'KeyP'\n            },\n            'q': {\n                keyCode: 81,\n                code: 'KeyQ'\n            },\n            'r': {\n                keyCode: 82,\n                code: 'KeyR'\n            },\n            's': {\n                keyCode: 83,\n                code: 'KeyS'\n            },\n            't': {\n                keyCode: 84,\n                code: 'KeyT'\n            },\n            'u': {\n                keyCode: 85,\n                code: 'KeyU'\n            },\n            'v': {\n                keyCode: 86,\n                code: 'KeyV'\n            },\n            'w': {\n                keyCode: 87,\n                code: 'KeyW'\n            },\n            'x': {\n                keyCode: 88,\n                code: 'KeyX'\n            },\n            'y': {\n                keyCode: 89,\n                code: 'KeyY'\n            },\n            'z': {\n                keyCode: 90,\n                code: 'KeyZ'\n            },\n            'left window key': {\n                keyCode: 91,\n                code: 'MetaLeft'\n            },\n            'right window key': {\n                keyCode: 92,\n                code: 'MetaRight'\n            },\n            'select key': {\n                keyCode: 93,\n                code: 'ContextMenu'\n            },\n            'numpad 0': {\n                keyCode: 96,\n                code: 'Numpad0'\n            },\n            'numpad 1': {\n                keyCode: 97,\n                code: 'Numpad1'\n            },\n            'numpad 2': {\n                keyCode: 98,\n                code: 'Numpad2'\n            },\n            'numpad 3': {\n                keyCode: 99,\n                code: 'Numpad3'\n            },\n            'numpad 4': {\n                keyCode: 100,\n                code: 'Numpad4'\n            },\n            'numpad 5': {\n                keyCode: 101,\n                code: 'Numpad5'\n            },\n            'numpad 6': {\n                keyCode: 102,\n                code: 'Numpad6'\n            },\n            'numpad 7': {\n                keyCode: 103,\n                code: 'Numpad7'\n            },\n            'numpad 8': {\n                keyCode: 104,\n                code: 'Numpad8'\n            },\n            'numpad 9': {\n                keyCode: 105,\n                code: 'Numpad9'\n            },\n            'multiply': {\n                keyCode: 106,\n                code: 'NumpadMultiply'\n            },\n            'add': {\n                keyCode: 107,\n                code: 'NumpadAdd'\n            },\n            'subtract': {\n                keyCode: 109,\n                code: 'NumpadSubtract'\n            },\n            'decimal point': {\n                keyCode: 110,\n                code: 'NumpadDecimal'\n            },\n            'divide': {\n                keyCode: 111,\n                code: 'NumpadDivide'\n            },\n            'f1': {\n                keyCode: 112,\n                code: 'F1'\n            },\n            'f2': {\n                keyCode: 113,\n                code: 'F2'\n            },\n            'f3': {\n                keyCode: 114,\n                code: 'F3'\n            },\n            'f4': {\n                keyCode: 115,\n                code: 'F4'\n            },\n            'f5': {\n                keyCode: 116,\n                code: 'F5'\n            },\n            'f6': {\n                keyCode: 117,\n                code: 'F6'\n            },\n            'f7': {\n                keyCode: 118,\n                code: 'F7'\n            },\n            'f8': {\n                keyCode: 119,\n                code: 'F8'\n            },\n            'f9': {\n                keyCode: 120,\n                code: 'F9'\n            },\n            'f10': {\n                keyCode: 121,\n                code: 'F10'\n            },\n            'f11': {\n                keyCode: 122,\n                code: 'F11'\n            },\n            'f12': {\n                keyCode: 123,\n                code: 'F12'\n            },\n            'num lock': {\n                keyCode: 144,\n                code: 'NumLock'\n            },\n            'scroll lock': {\n                keyCode: 145,\n                code: 'ScrollLock'\n            },\n            'semi-colon': {\n                keyCode: 186,\n                code: 'Semicolon'\n            },\n            'equal sign': {\n                keyCode: 187,\n                code: 'Equal'\n            },\n            'comma': {\n                keyCode: 188,\n                code: 'Comma'\n            },\n            'dash': {\n                keyCode: 189,\n                code: 'Minus'\n            },\n            'period': {\n                keyCode: 190,\n                code: 'Period'\n            },\n            'forward slash': {\n                keyCode: 191,\n                code: ''\n            },\n            'grave accent': {\n                keyCode: 192,\n                code: 'Backquote'\n            },\n            'open bracket': {\n                keyCode: 219,\n                code: 'BracketLeft'\n            },\n            'back slash': {\n                keyCode: 220,\n                code: ['Backslash', 'IntlBackslash']\n            },\n            'close bracket': {\n                keyCode: 221,\n                code: 'BracketRight'\n            },\n            'single quote': {\n                keyCode: 222,\n                code: 'Quote'\n            },\n        };\n\n        for (let key in this.keyMap) {\n            this.keyByKeyCode[this.keyMap[key].keyCode] = key;\n\n            if (this.keyMap[key].code instanceof Array) {\n                for (let i: number = 0; i < this.keyMap[key].code.length; i++) {\n                    this.keyByCode[this.keyMap[key].code[i]] = key;\n                }\n            } else {\n                this.keyByCode[<string>(this.keyMap[key].code)] = key;\n            }\n        }\n\n    }\n\n\n\n}\n\n\nexport interface HotKeyArgs {\n    key: string | number;\n    callback: (evt?: Event) => void;\n    ctrl?: boolean;\n    alt?: boolean;\n    shift?: boolean;\n    skipPreventDefault?: boolean;\n    index?: string\n}","export * from './initialize-before';\nexport * from './editor';\nexport * from './layout';\nexport * from './viewport';\nexport * from './hierarchy';\nexport * from './hotkeys';\nexport * from './entity';\nexport * from './assets';\nexport * from './scenes';\nexport * from './camera';\nexport * from './toolbar';\nexport * from './pickers';\nexport * from './settings';\nexport * from './utility';\nexport * from './middleware';\nexport * from './initialize-after';\nexport * from './localstorage';\nexport * from './search';\nexport * from './drop';\nexport * from './global';\nexport * from './Initialize-data';\nexport * from './gizmos';\nexport * from './gui';\n","import { AttributesPanel, AttributesEntity, AttributesReference, AttributesKeeper } from \"./attributes\";\nimport { ToolbarKeeper } from \"./toolbar\";\nimport { ViewportKeeper } from \"./viewport\";\nimport { EntityKeeper } from \"./entity\";\nimport { ScenesKeeper } from \"./scenes\";\nimport { CameraKeeper } from \"./camera\";\nimport { SettingsKeeper } from \"./settings\";\nimport { PickerKeeper } from \"./pickers\";\n\n\nexport class InitializeAfter {\n\n\n  public constructor() {\n\n    // entity\n    let entity = new EntityKeeper();\n\n    // scenes\n    new ScenesKeeper();\n\n    // camera\n    new CameraKeeper();\n\n    // attributes\n    let attributes = new AttributesKeeper();\n\n    // toolbar\n    let toolbar = new ToolbarKeeper();\n    new SettingsKeeper();\n\n    // picker\n    new PickerKeeper();\n\n    // viewport\n    new ViewportKeeper();\n\n  }\n\n\n}","import { Hotkeys } from \"./hotkeys\";\nimport { ComponentsLogos, ContextMenu } from \"./utility\";\nimport { Selector } from \"./selector\";\nimport { Realtime } from \"./web/realtime\";\nimport { LocalStorage } from \"./localstorage\";\n\nexport class InitializeBefore {\n\n    public constructor() {\n\n        editor.method('permissions:write', () => {\n            return true;\n        });\n\n        this.init();\n    }\n\n    private init(): void {\n\n        // axois默认请求头设置，全局通过json方式传送和接收数据\n        // axios.defaults.headers.post[\"Content-Type\"] = \"application/json\";\n\n        // 全局快捷键注册\n        let hotkeys = new Hotkeys();\n\n        // localstorage\n        let localstorage = new LocalStorage();\n\n        // components-logos\n        let logos = new ComponentsLogos();\n\n        // 屏蔽浏览器默认右键菜单\n        let systemContextMenu = new ContextMenu();\n\n        // selector \n        let selector = new Selector();\n\n        // Websocket\n        // let io = new Realtime();\n\n    }\n\n}","import { Panel, TopElementContainer, TopElementPanel } from '../ui';\nimport { VeryEngine } from '../engine';\n\nexport class Layout {\n\n    private ignoreClasses: RegExp = /(ui-list-item)|(ui-button)|(ui-text-field)|(ui-number-field)/i;\n    private ignoreElements: RegExp = /(input)|(textarea)/i;\n\n\n    public constructor() {\n        let self = this;\n        // prevent drag'n'select\n        window.addEventListener('mousedown', function (evt) {\n            // don't prevent for certain cases\n            if (evt.target) {\n                if (self.ignoreClasses.test((<HTMLElement>evt.target).className)) {\n                    return;\n                } else if (self.ignoreElements.test((<HTMLElement>evt.target).tagName)) {\n                    return;\n                } else if ((<HTMLElement>evt.target).classList.contains('selectable')) {\n                    return;\n                }\n            }\n\n            // blur inputs\n            if (window.getSelection) {\n                let focusNode = window.getSelection()!.focusNode;\n                if (focusNode) {\n                    if ((<HTMLElement>focusNode).tagName === 'INPUT') {\n                        (<HTMLElement>focusNode).blur();\n                    } else if (focusNode.firstChild && (<HTMLElement>focusNode.firstChild).tagName === 'INPUT') {\n                        (<HTMLElement>focusNode.firstChild).blur();\n                    }\n                }\n            }\n\n            // prevent default will prevent blur, dragstart and selection\n            evt.preventDefault();\n        }, false);\n    }\n\n    public init(): void {\n        // main container\n        var root = new TopElementContainer({\n            id: 'layout-root',\n            grid: true\n        });\n        document.body.appendChild(root.dom!);\n        // expose\n        editor.method('layout.root', function () {\n            return root;\n        });\n        VeryEngine.root = root;\n\n        // toolbar (left)\n        var toolbar = new TopElementContainer({\n            id: 'layout-toolbar',\n            flex: true\n        });\n        root.append(toolbar);\n        // expose\n        editor.method('layout.toolbar', function () { return toolbar; });\n        VeryEngine.toolbar = toolbar;\n\n        // hierarchy\n        var hierarchyPanel = new TopElementPanel({\n            headerText: '层级菜单',\n            id: 'layout-hierarchy',\n            flex: true,\n            enabled: true,\n            width: editor.call('localStorage:get', 'editor:layout:hierarchy:width') || 256,\n            panelType: 'normal',\n            collapsible: true,\n            collapseHorizontally: true,\n            collapsed: editor.call('localStorage:get', 'editor:layout:hierarchy:collapse') || window.innerWidth <= 480,\n            scrollable: true,\n            resizable: 'right',\n            resizeMin: 196,\n            resizeMax: 512\n        });\n\n        hierarchyPanel.on('resize', function () {\n            editor.call('localStorage:set', 'editor:layout:hierarchy:width', hierarchyPanel.width);\n        });\n        hierarchyPanel.on('collapse', function () {\n            editor.call('localStorage:set', 'editor:layout:hierarchy:collapse', true);\n        });\n        hierarchyPanel.on('expand', function () {\n            editor.call('localStorage:set', 'editor:layout:hierarchy:collapse', false);\n        });\n\n        root.append(hierarchyPanel);\n        // expose\n        editor.method('layout.hierarchy', function () { return hierarchyPanel; });\n\n        editor.on('permissions:writeState', function (state: boolean) {\n            hierarchyPanel.enabled = state;\n        });\n        VeryEngine.hierarchy = hierarchyPanel;\n\n\n        // viewport\n        var viewport = new TopElementContainer({\n            id: 'layout-viewport'\n        });\n        viewport.class!.add('viewport');\n        root.append(viewport);\n        // expose\n        editor.method('layout.viewport', function () { return viewport; });\n        VeryEngine.viewportPanel = viewport;\n\n        // assets\n        var assetsPanel = new TopElementPanel({\n            id: 'layout-assets',\n            headerText: '资源面板',\n            flex: true,\n            flexDirection: 'row',\n            panelType: 'normal',\n            collapsible: true,\n            collapsed: editor.call('localStorage:get', 'editor:layout:assets:collapse') || window.innerHeight <= 480,\n            height: editor.call('localStorage:get', 'editor:layout:assets:height') || 212,\n            scrollable: true,\n            resizable: 'top',\n            resizeMin: 106,\n            resizeMax: 106 * 6\n        });\n        assetsPanel.class!.add('assets');\n\n        assetsPanel.on('resize', function () {\n            editor.call('localStorage:set', 'editor:layout:assets:height', assetsPanel.height);\n        });\n        assetsPanel.on('collapse', function () {\n            editor.call('localStorage:set', 'editor:layout:assets:collapse', true);\n        });\n        assetsPanel.on('expand', function () {\n            editor.call('localStorage:set', 'editor:layout:assets:collapse', false);\n        });\n\n        root.append(assetsPanel);\n        // expose\n        editor.method('layout.assets', function () { return assetsPanel; });\n        VeryEngine.assets = assetsPanel;\n\n        // attributes\n        var attributesPanel = new TopElementPanel({\n            id: 'layout-attributes',\n            headerText: '属性面板',\n            enabled: true,\n            panelType: 'normal',\n            width: editor.call('localStorage:get', 'editor:layout:attributes:width') || 320,\n            collapsible: true,\n            collapseHorizontally: true,\n            collapsed: editor.call('localStorage:get', 'editor:layout:attributes:collapse') || false,\n            scrollable: true,\n            resizable: 'left',\n            resizeMin: 256,\n            resizeMax: 512\n        });\n        attributesPanel.class!.add('attributes');\n\n        attributesPanel.on('resize', function () {\n            editor.call('localStorage:set', 'editor:layout:attributes:width', attributesPanel.width);\n        });\n        attributesPanel.on('collapse', function () {\n            editor.call('localStorage:set', 'editor:layout:attributes:collapse', true);\n        });\n        attributesPanel.on('expand', function () {\n            editor.call('localStorage:set', 'editor:layout:attributes:collapse', false);\n        });\n\n        root.append(attributesPanel);\n        // expose\n        editor.method('layout.attributes', function () { return attributesPanel; });\n        editor.on('permissions:writeState', function (state: boolean) {\n            attributesPanel.enabled = state;\n        });\n        VeryEngine.attributes = attributesPanel;\n\n        // status bar\n        var statusBar = new TopElementContainer({\n            id: 'layout-statusbar',\n            flex: true,\n            flexDirection: 'row'\n        });\n        root.append(statusBar);\n        // expose\n        editor.method('layout.statusBar', function () { return statusBar; });\n        VeryEngine.statusBar = statusBar;\n\n        if (window.innerWidth <= 720) {\n            // attributesPanel.folded = true;\n            console.warn('folder');\n        }\n            \n\n    }\n\n\n}","export class LocalStorage {\n\n    public constructor() {\n        // Get a key from the local storage\n        editor.method('localStorage:get', function (key: string) {\n            var value = localStorage.getItem(key);\n            if (value) {\n                try {\n                    value = JSON.parse(value);\n                } catch (e) {\n                    console.error(e);\n                }\n            }\n\n            return value;\n        });\n\n        // Set a key-value pair in localStorage\n        editor.method('localStorage:set', function (key: string, value: any) {\n            localStorage.setItem(key, JSON.stringify(value));\n        });\n\n        // Returns true if the key exists in the local storage\n        editor.method('localStorage:has', function (key: string) {\n            return !!localStorage.getItem(key);\n        });\n    }\n}","import { Transform } from \"./transform\";\nimport { GameObject } from \"./gameobject\";\n\nexport class Component {\n\n\n  public get transform(): Transform {\n    return new Transform();\n  }\n\n  public get gameObject(): GameObject {\n    return new GameObject();\n  }\n\n  public get tag(): string {\n    return '';\n  }\n\n  public get camera(): Component {\n    return new Component();\n  }\n\n\n  public get light(): Component {\n    return new Component();\n  }\n\n  public get renderer(): Component {\n    return new Component();\n  }\n\n  public get collider(): Component {\n    return new Component();\n  }\n\n  public constructor() {\n\n  }\n\n\n\n}","import { Transform } from \"./transform\";\nimport { BabylonEngine } from \"../../engine\";\n\nexport class GameObject {\n\n\n  public get gameObject(): GameObject {\n    return this;\n  }\n\n  public get transform(): Transform {\n    return this._transform;\n  }\n  public set transform(val: Transform) {\n    this._transform = val;\n  }\n  private _transform: Transform;\n\n  public get name(): string {\n    return this.transform.name;\n  }\n  public set name(val: string) {\n    this.transform.name = val;\n  }\n\n  private _guid: string = '';\n  public get guid(): string {\n    return this._guid;\n  }\n  public set guid(val: string) {\n    this._guid = val;\n  }\n\n  public get isEmpty(): boolean {\n    return this._transform.isEmpty;\n  }\n\n  public get mesh(): Nullable<BABYLON.AbstractMesh> {\n    return this._transform.mesh;\n  }\n\n  private _tag: string = '';\n  public get tag(): string {\n    return this._tag;\n  }\n  public set tag(val: string) {\n    this._tag = val;\n  }\n\n  public get isActive(): boolean {\n    return this.isEmpty ? false : this.transform.transformNode!.isEnabled();\n  }\n\n  constructor(name?: string, mesh: Nullable<BABYLON.AbstractMesh> = null, node: Nullable<BABYLON.TransformNode> = null) {\n    if (mesh) {\n      this._transform = new Transform('', mesh);\n    } else {\n      if (node) {\n        this._transform = new Transform('', null, node);\n      } else if (name) {\n        this._transform = new Transform(name);\n      } else {\n        this._transform = new Transform();\n      }\n    }\n  }\n\n  // TODO\n  public static Find(name: string, scene?: BABYLON.Scene): Nullable<GameObject> {\n    if (!scene) {\n      scene = BabylonEngine.Scene;\n    }\n    let node: Nullable<BABYLON.Node> = scene.getNodeByName(name);\n    if (!node) {\n      return null;\n    } else {\n      if (node instanceof BABYLON.AbstractMesh) {\n        return new GameObject('', <BABYLON.AbstractMesh>node);\n      } else if (node instanceof BABYLON.TransformNode) {\n        return new GameObject('', null, <BABYLON.TransformNode>node);\n      } else {\n        console.error('GameObject.Find函数查找到不支持的类型：' + node.getClassName());\n        return null;\n      }\n    }\n  }\n\n\n\n  public static FindGameObjectWithTag(tag: string): void {\n\n  }\n\n  public static FindGameObjectsWithTag(tag: string): void {\n\n  }\n\n\n\n\n  // TODO\n  public static Destroy(obj: GameObject): void {\n    if (obj) {\n      obj.transform.destroy();\n    }\n  }\n\n\n  public static CreateInstance(game_object: GameObject): Nullable<GameObject> {\n    if (!game_object) {\n      return null;\n    }\n\n    if (game_object.isEmpty) {\n      return new GameObject();\n    } else {\n      if (game_object.transform.mesh) {\n        let tempMesh: BABYLON.AbstractMesh;\n        if (game_object.transform.mesh instanceof BABYLON.Mesh) {\n          tempMesh = (<BABYLON.Mesh>game_object.transform.mesh).createInstance(game_object.name + '_instance');\n        } else {\n          tempMesh = (<BABYLON.InstancedMesh>game_object.transform.mesh).sourceMesh.createInstance(game_object.name + '_instance');\n        }\n        return new GameObject('', tempMesh);\n      } else {\n        let newNode: Nullable<BABYLON.TransformNode> = game_object.transform.transformNode!.clone(game_object.name + '_intance');\n        return new GameObject('', null, newNode);\n      }\n    }\n  }\n\n\n  public addMesh(mesh: BABYLON.AbstractMesh): void {\n    // 删除空物体\n    if (this._transform.mesh === null && this._transform.transformNode) {\n      this._transform.transformNode.dispose();\n    }\n    this._transform.mesh = mesh;\n  }\n\n  public setActive(value: boolean): void {\n\n  }\n\n  public setActiveRecursively(value: boolean): void {\n\n  }\n\n  public static AddComponent(): void {\n\n  }\n\n\n\n\n  // public static empty(name: string): GameObject {\n\n  // }\n\n}","export * from './transform';\nexport * from './gameobject';\nexport * from './component';\nexport * from './resource-container';\nexport * from './very-camera';\nexport * from './very-light';","import { Tools, AjaxRequest, Ajax, GUID } from \"../../../editor/utility\";\nimport { Observer } from \"../../../lib\";\nimport { VeryEngine } from \"../../../engine\";\nimport { Config } from \"../../../editor/global\";\nimport { VeryLight } from \"../very-light\";\nimport { VeryCamera } from \"../very-camera\";\nimport { getJsonAsset, uploadJsonAsset, getJsonConfig, getUrl, upLoadJsonConfig } from \"../../../tools/ossfile\";\n\nexport class BabylonLoader {\n\n\n    public static prefix: string = '/assets/';\n\n    public static assetsData: any = {};\n    public static projectData: any = {};\n    public static scenesData: any = {};\n    public static sceneIndex: number = 0;\n\n\n    public static babylonCacheData: { [key: string]: any } = {};\n    public static babylonParsedData: { [key: string]: any } = {};\n\n\n    constructor() {\n\n    }\n\n    public static loadFromBabylonAsset() {\n\n    }\n\n\n    public static loadBabylon(asset: Observer) {\n        let assetID: string = asset.get('id');\n        let dataBabylon: any = null;\n        if (BabylonLoader.babylonCacheData[assetID]) {\n            console.log(BabylonLoader.babylonCacheData[assetID]);\n            dataBabylon = BabylonLoader.babylonCacheData[assetID];\n            BabylonLoader.parseBabylon(assetID, dataBabylon);\n            BabylonLoader.assembleBabylon(assetID, dataBabylon);\n        } else {\n\n            // 直接返回babylon json格式内容数据\n            getJsonAsset(Config.projectID, assetID, asset.get('name'), asset.get('file.hash')).then(response => {\n                var data = JSON.parse(response);\n                // console.log(data);\n                dataBabylon = data;\n                BabylonLoader.babylonCacheData[assetID] = dataBabylon;\n                BabylonLoader.parseBabylon(assetID, dataBabylon);\n                BabylonLoader.assembleBabylon(assetID, dataBabylon);\n            });\n        }\n    }\n\n\n    public static assembleBabylon = async (assetID: string, dataBabylon: any) => {\n        if (dataBabylon !== null) {\n            // console.warn(dataBabylon);\n            // console.log(dataBabylon.meshes);\n            // console.log(dataBabylon.materials);\n            // console.log(dataBabylon.lights);\n\n            // if (dataBabylon.lights) {\n            //     dataBabylon.lights.forEach((element: any) => {\n            //         BabylonLoader.loadLight(element, VeryEngine.viewScene);\n            //     });\n            // }\n\n            // material assemble\n            if (BabylonLoader.assetsData.babylon[assetID]) {\n                let mats = BabylonLoader.assetsData.babylon[assetID]['materials'];\n                for (let key in mats) {\n                    if (mats[key].asset_id && BabylonLoader.assetsData.assets[mats[key].asset_id]) {\n                        let newMat = BabylonLoader.assetsData.assets[mats[key].asset_id].data;\n                        await BabylonLoader.loadMaterial(newMat, VeryEngine.viewScene, '');\n                    }\n                }\n            }\n\n            // geometries assemble\n            if (dataBabylon.geometries && dataBabylon.geometries.vertexData) {\n                dataBabylon.geometries.vertexData.forEach((parsedVertexData: any) => {\n                    BabylonLoader.loadGeometry(parsedVertexData, VeryEngine.viewScene, '');\n                });\n            }\n\n            // transformNode assemble\n            let newTransformNodes: Nullable<BABYLON.TransformNode>[] = [];\n            if (dataBabylon.transformNodes) {\n                dataBabylon.transformNodes.forEach((parsedTransformNode: any) => {\n                    let node = BabylonLoader.loadTransformNode(parsedTransformNode, VeryEngine.viewScene, '');\n                    newTransformNodes.push(node);\n                });\n            }\n\n            // mesh assemble\n            let newMeshes: Nullable<BABYLON.AbstractMesh>[] = [];\n            let parentMeshes: Nullable<BABYLON.AbstractMesh>[] = [];\n\n            let tempMeshDic: { [key: string]: Nullable<BABYLON.AbstractMesh> } = {};\n\n            let tempMeshID: { [key: string]: string } = {};\n\n            if (dataBabylon.meshes) {\n                dataBabylon.meshes.forEach((element: any) => {\n                    // 若当前scene数据中已包含mesh id，则重新创建resource_id\n                    if (BabylonLoader.scenesData.entities[element.id]) {\n                        let newID = GUID.create();\n                        let oldID = element.id;\n                        // element['babylon_id'] = oldID;\n                        tempMeshID[newID] = oldID;\n                        element.id = newID;\n                        // 遍历，更改parentID\n                        dataBabylon.meshes.forEach((element2: any) => {\n                            if (element2.parentId === oldID) {\n                                element2.parentId = newID;\n                                // console.log('change parent id');\n                            }\n                        });\n                    } else {\n                        tempMeshID[element.id] = element.id;\n                        // element['babylon_id'] = element.id;\n                    }\n                    // console.error(element);\n                });\n\n                dataBabylon.meshes.forEach((element: any) => {\n                    let tempMesh = BabylonLoader.loadMesh(element, VeryEngine.viewScene, '');\n                    newMeshes.push(tempMesh);\n                    tempMeshDic[element.id] = tempMesh;\n                });\n            }\n\n            // parent \n            // TODO: 若不为root，则mesh这里也要设定父子关系，parent为null则为当前选中物体\n            let parent = null;\n            let parentNode: Nullable<BABYLON.Node> = null;\n            if (editor.call('selector:type') === 'entity')\n                parent = editor.call('selector:items')[0];\n\n            if (!parent) {\n                parent = editor.call('entities:root');\n            } else {\n                // console.warn(parent);\n                // console.warn(parent.node);\n                if (parent.node) {\n                    parentNode = parent.node;\n                }\n            }\n\n\n            var entities: any[] = [];\n            var data: any[] = [];\n\n            // TODO: 还没有考虑有transformNode数据的情况\n            for (let index = 0, cache = newTransformNodes.length; index < cache; index++) {\n                var transformNode = newTransformNodes[index];\n                if (transformNode && transformNode._waitingParentId) {\n                    transformNode.parent = VeryEngine.viewScene.getLastEntryByID(transformNode._waitingParentId);\n                    transformNode._waitingParentId = null;\n                }\n            }\n\n            for (let i = 0, len = newMeshes.length; i < len; i++) {\n                if (newMeshes[i] !== null) {\n                    if (newMeshes[i]!._waitingParentId) {\n                        if (tempMeshDic[newMeshes[i]!._waitingParentId!]) {\n                            newMeshes[i]!.parent = tempMeshDic[newMeshes[i]!._waitingParentId!];\n                        } else {\n                            newMeshes[i]!.parent = parentNode;\n                            parentMeshes.push(newMeshes[i]);\n                        }\n                    } else {\n                        newMeshes[i]!.parent = parentNode;\n                        parentMeshes.push(newMeshes[i]);\n                    }\n                    newMeshes[i]!._waitingParentId = null;\n                    // console.warn(newMeshes[i]);\n                }\n            }\n\n\n\n            for (let i = 0; i < parentMeshes.length; i++) {\n                BabylonLoader.meshParseRecursion(parentMeshes[i], assetID, tempMeshID, entities, data);\n            }\n\n            editor.call('selector:history', false);\n            editor.call('selector:set', 'entity', [editor.call('entities:get', parentMeshes[0]?.id)]);\n            editor.once('selector:change', function () {\n                editor.call('selector:history', true);\n            });\n\n            editor.call('make:scene:dirty');\n\n\n            // editor.emit('entities:load', true);\n\n\n            // TODO\n            // VeryEngine.viewScene.onPointerObservable.add(pointerInfo => {\n            //     switch (pointerInfo.type) {\n            //         case BABYLON.PointerEventTypes.POINTERDOWN:\n            //             // console.log('down');\n            //             if (pointerInfo!.pickInfo!.pickedMesh != null) {\n            //                 editor.call('pick', pointerInfo!.pickInfo!.pickedMesh);\n            //             } else {\n            //                 editor.call('pick', null);\n            //             }\n            //             // console.log(pointerInfo!.pickInfo!.pickedMesh);\n            //             break;\n            //     }\n            // });\n            // });\n        }\n    }\n\n    public static parseBabylon(assetID: string, babylonData: any): void {\n        if (babylonData) {\n            let parsedData: any = {};\n            // 材质\n            if (babylonData.materials) {\n                parsedData.materials = {};\n                babylonData.materials.forEach((material: any) => {\n                    parsedData.materials[material.id] = material;\n                });\n            }\n            // geometries\n            if (babylonData.geometries && babylonData.geometries.vertexData) {\n                parsedData.geometries = {};\n                babylonData.geometries.vertexData.forEach((geometry: any) => {\n                    parsedData.geometries[geometry.id] = geometry;\n                });\n            }\n            // mesh\n            if (babylonData.meshes) {\n                parsedData.meshes = {};\n                babylonData.meshes.forEach((mesh: any) => {\n                    parsedData.meshes[mesh.id] = mesh;\n                });\n            }\n            // transformNodes\n            if (babylonData.transformNodes) {\n                parsedData.transformNodes = {};\n                babylonData.transformNodes.forEach((transformNode: any) => {\n                    parsedData.transformNodes[transformNode.id] = transformNode;\n                });\n            }\n            BabylonLoader.babylonParsedData[assetID] = parsedData;\n        }\n    }\n\n    public static hasBabylobData(assetID: string): boolean {\n        return assetID in BabylonLoader.babylonCacheData;\n    }\n\n    public static getBabylonData(assetID: string): any {\n        if (assetID in BabylonLoader.babylonCacheData) {\n            return BabylonLoader.babylonCacheData[assetID];\n        } else {\n            return null;\n        }\n    }\n\n    public static hasParsedBabylonData(assetID: string): boolean {\n        return assetID in BabylonLoader.babylonParsedData;\n    }\n\n    public static getParsedBabylonData(assetID: string): any {\n        if (assetID in BabylonLoader.babylonParsedData) {\n            return BabylonLoader.babylonParsedData[assetID];\n        } else {\n            return null;\n        }\n    }\n\n\n    private static meshParseRecursion(mesh: Nullable<BABYLON.AbstractMesh>, assetID: string, tempMeshID: any, entities: any[], data: any[]): void {\n        if (mesh) {\n\n            let parentID: string = '';\n            if (mesh.parent !== null) {\n                parentID = mesh.parent!.id;\n            } else {\n                let root = editor.call('entities:root');\n                parentID = root.get('resource_id');\n                // root.insert('children', mesh.id);\n                // BabylonLoader.updateSceneData(parentID, root._data2);\n                // editor.call('make:scene:dirty');\n            }\n\n            var childs = mesh.getChildren();\n            var myChildren = [];\n            for (let k = 0; k < childs.length; k++) {\n                myChildren.push(childs[k].id);\n            }\n\n            let eulerAngle = Tools.radianToEulerAngle(mesh.rotation);\n\n            let entityData = {\n                name: mesh.name,\n                resource_id: mesh.id,\n                babylon_id: tempMeshID[mesh.id],  // 原始的mesh id\n                asset_id: assetID,  // 对应babylon资源id\n                parent: parentID,\n                position: [mesh.position.x, mesh.position.y, mesh.position.z],\n                rotation: [eulerAngle.x, eulerAngle.y, eulerAngle.z],\n                scale: [mesh.scaling.x, mesh.scaling.y, mesh.scaling.z],\n                children: myChildren,\n                enabled: mesh.isEnabled(),\n                checkCollisions: mesh.checkCollisions,\n                pickable: mesh.isPickable,\n                isVisible: mesh.isVisible,\n                tags: [],\n                type: 'mesh'\n            }\n\n            // editor模式下，isPickable必须为true\n            mesh.isPickable = true;\n\n            let entity = editor.call('entities:new', entityData);\n            entities.push(entity);\n            data.push(entity.origin);\n\n            for (let k = 0; k < childs.length; k++) {\n                BabylonLoader.meshParseRecursion(<BABYLON.AbstractMesh>childs[k], assetID, tempMeshID, entities, data);\n            }\n        }\n    }\n\n\n    public static addSceneData(resource_id: string, data: any): void {\n        BabylonLoader.scenesData.entities[resource_id] = data;\n        BabylonLoader.scenesData['modified'] = BabylonLoader.createdAtTime();\n    }\n\n    public static removeSceneData(resource_id: string): void {\n        delete BabylonLoader.scenesData.entities[resource_id];\n        BabylonLoader.scenesData['modified'] = BabylonLoader.createdAtTime();\n    }\n\n    public static updateSceneData(resource_id: string, data: any): void {\n        BabylonLoader.scenesData.entities[resource_id] = data;\n        BabylonLoader.scenesData['modified'] = BabylonLoader.createdAtTime();\n    }\n\n    public static changeSceneName(resource_id: string, name: string) {\n        BabylonLoader.scenesData.entities[resource_id].name = name;\n        BabylonLoader.scenesData['name'] = name;\n        BabylonLoader.scenesData['modified'] = BabylonLoader.createdAtTime();\n        editor.call('make:scene:dirty');\n    }\n\n    public static createdAtTime(): string {\n        var now = new Date();\n        var Y = now.getFullYear();\n        var m = BabylonLoader.getRealTime(now.getMonth() + 1);\n        var d = BabylonLoader.getRealTime(now.getDate());\n        var H = BabylonLoader.getRealTime(now.getHours());\n        var i = BabylonLoader.getRealTime(now.getMinutes());\n        // var s = getRealTime(now.getSeconds());\n        return Y + \"-\" + m + \"-\" + d + \" \" + H + \":\" + i;\n    }\n\n    private static getRealTime(str: number): string {\n        if (str < 10) {\n            return \"0\" + str;\n        }\n        return str.toString();\n    }\n\n    public static saveScene(): void {\n        if (Config.isSceneDirty) {\n\n            // var data = {\n            //     url: '/api/addScene',\n            //     method: 'POST',\n            //     // auth: true,\n            //     data: { sceneIndex: BabylonLoader.sceneIndex, scene: BabylonLoader.scenesData, projectID: Config.projectID },\n            //     ignoreContentType: true,\n            //     headers: {\n            //         Accept: 'application/json'\n            //     }\n            // };\n\n            // // 上传全部scene数据\n            // (<AjaxRequest>new Ajax(data))\n            //     .on('load', (status: any, data: any) => {\n            //         // console.log('status: ' + status);\n            //         console.log(data);\n            //         if (data.code === '0000') {\n            //             for (let i = 0, len = data.data.length; i < len; i++) {\n            //                 var asset = new Observer(data.data[i]);\n            //                 editor.call('assets:add', asset);\n            //             }\n            //         }\n            //     });\n\n            getJsonConfig(Config.projectID, 'scenes').then(function (data) {\n                var oldData = JSON.parse(data);\n                oldData.scenes[BabylonLoader.sceneIndex] = BabylonLoader.scenesData;\n                upLoadJsonConfig(JSON.stringify(oldData), Config.projectID, 'scenes');\n                editor.call('make:scene:clear');\n            })\n        }\n    }\n\n\n    public static loadLight(parsedLight: any, scene: BABYLON.Scene): Nullable<BABYLON.Light> {\n        // Light\n        if (parsedLight !== undefined && parsedLight !== null) {\n            var light = BABYLON.Light.Parse(parsedLight, scene);\n            return light;\n        }\n        return null;\n    }\n\n    public static loadReflectionProbe(parsedReflectionProbe: any, scene: BABYLON.Scene, rootUrl: string): Nullable<BABYLON.ReflectionProbe> {\n        // ReflectionProbe\n        if (parsedReflectionProbe !== undefined && parsedReflectionProbe !== null) {\n            var reflectionProbe = BABYLON.ReflectionProbe.Parse(parsedReflectionProbe, scene, rootUrl);\n            return reflectionProbe;\n        }\n        return null;\n    }\n\n    public static loadAnimation(parsedAnimation: any): Nullable<BABYLON.Animation[]> {\n        // Animation\n        if (parsedAnimation !== undefined && parsedAnimation !== null) {\n            const internalClass = BABYLON._TypeStore.GetClass(\"BABYLON.Animation\");\n            if (internalClass) {\n                let animation = internalClass.Parse(parsedAnimation);\n                return animation;\n            } else {\n                return null;\n            }\n        }\n        return null;\n    }\n\n    public static loadMaterial = async (newMat: any, scene: BABYLON.Scene, rootUrl: string) => {\n        // Material\n        return new Promise<Nullable<BABYLON.Material>>(async (resolve, reject) => {\n            if (newMat !== undefined && newMat !== null) {\n                let textureUrl = \"\";\n                if (newMat.diffuseTexture && newMat.diffuseTexture.texture_id) {\n                    let assetID = newMat.diffuseTexture.texture_id;\n                    textureUrl = await getUrl(Config.projectID, assetID, BabylonLoader.assetsData.assets[assetID].name, BabylonLoader.assetsData.assets[assetID].file.hash);\n                    newMat.diffuseTexture.name = textureUrl;\n                }\n                if (newMat.specularTexture && newMat.specularTexture.texture_id) {\n                    let assetID = newMat.specularTexture.texture_id;\n                    textureUrl = await getUrl(Config.projectID, assetID, BabylonLoader.assetsData.assets[assetID].name, BabylonLoader.assetsData.assets[assetID].file.hash)\n                    newMat.specularTexture.name = textureUrl;\n                }\n                if (newMat.reflectionTexture && newMat.reflectionTexture.texture_id) {\n                    let assetID = newMat.reflectionTexture.texture_id;\n                    textureUrl = await getUrl(Config.projectID, assetID, BabylonLoader.assetsData.assets[assetID].name, BabylonLoader.assetsData.assets[assetID].file.hash)\n                    newMat.reflectionTexture.name = textureUrl;\n                }\n                if (newMat.refractionTexture && newMat.refractionTexture.texture_id) {\n                    let assetID = newMat.refractionTexture.texture_id;\n                    textureUrl = await getUrl(Config.projectID, assetID, BabylonLoader.assetsData.assets[assetID].name, BabylonLoader.assetsData.assets[assetID].file.hash)\n                    newMat.refractionTexture.name = textureUrl;\n                }\n                if (newMat.emissiveTexture && newMat.emissiveTexture.texture_id) {\n                    let assetID = newMat.emissiveTexture.texture_id;\n                    textureUrl = await getUrl(Config.projectID, assetID, BabylonLoader.assetsData.assets[assetID].name, BabylonLoader.assetsData.assets[assetID].file.hash)\n                    newMat.emissiveTexture.name = textureUrl;\n                }\n                if (newMat.bumpTexture && newMat.bumpTexture.texture_id) {\n                    let assetID = newMat.bumpTexture.texture_id;\n                    textureUrl = await getUrl(Config.projectID, assetID, BabylonLoader.assetsData.assets[assetID].name, BabylonLoader.assetsData.assets[assetID].file.hash)\n                    newMat.bumpTexture.name = textureUrl;\n                }\n                if (newMat.opacityTexture && newMat.opacityTexture.texture_id) {\n                    let assetID = newMat.opacityTexture.texture_id;\n                    textureUrl = await getUrl(Config.projectID, assetID, BabylonLoader.assetsData.assets[assetID].name, BabylonLoader.assetsData.assets[assetID].file.hash)\n                    newMat.opacityTexture.name = textureUrl;\n                }\n                if (newMat.ambientTexture && newMat.ambientTexture.texture_id) {\n                    let assetID = newMat.ambientTexture.texture_id;\n                    textureUrl = await getUrl(Config.projectID, assetID, BabylonLoader.assetsData.assets[assetID].name, BabylonLoader.assetsData.assets[assetID].file.hash)\n                    newMat.ambientTexture.name = textureUrl;\n                }\n                if (newMat.lightmapTexture && newMat.lightmapTexture.texture_id) {\n                    let assetID = newMat.lightmapTexture.texture_id;\n                    textureUrl = await getUrl(Config.projectID, assetID, BabylonLoader.assetsData.assets[assetID].name, BabylonLoader.assetsData.assets[assetID].file.hash)\n                    newMat.lightmapTexture.name = textureUrl;\n                }\n                var mat = BABYLON.Material.Parse(newMat, scene, rootUrl);\n                resolve(mat);\n            }\n            resolve(null);\n        })\n\n    }\n\n    public static loadMultiMaterial(parsedMultiMaterial: any, scene: BABYLON.Scene): Nullable<BABYLON.MultiMaterial> {\n        // MultiMaterial\n        if (parsedMultiMaterial !== undefined && parsedMultiMaterial !== null) {\n            var mmat = BABYLON.MultiMaterial.ParseMultiMaterial(parsedMultiMaterial, scene);\n            return mmat;\n        }\n        return null;\n    }\n\n    public static loadMorphTargetManager(managerData: any, scene: BABYLON.Scene): Nullable<BABYLON.MorphTargetManager> {\n        // MorphTargetManager\n        if (managerData !== undefined && managerData !== null) {\n            var morphTarget = BABYLON.MorphTargetManager.Parse(managerData, scene);\n            return morphTarget;\n        }\n        return null;\n    }\n\n    public static loadSkeleton(parsedSkeleton: any, scene: BABYLON.Scene): Nullable<BABYLON.Skeleton> {\n        // Skeleton\n        if (parsedSkeleton !== undefined && parsedSkeleton !== null) {\n            var skeleton = BABYLON.Skeleton.Parse(parsedSkeleton, scene);\n            return skeleton;\n        }\n        return null;\n    }\n\n    public static loadGeometry(vertexData: any, scene: BABYLON.Scene, rootUrl: string): Nullable<BABYLON.Geometry> {\n        // Geometry\n        if (vertexData !== undefined && vertexData !== null) {\n            var geometry = BABYLON.Geometry.Parse(vertexData, scene, rootUrl);\n            return geometry;\n        }\n        return null;\n    }\n\n    public static loadTransformNode(parsedTransformNode: any, scene: BABYLON.Scene, rootUrl: string): Nullable<BABYLON.TransformNode> {\n        // TransformNode\n        if (parsedTransformNode !== undefined && parsedTransformNode !== null) {\n            var node = BABYLON.TransformNode.Parse(parsedTransformNode, scene, rootUrl);\n            return node;\n        }\n        return null;\n    }\n\n\n    public static loadMesh(parsedMesh: any, scene: BABYLON.Scene, rootUrl: string): Nullable<BABYLON.AbstractMesh> {\n        // Mesh\n        if (parsedMesh !== undefined && parsedMesh !== null) {\n            var mesh = <BABYLON.AbstractMesh>BABYLON.Mesh.Parse(parsedMesh, scene, rootUrl);\n            return mesh;\n        }\n        return null;\n    }\n\n\n    public static loadCamera(parsedCamera: any, scene: BABYLON.Scene): Nullable<BABYLON.Camera> {\n        // Camera\n        if (parsedCamera !== undefined && parsedCamera !== null) {\n            var camera = BABYLON.Camera.Parse(parsedCamera, scene);\n            return camera;\n        }\n        return null;\n    }\n\n    public static loadAnimationGroup(parsedAnimationGroup: any, scene: BABYLON.Scene): Nullable<BABYLON.AnimationGroup> {\n        // AnimationGroup\n        if (parsedAnimationGroup !== undefined && parsedAnimationGroup !== null) {\n            var animationGroup = BABYLON.AnimationGroup.Parse(parsedAnimationGroup, scene);\n            return animationGroup;\n        }\n        return null;\n    }\n\n\n    public static setBabylonParent(scene: BABYLON.Scene): void {\n        let index, cache = 0;\n        // Browsing all the graph to connect the dots\n        for (let index = 0, cache = scene.cameras.length; index < cache; index++) {\n            var camera = scene.cameras[index];\n            if (camera._waitingParentId) {\n                camera.parent = scene.getLastEntryByID(camera._waitingParentId);\n                camera._waitingParentId = null;\n            }\n        }\n\n        for (index = 0, cache = scene.lights.length; index < cache; index++) {\n            let light = scene.lights[index];\n            if (light && light._waitingParentId) {\n                light.parent = scene.getLastEntryByID(light._waitingParentId);\n                light._waitingParentId = null;\n            }\n        }\n\n        //加载完所有资源以后，设立父子关系，加入在自己的引擎中，这些关系有scene数据确立，可以取消此处的操作\n        // Connect parents & children and parse actions\n        for (index = 0, cache = scene.transformNodes.length; index < cache; index++) {\n            var transformNode = scene.transformNodes[index];\n            if (transformNode._waitingParentId) {\n                transformNode.parent = scene.getLastEntryByID(transformNode._waitingParentId);\n                transformNode._waitingParentId = null;\n            }\n        }\n        for (index = 0, cache = scene.meshes.length; index < cache; index++) {\n            var mesh = scene.meshes[index];\n            if (mesh._waitingParentId) {\n                mesh.parent = scene.getLastEntryByID(mesh._waitingParentId);\n                mesh._waitingParentId = null;\n            }\n        }\n\n        // freeze world matrix application\n        // 此部分为babylon隐藏方法\n        // for (index = 0, cache = scene.meshes.length; index < cache; index++) {\n        //     var currentMesh = scene.meshes[index];\n        //     if (currentMesh._waitingFreezeWorldMatrix) {\n        //         currentMesh.freezeWorldMatrix();\n        //         currentMesh._waitingFreezeWorldMatrix = null;\n        //     } else {\n        //         currentMesh.computeWorldMatrix(true);\n        //     }\n        // }\n    }\n\n\n    // hierarchy创建灯光，直接创建wraper\n\n    public static createCameraWraper(name: string, scene: BABYLON.Scene, canvas: HTMLCanvasElement): VeryCamera {\n        var camera = new BABYLON.UniversalCamera(name, new BABYLON.Vector3(0, 100, -200), scene);\n        // camera.mode = BABYLON.Camera.ORTHOGRAPHIC_CAMERA;\n        // camera.minZ = -800;\n        camera.maxZ = 20000;\n\n        let cameraWraper = new VeryCamera(camera, scene, canvas);\n\n        cameraWraper.orthoSize = 0.5;\n\n        return cameraWraper;\n    }\n\n\n    public static createLightWraper(type: string, name: string, scene: BABYLON.Scene): VeryLight {\n        let light = BabylonLoader.createLight(type, name, scene);\n\n        let lightWraper = new VeryLight(light, scene);\n\n        return lightWraper;\n    }\n\n\n\n    public static createLight(type: string, name: string, scene: BABYLON.Scene): BABYLON.Light {\n        let light: BABYLON.Light;\n\n        type = type.toLowerCase();\n        if (type === 'point') {\n            light = new BABYLON.PointLight(name, BABYLON.Vector3.Zero(), scene);\n        } else if (type === 'spot') {\n            light = new BABYLON.SpotLight(name, BABYLON.Vector3.Zero(), new BABYLON.Vector3(0, -1, 0), Math.PI * 0.75, 8, scene);\n        } else if (type === 'hemispheric') {\n            light = new BABYLON.HemisphericLight(name, BABYLON.Vector3.Up(), scene);\n        } else {\n            light = new BABYLON.DirectionalLight(name, BABYLON.Vector3.Forward(), scene);\n        }\n\n        return light;\n    }\n\n    public static createPrimitive(type: string, name: string, scene: BABYLON.Scene): BABYLON.TransformNode {\n        let primitive: BABYLON.TransformNode;\n        if (type === 'box') {\n            primitive = BABYLON.MeshBuilder.CreateBox(name, {}, scene);\n        } else if (type === 'sphere') {\n            primitive = BABYLON.MeshBuilder.CreateSphere(name, {}, scene);\n        } else if (type === 'plane') {\n            primitive = BABYLON.MeshBuilder.CreateGround(name, {}, scene);\n        }\n        else if (type === 'cylinder') {\n            primitive = BABYLON.MeshBuilder.CreateCylinder(name, {}, scene);\n        }\n        // else if (type === 'capsule') {\n        //     primitive = BABYLON.MeshBuilder(name, {}, scene);\n        // } \n        else {\n            primitive = new BABYLON.TransformNode(name, scene);\n        }\n        return primitive;\n    }\n\n\n    public static load(rootUrl: string, sceneFilename: string | File = \"\", scene: BABYLON.Scene): any {\n\n        // // Browsing all the graph to connect the dots\n        // for (index = 0, cache = scene.cameras.length; index < cache; index++) {\n        //     var camera = scene.cameras[index];\n        //     if (camera._waitingParentId) {\n        //         camera.parent = scene.getLastEntryByID(camera._waitingParentId);\n        //         camera._waitingParentId = null;\n        //     }\n        // }\n\n        // for (index = 0, cache = scene.lights.length; index < cache; index++) {\n        //     let light = scene.lights[index];\n        //     if (light && light._waitingParentId) {\n        //         light.parent = scene.getLastEntryByID(light._waitingParentId);\n        //         light._waitingParentId = null;\n        //     }\n        // }\n\n        // //加载完所有资源以后，设立父子关系，加入在自己的引擎中，这些关系有scene数据确立，可以取消此处的操作\n        // // Connect parents & children and parse actions\n        // for (index = 0, cache = scene.transformNodes.length; index < cache; index++) {\n        //     var transformNode = scene.transformNodes[index];\n        //     if (transformNode._waitingParentId) {\n        //         transformNode.parent = scene.getLastEntryByID(transformNode._waitingParentId);\n        //         transformNode._waitingParentId = null;\n        //     }\n        // }\n        // for (index = 0, cache = scene.meshes.length; index < cache; index++) {\n        //     var mesh = scene.meshes[index];\n        //     if (mesh._waitingParentId) {\n        //         mesh.parent = scene.getLastEntryByID(mesh._waitingParentId);\n        //         mesh._waitingParentId = null;\n        //     }\n        // }\n\n        // // freeze world matrix application\n        // for (index = 0, cache = scene.meshes.length; index < cache; index++) {\n        //     var currentMesh = scene.meshes[index];\n        //     if (currentMesh._waitingFreezeWorldMatrix) {\n        //         currentMesh.freezeWorldMatrix();\n        //         currentMesh._waitingFreezeWorldMatrix = null;\n        //     } else {\n        //         currentMesh.computeWorldMatrix(true);\n        //     }\n        // }\n\n        // // Lights exclusions / inclusions\n        // for (index = 0, cache = scene.lights.length; index < cache; index++) {\n        //     let light = scene.lights[index];\n        //     // Excluded check\n        //     if (light._excludedMeshesIds.length > 0) {\n        //         for (var excludedIndex = 0; excludedIndex < light._excludedMeshesIds.length; excludedIndex++) {\n        //             var excludedMesh = scene.getMeshByID(light._excludedMeshesIds[excludedIndex]);\n\n        //             if (excludedMesh) {\n        //                 light.excludedMeshes.push(excludedMesh);\n        //             }\n        //         }\n\n        //         light._excludedMeshesIds = [];\n        //     }\n\n        //     // Included check\n        //     if (light._includedOnlyMeshesIds.length > 0) {\n        //         for (var includedOnlyIndex = 0; includedOnlyIndex < light._includedOnlyMeshesIds.length; includedOnlyIndex++) {\n        //             var includedOnlyMesh = scene.getMeshByID(light._includedOnlyMeshesIds[includedOnlyIndex]);\n\n        //             if (includedOnlyMesh) {\n        //                 light.includedOnlyMeshes.push(includedOnlyMesh);\n        //             }\n        //         }\n\n        //         light._includedOnlyMeshesIds = [];\n        //     }\n        // }\n\n\n    }\n\n\n\n\n    private static _getFileInfo(rootUrl: string, sceneFilename: string | File): Nullable<IFileInformation> {\n        let url: string;\n        let name: string;\n        let file: Nullable<File> = null;\n\n        if (!sceneFilename) {\n            url = rootUrl;\n            name = Tools.GetFilename(rootUrl);\n            rootUrl = Tools.GetFolderPath(rootUrl);\n        }\n        else if ((sceneFilename as File).name) {\n            const sceneFile = sceneFilename as File;\n            url = rootUrl + sceneFile.name;\n            name = sceneFile.name;\n            file = sceneFile;\n        }\n        else {\n            const filename = sceneFilename as string;\n            if (filename.substr(0, 1) === \"/\") {\n                Tools.Error(\"Wrong sceneFilename parameter\");\n                return null;\n            }\n\n            url = rootUrl + filename;\n            name = filename;\n        }\n\n        return {\n            url: url,\n            rootUrl: rootUrl,\n            name: name,\n            file: file\n        };\n    }\n\n\n}\n\n\ninterface IFileInformation {\n    /**\n     * Gets the file url\n     */\n    url: string;\n    /**\n     * Gets the root url\n     */\n    rootUrl: string;\n    /**\n     * Gets filename\n     */\n    name: string;\n    /**\n     * Gets the file\n     */\n    file: Nullable<File>;\n}","import { GameObject } from \"./gameobject\";\n\nexport class ResourceContainer {\n\n    public gameObjects: GameObject[] = [];\n\n\n    public constructor() {\n\n    }\n\n\n    public addGameObject(object: GameObject): void {\n        this.gameObjects.push();\n        \n    }\n\n}","export class Transform {\n\n  // public get gameObject(): GameObject {\n  //   return this._gameObject;\n  // }\n  // private _gameObject: GameObject;\n\n  private _transformNode: BABYLON.Nullable<BABYLON.TransformNode> = null;\n  private _mesh: BABYLON.Nullable<BABYLON.AbstractMesh> = null;\n\n  public get transformNode(): Nullable<BABYLON.TransformNode> {\n    if (this._mesh) {\n      return this._mesh;\n    } else if (this._transformNode) {\n      return this._transformNode;\n    } else {\n      return null;\n    }\n  }\n\n  public get mesh(): Nullable<BABYLON.AbstractMesh> {\n    return this._mesh;\n  }\n  public set mesh(val: Nullable<BABYLON.AbstractMesh>) {\n    this._mesh = val;\n  }\n\n  public get isMesh(): boolean {\n    if (this._mesh) {\n      return true;\n    } else {\n      return false;\n    }\n  }\n\n  public get isEmpty(): boolean {\n    if (this._transformNode || this._mesh) {\n      return false;\n    } else {\n      return true;\n    }\n  }\n\n  // public get parent(): Nullable<BABYLON.TransformNode>\n\n  public get name(): string {\n    return this._name;\n  }\n  public set name(val: string) {\n    if (this._transformNode) {\n      this._transformNode.name = val;\n    }\n    if (this._mesh) {\n      this._mesh.name = val;\n    }\n    this._name = val;\n  }\n  private _name: string = '';\n\n  private _tempVec: BABYLON.Vector3 = BABYLON.Vector3.Zero();\n\n  public get parent(): Nullable<Transform> {\n    return this._parent;\n  }\n  private _parent: Nullable<Transform> = null;\n\n  public set parent(val: Nullable<Transform>) {\n    if (!this.isEmpty) {\n      if (val && !val.isEmpty) {\n        this._transformNode!.setParent(val.transformNode);\n        this._parent = val;\n      } else {\n        this._transformNode!.setParent(null);\n        this._parent = null;\n      }\n    }\n  }\n\n  /**\n   * 获取相对坐标\n   */\n  public get localPosition(): BABYLON.Vector3 {\n    if (this.isEmpty) {\n      return BABYLON.Vector3.Zero();\n    } else {\n      this._tempVec.copyFrom(this.transformNode!.position);\n      return this._tempVec;\n    }\n  }\n\n  /**\n   * 设置相对坐标\n   */\n  public set localPosition(val: BABYLON.Vector3) {\n    if (!this.isEmpty) {\n      this.transformNode!.position = val;\n    }\n  }\n\n  /**\n   * 获取绝对坐标\n   */\n  public get position(): BABYLON.Vector3 {\n    if (this.isEmpty) {\n      return BABYLON.Vector3.Zero();\n    } else {\n      this._tempVec.copyFrom(this.transformNode!.getAbsolutePosition());\n      return this._tempVec;\n    }\n  }\n\n  /**\n   * 设置绝对坐标\n   */\n  public set position(val: BABYLON.Vector3) {\n    if (!this.isEmpty) {\n      this.transformNode!.setAbsolutePosition(val);\n    }\n  }\n\n  /**\n   * 获取相对欧拉角度\n   */\n  public get localEulerAngles(): BABYLON.Vector3 {\n    if (this.isEmpty) {\n      return BABYLON.Vector3.Zero();\n    } else {\n      let para: number = 180 / Math.PI;\n      return this.transformNode!.rotation.multiplyByFloats(para, para, para);\n    }\n  }\n\n  /**\n   * 设置相对欧拉角度\n   */\n  public set localEulerAngles(val: BABYLON.Vector3) {\n    if (!this.isEmpty) {\n      let para: number = Math.PI / 180;\n      this.transformNode!.rotation = val.multiplyByFloats(para, para, para);\n    }\n  }\n\n  /**\n   * 获取相对角度（弧度）\n   */\n  public get localRotation(): BABYLON.Vector3 {\n    if (this.isEmpty) {\n      return BABYLON.Vector3.Zero();\n    } else {\n      this._tempVec.copyFrom(this.transformNode!.rotation);\n      return this._tempVec;\n    }\n  }\n\n  /**\n   * 设置相对角度（弧度）\n   */\n  public set localRotation(val: BABYLON.Vector3) {\n    if (!this.isEmpty) {\n      this.transformNode!.rotation = val;\n    }\n  }\n\n  /**\n   * 获取绝对欧拉角度\n   */\n  public get eulerAngles(): BABYLON.Vector3 {\n    if (this.isEmpty) {\n      return BABYLON.Vector3.Zero();\n    } else {\n      let parent: Nullable<BABYLON.Node> = this.transformNode!.parent;\n      let para: number = 180 / Math.PI;\n      this.transformNode!.setParent(null);\n      let result: BABYLON.Vector3 = this.transformNode!.rotation.multiplyByFloats(para, para, para);\n      this.transformNode!.setParent(parent);\n      return result;\n    }\n  }\n\n  /**\n   * 设置绝对欧拉角度\n   */\n  public set eulerAngles(val: BABYLON.Vector3) {\n    if (!this.isEmpty) {\n      let parent: Nullable<BABYLON.Node> = this.transformNode!.parent;\n      let para: number = Math.PI / 180;\n      this.transformNode!.setParent(null);\n      this.transformNode!.rotation = val.multiplyByFloats(para, para, para);\n      this.transformNode!.setParent(parent);\n\n    }\n  }\n\n  /**\n   * 获取绝对角度（弧度）\n   */\n  public get rotation(): BABYLON.Vector3 {\n    if (this.isEmpty) {\n      return BABYLON.Vector3.Zero();\n    } else {\n      let parent: Nullable<BABYLON.Node> = this.transformNode!.parent;\n      this.transformNode!.setParent(null);\n      this._tempVec.copyFrom(this.transformNode!.rotation);\n      this.transformNode!.setParent(parent);\n      return this._tempVec;\n    }\n  }\n\n  /**\n   * 设置绝对角度（弧度）\n   */\n  public set rotation(val: BABYLON.Vector3) {\n    if (!this.isEmpty) {\n      let parent: Nullable<BABYLON.Node> = this.transformNode!.parent;\n      this.transformNode!.setParent(null);\n      this.transformNode!.rotation = val;\n      this.transformNode!.setParent(parent);\n    }\n  }\n\n\n  // TO be contioued\n\n  public get children(): BABYLON.Node[] {\n      return this.transformNode!.getChildren();\n  }\n\n  public get childCount(): number {\n    return 0;\n  }\n\n  public forward: BABYLON.Vector3 = BABYLON.Vector3.Forward();\n\n\n  public get hierarchyCount(): number {\n    return 0;\n  }\n\n  public localScale: BABYLON.Vector3 = new BABYLON.Vector3(1, 1, 1);\n\n\n  /**\n   * BabylonJS Mesh和TransformNode包装类，仿照UnityEngine数据结构；\n   * @param name 物体名，默认为“空物体”；\n   * @param mesh BabylonJS Mesh;\n   * @param node BabylonJS TransformNode;\n   */\n  constructor(name: string = '空物体', mesh: Nullable<BABYLON.AbstractMesh> = null, node: Nullable<BABYLON.TransformNode> = null) {\n    if (mesh) {\n      this._mesh = mesh;\n      this._transformNode = mesh;\n      this._name = mesh.name;\n    } else {\n      if (node) {\n        this._mesh = null;\n        this._transformNode = node;\n        this._name = node.name;\n      } else {\n        // if (!name) name = '空物体';\n        this._mesh = null;\n        this._transformNode = new BABYLON.TransformNode(name);\n        this._name = name;\n      }\n    }\n\n    // 设置父物体\n    if (this._transformNode) {\n      let tempParent: Nullable<BABYLON.Node> = this._transformNode.parent;\n      if (tempParent) {\n        if (tempParent instanceof BABYLON.AbstractMesh) {\n          this._parent = new Transform(tempParent.name, <BABYLON.AbstractMesh>tempParent);\n        } else {\n          this._parent = new Transform(tempParent.name, null, <BABYLON.TransformNode>tempParent);\n        }\n      }\n    } else {\n      this._parent = null;\n    }\n  }\n\n  /**\n   * 沿世界或局部坐标系平移；\n   * @param translation 平移方向向量；\n   * @param relativeTo 平移参考系，LOCAL为局部坐标，WORLD为世界坐标；\n   */\n  public translate(translation: BABYLON.Vector3, relativeTo: BABYLON.Space): void {\n    if (this.transformNode) {\n      this.transformNode.translate(translation, 1, relativeTo);\n    }\n  }\n\n  /**\n   * 沿着某个参考物体的局部方向向量平移，参考物体为null时，则沿世界坐标移动；\n   * @param translation 参考物体的局部方向向量；\n   * @param trans 平移参考物体；\n   */\n  public translateRelativeTo(translation: BABYLON.Vector3, trans: Transform): void {\n    if (this.transformNode) {\n      let direction: BABYLON.Vector3 = translation.clone();\n      if (trans && trans.transformNode) {\n        direction = this.transformDirection(direction);\n      }\n      this.transformNode.translate(direction, 1, BABYLON.Space.WORLD);\n    }\n  }\n\n  /**\n   * 沿某个轴自转，可选择相对世界坐标或自身坐标；\n   * @param eulerAngles 自转运动向量；\n   * @param relativeTo 自转参考系；\n   */\n  public rotate(eulerAngles: BABYLON.Vector3, relativeTo: BABYLON.Space): void {\n    if (this.transformNode) {\n      let axis: BABYLON.Vector3 = BABYLON.Vector3.Zero().copyFrom(eulerAngles.normalize());\n      let angle: number = eulerAngles.length();\n      this.transformNode.rotate(axis, angle, relativeTo);\n    }\n  }\n\n  /**\n   * 沿世界坐标某个轴公转；\n   * @param point 旋转点；\n   * @param axis 旋转轴；\n   * @param speed 旋转速度；\n   */\n  public rotateAround(point: BABYLON.Vector3, axis: BABYLON.Vector3, speed: number): void {\n    if (this.transformNode) {\n      this.transformNode.rotateAround(point, axis, speed);\n    }\n  }\n\n\n\n\n  /**\n   * 局部坐标位置转世界坐标位置；\n   * @param local_position 局部坐标位置；\n   * 返回新Vector3向量；\n   */\n  public transformPosition(local_position: BABYLON.Vector3): BABYLON.Vector3 {\n    if (this.transformNode) {\n      let matrix: BABYLON.Matrix = this.transformNode.computeWorldMatrix();\n      return BABYLON.Vector3.TransformCoordinates(local_position, matrix);\n    } else {\n      return local_position;\n    }\n  }\n\n  /**\n   * 局部方向向量转世界方向向量，转换后保持向量长度相等；\n   * @param local_direction 局部方向向量；\n   * 返回新Vector3向量；\n   */\n  public transformDirection(local_direction: BABYLON.Vector3): BABYLON.Vector3 {\n    if (this.transformNode) {\n      let matrix: BABYLON.Matrix = this.transformNode.computeWorldMatrix();\n      return BABYLON.Vector3.TransformCoordinates(local_direction, matrix).subtract(this.transformNode.getAbsolutePosition());\n    } else {\n      return local_direction;\n    }\n  }\n\n  /**\n   * 世界坐标位置转局部坐标位置；\n   * @param global_position 世界坐标位置；\n   * 返回新Vector3向量；\n   */\n  public inverseTransformPosition(global_position: BABYLON.Vector3): BABYLON.Vector3 {\n    if (this.transformNode) {\n      let matrix: BABYLON.Matrix = BABYLON.Matrix.Invert(this.transformNode.computeWorldMatrix());\n      return BABYLON.Vector3.TransformCoordinates(global_position, matrix);\n    } else {\n      return global_position;\n    }\n  }\n\n  /**\n   * 世界方向向量转局部方向向量，转换后保持向量长度相等；\n   * @param global_direction 世界方向向量；\n   * 返回新Vector3向量；\n   */\n  public inverseTransformDirection(global_direction: BABYLON.Vector3): BABYLON.Vector3 {\n    if (this.transformNode) {\n      let matrix: BABYLON.Matrix = BABYLON.Matrix.Invert(this.transformNode.computeWorldMatrix());\n      let pointA: BABYLON.Vector3 = BABYLON.Vector3.TransformCoordinates(global_direction, matrix);\n      let pointOrigin: BABYLON.Vector3 = BABYLON.Vector3.TransformCoordinates(BABYLON.Vector3.Zero(), matrix);\n      return pointA.subtract(pointOrigin);\n    } else {\n      return global_direction;\n    }\n  }\n\n\n  public destroy(): void {\n    if (this.mesh) this.mesh.dispose();\n    if (this.transformNode) this.transformNode.dispose();\n  }\n\n\n  // TODO\n\n  public lookAt(target: Transform, worldUp: BABYLON.Vector3 = BABYLON.Vector3.Up()): void {\n\n  }\n\n  public setParent(parent: Nullable<Transform>): void {\n\n  }\n\n  public detachChildren(): void {\n\n  }\n\n  public findChild(name: string): void {\n\n\n  }\n\n  public isChildOf(name: string): boolean {\n    return true;\n  }\n\n  public getChild(index: number): void {\n\n  }\n\n\n}","import { VeryEngine } from \"../../engine\";\nimport { Config } from \"../global\";\nimport { Tools } from \"../utility\";\nimport { Viewport } from \"../viewport\";\n\n\nexport class VeryCamera extends BABYLON.TransformNode {\n\n    private _canvas: HTMLCanvasElement;\n    private _width: number;\n    private _height: number;\n\n    public get mode(): number {\n        return this.camera.mode;\n    }\n    public set mode(val: number) {\n        this.camera.mode = val;\n        if (val === BABYLON.Camera.ORTHOGRAPHIC_CAMERA) {\n            this.orthoSize = this._orthoSize;\n        }\n    }\n\n    public get fov(): number {\n        return this.camera.fov;\n    }\n    public set fov(val: number) {\n        // this.camera.fov = Tools.eulerAngleFloatToRadian(val);\n        this.camera.fov = val;\n    }\n\n    public get inertia(): number {\n        return this.camera.inertia;\n    }\n    public set inertia(val: number) {\n        this.camera.inertia = val;\n    }\n\n    private _orthoSize: number = 0;\n    public get orthoSize(): number {\n        if (this.camera.mode === BABYLON.Camera.ORTHOGRAPHIC_CAMERA) {\n            this._orthoSize = this.camera!.orthoRight! / this._scene.getEngine().getRenderWidth() / this.camera.viewport.width;\n            return this._orthoSize;\n        } else {\n            return 0;\n        }\n    }\n    public set orthoSize(val: number) {\n        this._orthoSize = val;\n        if (this.camera.mode === BABYLON.Camera.ORTHOGRAPHIC_CAMERA) {\n            this.camera.orthoRight = val * this._scene.getEngine().getRenderWidth() * this.camera.viewport.width;\n            this.camera.orthoLeft = -val * this._scene.getEngine().getRenderWidth() * this.camera.viewport.width;\n            this.camera.orthoTop = val * this._scene.getEngine().getRenderHeight() * this.camera.viewport.height;\n            this.camera.orthoBottom = -val * this._scene.getEngine().getRenderHeight() * this.camera.viewport.height;\n        }\n    }\n\n    private _clearColor: Nullable<BABYLON.Color4> = null;\n    public get clearColor(): Nullable<BABYLON.Color4> {\n        return this._clearColor;\n    }\n    public set clearColor(val: Nullable<BABYLON.Color4>) {\n        this._clearColor = val;\n    }\n\n    public get minZ(): number {\n        return this.camera.minZ;\n    }\n    public set minZ(val: number) {\n        this.camera.minZ = val;\n    }\n\n    public get maxZ(): number {\n        return this.camera.minZ;\n    }\n    public set maxZ(val: number) {\n        this.camera.maxZ = val;\n    }\n\n    public get checkCollisions(): boolean {\n        return (<BABYLON.FreeCamera>this.camera).checkCollisions;\n    }\n    public set checkCollisions(val: boolean) {\n        (<BABYLON.FreeCamera>this.camera).checkCollisions = val;\n    }\n\n    public get applyGravity(): boolean {\n        return (<BABYLON.FreeCamera>this.camera).applyGravity;\n    }\n    public set applyGravity(val: boolean) {\n        (<BABYLON.FreeCamera>this.camera).applyGravity = val;\n    }\n    \n\n    public camera: BABYLON.TargetCamera;\n\n    // public get mode()\n\n    public constructor(camera: BABYLON.TargetCamera, scene: BABYLON.Scene, canvas: HTMLCanvasElement) {\n        super(camera.name, scene);\n        this.camera = camera;\n        camera.name += '-Camera';\n        this._canvas = canvas;\n        this._width = canvas.width;\n        this._height = canvas.height;\n        this.position.copyFrom(camera.position);\n        this.rotation.copyFrom(camera.rotation);\n        camera.parent = this;\n        camera.position = BABYLON.Vector3.Zero();\n        camera.rotation = BABYLON.Vector3.Zero();\n        camera.inputs.clear();\n\n\n    }\n\n    private _backupViewport: BABYLON.Viewport = new BABYLON.Viewport(0, 0, 1, 1);\n    private _render: boolean = true;\n    public renderCamera(render: boolean): void {\n        if (this._render === render) return;\n        this._render = render;\n        if (render) {\n            this.camera.viewport = this._backupViewport.clone();\n        } else {\n            this._backupViewport = this.camera.viewport.clone();\n            this.camera.viewport = new BABYLON.Viewport(0, 0, 0, 0);\n        }\n    }\n\n    // orthographic相机在窗口resize后需要刷新；\n    public resize(editor?: boolean): void {\n        if (this.camera && this._canvas) {\n            if (this._canvas.width !== this._width || this._canvas.height !== this._height) {\n\n                this._width = this._canvas.width;\n                this._height = this._canvas.height;\n\n                let w = this._scene.getEngine().getRenderWidth();\n                let h = this._scene.getEngine().getRenderHeight();\n\n                if (editor) {\n                    if (this !== VeryEngine.viewCamera) {\n                        if (this._render) {\n                            this.camera.viewport = new BABYLON.Viewport(Config.x / w, (h - Config.y) / h, Config.width / w, Config.height / h);\n                        } else {\n                            this._backupViewport = new BABYLON.Viewport(Config.x / w, (h - Config.y) / h, Config.width / w, Config.height / h);\n                        }\n                        // console.warn(this.camera.viewport);\n                    }\n                }\n\n                if (this.camera.mode === BABYLON.Camera.ORTHOGRAPHIC_CAMERA) {\n                    this.camera.orthoRight = this._orthoSize * w * this.camera.viewport.width;\n                    this.camera.orthoLeft = -this._orthoSize * w * this.camera.viewport.width;\n                    this.camera.orthoTop = this._orthoSize * h * this.camera.viewport.height;\n                    this.camera.orthoBottom = -this._orthoSize * h * this.camera.viewport.height;\n                } else {\n\n                }\n\n                // console.log('设置ortho参数: ' + this._orthoSize);\n                // console.warn(this.camera.viewport);\n            }\n\n        }\n    }\n\n}","export class VeryLight extends BABYLON.TransformNode {\n\n\n    public light: BABYLON.Light;\n\n    public get type(): number {\n        return this.light.getTypeID();\n    }\n\n    public get intensity(): number {\n        return this.light.intensity;\n    }\n    public set intensity(value: number) {\n        this.light.intensity = value;\n    }\n\n    public get diffuse(): BABYLON.Color3 {\n        return this.light.diffuse;\n    }\n    public set diffuse(value: BABYLON.Color3) {\n        this.light.diffuse = value;\n    }\n\n    public get specular(): BABYLON.Color3 {\n        return this.light.specular;\n    }\n    public set specular(value: BABYLON.Color3) {\n        this.light.specular = value;\n    }\n\n    public get angle(): number {\n        if (this.light instanceof BABYLON.SpotLight) {\n            return this.light.angle;\n        } else {\n            return 0;\n        }\n    }\n    public set angle(value: number) {\n        if (this.light instanceof BABYLON.SpotLight) {\n            this.light.angle = value;\n        }\n    }\n\n    public get exponent(): number {\n        if (this.light instanceof BABYLON.SpotLight) {\n            return this.light.exponent;\n        } else {\n            return 0;\n        }\n    }\n    public set exponent(value: number) {\n        if (this.light instanceof BABYLON.SpotLight) {\n            this.light.exponent = value;\n        }\n    }\n\n\n    public constructor(light: BABYLON.Light, scene: BABYLON.Scene) {\n        super(light.name, scene);\n        light.name += '-Light';\n        // light\n        this.light = light;\n        this.position.copyFrom(light.getAbsolutePosition());\n        // this.rotation = BABYLON.Vector3.Zero();\n        light.parent = this;\n        \n    }\n\n    // public isEnabled(): boolean {\n    //     return this.light.isEnabled();\n    // }\n\n    // public setEnabled(value: boolean) {\n    //     this.light.setEnabled(value);\n    // }\n\n}","export * from './picker-color';\r\nexport * from './picker-asset';\r\nexport * from './keeper';","import { PickerAsset } from \"./picker-asset\";\r\nimport { PickerColor } from \"./picker-color\";\r\n\r\nexport class PickerKeeper {\r\n\r\n\r\n    public constructor () {\r\n\r\n        new PickerColor();\r\n        new PickerAsset();\r\n        \r\n    }\r\n\r\n}","import { Overlay } from \"../../ui\";\r\n\r\nexport class PickerAsset {\r\n\r\n    public constructor() {\r\n\r\n        var overlay = new Overlay();\r\n        overlay.class!.add('picker-asset');\r\n        overlay.center = false;\r\n        overlay.hidden = true;\r\n\r\n        var root = editor.call('layout.root');\r\n        root.append(overlay);\r\n\r\n        // initial select state\r\n        var currentType = '';\r\n        var currentAsset: any = null;\r\n        var gridSelected = false;\r\n        var allowMultiSelection = false;\r\n        var assetSelection: any = [];\r\n\r\n        var assetsPanelFolded = false;\r\n        var assetsPanelFilter = '';\r\n        var assetsPanelSearch = '';\r\n        var assetsPanelFolder: any = null;\r\n        // elements\r\n        var assetsGrid = editor.call('assets:grid');\r\n        var assetsPanel = editor.call('layout.assets');\r\n\r\n        var pluralize = function (word: string) {\r\n            return word + ' assets';\r\n        };\r\n\r\n        // empty filter messages\r\n        var getNoResultsMessage = function (type: string, filter: any) {\r\n            var result;\r\n\r\n            if (type === 'material' || type === 'cubemap' || type === 'text' || type === 'json' || type === 'html' || type === 'shader' || type === 'css') {\r\n                result = 'There are no ' + pluralize(type) + ' in this folder. Click on the <span class=\"font-icon\" style=\"font-size: 18px\">&#57632;</span> button to add one';\r\n            } else {\r\n                result = 'There are no ' + pluralize(type) + ' in this folder. Add one by uploading a ' + type + ' file';\r\n            }\r\n\r\n            if (filter) {\r\n                result += ' or change your search term.';\r\n            } else {\r\n                result += '.';\r\n            }\r\n\r\n            return result;\r\n        };\r\n\r\n        // esc to close\r\n        editor.call('hotkey:register', 'picker:assets:close', {\r\n            key: 'esc',\r\n            callback: function () {\r\n                if (overlay.hidden)\r\n                    return;\r\n\r\n                overlay.hidden = true;\r\n            }\r\n        });\r\n\r\n        assetsGrid.on('deselect', function (item: any) {\r\n            if (overlay.hidden || !item.asset)\r\n                return;\r\n\r\n            if (item.asset === currentAsset) {\r\n                assetsGrid.selected = [item];\r\n            } else {\r\n                if (allowMultiSelection) {\r\n                    var idx = assetSelection.indexOf(item.asset);\r\n                    if (idx !== -1) {\r\n                        assetSelection.splice(idx, 1);\r\n                        editor.emit('picker:assets', assetSelection);\r\n                    }\r\n                }\r\n            }\r\n        });\r\n\r\n        // picked asset\r\n        assetsGrid.on('select', function (item: any) {\r\n            if (item.asset) {\r\n                if (overlay.hidden ||\r\n                    (currentType !== '*' && item.asset.get('type') !== currentType) ||\r\n                    item.asset === currentAsset) {\r\n                    return;\r\n                }\r\n\r\n                // emit event\r\n                if (item.asset) {\r\n                    if (allowMultiSelection) {\r\n                        assetSelection.push(item.asset);\r\n                        editor.emit('picker:assets', assetSelection);\r\n                    } else {\r\n                        editor.emit('picker:asset', item.asset);\r\n                    }\r\n                }\r\n            } else if (item.script) {\r\n                if (overlay.hidden ||\r\n                    (currentType !== '*' && currentType !== \"script\")) {\r\n                    return;\r\n                }\r\n\r\n                if (item.script) {\r\n                    if (allowMultiSelection) {\r\n                        assetSelection.push(item.script);\r\n                        editor.emit('picker:assets', assetSelection);\r\n                    } else {\r\n                        editor.emit('picker:asset', item.script);\r\n                    }\r\n                }\r\n            }\r\n\r\n            if (!allowMultiSelection) {\r\n                // hide picker\r\n                overlay.hidden = true;\r\n            }\r\n        });\r\n\r\n        // on close asset picker\r\n        overlay.on('hide', function () {\r\n            // show all assets back\r\n            editor.call('assets:filter:type:disabled', false);\r\n            editor.call('assets:filter:type', assetsPanelFilter);\r\n            editor.call('assets:filter:search', assetsPanelSearch);\r\n            editor.call('assets:panel:currentFolder', assetsPanelFolder);\r\n            // fold back assets panel if needed\r\n            if (assetsPanelFolded)\r\n                assetsPanel.collapsed = true;\r\n            // enable selector\r\n            editor.call('selector:enabled', true);\r\n            // select what was selected\r\n            assetsGrid.selected = gridSelected;\r\n\r\n            if (allowMultiSelection) {\r\n                editor.emit('picker:assets', assetSelection);\r\n            }\r\n\r\n            // emit event\r\n            editor.emit('picker:asset:close');\r\n            // styling\r\n            assetsPanel.style.zIndex = '';\r\n            assetsPanel.style.overflow = '';\r\n        });\r\n\r\n        editor.method('picker:asset', function (args: any) {\r\n            var type = args.type;\r\n\r\n            allowMultiSelection = !!args.multi;\r\n            assetSelection.length = 0;\r\n\r\n            // show only asset assets\r\n            assetsPanelFilter = editor.call('assets:filter:type');\r\n            assetsPanelSearch = editor.call('assets:filter:search');\r\n            assetsPanelFolder = editor.call('assets:panel:currentFolder');\r\n            // navigate to scripts folder\r\n\r\n            // initial grid selected items\r\n            gridSelected = assetsGrid.selected;\r\n            // filters\r\n            var pickerType = type;\r\n            if (type === 'texture') {\r\n                pickerType = 'textureTarget';\r\n            } else if (type === 'textureatlas') {\r\n                pickerType = 'textureAtlasTarget';\r\n            } else if (type === 'font') {\r\n                pickerType = 'fontTarget';\r\n            }\r\n\r\n            editor.call('assets:filter:type', (pickerType === '*') ? 'all' : pickerType);\r\n            editor.call('assets:filter:type:disabled', (!pickerType || pickerType === '*') ? false : true);\r\n\r\n            // disable selector\r\n            editor.call('selector:enabled', false);\r\n            // find current asset\r\n            currentType = type;\r\n            currentAsset = args.currentAsset;\r\n            if (currentAsset) {\r\n                var assetsIndex = editor.call('assets:grid:assetsIndex');\r\n                var gridItem = assetsIndex[currentAsset.get('id')];\r\n                // select in grid\r\n                if (gridItem) {\r\n                    assetsGrid.selected = [gridItem];\r\n                    // navigate to folder of referenced file\r\n\r\n                    var path = currentAsset.get('path');\r\n                    if (path.length) {\r\n                        editor.call('assets:panel:currentFolder', editor.call('assets:get', path[path.length - 1]));\r\n                    } else {\r\n                        editor.call('assets:panel:currentFolder', null);\r\n                    }\r\n                }\r\n            }\r\n            // show asset panel in front\r\n            assetsPanel.style.zIndex = 102;\r\n            assetsPanel.style.overflow = 'visible';\r\n            // if panel folded?\r\n            assetsPanelFolded = assetsPanel.collapsed;\r\n            if (assetsPanelFolded)\r\n                assetsPanel.collapsed = false;\r\n            // show overlay\r\n            overlay.hidden = false;\r\n            // flash assets panel\r\n            assetsPanel.flash();\r\n            // focus on panel\r\n            setTimeout(function () {\r\n                if (assetsGrid.selected && assetsGrid.selected.length) {\r\n                    assetsGrid.selected[0].element.focus();\r\n                } else {\r\n                    assetsGrid.element.focus();\r\n                }\r\n\r\n                // if no assets then show message\r\n                var visible = assetsGrid.element.querySelectorAll('.ui-grid-item:not(.hidden)');\r\n                if (visible.length === 0) {\r\n                    var msg = getNoResultsMessage(type, assetsPanelSearch);\r\n                    editor.call('assets:panel:message', msg);\r\n                }\r\n            }, 100);\r\n\r\n        });\r\n\r\n        // Deselects all picked assets\r\n        editor.method('picker:asset:deselect', function () {\r\n            assetsGrid.selected = currentAsset ? [currentAsset] : [];\r\n        });\r\n\r\n        // close asset picker\r\n        editor.method('picker:asset:close', function () {\r\n            // hide overlay\r\n            overlay.hidden = true;\r\n        });\r\n\r\n    }\r\n\r\n}","import { NumberField, Overlay, TextField } from \"../../ui\";\r\nimport { Tools } from \"../utility\";\r\n\r\nexport class PickerColor {\r\n\r\n    public constructor() {\r\n        var size = 144;\r\n        var directInput = true;\r\n        var colorHSV = [0, 0, 0];\r\n        var channels: any = [];\r\n        var channelsNumber = 4;\r\n        var changing = false;\r\n        var dragging = false;\r\n\r\n        // make hex out of channels\r\n        var getHex = function () {\r\n            var hex = '';\r\n            for (var i = 0; i < channelsNumber; i++) {\r\n                hex += ('00' + channels[i].value.toString(16)).slice(-2).toUpperCase();\r\n            }\r\n            return hex;\r\n        };\r\n\r\n        // rect drag\r\n        var pickRectMouseMove = function (evt: MouseEvent) {\r\n            changing = true;\r\n            var rect = pickRect.getBoundingClientRect();\r\n            var x = Math.max(0, Math.min(size, Math.floor(evt.clientX - rect.left)));\r\n            var y = Math.max(0, Math.min(size, Math.floor(evt.clientY - rect.top)));\r\n\r\n            colorHSV[1] = x / size;\r\n            colorHSV[2] = 1.0 - (y / size);\r\n\r\n            directInput = false;\r\n            var rgb = Tools.hsv2rgb([colorHSV[0], colorHSV[1], colorHSV[2]]);\r\n            for (var i = 0; i < 3; i++) {\r\n                channels[i].value = rgb[i];\r\n            }\r\n            fieldHex.value = getHex();\r\n            directInput = true;\r\n\r\n            pickRectHandle.style.left = Math.max(4, Math.min(size - 4, x)) + 'px';\r\n            pickRectHandle.style.top = Math.max(4, Math.min(size - 4, y)) + 'px';\r\n            changing = false;\r\n        };\r\n\r\n        // rect drag stop\r\n        var pickRectMouseUp = function () {\r\n            window.removeEventListener('mousemove', pickRectMouseMove, false);\r\n            window.removeEventListener('mouseup', pickRectMouseUp, false);\r\n            dragging = false;\r\n            editor.emit('picker:color:end');\r\n        };\r\n\r\n        // hue drag\r\n        var pickHueMouseMove = function (evt: MouseEvent) {\r\n            changing = true;\r\n            var rect = pickHue.getBoundingClientRect();\r\n            var y = Math.max(0, Math.min(size, Math.floor(evt.clientY - rect.top)));\r\n            var h = y / size;\r\n\r\n            var rgb = Tools.hsv2rgb([h, colorHSV[1], colorHSV[2]]);\r\n            colorHSV[0] = h;\r\n\r\n            directInput = false;\r\n            for (var i = 0; i < 3; i++) {\r\n                channels[i].value = rgb[i];\r\n            }\r\n            fieldHex.value = getHex();\r\n            updateRects();\r\n            directInput = true;\r\n            changing = false;\r\n        };\r\n\r\n        // hue drag stop\r\n        var pickHueMouseUp = function () {\r\n            window.removeEventListener('mousemove', pickHueMouseMove, false);\r\n            window.removeEventListener('mouseup', pickHueMouseUp, false);\r\n            dragging = false;\r\n            editor.emit('picker:color:end');\r\n        };\r\n\r\n\r\n        // opacity drag\r\n        var pickOpacityMouseMove = function (evt: MouseEvent) {\r\n            changing = true;\r\n            var rect = pickHue.getBoundingClientRect();\r\n            var y = Math.max(0, Math.min(size, Math.floor(evt.clientY - rect.top)));\r\n            var o = 1.0 - y / size;\r\n\r\n            directInput = false;\r\n            fieldA.value = Math.max(0, Math.min(255, Math.round(o * 255)));\r\n            fieldHex.value = getHex();\r\n            directInput = true;\r\n            changing = false;\r\n        };\r\n\r\n        // opacity drag stop\r\n        var pickOpacityMouseUp = function () {\r\n            window.removeEventListener('mousemove', pickOpacityMouseMove, false);\r\n            window.removeEventListener('mouseup', pickOpacityMouseUp, false);\r\n            dragging = false;\r\n            editor.emit('picker:color:end');\r\n        };\r\n\r\n\r\n        var updateHex = function () {\r\n            if (!directInput)\r\n                return;\r\n\r\n            changing = true;\r\n\r\n            var hex = fieldHex.value.trim().toLowerCase();\r\n            if (/^([0-9a-f]{2}){3,4}$/.test(hex)) {\r\n                for (var i = 0; i < channelsNumber; i++) {\r\n                    channels[i].value = parseInt(hex.slice(i * 2, i * 2 + 2), 16);\r\n                }\r\n            }\r\n\r\n            changing = false;\r\n        };\r\n\r\n        // update rgb\r\n        var updateRects = function () {\r\n            var color = channels.map(function (channel: any) {\r\n                return channel.value || 0;\r\n            }).slice(0, channelsNumber);\r\n\r\n            // console.warn(color);\r\n\r\n            var hsv = Tools.rgb2hsv(color);\r\n            if (directInput) {\r\n                var sum = color[0] + color[1] + color[2];\r\n                if (sum !== 765 && sum !== 0)\r\n                    colorHSV[0] = hsv[0];\r\n\r\n                colorHSV[1] = hsv[1];\r\n                colorHSV[2] = hsv[2];\r\n\r\n                dragging = true;\r\n                editor.emit('picker:color:start');\r\n            }\r\n\r\n            // hue position\r\n            pickHueHandle.style.top = Math.floor(size * colorHSV[0]) + 'px'; // h\r\n\r\n            // rect position\r\n            pickRectHandle.style.left = Math.max(4, Math.min(size - 4, size * colorHSV[1])) + 'px'; // s\r\n            pickRectHandle.style.top = Math.max(4, Math.min(size - 4, size * (1.0 - colorHSV[2]))) + 'px'; // v\r\n\r\n            if (channelsNumber >= 3) {\r\n                var plainColor = Tools.hsv2rgb([colorHSV[0], 1, 1]).join(',');\r\n\r\n                // console.warn(plainColor);\r\n                // rect background color\r\n                pickRect.style.backgroundColor = 'rgb(' + plainColor + ')';\r\n\r\n                // rect handle color\r\n                pickRectHandle.style.backgroundColor = 'rgb(' + color.slice(0, 3).join(',') + ')';\r\n\r\n                // hue handle color\r\n                pickHueHandle.style.backgroundColor = 'rgb(' + plainColor + ')';\r\n            }\r\n\r\n            callCallback();\r\n        };\r\n\r\n        // update alpha handle\r\n        var updateRectAlpha = function (value: number) {\r\n            if (channelsNumber !== 4)\r\n                return;\r\n\r\n            // position\r\n            pickOpacityHandle.style.top = Math.floor(size * (1.0 - (Math.max(0, Math.min(255, value)) / 255))) + 'px';\r\n\r\n            // color\r\n            pickOpacityHandle.style.backgroundColor = 'rgb(' + [value, value, value].join(',') + ')';\r\n\r\n            callCallback();\r\n        };\r\n\r\n        var callingCallaback = false;\r\n        var callbackHandle = function () {\r\n            callingCallaback = false;\r\n\r\n            editor.emit('picker:color', channels.map(function (channel: any) {\r\n                return channel.value || 0;\r\n            }).slice(0, channelsNumber));\r\n        };\r\n        var callCallback = function () {\r\n            if (callingCallaback)\r\n                return;\r\n\r\n            callingCallaback = true;\r\n            setTimeout(callbackHandle, 1000 / 60);\r\n        };\r\n\r\n\r\n        // overlay\r\n        var overlay = new Overlay();\r\n        overlay.class!.add('picker-color');\r\n        overlay.center = false;\r\n        overlay.transparent = true;\r\n        overlay.hidden = true;\r\n\r\n        // rectangular picker\r\n        var pickRect = document.createElement('div');\r\n        pickRect.classList.add('pick-rect');\r\n        overlay.append(pickRect);\r\n\r\n        // rect drag start\r\n        pickRect.addEventListener('mousedown', function (evt) {\r\n            pickRectMouseMove(evt);\r\n\r\n            window.addEventListener('mousemove', pickRectMouseMove, false);\r\n            window.addEventListener('mouseup', pickRectMouseUp, false);\r\n\r\n            evt.stopPropagation();\r\n            evt.preventDefault();\r\n            dragging = true;\r\n            editor.emit('picker:color:start');\r\n        });\r\n\r\n        // white\r\n        var pickRectWhite = document.createElement('div');\r\n        pickRectWhite.classList.add('white');\r\n        pickRect.appendChild(pickRectWhite);\r\n\r\n        // black\r\n        var pickRectBlack = document.createElement('div');\r\n        pickRectBlack.classList.add('black');\r\n        pickRect.appendChild(pickRectBlack);\r\n\r\n        // handle\r\n        var pickRectHandle = document.createElement('div');\r\n        pickRectHandle.classList.add('handle');\r\n        pickRect.appendChild(pickRectHandle);\r\n\r\n\r\n        // hue (rainbow) picker\r\n        var pickHue = document.createElement('div');\r\n        pickHue.classList.add('pick-hue');\r\n        overlay.append(pickHue);\r\n\r\n        // hue drag start\r\n        pickHue.addEventListener('mousedown', function (evt) {\r\n            pickHueMouseMove(evt);\r\n\r\n            window.addEventListener('mousemove', pickHueMouseMove, false);\r\n            window.addEventListener('mouseup', pickHueMouseUp, false);\r\n\r\n            evt.stopPropagation();\r\n            evt.preventDefault();\r\n            dragging = true;\r\n            editor.emit('picker:color:start');\r\n        });\r\n\r\n        // handle\r\n        var pickHueHandle = document.createElement('div');\r\n        pickHueHandle.classList.add('handle');\r\n        pickHue.appendChild(pickHueHandle);\r\n\r\n\r\n        // opacity (gradient) picker\r\n        var pickOpacity = document.createElement('div');\r\n        pickOpacity.classList.add('pick-opacity');\r\n        overlay.append(pickOpacity);\r\n\r\n        // opacoty drag start\r\n        pickOpacity.addEventListener('mousedown', function (evt) {\r\n            pickOpacityMouseMove(evt);\r\n\r\n            window.addEventListener('mousemove', pickOpacityMouseMove, false);\r\n            window.addEventListener('mouseup', pickOpacityMouseUp, false);\r\n\r\n            evt.stopPropagation();\r\n            evt.preventDefault();\r\n            dragging = true;\r\n            editor.emit('picker:color:start');\r\n        });\r\n\r\n        // handle\r\n        var pickOpacityHandle = document.createElement('div');\r\n        pickOpacityHandle.classList.add('handle');\r\n        pickOpacity.appendChild(pickOpacityHandle);\r\n\r\n\r\n\r\n        // fields\r\n        var panelFields = document.createElement('div');\r\n        panelFields.classList.add('fields');\r\n        overlay.append(panelFields);\r\n\r\n\r\n        // R\r\n        var fieldR = new NumberField({\r\n            precision: 1,\r\n            step: 1,\r\n            min: 0,\r\n            max: 255\r\n        });\r\n        channels.push(fieldR);\r\n        fieldR.renderChanges = false;\r\n        fieldR.placeholder = 'r';\r\n        fieldR.flexGrow = '1';\r\n        fieldR.class!.add('field', 'field-r');\r\n        fieldR.on('change', updateRects);\r\n        panelFields.appendChild(fieldR.element!);\r\n\r\n        // G\r\n        var fieldG = new NumberField({\r\n            precision: 1,\r\n            step: 1,\r\n            min: 0,\r\n            max: 255\r\n        });\r\n        channels.push(fieldG);\r\n        fieldG.renderChanges = false;\r\n        fieldG.placeholder = 'g';\r\n        fieldG.class!.add('field', 'field-g');\r\n        fieldG.on('change', updateRects);\r\n        panelFields.appendChild(fieldG.element!);\r\n\r\n        // B\r\n        var fieldB = new NumberField({\r\n            precision: 1,\r\n            step: 1,\r\n            min: 0,\r\n            max: 255\r\n        });\r\n        channels.push(fieldB);\r\n        fieldB.renderChanges = false;\r\n        fieldB.placeholder = 'b';\r\n        fieldB.class!.add('field', 'field-b');\r\n        fieldB.on('change', updateRects);\r\n        panelFields.appendChild(fieldB.element!);\r\n\r\n\r\n        // A\r\n        var fieldA = new NumberField({\r\n            precision: 1,\r\n            step: 1,\r\n            min: 0,\r\n            max: 255\r\n        });\r\n        channels.push(fieldA);\r\n        fieldA.renderChanges = false;\r\n        fieldA.placeholder = 'a';\r\n        fieldA.class!.add('field', 'field-a');\r\n        fieldA.on('change', updateRectAlpha);\r\n        panelFields.appendChild(fieldA.element!);\r\n\r\n\r\n        // HEX\r\n        var fieldHex = new TextField();\r\n        fieldHex.renderChanges = false;\r\n        fieldHex.placeholder = '#';\r\n        fieldHex.class!.add('field', 'field-hex');\r\n        fieldHex.on('change', function () {\r\n            updateHex();\r\n        });\r\n        panelFields.appendChild(fieldHex.element!);\r\n\r\n\r\n        var root = editor.call('layout.root');\r\n        root.append(overlay);\r\n\r\n\r\n        // esc to close\r\n        editor.call('hotkey:register', 'picker:color:close', {\r\n            key: 'esc',\r\n            callback: function () {\r\n                if (overlay.hidden)\r\n                    return;\r\n\r\n                overlay.hidden = true;\r\n            }\r\n        });\r\n\r\n\r\n        overlay.on('hide', function () {\r\n            editor.emit('picker:color:close');\r\n        });\r\n\r\n\r\n        // call picker\r\n        editor.method('picker:color', function (color: number[]) {\r\n            // class for channels\r\n            for (var i = 0; i < 4; i++) {\r\n                if (color.length - 1 < i) {\r\n                    overlay.class!.remove('c-' + (i + 1));\r\n                } else {\r\n                    overlay.class!.add('c-' + (i + 1));\r\n                }\r\n            }\r\n\r\n            // number of channels\r\n            channelsNumber = color.length;\r\n\r\n            if (channelsNumber >= 3) {\r\n                var hsv = Tools.rgb2hsv(color);\r\n                colorHSV[0] = hsv[0];\r\n                colorHSV[1] = hsv[1];\r\n                colorHSV[2] = hsv[2];\r\n            }\r\n\r\n            // set fields\r\n            directInput = false;\r\n            for (var i = 0; i < color.length; i++) {\r\n                channels[i].value = color[i];\r\n            }\r\n            fieldHex.value = getHex();\r\n            directInput = true;\r\n\r\n            // show overlay\r\n            overlay.hidden = false;\r\n\r\n            // focus on hex field\r\n            fieldHex.elementInput.focus();\r\n\r\n            setTimeout(function () {\r\n                fieldHex.elementInput.focus();\r\n                fieldHex.elementInput.select();\r\n            }, 100);\r\n        });\r\n\r\n        editor.method('picker:color:close', function () {\r\n            overlay.hidden = true;\r\n        });\r\n\r\n        editor.method('picker:color:rect', function () {\r\n            return overlay.rect;\r\n        });\r\n\r\n        // position color picker\r\n        editor.method('picker:color:position', function (x: number, y: number) {\r\n            overlay.position(x, y);\r\n        });\r\n\r\n        // position color picker\r\n        editor.method('picker:color:set', function (color: number[]) {\r\n            if (changing || dragging)\r\n                return;\r\n\r\n            if (channelsNumber >= 3) {\r\n                var hsv = Tools.rgb2hsv(color);\r\n                colorHSV[0] = hsv[0];\r\n                colorHSV[1] = hsv[1];\r\n                colorHSV[2] = hsv[2];\r\n            }\r\n\r\n            // set fields\r\n            directInput = false;\r\n            for (var i = 0; i < color.length; i++) {\r\n                channels[i].value = color[i];\r\n            }\r\n            fieldHex.value = getHex();\r\n            directInput = true;\r\n        });\r\n\r\n    }\r\n\r\n\r\n}","export * from './keeper';\nexport * from './scenes';","import { Scenes } from \"./scenes\";\n\nexport class ScenesKeeper {\n    public constructor() {\n        new Scenes();\n    }\n}","import { Config } from \"../global\";\n\nexport class Scenes {\n\n    private _prefix: string = '（未保存）';\n\n    public constructor() {\n\n        let self = this;\n\n\n        editor.method('make:scene:dirty', () => {\n            if (!document.title.startsWith(self._prefix)) {\n                document.title = self._prefix + document.title;\n            }\n            Config.isSceneDirty = true;\n            // console.error('make:scene:dirty');\n        });\n\n        editor.method('make:scene:clear', () => {\n            Config.isSceneDirty = false;\n            if (document.title.startsWith(self._prefix)) {\n                document.title = document.title.substring(self._prefix.length);\n            }\n        });\n\n\n\n        // Create a scene and pass result to callback\n        // editor.method('scenes:new', function (name: string, callback: Function) {\n        //     var data = {\n        //         projectId: config.project.id,\n        //         branchId: config.self.branch.id\n        //     };\n\n        //     if (name) data.name = name;\n\n        //     Ajax({\n        //         url: '{{url.api}}/scenes',\n        //         auth: true,\n        //         method: 'POST',\n        //         data: data\n        //     })\n        //         .on('load', function (status: boolean, data: any) {\n        //             if (callback)\n        //                 callback(data);\n        //         });\n        // });\n\n\n    }\n\n\n}","import { Observer } from \"src/lib\";\n\nexport class Search {\n    public constructor() {\n        // calculate, how many string `a`\n        // requires edits, to become string `b`\n        editor.method('search:stringEditDistance', function (a: string, b: string) {\n            // Levenshtein distance\n            // https://en.wikibooks.org/wiki/Algorithm_Implementation/Strings/Levenshtein_distance#JavaScript\n            if (a.length === 0) return b.length;\n            if (b.length === 0) return a.length;\n            if (a === b) return 0;\n\n            var i, j;\n            var matrix = [];\n\n            for (i = 0; i <= b.length; i++)\n                matrix[i] = [i];\n\n            for (j = 0; j <= a.length; j++)\n                matrix[0][j] = j;\n\n            for (i = 1; i <= b.length; i++) {\n                for (j = 1; j <= a.length; j++) {\n                    if (b.charAt(i - 1) === a.charAt(j - 1)) {\n                        matrix[i][j] = matrix[i - 1][j - 1];\n                    } else {\n                        matrix[i][j] = Math.min(matrix[i - 1][j - 1] + 1, Math.min(matrix[i][j - 1] + 1, matrix[i - 1][j] + 1));\n                    }\n                }\n            }\n\n            return matrix[b.length][a.length];\n        });\n\n        // calculate, how many characters string `b`\n        // contains of a string `a`\n        editor.method('search:charsContains', function (a: string, b: string) {\n            if (a === b)\n                return a.length;\n\n            var contains = 0;\n            var ind: { [key: string]: boolean } = {};\n            var i;\n\n            for (i = 0; i < b.length; i++)\n                ind[b.charAt(i)] = true;\n\n            for (i = 0; i < a.length; i++) {\n                if (ind[a.charAt(i)])\n                    contains++;\n            }\n\n            return contains;\n        });\n\n        // tokenize string into array of tokens\n        editor.method('search:stringTokenize', function (name: string) {\n            var tokens = [];\n\n            // camelCase\n            // upperCASE123\n            var string = name.replace(/([^A-Z])([A-Z][^A-Z])/g, '$1 $2').replace(/([A-Z0-9]{2,})/g, ' $1');\n\n            // space notation\n            // dash-notation\n            // underscore_notation\n            var parts = string.split(/(\\s|\\-|_)/g);\n\n            // filter valid tokens\n            for (var i = 0; i < parts.length; i++) {\n                parts[i] = parts[i].toLowerCase().trim();\n                if (parts[i] && parts[i] !== '-' && parts[i] !== '_')\n                    tokens.push(parts[i]);\n            }\n\n            return tokens;\n        });\n\n        var searchItems = function (items: any, search: string, args: any) {\n            var results = [];\n\n            for (var i = 0; i < items.length; i++) {\n                var item = items[i];\n\n                // direct hit\n                if (item.subFull !== Infinity) {\n                    results.push(item);\n\n                    if (item.edits === Infinity)\n                        item.edits = 0;\n\n                    if (item.sub === Infinity)\n                        item.sub = item.subFull;\n\n                    continue;\n                } else if (item.name === search || item.name.indexOf(search) === 0) {\n                    results.push(item);\n\n                    if (item.edits === Infinity)\n                        item.edits = 0;\n\n                    if (item.sub === Infinity)\n                        item.sub = 0;\n\n                    continue;\n                }\n\n                // check if name contains enough of search characters\n                var contains = editor.call('search:charsContains', search, item.name);\n                if (contains / search.length < args.containsCharsTolerance)\n                    continue;\n\n                var editsCandidate = Infinity;\n                var subCandidate = Infinity;\n\n                // for each token\n                for (var t = 0; t < item.tokens.length; t++) {\n                    // direct token match\n                    if (item.tokens[t] === search) {\n                        editsCandidate = 0;\n                        subCandidate = t;\n                        break;\n                    }\n\n                    var edits = editor.call('search:stringEditDistance', search, item.tokens[t]);\n\n                    if ((subCandidate === Infinity || edits < editsCandidate) && item.tokens[t].indexOf(search) !== -1) {\n                        // search is a substring of a token\n                        subCandidate = t;\n                        editsCandidate = edits;\n                        continue;\n                    } else if (subCandidate === Infinity && edits < editsCandidate) {\n                        // new edits candidate, not a substring of a token\n                        if ((edits / Math.max(search.length, item.tokens[t].length)) <= args.editsDistanceTolerance) {\n                            // check if edits tolerance is satisfied\n                            editsCandidate = edits;\n                        }\n                    }\n                }\n\n                // no match candidate\n                if (editsCandidate === Infinity)\n                    continue;\n\n                // add new result\n                results.push(item);\n                item.edits = item.edits === Infinity ? editsCandidate : item.edits + editsCandidate;\n                item.sub = item.sub === Infinity ? subCandidate : item.sub + subCandidate;\n            }\n\n            return results;\n        };\n\n\n        // perform search through items\n        // items is an array with arrays of two values\n        // where first value is a string to be searched by\n        // and second value is an object to be found\n        /*\n        [\n            [ 'camera', {object} ],\n            [ 'New Entity', {object} ],\n            [ 'Sun', {object} ]\n        ]\n        */\n        editor.method('search:items', function (items: any, search: string, args: any) {\n            search = (search || '').toLowerCase().trim();\n\n            if (!search)\n                return [];\n\n            var searchTokens = editor.call('search:stringTokenize', search);\n            if (!searchTokens.length)\n                return [];\n\n            args = args || {};\n            args.containsCharsTolerance = args.containsCharsTolerance || 0.5;\n            args.editsDistanceTolerance = args.editsDistanceTolerance || 0.5;\n\n            var result = [];\n            var records = [];\n\n            for (var i = 0; i < items.length; i++) {\n                var subInd = items[i][0].toLowerCase().trim().indexOf(search);\n\n                records.push({\n                    name: items[i][0],\n                    item: items[i][1],\n                    tokens: editor.call('search:stringTokenize', items[i][0]),\n                    edits: Infinity,\n                    subFull: (subInd !== -1) ? subInd : Infinity,\n                    sub: Infinity\n                });\n            }\n\n            // search each token\n            for (var i = 0; i < searchTokens.length; i++)\n                records = searchItems(records, searchTokens[i], args);\n\n            // sort result first by substring? then by edits number\n            records.sort(function (a, b) {\n                if (a.subFull !== b.subFull) {\n                    return a.subFull - b.subFull;\n                } else if (a.sub !== b.sub) {\n                    return a.sub - b.sub;\n                } else if (a.edits !== b.edits) {\n                    return a.edits - b.edits;\n                } else {\n                    return a.name.length - b.name.length;\n                }\n            });\n\n            // return only items without match information\n            for (var i = 0; i < records.length; i++)\n                records[i] = records[i].item;\n\n            // limit number of results\n            if (args.hasOwnProperty('limitResults') && records.length > args.limitResults) {\n                records = records.slice(0, args.limitResults);\n            }\n\n            return records;\n        });\n    }\n}","export * from './selector';\nexport * from './selector-history';","export class SelectorHistory {\n\n\n    public constructor() {\n\n    }\n\n}","import { Observer } from '../../lib/observer';\nimport { ObserverList } from '../../lib';\n\n\nexport class Selector {\n\n    public enabled: boolean = true;\n\n    public selector: ObserverList;\n    public legacyScripts: boolean = false;\n\n    public evtChange: boolean;\n\n    public type: string = '';\n    public length: number = 0;\n\n    public constructor() {\n        this.selector = new ObserverList();\n\n        this.evtChange = false;\n\n        this.init();\n    }\n\n\n    private init(): void {\n\n        let self = this;\n\n        var index: any = {};\n\n        var keyByType = function (type: string) {\n            switch (type) {\n                case 'entity':\n                    return 'resource_id';\n                case 'asset':\n                    return 'id';\n            }\n            return '';\n        };\n\n        var setIndex = function (type: string, item: Observer) {\n            var key = keyByType(type);\n            if (!key) return;\n\n            if (!index[type])\n                index[type] = {};\n\n            index[type][item.get(key)] = item.once('destroy', function () {\n                var state = editor.call('selector:history');\n                if (state)\n                    editor.call('selector:history', false);\n\n                self.selector.remove(item);\n                delete index[type][item.get(key)];\n\n                if (state)\n                    editor.call('selector:history', true);\n            });\n        };\n\n        var removeIndex = function (type: string, item: Observer) {\n            if (!index[type]) return;\n\n            var key = keyByType(type);\n            if (!key) return;\n\n            var ind = index[type][item.get(key)];\n            if (!ind) return;\n\n            ind.unbind();\n        };\n\n        var evtChange = false;\n        var evtChangeFn = function () {\n            evtChange = false;\n            // console.log(self.selector.type);\n            // console.log(self.selector.array());\n            editor.emit('selector:change', self.selector.type, self.selector.array());\n        };\n\n        // adding\n        self.selector.on('add', function (item: Observer) {\n            // add index\n            setIndex(self.type, item);\n            // console.error(\"adddddddd: \" + self.type);\n            editor.emit('selector:add', item, self.type);\n\n            if (!evtChange) {\n                evtChange = true;\n                setTimeout(evtChangeFn, 0);\n            }\n        });\n\n        // removing\n        self.selector.on('remove', function (item: Observer) {\n            editor.emit('selector:remove', item, self.type);\n            // console.error(\"removeeeeeee: \" + self.type);\n            // remove index\n            removeIndex(self.type, item);\n\n            if (self.length === 0)\n                self.type = '';\n\n            if (!evtChange) {\n                evtChange = true;\n                setTimeout(evtChangeFn, 0);\n            }\n        });\n\n\n        // selecting item (toggle)\n        editor.method('selector:toggle', function (type: string, item: Observer) {\n            if (!self.enabled)\n                return;\n\n            if (self.selector.length && self.selector.type !== type) {\n                self.selector.clear();\n            }\n            self.selector.type = type;\n            self.type = type;\n\n            if (self.selector.has(item)) {\n                self.selector.remove(item);\n            } else {\n                self.selector.add(item);\n            }\n        });\n\n        // selecting list of items\n        editor.method('selector:set', function (type: string, items: Observer[]) {\n            if (!self.enabled)\n                return;\n\n            self.selector.clear();\n\n            if (!type || !items.length)\n                return;\n\n            // make sure items still exist\n            if (type === 'asset') {\n                items = items.filter(function (item: Observer) {\n                    return (self.legacyScripts && item.get('type') === 'script') || !!editor.call('assets:get', item.get('id'));\n                });\n            } else if (type === 'entity') {\n                items = items.filter(function (item: Observer) {\n                    return !!editor.call('entities:get', item.get('resource_id'));\n                });\n                let rootEntity = editor.call('entities:root');\n                if (items.indexOf(rootEntity) !== -1) {\n                    editor.call('selector:set', 'entity', []);\n                    // editor.emit('attributes:inspect[editorSettings]');\n                    type = 'editorSettings';\n                    items = [editor.call('settings:data')];\n                }\n            }\n\n            if (!items.length)\n                return;\n\n            // type\n            self.selector.type = type;\n            self.type = type;\n\n            // remove\n            // TODO: 删除不重合的部分\n            // self.selector.find(function (item: Observer) {\n            //     return items.indexOf(item) === -1;\n            // }).forEach(function (item: Observer) {\n            //     self.selector.remove(item);\n            // });\n\n            // add\n            for (var i = 0; i < items.length; i++)\n                self.selector.add(items[i]);\n        });\n\n        // 某个面板选中item // selecting item hierarchy选择物体\n        editor.method('selector:add', (type: string, item: Observer) => {\n\n            if (!self.enabled)\n                return;\n\n            if (self.selector.has(item))\n                return;\n\n            // console.warn('selector add入口, type: ' + type);\n            // console.warn(item.get('id'));\n\n            if (self.selector.length > 0 && self.selector.type !== type) {\n                self.selector.clear();\n            }\n\n            // root为场景设置\n            if (type === 'entity' && item.get('type') === 'root') {\n                editor.call('selector:set', 'entity', []);\n                // editor.emit('attributes:inspect[editorSettings]');\n                type = 'editorSettings';\n                item = editor.call('settings:data');\n            }\n\n            self.selector.type = type;\n            self.type = type;\n            self.selector.add(item);\n        });\n\n        // deselecting item\n        editor.method('selector:remove', (item: Observer) => {\n\n            if (!self.enabled)\n                return;\n\n            if (!self.selector.has(item))\n                return;\n\n            self.selector.remove(item);\n        });\n\n        // deselecting\n        editor.method('selector:clear', function () {\n            if (!self.enabled)\n                return;\n\n            self.selector.clear();\n        });\n\n\n        // return select type\n        editor.method('selector:type', function () {\n            return self.selector.type;\n        });\n\n\n        // return selected count\n        editor.method('selector:count', function () {\n            return self.selector.length;\n        });\n\n\n        // return selected items\n        editor.method('selector:items', function () {\n            return self.selector.array();\n        });\n\n        // return selected items without making copy of array\n        editor.method('selector:itemsRaw', function () {\n            return self.selector.data;\n        });\n\n        // return if it has item\n        editor.method('selector:has', function (item: Observer) {\n            return self.selector.has(item);\n        });\n\n\n        editor.method('selector:enabled', function (state: boolean) {\n            self.enabled = state;\n        });\n\n    }\n\n\n}","export * from './settings-attribute';\nexport * from './keeper';","import { SettingsAttribute } from \"./settings-attribute\";\n\nexport class SettingsKeeper{\n\n\n    public constructor () {\n        new SettingsAttribute();\n    }\n\n\n}","import { Observer } from \"../../lib\";\nimport { BabylonLoader } from \"../middleware/loader/babylonLoader\";\n\nexport class SettingsAttribute {\n\n    public constructor() {\n\n\n        var sceneName = '新建场景';\n\n        let settingsData = new Observer({ scene_name: sceneName });\n\n        editor.method('settings:data', () => {\n            return settingsData;\n        });\n\n        editor.on('scene:name', function (name: string) {\n            settingsData.set('scene_name', name);\n            sceneName = name;\n        });\n\n        editor.method('editorSettings:panel:unfold', function (panel: string) {\n            var element = editor.call('layout.attributes').dom.querySelector('.ui-panel.component.foldable.' + panel);\n            if (element && element.ui) {\n                element.ui.folded = false;\n            }\n        });\n\n        editor.on('attributes:inspect[editorSettings]', function () {\n            editor.call('attributes:header', '场景设置');\n        });\n\n\n        // inspecting\n        editor.on('attributes:inspect[editorSettings]', function () {\n            var panelScene = editor.call('attributes:addPanel');\n            panelScene.class.add('component');\n\n            // scene name\n            var fieldName = editor.call('attributes:addField', {\n                parent: panelScene,\n                name: '场景名',\n                type: 'string',\n                value: sceneName\n            });\n            var changingName = false;\n            fieldName.on('change', function (value: string) {\n                if (changingName)\n                    return;\n\n                // editor.call('realtime:scene:op', {\n                //     p: ['name'],\n                //     od: sceneName || '',\n                //     oi: value || ''\n                // });\n                editor.emit('scene:name', value);\n                let rootEntity = editor.call('entities:root');\n                if(rootEntity) {\n                    rootEntity.set('name', value);\n                    BabylonLoader.changeSceneName(rootEntity.get('resource_id'), value);\n                }\n            });\n            // var evtNameChange = editor.on('realtime:scene:op:name', function (op) {\n            //     changingName = true;\n            //     fieldName.value = op.oi;\n            //     changingName = false;\n            // });\n            // fieldName.on('destroy', function () {\n            //     evtNameChange.unbind();\n            // });\n            // // reference\n            // editor.call('attributes:reference:attach', 'settings:name', fieldName.parent.innerElement.firstChild.ui);\n\n\n        });\n\n    }\n\n\n}","export * from './toolbar-top-control';\nexport * from './keeper';\nexport * from './toolbar-logo';\nexport * from './toolbar-gizmos';\nexport * from './toolbar-history';\nexport * from './toolbar-help';\nexport * from './toolbar-control';\nexport * from './toolbar-editor-settings';\nexport * from './toolbar-publish';\nexport * from './toolbar-scene';\nexport * from './toolbar-camera';\nexport * from './toolbar-status';\n","import { ToolbarLogo } from \"./toolbar-logo\";\nimport { ToolbarGizmos } from \"./toolbar-gizmos\";\nimport { ToolbarHistory } from \"./toolbar-history\";\nimport { ToolbarHelp } from \"./toolbar-help\";\nimport { ToolbarControl } from \"./toolbar-control\";\nimport { ToolbarEditorSettings } from \"./toolbar-editor-settings\";\nimport { ToolbarPublish } from \"./toolbar-publish\";\nimport { ToolbarScene } from \"./toolbar-scene\";\nimport { ToolbarCamera } from \"./toolbar-camera\";\nimport { ToolbarStatus } from \"./toolbar-status\";\n\nexport class ToolbarKeeper {\n\n    public constructor() {\n\n        new ToolbarStatus();\n        let logo = new ToolbarLogo();\n        let gizmos = new ToolbarGizmos();\n        let history = new ToolbarHistory();\n\n        let help = new ToolbarHelp();\n        let control = new ToolbarControl();\n        let settings = new ToolbarEditorSettings();\n        let publish = new ToolbarPublish();\n\n\n        let scene = new ToolbarScene();\n\n        new ToolbarCamera();\n\n    }\n\n}","import { VeryEngine } from \"../../engine\";\nimport { SelectField, Tooltip } from \"../../ui\";\n\nexport class ToolbarCamera {\n\n    public constructor() {\n\n        var viewport = editor.call('layout.viewport');\n\n        // var options: { [key: string]: string } = {\n        //     'perspective': '透视相机|perspective',\n        //     'orthographic': '正交相机|orthographic',\n        //     'left': '左视图|left',\n        //     'right': '右视图|right',\n        //     'top': '顶视图|top',\n        //     'bottom': '底视图|bottom',\n        //     'front': '前视图|front',\n        //     'back': '后视图|back',\n        // };\n        var options: { [key: string]: string } = {\n            '透视相机': '透视相机|perspective',\n            '正交相机': '正交相机|orthographic',\n            '左视图': '左视图|left',\n            '右视图': '右视图|right',\n            '顶视图': '顶视图|top',\n            '底视图': '底视图|bottom',\n            '前视图': '前视图|front',\n            '后视图': '后视图|back',\n        };\n        var index: any = {};\n        var events = {};\n\n        var combo = new SelectField({\n            options: options,\n            optionClassNamePrefix: 'viewport-camera',\n            // default: '透视相机'\n        });\n        combo.disabledClick = true;\n        combo.class!.add('viewport-camera');\n\n        var tooltip = Tooltip.attach({\n            target: combo.element!,\n            text: '场景相机类型选择',\n            align: 'top',\n            root: editor.call('layout.root')\n        });\n\n        combo.on('open', function () {\n            tooltip.disabled = true;\n            // console.warn('修改编辑器相机类型: open');\n        });\n        combo.on('close', function (title: string) {\n            tooltip.disabled = false;\n            // console.warn('修改编辑器相机类型: close: ' + title);\n            if(title) {\n                combo.value = title;\n            }\n        });\n\n        combo.on('change', function (value: any) {\n            // console.warn('修改编辑器相机类型: ' + value);\n\n            editor.call('camera:change:mode', value);\n            viewport.value = value;\n        });\n\n        viewport.append(combo);\n\n        combo.value = '透视相机';\n\n        editor.method('camera:ortho:set', () => {\n            combo.value = '正交相机';\n        });\n\n        var refreshOptions = function () {\n            combo._updateOptions(options);\n\n            var writePermission = editor.call('permissions:write');\n            for (var key in combo.optionElements) {\n                if (index[key].__editorCamera)\n                    continue;\n\n                if (writePermission) {\n                    combo.optionElements[key].classList.remove('hidden');\n                } else {\n                    combo.optionElements[key].classList.add('hidden');\n                }\n            }\n        };\n\n        var list = [{\n            name: 'perspective',\n            title: 'Perspective',\n            className: 'viewport-camera-perspective',\n            position: new BABYLON.Vector3(9.2, 6, 9),\n            rotation: new BABYLON.Vector3(-25, 45, 0),\n            default: true\n        }, {\n            name: 'top',\n            title: 'Top',\n            className: 'viewport-camera-top',\n            position: new BABYLON.Vector3(0, 1000, 0),\n            rotation: new BABYLON.Vector3(-90, 0, 0),\n            ortho: true\n        }, {\n            name: 'bottom',\n            title: 'Bottom',\n            className: 'viewport-camera-bottom',\n            position: new BABYLON.Vector3(0, -1000, 0),\n            rotation: new BABYLON.Vector3(90, 0, 0),\n            ortho: true\n        }, {\n            name: 'front',\n            title: 'Front',\n            className: 'viewport-camera-front',\n            position: new BABYLON.Vector3(0, 0, 1000),\n            rotation: new BABYLON.Vector3(0, 0, 0),\n            ortho: true\n        }, {\n            name: 'back',\n            title: 'Back',\n            className: 'viewport-camera-back',\n            position: new BABYLON.Vector3(0, 0, -1000),\n            rotation: new BABYLON.Vector3(0, 180, 0),\n            ortho: true\n        }, {\n            name: 'left',\n            title: 'Left',\n            className: 'viewport-camera-left',\n            position: new BABYLON.Vector3(-1000, 0, 0),\n            rotation: new BABYLON.Vector3(0, -90, 0),\n            ortho: true\n        }, {\n            name: 'right',\n            title: 'Right',\n            className: 'viewport-camera-right',\n            position: new BABYLON.Vector3(1000, 0, 0),\n            rotation: new BABYLON.Vector3(0, 90, 0),\n            ortho: true\n        }];\n\n\n        // editor.on('camera:add', function (entity) {\n        //     options[entity.getGuid()] = entity.name;\n        //     index[entity.getGuid()] = entity;\n        //     refreshOptions();\n\n        //     if (events[entity.getGuid()])\n        //         events[entity.getGuid()].unbind();\n\n        //     var obj = editor.call('entities:get', entity.getGuid());\n        //     if (obj) {\n        //         events[entity.getGuid()] = obj.on('name:set', function (value) {\n        //             options[entity.getGuid()] = value;\n        //             refreshOptions();\n\n        //             if (combo.value === entity.getGuid())\n        //                 combo.elementValue.textContent = value;\n        //         });\n        //     }\n        // });\n\n        // editor.on('camera:remove', function (entity) {\n        //     delete options[entity.getGuid()];\n        //     refreshOptions();\n\n        //     if (events[entity.getGuid()]) {\n        //         events[entity.getGuid()].unbind();\n        //         delete events[entity.getGuid()];\n        //     }\n        // });\n\n        // editor.on('camera:change', function (entity) {\n        //     combo.value = entity.getGuid();\n        // });\n\n\n\n\n    }\n\n}","import { VeryEngine } from \"../../engine\";\nimport { Button, Tooltip } from \"../../ui\";\n\nexport class ToolbarControl {\n\n    public constructor() {\n\n        // var toolbar = VeryEngine.toolbar;\n\n        // var button = new Button('&#57654;');\n        // button.class!.add('pc-icon', 'help-controls', 'bottom');\n        // toolbar.append(button);\n\n        // button.on('click', function () {\n        //     editor.call('help:controls');\n        // });\n\n        // editor.on('help:controls:open', function () {\n        //     button.class!.add('active');\n        // });\n\n        // editor.on('help:controls:close', function () {\n        //     button.class!.remove('active');\n        // });\n\n        // Tooltip.attach({\n        //     target: button.element!,\n        //     text: 'Controls',\n        //     align: 'left',\n        //     root: editor.call('layout.root')\n        // });\n\n    }\n}","import { VeryEngine } from \"../../engine\";\nimport { Button, Tooltip } from \"../../ui\";\n\nexport class ToolbarEditorSettings {\n\n\n    public constructor() {\n\n        var toolbar = VeryEngine.toolbar;\n\n        // settings button\n        var button = new Button('&#57652;');\n        button.class!.add('pc-icon', 'editor-settings', 'bottom');\n        toolbar.append(button);\n\n        button.on('click', function () {\n            // TODO:设置按钮按下\n            // editor.call('selector:set', 'editorSettings', [editor.call('settings:projectUser')]);\n        });\n\n        editor.on('attributes:clear', function () {\n            button.class!.remove('active');\n        });\n\n        editor.on('attributes:inspect[editorSettings]', function () {\n            editor.call('attributes.rootPanel').collapsed = false;\n\n            button.class!.add('active');\n        });\n\n        editor.on('viewport:expand', function (state: boolean) {\n            button.disabled = state;\n        });\n\n        Tooltip.attach({\n            target: button.element!,\n            text: '设置',\n            align: 'left',\n            root: editor.call('layout.root')\n        });\n    }\n}","import { Button, Tooltip } from \"../../ui\";\nimport { GizmosCenter } from \"../gizmos/gizmo-center\";\n\nexport class ToolbarGizmos {\n\n    public constructor() {\n\n        var root = editor.call('layout.root');\n        var toolbar = editor.call('layout.toolbar');\n\n        var activeGizmo: Nullable<Button> = null;\n        var gizmoButtons: { [key: string]: Button } = {};\n\n        // create gizmo type buttons\n        [{\n            icon: '&#57617;',\n            tooltip: '移动',\n            op: 'translate'\n        }, {\n            icon: '&#57619;',\n            tooltip: '旋转',\n            op: 'rotate'\n        }, {\n            icon: '&#57618;',\n            tooltip: '缩放',\n            op: 'scale'\n        }\n            // , {\n            //     icon: '&#57666;',\n            //     tooltip: 'Resize Element Component',\n            //     op: 'resize'\n            // }\n        ].forEach(function (item, index) {\n            var button = new Button(item.icon);\n            // button.hidden = !editor.call('permissions:write');\n            button.op = item.op;\n            button.class!.add('pc-icon');\n\n            gizmoButtons[item.op] = button;\n\n            button.on('click', function () {\n                if (activeGizmo!.op === button.op)\n                    return;\n\n                activeGizmo!.class!.remove('active');\n                activeGizmo!.tooltip!.class!.add('innactive');\n                activeGizmo = button;\n                activeGizmo!.class!.add('active');\n                activeGizmo!.tooltip!.class!.remove('innactive');\n\n                editor.call('gizmo:type', button.op);\n\n                if (button.op === 'translate') {\n                    GizmosCenter.setMode(0);\n                } else if (button.op === 'rotate') {\n                    GizmosCenter.setMode(1);\n                } else {\n                    GizmosCenter.setMode(2);\n                }\n            });\n\n            toolbar.append(button);\n\n            button.tooltip = Tooltip.attach({\n                target: button.element!,\n                text: item.tooltip,\n                align: 'left',\n                root: root\n            });\n\n            if (item.op === 'translate') {\n                activeGizmo = button;\n                button.class!.add('active');\n            } else {\n                button.tooltip.class!.add('innactive');\n            }\n        });\n\n\n        // coordinate system\n        var buttonWorld = new Button('&#57624;');\n        // buttonWorld.hidden = !editor.call('permissions:write');\n        // buttonWorld.class!.add('pc-icon', 'active');\n        buttonWorld.class!.add('pc-icon');\n        toolbar.append(buttonWorld);\n\n        buttonWorld.on('click', function () {\n            if (buttonWorld.class!.contains('active')) {\n                buttonWorld.class!.remove('active');\n                tooltipWorld.html = '<span style=\"color:#fff\">局部坐标</span> / 世界坐标';\n            } else {\n                buttonWorld.class!.add('active');\n                tooltipWorld.html = '局部坐标 / <span style=\"color:#fff\">世界坐标</span>';\n            }\n            editor.emit('gizmo:coordSystem', buttonWorld.class!.contains('active') ? 'world' : 'local');\n        });\n\n        var tooltipWorld = Tooltip.attach({\n            target: buttonWorld.element!,\n            align: 'left',\n            root: root\n        });\n        tooltipWorld.html = '<span style=\"color:#fff\">局部坐标</span> / 世界坐标';\n        tooltipWorld.class!.add('innactive');\n\n\n        // toggle grid snap\n        // var buttonSnap = new Button('&#57622;');\n        // // buttonSnap.hidden = !editor.call('permissions:write');\n        // buttonSnap.class!.add('pc-icon');\n        // buttonSnap.on('click', function () {\n        //     if (buttonSnap.class!.contains('active')) {\n        //         buttonSnap.class!.remove('active');\n        //         tooltipSnap.class!.add('innactive');\n        //     } else {\n        //         buttonSnap.class!.add('active');\n        //         tooltipSnap.class!.remove('innactive');\n        //     }\n        //     editor.call('gizmo:snap', buttonSnap.class!.contains('active'));\n        // });\n        // toolbar.append(buttonSnap);\n\n        // var tooltipSnap = Tooltip.attach({\n        //     target: buttonSnap.element!,\n        //     text: 'Snap',\n        //     align: 'left',\n        //     root: root\n        // });\n        // tooltipSnap.class!.add('innactive');\n\n\n        editor.on('permissions:writeState', function (state: boolean) {\n            for (var key in gizmoButtons) {\n                // gizmoButtons[key].hidden = !state;\n            }\n\n            // buttonWorld.hidden = !state;\n            // buttonSnap.hidden = !state;\n        });\n\n\n        // focus on entity\n        var buttonFocus = new Button('&#57623;');\n        buttonFocus.disabled = true;\n        buttonFocus.class!.add('pc-icon');\n        buttonFocus.on('click', function () {\n            editor.call('viewport:focus');\n        });\n        toolbar.append(buttonFocus);\n\n        editor.on('attributes:clear', function () {\n            buttonFocus.disabled = true;\n            tooltipFocus.class!.add('innactive');\n        });\n        editor.on('attributes:inspect[*]', function (type: string) {\n            buttonFocus.disabled = type !== 'entity';\n            if (type === 'entity') {\n                tooltipFocus.class!.remove('innactive');\n            } else {\n                tooltipFocus.class!.add('innactive');\n            }\n        });\n\n        var tooltipFocus = Tooltip.attach({\n            target: buttonFocus.element!,\n            text: '镜头聚焦当前物体 / F键',\n            align: 'left',\n            root: root\n        });\n        tooltipFocus.class!.add('innactive');\n\n        editor.call('hotkey:register', 'viewport:focus', {\n            key: 'f',\n            callback: function () {\n                // if (editor.call('picker:isOpen:otherThan', 'curve')) return;\n                editor.call('viewport:focus');\n            }\n        });\n\n    }\n\n}","import { VeryEngine } from \"../../engine\";\nimport { Button, Tooltip } from \"../../ui\";\n\nexport class ToolbarHelp {\n\n    public constructor() {\n        var toolbar = VeryEngine.toolbar;\n\n        var button = new Button('&#57656;');\n        button.class!.add('pc-icon', 'help-howdoi', 'bottom', 'push-top');\n        toolbar.append(button);\n\n        button.on('click', function () {\n            // editor.call('help:howdoi:toggle');\n            window.open('http://doc.veryengine.cn/readme/web/#/12?page_id=816', '_blank');\n        });\n\n        // editor.on('help:howdoi:open', function () {\n        //     button.class!.add('active');\n        // });\n\n        // editor.on('help:howdoi:close', function () {\n        //     button.class!.remove('active');\n        // });\n\n        Tooltip.attach({\n            target: button.element!,\n            text: '引擎版本更新说明',\n            align: 'left',\n            root: editor.call('layout.root')\n        });\n\n    }\n}","import { VeryEngine } from \"../../engine\";\nimport { Button, Tooltip } from \"../../ui\";\n\nexport class ToolbarHistory {\n\n    public constructor() {\n        var root = VeryEngine.root;\n        var toolbar = VeryEngine.toolbar;\n\n        // undo\n        var buttonUndo = new Button('&#57620;');\n        // buttonUndo.hidden = !editor.call('permissions:write');\n        buttonUndo.class!.add('pc-icon');\n        buttonUndo.enabled = editor.call('history:canUndo');\n        toolbar.append(buttonUndo);\n\n        editor.on('history:canUndo', function (state:boolean) {\n            buttonUndo.enabled = state;\n            if (state) {\n                tooltipUndo.class!.remove('innactive');\n            } else {\n                tooltipUndo.class!.add('innactive');\n            }\n        });\n        buttonUndo.on('click', function () {\n            editor.call('history:undo');\n        });\n\n        var tooltipUndo = Tooltip.attach({\n            target: buttonUndo.element!,\n            text: '撤销',\n            align: 'left',\n            root: root\n        });\n        if (!editor.call('history:canUndo'))\n            tooltipUndo.class!.add('innactive');\n\n\n        // redo\n        var buttonRedo = new Button('&#57621;');\n        // buttonRedo.hidden = !editor.call('permissions:write');\n        buttonRedo.class!.add('pc-icon');\n        buttonRedo.enabled = editor.call('history:canRedo');\n        toolbar.append(buttonRedo);\n\n        editor.on('history:canRedo', function (state: boolean) {\n            buttonRedo.enabled = state;\n            if (state) {\n                tooltipRedo.class!.remove('innactive');\n            } else {\n                tooltipRedo.class!.add('innactive');\n            }\n        });\n        buttonRedo.on('click', function () {\n            editor.call('history:redo');\n        });\n\n        var tooltipRedo = Tooltip.attach({\n            target: buttonRedo.element!,\n            text: '重做',\n            align: 'left',\n            root: root\n        });\n        if (!editor.call('history:canUndo'))\n            tooltipRedo.class!.add('innactive');\n\n        editor.on('permissions:writeState', function (state: boolean) {\n            buttonUndo.hidden = buttonRedo.hidden = !state;\n        });\n    }\n\n\n}","import { Button } from \"../../ui\";\n\nexport class ToolbarLogo {\n\n    public constructor() {\n\n        var root = editor.call('layout.root');\n        var toolbar = editor.call('layout.toolbar');\n\n        var logo = new Button();\n        logo.class!.add('logo');\n        logo.on('click', function () {\n            // menu.open = true;\n            console.log('logo click');\n        });\n        toolbar.append(logo);\n\n\n    }\n\n\n}\n","import { VeryEngine } from \"../../engine\";\nimport { Button, Tooltip } from \"../../ui\";\n\nexport class ToolbarPublish {\n    public constructor() {\n\n        var toolbar = VeryEngine.toolbar;\n\n        var button = new Button('&#57911;');\n        button.class!.add('pc-icon', 'publish-download');\n        toolbar.append(button);\n\n        button.on('click', function () {\n            editor.call('picker:publish');\n        });\n\n        editor.on('picker:publish:open', function () {\n            button.class!.add('active');\n        });\n\n        editor.on('picker:publish:close', function () {\n            button.class!.remove('active');\n        });\n\n        Tooltip.attach({\n            target: button.element!,\n            text: '发布',\n            align: 'left',\n            root: editor.call('layout.root')\n        });\n    }\n}","import { VeryEngine } from \"../../engine\";\nimport { Panel, Label, Tooltip } from \"../../ui\";\n\nexport class ToolbarScene {\n\n    public constructor() {\n\n        var root = VeryEngine.root;\n        var viewport = VeryEngine.viewportPanel;\n\n        var panel = new Panel();\n        panel.class!.add('widget-title');\n        viewport.append(panel);\n\n        editor.method('layout.toolbar.scene', function () {\n            return panel;\n        });\n\n        var projectName = new Label();\n        // TODO\n        projectName.text = '当前项目名称';\n        projectName.class!.add('project-name');\n        projectName.renderChanges = false;\n        panel.append(projectName);\n\n        projectName.on('click', function (argument: any) {\n            // window.open('/project/' + config.project.id, '_blank');\n        });\n\n        editor.method(\"toolbar.project.set\", (name: string) => {\n            projectName.text = name;\n        });\n\n        Tooltip.attach({\n            target: projectName.element!,\n            text: '项目名',\n            align: 'top',\n            root: root\n        });\n\n        var sceneName = new Label();\n        // TODO\n        sceneName.text = '当前场景名';\n        sceneName.class!.add('scene-name');\n        sceneName.renderChanges = false;\n        panel.append(sceneName);\n\n        editor.method(\"toolbar.scene.set\", (name: string) => {\n            sceneName.text = name;\n        });\n\n        Tooltip.attach({\n            target: sceneName.element!,\n            text: '场景名',\n            align: 'top',\n            root: root\n        });\n\n        editor.on('scene:name', function (name: string) {\n            sceneName.text = name;\n        });\n\n        sceneName.on('click', function () {\n            // editor.call('selector:set', 'editorSettings', [editor.call('settings:projectUser')]);\n            editor.call('selector:set', 'editorSettings', [editor.call('settings:data')]);\n        });\n\n        editor.on('attributes:clear', function () {\n            sceneName.class!.remove('active');\n        });\n\n        editor.on('attributes:inspect[editorSettings]', function () {\n            sceneName.class!.add('active');\n        });\n\n        editor.on('scene:unload', function () {\n            sceneName.text = '';\n        });\n\n        // 版本管理\n        // if (!config.project.settings.useLegacyScripts) {\n        //     var name = config.self.branch.name;\n        //     if (name.length > 33) {\n        //         name = name.substring(0, 30) + '...';\n        //     }\n        //     var branchButton = new ui.Label({\n        //         text: name\n        //     });\n        //     branchButton.class.add('branch-name');\n        //     panel.append(branchButton);\n        //     branchButton.on('click', function () {\n        //         editor.call('picker:versioncontrol');\n        //     });\n\n        //     Tooltip.attach({\n        //         target: branchButton.element,\n        //         text: 'Version Control',\n        //         align: 'top',\n        //         root: root\n        //     });\n\n        //     // hide version control picker if we are not part of the team\n        //     if (!editor.call('permissions:read')) {\n        //         branchButton.hidden = true;\n        //     }\n        //     editor.on('permissions:set', function () {\n        //         branchButton.hidden = !editor.call('permissions:read');\n        //     });\n        // }\n\n        // 场景设置\n        // var sceneList = new Label();\n        // sceneList.class!.add('scene-list');\n        // panel.append(sceneList);\n\n        // Tooltip.attach({\n        //     target: sceneList.element!,\n        //     text: '场景设置',\n        //     align: 'top',\n        //     root: root\n        // });\n\n        // sceneList.on('click', function () {\n        //     // editor.call('picker:scene');\n        // });\n\n        // editor.on('picker:scene:open', function () {\n        //     sceneList.class!.add('active');\n        // });\n\n        // editor.on('picker:scene:close', function () {\n        //     sceneList.class!.remove('active');\n        // });\n\n\n    }\n}","import { Label, Progress } from \"../../ui\";\n\nexport class ToolbarStatus {\n\n    public constructor() {\n\n        var jobs: any = {};\n        var panel = editor.call('layout.statusBar');\n\n\n        // status\n        var status = new Label('VeRyEngine');\n        status.renderChanges = false;\n        status.class!.add('status');\n        panel.append(status);\n\n        // progress\n        var progress = new Progress();\n        progress.class!.add('jobsProgress');\n        panel.append(progress);\n\n        // jobs\n        var jobsCount = new Label('0');\n        jobsCount.renderChanges = false;\n        jobsCount.class!.add('jobsCount');\n        panel.append(jobsCount);\n\n\n        // status text\n        editor.method('status:text', function (text: string) {\n            status.text = text;\n            status.class!.remove('error');\n        });\n\n\n        // status error\n        editor.method('status:error', function (text: string) {\n            status.text = text;\n            status.class!.add('error');\n        });\n\n        // update jobs\n        var updateJobs = function () {\n            var count = Object.keys(jobs).length;\n            jobsCount.text = count.toString();\n\n            if (count > 0) {\n                var least = 1;\n                for (var key in jobs) {\n                    if (jobs[key] < least)\n                        least = jobs[key];\n                }\n                progress.progress = least;\n                progress.class!.add('active');\n            } else {\n                progress.class!.remove('active');\n                progress.progress = 1;\n            }\n        };\n\n        // status job\n        editor.method('status:job', function (id: string, value: any) {\n            if (jobs.hasOwnProperty(id) && value === undefined) {\n                delete jobs[id];\n            } else {\n                jobs[id] = value;\n            }\n\n            updateJobs();\n        });\n\n    }\n\n}","import { Panel, Button, Tooltip } from '../../ui';\nimport { VeryEngine } from '../../engine';\nimport { Config } from '../global';\n\nexport class ToolbarTopControl {\n\n\n\n\n    public constructor() {\n\n        // panel\n        var panel = new Panel();\n        panel.class!.add('top-controls');\n        VeryEngine.viewportPanel.append(panel);\n\n        editor.method('layout.toolbar.launch', function () {\n            return panel;\n        });\n\n        // fullscreen button\n        var buttonExpand = new Button('&#57639;');\n        buttonExpand.class!.add('icon', 'expand');\n        panel.append(buttonExpand);\n\n        buttonExpand.on('click', function () {\n            editor.call('viewport:expand');\n        });\n\n        editor.on('viewport:expand', function (state: boolean) {\n            if (state) {\n                tooltipExpand.text = '还原 / 空格键';\n                buttonExpand.class!.add('active');\n            } else {\n                tooltipExpand.text = '最大化 / 空格键';\n                buttonExpand.class!.remove('active');\n            }\n\n            tooltipExpand.hidden = true;\n        });\n\n        var tooltipExpand = Tooltip.attach({\n            target: buttonExpand.element!,\n            text: '最大化 / 空格键',\n            align: 'top',\n            root: VeryEngine.root\n        });\n\n        // launch\n        var launch = new Panel();\n        launch.class!.add('launch');\n        panel.append(launch);\n        launch.style!.marginRight = '2px';\n        // launch.disabled = true;\n\n        var buttonLaunch = new Button('&#57649;');\n        buttonLaunch.class!.add('icon');\n        launch.append(buttonLaunch);\n\n        buttonLaunch.on('click', function () {\n            window.open(window.location.protocol + '//' + window.location.host + '/publish/' + Config.projectID);\n        });\n\n        var tooltipLaunch = Tooltip.attach({\n            target: buttonLaunch.element!,\n            text: '运行',\n            align: 'top',\n            root: VeryEngine.root\n        });\n\n\n    }\n\n\n}","import { Events } from \"../../lib\";\n\nexport class Ajax {\n\n    public constructor(args: object | string) {\n        if (typeof (args) === 'string')\n            args = { url: args };\n\n        return new AjaxRequest(args);\n    }\n\n    public static get(url: string): AjaxRequest {\n        return new AjaxRequest({ url: url });\n    }\n\n    public static post(url: string, data: any): AjaxRequest {\n        return new AjaxRequest({\n            method: 'POST',\n            url: url,\n            data: data\n        });\n    }\n\n    public static put(url: string, data: any): AjaxRequest {\n        return new AjaxRequest({\n            method: 'PUT',\n            url: url,\n            data: data\n        });\n    }\n\n    public static delete(url: string): AjaxRequest {\n        return new AjaxRequest({\n            method: 'DELETE',\n            url: url\n        });\n    }\n\n    public static params: { [key: string]: any } = {};\n\n    public static param(name: string, value: any): void {\n        Ajax.params[name] = value;\n    }\n\n}\n\n\nexport class AjaxRequest extends Events {\n\n    private _progress: number = 0;\n\n    private _xhr: XMLHttpRequest;\n\n    public notJson: boolean;\n\n    public constructor(args: any) {\n        super();\n\n        if (!args) {\n            throw new Error('ajax请求无参数，请检查！')\n        }\n\n        this._progress = 0.0;\n        this.emit('progress', this._progress);\n\n        this._xhr = new XMLHttpRequest();\n\n        // send cookies\n        if (args.cookies)\n            this._xhr.withCredentials = true;\n\n        // events\n        this._xhr.addEventListener('load', this._onLoad.bind(this), false);\n        // this._xhr.addEventListener('progress', this._onProgress.bind(this), false);\n        this._xhr.upload.addEventListener('progress', this._onProgress.bind(this), false);\n        this._xhr.addEventListener('error', this._onError.bind(this), false);\n        this._xhr.addEventListener('abort', this._onAbort.bind(this), false);\n\n        // url\n        let url: string = args.url;\n\n        // query\n        if (args.query && Object.keys(args.query).length) {\n            if (url.indexOf('?') === -1) {\n                url += '?';\n            }\n\n            var query = [];\n            for (var key in args.query) {\n                query.push(key + '=' + args.query[key]);\n            }\n\n            url += query.join('&');\n        }\n\n        // templating\n        var parts = url.split('{{');\n        if (parts.length > 1) {\n            for (var i = 1; i < parts.length; i++) {\n                var ends = parts[i].indexOf('}}');\n                var key = parts[i].slice(0, ends);\n\n                if (Ajax.params[key] === undefined)\n                    continue;\n\n                // replace\n                parts[i] = Ajax.params[key] + parts[i].slice(ends + 2);\n            }\n\n            url = parts.join('');\n        }\n\n        // open request\n        this._xhr.open(args.method || 'GET', url, true);\n\n        // 返回数据是否为json格式\n        this.notJson = args.notJson || false;\n\n        // header for PUT/POST\n        if (!args.ignoreContentType && (args.method === 'PUT' || args.method === 'POST' || args.method === 'DELETE'))\n            this._xhr.setRequestHeader('Content-Type', 'application/json');\n\n        // TODO: 权限header参数\n        // if (args.auth && config.accessToken) {\n        //     this._xhr.setRequestHeader('Authorization', 'Bearer ' + config.accessToken);\n        // }\n\n        if (args.headers) {\n            for (var key in args.headers)\n                this._xhr.setRequestHeader(key, args.headers[key]);\n        }\n\n        // stringify data if needed\n        if (args.data && typeof (args.data) !== 'string' && !(args.data instanceof FormData)) {\n            args.data = JSON.stringify(args.data);\n        }\n\n        // make request\n        this._xhr.send(args.data || null);\n    }\n\n    private _onLoad(): void {\n        this._progress = 1.0;\n        this.emit('progress', 1.0);\n\n        if (this._xhr.status === 200 || this._xhr.status === 201) {\n            if (this.notJson) {\n                this.emit('load', this._xhr.status, this._xhr.responseText);\n            } else {\n                try {\n                    var json = JSON.parse(this._xhr.responseText);\n                } catch (ex) {\n                    this.emit('error', this._xhr.status || 0, new Error('invalid json'));\n                    return;\n                }\n                this.emit('load', this._xhr.status, json);\n            }\n        } else {\n            try {\n                var json = JSON.parse(this._xhr.responseText);\n                var msg = json.message;\n                if (!msg) {\n                    msg = json.error || (json.response && json.response.error);\n                }\n\n                if (!msg) {\n                    msg = this._xhr.responseText;\n                }\n\n                this.emit('error', this._xhr.status, msg);\n            } catch (ex) {\n                this.emit('error', this._xhr.status);\n            }\n        }\n    }\n\n    private _onError(evt: any): void {\n        this.emit('error', 0, evt);\n    }\n\n    private _onAbort(evt: any): void {\n        this.emit('error', 0, evt);\n    }\n\n    private _onProgress(evt: any): void {\n        if (!evt.lengthComputable)\n            return;\n\n        var progress = evt.loaded / evt.total;\n\n        if (progress !== this._progress) {\n            this._progress = progress;\n            this.emit('progress', this._progress);\n        }\n    }\n\n    public abort(): void {\n        this._xhr.abort();\n    }\n\n\n}","export class ComponentsLogos {\n\n  public constructor() {\n    editor.method('components:logos', function () {\n      return {\n        'animation': '&#57875;',\n        'audiolistener': '&#57750;',\n        'audiosource': '&#57751;',\n        'sound': '&#57751;',\n        'camera': '&#57874;',\n        'collision': '&#57735;',\n        'directional': '&#57746;',\n        'point': '&#57745;',\n        'spot': '&#57747;',\n        'light': '&#57748;',\n        'model': '&#57736;',\n        'particlesystem': '&#57753;',\n        'rigidbody': '&#57737;',\n        'script': '&#57910;',\n        'screen': '&#58371;',\n        'sprite': '&#58261;',\n        'element': '&#58232;',\n        'layoutgroup': '&#57667;',\n        'layoutchild': '&#57667;',\n        'scrollview': '&#58376;',\n        'scrollbar': '&#58377;',\n        'button': '&#58373;',\n        'zone': '&#57910;',\n        '2d-screen': '&#58371;',\n        '3d-screen': '&#58372;',\n        'text-element': '&#58374;',\n        'image-element': '&#58005;',\n        'group-element': '&#58375;',\n        'userinterface': '&#58370;'\n      };\n    });\n  }\n\n\n\n}","export class ContextMenu {\n\n  public constructor() {\n    // 阻止默认鼠标右键菜单\n    window.addEventListener('contextmenu', function (evt) {\n      evt.preventDefault();\n    }, false);\n  }\n\n}","export class Debug {\n\n    private allow: boolean;\n\n    public constructor(allow: boolean = true) {\n        this.allow = allow;\n    }\n\n    public log(message?: any, ...optionalParams: any[]): void {\n        if (!this.allow) return;\n        console.log(message, optionalParams);\n    }\n\n    public warn(message?: any, ...optionalParams: any[]): void {\n        if (!this.allow) return;\n        console.warn(message, optionalParams);\n    }\n\n    public error(message?: any, ...optionalParams: any[]): void {\n        if (!this.allow) return;\n        console.error(message, optionalParams);\n    }\n\n}","export class EventProxy {\n\n    private _callbacks: { [key: string]: Function[] };\n    private _fired: { [key: string]: any } = {};\n    private _after: any;\n\n    public debug: Function;\n\n    /*!\n     * refs\n     */\n    private SLICE = Array.prototype.slice;\n    private CONCAT = Array.prototype.concat;\n    private ALL_EVENT: string = '__all__';\n\n    private later = (typeof setImmediate !== 'undefined' && setImmediate) ||\n        (typeof process !== 'undefined' && process.nextTick) || function (fn) {\n            setTimeout(fn, 0);\n        };\n\n\n    public constructor(debug?: () => void) {\n        this.debug = debug || function () { };\n        this._callbacks = {};\n    }\n\n    public addListener(ev: string, callback: Function): EventProxy {\n        this.debug('Add listener for %s', ev);\n        this._callbacks[ev] = this._callbacks[ev] || [];\n        this._callbacks[ev].push(callback);\n        return this;\n    }\n\n    public bind(ev: string, callback: Function): EventProxy {\n        return this.addListener(ev, callback);\n    }\n\n    public on(ev: string, callback: Function): EventProxy {\n        return this.addListener(ev, callback);\n    }\n\n    public subscribe(ev: string, callback: Function): EventProxy {\n        return this.addListener(ev, callback);\n    }\n\n    public headbind(ev: string, callback: Function): EventProxy {\n        this.debug('Add listener for %s', ev);\n        this._callbacks[ev] = this._callbacks[ev] || [];\n        this._callbacks[ev].unshift(callback);\n        return this;\n    }\n\n    public removeListener(eventname?: string, callback?: Nullable<Function>): EventProxy {\n        var calls = this._callbacks;\n        if (!eventname) {\n            this.debug('Remove all listeners');\n            this._callbacks = {};\n        } else {\n            if (!callback) {\n                this.debug('Remove all listeners of %s', eventname);\n                calls[eventname] = [];\n            } else {\n                var list = calls[eventname];\n                if (list) {\n                    var l = list.length;\n                    for (var i = 0; i < l; i++) {\n                        if (callback === list[i]) {\n                            this.debug('Remove a listener of %s', eventname);\n                            list.splice(i, 1);\n                        }\n                    }\n                }\n            }\n        }\n        return this;\n    }\n\n    public unbind(eventname?: string, callback?: Nullable<Function>): EventProxy {\n        return this.removeListener(eventname, callback);\n    }\n\n    public removeAllListeners(): EventProxy {\n        return this.unbind();\n    }\n\n    public bindForAll(callback: Function): void {\n        this.bind(this.ALL_EVENT, callback);\n    }\n\n    public unbindForAll(callback: Function): void {\n        this.unbind(this.ALL_EVENT, callback);\n    }\n\n\n    public trigger(eventname: string, data?: any, ...args: any[]): EventProxy {\n        var list, ev, callback, i, l;\n        var both = 2;\n        var calls = this._callbacks;\n        this.debug('Emit event %s with data %j', eventname, data);\n        // 运行当前ev和ALL\n        while (both--) {\n            ev = both ? eventname : this.ALL_EVENT;\n            list = calls[ev];\n            if (list) {\n                for (i = 0, l = list.length; i < l; i++) {\n                    if (!(callback = list[i])) {\n                        list.splice(i, 1);\n                        i--;\n                        l--;\n                    } else {\n                        var args = [];\n                        var start = both ? 1 : 0;\n                        for (var j = start; j < arguments.length; j++) {\n                            args.push(arguments[j]);\n                        }\n                        callback.apply(this, args);\n                    }\n                }\n            }\n        }\n        return this;\n    }\n\n    public emit(eventname: string, data?: any): EventProxy {\n        return this.trigger(eventname, data);\n    }\n\n    public fire(eventname: string, data?: any): EventProxy {\n        return this.trigger(eventname, data);\n    }\n\n    public once(ev: string, callback: Function): EventProxy {\n        var self = this;\n        var wrapper = function () {\n            callback.apply(self, arguments);\n            self.unbind(ev, wrapper);\n        };\n        this.bind(ev, wrapper);\n        return this;\n    }\n\n    // TODO\n    // public emitLater() {\n    //     var self = this;\n    //     var args: any[] = [];\n\n    //     for(var i = 0; i < arguments.length; i++) {\n    //         args.push(arguments[i]);\n    //     }\n    //     this.later(function () {\n    //         self.trigger.apply(self, args);\n    //     });\n    // }\n\n\n    public immediate(ev: string, callback: Function, data: any) {\n        this.bind(ev, callback);\n        this.trigger(ev, data);\n        return this;\n    }\n\n    private _assign(eventnames: string[], cb: Function, once: boolean): void {\n        var proxy = this;\n        // var argsLength = arguments.length;\n        var times = 0;\n        var flag: { [key: string]: boolean } = {};\n\n        // Check the arguments length.\n        // if (argsLength < 3) {\n        //     return this;\n        // }\n\n        var events = eventnames;\n        var callback = cb;\n        var isOnce = once;\n\n        // Check the callback type.\n        if (typeof callback !== \"function\") {\n            return;\n        }\n        this.debug('Assign listener for events %j, once is %s', events, !!isOnce);\n\n        var bind = function (key: string) {\n            if (isOnce) {\n                proxy.once(key, (data: any) => {\n                    proxy._fired[key] = proxy._fired[key] || {};\n                    proxy._fired[key].data = data;\n                    if (!flag[key]) {\n                        flag[key] = true;\n                        times++;\n                    }\n                });\n            } else {\n                proxy.bind(key, (data: any) => {\n                    proxy._fired[key] = proxy._fired[key] || {};\n                    proxy._fired[key].data = data;\n                    if (!flag[key]) {\n                        flag[key] = true;\n                        times++;\n                    }\n                })\n            }\n        };\n\n        var length = events.length;\n        for (var index = 0; index < length; index++) {\n            bind(events[index]);\n        }\n\n        var _all = function (event: string) {\n            if (times < length) {\n                return;\n            }\n            if (!flag[event]) {\n                return;\n            }\n            var data = [];\n            for (var index = 0; index < length; index++) {\n                data.push(proxy._fired[events[index]].data);\n            }\n            if (isOnce) {\n                proxy.unbindForAll(_all);\n            }\n            proxy.debug('Events %j all emited with data %j', events, data);\n            callback.apply(null, data);\n        };\n        proxy.bindForAll(_all);\n    }\n\n\n    public all(eventname1: string | string[], eventname2: string | string[], callback: Function): EventProxy {\n        var names: string[] = [];\n        if (typeof eventname1 === 'string') {\n            names.push(eventname1);\n        } else {\n            names = this.CONCAT.apply(names, <string[]>eventname1);\n        }\n        if (typeof eventname2 === 'string') {\n            names.push(eventname2);\n        } else {\n            names = this.CONCAT.apply(names, <string[]>eventname2);\n        }\n        this._assign.apply(this, [names, callback, true]);\n        return this;\n    }\n\n    public assign(eventname1: string | string[], eventname2: string | string[], callback: Function): EventProxy {\n        return this.all(eventname1, eventname2, callback);\n    }\n\n    public fail(callback: Function): EventProxy {\n        var that = this;\n        that.once('error', function () {\n            that.unbind();\n            // put all arguments to the error handler\n            // fail(function(err, args1, args2, ...){})\n            callback.apply(null, arguments);\n        });\n        return this;\n    }\n\n    public throw(err: Error): void {\n        this.emit('error', err);\n    }\n\n    public tail(eventname1: string | string[], eventname2: string | string[], callback: Function): EventProxy {\n        var names: string[] = [];\n        if (typeof eventname1 === 'string') {\n            names.push(eventname1);\n        } else {\n            names = this.CONCAT.apply(names, <string[]>eventname1);\n        }\n        if (typeof eventname2 === 'string') {\n            names.push(eventname2);\n        } else {\n            names = this.CONCAT.apply(names, <string[]>eventname2);\n        }\n        this._assign.apply(this, [names, callback, false]);\n        return this;\n    }\n\n    public assignAll(eventname1: string | string[], eventname2: string | string[], callback: Function): EventProxy {\n        return this.tail(eventname1, eventname2, callback);\n    }\n\n    public assignAlways(eventname1: string | string[], eventname2: string | string[], callback: Function): EventProxy {\n        return this.tail(eventname1, eventname2, callback);\n    }\n\n    /**\n     * The callback will be executed after the event be fired N times.\n     * @param {String} eventname Event name.\n     * @param {Number} times N times.\n     * @param {Function} callback Callback, that will be called after event was fired N times.\n     */\n    public after(eventname: string, times: number, callback: Function): EventProxy {\n        if (times === 0) {\n            callback.call(null, []);\n            return this;\n        }\n        var proxy = this,\n            firedData: any[] = [];\n        this._after = this._after || {};\n        var group = eventname + '_group';\n        this._after[group] = {\n            index: 0,\n            results: []\n        };\n        this.debug('After emit %s times, event %s\\'s listenner will execute', times, eventname);\n        var all = function (name: string, data: any) {\n            if (name === eventname) {\n                times--;\n                firedData.push(data);\n                if (times < 1) {\n                    proxy.debug('Event %s was emit %s, and execute the listenner', eventname, times);\n                    proxy.unbindForAll(all);\n                    callback.apply(null, [firedData]);\n                }\n            }\n            if (name === group) {\n                times--;\n                proxy._after[group].results[data.index] = data.result;\n                if (times < 1) {\n                    proxy.debug('Event %s was emit %s, and execute the listenner', eventname, times);\n                    proxy.unbindForAll(all);\n                    callback.call(null, proxy._after[group].results);\n                }\n            }\n        };\n        proxy.bindForAll(all);\n        return this;\n    }\n\n    /**\n     * The `after` method's helper. Use it will return ordered results.\n     * If you need manipulate result, you need callback\n     * Examples:\n     * ```js\n     * var ep = new EventProxy();\n     * ep.after('file', files.length, function (list) {\n     *   // Ordered results\n     * });\n     * for (var i = 0; i < files.length; i++) {\n     *   fs.readFile(files[i], 'utf-8', ep.group('file'));\n     * }\n     * ```\n     * @param {String} eventname Event name, shoule keep consistent with `after`.\n     * @param {Function} callback Callback function, should return the final result.\n     */\n    public group(eventname: string, callback: Function) {\n        var that = this;\n        var group = eventname + '_group';\n        var index = that._after[group].index;\n        that._after[group].index++;\n        return function (err: Error, data: any) {\n            if (err) {\n                // put all arguments to the error handler\n                that.throw(err);\n            }\n            that.emit(group, {\n                index: index,\n                // callback(err, args1, args2, ...)\n                result: callback ? callback.apply(null, that.SLICE.call(arguments, 1)) : data\n            });\n        };\n    }\n\n    /**\n     * The callback will be executed after any registered event was fired. It only executed once.\n     * @param {String} eventname1 Event name.\n     * @param {String} eventname2 Event name.\n     * @param {Function} callback The callback will get a map that has data and eventname attributes.\n     */\n    public any(eventname1: string | string[], eventname2: string | string[], callback: Function) {\n        var proxy = this,\n            events = proxy.SLICE.call(arguments, 0, -1),\n            _eventname = events.join(\"_\");\n\n        proxy.debug('Add listenner for Any of events %j emit', events);\n        proxy.once(_eventname, callback);\n\n        var _bind = function (key: string) {\n            proxy.bind(key, function (data: any) {\n                proxy.debug('One of events %j emited, execute the listenner');\n                proxy.trigger(_eventname, { \"data\": data, eventName: key });\n            });\n        };\n\n        for (var index = 0; index < events.length; index++) {\n            _bind(events[index]);\n        }\n    }\n\n    /**\n     * The callback will be executed when the event name not equals with assigned event.\n     * @param {String} eventname Event name.\n     * @param {Function} callback Callback.\n     */\n    public not(eventname: string, callback: Function) {\n        var proxy = this;\n        proxy.debug('Add listenner for not event %s', eventname);\n        proxy.bindForAll(function (name: string, data: any) {\n            if (name !== eventname) {\n                proxy.debug('listenner execute of event %s emit, but not event %s.', name, eventname);\n                callback(data);\n            }\n        });\n    }\n\n    /**\n     * Success callback wrapper, will handler err for you.\n     *\n     * ```js\n     * fs.readFile('foo.txt', ep.done('content'));\n     *\n     * // equal to =>\n     *\n     * fs.readFile('foo.txt', function (err, content) {\n     *   if (err) {\n     *     return ep.emit('error', err);\n     *   }\n     *   ep.emit('content', content);\n     * });\n     * ```\n     *\n     * ```js\n     * fs.readFile('foo.txt', ep.done('content', function (content) {\n     *   return content.trim();\n     * }));\n     *\n     * // equal to =>\n     *\n     * fs.readFile('foo.txt', function (err, content) {\n     *   if (err) {\n     *     return ep.emit('error', err);\n     *   }\n     *   ep.emit('content', content.trim());\n     * });\n     * ```\n     * @param {Function|String} handler, success callback or event name will be emit after callback.\n     * @return {Function}\n     */\n    public done(handler: Function | String, callback?: Function) {\n        var that = this;\n        return function (err: Error, data: any) {\n            if (err) {\n                // put all arguments to the error handler\n                return that.emit.apply(that, ['error', err]);\n            }\n\n            // callback(err, args1, args2, ...)\n            var args = that.SLICE.call(arguments, 1);\n\n            if (typeof handler === 'string') {\n                if (callback) {\n                    // only replace the args when it really return a result\n                    return that.emit(handler, callback.apply(null, args));\n                } else {\n                    // put all arguments to the done handler\n                    //ep.done('some');\n                    //ep.on('some', function(args1, args2, ...){});\n                    return that.emit.apply(that, [handler, args]);\n                }\n            }\n\n            // speed improve for mostly case: `callback(err, data)`\n            if (arguments.length <= 2) {\n                return (<Function>handler)(data);\n            }\n\n            // callback(err, args1, args2, ...)\n            (<Function>handler).apply(null, args);\n        };\n    }\n\n    //     /**\n    //    * make done async\n    //    * @return {Function} delay done\n    //    */\n    //     EventProxy.prototype.doneLater = function (handler, callback) {\n    //         var _doneHandler = this.done(handler, callback);\n    //         return function (err, data) {\n    //             var args = arguments;\n    //             later(function () {\n    //                 _doneHandler.apply(null, args);\n    //             });\n    //         };\n    //     };\n\n    /**\n     * Create a new EventProxy\n     * Examples:\n     * ```js\n     * var ep = EventProxy.create();\n     * ep.assign('user', 'articles', function(user, articles) {\n     *   // do something...\n     * });\n     * // or one line ways: Create EventProxy and Assign\n     * var ep = EventProxy.create('user', 'articles', function(user, articles) {\n     *   // do something...\n     * });\n     * ```\n     * @return {EventProxy} EventProxy instance\n     */\n    public static create(): EventProxy {\n        var ep = new EventProxy();\n        return ep;\n    }\n\n    public static createWithArgs(eventname1: string | string[], eventname2: string | string[], callback: Function): EventProxy {\n        var ep = new EventProxy();\n        var names: string[] = [];\n        if (typeof eventname1 === 'string') {\n            names.push(eventname1);\n        } else {\n            names = ep.CONCAT.apply(names, <string[]>eventname1);\n        }\n        if (typeof eventname2 === 'string') {\n            names.push(eventname2);\n        } else {\n            names = ep.CONCAT.apply(names, <string[]>eventname2);\n        }\n        ep._assign.apply(this, [names, callback, true]);\n        return ep;\n    }\n\n\n}","export class GUID {\n\n  /**\n   * 创建GUID唯一标志，注意：采用大数法，有很小的可能性会重复，一般够用；\n   */\n  public static create(): string {\n    return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function (c: string) {\n      let r = Math.random() * 16 | 0,\n        v = (c === 'x') ? r : (r & 0x3 | 0x8);\n      return v.toString(16);\n    });\n  }\n\n}","export * from './components-logos';\nexport * from './context-menu';\nexport * from './guid';\nexport * from './eventproxy';\nexport * from './debug';\nexport * from './tools';\nexport * from './ajax';\nexport * from './sha1';\n","export class SHA1 {\n\n    public constructor() {\n\n    }\n\n\n    // SHA1  \n    private static add(x: any, y: any) {\n        return ((x & 0x7FFFFFFF) + (y & 0x7FFFFFFF)) ^ (x & 0x80000000) ^ (y & 0x80000000);\n    }\n\n    private static SHA1hex(num: any) {\n        var sHEXChars = \"0123456789abcdef\";\n        var str = \"\";\n        for (var j = 7; j >= 0; j--)\n            str += sHEXChars.charAt((num >> (j * 4)) & 0x0F);\n        return str;\n    }\n\n    private static AlignSHA1(sIn: any) {\n        var nblk = ((sIn.length + 8) >> 6) + 1,\n            blks = new Array(nblk * 16);\n        for (var i = 0; i < nblk * 16; i++) blks[i] = 0;\n        for (i = 0; i < sIn.length; i++)\n            blks[i >> 2] |= sIn.charCodeAt(i) << (24 - (i & 3) * 8);\n        blks[i >> 2] |= 0x80 << (24 - (i & 3) * 8);\n        blks[nblk * 16 - 1] = sIn.length * 8;\n        return blks;\n    }\n\n    private static rol(num: any, cnt: any) {\n        return (num << cnt) | (num >>> (32 - cnt));\n    }\n\n    private static ft(t: any, b: any, c: any, d: any) {\n        if (t < 20) return (b & c) | ((~b) & d);\n        if (t < 40) return b ^ c ^ d;\n        if (t < 60) return (b & c) | (b & d) | (c & d);\n        return b ^ c ^ d;\n    }\n\n    private static kt(t: any) {\n        return (t < 20) ? 1518500249 : (t < 40) ? 1859775393 :\n            (t < 60) ? -1894007588 : -899497514;\n    }\n\n    public static SHA1(sIn: any) {\n        var x = SHA1.AlignSHA1(sIn);\n        var w = new Array(80);\n        var a = 1732584193;\n        var b = -271733879;\n        var c = -1732584194;\n        var d = 271733878;\n        var e = -1009589776;\n        for (var i = 0; i < x.length; i += 16) {\n            var olda = a;\n            var oldb = b;\n            var oldc = c;\n            var oldd = d;\n            var olde = e;\n            for (var j = 0; j < 80; j++) {\n                if (j < 16) w[j] = x[i + j];\n                else w[j] = SHA1.rol(w[j - 3] ^ w[j - 8] ^ w[j - 14] ^ w[j - 16], 1);\n                var  t = SHA1.add(SHA1.add(SHA1.rol(a, 5), SHA1.ft(j, b, c, d)), SHA1.add(SHA1.add(e, w[j]), SHA1.kt(j)));\n                e = d;\n                d = c;\n                c = SHA1.rol(b, 30);\n                b = a;\n                a = t;\n            }\n            a = SHA1.add(a, olda);\n            b = SHA1.add(b, oldb);\n            c = SHA1.add(c, oldc);\n            d = SHA1.add(d, oldd);\n            e = SHA1.add(e, olde);\n        }\n        var SHA1Value = SHA1.SHA1hex(a) + SHA1.SHA1hex(b) + SHA1.SHA1hex(c) + SHA1.SHA1hex(d) + SHA1.SHA1hex(e);\n        return SHA1Value;\n    }\n}\n\n\n","// import { WebRequest } from '../middleware/offline/webrequest';\nimport { VeryEngine } from '../../engine';\nimport { SHA1 } from './sha1';\n\nexport class Tools {\n\n    public static BaseUrl = '';\n\n\n\n    constructor() {\n\n    }\n\n    public static eulerAngleToRadian(val: BABYLON.Vector3): BABYLON.Vector3 {\n        let para: number = Math.PI / 180;\n        return val.multiplyByFloats(para, para, para);\n    }\n\n    public static radianToEulerAngle(val: BABYLON.Vector3): BABYLON.Vector3 {\n        let para: number = 180 / Math.PI;\n        return val.multiplyByFloats(para, para, para);\n    }\n\n    public static eulerAngleFloatToRadian(euler_angle: number): number {\n        return euler_angle * Math.PI / 180;\n    }\n\n    public static radianFloatToEulerAngle(radian: number): number {\n        return radian * 180 / Math.PI;\n    }\n\n    public static vector3ToArray(val: BABYLON.Vector3): number[] {\n        return [val.x, val.y, val.z];\n    }\n\n    public static quatTransfromVector3(quat: BABYLON.Quaternion, vec3: BABYLON.Vector3): BABYLON.Vector3 {\n        let res = BABYLON.Vector3.Zero();\n\n        var x = vec3.x, y = vec3.y, z = vec3.z;\n        var qx = quat.x, qy = quat.y, qz = quat.z, qw = quat.w;\n\n        // calculate quat * vec\n        var ix = qw * x + qy * z - qz * y;\n        var iy = qw * y + qz * x - qx * z;\n        var iz = qw * z + qx * y - qy * x;\n        var iw = -qx * x - qy * y - qz * z;\n\n        // calculate result * inverse quat\n        res.x = ix * qw + iw * -qx + iy * -qz - iz * -qy;\n        res.y = iy * qw + iw * -qy + iz * -qx - ix * -qz;\n        res.z = iz * qw + iw * -qz + ix * -qy - iy * -qx;\n\n        return res;\n    }\n\n    public static quatMultiplyVector3(rotation: BABYLON.Quaternion, point: BABYLON.Vector3): BABYLON.Vector3 {\n        let num = rotation.x * 2;\n        let num2 = rotation.y * 2;\n        let num3 = rotation.z * 2;\n        let num4 = rotation.x * num;\n        let num5 = rotation.y * num2;\n        let num6 = rotation.z * num3;\n        let num7 = rotation.x * num2;\n        let num8 = rotation.x * num3;\n        let num9 = rotation.y * num3;\n        let num10 = rotation.w * num;\n        let num11 = rotation.w * num2;\n        let num12 = rotation.w * num3;\n        let result: BABYLON.Vector3 = BABYLON.Vector3.Zero();\n        result.x = (1 - (num5 + num6)) * point.x + (num7 - num12) * point.y + (num8 + num11) * point.z;\n        result.y = (num7 + num12) * point.x + (1 - (num4 + num6)) * point.y + (num9 - num10) * point.z;\n        result.z = (num8 - num11) * point.x + (num9 + num10) * point.y + (1 - (num4 + num5)) * point.z;\n        return result;\n    }\n\n\n    public static clampAngle(angle: number, min: number, max: number): number {\n        if (angle < -360)\n            angle += 360;\n        if (angle > 360)\n            angle -= 360;\n        if (angle < min) {\n            angle = min;\n        } else if (angle > max) {\n            angle = max;\n        }\n        return angle;\n    }\n\n    public static worldToScreenPoint(world_point: BABYLON.Vector3, scene: BABYLON.Scene, camera: BABYLON.TargetCamera, engine: BABYLON.Engine): BABYLON.Vector3 {\n        return BABYLON.Vector3.Project(\n            world_point,\n            BABYLON.Matrix.Identity(),\n            scene.getTransformMatrix(),\n            camera.viewport.toGlobal(\n                engine.getRenderWidth(),\n                engine.getRenderHeight(),\n            ),\n        );\n    }\n\n    public static lerpVector2(vec1: BABYLON.Vector2, vec2: BABYLON.Vector2, rate: number): BABYLON.Vector2 {\n        let res = BABYLON.Vector2.Zero();\n        if (rate < 0) rate = 0;\n        if (rate > 1) rate = 1;\n        res.x = vec1.x + rate * (vec2.x - vec1.x);\n        res.y = vec1.y + rate * (vec2.y - vec1.y);\n        return res;\n    }\n\n    public static lerpVector3(vec1: BABYLON.Vector3, vec2: BABYLON.Vector3, rate: number): BABYLON.Vector3 {\n        let res = BABYLON.Vector3.Zero();\n        if (rate < 0) rate = 0;\n        if (rate > 1) rate = 1;\n        res.x = vec1.x + rate * (vec2.x - vec1.x);\n        res.y = vec1.y + rate * (vec2.y - vec1.y);\n        res.z = vec1.z + rate * (vec2.z - vec1.z);\n        return res;\n    }\n\n    public static lerpVector4(vec1: BABYLON.Vector4, vec2: BABYLON.Vector4, rate: number): BABYLON.Vector4 {\n        let res = BABYLON.Vector4.Zero();\n        if (rate < 0) rate = 0;\n        if (rate > 1) rate = 1;\n        res.x = vec1.x + rate * (vec2.x - vec1.x);\n        res.y = vec1.y + rate * (vec2.y - vec1.y);\n        res.z = vec1.z + rate * (vec2.z - vec1.z);\n        res.w = vec1.w + rate * (vec2.w - vec1.w);\n        return res;\n    }\n\n\n    public static transformLocalToWorldDirection(node: BABYLON.Node, local_direction: BABYLON.Vector3): BABYLON.Vector3 {\n        if (node) {\n            let matrix: BABYLON.Matrix = node.computeWorldMatrix();\n            return BABYLON.Vector3.TransformCoordinates(local_direction, matrix).subtract((node as any).getAbsolutePosition());\n        } else {\n            return local_direction;\n        }\n    }\n\n\n\n\n    public static sha1(val: any): string {\n        return SHA1.SHA1(val);\n    }\n\n\n\n    public static rgb2hsv(rgb: number[]): number[] {\n        var rr, gg, bb,\n            r = rgb[0] / 255,\n            g = rgb[1] / 255,\n            b = rgb[2] / 255,\n            h = 0, s,\n            v = Math.max(r, g, b),\n            diff = v - Math.min(r, g, b),\n            diffc = function (c: number) {\n                return (v - c) / 6 / diff + 1 / 2;\n            };\n\n        if (diff == 0) {\n            h = s = 0;\n        } else {\n            s = diff / v;\n            rr = diffc(r);\n            gg = diffc(g);\n            bb = diffc(b);\n\n            if (r === v) {\n                h = bb - gg;\n            } else if (g === v) {\n                h = (1 / 3) + rr - bb;\n            } else if (b === v) {\n                h = (2 / 3) + gg - rr;\n            }\n            if (h < 0) {\n                h += 1;\n            } else if (h > 1) {\n                h -= 1;\n            }\n        }\n        return [h, s, v];\n    }\n\n    public static hsv2rgb(hsv: number[]): number[] {\n        var h = hsv[0];\n        var s = hsv[1];\n        var v = hsv[2];\n        var r = 0, g = 0, b = 0, i, f, p, q, t;\n        // if (h && s === undefined && v === undefined) {\n        //     s = h.s, v = h.v, h = h.h;\n        // }\n        i = Math.floor(h * 6);\n        f = h * 6 - i;\n        p = v * (1 - s);\n        q = v * (1 - f * s);\n        t = v * (1 - (1 - f) * s);\n        switch (i % 6) {\n            case 0: r = v, g = t, b = p; break;\n            case 1: r = q, g = v, b = p; break;\n            case 2: r = p, g = v, b = t; break;\n            case 3: r = p, g = q, b = v; break;\n            case 4: r = t, g = p, b = v; break;\n            case 5: r = v, g = p, b = q; break;\n        }\n        return [Math.round(r * 255), Math.round(g * 255), Math.round(b * 255)];\n    }\n\n    public static rgba2hsvString(rgba: number[]): string {\n        rgba = Tools.to255rgba(rgba);\n        let colorStr = '#';\n        for (let i = 0, len = rgba.length; i < len; i++) {\n            let hex = ('0' + rgba[i].toString(16)).slice(-2);\n            colorStr += hex;\n        }\n        return colorStr;\n    }\n\n    /*\n    var rgba2hsvString = (rgba) => {\n        var colorStr = '#';\n        for (let i = 0, len = rgba.length; i < len; i++) {\n            let hex = ('0' + rgba[i].toString(16)).slice(-2);\n            colorStr += hex;\n        }\n        return colorStr;\n    }\n\n    var hsvString2rgba = (hsv) => {\n        var colorChange = [];\n        for (var i = 1; i < hsv.length; i += 2) {\n            colorChange.push(parseInt('0x' + hsv.slice(i, i + 2)));\n        }\n        \n        var rgbaSmall = [];\n        for(var i = 0; i < colorChange.length; i++) {\n            rgbaSmall.push(colorChange[i] / 255.0);\n        }\n        return rgbaSmall;\n    }\n    */\n\n    public static hsvString2rgba(hsv: string): number[] {\n        var colorChange = [];\n        for (var i = 1; i < hsv.length; i += 2) {\n            colorChange.push(parseInt('0x' + hsv.slice(i, i + 2)));\n        }\n        colorChange = Tools.toSmallrgba(colorChange);\n        return colorChange;\n    }\n\n    public static to255rgba(rgba: number[]): number[] {\n        let rgba255: number[] = [];\n        rgba.forEach((element: number) => {\n            rgba255.push(element * 255);\n        });\n        return rgba255;\n    }\n\n    public static toSmallrgba(rgba: number[]): number[] {\n        let rgbaSmall: number[] = [];\n        rgba.forEach((element: number) => {\n            rgbaSmall.push(element / 255.0);\n        });\n        return rgbaSmall;\n    }\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n    public static GetFilename(path: string): string {\n        var index = path.lastIndexOf('/');\n        if (index < 0) {\n            return path;\n        }\n\n        return path.substring(index + 1);\n    }\n\n\n\n\n\n\n\n\n    public static GetFolderPath(uri: string, returnUnchangedIfNoSlash = false): string {\n        var index = uri.lastIndexOf('/');\n        if (index < 0) {\n            if (returnUnchangedIfNoSlash) {\n                return uri;\n            }\n            return '';\n        }\n        return uri.substring(0, index + 1);\n    }\n\n\n    // TODO\n    public static Error(message: string): void {\n        debug.error(message);\n    }\n\n    public static CleanUrl(url: string): string {\n        url = url.replace(/#/mg, '%23');\n        return url;\n    }\n\n    public static PreprocessUrl = (url: string) => {\n        return url;\n    }\n\n\n    public static loadBabylon(): void {\n        // axios.defaults.responseType = 'json';\n        axios.get('scene/dude.json')\n            .then(respone => {\n                console.warn(typeof respone.data);\n                // console.log(respone.data.toString());\n                console.log(respone.data);\n                // console.log(respone.data.meshes);\n                // scene数据 -> mesh -> name -> babylon.meshes array -> id ？ 貌似导出的id应该是不重合的\n\n                // 加载blue\n                Tools.loadBlue(respone.data, 'scene/');\n\n            });\n\n        let success = (data: string | ArrayBuffer, url: string | undefined): void => {\n            // console.error(data);\n            // console.error(data);\n            // console.error(url);\n        }\n\n        // BABYLON.Tools.LoadFile('scene/scene.babylon', success);\n\n        // console.error('length: ' + Object.keys(BABYLON.FilesInputStore.FilesToLoad).length);\n        // for (let key in BABYLON.FilesInputStore.FilesToLoad) {\n        //     console.error('key: ' + key);\n        //     console.error(BABYLON.FilesInputStore.FilesToLoad[key]);\n        // }\n    }\n\n\n    public static loadBlue(data: any, rootUrl: string): void {\n\n        // 根据ID加载资源 -> mesh -> material -> animations\n        // 属性面板和Assets显示完整模型? -> container中包含模型，两边使用 -> 但是如果一边删除了模型，container中也没了\n\n        // ?在new Mesh时，mesh已经添加到对应的scene，难办了，如何实现缓存？只实现数据的缓存？\n        // 再搞一个中间结构缓存原始数据？\n        // scene数据 -> .babylon数据缓存 -> model -> mesh | 几何 + material + texture -> 进行快速关联 -> 如何把texture提交进去\n        // texture数据如何实现缓存，直接将数据交给engine中的数据结构？\n\n        // Lights\n        if (data.lights !== undefined && data.lights !== null) {\n            for (let index = 0, cache = data.lights.length; index < cache; index++) {\n                var parsedLight = data.lights[index];\n                var light = BABYLON.Light.Parse(parsedLight, VeryEngine.viewScene);\n                if (light) {\n                    // container.lights.push(light);\n                    // log += (index === 0 ? '\\n\\tLights:' : '');\n                    // log += '\\n\\t\\t' + light.toString(fullDetails);\n                }\n            }\n        }\n\n        // Animations\n        if (data.animations !== undefined && data.animations !== null) {\n            for (let index = 0, cache = data.animations.length; index < cache; index++) {\n                var parsedAnimation = data.animations[index];\n                const internalClass = BABYLON._TypeStore.GetClass('BABYLON.Animation');\n                if (internalClass) {\n                    let animation = internalClass.Parse(parsedAnimation);\n                    VeryEngine.viewScene.animations.push(animation);\n                    // container.animations.push(animation);\n                    // log += (index === 0 ? '\\n\\tAnimations:' : '');\n                    // log += '\\n\\t\\t' + animation.toString(fullDetails);\n                }\n            }\n        }\n\n        // Materials\n        if (data.materials !== undefined && data.materials !== null) {\n            for (let index = 0, cache = data.materials.length; index < cache; index++) {\n                var parsedMaterial = data.materials[index];\n                var mat = BABYLON.Material.Parse(parsedMaterial, VeryEngine.viewScene, rootUrl);\n                // container.materials.push(mat);\n                // log += (index === 0 ? '\\n\\tMaterials:' : '');\n                // log += '\\n\\t\\t' + mat.toString(fullDetails);\n            }\n        }\n\n        if (data.multiMaterials !== undefined && data.multiMaterials !== null) {\n            for (let index = 0, cache = data.multiMaterials.length; index < cache; index++) {\n                var parsedMultiMaterial = data.multiMaterials[index];\n                var mmat = BABYLON.MultiMaterial.ParseMultiMaterial(parsedMultiMaterial, VeryEngine.viewScene);\n                // container.multiMaterials.push(mmat);\n                // log += (index === 0 ? '\\n\\tMultiMaterials:' : '');\n                // log += '\\n\\t\\t' + mmat.toString(fullDetails);\n            }\n        }\n\n        // Skeletons\n        if (data.skeletons !== undefined && data.skeletons !== null) {\n            for (let index = 0, cache = data.skeletons.length; index < cache; index++) {\n                var parsedSkeleton = data.skeletons[index];\n                var skeleton = BABYLON.Skeleton.Parse(parsedSkeleton, VeryEngine.viewScene);\n                skeleton.beginAnimation('Skeleton0', true);\n                // container.skeletons.push(skeleton);\n                // log += (index === 0 ? '\\n\\tSkeletons:' : '');\n                // log += '\\n\\t\\t' + skeleton.toString(fullDetails);\n            }\n        }\n\n        // Geometries\n        var geometries = data.geometries;\n        if (geometries !== undefined && geometries !== null) {\n            var addedGeometry = new Array<Nullable<BABYLON.Geometry>>();\n\n            // VertexData\n            var vertexData = geometries.vertexData;\n            if (vertexData !== undefined && vertexData !== null) {\n                for (let index = 0, cache = vertexData.length; index < cache; index++) {\n                    var parsedVertexData = vertexData[index];\n                    addedGeometry.push(BABYLON.Geometry.Parse(parsedVertexData, VeryEngine.viewScene, rootUrl));\n                }\n            }\n\n            // addedGeometry.forEach((g) => {\n            //     if (g) {\n            //         container.geometries.push(g);\n            //     }\n            // });\n        }\n\n        // meshes\n        if (data.meshes !== undefined && data.meshes !== null) {\n            for (let index = 0, cache = data.meshes.length; index < cache; index++) {\n                var parsedMesh = data.meshes[index];\n                var mesh = <BABYLON.AbstractMesh>BABYLON.Mesh.Parse(parsedMesh, VeryEngine.viewScene, rootUrl);\n                // container.meshes.push(mesh);\n                // log += (index === 0 ? '\\n\\tMeshes:' : '');\n                // log += '\\n\\t\\t' + mesh.toString(fullDetails);\n            }\n        }\n\n        // 创建之前先搞一个blob？\n        // let tex = new BABYLON.Texture('scene/头像.png', VeryEngine.viewScene);\n        // console.log(tex);\n\n        console.log(VeryEngine.viewEngine._internalTexturesCache);\n\n        // setTimeout(() => {\n        //     VeryEngine.viewScene.render();\n        //     BABYLON.Tools.CreateScreenshot(VeryEngine.viewEngine, VeryEngine.viewScene.activeCamera!, 1600);\n        // }, 2000);\n        // 信息交换\n\n    }\n\n    // public static LoadFile(url: string, onSuccess: (data: string | ArrayBuffer, responseURL?: string) => void, onProgress?: (data: any) => void, useArrayBuffer?: boolean, onError?: (request?: WebRequest, exception?: any) => void): IFileRequest {\n    //     url = Tools.CleanUrl(url);\n\n    //     url = Tools.PreprocessUrl(url);\n\n    //     // 在本地缓存中存在此文件， TODO: 还有本地上传的情况处理\n    //     if (url.indexOf('file:') !== -1) {\n    //         // const fileName = decodeURIComponent(url.substring(5).toLowerCase());\n    //         // if (FilesInputStore.FilesToLoad[fileName]) {\n    //         //     // 缓存文件\n    //         //     return Tools.ReadFile(FilesInputStore.FilesToLoad[fileName], onSuccess, onProgress, useArrayBuffer);\n    //         // }\n    //     }\n\n    //     const loadUrl = Tools.BaseUrl + url;\n\n    //     let aborted = false;\n    //     const fileRequest: IFileRequest = {\n    //         onCompleteObservable: new Observable<IFileRequest>(),\n    //         abort: () => aborted = true,\n    //     };\n\n\n\n\n    // }\n\n\n\n\n\n    /**\n     * name字符串合法性检查，不允许出现 “\\/*<>?|'':” 等字符串，若存在，则返回false；\n     * @param name 待检查的name字符串；\n     */\n    public static isLegalName(name: string): boolean {\n        // var re = /[^\\u4e00-\\u9fa5]/; // 中文正则\n        // var pattern = new RegExp('[`\\\\-~!@#$^&*()=|{}':;',\\\\[\\\\].<>《》/?~！@#￥……&*（）——|{}【】‘；：”“'。，、？12345678990]'); // 特殊符号\n        const illegalPattern = /[\\\\\\/*<>?|'':]/;\n        if (illegalPattern.test(name)) {\n            return false;\n        } else {\n            return true;\n        }\n    }\n\n\n    /**\n     * 字符串排序，特殊字符在最前头，其余按照字母顺序进行排列\n     * @param a 第1个字符串；\n     * @param b 第2个字符串；\n     */\n    public static stringCompare(a: string, b: string): number {\n        a = a.toLowerCase();\n        b = b.toLowerCase();\n        if (a === b) {\n            return 0;\n        }\n        // TODO: 目前采用了js默认的比较函数，由于Safari等浏览器不支持locals参数，英文默认在中文之后，特殊字符在最前\n        return a.localeCompare(b);\n    }\n\n\n    public static appendQuery(origin: string, query: string): string {\n        let separator = origin.indexOf('?') !== -1 ? '&' : '?';\n        return this + separator + query;\n    }\n\n}","import SparkMD5 from \"spark-md5\";\r\n\r\nexport class UUid {\r\n    public static createUuid = () => {\r\n        return \"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx\".replace(/[xy]/g, (c) => {\r\n            var r = (Math.random() * 16) | 0,\r\n                v = c === \"x\" ? r : (r & 0x3) | 0x8;\r\n            return v.toString(16);\r\n        });\r\n    };\r\n\r\n    // 秒时间戳\r\n    public static createAssetID = () => {\r\n        return (\r\n            Math.round(new Date().getTime() / 1000).toString() +\r\n            \"-\" +\r\n            UUid.createUuid().substring(0, 8)\r\n        );\r\n    };\r\n\r\n    private static getRealTime(str:number) {\r\n        if (str < 10) {\r\n            return \"0\" + str;\r\n        }\r\n        return str;\r\n    }\r\n\r\n    public static createdAtTime() {\r\n        var now = new Date();\r\n        var Y = now.getFullYear();\r\n        var m = UUid.getRealTime(now.getMonth() + 1);\r\n        var d = UUid.getRealTime(now.getDate());\r\n        var H = UUid.getRealTime(now.getHours());\r\n        var i = UUid.getRealTime(now.getMinutes());\r\n        // var s = getRealTime(now.getSeconds());\r\n        return Y + \"-\" + m + \"-\" + d + \" \" + H + \":\" + i;\r\n    }\r\n\r\n    public static getmd5=async(file:File)=>{\r\n        return new Promise<string>(async (resolve, reject) => {\r\n            var blobSlice = File.prototype.slice ;\r\n            var chunkSize = 2097152, // 每次读取2MB\r\n            chunks = Math.ceil(file.size / chunkSize),\r\n            currentChunk = 0,\r\n            spark = new SparkMD5.ArrayBuffer(),\r\n            frOnload = function(e:any){\r\n                spark.append(e.target.result);\r\n                currentChunk++;\r\n                if (currentChunk < chunks)\r\n                    loadNext();\r\n                else{\r\n                    resolve(spark.end());\r\n                }\r\n            },\r\n            frOnerror = function () {\r\n                reject(\"error\");\r\n            };\r\n            function loadNext() {\r\n                var fileReader = new FileReader();\r\n                fileReader.onload = frOnload;\r\n                fileReader.onerror = frOnerror;\r\n                var start = currentChunk * chunkSize,\r\n                    end = ((start + chunkSize) >= file.size) ? file.size : start + chunkSize;\r\n                fileReader.readAsArrayBuffer(blobSlice.call(file, start, end));\r\n            };\r\n            loadNext();\r\n        })\r\n    }\r\n}","export * from './viewport';\nexport * from './viewport-expand';\nexport * from './viewport-application';\nexport * from './viewport-entities-observer-binding';\nexport * from './viewport-instance-create';\nexport * from './viewport-drop-model';\nexport * from './viewport-tap';\nexport * from './keeper';","import { ViewportApplication } from \"./viewport-application\";\nimport { ViewportInstanceCreate } from \"./viewport-instance-create\";\nimport { ViewportDropModel } from \"./viewport-drop-model\";\nimport { ViewportEntitiesObserverBinding } from \"./viewport-entities-observer-binding\";\nimport { ViewportTap } from \"./viewport-tap\";\n\nexport class ViewportKeeper {\n\n    public constructor() {\n        new ViewportApplication();\n        new ViewportEntitiesObserverBinding();\n        new ViewportInstanceCreate();\n        new ViewportDropModel();\n        new ViewportTap();\n    }\n\n}","import { VeryEngine } from '../../engine';\nimport { Observer } from '../../lib';\nimport { CameraGizmo, LightGizmo } from '../gizmos';\nimport { Config } from '../global';\nimport { VeryLight } from '../middleware';\nimport { BabylonLoader } from '../middleware/loader/babylonLoader';\nimport { Tools } from '../utility';\nimport { getJsonAsset, getUrl } from \"../../tools/ossfile\";\nimport { GUIManager } from '../gui';\n\nexport class ViewportApplication {\n\n\n\n\n    public constructor() {\n\n        // entities indexes for parenting\n        var childIndex: { [key: string]: any } = {};\n        var entitiesIndex: { [key: string]: any } = {};\n        var unknowns = {};\n        var gizmos: { [key: string]: any } = {};\n\n        editor.method('gizmo:get', (id: string) => {\n            return (id in gizmos) ? gizmos[id] : null;\n        });\n\n        editor.method('create:scene:element', (entity: Observer) => {\n            // console.log('create scene element');\n            // console.error(entity);\n            if (entity.get('type') === 'light') {\n                // Lights\n                let lightWraper = BabylonLoader.createLightWraper(entity.get('subtype'), entity.get('name'), VeryEngine.viewScene);\n\n                // lightWraper.light.setEnabled(entity.has('enabled') ? entity.get('enabled') : true);\n                lightWraper.light.intensity = entity.has('intensity') ? entity.get('intensity') : 1;\n                if (entity.has('diffuse') && entity.get('diffuse').length === 3) {\n                    lightWraper.light.diffuse = BABYLON.Color3.FromArray(entity.get('diffuse'));\n                }\n                if (entity.has('specular') && entity.get('specular').length === 3) {\n                    lightWraper.light.specular = BABYLON.Color3.FromArray(entity.get('specular'));\n                }\n                if (lightWraper.light instanceof BABYLON.SpotLight) {\n                    if (entity.has('angle')) {\n                        lightWraper.light.angle = entity.get('angle');\n                    }\n                    if (entity.has('exponent')) {\n                        lightWraper.light.exponent = entity.get('exponent');\n                    }\n                }\n\n                lightWraper.id = entity.get('resource_id');\n                entitiesIndex[entity.get('resource_id')] = lightWraper;\n                entity.node = lightWraper;\n\n                if (entity.has('enabled')) {\n                    lightWraper.setEnabled(entity.get('enabled'));\n                }\n                if (entity.has('position') && entity.get('position').length === 3) {\n                    lightWraper.position = BABYLON.Vector3.FromArray(entity.get('position'));\n                }\n                if (entity.has('rotation') && entity.get('rotation').length === 3) {\n                    lightWraper.rotation = Tools.eulerAngleToRadian(BABYLON.Vector3.FromArray(entity.get('rotation')));\n                    // 环境光不跟着父物体发生位置变化\n                    if (lightWraper.type === BABYLON.Light.LIGHTTYPEID_HEMISPHERICLIGHT) {\n                        (<BABYLON.HemisphericLight>lightWraper.light).direction.copyFrom(lightWraper.up);\n                    }\n                }\n                if (entity.has('scale') && entity.get('scale').length === 3) {\n                    lightWraper.scaling = BABYLON.Vector3.FromArray(entity.get('scale'));\n                }\n\n                let lightGizmo = new LightGizmo();\n                lightGizmo.scaleRatio = 2;\n                lightGizmo.light = lightWraper.light;\n                gizmos[entity.get('resource_id')] = lightGizmo;\n\n\n                childAndParent(entity, lightWraper);\n            } else if (entity.get('type') === 'camera') {\n                // Cameras\n                // 默认创建universalCamera，把input控制全删除\n                let cameraWraper = BabylonLoader.createCameraWraper(entity.get('name'), VeryEngine.viewScene, VeryEngine.viewCanvasElement);\n\n                // TODO: camera视窗\n                let w = VeryEngine.viewEngine.getRenderWidth();\n                let h = VeryEngine.viewEngine.getRenderHeight();\n                // cameraWraper.camera.viewport = new BABYLON.Viewport(4 / w, (h - 241) / h, 260 / w, 200 / h);\n\n                cameraWraper.camera.viewport = new BABYLON.Viewport(Config.x / w, (h - Config.y) / h, Config.width / w, Config.height / h);\n\n\n                cameraWraper.id = entity.get('resource_id');\n                entitiesIndex[entity.get('resource_id')] = cameraWraper;\n                entity.node = cameraWraper;\n\n                if (entity.has('enabled')) {\n                    cameraWraper.setEnabled(entity.get('enabled'));\n                }\n                if (entity.has('position') && entity.get('position').length === 3) {\n                    cameraWraper.position = BABYLON.Vector3.FromArray(entity.get('position'));\n                }\n                if (entity.has('rotation') && entity.get('rotation').length === 3) {\n                    cameraWraper.rotation = Tools.eulerAngleToRadian(BABYLON.Vector3.FromArray(entity.get('rotation')));\n                }\n                if (entity.has('scale') && entity.get('scale').length === 3) {\n                    cameraWraper.scaling = BABYLON.Vector3.FromArray(entity.get('scale'));\n                }\n\n                if (entity.has('checkCollisions')) {\n                    // if (cameraWraper.camera instanceof BABYLON.FreeCamera) {\n                    //     cameraWraper.camera.checkCollisions = entity.get('checkCollisions');\n                    // }\n                    cameraWraper.checkCollisions = entity.get('checkCollisions');\n                }\n                if (entity.has('applyGravity')) {\n                    // if (cameraWraper.camera instanceof BABYLON.FreeCamera) {\n                    //     cameraWraper.camera.applyGravity = entity.get('applyGravity');\n                    // }\n                    cameraWraper.applyGravity = entity.get('applyGravity');\n                }\n                if (entity.has('viewport')) {\n                    // 编辑器条件下不用管\n                    // let arr = entity.get('viewport');\n                    // if (arr && arr.length && arr.length === 4) {\n                    //     cameraWraper.camera.viewport = new BABYLON.Viewport(arr[0], arr[1], arr[2], arr[3]);\n                    // }\n                }\n                // TODO: 设置clearColor\n                if (entity.has('clearColor')) {\n                    let arr = entity.get('clearColor');\n                    if (arr && arr.length && arr.length === 4) {\n                        cameraWraper.clearColor = new BABYLON.Color4(arr[0], arr[1], arr[2], arr[3]);\n                    }\n                } else {\n                    cameraWraper.clearColor = new BABYLON.Color4(45 / 255, 145 / 255, 186 / 255, 1);\n                }\n\n                if (entity.has('mode')) {\n                    cameraWraper.mode = entity.get('mode');\n                }\n                if (entity.has('fov')) {\n                    cameraWraper.fov = entity.get('fov');\n                }\n                if (entity.has('inertia')) {\n                    cameraWraper.inertia = entity.get('inertia');\n                }\n                if (entity.has('orthoSize')) {\n                    cameraWraper.orthoSize = entity.get('orthoSize');\n                }\n\n                VeryEngine.addCamera(cameraWraper);\n\n                VeryEngine.viewScene.activeCameras.push(cameraWraper.camera);\n\n                let cameraGizmo = new CameraGizmo();\n                cameraGizmo.camera = cameraWraper.camera;\n\n                gizmos[entity.get('resource_id')] = cameraGizmo;\n\n                cameraGizmo.displayFrustum = false;\n\n                // 设置viewport\n                cameraWraper.resize(true);\n                // 先不要渲染出来\n                cameraWraper.renderCamera(false);\n\n                childAndParent(entity, cameraWraper);\n\n            } else if (entity.get('type') === 'empty') {\n                // 空物体\n                let empty = new BABYLON.TransformNode(entity.get('name'), VeryEngine.viewScene);\n                entity.node = empty;\n                empty.id = entity.get('resource_id');\n                empty.position = BABYLON.Vector3.FromArray(entity.get('position'));\n                empty.rotation = Tools.eulerAngleToRadian(BABYLON.Vector3.FromArray(entity.get('rotation')));\n                empty.scaling = BABYLON.Vector3.FromArray(entity.get('scale'));\n                empty.isEnabled(entity.get('enabled'));\n                entitiesIndex[entity.get('resource_id')] = empty;\n                childAndParent(entity, empty);\n            } else if (entity.get('type') === 'primitive') {\n                if (entity.get('subtype') && entity.get('subtype') === 'box') {\n                    // box\n                    var box = BABYLON.MeshBuilder.CreateBox(entity.get('name'), { size: 100 }, VeryEngine.viewScene);\n\n                    // var box = BABYLON.Mesh.CreateBox(entity.get('name'), 1, VeryEngine.viewScene);\n                    entity.node = box;\n                    entitiesIndex[entity.get('resource_id')] = box;\n                    box.id = entity.get('resource_id');\n\n                    if (entity.has('enabled')) {\n                        box.setEnabled(entity.get('enabled'));\n                    }\n                    if (entity.has('position') && entity.get('position').length === 3) {\n                        box.position = BABYLON.Vector3.FromArray(entity.get('position'));\n                    }\n                    if (entity.has('rotation') && entity.get('rotation').length === 3) {\n                        box.rotation = Tools.eulerAngleToRadian(BABYLON.Vector3.FromArray(entity.get('rotation')));\n                    }\n                    if (entity.has('scale') && entity.get('scale').length === 3) {\n                        box.scaling = BABYLON.Vector3.FromArray(entity.get('scale'));\n                    }\n                    if (entity.has('checkCollisions')) {\n                        box.checkCollisions = entity.get('checkCollisions');\n                    }\n                    if (entity.has('pickable')) {\n                        box.isPickable = entity.get('pickable');\n                    }\n                    if (entity.has('isVisible')) {\n                        box.isVisible = entity.get('isVisible');\n                    }\n                    // 加载自定义关联材质\n                    if (entity.get('material_id')) {\n\n                    }\n                    childAndParent(entity, box);\n                } else if (entity.get('subtype') && entity.get('subtype') === 'sphere') {\n                    // box\n                    var box = BABYLON.MeshBuilder.CreateSphere(entity.get('name'), { segments: 20, diameter: 100 }, VeryEngine.viewScene);\n\n                    // var box = BABYLON.Mesh.CreateBox(entity.get('name'), 1, VeryEngine.viewScene);\n                    entity.node = box;\n                    entitiesIndex[entity.get('resource_id')] = box;\n                    box.id = entity.get('resource_id');\n\n                    if (entity.has('enabled')) {\n                        box.setEnabled(entity.get('enabled'));\n                    }\n                    if (entity.has('position') && entity.get('position').length === 3) {\n                        box.position = BABYLON.Vector3.FromArray(entity.get('position'));\n                    }\n                    if (entity.has('rotation') && entity.get('rotation').length === 3) {\n                        box.rotation = Tools.eulerAngleToRadian(BABYLON.Vector3.FromArray(entity.get('rotation')));\n                    }\n                    if (entity.has('scale') && entity.get('scale').length === 3) {\n                        box.scaling = BABYLON.Vector3.FromArray(entity.get('scale'));\n                    }\n                    if (entity.has('checkCollisions')) {\n                        box.checkCollisions = entity.get('checkCollisions');\n                    }\n                    if (entity.has('pickable')) {\n                        box.isPickable = entity.get('pickable');\n                    }\n                    if (entity.has('isVisible')) {\n                        box.isVisible = entity.get('isVisible');\n                    }\n                    // 加载自定义关联材质\n                    if (entity.get('material_id')) {\n\n                    }\n                    childAndParent(entity, box);\n                } else if (entity.get('subtype') && entity.get('subtype') === 'plane') {\n                    // box\n                    var box = BABYLON.MeshBuilder.CreateGround(entity.get('name'), { width: 5000, height: 5000, subdivisions: 10 }, VeryEngine.viewScene);\n\n                    // var box = BABYLON.Mesh.CreateBox(entity.get('name'), 1, VeryEngine.viewScene);\n                    entity.node = box;\n                    entitiesIndex[entity.get('resource_id')] = box;\n                    box.id = entity.get('resource_id');\n\n                    if (entity.has('enabled')) {\n                        box.setEnabled(entity.get('enabled'));\n                    }\n                    if (entity.has('position') && entity.get('position').length === 3) {\n                        box.position = BABYLON.Vector3.FromArray(entity.get('position'));\n                    }\n                    if (entity.has('rotation') && entity.get('rotation').length === 3) {\n                        box.rotation = Tools.eulerAngleToRadian(BABYLON.Vector3.FromArray(entity.get('rotation')));\n                    }\n                    if (entity.has('scale') && entity.get('scale').length === 3) {\n                        box.scaling = BABYLON.Vector3.FromArray(entity.get('scale'));\n                    }\n                    if (entity.has('checkCollisions')) {\n                        box.checkCollisions = entity.get('checkCollisions');\n                    }\n                    if (entity.has('pickable')) {\n                        box.isPickable = entity.get('pickable');\n                    }\n                    if (entity.has('isVisible')) {\n                        box.isVisible = entity.get('isVisible');\n                    }\n                    // 加载自定义关联材质\n                    if (entity.get('material_id')) {\n\n                    }\n                    childAndParent(entity, box);\n                } else if (entity.get('subtype') && entity.get('subtype') === 'cylinder') {\n                    // box\n                    var box = BABYLON.MeshBuilder.CreateCylinder(entity.get('name'), { height: 200, diameter: 100 }, VeryEngine.viewScene);\n\n                    // var box = BABYLON.Mesh.CreateBox(entity.get('name'), 1, VeryEngine.viewScene);\n                    entity.node = box;\n                    entitiesIndex[entity.get('resource_id')] = box;\n                    box.id = entity.get('resource_id');\n\n                    if (entity.has('enabled')) {\n                        box.setEnabled(entity.get('enabled'));\n                    }\n                    if (entity.has('position') && entity.get('position').length === 3) {\n                        box.position = BABYLON.Vector3.FromArray(entity.get('position'));\n                    }\n                    if (entity.has('rotation') && entity.get('rotation').length === 3) {\n                        box.rotation = Tools.eulerAngleToRadian(BABYLON.Vector3.FromArray(entity.get('rotation')));\n                    }\n                    if (entity.has('scale') && entity.get('scale').length === 3) {\n                        box.scaling = BABYLON.Vector3.FromArray(entity.get('scale'));\n                    }\n                    if (entity.has('checkCollisions')) {\n                        box.checkCollisions = entity.get('checkCollisions');\n                    }\n                    if (entity.has('pickable')) {\n                        box.isPickable = entity.get('pickable');\n                    }\n                    if (entity.has('isVisible')) {\n                        box.isVisible = entity.get('isVisible');\n                    }\n                    // 加载自定义关联材质\n                    if (entity.get('material_id')) {\n\n                    }\n                    childAndParent(entity, box);\n                }\n                // console.warn(box);\n            } else if (entity.get('type') === 'mesh') {\n                // 模型异步加载，因为mesh需要先加载.babylon文件；\n                // console.warn('scene创建mesh：' + entity.get('name'));\n                editor.call('scene:mesh:create', entity);\n            } else if (entity.get('type') === '2d-gui') {\n                if (entity.get('subtype') && entity.get('subtype') === 'root') {\n                    let canvas2D = BABYLON.GUI.AdvancedDynamicTexture.CreateFullscreenUI(entity.get('name'));\n                    GUIManager.add2DCanvas(entity.get('resource_id'), canvas2D);\n                    entity.node = canvas2D;\n                    set2DGUITransform(canvas2D.rootContainer, entity);\n                    GUIManager.addUniqueIDIndex(canvas2D.uniqueId, entity.get('resource_id'));\n                    entitiesIndex[entity.get('resource_id')] = canvas2D.rootContainer;\n\n                    childAndParent(entity, canvas2D.rootContainer);\n                } else if (entity.get('subtype') && entity.get('subtype') === 'panel') {\n                    let panel = new BABYLON.GUI.Rectangle(entity.get('name'));\n                    entity.node = panel;\n                    set2DGUITransform(panel, entity);\n                    if (entity.has('gui.color')) {\n                        panel.color = Tools.rgba2hsvString(entity.get('gui.color'));\n                    }\n                    if (entity.has('gui.background')) {\n                        panel.background = Tools.rgba2hsvString(entity.get('gui.background'));\n                    }\n                    if (entity.has('gui.thickness')) {\n                        panel.thickness = entity.get('gui.thickness')\n                    }\n                    if (entity.has('gui.cornerRadius')) {\n                        panel.cornerRadius = entity.get('gui.cornerRadius')\n                    }\n                    entitiesIndex[entity.get('resource_id')] = panel;\n\n                    childAndParent(entity, panel);\n\n                } else if (entity.get('subtype') && entity.get('subtype') === 'button') {\n                    let btn = BABYLON.GUI.Button.CreateImageWithCenterTextButton(entity.get('name'), '', '');\n                    entity.node = btn;\n                    set2DGUITransform(btn, entity);\n                    if (entity.has('gui.color')) {\n                        btn.color = Tools.rgba2hsvString(entity.get('gui.color'));\n                    }\n                    if (entity.has('gui.background')) {\n                        btn.background = Tools.rgba2hsvString(entity.get('gui.background'));\n                    }\n                    if (entity.has('gui.thickness')) {\n                        btn.thickness = entity.get('gui.thickness')\n                    }\n                    if (entity.has('gui.cornerRadius')) {\n                        btn.cornerRadius = entity.get('gui.cornerRadius')\n                    }\n                    if (entity.has('gui.text')) {\n                        btn.textBlock!.text = entity.get('gui.text')\n                    }\n                    if (entity.has('gui.fontSize')) {\n                        btn.fontSize = entity.get('gui.fontSize');\n                        btn.textBlock!.fontSize = entity.get('gui.fontSize');\n                    }\n                    if (entity.has('gui.textColor')) {\n                        btn.textBlock!.color = Tools.rgba2hsvString(entity.get('gui.textColor'));\n                    }\n                    if (entity.has('gui.source') && entity.get('gui.source')) {\n                        let asset = editor.call('assets:get', entity.get('gui.source'));\n                        if (asset) {\n                            getUrl(Config.projectID, asset.get('id'), asset.get('name'), asset.get('file.hash')).then(response => {\n                                btn.image!.source = response;\n                            });\n                        }\n                    }\n                    entitiesIndex[entity.get('resource_id')] = btn;\n\n                    childAndParent(entity, btn);\n\n                } else if (entity.get('subtype') && entity.get('subtype') === 'image') {\n                    let img = new BABYLON.GUI.Image(entity.get('name'), '');\n                    entity.node = img;\n                    set2DGUITransform(img, entity);\n                    if (entity.has('gui.color')) {\n                        img.color = Tools.rgba2hsvString(entity.get('gui.color'));\n                    }\n                    if (entity.has('gui.source') && entity.get('gui.source')) {\n                        let asset = editor.call('assets:get', entity.get('gui.source'));\n                        if (asset) {\n                            getUrl(Config.projectID, asset.get('id'), asset.get('name'), asset.get('file.hash')).then(response => {\n                                img.source = response;\n                            });\n                        }\n                    }\n\n                    entitiesIndex[entity.get('resource_id')] = img;\n\n                    childAndParent(entity, img);\n\n                } else if (entity.get('subtype') && entity.get('subtype') === 'text') {\n                    let text = new BABYLON.GUI.TextBlock(entity.get('name'), '');\n                    entity.node = text;\n                    set2DGUITransform(text, entity);\n                    if (entity.has('gui.color')) {\n                        text.color = Tools.rgba2hsvString(entity.get('gui.color'));\n                    }\n                    if (entity.has('gui.fontSize')) {\n                        text.fontSize = entity.get('gui.fontSize');\n                    }\n                    if (entity.has('gui.text')) {\n                        text.text = entity.get('gui.text');\n                    }\n                    if (entity.has('gui.textWrapping')) {\n                        text.textWrapping = entity.get('gui.textWrapping');\n                    }\n                    if (entity.has('gui.textHorizontalAlignment')) {\n                        text.textHorizontalAlignment = entity.get('gui.textHorizontalAlignment');\n                    }\n                    if (entity.has('gui.textVerticalAlignment')) {\n                        text.textVerticalAlignment = entity.get('gui.textVerticalAlignment');\n                    }\n                    entitiesIndex[entity.get('resource_id')] = text;\n\n                    childAndParent(entity, text);\n\n                } else if (entity.get('subtype') && entity.get('subtype') === 'input') {\n                    let input = new BABYLON.GUI.InputText(entity.get('name'), '');\n                    entity.node = input;\n                    set2DGUITransform(input, entity);\n                    if (entity.has('gui.color')) {\n                        input.color = Tools.rgba2hsvString(entity.get('gui.color'));\n                    }\n                    if (entity.has('gui.background')) {\n                        input.background = Tools.rgba2hsvString(entity.get('gui.background'));\n                    }\n                    if (entity.has('gui.thickness')) {\n                        input.thickness = entity.get('gui.thickness')\n                    }\n                    if (entity.has('gui.fontSize')) {\n                        input.fontSize = entity.get('gui.fontSize');\n                    }\n                    if (entity.has('gui.placeholderColor')) {\n                        input.placeholderColor = Tools.rgba2hsvString(entity.get('gui.placeholderColor'));\n                    }\n                    if (entity.has('gui.placeholderText')) {\n                        input.placeholderText = entity.get('gui.placeholderText');\n                    }\n                    if (entity.has('gui.focusedBackground')) {\n                        input.focusedBackground = Tools.rgba2hsvString(entity.get('gui.focusedBackground'));\n                    }\n                    if (entity.has('gui.text')) {\n                        input.text = entity.get('gui.text');\n                    }\n                    entitiesIndex[entity.get('resource_id')] = input;\n\n                    childAndParent(entity, input);\n\n                } else if (entity.get('subtype') && entity.get('subtype') === 'checkbox') {\n                    let checkbox = new BABYLON.GUI.RadioButton(entity.get('name'));\n                    entity.node = checkbox;\n                    set2DGUITransform(checkbox, entity);\n                    if (entity.has('gui.color')) {\n                        checkbox.color = Tools.rgba2hsvString(entity.get('gui.color'));\n                    }\n                    if (entity.has('gui.background')) {\n                        checkbox.background = Tools.rgba2hsvString(entity.get('gui.background'));\n                    }\n                    if (entity.has('gui.thickness')) {\n                        checkbox.thickness = entity.get('gui.thickness')\n                    }\n                    if (entity.has('gui.isChecked')) {\n                        checkbox.isChecked = entity.get('gui.isChecked')\n                    }\n                    entitiesIndex[entity.get('resource_id')] = checkbox;\n\n                    childAndParent(entity, checkbox);\n\n                }\n\n            }\n\n\n\n        });\n\n\n\n\n        let childAndParent = (entity: Observer, node: Nullable<BABYLON.Node> | Nullable<BABYLON.GUI.Control>) => {\n            // children\n            let children = entity.get('children');\n            for (var i = 0; i < children.length; i++) {\n                childIndex[children[i]] = {\n                    index: i,\n                    parent: node\n                };\n\n                if (entitiesIndex[children[i]]) {\n                    insertChild(node, entitiesIndex[children[i]], i, entity.get('resource_id'));\n                }\n            }\n\n            // parenting\n            if (!entity.get('parent')) {\n                // babylon root\n            } else {\n                // child\n                var details = childIndex[entity.get('resource_id')];\n                if (details && details.parent) {\n                    insertChild(details.parent, node, details.index, entity.get('resource_id'));\n                }\n            }\n        }\n\n        let insertChild = (parent: Nullable<BABYLON.Node> | Nullable<BABYLON.GUI.Control>, node: Nullable<BABYLON.Node> | Nullable<BABYLON.GUI.Control>, index: number, resource_id: string) => {\n            // try to insert the node at the right index\n            // 但是babylon不支持直接操作children列表，_children为private类型，可以通过修改.d.ts文件获取，但是也没必要；\n\n            if (node && node instanceof BABYLON.Node) {\n                if (parent === null || parent instanceof BABYLON.Node) {\n                    node.parent = parent;\n                }\n            } else if (node && node instanceof BABYLON.GUI.Control) {\n                if (parent instanceof BABYLON.GUI.Container) {\n                    parent.addControl(node);\n                    let last = parent.children.pop();\n                    parent.children.splice(index, 0, last!);\n                    GUIManager.addUniqueIDIndex(node.uniqueId, resource_id);\n                }\n            }\n\n\n            // for (var i = 0, len = parent._children.length; i < len; i++) {\n            //     var child = parent._children[i];\n            //     if (child instanceof pc.Entity && childIndex[child.getGuid()]) {\n            //         // if our index is less than this child's index\n            //         // then put the item here\n            //         if (index < childIndex[child.getGuid()].index) {\n            //             parent.insertChild(node, i);\n            //             return;\n            //         }\n            //     }\n            // }\n\n            // // the node can be safely added to the end of the child list\n            // parent.addChild(node);\n        }\n\n        let set2DGUITransform = (control: BABYLON.GUI.Control, entity: Observer) => {\n            if (entity.has('gui.isVisible')) {\n                control.isVisible = entity.get('gui.isVisible');\n            }\n            if (entity.has('gui.x')) {\n                if (entity.has('gui.xType') && entity.get('gui.xType') === 1) {\n                    control.left = entity.get('gui.x') + '%';\n                } else {\n                    control.left = entity.get('gui.x') + 'px';\n                }\n            }\n            if (entity.has('gui.y')) {\n                if (entity.has('gui.yType') && entity.get('gui.yType') === 1) {\n                    control.top = entity.get('gui.y') + '%';\n                } else {\n                    control.top = entity.get('gui.y') + 'px';\n                }\n            }\n            if (entity.has('gui.width')) {\n                if (entity.has('gui.widthType') && entity.get('gui.widthType') === 1) {\n                    control.width = entity.get('gui.width') + '%';\n                } else {\n                    control.width = entity.get('gui.width') + 'px';\n                }\n            }\n            if (entity.has('gui.height')) {\n                if (entity.has('gui.heightType') && entity.get('gui.heightType') === 1) {\n                    control.height = entity.get('gui.height') + '%';\n                } else {\n                    control.height = entity.get('gui.height') + 'px';\n                }\n            }\n            if (entity.has('gui.scaleX')) {\n                control.scaleX = entity.get('gui.scaleX');\n            }\n            if (entity.has('gui.scaleY')) {\n                control.scaleY = entity.get('gui.scaleY');\n            }\n            if (entity.has('gui.horizontal_alignment')) {\n                control.horizontalAlignment = entity.get('gui.horizontal_alignment');\n            }\n            if (entity.has('gui.vertical_alignment')) {\n                control.verticalAlignment = entity.get('gui.vertical_alignment');\n            }\n            if (entity.has('gui.alpha')) {\n                control.alpha = entity.get('gui.alpha');\n            }\n            if (entity.has('gui.rotation')) {\n                control.rotation = Tools.eulerAngleFloatToRadian(entity.get('gui.rotation'));\n            }\n            if (entity.has('gui.isHighlighted')) {\n                control.isHighlighted = entity.get('gui.isHighlighted');\n            }\n\n        }\n\n\n\n\n        editor.method('scene:mesh:create', (entity: Observer) => {\n\n            loadBabylon(entity);\n            // // 变成异步事件\n            // setTimeout(() => { }, 0);\n        });\n\n\n        let loadingBabylonFlag: { [key: string]: boolean } = {};\n        let toLoadEntity: { [key: string]: Observer[] } = {};\n        let loadBabylon = (entity: Observer) => {\n            let assetID: string = entity.get('asset_id');\n            let dataBabylon: any = null;\n\n            if (BabylonLoader.hasBabylobData(assetID)) {\n                dataBabylon = BabylonLoader.getParsedBabylonData(assetID);\n                // BabylonLoader.assembleBabylon(assetID, dataBabylon);\n                // 关联mesh\n                assembleSceneMesh(entity, dataBabylon);\n            } else {\n                if (assetID in loadingBabylonFlag) {\n                    toLoadEntity[assetID].push(entity);\n                } else {\n                    loadingBabylonFlag[assetID] = true;\n                    toLoadEntity[assetID] = [entity];\n\n\n\n                    getJsonAsset(Config.projectID, assetID, BabylonLoader.assetsData.assets[assetID].name, BabylonLoader.assetsData.assets[assetID].file.hash).then(response => {\n                        dataBabylon = JSON.parse(response);\n                        BabylonLoader.babylonCacheData[assetID] = dataBabylon;\n                        // BabylonLoader.parseBabylon(assetID, data);\n                        BabylonLoader.parseBabylon(assetID, dataBabylon);\n                        dataBabylon = BabylonLoader.getParsedBabylonData(assetID);\n                        toLoadEntity[assetID].forEach((item: Observer) => {\n                            assembleSceneMesh(item, dataBabylon);\n                        });\n                        // 关联mesh\n                    })\n                }\n            }\n        }\n\n\n        let assembleSceneMesh = async (entity: Observer, parsedBabylon: any) => {\n            // TODO: 暂时未考虑TransformNode数据的情况\n            if (parsedBabylon) {\n                let assetID: string = entity.get('asset_id');\n                // 先从.babylon提取原始mesh数据\n                let meshID: string = entity.get('babylon_id');\n                if (parsedBabylon.meshes[meshID]) {\n                    let meshData = parsedBabylon.meshes[meshID];\n                    // 结合scene和babylon数据，更新mesh信息\n                    meshData.position = entity.has('position') && entity.get('position') ? entity.get('position') : meshData.position;\n                    let recordRotation = entity.get('rotation');\n                    if (recordRotation && recordRotation.length > 0) {\n                        recordRotation = Tools.vector3ToArray(Tools.eulerAngleToRadian(BABYLON.Vector3.FromArray(recordRotation)));\n                    } else {\n                        recordRotation = meshData.rotation;\n                    }\n                    meshData.rotation = recordRotation;\n                    // console.log(meshData.name);\n                    // console.warn(meshData.rotation);\n                    meshData.scaling = entity.has('scale') && entity.get('scale') ? entity.get('scale') : meshData.scaling;\n                    meshData.name = entity.has('name') && entity.get('name') ? entity.get('name') : meshData.name;\n                    meshData.id = entity.has('resource_id') && entity.get('resource_id') ? entity.get('resource_id') : meshData.id;\n                    meshData.isEnabled = entity.has('enabled') ? entity.get('enabled') : meshData.isEnabled;\n                    meshData.isVisible = entity.has('isVisible') ? entity.get('isVisible') : meshData.isVisible;\n                    // meshData.pickable = entity.has('pickable') ? entity.get('pickable') : meshData.pickable;\n                    // TODO：scene编辑条件下默认就是加载状态；\n                    meshData.pickable = true;\n                    meshData.checkCollisions = entity.has('checkCollisions') ? entity.get('checkCollisions') : meshData.checkCollisions;\n                    meshData.materialId = entity.has('material_id') ? entity.get('material_id') : meshData.materialId;\n                    // 要注意是否为root id\n                    meshData.parentId = entity.has('parent') ? entity.get('parent') : meshData.parentId;\n\n\n                    // 判断是否关联了geometry\n                    if (meshData.geometryId) {\n                        if (VeryEngine.viewScene.getGeometryByID(meshData.geometryId) === null) {\n                            if (parsedBabylon.geometries && parsedBabylon.geometries[meshData.geometryId]) {\n                                let vertexData = parsedBabylon.geometries[meshData.geometryId];\n                                await BabylonLoader.loadGeometry(vertexData, VeryEngine.viewScene, '');\n                            }\n                        }\n                    }\n                    // 组装material\n                    // console.error(meshData.materialId);\n                    if (meshData.materialId) {\n                        if (VeryEngine.viewScene.getMaterialByID(meshData.materialId) === null) {\n                            // console.error(BabylonLoader.assetsData.babylon[assetID]);\n                            if (BabylonLoader.assetsData.babylon[assetID]) {\n                                let mats = BabylonLoader.assetsData.babylon[assetID]['materials'];\n                                if (mats && mats[meshData.materialId]) {\n                                    let matAssetID = mats[meshData.materialId].asset_id;\n                                    if (BabylonLoader.assetsData.assets[matAssetID]) {\n                                        let newMat = BabylonLoader.assetsData.assets[matAssetID].data;\n\n                                        // 检测texture\n                                        if (newMat.diffuseTexture && newMat.diffuseTexture.texture_id) {\n                                            newMat.diffuseTexture.name = BabylonLoader.prefix + newMat.diffuseTexture.texture_id + '/' + BabylonLoader.assetsData.assets[newMat.diffuseTexture.texture_id].name;\n\n                                        }\n                                        if (newMat.specularTexture && newMat.specularTexture.texture_id) {\n                                            newMat.specularTexture.name = BabylonLoader.prefix + newMat.specularTexture.texture_id + '/' + BabylonLoader.assetsData.assets[newMat.specularTexture.texture_id].name;\n                                        }\n                                        if (newMat.reflectionTexture && newMat.reflectionTexture.texture_id) {\n                                            newMat.reflectionTexture.name = BabylonLoader.prefix + newMat.reflectionTexture.texture_id + '/' + BabylonLoader.assetsData.assets[newMat.reflectionTexture.texture_id].name;\n                                        }\n                                        if (newMat.refractionTexture && newMat.refractionTexture.texture_id) {\n                                            newMat.refractionTexture.name = BabylonLoader.prefix + newMat.refractionTexture.texture_id + '/' + BabylonLoader.assetsData.assets[newMat.refractionTexture.texture_id].name;\n                                        }\n                                        if (newMat.emissiveTexture && newMat.emissiveTexture.texture_id) {\n                                            newMat.emissiveTexture.name = BabylonLoader.prefix + newMat.emissiveTexture.texture_id + '/' + BabylonLoader.assetsData.assets[newMat.emissiveTexture.texture_id].name;\n                                        }\n                                        if (newMat.bumpTexture && newMat.bumpTexture.texture_id) {\n                                            newMat.bumpTexture.name = BabylonLoader.prefix + newMat.bumpTexture.texture_id + '/' + BabylonLoader.assetsData.assets[newMat.bumpTexture.texture_id].name;\n                                        }\n                                        if (newMat.opacityTexture && newMat.opacityTexture.texture_id) {\n                                            newMat.opacityTexture.name = BabylonLoader.prefix + newMat.opacityTexture.texture_id + '/' + BabylonLoader.assetsData.assets[newMat.opacityTexture.texture_id].name;\n                                        }\n                                        if (newMat.ambientTexture && newMat.ambientTexture.texture_id) {\n                                            newMat.ambientTexture.name = BabylonLoader.prefix + newMat.ambientTexture.texture_id + '/' + BabylonLoader.assetsData.assets[newMat.ambientTexture.texture_id].name;\n                                        }\n                                        if (newMat.lightmapTexture && newMat.lightmapTexture.texture_id) {\n                                            newMat.lightmapTexture.name = BabylonLoader.prefix + newMat.lightmapTexture.texture_id + '/' + BabylonLoader.assetsData.assets[newMat.lightmapTexture.texture_id].name;\n                                        }\n\n                                        await BabylonLoader.loadMaterial(newMat, VeryEngine.viewScene, '');\n                                    } else {\n                                        console.warn('scene mesh warn');\n                                    }\n                                }\n                            } else {\n                                console.warn('scene mesh warn');\n                            }\n                        }\n                    }\n\n                    // 加载mesh\n                    let mesh = BabylonLoader.loadMesh(meshData, VeryEngine.viewScene, '');\n                    entity.node = mesh;\n                    entitiesIndex[entity.get('resource_id')] = mesh;\n                    childAndParent(entity, mesh);\n                } else {\n                    console.warn('scene mesh warn');\n                }\n            }\n        }\n\n    }\n\n\n\n}","import { Observer } from '../../lib';\nimport { VeryEngine } from '../../engine';\nimport { BabylonLoader } from '../middleware/loader/babylonLoader';\nimport { GizmosCenter } from '../gizmos';\n\nexport class ViewportDropModel {\n\n\n    public constructor() {\n\n\n        editor.method('load:from:asset', (babylon_data: Observer) => {\n            BabylonLoader.loadBabylon(babylon_data);\n            // console.log('assets加载模型');\n            // console.log(babylon_data);\n        });\n\n        editor.method('pick', (mesh: Nullable<BABYLON.AbstractMesh>) => {\n            if (mesh === null) {\n                GizmosCenter.clear();\n                console.log('clear gizmos');\n            } else {\n                console.log('pick mesh');\n                // GizmosCenter.attach(mesh);\n                var entity = editor.call('entities:get', mesh.id);\n                console.error(entity);\n                if (entity) {\n                    editor.call('selector:set', 'entity', [entity]);\n                } else {\n                    console.error('失败');\n                }\n            }\n        });\n\n\n\n        editor.method('loadTempModel', (babylon_data: Observer) => {\n\n            BabylonLoader.loadBabylon(babylon_data);\n            console.log('加载模型');\n            console.log(babylon_data);\n            return;\n            var rootUrl = babylon_data.get('file.url');\n            var modelName = babylon_data.get('file.filename');\n            rootUrl = rootUrl.substring(0, rootUrl.length - modelName.length);\n\n            BABYLON.SceneLoader.Append(rootUrl, modelName, VeryEngine.viewScene, function (scene) {\n\n                // console.log('************mesh个数：' + scene.meshes.length);\n                for (let i = 0; i < scene.meshes.length; i++) {\n                    let mesh = scene.meshes[i];\n                    mesh.checkCollisions = true;\n                    mesh.isPickable = true;\n                    let parentID: string = '';\n                    if (mesh.parent !== null) {\n                        parentID = mesh.parent!.id;\n                    }\n\n                    var childs = mesh.getChildren();\n                    var myChildren = [];\n\n                    for (let k = 0; k < childs.length; k++) {\n                        myChildren.push(childs[k].id);\n                    }\n\n                    let data = {\n                        name: mesh.name,\n                        resource_id: mesh.id,\n                        parent: parentID,\n                        position: [mesh.position.x, mesh.position.y, mesh.position.z],\n                        rotation: [mesh.rotation.x, mesh.rotation.y, mesh.rotation.z],\n                        scale: [mesh.scaling.x, mesh.scaling.y, mesh.scaling.z],\n                        children: myChildren,\n                        enabled: mesh.isEnabled(),\n                        tags: [],\n                        root: false,\n                        type: 'Mesh',\n                        asset: rootUrl,\n                        asset2: modelName\n                    }\n                    // console.log(scene.meshes[i].id + ' : ' + scene.meshes[i].name);\n                    // console.error(data);\n                    editor.call('entity:new:babylon', data);\n                }\n\n                for (let i = 0; i < scene.transformNodes.length; i++) {\n                    let node = scene.transformNodes[i];\n                    let parentID: string = '';\n                    if (node.parent !== null) {\n                        parentID = node.parent!.id;\n                    }\n\n                    let data = {\n                        name: node.name,\n                        resource_id: node.id,\n                        parent: parentID,\n                        position: [node.position.x, node.position.y, node.position.z],\n                        rotation: [node.rotation.x, node.rotation.y, node.rotation.z],\n                        scale: [node.scaling.x, node.scaling.y, node.scaling.z],\n                        children: myChildren,\n                        enabled: node.isEnabled(),\n                        tags: [],\n                        root: false,\n                        type: 'TransformNode',\n                        asset: rootUrl,\n                        asset2: modelName\n                    }\n                    // console.log(scene.meshes[i].id + ' : ' + scene.meshes[i].name);\n                    editor.call('entity:new:babylon', data);\n                }\n\n                // console.error('加载');\n\n                editor.emit('entities:load', true);\n\n                // console.log('************node个数：' + scene.transformNodes.length);\n                // for(let i = 0; i < scene.transformNodes.length; i++) {\n                //     console.log(scene.transformNodes[i].id + ' : ' + scene.transformNodes[i].name);\n                // }\n                // console.log('************root个数：' + scene.rootNodes.length);\n                // for(let i = 0; i < scene.rootNodes.length; i++) {\n                //     console.log(scene.rootNodes[i].id + ' : ' + scene.rootNodes[i].name);\n                // }\n\n\n                scene.onPointerObservable.add(pointerInfo => {\n                    switch (pointerInfo.type) {\n                        case BABYLON.PointerEventTypes.POINTERDOWN:\n                            // console.log('down');\n                            if (pointerInfo!.pickInfo!.pickedMesh != null) {\n                                editor.call('pick', pointerInfo!.pickInfo!.pickedMesh);\n                            } else {\n                                editor.call('pick', null);\n                            }\n                            // console.log(pointerInfo!.pickInfo!.pickedMesh);\n                            break;\n                    }\n\n\n                });\n            });\n\n            // 默认加载\n\n            // editor.method('entity:new:mesh', )\n\n        });\n\n\n        editor.method('loadTempModel2', (rootUrl: string, modelName: string) => {\n\n            BABYLON.SceneLoader.Append(rootUrl, modelName, VeryEngine.viewScene, function (scene) {\n                // console.error('加载2');\n\n                // console.log('************mesh个数：' + scene.meshes.length);\n                for (let i = 0; i < scene.meshes.length; i++) {\n                    let mesh = scene.meshes[i];\n                    mesh.checkCollisions = true;\n                    mesh.isPickable = true;\n\n                    var entity = editor.call('entities:get', mesh.id);\n                    if (entity) {\n                        entity.node = mesh;\n                    }\n                    // let parentID: string = '';\n                    // if (mesh.parent !== null) {\n                    //     parentID = mesh.parent!.id;\n                    // }\n\n                    // var childs = mesh.getChildren();\n                    // var myChildren = [];\n\n                    // for (let k = 0; k < childs.length; k++) {\n                    //     myChildren.push(childs[k].id);\n                    // }\n\n                    // let data = {\n                    //     name: mesh.name,\n                    //     resource_id: mesh.id,\n                    //     parent: parentID,\n                    //     position: [mesh.position.x, mesh.position.y, mesh.position.z],\n                    //     rotation: [mesh.rotation.x, mesh.rotation.y, mesh.rotation.z],\n                    //     scale: [mesh.scaling.x, mesh.scaling.y, mesh.scaling.z],\n                    //     children: myChildren,\n                    //     enabled: mesh.isEnabled(),\n                    //     tags: [],\n                    //     root: false,\n                    //     type: 'Mesh',\n                    //     asset: rootUrl,\n                    //     asset2: modelName\n                    // }\n                    // // console.log(scene.meshes[i].id + ' : ' + scene.meshes[i].name);\n                    // // console.error(data);\n                    // editor.call('entity:new:babylon', data);\n                }\n\n                for (let i = 0; i < scene.transformNodes.length; i++) {\n                    let node = scene.transformNodes[i];\n                    let parentID: string = '';\n                    if (node.parent !== null) {\n                        parentID = node.parent!.id;\n                    }\n\n                    var entity = editor.call('entities:get', node.id);\n                    if (entity) {\n                        entity.node = node;\n                    }\n                    // let data = {\n                    //     name: node.name,\n                    //     resource_id: node.id,\n                    //     parent: parentID,\n                    //     position: [node.position.x, node.position.y, node.position.z],\n                    //     rotation: [node.rotation.x, node.rotation.y, node.rotation.z],\n                    //     scale: [node.scaling.x, node.scaling.y, node.scaling.z],\n                    //     children: myChildren,\n                    //     enabled: node.isEnabled(),\n                    //     tags: [],\n                    //     root: false,\n                    //     type: 'TransformNode',\n                    //     asset: rootUrl,\n                    //     asset2: modelName\n                    // }\n                    // // console.log(scene.meshes[i].id + ' : ' + scene.meshes[i].name);\n                    // editor.call('entity:new:babylon', data);\n                }\n\n\n                // editor.emit('entities:load', true);\n\n                // console.log('************node个数：' + scene.transformNodes.length);\n                // for(let i = 0; i < scene.transformNodes.length; i++) {\n                //     console.log(scene.transformNodes[i].id + ' : ' + scene.transformNodes[i].name);\n                // }\n                // console.log('************root个数：' + scene.rootNodes.length);\n                // for(let i = 0; i < scene.rootNodes.length; i++) {\n                //     console.log(scene.rootNodes[i].id + ' : ' + scene.rootNodes[i].name);\n                // }\n\n\n                scene.onPointerObservable.add(pointerInfo => {\n                    switch (pointerInfo.type) {\n                        case BABYLON.PointerEventTypes.POINTERDOWN:\n                            // console.log('down');\n                            if (pointerInfo!.pickInfo!.pickedMesh != null) {\n                                editor.call('pick', pointerInfo!.pickInfo!.pickedMesh);\n                            } else {\n                                editor.call('pick', null);\n                            }\n                            // console.log(pointerInfo!.pickInfo!.pickedMesh);\n                            break;\n                    }\n                });\n            });\n\n\n\n        });\n\n\n        var canvas = editor.call('viewport:canvas');\n        if (! canvas) return;\n\n        var dropRef = editor.call('drop:target', {\n            ref: canvas.element,\n            filter: function (type: string, data: any) {\n                if (type === 'asset.model') {\n                    // var asset = app.assets.get(data.id);\n                    // if (asset) app.assets.load(asset);\n\n                    return true;\n                }\n\n                if (type === 'assets') {\n                    for (var i = 0; i < data.ids.length; i++) {\n                        var asset = editor.call('assets:get', data.ids[i]);\n                        if (!asset)\n                            return false;\n\n                        if (asset.get('type') !== 'model')\n                            return false;\n                    }\n\n                    // for (var i = 0; i < data.ids.length; i++) {\n                    //     var asset = app.assets.get(data.ids[i]);\n                    //     if (asset) app.assets.load(asset);\n                    // }\n\n                    return true;\n                }\n\n                return false;\n            },\n            drop: function (type: string, data: any) {\n                // if (!config.scene.id)\n                //     return;\n                console.warn('viewport drop: ' + type);\n\n                var assets = [];\n\n                if (type === 'asset.model') {\n                    var asset = editor.call('assets:get', data.id);\n                    if (asset) assets.push(asset);\n                } else if (type === 'assets') {\n                    for (var i = 0; i < data.ids.length; i++) {\n                        var asset = editor.call('assets:get', data.ids[i]);\n                        if (asset && asset.get('type') === 'model')\n                            assets.push(asset);\n                    }\n                }\n\n                if (!assets.length)\n                    return;\n\n                // parent\n                var parent = null;\n                if (editor.call('selector:type') === 'entity')\n                    parent = editor.call('selector:items')[0];\n\n                if (!parent)\n                    parent = editor.call('entities:root');\n\n                var entities = [];\n                var data: any = [];\n\n                // calculate aabb\n                // var first = true;\n                // for (var i = 0; i < assets.length; i++) {\n                //     var assetEngine = app.assets.get(assets[i].get('id'));\n                //     if (!assetEngine) continue;\n\n                //     if (assetEngine.resource) {\n                //         var meshes = assetEngine.resource.meshInstances;\n                //         for (var m = 0; m < meshes.length; m++) {\n                //             if (first) {\n                //                 first = false;\n                //                 aabb.copy(meshes[m].aabb);\n                //             } else {\n                //                 aabb.add(meshes[m].aabb);\n                //             }\n                //         }\n                //     }\n                // }\n\n                // if (first) {\n                //     aabb.center.set(0, 0, 0);\n                //     aabb.halfExtents.set(1, 1, 1);\n                // }\n\n                // calculate point\n                // var camera = editor.call('camera:current');\n                // var distance = 0;\n\n                // if (ui.Tree._ctrl && ui.Tree._ctrl()) {\n                //     vecA.copy(camera.forward).scale(aabb.halfExtents.length() * 2.2);\n                //     vecB.copy(camera.getPosition()).add(vecA);\n                //     vecC.copy(vecB).sub(aabb.center);\n\n                //     var tmp = new pc.Entity();\n                //     parent.entity.addChild(tmp);\n                //     tmp.setPosition(vecC);\n                //     vecC.copy(tmp.getLocalPosition());\n                //     tmp.destroy();\n\n                //     // focus distance\n                //     distance = vecA.copy(camera.getPosition()).sub(vecB).length();\n                // } else {\n                //     vecC.set(0, 0, 0);\n                //     vecB.copy(parent.entity.getPosition()).add(aabb.center);\n                //     distance = aabb.halfExtents.length() * 2.2;\n                // }\n\n                // for (var i = 0; i < assets.length; i++) {\n                //     var component = editor.call('components:getDefault', 'model');\n                //     component.type = 'asset';\n                //     component.asset = parseInt(assets[i].get('id'), 10);\n\n                //     var name = assets[i].get('name');\n                //     if (/\\.json$/i.test(name))\n                //         name = name.slice(0, -5) || 'Untitled';\n\n                //     // new entity\n                //     var entity = editor.call('entities:new', {\n                //         parent: parent,\n                //         name: name,\n                //         position: [vecC.x, vecC.y, vecC.z],\n                //         components: {\n                //             model: component\n                //         },\n                //         noSelect: true,\n                //         noHistory: true\n                //     });\n\n                //     entities.push(entity);\n                //     data.push(entity.json());\n                // }\n\n                // editor.call('selector:history', false);\n                // editor.call('selector:set', 'entity', entities);\n                // editor.once('selector:change', function () {\n                //     editor.call('selector:history', true);\n                // });\n\n                // var selectorType = editor.call('selector:type');\n                // var selectorItems = editor.call('selector:items');\n                // if (selectorType === 'entity') {\n                //     for (var i = 0; i < selectorItems.length; i++)\n                //         selectorItems[i] = selectorItems[i].get('resource_id');\n                // }\n\n                // var parentId = parent.get('resource_id');\n                // var resourceIds = [];\n                // for (var i = 0; i < entities.length; i++)\n                //     resourceIds.push(entities[i].get('resource_id'));\n\n                // editor.call('history:add', {\n                //     name: 'new model entities ' + entities.length,\n                //     undo: function () {\n                //         for (var i = 0; i < resourceIds.length; i++) {\n                //             var entity = editor.call('entities:get', resourceIds[i]);\n                //             if (!entity)\n                //                 continue;\n\n                //             editor.call('entities:removeEntity', entity);\n                //         }\n\n                //         if (selectorType === 'entity' && selectorItems.length) {\n                //             var items = [];\n                //             for (var i = 0; i < selectorItems.length; i++) {\n                //                 var item = editor.call('entities:get', selectorItems[i]);\n                //                 if (item)\n                //                     items.push(item);\n                //             }\n\n                //             if (items.length) {\n                //                 editor.call('selector:history', false);\n                //                 editor.call('selector:set', selectorType, items);\n                //                 editor.once('selector:change', function () {\n                //                     editor.call('selector:history', true);\n                //                 });\n                //             }\n                //         }\n                //     },\n                //     redo: function () {\n                //         var parent = editor.call('entities:get', parentId);\n                //         if (!parent)\n                //             return;\n\n                //         var entities = [];\n\n                //         for (var i = 0; i < data.length; i++) {\n                //             var entity = new Observer(data[i]);\n                //             entities.push(entity);\n                //             editor.call('entities:addEntity', entity, parent, false);\n                //         }\n\n                //         editor.call('selector:history', false);\n                //         editor.call('selector:set', 'entity', entities);\n                //         editor.once('selector:change', function () {\n                //             editor.call('selector:history', true);\n                //         });\n\n                //         editor.call('viewport:render');\n                //         editor.call('camera:focus', vecB, distance);\n                //     }\n                // });\n\n                // editor.call('viewport:render');\n                // editor.call('camera:focus', vecB, distance);\n            }\n        });\n\n\n    }\n}","import { getUrl } from \"../../tools/ossfile\";\nimport { VeryEngine } from \"../../engine\";\nimport { Observer } from \"../../lib\";\nimport { VeryCamera } from \"../middleware\";\nimport { BabylonLoader } from \"../middleware/loader/babylonLoader\";\nimport { Tools } from \"../utility\";\nimport { Config } from \"../global\";\nimport { GUIManager } from \"../gui\";\n\nexport class ViewportEntitiesObserverBinding {\n\n\n\n    public constructor() {\n        // let nnnode = new BABYLON.Node('sdf', VeryEngine.viewScene);\n        // nnnode\n        editor.on('entities:add', function (obj: Observer) {\n            // console.warn(obj);\n            // subscribe to changes\n            obj.on('*:set', function (path: string, value: any) {\n                var entity = obj.node;\n                if (!entity)\n                    return;\n\n                if (path === 'name') {\n                    entity.name = obj.get('name');\n\n                } else if (path.startsWith('position')) {\n                    // TODO: 有数据值的最好换一个通用的方式记录\n                    entity.position = new BABYLON.Vector3(obj.get('position.0'), obj.get('position.1'), obj.get('position.2'));\n\n                } else if (path.startsWith('rotation')) {\n                    entity.rotation = Tools.eulerAngleToRadian(new BABYLON.Vector3(obj.get('rotation.0'), obj.get('rotation.1'), obj.get('rotation.2')));\n\n                } else if (path.startsWith('scale')) {\n                    entity.scaling = new BABYLON.Vector3(obj.get('scale.0'), obj.get('scale.1'), obj.get('scale.2'));\n\n                } else if (path.startsWith('enabled')) {\n                    entity.setEnabled(obj.get('enabled'));\n                } else if (path.startsWith('checkCollisions')) {\n                    entity.checkCollisions = obj.get('checkCollisions');\n                } else if (path.startsWith('pickable')) {\n                    // TODO: 编辑场景下entity不改，一直为true，publish加载才真改\n                    // entity.isPickable = obj.get('pickable');\n\n                } else if (path.startsWith('isVisible')) {\n                    entity.isVisible = obj.get('isVisible');\n                } else if (path.startsWith('parent')) {\n                    // 父子关系设定\n                    var parent = editor.call('entities:get', obj.get('parent'));\n\n                    // console.log('parent');\n                    // console.warn(parent);\n                    // TODO\n                    // if (parent && parent.node && entity.parent !== parent.node)\n                    //     entity.parent = parent.node;\n                } else if (path === 'components.model.type' && value === 'asset') {\n                    // WORKAROUND\n                    // entity deletes asset when switching to primitive, restore it\n                    // do this in a timeout to allow the model type to change first\n                    // setTimeout(function () {\n                    //     var assetId = obj.get('components.model.asset');\n                    // if (assetId)\n                    //     entity.model.asset = assetId;\n                    // });\n                }\n                // 事件绑定到创建时\n                else if (path === 'clearColor') {\n                    if (entity instanceof VeryCamera) {\n                        entity.clearColor = BABYLON.Color4.FromArray(value);\n                    }\n                } else if (path === 'mode') {\n                    if (entity instanceof VeryCamera) {\n                        entity.mode = value;\n                    }\n                } else if (path === 'orthoSize') {\n                    if (entity instanceof VeryCamera) {\n                        entity.orthoSize = value;\n                    }\n                } else if (path === 'fov') {\n                    if (entity instanceof VeryCamera) {\n                        // entity.fov = Tools.eulerAngleFloatToRadian(value);\n                        entity.fov = value;\n                    }\n                } else if (path === 'minZ') {\n                    if (entity instanceof VeryCamera) {\n                        entity.minZ = value;\n                    }\n                } else if (path === 'maxZ') {\n                    if (entity instanceof VeryCamera) {\n                        entity.maxZ = value;\n                    }\n                } else if (path === 'applyGravity') {\n                    if (entity instanceof VeryCamera) {\n                        entity.applyGravity = value;\n                    }\n                }\n                // 2D-GUI\n                else if (path === 'gui.isVisible') {\n                    if (entity instanceof BABYLON.GUI.Control) {\n                        (<BABYLON.GUI.Control>entity).isVisible = value;\n                    } else if (entity instanceof BABYLON.GUI.AdvancedDynamicTexture) {\n                        (<BABYLON.GUI.AdvancedDynamicTexture>entity).rootContainer.isVisible = value;\n                    }\n                } else if (path === 'gui.xType') {\n                    if (entity instanceof BABYLON.GUI.Control) {\n                        if (value === 0) {\n                            (<BABYLON.GUI.Control>entity).left = obj.get('gui.x') + 'px';\n                        } else {\n                            (<BABYLON.GUI.Control>entity).left = obj.get('gui.x') + '%';\n                        }\n                    } else if (entity instanceof BABYLON.GUI.AdvancedDynamicTexture) {\n                        if (value === 0) {\n                            (<BABYLON.GUI.AdvancedDynamicTexture>entity).rootContainer.left = obj.get('gui.x') + 'px';\n                        } else {\n                            (<BABYLON.GUI.AdvancedDynamicTexture>entity).rootContainer.left = obj.get('gui.x') + '%';\n                        }\n                    }\n                } else if (path === 'gui.x') {\n                    if (entity instanceof BABYLON.GUI.Control) {\n                        if (obj.get('gui.xType') === 0) {\n                            (<BABYLON.GUI.Control>entity).left = value + 'px';\n                        } else {\n                            (<BABYLON.GUI.Control>entity).left = value + '%';\n                        }\n                    } else if (entity instanceof BABYLON.GUI.AdvancedDynamicTexture) {\n                        if (obj.get('gui.xType') === 0) {\n                            (<BABYLON.GUI.AdvancedDynamicTexture>entity).rootContainer.left = value + 'px';\n                        } else {\n                            (<BABYLON.GUI.AdvancedDynamicTexture>entity).rootContainer.left = value + '%';\n                        }\n                    }\n                } else if (path === 'gui.yType') {\n                    if (entity instanceof BABYLON.GUI.Control) {\n                        if (value === 0) {\n                            (<BABYLON.GUI.Control>entity).top = obj.get('gui.y') + 'px';\n                        } else {\n                            (<BABYLON.GUI.Control>entity).top = obj.get('gui.y') + '%';\n                        }\n                    } else if (entity instanceof BABYLON.GUI.AdvancedDynamicTexture) {\n                        if (value === 0) {\n                            (<BABYLON.GUI.AdvancedDynamicTexture>entity).rootContainer.top = obj.get('gui.y') + 'px';\n                        } else {\n                            (<BABYLON.GUI.AdvancedDynamicTexture>entity).rootContainer.top = obj.get('gui.y') + '%';\n                        }\n                    }\n                } else if (path === 'gui.y') {\n                    if (entity instanceof BABYLON.GUI.Control) {\n                        if (obj.get('gui.yType') === 0) {\n                            (<BABYLON.GUI.Control>entity).top = value + 'px';\n                        } else {\n                            (<BABYLON.GUI.Control>entity).top = value + '%';\n                        }\n                    } else if (entity instanceof BABYLON.GUI.AdvancedDynamicTexture) {\n                        if (obj.get('gui.yType') === 0) {\n                            (<BABYLON.GUI.AdvancedDynamicTexture>entity).rootContainer.top = value + 'px';\n                        } else {\n                            (<BABYLON.GUI.AdvancedDynamicTexture>entity).rootContainer.top = value + '%';\n                        }\n                    }\n                } else if (path === 'gui.widthType') {\n                    if (entity instanceof BABYLON.GUI.Control) {\n                        if (value === 0) {\n                            (<BABYLON.GUI.Control>entity).width = obj.get('gui.width') + 'px';\n                        } else {\n                            (<BABYLON.GUI.Control>entity).width = obj.get('gui.width') + '%';\n                        }\n                    } else if (entity instanceof BABYLON.GUI.AdvancedDynamicTexture) {\n                        if (value === 0) {\n                            (<BABYLON.GUI.AdvancedDynamicTexture>entity).rootContainer.width = obj.get('gui.width') + 'px';\n                        } else {\n                            (<BABYLON.GUI.AdvancedDynamicTexture>entity).rootContainer.width = obj.get('gui.width') + '%';\n                        }\n                    }\n                } else if (path === 'gui.width') {\n                    if (entity instanceof BABYLON.GUI.Control) {\n                        if (obj.get('gui.widthType') === 0) {\n                            (<BABYLON.GUI.Control>entity).width = value + 'px';\n                        } else {\n                            (<BABYLON.GUI.Control>entity).width = value + '%';\n                        }\n                    } else if (entity instanceof BABYLON.GUI.AdvancedDynamicTexture) {\n                        if (obj.get('gui.widthType') === 0) {\n                            (<BABYLON.GUI.AdvancedDynamicTexture>entity).rootContainer.width = value + 'px';\n                        } else {\n                            (<BABYLON.GUI.AdvancedDynamicTexture>entity).rootContainer.width = value + '%';\n                        }\n                    }\n                } else if (path === 'gui.heightType') {\n                    if (entity instanceof BABYLON.GUI.Control) {\n                        if (value === 0) {\n                            (<BABYLON.GUI.Control>entity).height = obj.get('gui.height') + 'px';\n                        } else {\n                            (<BABYLON.GUI.Control>entity).height = obj.get('gui.height') + '%';\n                        }\n                    } else if (entity instanceof BABYLON.GUI.AdvancedDynamicTexture) {\n                        if (value === 0) {\n                            (<BABYLON.GUI.AdvancedDynamicTexture>entity).rootContainer.height = obj.get('gui.height') + 'px';\n                        } else {\n                            (<BABYLON.GUI.AdvancedDynamicTexture>entity).rootContainer.height = obj.get('gui.height') + '%';\n                        }\n                    }\n                } else if (path === 'gui.height') {\n                    if (entity instanceof BABYLON.GUI.Control) {\n                        if (obj.get('gui.heightType') === 0) {\n                            (<BABYLON.GUI.Control>entity).height = value + 'px';\n                        } else {\n                            (<BABYLON.GUI.Control>entity).height = value + '%';\n                        }\n                    } else if (entity instanceof BABYLON.GUI.AdvancedDynamicTexture) {\n                        if (obj.get('gui.heightType') === 0) {\n                            (<BABYLON.GUI.AdvancedDynamicTexture>entity).rootContainer.height = value + 'px';\n                        } else {\n                            (<BABYLON.GUI.AdvancedDynamicTexture>entity).rootContainer.height = value + '%';\n                        }\n                    }\n                } else if (path === 'gui.horizontal_alignment') {\n                    if (entity instanceof BABYLON.GUI.Control) {\n                        (<BABYLON.GUI.Control>entity).horizontalAlignment = value;\n                    } else if (entity instanceof BABYLON.GUI.AdvancedDynamicTexture) {\n                        (<BABYLON.GUI.AdvancedDynamicTexture>entity).rootContainer.horizontalAlignment = value;\n                    }\n                } else if (path === 'gui.vertical_alignment') {\n                    if (entity instanceof BABYLON.GUI.Control) {\n                        (<BABYLON.GUI.Control>entity).verticalAlignment = value;\n                    } else if (entity instanceof BABYLON.GUI.AdvancedDynamicTexture) {\n                        (<BABYLON.GUI.AdvancedDynamicTexture>entity).rootContainer.verticalAlignment = value;\n                    }\n                } else if (path === 'gui.alpha') {\n                    if (entity instanceof BABYLON.GUI.Control) {\n                        (<BABYLON.GUI.Control>entity).alpha = value;\n                    } else if (entity instanceof BABYLON.GUI.AdvancedDynamicTexture) {\n                        (<BABYLON.GUI.AdvancedDynamicTexture>entity).rootContainer.alpha = value;\n                    }\n                } else if (path === 'gui.rotation') {\n                    if (entity instanceof BABYLON.GUI.Control) {\n                        (<BABYLON.GUI.Control>entity).rotation = Tools.eulerAngleFloatToRadian(value);\n                    } else if (entity instanceof BABYLON.GUI.AdvancedDynamicTexture) {\n                        (<BABYLON.GUI.AdvancedDynamicTexture>entity).rootContainer.rotation = Tools.eulerAngleFloatToRadian(value);\n                    }\n                } else if (path === 'gui.color') {\n                    if (entity instanceof BABYLON.GUI.Control) {\n                        (<BABYLON.GUI.Control>entity).color = Tools.rgba2hsvString(value);\n                    } else if (entity instanceof BABYLON.GUI.AdvancedDynamicTexture) {\n                        (<BABYLON.GUI.AdvancedDynamicTexture>entity).rootContainer.color = Tools.rgba2hsvString(value);\n                    }\n                } else if (path === 'gui.background') {\n                    if (entity instanceof BABYLON.GUI.Control) {\n                        (<any>entity).background = Tools.rgba2hsvString(value);\n                    }\n                } else if (path === 'gui.textColor') {\n                    if (entity instanceof BABYLON.GUI.Button) {\n                        (<BABYLON.GUI.Button>entity).textBlock!.color = Tools.rgba2hsvString(value);\n                    }\n                } else if (path === 'gui.text') {\n                    if (entity instanceof BABYLON.GUI.Button) {\n                        (<BABYLON.GUI.Button>entity).textBlock!.text = value;\n                    } else if (entity instanceof BABYLON.GUI.TextBlock) {\n                        (<BABYLON.GUI.TextBlock>entity).text = value;\n                    } else if (entity instanceof BABYLON.GUI.InputText) {\n                        (<BABYLON.GUI.InputText>entity).text = value;\n                    }\n                } else if (path === 'gui.thickness') {\n                    if (entity instanceof BABYLON.GUI.Button) {\n                        (<BABYLON.GUI.Button>entity).thickness = value;\n                    } else if (entity instanceof BABYLON.GUI.Rectangle) {\n                        (<BABYLON.GUI.Rectangle>entity).thickness = value;\n                    } else if (entity instanceof BABYLON.GUI.InputText) {\n                        (<BABYLON.GUI.InputText>entity).thickness = value;\n                    } else if (entity instanceof BABYLON.GUI.Checkbox) {\n                        (<BABYLON.GUI.Checkbox>entity).thickness = value;\n                    }\n                } else if (path === 'gui.cornerRadius') {\n                    if (entity instanceof BABYLON.GUI.Button) {\n                        (<BABYLON.GUI.Button>entity).cornerRadius = value;\n                    } else if (entity instanceof BABYLON.GUI.Rectangle) {\n                        (<BABYLON.GUI.Rectangle>entity).cornerRadius = value;\n                    }\n                } else if (path === 'gui.fontSize') {\n                    if (entity instanceof BABYLON.GUI.TextBlock) {\n                        (<BABYLON.GUI.TextBlock>entity).fontSize = value;\n                    } else if (entity instanceof BABYLON.GUI.InputText) {\n                        (<BABYLON.GUI.InputText>entity).fontSize = value;\n                    } else if (entity instanceof BABYLON.GUI.Button) {\n                        (<BABYLON.GUI.Button>entity).textBlock!.fontSize = value;\n                    }\n                } else if (path === 'gui.placeholderText') {\n                    if (entity instanceof BABYLON.GUI.InputText) {\n                        (<BABYLON.GUI.InputText>entity).placeholderText = value;\n                    }\n                } else if (path === 'gui.placeholderColor') {\n                    if (entity instanceof BABYLON.GUI.InputText) {\n                        (<BABYLON.GUI.InputText>entity).placeholderColor = Tools.rgba2hsvString(value);\n                    }\n                } else if (path === 'gui.focusedBackground') {\n                    if (entity instanceof BABYLON.GUI.InputText) {\n                        (<BABYLON.GUI.InputText>entity).focusedBackground = Tools.rgba2hsvString(value);\n                    }\n                } else if (path === 'gui.isChecked') {\n                    if (entity instanceof BABYLON.GUI.RadioButton) {\n                        (<BABYLON.GUI.RadioButton>entity).isChecked = value;\n                    }\n                } else if (path === 'gui.textWrapping') {\n                    if (entity instanceof BABYLON.GUI.TextBlock) {\n                        (<BABYLON.GUI.TextBlock>entity).textWrapping = value;\n                    }\n                } else if (path === 'gui.textHorizontalAlignment') {\n                    if (entity instanceof BABYLON.GUI.TextBlock) {\n                        (<BABYLON.GUI.TextBlock>entity).textHorizontalAlignment = value;\n                    }\n                } else if (path === 'gui.textVerticalAlignment') {\n                    if (entity instanceof BABYLON.GUI.TextBlock) {\n                        (<BABYLON.GUI.TextBlock>entity).textVerticalAlignment = value;\n                    }\n                } else if (path === 'gui.isHighlighted') {\n                    if (entity instanceof BABYLON.GUI.AdvancedDynamicTexture) {\n                        (<BABYLON.GUI.AdvancedDynamicTexture>entity).rootContainer.isHighlighted = value;\n                    } else if(entity instanceof BABYLON.GUI.Control) {\n                        (<BABYLON.GUI.Control>entity).isHighlighted = value;\n                    }\n                }  else if (path === 'gui.zIndex') {\n                    if (entity instanceof BABYLON.GUI.AdvancedDynamicTexture) {\n                        (<BABYLON.GUI.AdvancedDynamicTexture>entity).rootContainer.zIndex = value;\n                        (<BABYLON.GUI.AdvancedDynamicTexture>entity).rootContainer._markAllAsDirty();\n                    } else if(entity instanceof BABYLON.GUI.Control) {\n                        (<BABYLON.GUI.Control>entity).zIndex = value;\n                        (<BABYLON.GUI.Control>entity)._markAllAsDirty();\n                    }\n                } else if (path === 'gui.source') {\n                    // console.error(value);\n                    if(value) {\n                        let asset = editor.call('assets:get', value);\n                        if (asset) {\n                            if (entity instanceof BABYLON.GUI.Image) {\n                                getUrl(Config.projectID, asset.get('id'), asset.get('name'), asset.get('file.hash')).then(response => {\n                                    (<BABYLON.GUI.Image>entity).source = response;\n                                });\n                                // (<BABYLON.GUI.TextBlock>entity).textVerticalAlignment = value;\n                            } else if (entity instanceof BABYLON.GUI.Button) {\n                                getUrl(Config.projectID, asset.get('id'), asset.get('name'), asset.get('file.hash')).then(response => {\n                                    (<BABYLON.GUI.Button>entity).image!.source = response;\n                                });\n                            }\n                        }\n                    } else {\n                        if (entity instanceof BABYLON.GUI.Image) {\n                            (<BABYLON.GUI.Image>entity).source = '';\n                            (<BABYLON.GUI.Image>entity)._markAsDirty();\n                        } else if (entity instanceof BABYLON.GUI.Button) {\n                            (<BABYLON.GUI.Button>entity).image!.source = '';\n                            (<BABYLON.GUI.Button>entity)._markAsDirty();\n                        }\n                    }\n                }\n\n\n                BabylonLoader.updateSceneData(obj.get('resource_id'), obj._data2);\n                // console.error(obj._data2);\n                editor.call('make:scene:dirty');\n\n                // console.warn(entity);\n                // render\n                // editor.call('viewport:render');\n            });\n\n            var reparent = function (child: string, index: number) {\n                // console.warn('reparent : ' + child);\n                var childEntity = editor.call('entities:get', child);\n                if (childEntity && childEntity.node) {\n                    // var oldParent = childEntity.node.parent;\n                    // TODO: Light、Camera等不是TransformNode对象\n                    if (childEntity.node instanceof BABYLON.TransformNode) {\n                        // console.warn(childEntity.node);\n                        let absPos = BABYLON.Vector3.Zero().copyFrom((<BABYLON.TransformNode>childEntity.node).getAbsolutePosition());\n\n                        // TODO: children中的数据要删除\n\n                        // 还有灯和摄像机怎么办\n                        // (<BABYLON.TransformNode>childEntity.node).setAbsolutePosition(absPos);\n                        // console.warn(childEntity.node);\n                        // VeryEngine.viewScene.render();\n\n                        (<BABYLON.TransformNode>childEntity.node).setParent(obj.node ? obj.node : null);\n\n                        // (<BABYLON.TransformNode>childEntity.node).parent =(obj.node ? obj.node : null);\n\n                        // console.log(absPos);\n\n                        // (<BABYLON.TransformNode>childEntity.node).position = new BABYLON.Vector3(5,5,5);\n                        // console.warn(childEntity.node);\n                        let localPosition = childEntity.node.position.clone();\n                        let localRotation = Tools.radianToEulerAngle(childEntity.node.rotation.clone());\n                        childEntity.set('position.0', localPosition.x);\n                        childEntity.set('position.1', localPosition.y);\n                        childEntity.set('position.2', localPosition.z);\n                        childEntity.set('rotation.0', localRotation.x);\n                        childEntity.set('rotation.1', localRotation.y);\n                        childEntity.set('rotation.2', localRotation.z);\n                    } else if (childEntity.node instanceof BABYLON.GUI.Control) {\n                        if (obj.node instanceof BABYLON.GUI.AdvancedDynamicTexture) {\n                            if((<BABYLON.GUI.Control>(childEntity.node)).parent) {\n                                (<BABYLON.GUI.Control>(childEntity.node)).parent?.removeControl(<BABYLON.GUI.Control>(childEntity.node));\n                            }\n                            obj.node.addControl(childEntity.node);\n                            // console.error(childEntity.node.parent);\n                            // console.error(childEntity.node.parent.parent);\n                            // console.warn(index);\n                            // console.log(obj.node.rootContainer.children);\n                            let last = obj.node.rootContainer.children.pop();\n                            obj.node.rootContainer.children.splice(index, 0, last!);\n                            GUIManager.addUniqueIDIndex(childEntity.node.uniqueId, child);\n                        } else if (obj.node instanceof BABYLON.GUI.Container) {\n                            if((<BABYLON.GUI.Control>(childEntity.node)).parent) {\n                                (<BABYLON.GUI.Control>(childEntity.node)).parent?.removeControl(<BABYLON.GUI.Control>(childEntity.node));\n                            }\n                            obj.node.addControl(childEntity.node);\n                            let last = obj.node.children.pop();\n                            obj.node.children.splice(index, 0, last!);\n                            GUIManager.addUniqueIDIndex(childEntity.node.uniqueId, child);\n                        } else {\n                            // editor.call('', '');\n                            console.warn(childEntity.get('subtype'));\n                            console.warn(childEntity.node);\n                            console.log('2D界面未知情况，请截图报错信息并联系管理员！');\n                        }\n                    } else if (childEntity.node instanceof BABYLON.GUI.AdvancedDynamicTexture) {\n\n                    } else {\n                        console.error('当前类型还未考虑');\n                        console.error(childEntity);\n                    }\n                    // childEntity.node.parent = null;\n                    // childEntity.node.parent = obj.node;\n                    // if (oldParent)\n                    //     oldParent.removeChild(childEntity.node);\n\n                    // skip any graph nodes\n                    // if (index > 0) {\n                    //     var children = obj.node.getChildren();\n                    //     for (var i = 0, len = children.length; i < len && index > 0; i++) {\n                    //         if (children[i] instanceof BABYLON.Node) {\n                    //             index--;\n                    //         }\n                    //     }\n\n                    //     index = i;\n                    // }\n\n                    // re-insert TODO\n                    // obj.node.insertChild(childEntity.node, index);\n\n                    // persist the positions and sizes of elements if they were previously\n                    // under control of a layout group but have now been reparented\n                    // if (oldParent && oldParent.layoutgroup) {\n                    //     editor.call('entities:layout:storeLayout', [childEntity.node.getGuid()]);\n                    // }\n                }\n            };\n\n            obj.on('children:insert', reparent);\n            obj.on('children:move', reparent);\n\n            obj.on('destroy', function () {\n                if (obj.node) {\n                    obj.node.dispose();\n                    editor.call('viewport:render');\n                }\n            });\n        });\n\n        editor.on('entities:remove', function (obj: Observer) {\n            var entity = obj.node;\n            if (!entity)\n                return;\n\n            entity.dispose();\n            // editor.call('viewport:render');\n        });\n\n\n    }\n\n\n\n\n}","import { Panel, TopElementPanel } from \"../../ui\";\nimport { VeryEngine } from \"../../engine\";\n\n/* \n*  viewport窗口最大化显示控制；\n*/\nexport class ViewportExpand {\n\n  public constructor() {\n    let panels: TopElementPanel[] = [];\n    panels.push(VeryEngine.hierarchy);\n    panels.push(VeryEngine.assets);\n    panels.push(VeryEngine.attributes);\n\n    let expanded: boolean = false;\n\n    window.editor.method('viewport:expand', function (state: boolean) {\n      if (state === undefined)\n        state = !expanded;\n\n      if (expanded === state)\n        return;\n\n      expanded = state;\n\n      for (var i = 0; i < panels.length; i++)\n        panels[i].hidden = expanded;\n\n      window.editor.emit('viewport:expand', state);\n    });\n\n\n    window.editor.method('viewport:expand:state', function () {\n      return expanded;\n    });\n\n\n    // expand hotkey\n    window.editor.call('hotkey:register', 'viewport:expand', {\n      key: 'space',\n      callback: function () {\n        window.editor.call('viewport:expand');\n      }\n    });\n\n  }\n\n\n\n}\n\n","export class ViewportInstanceCreate{\n\n\n    // 注册事件到相关脚本\n    public constructor() {\n\n    }\n\n\n\n    public addEntity(): void {\n\n    }\n\n\n    \n}","import { Debug } from \"../utility\";\n\nexport class ViewportTap {\n\n\n\n\n    public constructor() {\n        // return;\n\n        var canvas = editor.call('viewport:canvas');\n        // console.warn(canvas);\n        if (!canvas) {\n            console.warn('Viewport Canvas组件没有创建成功！');\n            return;\n        }\n\n        var taps: Tap[] = [];\n        var inViewport = false;\n\n        editor.method('viewport:inViewport', function () {\n            return inViewport;\n        });\n\n        var evtMouseMove = function (evt: MouseEvent) {\n            // console.warn('evtMouseMove');\n            var rect = canvas.element.getBoundingClientRect();\n\n            editor.emit('viewport:mouse:move', evt, rect);\n\n            // render if mouse moved within viewport\n            if (evt.clientX >= rect.left && evt.clientX <= rect.right && evt.clientY >= rect.top && evt.clientY <= rect.bottom) {\n                if (!inViewport) {\n                    inViewport = true;\n                    editor.emit('viewport:hover', true);\n                }\n            } else if (inViewport) {\n                inViewport = false;\n                editor.emit('viewport:hover', false);\n            }\n        };\n\n        var evtMouseUp = function (evt: MouseEvent) {\n            // console.warn('evtMouseUp');\n            var rect = canvas.element.getBoundingClientRect();\n            editor.emit('viewport:mouse:up', evt, rect);\n        };\n\n        // console.error(editor.call('layout.viewport').element);\n        canvas.element.addEventListener('mousedown', function (evt: MouseEvent) {\n            // console.warn('mousedown');\n            var rect = canvas.element.getBoundingClientRect();\n            editor.emit('viewport:mouse:down', evt, rect);\n            // if (document.activeElement && document.activeElement.tagName.toLowerCase() === 'input')\n            //     document.activeElement.blur();\n            // evt.preventDefault();\n        }, false);\n\n        canvas.element.addEventListener('mouseover', function () {\n            // console.warn('mouseover');\n            editor.emit('viewport:hover', true);\n        }, false);\n\n        canvas.element.addEventListener('mouseleave', function (evt: MouseEvent) {\n            // console.warn('mouseleave');\n            // ignore tooltip\n            var target = evt.target || evt.relatedTarget;\n            if (target && (<Element>target).classList.contains('cursor-tooltip'))\n                return;\n\n            editor.emit('viewport:hover', false);\n        }, false);\n\n        var onMouseWheel = function (evt: WheelEvent) {\n            editor.emit('viewport:mouse:wheel', evt);\n        };\n\n\n        window.addEventListener('mousemove', evtMouseMove, false);\n        window.addEventListener('dragover', evtMouseMove, false);\n        window.addEventListener('mouseup', evtMouseUp, false);\n        window.addEventListener('wheel', onMouseWheel, false);\n\n    }\n\n}\n\n\n\n\nexport class Tap {\n\n    public x: number;\n    public lx: number;\n    public sx: number;\n    public y: number;\n    public ly: number;\n    public sy: number;\n    public nx: number;\n    public ny: number;\n    public move: boolean;\n    public down: boolean;\n    public button: number;\n    public mouse: boolean;\n\n    public constructor(evt: MouseEvent, rect: ClientRect, mouse: boolean) {\n        this.x = this.lx = this.sx = evt.clientX - rect.left;\n        this.y = this.ly = this.sy = evt.clientY - rect.top;\n        this.nx = 0;\n        this.ny = 0;\n        this.move = false;\n        this.down = true;\n        this.button = evt.button;\n        this.mouse = !!mouse;\n    }\n\n    public update(evt: MouseEvent, rect: ClientRect): void {\n        var x = evt.clientX - rect.left;\n        var y = evt.clientY - rect.top;\n\n        // if it's moved\n        if (this.down && !this.move && (Math.abs(this.sx - x) + Math.abs(this.sy - y)) > 8)\n            this.move = true;\n\n        // moving\n        if (this.move) {\n            this.nx = x - this.lx;\n            this.ny = y - this.ly;\n            this.lx = this.x;\n            this.ly = this.y;\n        }\n\n        // coords\n        this.x = x;\n        this.y = y;\n    }\n\n}","import { Canvas } from '../../ui';\nimport { VeryEngine } from '../../engine';\nimport { ToolbarTopControl } from '../toolbar';\nimport { ViewportExpand } from './viewport-expand';\nimport { GizmosCenter } from '../gizmos';\nimport { Scenes } from '../scenes';\nimport { VeryCamera } from '../middleware';\nimport { Tools } from '../utility';\n\nexport class Viewport {\n\n    public canvas!: Canvas;\n\n    private _engine!: BABYLON.Engine;\n    private _scene!: BABYLON.Scene;\n    private _canvas!: HTMLCanvasElement;\n\n    private _camera: VeryCamera;\n\n\n    public constructor() {\n\n        this.init();\n\n        // console.log(VeryEngine.viewEngine._internalTexturesCache);\n        // let tex = VeryEngine.viewEngine.createTexture('static/editor_logo.png', false, true, VeryEngine.viewScene);\n        // console.log(VeryEngine.viewEngine._internalTexturesCache);\n\n        let self = this;\n\n        let engine = this._engine;\n\n        // TODO: 设定相机\n        // this._scene.clearColor = new BABYLON.Color4(49 / 255, 77 / 255, 121 / 255, 1); \n        // this._scene.clearColor = new BABYLON.Color4(116 / 255, 116 / 255, 116 / 255, 1);\n        this._scene.autoClear = false;\n\n        // var camera = new BABYLON.ArcRotateCamera('Default', 100, 50, 50, new BABYLON.Vector3(0, 0, 0), this._scene);\n        // camera.setPosition(new BABYLON.Vector3(0, 1, -20));\n        // camera.attachControl(this._canvas, true);\n\n        var camera = new BABYLON.UniversalCamera('__viewportCamera__', new BABYLON.Vector3(0, 1, -20), this._scene);\n        // camera.mode = BABYLON.Camera.ORTHOGRAPHIC_CAMERA;\n        camera.minZ = -800;\n        camera.maxZ = 20000;\n        this._scene.cameraToUseForPointers = camera;\n        // camera.layerMask = 0x20000000;\n\n        // TODO: 不同相机不同clearColor；\n        this._scene.onBeforeCameraRenderObservable.add((c: BABYLON.Camera) => {\n            var engine = self._scene.getEngine();\n            var w = engine.getRenderWidth();\n            var h = engine.getRenderHeight();\n\n            let temp = VeryEngine.getCamera(c);\n            if (temp) {\n                self._scene.getEngine().enableScissor(temp.camera.viewport.x * w, temp.camera.viewport.y * h, temp.camera.viewport.width * w, temp.camera.viewport.height * h);\n                self._scene.getEngine().clear(temp.clearColor, true, true, true);\n            }\n        });\n\n        // console.warn(camera);\n        var viewCamera = new VeryCamera(camera, this._scene, this._canvas);\n        editor.method('camera:viewport', function () {\n            return viewCamera;\n        });\n        this._camera = viewCamera;\n        VeryEngine.viewCamera = viewCamera;\n        this._camera.orthoSize = 0.5;\n\n        this._scene.activeCameras.push(camera);\n        // TODO：设置clearColor\n        viewCamera.clearColor = new BABYLON.Color4(116 / 255, 116 / 255, 116 / 255, 1);\n        VeryEngine.addCamera(viewCamera);\n\n        camera.attachControl(this._canvas, true);\n\n        let backupWidth = this._canvas.width;\n\n        let updateSize = () => {\n            self._engine.resize();\n        }\n\n        this._engine.runRenderLoop(() => {\n            if (this._canvas.width !== this._canvas.clientWidth || this._canvas.height !== this._canvas.clientHeight || this._canvas.width !== backupWidth) {\n                backupWidth = this._canvas.width;\n                this._engine.resize();\n                setInterval(updateSize, 100);\n            }\n\n            // this._engine.clear()\n\n            if (this._scene) {\n                if (this._scene.activeCamera || (this._scene.activeCameras && this._scene.activeCameras.length > 0)) {\n                    // 需要用的时候，乘以0.001，当前单位是毫秒\n                    editor.emit('viewport:update', this._engine.getDeltaTime());\n                    // 正交相机画面比例控制\n                    for (let i = 0, len = VeryEngine.cameras.length; i < len; i++) {\n                        VeryEngine.cameras[i].resize(true);\n                    }\n                    this._scene.render();\n                }\n            }\n\n            // if (this._showFps) {\n            // \tthis.updateFpsPos();\n            // }\n\n\n        });\n        // return this;\n\n\n        this.expandControl();\n\n        // GUI\n        // var advancedTexture = BABYLON.GUI.AdvancedDynamicTexture.CreateFullscreenUI(\"UI\");\n\n        // var createRectangle = function () {\n        //     var rect1 = new BABYLON.GUI.Rectangle();\n        //     rect1.width = 0.2;\n        //     rect1.height = \"40px\";\n        //     rect1.cornerRadius = 20;\n        //     rect1.color = \"Orange\";\n        //     rect1.thickness = 4;\n        //     rect1.background = \"green\";\n        //     advancedTexture.addControl(rect1);\n        //     return rect1;\n        // }\n\n        // createRectangle().horizontalAlignment = BABYLON.GUI.Control.HORIZONTAL_ALIGNMENT_RIGHT;\n        // createRectangle().horizontalAlignment = BABYLON.GUI.Control.HORIZONTAL_ALIGNMENT_LEFT;\n\n        // createRectangle().verticalAlignment = BABYLON.GUI.Control.VERTICAL_ALIGNMENT_TOP;\n        // createRectangle().verticalAlignment = BABYLON.GUI.Control.VERTICAL_ALIGNMENT_BOTTOM;\n\n        // console.warn(advancedTexture);\n        // console.warn(Btn1);\n\n        // let questionParent = new BABYLON.GUI.Rectangle('question-parent');\n        // questionParent.width = \"800px\";\n        // questionParent.height = \"600px\";\n        // questionParent.background = '#ffffff00';\n        // questionParent.color = '#ffffff00';\n        // questionParent.thickness = 0;\n        // gui.addControl(questionParent);\n\n        // let guide7Btn = BABYLON.GUI.Button.CreateSimpleButton(\"guide7-btn\", \"下一步\");\n        // guide7Btn.cornerRadius = 10;\n        // guide7Btn.color = \"white\";\n        // guide7Btn.background = \"#ffffff00\";\n        // guide7Btn.top = \"-50px\";\n        // // guide7Btn.left = \"-50px\";\n        // guide7Btn.width = \"500px\";\n        // guide7Btn.height = \"200px\";\n        // guide7Btn.horizontalAlignment = BABYLON.GUI.Control.HORIZONTAL_ALIGNMENT_CENTER;\n        // guide7Btn.verticalAlignment = BABYLON.GUI.Control.VERTICAL_ALIGNMENT_CENTER;\n        // guide7Btn.children[0].color = \"white\";\n        // guide7Btn.children[0].fontSize = 38;\n        // questionParent.addControl(guide7Btn);\n\n    }\n\n\n    private init(): void {\n        let self = this;\n\n        this.canvas = new Canvas('canvas-viewport');\n        VeryEngine.viewCanvas = this.canvas;\n\n        this._canvas = <HTMLCanvasElement>this.canvas.element;\n        VeryEngine.viewCanvasElement = this._canvas;\n\n        // 去掉Babylon的蓝色边框\n        this._canvas.style.outline = 'none';\n        this._canvas.style.width = '100%';\n        this._canvas.style.height = '100%';\n        // add canvas\n        editor.call('layout.viewport').prepend(this.canvas);\n\n        // get canvas\n        editor.method('viewport:canvas', function () {\n            return self.canvas;\n        });\n\n        // update viewpot 视窗大小\n        setInterval(function () {\n            let rect = VeryEngine.viewportPanel.element!.getBoundingClientRect();\n            self.canvas.resize(Math.floor(rect.width), Math.floor(rect.height));\n        }, 100 / 6);\n\n        // if(this._engine) this._engine.dispose();\n\n        this._engine = new BABYLON.Engine(this._canvas, true);\n        VeryEngine.viewEngine = this._engine;\n        let engine = this._engine;\n\n        window.addEventListener('resize', function () {\n            engine.resize();\n        });\n\n        this._scene = new BABYLON.Scene(this._engine);\n        VeryEngine.viewScene = this._scene;\n        this._scene.preventDefaultOnPointerDown = false;\n        this._scene.preventDefaultOnPointerUp = false;\n        // this._scene.clearColor = new BABYLON.Color4(0, 0, 0, 1);\n        GizmosCenter.init(this._scene);\n\n        // 编辑器\n        editor.call('hotkey:register', 'open:inspector', {\n            key: 'q',\n            ctrl: true,\n            alt: true,\n            callback: function () {\n                // editor.call('save:scene');\n                self.toggleDebug();\n            }\n        });\n        // this._scene.onKeyboardObservable.add(kbInfo => {\n        //     if (kbInfo.type === BABYLON.KeyboardEventTypes.KEYDOWN) {\n        //         console.log(kbInfo.event.key);\n        //         if (kbInfo.event.key === 'q' && kbInfo.event.ctrlKey && kbInfo.event.altKey) { //Ctrl + Q\n        //             console.log('Ctrl + Alt + Q');\n        //             this.toggleDebug();\n        //         }\n        //     }\n        // });\n        // this._scene.debugLayer.show({ embedMode: true });\n    }\n\n    private toggleDebug(): void {\n        if (this._engine) {\n            // Always showing the debug layer, because you can close it by itself\n            var scene = this._engine.scenes[0];\n            if (scene.debugLayer.isVisible()) {\n                scene.debugLayer.hide();\n            }\n            else {\n                // 此处修改了babylon.d.ts文件\n                scene.debugLayer.show({ embedMode: true });\n            }\n        }\n    }\n\n\n    private expandControl(): void {\n        let control: ToolbarTopControl = new ToolbarTopControl();\n        let expandView: ViewportExpand = new ViewportExpand();\n    }\n\n\n\n\n}","export class Application {\n    constructor() {\n        \n    }\n}","export class BabylonEngine {\n  public static Canvas: HTMLCanvasElement;\n  public static Engine: BABYLON.Engine;\n  public static Scene: BABYLON.Scene;\n}","export * from './babylon-engine';\nexport * from './very-engine';\nexport * from './application';","import { VeryCamera, Viewport } from \"../editor\";\nimport { Canvas, Panel, Tree, Grid, TopElementContainer, TopElementPanel } from \"../ui\";\nimport { Database } from \"../editor/middleware/offline/database\";\n\nexport class VeryEngine {\n    public static root: TopElementContainer;\n    public static toolbar: TopElementContainer;\n    public static viewportPanel: TopElementContainer;\n    public static statusBar: TopElementContainer;\n    public static hierarchy: TopElementPanel;\n    public static assets: TopElementPanel;\n    public static attributes: TopElementPanel;\n\n\n    // public static viewPanel: Panel;\n    // public static rootPanel: Panel;\n    public static toolbarPanel: Panel;\n\n    public static hierarchyPanel: Panel;\n    public static hierarchyTree: Tree;\n\n    // public static assetPanel: Panel;\n    public static attributesPanel: Panel;\n\n    public static viewport: Viewport;\n\n    public static viewCanvas: Canvas;\n    public static viewCanvasElement: HTMLCanvasElement;\n    public static viewEngine: BABYLON.Engine;\n    public static viewScene: BABYLON.Scene;\n    public static viewCamera: VeryCamera;\n    // public static viewCamera: VeryCamera;\n\n    // assets\n    public static assetsGrid: Grid;\n\n\n    // TODO\n    public static database: Database;\n\n    public static cameras: VeryCamera[] = [];\n    public static cameraDic: { [key: string]: VeryCamera } = {};\n\n    // public static \n\n    public constructor() {\n\n    }\n\n\n    public static addCamera(camera: VeryCamera): void {\n        VeryEngine.cameras.push(camera);\n        VeryEngine.cameraDic[camera.id] = camera;\n    }\n\n    public static getCamera(camera: BABYLON.Camera): Nullable<VeryCamera> {\n        if (camera.parent && camera.parent instanceof VeryCamera) {\n            if (camera.parent.id in VeryEngine.cameraDic ) {\n                return VeryEngine.cameraDic[camera.parent.id];\n            } else {\n                return null;\n            }\n        } else {\n            for (let i = 0, len = VeryEngine.cameras.length; i < len; i++) {\n                if (VeryEngine.cameras[i].camera === camera) {\n                    return VeryEngine.cameras[i];\n                }\n            }\n        }\n        return null;\n    }\n\n}\n\n\n// export veryconfig","export * from './lib';\nexport * from './editor';\nexport * from './ui';\n\n\nexport * from './engine';\n","export class Events {\n\n  // 相较于Editor，同一个函数名可包含一系列函数，不仅仅是一个，且有once功能；\n\n  public get suspendEvents(): boolean {\n    return this._suspendEvents;\n  }\n  public set suspendEvents(val: boolean) {\n    this._suspendEvents = val;\n  }\n  private _suspendEvents: boolean = false;\n\n  // 某个name对应的事件数组，name与Function是1对多的关系；\n  private _events: { [key: string]: Function[] } = {};\n\n  public constructor() {\n\n  }\n\n  /**\n   * 添加事件数组，若name相同，则在数组末尾继续添加；\n   * @param name 函数名；\n   * @param fn 函数本体；\n   */\n  public on(name: string, fn: Function): EventHandle {\n    let events: Function[] = this._events[name];\n    if (events === undefined) {\n      this._events[name] = [fn];\n    } else {\n      if (events.indexOf(fn) == -1) {\n        events.push(fn);\n      }\n    }\n    return new EventHandle(this, name, fn);\n  }\n\n  /**\n   * emit后只执行一次；\n   * @param name 函数名；\n   * @param fn 函数本体；\n   */\n  public once(name: string, fn: Function): EventHandle {\n    let self = this;\n    let evt: EventHandle = this.on(name, function (\n      arg0: any,\n      arg1: any,\n      arg2: any,\n      arg3: any,\n      arg4: any,\n      arg5: any,\n      arg6: any,\n      arg7: any\n    ) {\n      fn.call(self, arg0, arg1, arg2, arg3, arg4, arg5, arg6, arg7);\n      evt.unbind();\n    });\n    return evt;\n  }\n\n  /**\n   * 执行事件；\n   * @param name 函数名；\n   * @param arg0 函数参数1，可选；\n   * @param arg1 函数参数2，可选；\n   * @param arg2 函数参数3，可选；\n   * @param arg3 函数参数4，可选；\n   * @param arg4 函数参数5，可选；\n   * @param arg5 函数参数6，可选；\n   * @param arg6 函数参数7，可选；\n   * @param arg7 函数参数8，可选；\n   */\n  public emit(name: string,\n    arg0?: any,\n    arg1?: any,\n    arg2?: any,\n    arg3?: any,\n    arg4?: any,\n    arg5?: any,\n    arg6?: any,\n    arg7?: any\n  ): Events {\n    if (this._suspendEvents) return this;\n\n    let events: Function[] = this._events[name];\n    if (!events) return this;\n\n    // 返回新数组\n    events = events.slice(0);\n\n    for (let i: number = 0; i < events.length; i++) {\n      if (!events[i]) continue;\n      try {\n        events[i].call(this, arg0, arg1, arg2, arg3, arg4, arg5, arg6, arg7);\n      } catch (ex) {\n        console.info(\"%c%s %c(event error)\", \"color: #06f\", name, \"color: #f00\");\n        console.log(ex.stack);\n      }\n    }\n\n    return this;\n  };\n\n  /**\n   * 取消Events事件绑定，若name为空，则清空events；\n   * @param name 函数名；\n   * @param fn 函数本体；\n   */\n  public unbind(name?: string, fn?: Function): Events {\n    if (name) {\n      let events: Function[] = this._events[name];\n      if (!events) return this;\n\n      if (fn) {\n        let i: number = events.indexOf(fn);\n        if (i !== -1) {\n          if (events.length === 1) {\n            delete this._events[name];\n          } else {\n            events.splice(i, 1);\n          }\n        }\n      } else {\n        delete this._events[name];\n      }\n    } else {\n      this._events = {};\n    }\n\n    return this;\n  };\n\n}\n\n\nexport class EventHandle {\n\n  public name: Nullable<string>;\n\n  public owner: Nullable<Events>;\n\n  public fn: Nullable<Function>;\n\n  public constructor(owner: Events, name: string, fn: Function) {\n    this.owner = owner;\n    this.name = name;\n    this.fn = fn;\n  }\n\n  public unbind(): void {\n    if (!this.owner) return;\n\n    this.owner.unbind(this.name!, this.fn!);\n\n    this.owner = null;\n    this.name = null;\n    this.fn = null;\n  }\n\n  public call(): void {\n    if (!this.fn) return;\n\n    this.fn.call(\n      this.owner!,\n      arguments[0],\n      arguments[1],\n      arguments[2],\n      arguments[3],\n      arguments[4],\n      arguments[5],\n      arguments[6],\n      arguments[7]\n    );\n  }\n\n  public on(name: string, fn: Function): EventHandle {\n    return this.owner!.on(name, fn);\n  }\n\n}","export * from './events';\nexport * from './observer';\nexport * from './observer-list';\nexport * from './observer-sync';","import { Events } from './events';\nimport { Observer } from './observer';\n\nexport class ObserverList extends Events {\n\n    public data: Observer[];\n\n    public id: string;\n    public sorted: Nullable<Function> = null;\n    private _indexed: { [key: string]: Observer };\n\n    public type: string;\n\n\n    public get length(): number {\n        return this.data.length;\n    }\n\n\n    public constructor(options?: any) {\n        super();\n\n        options = options || {};\n\n        this.type = '';\n        this.data = [];\n        this._indexed = {};\n        this.sorted = options.sorted || null;\n        this.id = options.id || '';\n    }\n\n\n    public get(index: number | string): Nullable<Observer> {\n        if (this.id && typeof index === 'string') {\n            return this._indexed[index] || null;\n        } else {\n            return typeof index === 'number' ? this.data[index] || null : null;\n        }\n    }\n\n    public set(index: number | string, val: Observer): void {\n        if (this.id) {\n            this._indexed[index] = val;\n        } else {\n            if (typeof index === 'number')\n                this.data[index] = val;\n        }\n    }\n\n    public indexof(item: Observer): number {\n        // if (this.id) {\n        //     let index: string = item.get(this.id);\n        //     return (this._indexed[index] && index) || -1;\n        // } else {\n        //     return this.data.indexOf(item);\n        // }\n        return this.data.indexOf(item);\n    }\n\n    public position(b: any, fn: Function): number {\n        var l = this.data;\n        var min = 0;\n        var max = l.length - 1;\n        var cur;\n        var a, i;\n        fn = fn || this.sorted;\n\n        while (min <= max) {\n            cur = Math.floor((min + max) / 2);\n            a = l[cur];\n\n            i = fn(a, b);\n\n            if (i === 1) {\n                max = cur - 1;\n            } else if (i === -1) {\n                min = cur + 1;\n            } else {\n                return cur;\n            }\n        }\n\n        return -1;\n    };\n\n    // 2分法求最近距离，对文件显示进行排序\n    public positionNextClosest(b: any, fn: any): number {\n        let l = this.data;\n        let min = 0;\n        let max = l.length - 1;\n        let cur: number = 0;\n        let a, i;\n        fn = fn || this.sorted;\n\n        if (l.length === 0) return -1;\n\n        // 名字与第一个元素相同的情况\n        if (fn(l[0], b) === 0) return 0;\n\n        while (min <= max) {\n            cur = Math.floor((min + max) / 2);\n            a = l[cur];\n\n            i = fn(a, b);\n\n            if (i === 1) {\n                max = cur - 1;\n            } else if (i === -1) {\n                min = cur + 1;\n            } else {\n                return cur;\n            }\n        }\n\n        if (fn(a, b) === 1) return cur;\n\n        if (cur! + 1 === l.length) return -1;\n\n        return cur! + 1;\n    };\n\n\n    public has(item: Observer): boolean {\n        if (this.id) {\n            var index = item.get(this.id);\n            return !!this._indexed[index];\n        } else {\n            return this.data.indexOf(item) !== -1;\n        }\n    };\n\n    public add(item: Observer): number {\n        if (this.has(item)) return -1;\n\n        // var index = this.data.length;\n        if (this.id) {\n            var index = item.get(this.id);\n            this._indexed[index] = item;\n        } else {\n            this._indexed[this.data.length] = item;\n        }\n\n        var pos = 0;\n\n        if (this.sorted) {\n            pos = this.positionNextClosest(item, this.sorted);\n            // console.error('name: ' + item.get('name') + ' ,,, pos: ' + pos.toString());\n            if (pos !== -1) {\n                this.data.splice(pos, 0, item);\n            } else {\n                this.data.push(item);\n            }\n        } else {\n            this.data.push(item);\n            pos = this.data.length - 1;\n        }\n\n        // 回调函数\n        this.emit('add', item);\n\n        return pos;\n    };\n\n    public move(item: Observer, pos: number): void {\n        let ind = this.data.indexOf(item);\n        this.data.splice(ind, 1);\n        if (pos === -1) {\n            this.data.push(item);\n        } else {\n            this.data.splice(pos, 0, item);\n        }\n    };\n\n\n    public remove(item: Observer): void {\n        if (!this.has(item)) return;\n\n        let ind = this.data.indexOf(item);\n\n        if (this.id) {\n            let index = item.get(this.id);\n            delete this._indexed[index];\n        }\n\n        this.data.splice(ind, 1);\n\n        this.emit('remove', item, ind);\n    };\n\n    public removeByKey(index: number): void {\n        if (this.id) {\n            let item = this._indexed[index];\n\n            if (!item) return;\n\n            let ind = this.data.indexOf(item);\n            this.data.splice(ind, 1);\n\n            delete this._indexed[index];\n\n            this.emit('remove', item, ind);\n        } else {\n            if (this.data.length < index) return;\n\n            let item = this.data[index];\n\n            this.data.splice(index, 1);\n\n            this.emit('remove', item, index);\n        }\n    };\n\n    public removeBy(fn: Function) {\n        let i = this.data.length;\n        while (i--) {\n            if (!fn(this.data[i])) continue;\n\n            if (this.id) {\n                delete this._indexed[this.data[i].get(this.id)];\n            }\n            this.data.splice(i, 1);\n\n            this.emit('remove', this.data[i], i);\n        }\n    };\n\n    public clear(): void {\n        let items = this.data.slice(0);\n\n        this.data = [];\n        this._indexed = {};\n\n        let i = items.length;\n        while (i--) {\n            this.emit('remove', items[i], i);\n        }\n    };\n\n    public forEach(fn: Function) {\n        for (let i = 0; i < this.data.length; i++) {\n            fn(this.data[i], (this.id && this.data[i].get(this.id)) || i);\n        }\n    };\n\n    public find(fn: Function) {\n        let items = [];\n        for (let i = 0; i < this.data.length; i++) {\n            if (!fn(this.data[i])) continue;\n\n            let index = i;\n            if (this.id) index = this.data[i].get(this.id);\n\n            items.push([index, this.data[i]]);\n        }\n        return items;\n    };\n\n    public findOne(fn: Function) {\n        for (let i = 0; i < this.data.length; i++) {\n            if (!fn(this.data[i])) continue;\n\n            let index = i;\n            if (this.id) index = this.data[i].get(this.id);\n\n            return [index, this.data[i]];\n        }\n        return null;\n    };\n\n    public map(fn: any) {\n        return this.data.map(fn);\n    };\n\n    public sort(fn: any) {\n        this.data.sort(fn);\n    };\n\n    public array(): Observer[] {\n        return this.data.slice(0);\n    };\n\n    // public json() {\n    //     let items = this.array();\n    //     for (let i = 0; i < items.length; i++) {\n    //         if (items[i] instanceof Observer) {\n    //             items[i] = items[i].json();\n    //         }\n    //     }\n    //     return items;\n    // };\n\n}","import { Events } from './events';\nimport { Observer } from './observer';\nimport { ObserverList } from './observer-list';\n\nexport class ObserverSync extends Events {\n\n\n    public item: Observer;\n\n    private _enabled: boolean = true;\n    public get enabled(): boolean {\n        return this._enabled;\n    }\n    public set enabled(value: boolean) {\n        this._enabled = value;\n    }\n\n    private _prefix: Nullable<string[]>;\n    public get prefix(): Nullable<string[]> {\n        return this._prefix;\n    }\n    public set prefix(value: Nullable<string[]>) {\n        this._prefix = value || [];\n    }\n\n    private _paths: Nullable<string[]>;\n    public get paths(): Nullable<string[]> {\n        return this._paths;\n    }\n    public set paths(value: Nullable<string[]>) {\n        this._paths = value || null;\n    }\n\n\n\n    public constructor(args: any) {\n        super();\n\n        args = args || {};\n\n        this.item = args.item;\n        this._enabled = args.enabled || true;\n        this._prefix = args.prefix || [];\n        this._paths = args.paths || null;\n        // this._sync = args.sync || true;\n\n        this._initialize();\n    }\n\n    private _initialize(): void {\n        var self = this;\n        var item = this.item;\n\n        // // object/array set\n        // item.on('*:set', function (path: string, value: any, valueOld: any) {\n        //     if (!self._enabled) return;\n\n        //     // if this happens it's a bug\n        //     if (item.sync !== self) {\n        //         console.error('Garbage Observer Sync still pointing to item', item);\n        //     }\n\n        //     // check if path is allowed\n        //     if (self._paths) {\n        //         var allowedPath = false;\n        //         for (var i = 0; i < self._paths.length; i++) {\n        //             if (path.indexOf(self._paths[i]) !== -1) {\n        //                 allowedPath = true;\n        //                 break;\n        //             }\n        //         }\n\n        //         // path is not allowed\n        //         if (!allowedPath)\n        //             return;\n        //     }\n\n        //     // full path\n        //     var p = self._prefix!.concat(path.split('.'));\n\n        //     // need jsonify\n        //     if (value instanceof Observer || value instanceof ObserverList)\n        //         value = value.json();\n\n        //     // can be array value\n        //     var ind = path.lastIndexOf('.');\n        //     if (ind !== -1 && (self.get(path.slice(0, ind)) instanceof Array)) {\n        //         // array index should be int\n        //         p[p.length - 1] = parseInt(p[p.length - 1], 10);\n\n        //         // emit operation: list item set\n        //         self.emit('op', {\n        //             p: p,\n        //             li: value,\n        //             ld: valueOld\n        //         });\n        //     } else {\n        //         // emit operation: object item set\n        //         var obj = {\n        //             p: p,\n        //             oi: value\n        //         };\n\n        //         if (valueOld !== undefined) {\n        //             obj.od = valueOld;\n        //         }\n\n        //         self.emit('op', obj);\n        //     }\n        // });\n\n        // // unset\n        // item.on('*:unset', function (path: string, value: any) {\n        //     if (!self._enabled) return;\n\n        //     self.emit('op', {\n        //         p: self._prefix!.concat(path.split('.')),\n        //         od: null\n        //     });\n        // });\n\n        // // list move\n        // item.on('*:move', function (path: string, value: any, ind: string, indOld: string) {\n        //     if (!self._enabled) return;\n        //     self.emit('op', {\n        //         p: self._prefix!.concat(path.split('.')).concat([indOld]),\n        //         lm: ind\n        //     });\n        // });\n\n        // // list remove\n        // item.on('*:remove', function (path: string, value: any, ind: string) {\n        //     if (!self._enabled) return;\n\n        //     // need jsonify\n        //     if (value instanceof Observer || value instanceof ObserverList)\n        //         value = value.json();\n\n        //     self.emit('op', {\n        //         p: self._prefix!.concat(path.split('.')).concat([ind]),\n        //         ld: value\n        //     });\n        // });\n\n        // // list insert\n        // item.on('*:insert', function (path: string, value: any, ind: string) {\n        //     if (!self._enabled) return;\n\n        //     // need jsonify\n        //     if (value instanceof Observer || value instanceof ObserverList)\n        //         value = value.json();\n\n        //     self.emit('op', {\n        //         p: self._prefix!.concat(path.split('.')).concat([ind]),\n        //         li: value\n        //     });\n        // });\n\n    }\n\n\n    // public write(op: any): void {\n    //     // disable history if available\n    //     var historyReEnable = false;\n    //     if (this.item.history && this.item.history.enabled) {\n    //         historyReEnable = true;\n    //         this.item.history.enabled = false;\n    //     }\n\n    //     if (op.hasOwnProperty('oi')) {\n    //         // set key value\n    //         var path = op.p.slice(this._prefix!.length).join('.');\n\n    //         this._enabled = false;\n    //         this.item.set(path, op.oi);\n    //         this._enabled = true;\n\n\n    //     } else if (op.hasOwnProperty('ld') && op.hasOwnProperty('li')) {\n    //         // set array value\n    //         var path = op.p.slice(this._prefix!.length).join('.');\n\n    //         this._enabled = false;\n    //         this.item.set(path, op.li);\n    //         this._enabled = true;\n\n\n    //     } else if (op.hasOwnProperty('ld')) {\n    //         // delete item\n    //         var path = op.p.slice(this._prefix!.length, -1).join('.');\n\n    //         this._enabled = false;\n    //         this.item.remove(path, op.p[op.p.length - 1], false, true);\n    //         this._enabled = true;\n\n\n    //     } else if (op.hasOwnProperty('li')) {\n    //         // add item\n    //         var path = op.p.slice(this._prefix!.length, -1).join('.');\n    //         var ind = op.p[op.p.length - 1];\n\n    //         this._enabled = false;\n    //         this.item.insert(path, op.li, ind, false, true);\n    //         this._enabled = true;\n\n\n    //     } else if (op.hasOwnProperty('lm')) {\n    //         // item moved\n    //         var path = op.p.slice(this._prefix!.length, -1).join('.');\n    //         var indOld = op.p[op.p.length - 1];\n    //         var ind = op.lm;\n\n    //         this._enabled = false;\n    //         this.item.move(path, indOld, ind, false, true);\n    //         this._enabled = true;\n\n\n    //     } else if (op.hasOwnProperty('od')) {\n    //         // unset key value\n    //         var path = op.p.slice(this._prefix!.length).join('.');\n    //         this._enabled = false;\n    //         this.item.unset(path, false, true);\n    //         this._enabled = true;\n\n\n    //     } else {\n    //         console.log('unknown operation', op);\n    //     }\n\n    //     // reenable history\n    //     if (historyReEnable)\n    //         this.item.history.enabled = true;\n\n    //     this.emit('sync', op);\n    // }\n\n\n\n\n\n\n}","import { Events } from './events';\nimport { GameObject } from '../editor';\nimport { ObserverSync } from './observer-sync';\n\n//  TODO： 当前暂不考虑赋值会超出现有类型的情况，比如原来是个number，赋值为了array；\nexport class Observer extends Events {\n\n    public get className(): string {\n        return 'Observer';\n    }\n\n    public origin: any;\n\n    public entity: Nullable<GameObject> = null;\n\n\n    private SEPARATOR: string = '.';\n\n\n    private _destroyed: boolean;\n    public _path: string;\n    // TODO\n    public _keys: string[]; // 记录对象的key、value值；\n\n\n    public _data: { [key: string]: any }; // 采用此对象，完整记录所有值，包含新建的数组；\n    public _data2: { [key: string]: any }; // 采用此对象，完整记录所有值，不包含新建数组；\n    public _dataType: { [key: string]: boolean } = {}; // 暂时只判断是否为array分拆而成的类型；\n    public _dataType2: { [key: string]: boolean } = {}; // 暂时只判断是否为array分拆而成的类型；\n\n\n\n\n    public _parent: any; // 当前父物体\n    // public _parentPath: string;\n    private _parentField: any;\n    private _parentKey: any;\n\n    private _silent: boolean;\n\n    public history!: History;\n    public sync: Nullable<ObserverSync> = null;\n    // private sync!: History;\n\n    public node: any = null;\n\n    public reparenting: boolean = false;\n    private _pathsWithDuplicates: { [key: string]: boolean } = {};\n\n    // entity, assets, components: script, 一般components, selector, history\n    public constructor(data: any, options?: any) {\n        super();\n\n        this.origin = data;\n        options = options || {};\n\n\n\n\n\n        this._destroyed = false;\n        this._path = '';\n        this._keys = [];\n        this._data = {};\n\n        this._data2 = {};\n\n        // array paths where duplicate entries are allowed - normally\n        // we check if an array already has a value before inserting it\n        // but if the array path is in here we'll allow it\n        if (options.pathsWithDuplicates) {\n            this._pathsWithDuplicates = {};\n            for (let i = 0; i < options.pathsWithDuplicates.length; i++) {\n                this._pathsWithDuplicates[options.pathsWithDuplicates[i]] = true;\n            }\n        }\n\n        this.patchData(data);\n\n        // for (let ke in this._data) {\n        //   debug.log('key: ' + ke);\n        //   debug.log(this._data[ke]);\n        // }\n\n        // this._parent = options.parent || null;\n        // this._parentPath = options.parentPath || '';\n        // this._parentField = options.parentField || null;\n        // this._parentKey = options.parentKey || null;\n\n        this._silent = false;\n    }\n\n    public patchData(data: any): void {\n        if (typeof data !== 'object') {\n            debug.warn(this.className + ': 不是正确的json对象，打印：\\n' + data);\n            return;\n        }\n\n        for (let key in data) {\n            if (typeof data[key] === 'object') {\n                // 对象属性\n                // debug.log('对象属性：' + key);\n                // debug.log(data[key]);\n                // this._prepare(this, key, data[key]);\n                this.parserObject(key, key, data[key]);\n            } else {\n                // 一般属性\n                // debug.log('一般属性：' + key);\n                // debug.log(data[key]);\n                this.set(key, data[key]);\n                this._dataType[key] = false;\n                this._dataType2[key] = false;\n                // this.set(key, data[key]);\n            }\n        }\n    }\n\n    // TODO: 若设置值为object，需要再parse\n    public set(path: string, value: any): void {\n        let oldValue = this._data[path];\n        // console.warn(path);\n        // console.warn(value);\n        let keys = path.split('.');\n        let parentID = '';\n        for (let i = 0; i < keys.length - 1; i++) {\n            if (i === 0) {\n                parentID = keys[i];\n            } else {\n                parentID += this.SEPARATOR + keys[i];\n            }\n        }\n        // 数组处理，其他形式暂不考虑\n        if (keys.length > 1 && this._dataType[path]) {\n            let index = parseInt(keys[keys.length - 1]);\n            this._data[path] = value;\n            // 上一级数组修改\n            this._data[parentID][index] = value;\n        } else {\n            // if (value instanceof Array) {\n            //     value = value.slice(0);\n            // }\n            this._data[path] = value;\n            this.updateChildData(path, value);\n            this._data2[path] = value;\n        }\n        // console.warn(this._data);\n\n        // if (parentID && this._dataType2[parentID] && this.isNumber(keys[keys.length - 1])) {\n        //     this._data2[parentID][parseInt(keys[keys.length - 1])] = value;\n        // }\n\n        this.emit(path + ':set', value, oldValue);\n        this.emit('*:set', path, value, oldValue);\n    }\n\n    private isNumber(str: string): boolean {\n        var n = Number(str);\n        return !isNaN(n) ? true : false;\n    }\n\n    private updateChildData(path: string, value: any): void {\n        if (value instanceof Array) {\n            for (let key in this._data) {\n                if (key.startsWith(path + this.SEPARATOR)) {\n                    delete this._data[key];\n                    delete this._dataType[key];\n                }\n            }\n            let newPath = '';\n            for (let i = 0; i < value.length; i++) {\n                newPath = path + this.SEPARATOR + i.toString();\n                this._data[newPath] = value[i];\n                this._dataType[newPath] = true;\n            }\n        }\n    }\n\n    // TODO\n    public unset(path: string, value: any): boolean {\n        // console.log(path + ' : ' + value);\n        if (!this.has(path)) {\n            return false;\n        }\n        let oldValue = this._data[path];\n        delete this._data[path];\n        delete this._dataType[path];\n\n        delete this._data2[path];\n        delete this._dataType2[path];\n\n        this.emit(path + ':set', value, oldValue);\n        this.emit('*:set', path, value, oldValue);\n\n        return true;\n    }\n\n    // 在数组的某个指定位置增加值\n    public insert(path: string, value: any, ind: number | undefined): boolean {\n        // console.error(path + ':insert-value: ' + value);\n        // console.warn(this._data);\n        if (!this.has(path) || !(this._data[path] instanceof Array)) {\n            return false;\n        }\n        let arr = this._data[path];\n        if (value instanceof Array) {\n            value = value.slice(0);\n        }\n        // if (!this._pathsWithDuplicates || !this._pathsWithDuplicates[path]) {\n        //     if (arr.indexOf(value) !== -1) {\n        //         return false;\n        //     }\n        // }\n        if (ind === undefined) {\n            arr.push(value);\n            ind = arr.length - 1;\n        } else {\n            arr.splice(ind, 0, value);\n        }\n        this.updateChildData(path, arr);\n        // TODO\n        // let arr2 = this._data2[path];\n        // console.error(arr2);\n        // if (arr2) {\n        //     // if (!this._pathsWithDuplicates || !this._pathsWithDuplicates[path]) {\n        //     //     if (arr2.indexOf(value) !== -1) {\n        //     //         return false;\n        //     //     }\n        //     // }\n        //     if (ind === undefined) {\n        //         arr2.push(value);\n        //     } else {\n        //         arr2.splice(ind, 0, value);\n        //     }\n        // }\n        // console.error(arr2);\n        \n        // console.warn(this._data);\n        this.emit(path + ':insert', value, ind);\n        this.emit('*:insert', path, value, ind);\n\n        return true;\n    }\n\n    // 删除数组指定某个序号的值\n    public remove(path: string, ind: number): boolean {\n        if (!this.has(path) || !(this._data[path] instanceof Array)) {\n            return false;\n        }\n        let arr = this._data[path];\n        if (arr.length < ind) return false;\n        let value = arr[ind];\n        arr.splice(ind, 1);\n        this.updateChildData(path, arr);\n\n        // TODO\n        // let arr2 = this._data2[path];\n        // if (arr2 && arr2.length >= ind) {\n        //     arr2.splice(ind, 1);\n        // }\n\n        this.emit(path + ':remove', value, ind);\n        this.emit('*:remove', path, value, ind);\n        return true;\n    }\n\n    // 删除数组中的某个value值\n    public removeValue(path: string, value: any): boolean {\n        if (!this.has(path) || !(this._data[path] instanceof Array)) {\n            return false;\n        }\n        let arr = this._data[path];\n        let ind = arr.indexOf(value);\n        if (ind === -1) {\n            return false;\n        }\n        let oldValue = arr[ind];\n        arr.splice(ind, 1);\n        this.updateChildData(path, arr);\n\n        // TODO\n        // let arr2 = this._data2[path];\n        // if (arr2 && ind >= 0) {\n        //     arr2.splice(ind, 1);\n        // }\n\n        // console.warn('删除');\n        // console.warn(this._data);\n        // console.warn(this._data2);\n\n        this.emit(path + ':remove', oldValue, ind);\n        this.emit('*:remove', path, oldValue, ind);\n\n        return true;\n    }\n\n\n    public move(path: string, indOld: number, indNew: number): boolean {\n        if (!this.has(path) || !(this._data[path] instanceof Array)) {\n            return false;\n        }\n\n        let indNew2 = indNew;\n\n        let arr = this._data[path];\n        if (arr.length < indOld || arr.length < indNew || indOld === indNew) return false;\n        let oldValue = arr[indOld]\n        arr.splice(indOld, 1);\n        if (indNew === -1) indNew = arr.length;\n        arr.splice(indNew, 0, oldValue);\n        this.updateChildData(path, arr);\n\n        // TODO\n        // let arr2 = this._data2[path];\n        // if (arr2) {\n        //     if (arr2.length < indOld || arr2.length < indNew2 || indOld === indNew2) {\n\n        //     } else {\n        //         let oldValue2 = arr2[indOld]\n        //         arr2.splice(indOld, 1);\n        //         if (indNew2 === -1) indNew2 = arr2.length;\n        //         arr2.splice(indNew2, 0, oldValue2);\n        //     }\n        // }\n\n        this.emit(path + ':move', oldValue, indNew, indOld);\n        this.emit('*:move', path, oldValue, indNew, indOld);\n        return true;\n    }\n\n    public parserObject(prefix: string, key: string, value: any): void {\n        // 先保存一份\n        this.set(prefix, value);\n        this._dataType[prefix] = false;\n\n        let path: string;\n        let type: string = typeof value;\n\n        if (type === 'object' && value instanceof Array) {\n            this._dataType2[prefix] = true;\n            for (let i = 0; i < value.length; i++) {\n                path = prefix + this.SEPARATOR + i.toString();\n                this.set(path, value[i]);\n                this._dataType[path] = true;\n                // 数组元素还是对象的情况暂时不处理\n            }\n        } else if (type === 'object' && value instanceof Object) {\n\n            for (let key2 in value) {\n                if (typeof value[key2] === 'object') {\n                    // 递归解析\n                    this.parserObject(prefix + this.SEPARATOR + key2, key2, value[key2]);\n                } else {\n                    path = prefix + this.SEPARATOR + key2;\n                    this.set(path, value[key2]);\n                    this._dataType[path] = false;\n                    this._dataType2[prefix] = false;\n\n                }\n            }\n        } else {\n            // 目前看，null和undefined会经过这里\n            // debug.warn(this.className + '.parserObject, 为止数据类型:' + value);\n        }\n    }\n\n\n    public has(path: string): boolean {\n        return path in this._data;\n    }\n\n    public get(path: string): any {\n        if (path in this._data) {\n            return this._data[path];\n        } else {\n            return null;\n        }\n    }\n\n    public propagate(evt: any) {\n        let that = this;\n        return function (path: string, arg1: any, arg2: any, arg3: any) {\n            if (!that._parent) return;\n\n            let key = that._parentKey;\n            if (!key && that._parentField instanceof Array) {\n                key = that._parentField.indexOf(that);\n\n                if (key === -1) return;\n            }\n\n            // path = that._parentPath + '.' + key + '.' + path;\n\n            let state;\n            if (that._silent) state = that._parent.silence();\n\n            that._parent.emit(path + ':' + evt, arg1, arg2, arg3);\n            that._parent.emit('*:' + evt, path, arg1, arg2, arg3);\n\n            if (that._silent) that._parent.silenceRestore(state);\n        };\n    }\n\n    // key => object\n    private _prepare(target: Observer, key: string, value: any, silent?: boolean, remote?: any) {\n        let self = this;\n        let state: boolean[];\n        let path = (target._path ? target._path + '.' : '') + key;\n        let type = typeof value;\n\n        target._keys.push(key);\n\n        if (type === 'object' && value instanceof Array) {\n            target._data[key] = value.slice(0); // 复制一份新的数组\n\n            // 子一层数据\n            for (let i = 0; i < target._data[key].length; i++) {\n                if (typeof target._data[key][i] === 'object' && target._data[key][i] !== null) {\n                    if (target._data[key][i] instanceof Array) {\n                        target._data[key][i].slice(0);\n                    } else {\n                        // observer? 这里不需要递归吗？\n                        target._data[key][i] = new Observer(\n                            target._data[key][i],\n                            {\n                                parent: this,\n                                parentPath: path,\n                                parentField: target._data[key],\n                                parentKey: null\n                            }\n                        );\n                    }\n                } else {\n                    state = this.silence();\n                    this.emit(path + '.' + i + ':set', target._data[key][i], null, remote);\n                    this.emit('*:set', path + '.' + i, target._data[key][i], null, remote);\n                    this.silenceRestore(state);\n                }\n            }\n\n            if (silent) state = this.silence();\n\n            this.emit(path + ':set', target._data[key], null, remote);\n            this.emit('*:set', path, target._data[key], null, remote);\n\n            if (silent) this.silenceRestore(state!);\n        } else if (type === 'object' && value instanceof Object) {\n            if (typeof target._data[key] !== 'object') {\n                target._data[key] = {\n                    _path: path,\n                    _keys: [],\n                    _data: {}\n                };\n            }\n\n            for (let i in value) {\n                if (typeof value[i] === 'object') {\n                    // 递归\n                    this._prepare(target._data[key], i, value[i], true, remote);\n                } else {\n                    state = this.silence();\n\n                    target._data[key]._data[i] = value[i];\n                    target._data[key]._keys.push(i);\n\n                    this.emit(path + '.' + i + ':set', value[i], null, remote);\n                    this.emit('*:set', path + '.' + i, value[i], null, remote);\n\n                    this.silenceRestore(state);\n                }\n            }\n\n            if (silent) state = this.silence();\n\n            // passing undefined as valueOld here\n            // but we should get the old value to be consistent\n            this.emit(path + ':set', value, undefined, remote);\n            this.emit('*:set', path, value, undefined, remote);\n\n            if (silent) this.silenceRestore(state!);\n        } else {\n            if (silent) state = this.silence();\n\n            target._data[key] = value;\n\n            this.emit(path + ':set', value, undefined, remote);\n            this.emit('*:set', path, value, undefined, remote);\n\n            if (silent) this.silenceRestore(state!);\n        }\n\n        return true;\n    }\n\n    public silence(): boolean[] {\n        this._silent = true;\n\n        // history hook to prevent array values to be recorded\n        let historyState: boolean =\n            this.history !== undefined && this.history.enabled !== undefined;\n        if (historyState) this.history.enabled = false;\n\n        // sync hook to prevent array values to be recorded as array root already did\n        let syncState: boolean = this.sync !== null && this.sync.enabled !== undefined;\n        if (this.sync !== null && this.sync.enabled !== undefined)\n            this.sync.enabled = false;\n\n        return [historyState, syncState];\n    }\n\n    public silenceRestore(state: boolean[]): void {\n        this._silent = false;\n\n        if (state[0]) this.history.enabled = true;\n\n        if (state[1] && this.sync !== null && this.sync.enabled !== undefined)\n            this.sync!.enabled = true;\n    }\n\n    // public json(target?: Observer): Observer {\n    //   let obj: { [key: string]: any } = {};\n    //   let node = target === undefined ? this : target;\n    //   let len, nlen;\n\n    //   if (node instanceof Object && node._keys) {\n    //     len = node._keys.length;\n    //     for (let i = 0; i < len; i++) {\n    //       let key = node._keys[i];\n    //       let value = node._data[key];\n    //       let type = typeof (value);\n\n    //       if (type === 'object' && (value instanceof Array)) {\n    //         obj[key] = value.slice(0);\n\n    //         nlen = obj[key].length;\n    //         for (let n = 0; n < nlen; n++) {\n    //           if (typeof (obj[key][n]) === 'object')\n    //             obj[key][n] = this.json(obj[key][n]);\n    //         }\n    //       } else if (type === 'object' && (value instanceof Object)) {\n    //         obj[key] = this.json(value);\n    //       } else {\n    //         obj[key] = value;\n    //       }\n    //     }\n    //   } else {\n    //     if (node === null) {\n    //       return null;\n    //     } else if (typeof (node) === 'object' && (node instanceof Array)) {\n    //       obj = node.slice(0);\n\n    //       len = obj.length;\n    //       for (let n = 0; n < len; n++) {\n    //         obj[n] = this.json(obj[n]);\n    //       }\n    //     } else if (typeof (node) === 'object') {\n    //       for (let key in node) {\n    //         if (node.hasOwnProperty(key))\n    //           obj[key] = node[key];\n    //       }\n    //     } else {\n    //       obj = node;\n    //     }\n    //   }\n    //   return obj;\n    // }\n\n    // public forEach(fn: Function, target: Observer, path: string): void {\n    //   let node = target || this;\n    //   path = path || '';\n\n    //   for (let i = 0; i < node._keys.length; i++) {\n    //     let key = node._keys[i];\n    //     let value = node._data[key];\n    //     let type = (this.schema && this.schema.has(path + key) && this.schema.get(path + key).type.name.toLowerCase()) || typeof (value);\n\n    //     if (type === 'object' && (value instanceof Array)) {\n    //       fn(path + key, 'array', value, key);\n    //     } else if (type === 'object' && (value instanceof Object)) {\n    //       fn(path + key, 'object', value, key);\n    //       this.forEach(fn, value, path + key + '.');\n    //     } else {\n    //       fn(path + key, type, value, key);\n    //     }\n    //   }\n    // };\n\n    public destroy(): void {\n        if (this._destroyed) return;\n        this._destroyed = true;\n        this.emit('destroy');\n        this.unbind();\n    }\n}\n\nexport interface History {\n    enabled?: boolean;\n}\n","import { Editor, Layout, Viewport, HierarchyKeeper, AssetsPanel, InitializeBefore, InitializeAfter, Debug, Tools, AssetsKeeper, Search, Drop, InitializeData } from './editor';\n// import { Element, Canvas } from './ui';\nimport { VeryEngine } from './engine';\n// import { Database } from './editor/middleware/offline/database';\n\nexport * from './index';\n\n// 添加到全局变量\nwindow.editor = new Editor();\n\n// 全局注册debug类\nwindow.debug = new Debug();\n\n// 初始化全局信息类\nlet initialize: InitializeBefore = new InitializeBefore();\n\n// 后期可以修改为load、start等string表示的事件，通过event来实现\n// 打开project或者scene，1对多的关系，记录一下默认的scene（上一次打开的scene），一开始就打开默认的scene；\n// 当前project的编辑器设置，如摄像机等，各种设置数据；\n// assets数据；\n// scene的数据，可能会多个，当前scene，不同scene之间还有顺序关系；\n\n// 整体布局\nlet layout = new Layout();\nlayout.init();\n\nlet drop = new Drop();\nlet search = new Search();\n\n// 层级菜单\nlet hierarchy = new HierarchyKeeper();\n\n// 资源菜单\nlet assetsKeeper = new AssetsKeeper();\n\n// 编辑视窗\nlet viewport = new Viewport();\nVeryEngine.viewport = viewport;\n\n// 初始化全局信息类\nlet initializeAfter: InitializeAfter = new InitializeAfter();\n\n// 初始数据\nlet initializeData: InitializeData = new InitializeData();\n\n// TODO\n// Tools.loadBabylon();\n// 加载资源\n\n// 关联资源\n\n// 本地数据库测试\n// VeryEngine.database = new Database();\n// VeryEngine.database.connect('test', 'store', 1, ['xxx']);\n\n// let im = new Image();\n// im.src = \"test.jpeg\";\n// im.onload = () => {\n//   console.log('--------------');\n//   console.log(im.name);\n//   console.log(im.sizes);\n// }\n\n/* TEST\neditor.once('load', () => {\n  console.log('once');\n});\n\neditor.on('array', () => {\n  console.log('1');\n});\neditor.on('array', () => {\n  console.log('2');\n});\neditor.on('array', () => {\n  console.log('3');\n});\n\neditor.on('array', (args0: any, args1: any) => {\n  console.log(args0 + ' +++ ' +  args1);\n});\n\neditor.method('method', (a: any) => {\n  console.log(a);\n});\n\n\neditor.emit('load');\neditor.emit('load');\n\neditor.emit('array', 'abc', 'dfg');\neditor.emit('array');\n\neditor.call('method', 123);\n*/\n\n// let parent: HTMLElement = document.getElementById('test')!;\n\n// console.log('children');\n\n// console.log(parent);\n// console.log(parent.childNodes);\n\n// for(let i: number = 0; i < parent.children.length; i++) {\n//   (<HTMLElement>(parent.children[i])).ui = new Element();\n//   console.warn((<HTMLElement>(parent.children[i])).ui === undefined);\n//   console.log((<HTMLElement>(parent.children[i])).ui);\n//   (<HTMLElement>(parent.children[i])).ui.destroy();\n//   console.log(parent.children[i] instanceof HTMLElement);\n// }\n\n// console.log('childNodes');\n\n// for(let i: number = 0; i < parent.childNodes.length; i++) {\n//   console.log(parent.childNodes[i] instanceof HTMLElement);\n// }\n","import { Events } from \"./events\";\r\n\r\nexport class Ajax {\r\n\r\n    public constructor(args: object | string) {\r\n        if (typeof (args) === 'string')\r\n            args = { url: args };\r\n\r\n        return new AjaxRequest(args);\r\n    }\r\n\r\n    public static get(url: string): AjaxRequest {\r\n        return new AjaxRequest({ url: url });\r\n    }\r\n\r\n    public static post(url: string, data: any): AjaxRequest {\r\n        return new AjaxRequest({\r\n            method: 'POST',\r\n            url: url,\r\n            data: data\r\n        });\r\n    }\r\n\r\n    public static put(url: string, data: any): AjaxRequest {\r\n        return new AjaxRequest({\r\n            method: 'PUT',\r\n            url: url,\r\n            data: data\r\n        });\r\n    }\r\n\r\n    public static delete(url: string): AjaxRequest {\r\n        return new AjaxRequest({\r\n            method: 'DELETE',\r\n            url: url\r\n        });\r\n    }\r\n\r\n    public static params: { [key: string]: any } = {};\r\n\r\n    public static param(name: string, value: any): void {\r\n        Ajax.params[name] = value;\r\n    }\r\n\r\n}\r\n\r\n\r\nexport class AjaxRequest extends Events {\r\n\r\n    private _progress: number = 0;\r\n\r\n    private _xhr: XMLHttpRequest;\r\n\r\n    public notJson: boolean;\r\n\r\n    public constructor(args: any) {\r\n        super();\r\n\r\n        if (!args) {\r\n            throw new Error('ajax请求无参数，请检查！')\r\n        }\r\n\r\n        this._progress = 0.0;\r\n        this.emit('progress', this._progress);\r\n\r\n        this._xhr = new XMLHttpRequest();\r\n\r\n        // send cookies\r\n        if (args.cookies)\r\n            this._xhr.withCredentials = true;\r\n\r\n        // events\r\n        this._xhr.addEventListener('load', this._onLoad.bind(this), false);\r\n        // this._xhr.addEventListener('progress', this._onProgress.bind(this), false);\r\n        this._xhr.upload.addEventListener('progress', this._onProgress.bind(this), false);\r\n        this._xhr.addEventListener('error', this._onError.bind(this), false);\r\n        this._xhr.addEventListener('abort', this._onAbort.bind(this), false);\r\n\r\n        // url\r\n        let url: string = args.url;\r\n\r\n        // query\r\n        if (args.query && Object.keys(args.query).length) {\r\n            if (url.indexOf('?') === -1) {\r\n                url += '?';\r\n            }\r\n\r\n            var query = [];\r\n            for (var key in args.query) {\r\n                query.push(key + '=' + args.query[key]);\r\n            }\r\n\r\n            url += query.join('&');\r\n        }\r\n\r\n        // templating\r\n        var parts = url.split('{{');\r\n        if (parts.length > 1) {\r\n            for (var i = 1; i < parts.length; i++) {\r\n                var ends = parts[i].indexOf('}}');\r\n                var key = parts[i].slice(0, ends);\r\n\r\n                if (Ajax.params[key] === undefined)\r\n                    continue;\r\n\r\n                // replace\r\n                parts[i] = Ajax.params[key] + parts[i].slice(ends + 2);\r\n            }\r\n\r\n            url = parts.join('');\r\n        }\r\n\r\n        // open request\r\n        this._xhr.open(args.method || 'GET', url, true);\r\n\r\n        // 返回数据是否为json格式\r\n        this.notJson = args.notJson || false;\r\n\r\n        // header for PUT/POST\r\n        if (!args.ignoreContentType && (args.method === 'PUT' || args.method === 'POST' || args.method === 'DELETE'))\r\n            this._xhr.setRequestHeader('Content-Type', 'application/json');\r\n\r\n        // TODO: 权限header参数\r\n        // if (args.auth && config.accessToken) {\r\n        //     this._xhr.setRequestHeader('Authorization', 'Bearer ' + config.accessToken);\r\n        // }\r\n\r\n        if (args.headers) {\r\n            for (var key in args.headers)\r\n                this._xhr.setRequestHeader(key, args.headers[key]);\r\n        }\r\n\r\n        // stringify data if needed\r\n        if (args.data && typeof (args.data) !== 'string' && !(args.data instanceof FormData)) {\r\n            args.data = JSON.stringify(args.data);\r\n        }\r\n\r\n        // make request\r\n        this._xhr.send(args.data || null);\r\n    }\r\n\r\n    private _onLoad(): void {\r\n        this._progress = 1.0;\r\n        this.emit('progress', 1.0);\r\n\r\n        if (this._xhr.status === 200 || this._xhr.status === 201) {\r\n            if (this.notJson) {\r\n                this.emit('load', this._xhr.status, this._xhr.responseText);\r\n            } else {\r\n                try {\r\n                    var json = JSON.parse(this._xhr.responseText);\r\n                } catch (ex) {\r\n                    this.emit('error', this._xhr.status || 0, new Error('invalid json'));\r\n                    return;\r\n                }\r\n                this.emit('load', this._xhr.status, json);\r\n            }\r\n        } else {\r\n            try {\r\n                var json = JSON.parse(this._xhr.responseText);\r\n                var msg = json.message;\r\n                if (!msg) {\r\n                    msg = json.error || (json.response && json.response.error);\r\n                }\r\n\r\n                if (!msg) {\r\n                    msg = this._xhr.responseText;\r\n                }\r\n\r\n                this.emit('error', this._xhr.status, msg);\r\n            } catch (ex) {\r\n                this.emit('error', this._xhr.status);\r\n            }\r\n        }\r\n    }\r\n\r\n    private _onError(evt: any): void {\r\n        this.emit('error', 0, evt);\r\n    }\r\n\r\n    private _onAbort(evt: any): void {\r\n        this.emit('error', 0, evt);\r\n    }\r\n\r\n    private _onProgress(evt: any): void {\r\n        if (!evt.lengthComputable)\r\n            return;\r\n\r\n        var progress = evt.loaded / evt.total;\r\n\r\n        if (progress !== this._progress) {\r\n            this._progress = progress;\r\n            this.emit('progress', this._progress);\r\n        }\r\n    }\r\n\r\n    public abort(): void {\r\n        this._xhr.abort();\r\n    }\r\n\r\n\r\n}","export class Events {\r\n\r\n    // 相较于Editor，同一个函数名可包含一系列函数，不仅仅是一个，且有once功能；\r\n  \r\n    public get suspendEvents(): boolean {\r\n      return this._suspendEvents;\r\n    }\r\n    public set suspendEvents(val: boolean) {\r\n      this._suspendEvents = val;\r\n    }\r\n    private _suspendEvents: boolean = false;\r\n  \r\n    // 某个name对应的事件数组，name与Function是1对多的关系；\r\n    private _events: { [key: string]: Function[] } = {};\r\n  \r\n    public constructor() {\r\n  \r\n    }\r\n  \r\n    /**\r\n     * 添加事件数组，若name相同，则在数组末尾继续添加；\r\n     * @param name 函数名；\r\n     * @param fn 函数本体；\r\n     */\r\n    public on(name: string, fn: Function): EventHandle {\r\n      let events: Function[] = this._events[name];\r\n      if (events === undefined) {\r\n        this._events[name] = [fn];\r\n      } else {\r\n        if (events.indexOf(fn) == -1) {\r\n          events.push(fn);\r\n        }\r\n      }\r\n      return new EventHandle(this, name, fn);\r\n    }\r\n  \r\n    /**\r\n     * emit后只执行一次；\r\n     * @param name 函数名；\r\n     * @param fn 函数本体；\r\n     */\r\n    public once(name: string, fn: Function): EventHandle {\r\n      let self = this;\r\n      let evt: EventHandle = this.on(name, function (\r\n        arg0: any,\r\n        arg1: any,\r\n        arg2: any,\r\n        arg3: any,\r\n        arg4: any,\r\n        arg5: any,\r\n        arg6: any,\r\n        arg7: any\r\n      ) {\r\n        fn.call(self, arg0, arg1, arg2, arg3, arg4, arg5, arg6, arg7);\r\n        evt.unbind();\r\n      });\r\n      return evt;\r\n    }\r\n  \r\n    /**\r\n     * 执行事件；\r\n     * @param name 函数名；\r\n     * @param arg0 函数参数1，可选；\r\n     * @param arg1 函数参数2，可选；\r\n     * @param arg2 函数参数3，可选；\r\n     * @param arg3 函数参数4，可选；\r\n     * @param arg4 函数参数5，可选；\r\n     * @param arg5 函数参数6，可选；\r\n     * @param arg6 函数参数7，可选；\r\n     * @param arg7 函数参数8，可选；\r\n     */\r\n    public emit(name: string,\r\n      arg0?: any,\r\n      arg1?: any,\r\n      arg2?: any,\r\n      arg3?: any,\r\n      arg4?: any,\r\n      arg5?: any,\r\n      arg6?: any,\r\n      arg7?: any\r\n    ): Events {\r\n      if (this._suspendEvents) return this;\r\n  \r\n      let events: Function[] = this._events[name];\r\n      if (!events) return this;\r\n  \r\n      // 返回新数组\r\n      events = events.slice(0);\r\n  \r\n      for (let i: number = 0; i < events.length; i++) {\r\n        if (!events[i]) continue;\r\n        try {\r\n          events[i].call(this, arg0, arg1, arg2, arg3, arg4, arg5, arg6, arg7);\r\n        } catch (ex) {\r\n          console.info(\"%c%s %c(event error)\", \"color: #06f\", name, \"color: #f00\");\r\n          console.log(ex.stack);\r\n        }\r\n      }\r\n  \r\n      return this;\r\n    };\r\n  \r\n    /**\r\n     * 取消Events事件绑定，若name为空，则清空events；\r\n     * @param name 函数名；\r\n     * @param fn 函数本体；\r\n     */\r\n    public unbind(name?: string, fn?: Function): Events {\r\n      if (name) {\r\n        let events: Function[] = this._events[name];\r\n        if (!events) return this;\r\n  \r\n        if (fn) {\r\n          let i: number = events.indexOf(fn);\r\n          if (i !== -1) {\r\n            if (events.length === 1) {\r\n              delete this._events[name];\r\n            } else {\r\n              events.splice(i, 1);\r\n            }\r\n          }\r\n        } else {\r\n          delete this._events[name];\r\n        }\r\n      } else {\r\n        this._events = {};\r\n      }\r\n  \r\n      return this;\r\n    };\r\n  \r\n  }\r\n  \r\n  \r\n  export class EventHandle {\r\n  \r\n    public name: Nullable<string>;\r\n  \r\n    public owner: Nullable<Events>;\r\n  \r\n    public fn: Nullable<Function>;\r\n  \r\n    public constructor(owner: Events, name: string, fn: Function) {\r\n      this.owner = owner;\r\n      this.name = name;\r\n      this.fn = fn;\r\n    }\r\n  \r\n    public unbind(): void {\r\n      if (!this.owner) return;\r\n  \r\n      this.owner.unbind(this.name!, this.fn!);\r\n  \r\n      this.owner = null;\r\n      this.name = null;\r\n      this.fn = null;\r\n    }\r\n  \r\n    public call(): void {\r\n      if (!this.fn) return;\r\n  \r\n      this.fn.call(\r\n        this.owner!,\r\n        arguments[0],\r\n        arguments[1],\r\n        arguments[2],\r\n        arguments[3],\r\n        arguments[4],\r\n        arguments[5],\r\n        arguments[6],\r\n        arguments[7]\r\n      );\r\n    }\r\n  \r\n    public on(name: string, fn: Function): EventHandle {\r\n      return this.owner!.on(name, fn);\r\n    }\r\n  \r\n  }","\r\nimport { Ajax, AjaxRequest } from './ajax';\r\nlet getSuffix = function (fileName: string) {\r\n    if (fileName) {\r\n        let nameSplit = fileName.split('.');\r\n        if (nameSplit.length > 1)\r\n            return nameSplit[nameSplit.length - 1];\r\n        else\r\n            return fileName;\r\n    }\r\n    else {\r\n        return \"\";\r\n    }\r\n}\r\n\r\n/**\r\n * 上传文件\r\n * @param file 要上传的文件\r\n * @param projectId 软件id\r\n * @param assetId  文件的assetId\r\n * @param fileName  文件名\r\n * @param hash  文件hash值，若为undefined版本控制通过version序号实现\r\n */\r\nexport let uploadFile = async (file: File, projectId: string, assetId: string, fileName: string, hash?: string) => {\r\n    return new Promise<string>(async (resolve, reject) => {\r\n        try {\r\n            var form = new FormData();\r\n            form.append('file', file);\r\n            form.append('fileName', assetId + \".\" + getSuffix(fileName));\r\n            var data = {\r\n                url: \"/api/uploadFile\",\r\n                method: 'PUT',\r\n                // auth: true,\r\n                data: form,\r\n                ignoreContentType: true,\r\n                headers: {\r\n                    Accept: 'application/json'\r\n                }\r\n            };\r\n\r\n            (<AjaxRequest>new Ajax(data)).on('load', (status: any, data: any) => {\r\n                resolve();\r\n            });\r\n\r\n        }\r\n        catch (e) {\r\n            reject(e);\r\n        }\r\n    })\r\n}\r\n\r\nlet isImage = function (fileName: string) {\r\n    if (fileName.endsWith('.jpg') || fileName.endsWith('.png') || fileName.endsWith('jpeg') || fileName.endsWith('gif')) {\r\n        return true;\r\n    }\r\n    else {\r\n        return false;\r\n    }\r\n}\r\n\r\n/**\r\n * 上传assetStr\r\n * @param assetStr 要上传的assetStr内容\r\n * @param projectId 软件id\r\n * @param assetId  assetStr的assetId\r\n * @param fileName  assetStr名\r\n * @param mode  若为true:本地保存的同时同步到服务器上；false:只在本地缓存\r\n * @ignore mode为true时,assetJosn可为undefined,读取本地缓存同步到服务器\r\n */\r\nexport let uploadJsonAsset = async (assetStr: string, projectId: string, assetId: string, fileName: string, mode: boolean = true) => {\r\n    return new Promise<string>(async (resolve, reject) => {\r\n        try {\r\n            let response = await axios.post('/api/uploadJsonAsset', { jsonName: assetId + '.' + getSuffix(fileName), jsonStr: assetStr });\r\n            var data = response.data;\r\n            if (data.code === '0000') {\r\n                resolve(data.data);\r\n            }\r\n            else {\r\n                reject(data.message);\r\n            }\r\n        }\r\n        catch (e) {\r\n            reject(e);\r\n        }\r\n    })\r\n}\r\n\r\n/**\r\n * 获取asset json\r\n * @param projectId 软件id\r\n * @param assetId  assetStr的assetId\r\n * @param fileName  assetStr名\r\n * @param hash  assetStr的hash值，若为undefined，版本控制按version序号处理\r\n */\r\n\r\nexport let getJsonAsset = async (projectId: string, assetId: string, fileName: string, hash?: string) => {\r\n    return new Promise<string>(async (resolve, reject) => {\r\n        try {\r\n            let response = await axios.post('/api/getJsonAsset', { jsonName: (assetId + \".\" + getSuffix(fileName)) });\r\n            var data = response.data;\r\n            if (data.code === '0000') {\r\n                resolve(data.data);\r\n            }\r\n            else {\r\n                reject(data.message);\r\n            }\r\n        }\r\n        catch (e) {\r\n            reject(e);\r\n        }\r\n    });\r\n}\r\nlet urls: any = {};\r\n\r\n\r\n/**\r\n * 获取文件的网址\r\n */\r\nexport let getUrl = async (projectId: string, assetId: string, fileName: string, hash: string) => {\r\n    return new Promise<string>(async (resolve, reject) => {\r\n        resolve(\"/assets/\" + assetId + \".\" + getSuffix(fileName));\r\n    })\r\n}\r\n\r\n/**\r\n * 获取图文缩略图的网址\r\n */\r\nexport let getThumbnailUrl = async (projectId: string, assetId: string, fileName: string, hash: string) => {\r\n    return new Promise<string>(async (resolve, reject) => {\r\n        resolve(\"/assets/\" + assetId + \".\" + getSuffix(fileName));\r\n    })\r\n}\r\n\r\n\r\n/**\r\n * 下载asset内容\r\n */\r\nexport let donwLoad = async (projectId: string, assetId: string, fileName: string, hash: string) => {\r\n    let url = await getUrl(projectId, assetId, fileName, hash);\r\n    var a = document.createElement('a');\r\n    a.innerHTML = fileName;\r\n\r\n    // 指定生成的文件名\r\n    a.download = fileName;\r\n    a.href = url;\r\n\r\n    document.body.appendChild(a);\r\n\r\n    var evt = document.createEvent(\"MouseEvents\");\r\n    evt.initEvent(\"click\", false, false);\r\n\r\n    a.dispatchEvent(evt);\r\n\r\n    document.body.removeChild(a);\r\n}\r\n\r\n\r\n/**\r\n * 上传json的配置文件\r\n * @param josnStr 配置文件的string内容\r\n * @param projectId  项目id\r\n * @param jsonName  json名，不需要后缀\r\n */\r\nexport let upLoadJsonConfig = async (jsonStr: string, projectId: string, jsonName: string) => {\r\n    return new Promise<string>(async (resolve, reject) => {\r\n        try {\r\n            let response = await axios.post('/api/uploadJsonConfig', { projectID: projectId, jsonName: jsonName, jsonStr: jsonStr });\r\n            var data = response.data;\r\n            if (data.code === '0000') {\r\n                resolve(data.data);\r\n            }\r\n            else {\r\n                reject(data.message);\r\n            }\r\n        }\r\n        catch (e) {\r\n            reject(e);\r\n        }\r\n    })\r\n}\r\n\r\n\r\n/**\r\n * 获取json的配置文件\r\n * @param projectId  项目id\r\n * @param jsonName  json名，不需要后缀\r\n */\r\nexport let getJsonConfig = async (projectID: string, jsonName: string) => {\r\n    return new Promise<string>(async (resolve, reject) => {\r\n        try {\r\n            let response = await axios.post('/api/getJsonConfig', { projectID: projectID, jsonName: jsonName });\r\n            var data = response.data;\r\n            if (data.code === '0000') {\r\n                resolve(data.data);\r\n            }\r\n            else {\r\n                reject(data.message);\r\n            }\r\n        }\r\n        catch (e) {\r\n            reject(e);\r\n        }\r\n    });\r\n}\r\n\r\n\r\nexport let login = async (projectID: string, refer: string) => {\r\n    return new Promise<any>(async (resolve, reject) => {\r\n        try {\r\n            let response = await axios.post(\"/api/getProject\", { projectID: projectID });\r\n            var data = response.data;\r\n            if (data.code === '0000') {\r\n                let r: any = {};\r\n                r.code = \"00000\";\r\n                r.data = data.data;\r\n                resolve(r);\r\n            }\r\n            else {\r\n                reject(data.message);\r\n            }\r\n        }\r\n        catch (e) {\r\n            reject(e);\r\n        }\r\n\r\n    });\r\n\r\n}","import { Element } from \"./element\";\n\nexport class Bubble extends Element {\n\n\n  public constructor(id?: string, tabindex?: number) {\n    super();\n\n    this.element = document.createElement('div');\n    this.element.classList.add('ui-bubble');\n\n    let pulseCircle: HTMLDivElement = document.createElement('div');\n    pulseCircle.classList.add('pulse');\n    this.element.appendChild(pulseCircle);\n\n    let centerCircle: HTMLDivElement = document.createElement('div');\n    centerCircle.classList.add('center');\n    this.element.appendChild(centerCircle);\n\n    this.on('click', this._onClick);\n\n    if (id !== undefined)\n      this.element.id = id;\n\n    if (tabindex !== undefined)\n      this.element.setAttribute('tabindex', tabindex.toString());\n  }\n\n  private _onClick(): void {\n    if (this.class!.contains('active')) {\n      this.deactivate();\n    } else {\n      this.activate();\n    }\n  }\n\n  public activate(): void {\n    this.class!.add('active');\n    this.emit('activate');\n  }\n\n  public deactivate(): void {\n    this.class!.remove('active');\n    this.emit('deactivate');\n  }\n\n  public position(x: number, y: number) {\n    let rect = this.element!.getBoundingClientRect();\n\n    let left = x || 0;\n    let top = y || 0;\n\n    this.element!.style.left = (typeof left === 'number') ? left + 'px' : left;\n    this.element!.style.top = (typeof top === 'number') ? top + 'px' : top;\n  }\n\n}","import { Element } from \"./element\";\nimport { Tooltip } from \"./tooltip\";\n\nexport class Button extends Element {\n\n\n  private _text: string;\n  public get text(): string {\n    return this._text;\n  }\n  public set text(val: string) {\n    if (this._text === val) return;\n    this._text = val;\n    this.element!.innerHTML = this._text;\n  }\n\n  public tooltip: Nullable<Tooltip> = null;\n  public op: string = '';\n\n\n  public constructor(text?: string) {\n    super();\n\n    this._text = text ? text : '';\n\n    this.element = document.createElement('div');\n    this.element.classList.add('ui-button');\n    this.element.innerHTML = this._text;\n    this.element.ui = this;\n    this.element.tabIndex = 0;\n\n    // space > click\n    // 鼠标抬起时完成keydown，才会触发；\n    this.element.addEventListener('keydown', this._onKeyDown.bind(this), false);\n    this.on('click', this._onClick);\n    // this.element.addEventListener('mousedown', this._onClick.bind(this));\n\n  }\n\n\n  private _onKeyDown(evt: KeyboardEvent): void {\n    // console.log('c');\n    if (evt.keyCode === 27)  // 27: Escape\n      return (<HTMLElement>evt.target).blur();\n\n    if (evt.keyCode !== 32 || this.disabled)  // 32: Space\n      return;\n\n    evt.stopPropagation();\n    evt.preventDefault();\n    this.emit('click');\n  }\n\n  private _onClick(): void {\n    this.element!.blur();\n  };\n\n  // TODO\n  public _onLinkChange(value: any): void {\n    (<HTMLButtonElement>this.element).value = value;\n  };\n\n\n\n}","import { Element } from './element';\n\nexport class Canvas extends Element {\n\n  public get width(): number {\n    return this.element ? (<HTMLCanvasElement>this.element).width : 0;\n  }\n  public set width(val: number) {\n    if (!this.element) return;\n    if ((<HTMLCanvasElement>this.element).width === val) return;\n\n    (<HTMLCanvasElement>this.element).width = val;\n    this.emit('resize', (<HTMLCanvasElement>this.element).width, (<HTMLCanvasElement>this.element).height);\n  }\n\n  public get height(): number {\n    return this.element ? (<HTMLCanvasElement>this.element).height : 0;\n  }\n  public set height(val: number) {\n    if (!this.element) return;\n    if ((<HTMLCanvasElement>this.element).height === val) return;\n\n    (<HTMLCanvasElement>this.element).height = val;\n    this.emit('resize', (<HTMLCanvasElement>this.element).width, (<HTMLCanvasElement>this.element).height);\n  }\n\n  public constructor(id?: string) {\n    super();\n\n    this.element = document.createElement('canvas');\n    this.element.classList.add('ui-canvas');\n\n    if (id !== undefined) this.element.id = id;\n\n    this.element.onselectstart = this.onselectstart;\n\n  }\n\n  private onselectstart(): boolean {\n    return false;\n  };\n\n  public resize(width: number, height: number): void {\n    if ((<HTMLCanvasElement>this.element).width === width && (<HTMLCanvasElement>this.element).height === height) return;\n\n    (<HTMLCanvasElement>this.element).width = width;\n    (<HTMLCanvasElement>this.element).height = height;\n    this.emit('resize', (<HTMLCanvasElement>this.element).width, (<HTMLCanvasElement>this.element).height);\n  };\n\n}","import { Element } from \"./element\";\n\nexport class Checkbox extends Element {\n\n\n    private _text: string;\n\n    public get value(): boolean {\n        if (this._link) {\n            return this._link.get(this.path);\n        } else {\n            return this.element!.classList.contains('checked');\n        }\n    }\n    public set value(val: boolean) {\n        if (this._link) {\n            this._link.set(this.path, val);\n        } else {\n            if (this.element!.classList.contains('checked') !== val)\n                this._onLinkChange(val);\n        }\n    }\n\n    public constructor(text?: string) {\n        super();\n\n        this._text = text || '';\n\n        this.element = document.createElement('div');\n        this.element.classList.add('ui-checkbox', 'noSelect');\n        this.element.tabIndex = 0;\n\n        this.element.addEventListener('keydown', this._onKeyDown.bind(this), false);\n\n        this.on('click', this._onClick);\n        this.on('change', this._onChange);\n\n    }\n\n    private _onClick(): void {\n        // console.log('checkbox click');\n        this.value = !this.value;\n        this.element!.blur();\n    }\n\n    private _onChange(): void {\n        // console.log('checkbox _onChange');\n        if (!this.renderChanges)\n            return;\n\n        this.flash();\n    }\n\n    private _onKeyDown(evt: KeyboardEvent): void {\n        // console.log('checkbox _onKeyDown');\n        if (evt.keyCode === 27)  // Escape\n            return (<HTMLElement>evt.target).blur();\n\n        // Space\n        if (evt.keyCode !== 32 || this.disabled)\n            return;\n\n        evt.stopPropagation();\n        evt.preventDefault();\n        this.value = !this.value;\n    }\n\n    // TODO\n    public _onLinkChange(value: boolean) {\n        // console.log('checkbox _onLinkChange');\n        if (value === null) {\n            this.element!.classList.remove('checked');\n            this.element!.classList.add('null');\n        } else if (value) {\n            this.element!.classList.add('checked');\n            this.element!.classList.remove('null');\n        } else {\n            this.element!.classList.remove('checked', 'null');\n        }\n        this.emit('change', value);\n    }\n\n\n}","import { ContainerElement } from \"./container-element\";\n\nexport class Code extends ContainerElement {\n\n  public get text(): string {\n    return this.element!.textContent || '';\n  }\n  public set text(val: string) {\n    this.element!.textContent = val;\n  }\n\n\n  public constructor() {\n    super();\n\n    this.element = document.createElement('pre');\n    this.element.classList.add('ui-code');\n\n  }\n\n}","import { Element } from \"./element\";\n\nexport class ColorField extends Element {\n\n    public elementColor: HTMLElement;\n\n    private _values: number[];\n\n    public evtLinkChannels: EventHandle[];\n\n    private _channels: number;\n    public get channels(): number {\n        return this._channels;\n    }\n    public set channels(val: number) {\n        console.warn(val);\n        if (this._channels === val)\n            return;\n\n        this._channels = val;\n        this.emit('channels', this._channels);\n    }\n\n    public get r(): number {\n        if (this._link) {\n            return Math.floor(this._link.get(this.path + '.0') * 255);\n        } else {\n            return this._values[0];\n        }\n    }\n    public set r(val: number) {\n        val = Math.min(0, Math.max(255, val));\n\n        if (this._values[0] === val)\n            return;\n\n        this._values[0] = val;\n        this.emit('r', this._values[0]);\n        this.emit('change', this._values.slice(0, this._channels));\n    }\n\n    public get g(): number {\n        if (this._link) {\n            return Math.floor(this._link.get(this.path + '.1') * 255);\n        } else {\n            return this._values[1];\n        }\n    }\n    public set g(val: number) {\n        val = Math.min(0, Math.max(255, val));\n\n        if (this._values[1] === val)\n            return;\n\n        this._values[1] = val;\n\n        if (this._channels >= 2) {\n            this.emit('g', this._values[1]);\n            this.emit('change', this._values.slice(0, this._channels));\n        }\n    }\n\n    public get b(): number {\n        if (this._link) {\n            return Math.floor(this._link.get(this.path + '.2') * 255);\n        } else {\n            return this._values[2];\n        }\n    }\n    public set b(val: number) {\n        val = Math.min(0, Math.max(255, val));\n\n        if (this._values[2] === val)\n            return;\n\n        this._values[2] = val;\n\n        if (this._channels >= 3) {\n            this.emit('b', this._values[2]);\n            this.emit('change', this._values.slice(0, this._channels));\n        }\n    }\n\n    public get a(): number {\n        if (this._link) {\n            return Math.floor(this._link.get(this.path + '.3') * 255);\n        } else {\n            return this._values[3];\n        }\n    }\n    public set a(val: number) {\n        val = Math.min(0, Math.max(255, val));\n\n        if (this._values[3] === val)\n            return;\n\n        this._values[3] = val;\n\n        if (this._channels >= 4) {\n            this.emit('a', this._values[3]);\n            this.emit('change', this._values.slice(0, this._channels));\n        }\n    }\n\n    public get hex(): string {\n        var values = this._values;\n\n        if (this._link) {\n            values = this._link.get(this.path).map(function (channel: number) {\n                return Math.floor(channel * 255);\n            });\n        }\n\n        var hex = '';\n        for (var i = 0; i < this._channels; i++) {\n            hex += ('00' + values[i].toString(16)).slice(-2);\n        }\n        return hex;\n    }\n    public set hex(val: string) {\n        console.log('todo color-field: ' + val);\n    }\n\n\n    public get value(): number[] {\n\n        if (this._link)\n            return this._link.get(this.path);\n        else\n            return this._values;\n    }\n    public set value(val: number[]) {\n        // console.error(val);\n        if (this._link)\n            this._link.set(this.path, val);\n        else\n            this._values = val;\n        this.emit('change', val);\n    }\n\n\n    public constructor() {\n        super();\n\n        this.element = document.createElement('div');\n        this.element.tabIndex = 0;\n        this.element.classList.add('ui-color-field', 'rgb');\n\n        this.elementColor = document.createElement('span');\n        this.elementColor.classList.add('color');\n        this.element.appendChild(this.elementColor);\n\n        this._channels = 3;\n        this._values = [0, 0, 0, 0];\n\n        // space > click\n        this.element.addEventListener('keydown', this._onKeyDown.bind(this), false);\n\n        // render color back\n        this.on('change', this._onChange);\n\n        // link to channels\n        this.evtLinkChannels = [];\n        this.on('link', this._onLink);\n        this.on('unlink', this._onUnlink);\n\n    }\n\n\n    private _onKeyDown(evt: KeyboardEvent) {\n        if (evt.keyCode === 27) // ESC按键\n            return this.element!.blur();\n\n        if (evt.keyCode !== 13 || this.disabled)  // Enter回车键\n            return;\n\n        evt.stopPropagation();\n        evt.preventDefault();\n        this.emit('click');\n    };\n\n    private _onChange(color: any) {\n        if (this._channels === 1) {\n            this.elementColor.style.backgroundColor = 'rgb(' + [this.r, this.r, this.r].join(',') + ')';\n        } else if (this._channels === 3) {\n            this.elementColor.style.backgroundColor = 'rgb(' + this._values.slice(0, 3).join(',') + ')';\n        } else if (this._channels === 4) {\n            var rgba = this._values.slice(0, 4);\n            rgba[3] /= 255;\n            this.elementColor.style.backgroundColor = 'rgba(' + rgba.join(',') + ')';\n        } else {\n            console.log('unknown channels', color);\n        }\n    };\n\n    private _onLink(): void {\n        let that = this;\n        for (var i = 0; i < 4; i++) {\n            this.evtLinkChannels[i] = this._link!.on(this.path + '.' + i + ':set', function (value: any) {\n                that._setValue(that._link!.get(that.path));\n            }.bind(that));\n        }\n    };\n\n    private _onUnlink(): void {\n        for (var i = 0; i < this.evtLinkChannels.length; i++)\n            this.evtLinkChannels[i].unbind();\n\n        this.evtLinkChannels = [];\n    };\n\n    public _onLinkChange(value: number[]) {\n        if (!value)\n            return;\n\n        this._setValue(value);\n    };\n\n\n    private _setValue(value: number[]) {\n        var changed = false;\n\n        if (!value)\n            return;\n\n        if (value.length !== this._channels) {\n            changed = true;\n            this.channels = value.length;\n        }\n\n        for (var i = 0; i < this._channels; i++) {\n            if (this._values[i] === Math.floor(value[i]))\n                continue;\n\n            changed = true;\n            this._values[i] = Math.floor(value[i]);\n        }\n\n        if (changed)\n            this.emit('change', this._values.slice(0, this._channels));\n    };\n\n\n}","import { Element } from './element';\n\nexport class ContainerElement extends Element {\n\n\n    private _innerElement: Nullable<HTMLElement> = null;\n    public get innerElement(): Nullable<HTMLElement> {\n        return this._innerElement;\n    }\n    public set innerElement(val: Nullable<HTMLElement>) {\n        if (this._innerElement) {\n            this._observer.disconnect();\n        }\n\n        this._innerElement = val;\n\n        this._observer.observe(this._innerElement!, this._observerOptions);\n    }\n\n    private _observerChanged: boolean = false;\n\n    private _observer: MutationObserver;\n\n    private _observerOptions: {} = {\n        childList: true,\n        attributes: true,\n        characterData: false,\n        subtree: true,\n        attributeOldValue: false,\n        characterDataOldValue: false\n    };\n\n\n    public get flexible(): boolean {\n        return this.element ? this.element.classList.contains('flexible') : false;\n    }\n    public set flexible(val: boolean) {\n        if (!this.element || this.element.classList.contains('flexible') === val)\n            return;\n\n        if (val) {\n            this.element.classList.add('flexible');\n        } else {\n            this.element.classList.remove('flexible');\n        }\n    }\n\n    public get flex(): boolean {\n        return this.element ? this.element.classList.contains('flex') : false;\n    }\n    public set flex(val: boolean) {\n        if (!this.element || this.element.classList.contains('flex') === val)\n            return;\n\n        if (val) {\n            this.element.classList.add('flex');\n        } else {\n            this.element.classList.remove('flex');\n        }\n    }\n\n    public get flexDirection(): string {\n        return this._innerElement ? (this._innerElement!.style.flexDirection || '') : '';\n    }\n    public set flexDirection(val: string) {\n        if (this._innerElement) {\n            this._innerElement.style.flexDirection = val;\n            this._innerElement.style.webkitFlexDirection = val!;\n        }\n    }\n\n    public get flexWrap(): string {\n        return this._innerElement ? (this._innerElement!.style.flexWrap || '') : '';\n    }\n    public set flexWrap(val: string) {\n        if (this._innerElement) {\n            this._innerElement.style.flexWrap = val;\n            this._innerElement.style.webkitFlexWrap = val!;\n        }\n    }\n\n    public get flexGrow(): string {\n        return this.element ? (this.element.style.flexGrow || '') : '';\n    }\n    public set flexGrow(val: string) {\n        if (!!val) this.flex = true;\n\n        if (this.element) {\n            this.element.style.flexGrow = val;\n            this.element.style.webkitFlexGrow = val!;\n        }\n\n        if (this._innerElement) {\n            this._innerElement.style.flexGrow = val;\n            this._innerElement.style.webkitFlexGrow = val!;\n        }\n    }\n\n    public get flexShrink(): string {\n        return this.element ? (this.element.style.flexShrink || '') : '';\n    }\n    public set flexShrink(val: string) {\n        if (!!val) this.flex = true;\n\n        if (this.element) {\n            this.element.style.flexShrink = val;\n            this.element.style.webkitFlexShrink = val!;\n        }\n\n        if (this._innerElement) {\n            this._innerElement.style.flexShrink = val;\n            this._innerElement.style.webkitFlexShrink = val!;\n        }\n    }\n\n    public get scroll(): boolean {\n        return this.class ? this.class.contains('scrollable') : false;\n    }\n    public set scroll(val: boolean) {\n        if (this.class) this.class.add('scrollable');\n    }\n\n\n    public constructor() {\n        super();\n\n        let self = this;\n\n        let observerTimeout = function () {\n            self._observerChanged = false;\n            self.emit('nodesChanged');\n            // console.warn('nodesChanged');\n        };\n\n        this._observer = new MutationObserver(function () {\n            if (self._observerChanged)\n                return;\n            self._observerChanged = true;\n            setTimeout(observerTimeout, 0);\n        });\n\n    }\n\n    public append(element: HTMLElement | Element): void {\n        let html: boolean = element instanceof HTMLElement;\n        let node: HTMLElement = html ? <HTMLElement>element : (<Element>element).element!;\n        this._innerElement!.appendChild(node);\n\n        if (!html) {\n            (<Element>element).parent = this;\n            this.emit('append', element);\n        }\n    }\n\n\n    public appendBefore(element: HTMLElement | Element, reference: HTMLElement | Element | null): void {\n        let html: boolean = (element instanceof HTMLElement);\n        let node: HTMLElement = html ? <HTMLElement>element : (<Element>element).element!;\n\n        if (reference instanceof Element) reference = reference.element;\n\n        this._innerElement!.insertBefore(node, reference);\n\n        if (!html) {\n            (<Element>element).parent = this;\n            this.emit('append', element);\n        }\n    };\n\n    public appendAfter(element: HTMLElement | Element, reference: HTMLElement | Element | null): void {\n        let html: boolean = (element instanceof HTMLElement);\n        let node: HTMLElement = html ? <HTMLElement>element : (<Element>element).element!;\n\n        if (reference instanceof Element) reference = reference.element;\n\n        if (reference) {\n            this._innerElement!.insertBefore(node, reference.nextSibling);\n        } else {\n            this._innerElement!.appendChild(node);\n        }\n\n        if (!html) {\n            (<Element>element).parent = this;\n            this.emit('append', element);\n        }\n    };\n\n\n    public prepend(element: HTMLElement | Element): void {\n        let first = this._innerElement!.firstChild;\n        let html: boolean = (element instanceof HTMLElement);\n        let node: HTMLElement = html ? <HTMLElement>element : (<Element>element).element!;\n\n        if (first) {\n            this._innerElement!.insertBefore(node, first);\n        } else {\n            this._innerElement!.appendChild(node);\n        }\n\n        if (!html) {\n            (<Element>element).parent = this;\n            this.emit('append', element);\n        }\n    };\n\n    public remove(element: HTMLElement | Element): void {\n        let html: boolean = (element instanceof HTMLElement);\n        let node: HTMLElement = html ? <HTMLElement>element : (<Element>element).element!;\n\n        if (!node.parentElement || node.parentElement !== this._innerElement)\n            return;\n\n        this._innerElement.removeChild(node);\n\n        if (!html) {\n            (<Element>element).parent = null;\n            this.emit('remove', element);\n        }\n    };\n\n    // TODO：怕不对\n    public clear(): void {\n        // console.log('clear');\n        let node: HTMLElement;\n        this._observer.disconnect();\n        // console.log(this._innerElement);\n        let i: number = this._innerElement!.children.length;\n        while (i--) {\n            node = <HTMLElement>(this._innerElement!.children[i]);\n\n            if (!node.ui)\n                continue;\n\n            node.ui.destroy();\n        }\n        this._innerElement!.innerHTML = '';\n\n        this._observer.observe(this._innerElement!, this._observerOptions);\n    };\n\n\n}","import { Events, EventHandle } from '../lib';\nimport { Link } from './link';\nimport { TopElement } from './top';\n\nexport class Element extends Events {\n\n    private _parent: Nullable<Element> | Nullable<TopElement> = null;\n    private _destroyed: boolean = false;\n\n    // TODO\n    public _link: Nullable<Link> = null;\n    /*\n      on get set .schema.has .schema.get .history .history.combine .entity\n    */\n    private _linkOnSet: Nullable<EventHandle> = null;\n    private _linkOnUnset: Nullable<EventHandle> = null;\n    public path: string = '';\n\n    public renderChanges = false;\n    // TODO\n    // // render changes only from next ticks\n    // setTimeout(function() {\n    //   if (self.renderChanges === null) self.renderChanges = true;\n    // }, 0);\n\n    public disabledClick = false;\n    private _disabled = false;\n    private _disabledParent = false;\n\n    private _evtParentDestroy: Nullable<EventHandle> = null;\n    private _evtParentDisable: Nullable<EventHandle> = null;\n    private _evtParentEnable: Nullable<EventHandle> = null;\n\n    // public get selected(): boolean {\n    //   return this.class!.contains('selected');\n    // }\n\n    // HTMLElement \n    private _element: Nullable<HTMLElement> = null;\n    // public innerElement: Nullable<HTMLElement> = null;\n    public get element(): Nullable<HTMLElement> {\n        return this._element;\n    }\n    public set element(val: Nullable<HTMLElement>) {\n        if (this._element) return;\n\n        this._element = val;\n        this._element!.ui = this;\n\n        if (!this._element) return;\n\n        let self = this;\n        // click 事件\n        this._element.addEventListener('click', (evt) => {\n            if (self.disabled && !self.disabledClick) return;\n            self.emit('click', evt);\n        }, false);\n        // hover 事件\n        this._element.addEventListener('mouseover', (evt) => {\n            self.emit('hover', evt);\n        }, false);\n        // blur 事件，mouse out\n        this._element.addEventListener('mouseout', (evt) => {\n            self.emit('blur', evt);\n        }, false);\n\n        // if (!this.innerElement) this.innerElement = this._element;\n    }\n\n    public get parent(): Nullable<Element> | Nullable<TopElement> {\n        return this._parent;\n    }\n    public set parent(val: Nullable<Element> | Nullable<TopElement>) {\n        if (this._parent) {\n            this._parent = null;\n            this._evtParentDestroy!.unbind();\n            this._evtParentDisable!.unbind();\n            this._evtParentEnable!.unbind();\n        }\n        // let self = this;\n\n        if (val) {\n            this._parent = val;\n            this._evtParentDestroy = this._parent.once(\n                'destroy',\n                this._parentDestroy.bind(this)\n            );\n            this._evtParentDisable = this._parent.on('disable', this._parentDisable.bind(this));\n            this._evtParentEnable = this._parent.on('enable', this._parentEnable.bind(this));\n\n            if (this._disabledParent !== this._parent.disabled) {\n                this._disabledParent = this._parent.disabled;\n\n                if (this._disabledParent) {\n                    this.class!.add('disabled');\n                    this.emit('disable');\n                } else {\n                    this.class!.remove('disabled');\n                    this.emit('enable');\n                }\n\n            }\n        }\n\n        this.emit('parent');\n    }\n\n    public get disabled(): boolean {\n        return this._disabled || this._disabledParent;\n    }\n    public set disabled(val: boolean) {\n        if (this._disabled === val) return;\n\n        this._disabled = !!val;\n        \n        this.emit(this._disabled || this._disabledParent ? 'disable' : 'enable');\n\n        if (this._disabled || this._disabledParent) {\n            if (this.class) this.class.add('disabled');\n        } else {\n            if (this.class) this.class.remove('disabled');\n        }\n    }\n\n    public get disabledSelf(): boolean {\n        return this._disabled;\n    }\n\n    public get enabled(): boolean {\n        return !this._disabled;\n    }\n    public set enabled(val: boolean) {\n        this.disabled = !val;\n    }\n\n    public get hidden(): boolean {\n        return this._element ? this._element.classList.contains('hidden') : false;\n    }\n    public set hidden(val: boolean) {\n        if (!this._element) return;\n\n        if (this._element.classList.contains('hidden') === !!val) return;\n\n        if (val) {\n            this._element.classList.add('hidden');\n            this.emit('hide');\n        } else {\n            this._element.classList.remove('hidden');\n            this.emit('show');\n\n        }\n    }\n\n    // TODO\n    public get value(): any {\n        if (!this._link) return null;\n        return this._link.get(this.path);\n    }\n    public set value(val: any) {\n        if (!this._link) return;\n        this._link.set(this.path, val);\n    }\n\n    /* DOM Element */\n\n    public get class(): Nullable<DOMTokenList> {\n        if (this._element) {\n            return this._element.classList;\n        }\n        return null;\n    }\n\n    public get style(): Nullable<CSSStyleDeclaration> {\n        if (this._element) {\n            return this._element.style;\n        }\n        return null;\n    }\n\n    // flex-grow 属性用于设置或检索弹性盒子的扩展比率，用作css动画效果\n    public get flexGrow(): string {\n        return this._element ? (this._element.style.flexGrow || '') : '';\n    }\n    public set flexGrow(val: string) {\n        if (this._element) {\n            this._element.style.flexGrow = val;\n            this._element.style.webkitFlexGrow = val;\n        }\n    }\n\n    // flex-shrink 属性规定项目将相对于同一容器内其他灵活的项目进行收缩的量，用作css动画效果\n    public get flexShrink(): string {\n        return this._element ? (this._element.style.flexShrink || '') : '';\n    }\n    public set flexShrink(val: string) {\n        if (this._element) {\n            this._element.style.flexShrink = val;\n            this._element.style.webkitFlexShrink = val!;\n        }\n    }\n\n\n    public constructor() {\n        super();\n        // this._element!.addEventListener('click', )\n\n        this._parent = null;\n        // let self = this;\n        // this._parentDestroy = function () {\n        //   self.destroy();\n        // };\n    }\n\n    // 设置元素闪烁效果\n    public flash(): void {\n        if (this.class) {\n            this.class.add('flash');\n            setTimeout(this._onFlashDelay, 200);\n        }\n    }\n\n\n    private _onFlashDelay(): void {\n        if (this.class) {\n            this.class.remove('flash');\n        }\n    }\n\n    public link(link: Link, path: string): void {\n        let self = this;\n\n        if (this._link) this.unlink();\n        this._link = link;\n        this.path = path;\n\n        this.emit('link', path);\n\n        // add :set link\n        if (this._onLinkChange) {\n            let renderChanges = this.renderChanges;\n            this.renderChanges = false;\n            this._linkOnSet = this._link.on(this.path + ':set', function (value: any) {\n                self._onLinkChange(value);\n            });\n            this._linkOnUnset = this._link.on(this.path + ':unset', function (value: any) {\n                self._onLinkChange(value);\n            });\n            this._onLinkChange(this._link.get(this.path));\n            this.renderChanges = renderChanges;\n        }\n    };\n\n\n    public unlink(): void {\n        if (!this._link) return;\n\n        this.emit('unlink', this.path);\n\n        // remove :set link\n        if (this._linkOnSet) {\n            this._linkOnSet.unbind();\n            this._linkOnSet = null;\n\n            this._linkOnUnset!.unbind();\n            this._linkOnUnset = null;\n        }\n\n        this._link = null;\n        this.path = '';\n    };\n\n    public _onLinkChange(value: any): void {\n\n    }\n\n\n    public destroy(): void {\n        if (this._destroyed) return;\n\n        this._destroyed = true;\n\n        if (this._parent) {\n            this._evtParentDestroy!.unbind();\n            this._evtParentDisable!.unbind();\n            this._evtParentEnable!.unbind();\n            this._parent = null;\n        }\n\n        if (this._element && this._element.parentNode) {\n            this._element.parentNode.removeChild(this._element);\n        }\n\n        this.unlink();\n\n        this.emit('destroy');\n\n        this.unbind();\n\n        // console.error('destroy');\n    };\n\n    private _parentDestroy(): void {\n        this.destroy();\n    };\n\n    private _parentDisable(): void {\n        if (this._disabledParent) return;\n\n        this._disabledParent = true;\n\n        if (!this._disabled) {\n            this.emit('disable');\n            this.class!.add('disabled');\n        }\n    };\n\n    private _parentEnable(): void {\n        if (!this._disabledParent) return;\n\n        this._disabledParent = false;\n\n        if (!this._disabled) {\n            this.emit('enable');\n            this.class!.remove('disabled');\n        }\n    };\n\n\n}","import { Element } from \"./element\";\nimport { Observer } from \"../lib\";\nimport { TreeItem } from \"./tree-item\";\n\nexport class GridItem extends Element {\n\n    private _clicked: boolean;\n    public _selectPending: boolean;\n    private _toggleSelectOnClick: boolean;\n\n    private _text: string;\n    public get text(): string {\n        return this._text;\n    }\n    public set text(val: string) {\n        if (this._text === val) return;\n        this._text = val;\n        this.element!.innerHTML = this._text;\n    }\n\n    // TODO\n    public asset!: Observer;\n    public tree!: TreeItem;\n    public thumbnail?: any;\n    public labelElement?: any;\n    public users?: any;\n    public script?: any;\n\n    private _selected: boolean;\n    public get selected(): boolean {\n        return this._selected;\n    }\n    public set selected(val: boolean) {\n        if (this._selected === val)\n            return;\n\n        this._selectPending = val;\n\n        if (this.parent && this._clicked)\n            this.parent.emit('before' + (val ? 'Select' : 'Deselect'), this, this._clicked);\n\n        if (this._selected === this._selectPending)\n            return;\n\n        this._selected = this._selectPending;\n\n        if (this._selected) {\n            this.element!.classList.add('selected');\n        } else {\n            this.element!.classList.remove('selected');\n        }\n\n        this.emit(this.selected ? 'select' : 'deselect');\n        this.emit('change', this.selected);\n\n        if (this.parent) {\n            // console.warn('select');\n            this.parent.emit(this.selected ? 'select' : 'deselect', this, this._clicked);\n        }\n            \n    }\n\n\n    public constructor(args?: GridItemArgs) {\n        super();\n        args = args || {};\n\n        this._text = args.text || '';\n        this._selectPending = false;\n        this._selected = args.selected || false;\n        this._toggleSelectOnClick = args && args.toggleSelectOnClick !== undefined ? args.toggleSelectOnClick : true;\n        this._clicked = false;\n\n        this.element = document.createElement('li');\n        this.element.ui = this;\n        this.element.tabIndex = 0;\n        this.element.classList.add('ui-grid-item');\n        this.element.innerHTML = this._text;\n\n        // this.element.removeEventListener('click', this._evtClick);\n        this.element.addEventListener('click', this._onClick.bind(this), false);\n\n        this.on('select', this._onSelect);\n        this.on('deselect', this._onDeselect);\n\n    }\n\n\n    private _onClick() {\n        this.emit('click');\n        this._clicked = true;\n        if (this._toggleSelectOnClick) {\n            this.selected = !this.selected;\n        } else {\n            this.selected = true;\n        }\n        this._clicked = false;\n    };\n\n    private _onSelect() {\n        this.element!.focus();\n    };\n\n    private _onDeselect() {\n        this.element!.blur();\n    };\n\n}\n\n\nexport class GridItemArgs {\n    text?: string;\n    selected?: boolean;\n    toggleSelectOnClick?: boolean;\n}","import { ContainerElement } from \"./container-element\";\nimport { GridItem } from \"./grid-item\";\nimport { Hotkeys } from \"../editor\";\n\nexport class Grid extends ContainerElement {\n\n    public dragOver: any;\n\n    private _lastSelect: Nullable<GridItem>;\n\n    private _selecting: boolean;\n    private _multiSelect: boolean;\n\n\n    public get selected(): GridItem[] {\n        var items: GridItem[] = [];\n        var elements = this.element!.querySelectorAll('.ui-grid-item.selected');\n\n        for (var i = 0; i < elements.length; i++)\n            items.push(<GridItem>((<HTMLElement>elements[i]).ui));\n\n        return items;\n    }\n\n    public set selected(val: GridItem[]) {\n        if (this._selecting)\n            return;\n\n        this._selecting = true;\n\n        // deselecting\n        var items = this.selected;\n        for (var i = 0; i < items.length; i++) {\n            if (val && val.indexOf(items[i]) !== -1)\n                continue;\n            items[i].selected = false;\n        }\n\n        if (!val)\n            return;\n\n        // selecting\n        for (var i = 0; i < val.length; i++) {\n            if (!val[i])\n                continue;\n\n            val[i].selected = true;\n        }\n\n        this._selecting = false;\n    }\n\n    public constructor(multiSelect?: boolean) {\n        super();\n\n        this.element = document.createElement('ul');\n        this.element.tabIndex = 0;\n        this.element.classList.add('ui-grid');\n\n        this.innerElement = this.element;\n\n        this._lastSelect = null;\n        this._selecting = false;\n        this._multiSelect = multiSelect !== undefined ? multiSelect : true;\n\n        this.on('select', this._onSelect);\n        this.on('beforeDeselect', this._onBeforeDeselect);\n\n        this.on('append', this._onAppend);\n        this.on('remove', this._onRemove);\n\n    }\n\n    public static _ctrl(): boolean {\n        return Hotkeys.ctrl;\n    }\n\n    public static _shift(): boolean {\n        return Hotkeys.shift;\n    }\n\n    private _onAppend(): void {\n\n    }\n\n    private _onRemove(): void {\n\n    }\n\n    private _onSelect(item: GridItem) {\n        if (this._selecting)\n            return;\n\n        if (this._multiSelect && Grid._shift && Grid._shift()) {\n            var children = Array.prototype.slice.call(this.element!.childNodes, 0);\n\n            // multi select from-to\n            if (this._lastSelect) {\n                this._selecting = true;\n\n                var startInd = children.indexOf(this._lastSelect.element);\n                var endInd = children.indexOf(item.element);\n\n                // swap if backwards\n                if (startInd > endInd) {\n                    var t = startInd;\n                    startInd = endInd;\n                    endInd = t;\n                }\n\n                for (var i = startInd; i < endInd; i++) {\n                    if (!children[i] || !children[i].ui || children[i].ui.hidden)\n                        continue;\n\n                    children[i].ui.selected = true;\n                }\n\n                this._selecting = false;\n            } else {\n                this._lastSelect = item;\n            }\n        } else if (this._multiSelect && Grid._ctrl && Grid._ctrl()) {\n            // multi select\n            this._lastSelect = item;\n        } else {\n            // single select\n            var items = this.element!.querySelectorAll('.ui-grid-item.selected');\n\n            if (items.length > 1) {\n                for (var i = 0; i < items.length; i++) {\n                    if ((<HTMLElement>items[i]).ui === item)\n                        continue;\n\n                    (<GridItem>(<HTMLElement>items[i]).ui).selected = false;\n                }\n            }\n\n            this._lastSelect = item;\n        }\n    };\n\n    private _onBeforeDeselect(item: GridItem) {\n        if (this._selecting)\n            return;\n\n        this._selecting = true;\n\n        if (this._multiSelect && Grid._shift && Grid._shift()) {\n            this._lastSelect = null;\n        } else if (this._multiSelect && Grid._ctrl && Grid._ctrl()) {\n            this._lastSelect = null;\n        } else {\n            var items = this.element!.querySelectorAll('.ui-grid-item.selected');\n            if (items.length > 1) {\n                for (var i = 0; i < items.length; i++) {\n                    if ((<HTMLElement>items[i]).ui === item)\n                        continue;\n                    (<GridItem>(<HTMLElement>items[i]).ui).selected = false;\n                }\n                item._selectPending = true;\n                this._lastSelect = item;\n            }\n        }\n\n        this._selecting = false;\n    };\n\n    public filter(fn: Function) {\n        this.forEach(function (item: HTMLElement) {\n            item.hidden = !fn(item);\n        });\n    };\n\n    public forEach(fn: Function) {\n        var child = this.element!.firstChild;\n        while (child) {\n            if ((<HTMLElement>child).ui)\n                fn((<HTMLElement>child).ui);\n\n            child = child.nextSibling;\n        };\n    };\n\n\n}","import { Element } from \"./element\";\nimport { Label } from \"./label\";\n\nexport class ImageField extends Element {\n\n    private _value: any;\n\n    public elementImage: HTMLImageElement | HTMLCanvasElement;\n\n    public _lable: Nullable<Label> = null;\n    public _title: Nullable<Label> = null;\n\n\n    public get image(): string {\n        if (this.elementImage instanceof HTMLCanvasElement) {\n            return '';\n        } else {\n            return (<HTMLImageElement>this.elementImage).src;\n        }\n    }\n    public set image(val: string) {\n        if (this.elementImage instanceof HTMLImageElement) {\n            this.elementImage.src = val;\n        } else {\n            this.elementImage.style.backgroundImage = 'url(\"' + val + '\")';\n        }\n    }\n\n    public get empty(): boolean {\n        return this.class!.contains('empty');\n    }\n    public set empty(val: boolean) {\n        if (this.class!.contains('empty') === !!val)\n            return;\n\n        if (val) {\n            this.class!.add('empty');\n            this.image = '';\n        } else {\n            this.class!.remove('empty');\n        }\n    }\n\n    public get value(): any {\n        if (this._link) {\n            return this._link.get(this.path);\n        } else {\n            return this._value;\n        }\n    }\n    public set value(val: any) {\n        // val = val && parseInt(val) || null;\n\n        if (this._link) {\n            if (!this._link.set(this.path, val))\n                this._value = this._link.get(this.path);\n        } else {\n            if (this._value === val && !this.class!.contains('null'))\n                return;\n\n            this._value = val;\n            this.emit('change', val);\n        }\n    }\n\n\n    public constructor(canvas?: boolean) {\n        super();\n\n        this.element = document.createElement('div');\n        this.element.classList.add('ui-image-field', 'empty');\n\n        if (canvas) {\n            this.elementImage = document.createElement('canvas');\n            this.elementImage.width = 64;\n            this.elementImage.height = 64;\n        } else {\n            this.elementImage = new Image();\n        }\n\n        this.elementImage.classList.add('preview');\n        this.element.appendChild(this.elementImage);\n\n        this._value = null;\n\n        // this.element.removeEventListener('click', this._evtClick);\n        this.element.addEventListener('click', this._onClick.bind(this), false);\n        this.on('change', this._onChange.bind(this));\n\n        // space > click\n        this.element.addEventListener('keydown', this._onKeyDown.bind(this), false);\n\n    }\n\n    private _onClick(evt: MouseEvent) {\n        this.emit('click', evt);\n    };\n\n    private _onChange() {\n        if (!this.renderChanges)\n            return;\n\n        this.flash();\n    };\n\n    private _onKeyDown(evt: KeyboardEvent) {\n        if (evt.keyCode === 27)\n            return this.element!.blur();\n\n        if (evt.keyCode !== 32 || this.disabled)\n            return;\n\n        evt.stopPropagation();\n        evt.preventDefault();\n        this.emit('pick');\n    };\n\n    public _onLinkChange(value: any) {\n        this._value = value;\n        this.emit('change', value);\n    };\n\n}","export * from './top/index'\nexport * from './link';\nexport * from './element';\nexport * from './container-element';\nexport * from './panel';\nexport * from './canvas';\nexport * from './button';\nexport * from './label';\nexport * from './text-field';\nexport * from './textarea-field';\nexport * from './tree';\nexport * from './tree-item';\nexport * from './list';\nexport * from './list-item';\nexport * from './checkbox';\nexport * from './bubble';\nexport * from './overlay';\nexport * from './tooltip';\nexport * from './progress';\nexport * from './menu-item';\nexport * from './menu';\nexport * from './code';\nexport * from './color-field';\nexport * from './grid-item';\nexport * from './grid';\nexport * from './image-field';\nexport * from './number-field';\nexport * from './slider';\nexport * from './select-field';","import { Element } from \"./element\";\nimport { Tooltip } from \"./tooltip\";\n\nexport class Label extends Element {\n\n  private _text: string;\n  public get text(): string {\n    if (this._link) {\n      return this._link.get(this.path);\n    } else {\n      return this._text;\n    }\n  }\n  public set text(val: string) {\n    if (this._link) {\n      // TODO \n      this._link.set(this.path, val)\n      val = this._link.get(this.path);\n      this._setText(val);\n    } else {\n      if (this._text === val) return;\n\n      if (val === undefined || val === null) {\n        this._text = '';\n      } else {\n        this._text = val;\n      }\n\n      this._setText(this._text);\n      this.emit('change', val);\n    }\n  }\n\n  // if unsafe is true then use innerHTML for the\n  // contents\n  private _unsafe: boolean;\n\n  public get placeholder(): string {\n    return this.element!.getAttribute('placeholder') || '';\n  }\n  public set placeholder(val: string) {\n    this.element!.setAttribute('placeholder', val);\n  }\n\n  public get value(): string {\n    return this.text;\n  }\n  public set value(val: string) {\n    this.text = val;\n  }\n\n\n  public tooltip: Nullable<Tooltip> = null;\n\n\n  public constructor(text?: string, placeholder?: string, unsafe?: boolean) {\n    super();\n\n    this._text = text ? text : '';\n    this._unsafe = unsafe ? unsafe : false;\n\n    this.element = document.createElement('span');\n    this.element.classList.add('ui-label');\n\n    if (this._text)\n      this._setText(this._text);\n\n    this.on('change', this._onChange);\n\n    if (placeholder) {\n      this.placeholder = placeholder;\n    }\n  }\n\n  private _setText(text: string): void {\n    if (this._unsafe) {\n      this.element!.innerHTML = text;\n    } else {\n      this.element!.textContent = text;\n    }\n  }\n\n  private _onChange(): void {\n    if (!this.renderChanges)\n      return;\n\n    this.flash();\n  };\n\n  public _onLinkChange(value: any) {\n    this.text = value;\n    this.emit('change', value);\n  };\n\n\n\n}","import { Element } from '../ui';\nimport { EventHandle } from '../lib';\n\n// TODO\nexport class Link {\n\n  private _element: Element;\n\n  private _value: { [key: string]: any } = {};\n\n  public history: any;\n\n  public schema!: LinkSchema;\n\n  public constructor(ele: Element) {\n    this._element = ele;\n  }\n\n  public get(path: string): any {\n    return this._value[path];\n  }\n\n  // TODO\n  public set(path: string, value: any): boolean {\n    this._value[path] = value;\n    return true;\n  }\n\n  public on(name: string, fn: Function): EventHandle {\n    return this._element.on(name, fn);\n  }\n}\n\n\nexport class LinkSchema {\n\n  public constructor() {\n\n  }\n\n  public has(path: string): boolean {\n    return true;\n  }\n\n  public get(path: string): any {\n    return true;\n  }\n\n}","import { Element } from \"./element\";\nimport { Observer } from \"../lib\";\n\nexport class ListItem extends Element {\n\n    public entity?: Observer;\n\n    private _text: string;\n    public get text(): string {\n        return this._text;\n    }\n    public set text(val: string) {\n        if (this._text === val) return;\n        this._text = val;\n        this.elementText.textContent = this._text;\n    }\n\n    private _selected: boolean;\n    public get selected(): boolean {\n        return this._selected;\n    }\n    public set selected(val: boolean) {\n        if (this._selected === val)\n            return;\n\n        this._selected = val;\n\n        if (this._selected) {\n            this.element!.classList.add('selected');\n        } else {\n            this.element!.classList.remove('selected');\n        }\n\n        this.emit(this.selected ? 'select' : 'deselect');\n\n        if (this.parent)\n            this.parent.emit(this.selected ? 'select' : 'deselect', this);\n\n        this.emit('change', this.selected);\n    }\n\n    private _allowDeselect: boolean;\n\n    public elementText: HTMLElement;\n\n    public constructor(text?: string, selected?: boolean, allowDeselect?: boolean) {\n        super();\n\n        this._text = text || '';\n        this._selected = selected || false;\n        this._allowDeselect = allowDeselect || false;\n\n        this.element = document.createElement('li');\n        this.element.classList.add('ui-list-item');\n        this.element.ui = this;\n\n        this.elementText = document.createElement('span');\n        this.elementText.textContent = this._text;\n        this.element.appendChild(this.elementText);\n\n        this.on('click', this._onClick);\n    }\n\n\n    private _onClick(): void {\n        if (!this.selected) {\n            this.selected = true;\n        } else if (this._allowDeselect) {\n            this.selected = false;\n        }\n    }\n\n\n\n}","import { ContainerElement } from \"./container-element\";\nimport { ListItem } from \"./list-item\";\nimport { Hotkeys } from \"../editor\";\n\nexport class List extends ContainerElement {\n\n\n  private _selectable: boolean;\n  public get selectable(): boolean {\n    return this._selectable;\n  }\n  public set selectable(val: boolean) {\n    if (this._selectable === !!val)\n      return;\n\n    this._selectable = val;\n\n    if (this._selectable) {\n      this.class!.add('selectable');\n    } else {\n      this.class!.remove('selectable');\n    }\n  }\n\n  public _changing: boolean;\n\n  private _selected: ListItem[];\n  public get selected(): ListItem[] {\n    return this._selected.slice(0);\n  }\n  public set selected(val: ListItem[]) {\n    this._changing = true;\n\n    // deselecting\n    let items: ListItem[] = this.selected;\n    for (let i = 0; i < items.length; i++) {\n      if (val.indexOf(items[i]) !== -1)\n        continue;\n\n      items[i].selected = false;\n    }\n\n    // selecting\n    for (let i = 0; i < val.length; i++) {\n      val[i].selected = true;\n    }\n\n    this._changing = false;\n  }\n\n  public constructor(selectable?: boolean) {\n    super();\n\n    this.element = document.createElement('ul');\n    this.element.classList.add('ui-list');\n    this.innerElement = this.element;\n\n    this._selectable = selectable || true;\n\n    this._changing = false;\n    this._selected = [];\n\n    this.on('select', this._onSelect);\n    this.on('deselect', this._onDeselect);\n    this.on('append', this._onAppend);\n  }\n\n  private _onSelect(item: ListItem): void {\n    let ind: number = this._selected.indexOf(item);\n    if (ind === -1)\n      this._selected.push(item);\n\n    if (this._changing)\n      return;\n\n    if (List._ctrl && List._ctrl()) {\n\n    } else if (List._shift && List._shift() && this.selected.length) {\n\n    } else {\n      this._changing = true;\n\n      let items: ListItem[] = this.selected;\n\n      if (items.length > 1) {\n        for (let i = 0; i < items.length; i++) {\n          if (items[i] === item)\n            continue;\n\n          items[i].selected = false;\n        }\n      }\n\n      this._changing = false;\n    }\n\n    this.emit('change');\n  }\n\n  public _onDeselect(item: ListItem): void {\n    let ind: number = this._selected.indexOf(item);\n    if (ind !== -1) this._selected.splice(ind, 1);\n\n    if (this._changing)\n      return;\n\n    if (List._ctrl && List._ctrl()) {\n\n    } else {\n      this._changing = true;\n\n      let items: ListItem[] = this.selected;\n\n      if (items.length) {\n        for (let i = 0; i < items.length; i++)\n          items[i].selected = false;\n\n        item.selected = true;\n      }\n\n      this._changing = false;\n    }\n\n    this.emit('change');\n  }\n\n  private _onAppend(item: ListItem): void {\n    if (!item.selected)\n      return;\n\n    let ind = this._selected.indexOf(item);\n    if (ind === -1) this._selected.push(item);\n  }\n\n  public clear(): void {\n    this._selected = [];\n    ContainerElement.prototype.clear.call(this);\n  }\n\n  public static _ctrl(): boolean {\n    return Hotkeys.ctrl;\n  }\n\n  public static _shift(): boolean {\n    return Hotkeys.shift;\n  }\n\n}","import { ContainerElement } from './container-element';\n\nexport class MenuItem extends ContainerElement {\n\n\n  private _hasChildren: boolean;\n  private _clickableSubmenus: boolean = false;\n  private _container: boolean;\n\n  public _index: { [key: string]: MenuItem } = {};\n\n  public elementTitle: HTMLElement;\n  public elementIcon: Nullable<HTMLElement>;\n  public elementText: HTMLElement;\n\n  private _value: string;\n  public get value(): string {\n    return this._value;\n  }\n  public set value(val: string) {\n    if (this._value === val)\n      return;\n\n    let valueOld = this._value;\n    this._value = val;\n    this.emit('value', val, valueOld);\n  }\n\n  public get text(): string {\n    return this.elementText.textContent || '';\n  }\n  public set text(val: string) {\n    if (this.elementText.textContent === val)\n      return;\n\n    this.elementText.textContent = val;\n  }\n\n  public get icon(): string {\n    if (this.elementIcon !== null) {\n      return this.elementIcon.textContent || '';\n    } else {\n      return '';\n    }\n  }\n  public set icon(val: string) {\n    if ((!val && !this.elementIcon) || (this.elementIcon && this.elementIcon.textContent === val))\n      return;\n\n    if (!val) {\n      if (this.elementIcon && this.elementIcon.parentNode)\n        this.elementIcon.parentNode.removeChild(this.elementIcon);\n      this.elementIcon = null;\n    } else {\n      if (!this.elementIcon) {\n        this.elementIcon = document.createElement('span');\n        this.elementIcon.classList.add('icon');\n        this.elementTitle.insertBefore(this.elementIcon, this.elementText);\n      }\n\n      this.elementIcon.innerHTML = val;\n    }\n  }\n\n  public constructor(args?: MenuItemArgs) {\n    super();\n\n    args = args || {};\n    this._value = args.value || '';\n    this._hasChildren = args.hasChildren || false;\n    this._clickableSubmenus = args.clickableSubmenus || false;\n\n    this.element = document.createElement('div');\n    this.element.classList.add('ui-menu-item');\n\n    if (args.className) {\n      this.element.classList.add(args.className);\n    }\n\n    this.elementTitle = document.createElement('div');\n    this.elementTitle.classList.add('title');\n    this.elementTitle.ui = this;\n    this.element.appendChild(this.elementTitle);\n\n    this.elementIcon = null;\n\n    this.elementText = document.createElement('span');\n    this.elementText.classList.add('text');\n    this.elementText.textContent = args.text || 'Untitled';\n    this.elementTitle.appendChild(this.elementText);\n\n    this.innerElement = document.createElement('div');\n    this.innerElement.classList.add('content');\n    this.element.appendChild(this.innerElement);\n\n    this._index = {};\n\n    this._container = false;\n\n    this.elementTitle.addEventListener('mouseenter', this._onMouseEnter.bind(this), false);\n    this.elementTitle.addEventListener('touchstart', this._onTouchStart, false);\n    this.elementTitle.addEventListener('touchend', this._onTouchEnd, false);\n    this.elementTitle.addEventListener('click', this._onClick.bind(this), false);\n\n    this.on('over', this._onOver.bind(this));\n    this.on('select-propagate', this._onSelectPropagate.bind(this));\n    this.on('append', this._onAppend.bind(this));\n\n    if (args.icon)\n      this.icon = args.icon;\n\n  }\n\n\n  private _onMouseEnter(evt: MouseEvent): void {\n    evt.stopPropagation();\n    evt.preventDefault();\n\n    let htmlEle: HTMLElement = <HTMLElement>evt.target;\n    (<MenuItem>(htmlEle.ui)).parent!.emit('over', [this._value]);\n  }\n\n  private _onTouchStart(evt: TouchEvent): void {\n    let item: MenuItem = (<MenuItem>(<HTMLElement>evt.target).ui);\n\n    if (!item.parent || item.disabled)\n      return;\n\n    if (!item._container || item.class!.contains('hover')) {\n      item.emit('select', item._value, item._hasChildren);\n      item.parent.emit('select-propagate', [item._value], item._hasChildren);\n      item.class!.remove('hover');\n    } else {\n      item.parent.emit('over', [item._value]);\n    }\n  }\n\n  private _onTouchEnd(evt: TouchEvent): void {\n    let item: MenuItem = (<MenuItem>(<HTMLElement>evt.target).ui);\n\n    if (!item.parent || item.disabled)\n      return;\n\n    evt.preventDefault();\n    evt.stopPropagation();\n  }\n\n  private _onClick(): void {\n\n    if (!this.parent || this.disabled)\n      return;\n\n    this.emit('select', this._value, this._hasChildren);\n    this.parent.emit('select-propagate', [this._value], this._hasChildren);\n\n    if (!this._clickableSubmenus || !this._hasChildren) {\n      this.class!.remove('hover');\n    }\n  }\n\n  private _onOver(path: string[]): void {\n    if (!this.parent)\n      return;\n    path.splice(0, 0, this._value);\n    this.parent.emit('over', path);\n  }\n\n  private _onSelectPropagate(path: string[], selectedItemHasChildren: boolean): void {\n    if (!this.parent)\n      return;\n\n    path.splice(0, 0, this._value);\n    this.parent.emit('select-propagate', path, selectedItemHasChildren);\n\n    if (!this._clickableSubmenus || !selectedItemHasChildren) {\n      this.class!.remove('hover');\n    }\n  }\n\n  private _onAppend(item: MenuItem) {\n    let self = this;\n\n    this._container = true;\n    this.class!.add('container');\n\n    this._index[item.value] = item;\n\n    item.on('value', function (value: string, valueOld: string) {\n      delete self._index[valueOld];\n      self._index[value] = item;\n    });\n    item.once('destroy', function () {\n      delete self._index[item.value];\n    });\n  }\n\n}\n\n\nexport interface MenuItemArgs {\n  text?: string;\n  className?: string;\n  value?: string;\n  icon?: string;\n  hasChildren?: boolean;\n  clickableSubmenus?: boolean;\n}","import { ContainerElement } from \"./container-element\";\nimport { MenuItem } from \"./menu-item\";\n\nexport class Menu extends ContainerElement {\n\n\n  public elementOverlay: HTMLElement;\n  private _clickableSubmenus: boolean = false;\n  private _hovered: MenuItem[] = [];\n  public _index: { [key: string]: MenuItem } = {};\n\n\n  public get open(): boolean {\n    return this.class!.contains('open');\n  }\n  public set open(val: boolean) {\n    if (this.class!.contains('open') === !!val)\n      return;\n\n    if (val) {\n      this.class!.add('open');\n      this.element!.focus();\n    } else {\n      this.class!.remove('open');\n    }\n\n    this.emit('open', !!val);\n  }\n\n\n  public constructor(args?: any) {\n    super();\n\n    args = args || {};\n\n    this.element = document.createElement('div');\n    this.element.tabIndex = 1;\n    this.element.classList.add('ui-menu');\n    this.element.addEventListener('keydown', this._onKeyDown.bind(this), false);\n\n    this.elementOverlay = document.createElement('div');\n    this.elementOverlay.ui = this;\n    this.elementOverlay.classList.add('overlay');\n    this.elementOverlay.addEventListener('click', this._onClick.bind(this), false);\n    this.elementOverlay.addEventListener('contextmenu', this._onContextMenu.bind(this), false);\n    this.element.appendChild(this.elementOverlay);\n\n    this.innerElement = document.createElement('div');\n    this.innerElement.classList.add('inner');\n    this.element.appendChild(this.innerElement);\n\n    // this._index = { };\n    // this._hovered = [ ];\n    this._clickableSubmenus = args.clickableSubmenus;\n\n    this.on('select-propagate', this._onSelectPropagate.bind(this));\n    this.on('append', this._onAppend.bind(this));\n    this.on('over', this._onOver.bind(this));\n    this.on('open', this._onOpen.bind(this));\n\n  }\n\n  private _onClick(): void {\n    this.open = false;\n  }\n\n  private _onContextMenu(): void {\n    this.open = false;\n  }\n\n  private _onKeyDown(evt: KeyboardEvent): void {\n    if (this.open && evt.keyCode === 27)\n      this.open = false;\n  }\n\n  private _onAppend(item: MenuItem) {\n    let self = this;\n    this._index[item.value] = item;\n\n    item.on('value', function (value: string, valueOld: string) {\n      delete self._index[valueOld];\n      self._index[value] = item;\n    });\n    item.once('destroy', function () {\n      delete self._index[item.value];\n    });\n  }\n\n  private _onOver(path: string[]): void {\n    this._updatePath(path);\n  }\n\n  private _onOpen(state: boolean): void {\n    if (state) return;\n    this._updatePath([]);\n  }\n\n  private _onSelectPropagate(path: string[], selectedItemHasChildren: boolean): void {\n    if (this._clickableSubmenus && selectedItemHasChildren) {\n      this._updatePath(path);\n    } else {\n      this.open = false;\n      this.emit(path.join('.') + ':select', path);\n      this.emit('select', path);\n    }\n  }\n\n  public findByPath(path: string[] | string): Nullable<MenuItem> {\n    if (!(path instanceof Array))\n      path = path.split('.');\n\n    let item: Nullable<MenuItem> = null;\n\n    for (let i = 0; i < path.length; i++) {\n      if (i === 0) {\n        item = this._index[path[i]];\n      } else {\n        item = item!._index[path[i]];\n      }\n      if (!item)\n        return null;\n    }\n\n    return item;\n  }\n\n  private _updatePath(path: string[]): void {\n    let node: Nullable<MenuItem>;\n\n    // 把之前hover的取消\n    for (let i = 0; i < this._hovered.length; i++) {\n      node = this._hovered[i];\n      if (!node) continue;\n      // if (path.length <= i || path[i] !== this._hovered[i]) {\n      node.class!.remove('hover');\n      node.innerElement!.style.top = '';\n      node.innerElement!.style.left = '';\n      node.innerElement!.style.right = '';\n      // }\n    }\n\n    this._hovered = [];\n    // node = this;\n\n    for (let i = 0; i < path.length; i++) {\n      node = this.findByPath(path.slice(0, i + 1));\n\n      if (!node)\n        continue;\n\n      this._hovered.push(node);\n\n      node.class!.add('hover');\n      node.innerElement!.style.top = '';\n      node.innerElement!.style.left = '';\n      node.innerElement!.style.right = '';\n\n      let rect = node.innerElement!.getBoundingClientRect();\n\n      // limit to bottom / top of screen\n      if (rect.bottom > window.innerHeight) {\n        node.innerElement!.style.top = -(rect.bottom - window.innerHeight) + 'px';\n      }\n      if (rect.right > window.innerWidth) {\n        node.innerElement!.style.left = 'auto';\n        // TODO\n        node.innerElement!.style.right = (node.parent!.element!.clientWidth) + 'px';\n      }\n    }\n  }\n\n\n  public position(x: number, y: number): void {\n\n    this.element!.style.display = 'block';\n    this.innerElement!.style.width = '158px';\n    let rect = this.innerElement!.getBoundingClientRect();\n    let left = (x || 0);\n    let top = (y || 0);\n\n    // limit to bottom / top of screen\n    if (top + rect.height > window.innerHeight) {\n      top = window.innerHeight - rect.height;\n    } else if (top < 0) {\n      top = 0;\n    }\n    if (left + rect.width > window.innerWidth) {\n      left = window.innerWidth - rect.width;\n    } else if (left < 0) {\n      left = 0;\n    }\n\n    this.innerElement!.style.left = left + 'px';\n    this.innerElement!.style.top = top + 'px';\n\n    this.element!.style.display = '';\n  }\n\n  public createItem(key: string, data: any): MenuItem {\n    let item = new MenuItem({\n      text: data.title || key,\n      className: data.className || null,\n      value: key,\n      icon: data.icon,\n      hasChildren: !!(data.items && Object.keys(data.items).length > 0),\n      clickableSubmenus: this._clickableSubmenus\n    });\n\n    if (data.select) {\n      item.on('select', data.select);\n    }\n\n    if (data.filter) {\n      this.on('open', function () {\n        item.enabled = data.filter();\n      });\n    }\n\n    if (data.hide) {\n      this.on('open', function () {\n        item.hidden = data.hide();\n      });\n    }\n\n    return item;\n  }\n\n\n  public static fromData(data: any, args: any) {\n    let menu = new Menu(args);\n\n    let listItems = function (data: any, parent: ContainerElement): void {\n      for (let key in data) {\n        let item = menu.createItem(key, data[key]);\n        parent.append(item);\n        // console.warn(item.parent);\n        if (data[key].items)\n          listItems(data[key].items, item);\n      }\n    };\n\n    listItems(data, menu);\n\n    return menu;\n  }\n\n}","import { Element } from \"./element\";\n\nexport class NumberField extends Element {\n\n  public precision: Nullable<number>;\n  public step: Nullable<number>;\n  public max: Nullable<number>;\n  public min: Nullable<number>;\n\n  public allowNull: boolean;\n\n  public elementInput: HTMLInputElement;\n\n  private _lastValue: number = -1;\n\n  public blurOnEnter: boolean;\n  public refocusable: boolean;\n  public _dragging: boolean;\n\n  private _dragDiff: number;\n  private _dragStart: number;\n\n  public get value(): number {\n    if (this._link) {\n      return this._link.get(this.path);\n    } else {\n      return this.elementInput.value !== '' ? parseFloat(this.elementInput.value) : -1;\n    }\n  }\n  public set value(val: number) {\n    if (this._link) {\n      if (!this._link.set(this.path, val)) {\n        this.elementInput.value = this._link.get(this.path);\n      }\n    } else {\n      if (val !== null) {\n        if (this.max !== null && this.max < val)\n          val = this.max;\n\n        if (this.min !== null && this.min > val)\n          val = this.min;\n      }\n\n      val = (val !== null && val !== undefined && (this.precision !== null) ? parseFloat(val.toFixed(this.precision)) : val);\n      if (val === undefined)\n        val = -1;\n\n      let different = this._lastValue !== val;\n      this._lastValue = val;\n      this.elementInput.value = val.toString();\n\n      if (different) {\n        this.emit('change', val);\n      }\n    }\n  }\n\n  public get placeholder(): string {\n    return this.element!.getAttribute('placeholder') || '';\n  }\n  public set placeholder(val: string) {\n    if (!val) {\n      this.element!.removeAttribute('placeholder');\n    } else {\n      this.element!.setAttribute('placeholder', val);\n    }\n  }\n\n  public get proxy(): string {\n    return this.element!.getAttribute('proxy') || '';\n  }\n  public set proxy(val: string) {\n    if (!val) {\n      this.element!.removeAttribute('proxy');\n    } else {\n      this.element!.setAttribute('proxy', val);\n    }\n  }\n\n\n  public constructor(args?: NumberFieldArgs) {\n    super();\n\n    args = args || {};\n\n    this.precision = (args.precision !== undefined) ? args.precision : null;\n    this.step = (args.step != undefined) ? args.step : ((args.precision != null) ? 1 / Math.pow(10, args.precision) : 1);\n\n    this.max = (args.max !== undefined) ? args.max : null;\n    this.min = (args.min !== undefined) ? args.min : null;\n\n    this.allowNull = !!args.allowNull;\n\n    this.element = document.createElement('div');\n    this.element.classList.add('ui-number-field');\n\n    this.elementInput = document.createElement('input');\n    this.elementInput.ui = this;\n    this.elementInput.tabIndex = 0;\n    this.elementInput.classList.add('field');\n    this.elementInput.type = 'text';\n    this.elementInput.addEventListener('focus', this._onInputFocus.bind(this), false);\n    this.elementInput.addEventListener('blur', this._onInputBlur.bind(this), false);\n    this.elementInput.addEventListener('keydown', this._onKeyDown.bind(this), false);\n    this.elementInput.addEventListener('dblclick', this._onFullSelect.bind(this), false);\n    this.elementInput.addEventListener('contextmenu', this._onFullSelect.bind(this), false);\n    this.element.appendChild(this.elementInput);\n\n    if (args.default !== undefined)\n      this.value = args.default;\n\n    this.elementInput.addEventListener('change', this._onChange.bind(this), false);\n    // this._element.addEventListener('mousedown', this._onMouseDown.bind(this), false);\n    // this._element.addEventListener('mousewheel', this._onMouseDown.bind(this), false);\n\n    this.blurOnEnter = true;\n    this.refocusable = true;\n\n    this._lastValue = this.value;\n    // this._mouseMove = null;\n    this._dragging = false;\n    this._dragDiff = 0;\n    this._dragStart = 0;\n\n    this.on('disable', this._onDisable);\n    this.on('enable', this._onEnable);\n    this.on('change', this._onChangeField);\n\n    if (args.placeholder)\n      this.placeholder = args.placeholder;\n\n  }\n\n\n  public _onLinkChange(value: string) {\n    this.elementInput.value = value || '0';\n    this.emit('change', value || '0');\n  };\n\n  public _onChange(): void {\n    let value = parseFloat(this.elementInput.value);\n    if (isNaN(value)) {\n      if (this.allowNull) {\n        this.value = -1;\n      } else {\n        this.elementInput.value = '0';\n        this.value = 0;\n      }\n    } else {\n      // this.elementInput.value = value;\n      this.value = value;\n    }\n  };\n\n\n  public focus(select?: boolean) {\n    this.elementInput.focus();\n    if (select) this.elementInput.select();\n  };\n\n  private _onInputFocus() {\n    this.class!.add('focus');\n  };\n\n  private _onInputBlur() {\n    this.class!.remove('focus');\n  };\n\n  private _onKeyDown(evt: KeyboardEvent) {\n    if (evt.keyCode === 27)\n      return this.elementInput.blur();\n\n    if (this.blurOnEnter && evt.keyCode === 13) {\n      let focused = false;\n\n      let parent = this.parent;\n      while (parent) {\n        if (parent.element && parent.element.focus) {\n          parent.element.focus();\n          focused = true;\n          break;\n        }\n\n        parent = parent.parent;\n      }\n\n      if (!focused)\n        this.elementInput.blur();\n\n      return;\n    }\n\n    if (this.disabled || [38, 40].indexOf(evt.keyCode) === -1)\n      return;\n\n    let inc = evt.keyCode === 40 ? -1 : 1;\n\n    if (evt.shiftKey)\n      inc *= 10;\n\n    let value = this.value + (this.step || 1) * inc;\n\n    if (this.max != null)\n      value = Math.min(this.max, value);\n\n    if (this.min != null)\n      value = Math.max(this.min, value);\n\n    if (this.precision != null)\n      value = parseFloat(value.toFixed(this.precision));\n\n    this.value = value;\n    // this.ui.value = value;\n  };\n\n  private _onFullSelect() {\n    this.elementInput.select();\n  };\n\n  private _onDisable() {\n    this.elementInput.readOnly = true;\n  };\n\n  private _onEnable() {\n    this.elementInput.readOnly = false;\n  };\n\n  private _onChangeField() {\n    if (!this.renderChanges)\n      return;\n\n    this.flash();\n  };\n\n\n\n\n}\n\n\n\nexport interface NumberFieldArgs {\n  default?: number;\n  placeholder?: string;\n  precision?: number;\n  step?: number;\n  min?: number;\n  max?: number;\n  allowNull?: boolean;\n}","import { ContainerElement } from \"./container-element\";\n\nexport class Overlay extends ContainerElement {\n\n\n  public elementOverlay: HTMLElement;\n\n\n  public get clickable(): boolean {\n    return this.elementOverlay.classList.contains('clickable');\n  }\n  public set clickable(val: boolean) {\n    if (val) {\n      this.elementOverlay.classList.add('clickable');\n    } else {\n      this.elementOverlay.classList.remove('clickable');\n    }\n  }\n\n  public get rect(): ClientRect | DOMRect {\n    return this.innerElement!.getBoundingClientRect();\n  }\n\n  public get center(): boolean {\n    return this.element!.classList.contains('center');\n  }\n  public set center(val: boolean) {\n    if (val) {\n      this.element!.classList.add('center');\n      this.innerElement!.style.left = '';\n      this.innerElement!.style.top = '';\n    } else {\n      this.element!.classList.remove('center');\n    }\n  }\n\n  public get transparent(): boolean {\n    return this.element!.classList.contains('transparent');\n  }\n  public set transparent(val: boolean) {\n    if (val) {\n      this.element!.classList.add('transparent');\n    } else {\n      this.element!.classList.remove('transparent');\n    }\n  }\n\n  public constructor() {\n    super();\n\n    this.element = document.createElement('div');\n    this.element.classList.add('ui-overlay', 'center');\n\n    this.elementOverlay = document.createElement('div');\n    this.elementOverlay.ui = this;\n    this.elementOverlay.classList.add('overlay', 'clickable');\n    this.element.appendChild(this.elementOverlay);\n\n    this.elementOverlay.addEventListener('mousedown', this._onMouseDown.bind(this), false);\n\n    this.innerElement = document.createElement('div');\n    this.innerElement.classList.add('content');\n    this.element.appendChild(this.innerElement);\n\n  }\n\n  private _onMouseDown(evt: MouseEvent): void {\n    if (!this.clickable)\n      return;\n\n    let self = this;\n\n    // some field might be in focus\n    document.body.blur();\n\n    // wait till blur takes in account\n    requestAnimationFrame(function () {\n      // hide overlay\n      self.hidden = true;\n    });\n\n    evt.preventDefault();\n  }\n\n  public position(x: number, y: number): void {\n    let area = this.elementOverlay.getBoundingClientRect();\n    let rect = this.innerElement!.getBoundingClientRect();\n\n    x = Math.max(0, Math.min(area.width - rect.width, x));\n    y = Math.max(0, Math.min(area.height - rect.height, y));\n\n    this.innerElement!.style.left = x + 'px';\n    this.innerElement!.style.top = y + 'px';\n  }\n\n\n}","import { ContainerElement } from './container-element';\nimport { Element } from './element';\nimport { Label } from './label';\n\nexport class Panel extends ContainerElement {\n\n  public headerElement: Nullable<HTMLElement> = null;\n  public headerElementTitle: Nullable<HTMLElement> = null;\n  private _handleElement: Nullable<HTMLElement> = null;\n\n  private _resizeEvtMove: any;\n  private _resizeEvtEnd: any;\n  private _resizeEvtTouchMove: any;\n  private _resizeEvtTouchEnd: any;\n\n  private _resizeData: { [key: string]: number } = { end: 0 };\n  private _resizeLimits: { [key: string]: number } = {\n    min: 0,\n    max: Infinity\n  };\n  private _handle: string = '';\n  public headerSize: number = 0;\n  private _resizeTouchId: number = -100;\n\n  public title: string = '';\n\n  public _lable: Nullable<Label> = null;\n\n  public get folded(): boolean {\n    return this.class ? this.class.contains('foldable') && this.class.contains('folded') : false;\n  }\n  public set folded(val: boolean) {\n    if (this.hidden)\n      return;\n\n    if (this.class!.contains('folded') === !!val)\n      return;\n\n    if (this.headerElement && this.headerSize === 0)\n      this.headerSize = this.headerElement.clientHeight;\n\n    if (val) {\n      this.class!.add('folded');\n\n      if (this.class!.contains('foldable'))\n        this.emit('fold');\n    } else {\n      this.class!.remove('folded');\n\n      if (this.class!.contains('foldable'))\n        this.emit('unfold');\n    }\n\n    this._reflow();\n  }\n\n  public get horizontal(): boolean {\n    return this.class ? this.class.contains('horizontal') : false;\n  }\n  public set horizontal(val: boolean) {\n    if (val) {\n      this.class!.add('horizontal');\n    } else {\n      this.class!.remove('horizontal');\n    }\n    this._reflow();\n  }\n\n  public get resizable(): string {\n    return this._handle;\n  }\n  public set resizable(val: string) {\n    if (this._handle === val)\n      return;\n\n    var oldHandle = this._handle;\n    this._handle = val;\n\n    if (this._handle !== '') {\n      if (!this._handleElement) {\n        this._handleElement = document.createElement('div');\n        this._handleElement.ui = this;\n        this._handleElement.classList.add('handle');\n        this._handleElement.addEventListener('mousedown', this._resizeStart.bind(this), false);\n        this._handleElement.addEventListener('touchstart', this._resizeStart.bind(this), false);\n      }\n\n      if (this._handleElement.parentNode)\n        this.element!.removeChild(this._handleElement);\n      // TODO\n      // append in right place\n      this.element!.appendChild(this._handleElement);\n      this.class!.add('resizable', 'resizable-' + this._handle);\n    } else {\n      if (this._handleElement) this.element!.removeChild(this._handleElement);\n\n      this.class!.remove('resizable', 'resizable-' + oldHandle);\n    }\n\n    this._reflow();\n  }\n\n  public get resizeMin(): number {\n    return this._resizeLimits.min;\n  }\n  public set resizeMin(val: number) {\n    this._resizeLimits.min = Math.max(0, Math.min(this._resizeLimits.max, val));\n  }\n\n  public get resizeMax(): number {\n    return this._resizeLimits.max;\n  }\n  public set resizeMax(val: number) {\n    this._resizeLimits.max = Math.max(this._resizeLimits.min, val);\n  }\n\n  public get foldable(): boolean {\n    return this.class ? this.class.contains('foldable') : false;\n  }\n  public set foldable(val: boolean) {\n    if (val) {\n      this.class!.add('foldable');\n\n      if (this.class!.contains('folded'))\n        this.emit('fold');\n    } else {\n      this.class!.remove('foldable');\n\n      if (this.class!.contains('folded'))\n        this.emit('unfold');\n    }\n\n    this._reflow();\n  }\n\n  public get header(): string {\n    return this.headerElementTitle ? (this.headerElementTitle.textContent || '') : '';\n  }\n  public set header(val: string) {\n    if (!this.headerElement && val) {\n      this.headerElement = document.createElement('header');\n      this.headerElement.classList.add('ui-header');\n\n      this.headerElementTitle = document.createElement('span');\n      this.headerElementTitle.classList.add('title');\n      this.headerElementTitle.textContent = val;\n      this.headerElement.appendChild(this.headerElementTitle);\n\n      let first = this.element!.firstChild;\n      if (first) {\n        this.element!.insertBefore(this.headerElement, first);\n      } else {\n        this.element!.appendChild(this.headerElement);\n      }\n\n      this.class!.remove('noHeader');\n\n      let self = this;\n\n      // folding\n      this.headerElement.addEventListener('click', function (evt) {\n        if (!self.foldable || (evt.target !== self.headerElement && evt.target !== self.headerElementTitle))\n          return;\n\n        self.folded = !self.folded;\n      }, false);\n    } else if (this.headerElement && !val) {\n      if (this.headerElement.parentNode) {\n        this.headerElement.parentNode.removeChild(this.headerElement);\n      }\n      this.headerElement = null;\n      this.headerElementTitle = null;\n      this.class!.add('noHeader');\n    } else {\n      this.headerElementTitle!.textContent = val || '';\n      this.class!.remove('noHeader');\n    }\n  }\n\n  public constructor(title?: string) {\n    super();\n\n    let self = this;\n    this.element = document.createElement('div');\n    this.element.classList.add('ui-panel', 'noHeader', 'noAnimation');\n\n    // this.on('nodesChanged', this._onNodesChanged);\n\n    // content\n    this.innerElement = document.createElement('div');\n    this.innerElement.ui = this;\n    this.innerElement.classList.add('content');\n    this.element.appendChild(this.innerElement);\n\n    if (title) {\n      this.title = title;\n      this.header = title;\n    }\n\n    // this.innerElement.addEventListener('scroll', this._onScroll, false);\n\n    this._resizeEvtMove = function (evt: MouseEvent) {\n      evt.preventDefault();\n      evt.stopPropagation();\n      self._resizeMove(evt.clientX, evt.clientY);\n    };\n\n    this._resizeEvtEnd = function (evt: MouseEvent) {\n      evt.preventDefault();\n      evt.stopPropagation();\n      self._resizeEnd();\n    };\n\n    this._resizeEvtTouchMove = function (evt: TouchEvent) {\n      for (let i = 0; i < evt.changedTouches.length; i++) {\n        let touch = evt.changedTouches[i];\n\n        if (touch.identifier !== self._resizeTouchId)\n          continue;\n\n        evt.preventDefault();\n        evt.stopPropagation();\n        self._resizeMove(touch.clientX, touch.clientY);\n\n        return;\n      }\n    };\n\n    this._resizeEvtTouchEnd = function (evt: TouchEvent) {\n      for (let i = 0; i < evt.changedTouches.length; i++) {\n        let touch = evt.changedTouches[i];\n\n        if (touch.identifier !== self._resizeTouchId)\n          continue;\n\n        self._resizeTouchId = -100;\n\n        evt.preventDefault();\n        evt.stopPropagation();\n        self._resizeEnd();\n\n        return;\n      }\n    };\n\n    // HACK\n    // skip 2 frames before enabling transitions\n    requestAnimationFrame(function () {\n      requestAnimationFrame(function () {\n        self.class!.remove('noAnimation');\n      });\n    });\n\n    // on parent change\n    this.on('parent', this._onParent);\n\n\n\n  }\n\n\n\n\n  private _resizeMove(x: number, y: number): void {\n    if (this._resizeData.end === 0) {\n      this._resizeData = {\n        x: x,\n        y: y,\n        width: this.innerElement!.clientWidth,\n        height: this.innerElement!.clientHeight,\n        end: 1\n      };\n    } else {\n      if (this._handle === 'left' || this._handle === 'right') {\n        // horizontal\n        let offsetX = this._resizeData.x - x;\n\n        if (this._handle === 'right')\n          offsetX = -offsetX;\n\n        let width = Math.max(this._resizeLimits.min, Math.min(this._resizeLimits.max, (this._resizeData.width + offsetX)));\n\n        this.style!.width = (width + 4) + 'px';\n        this.innerElement!.style.width = (width + 4) + 'px';\n      } else {\n        // vertical\n        let offsetY = this._resizeData.y - y;\n\n        if (this._handle === 'bottom')\n          offsetY = -offsetY;\n\n        let height = Math.max(this._resizeLimits.min, Math.min(this._resizeLimits.max, (this._resizeData.height + offsetY)));\n\n        this.style!.height = (height + (this.headerSize === -1 ? 0 : this.headerSize || 32)) + 'px';\n        this.innerElement!.style.height = height + 'px';\n      }\n    }\n\n    this.emit('resize');\n  };\n\n  private _resizeEnd(): void {\n    window.removeEventListener('mousemove', this._resizeEvtMove, false);\n    window.removeEventListener('mouseup', this._resizeEvtEnd, false);\n\n    // window.removeEventListener('touchmove', this._resizeEvtTouchMove, false);\n    // window.removeEventListener('touchend', this._resizeEvtTouchEnd, false);\n\n    this.class!.remove('noAnimation', 'resizing');\n    this._resizeData.end = 0;\n  };\n\n  private _resizeStart(evt: Event): void {\n    if (this._handle === '')\n      return;\n    if ((<TouchEvent>evt).changedTouches) {\n      for (let i = 0; i < (<TouchEvent>evt).changedTouches.length; i++) {\n        let touch = (<TouchEvent>evt).changedTouches[i];\n        if (<HTMLElement>touch.target !== this.element)\n          continue;\n\n        this._resizeTouchId = touch.identifier;\n      }\n    }\n\n    this.class!.add('noAnimation', 'resizing');\n    this._resizeData.end = 0;\n\n    window.addEventListener('mousemove', this._resizeEvtMove, false);\n    window.addEventListener('mouseup', this._resizeEvtEnd, false);\n\n    window.addEventListener('touchmove', this._resizeEvtTouchMove, false);\n    window.addEventListener('touchend', this._resizeEvtTouchEnd, false);\n\n    evt.preventDefault();\n    evt.stopPropagation();\n  };\n\n  private _onParent(): void {\n    // HACK\n    // wait till DOM parses, then reflow\n    requestAnimationFrame(this._reflow.bind(this));\n  };\n\n  private _reflow(): void {\n    if (this.hidden)\n      return;\n\n    if (this.folded) {\n      if (this.horizontal) {\n        this.style!.height = '';\n        this.style!.width = (this.headerSize || 32) + 'px';\n      } else {\n        this.style!.height = (this.headerSize || 32) + 'px';\n      }\n    } else if (this.foldable) {\n      if (this.horizontal) {\n        this.style!.height = '';\n        this.style!.width = this.innerElement!.clientWidth + 'px';\n      } else {\n        this.style!.height = ((this.headerSize || 32) + this.innerElement!.clientHeight) + 'px';\n      }\n    }\n  };\n\n  private _onNodesChanged(): void {\n    if (!this.foldable || this.folded || this.horizontal || this.hidden)\n      return;\n\n    this.style!.height = (Math.max(0, (this.headerSize || 32)) + this.innerElement!.clientHeight) + 'px';\n  };\n\n  public headerAppend(element: HTMLElement | Element): void {\n    if (!this.headerElement)\n      return;\n\n    let html: boolean = (element instanceof HTMLElement);\n    let node: HTMLElement = html ? <HTMLElement>element : (<Element>element).element!;\n\n    this.headerElement.insertBefore(node, this.headerElementTitle);\n\n    if (!html)\n      (<Element>element).parent = this;\n  };\n\n  // TODO\n  private _onScroll(evt: any) {\n    this.emit('scroll', evt);\n  };\n\n}","import { Element } from \"./element\";\n\nexport class Progress extends Element {\n\n\n  private _progress: number;\n  private _targetProgress: number;\n  private _lastProgress: number;\n  private _speed: number;\n\n  private _inner: HTMLElement;\n\n  private _now: number;\n  private _animating: boolean;\n  private _failed: boolean;\n\n  public get progress(): number {\n    return this._progress;\n  }\n  public set progress(val: number) {\n    let self = this;\n\n    val = Math.max(0, Math.min(1, val));\n\n    if (this._targetProgress === val)\n      return;\n\n    this._targetProgress = val;\n\n    if (this._speed === 0 || this._speed === 1) {\n      this._progress = this._targetProgress;\n      this._inner.style.width = (this._progress * 100) + '%';\n\n      let progress: number = Math.max(0, Math.min(100, Math.round(this._progress * 100)));\n      if (progress !== this._lastProgress) {\n        this._lastProgress = progress;\n        this.emit('progress:' + progress);\n        this.emit('progress', progress);\n      }\n    } else if (!this._animating) {\n      requestAnimationFrame(function () {\n        self._animate();\n      });\n    }\n  }\n\n\n  public get speed(): number {\n    return this._speed;\n  }\n  public set speed(val: number) {\n    this._speed = Math.max(0, Math.min(1, val));\n  }\n\n  public get failed(): boolean {\n    return this._failed;\n  }\n  public set failed(val: boolean) {\n    this._failed = val;\n    if (this._failed) {\n      this.class!.add('failed');\n    } else {\n      this.class!.remove('failed');\n    }\n  }\n\n\n  public constructor(progress?: number, speed?: number) {\n    super();\n\n    this._progress = progress ? Math.max(0, Math.min(1, progress)) : 0;\n    this._targetProgress = this._progress;\n    this._lastProgress = Math.floor(this._progress * 100);\n\n    this.element = document.createElement('div');\n    this.element.classList.add('ui-progress');\n\n    this._inner = document.createElement('div');\n    this._inner.classList.add('inner');\n    this._inner.style.width = (this._progress * 100) + '%';\n    this.element.appendChild(this._inner);\n\n    this._speed = speed || 1;\n\n    this._now = Date.now();\n    this._animating = false;\n \n    this._failed = false;\n\n  }\n\n  /**\n   *  websocket link -> best way;\n   *  information format -> many kinds of information to be transformed;\n   * \n   *  think about the process:\n   *     1. access permission check;\n   *     2. a data structure of scene detail;\n   *     3. a data structure for assets detail;\n   *     4. keep the original file no change so there will be only one source file;\n   *     5. link to any information;\n   * \n   * \n   * \n\n   *  \n   */\n  private _animate(): void {\n    let self = this;\n\n    if (Math.abs(this._targetProgress - this._progress) < 0.01) {\n      this._progress = this._targetProgress;\n      this._animating = false;\n    } else {\n      if (!this._animating) {\n        this._now = Date.now() - (1000 / 60);\n        this._animating = true;\n      }\n      requestAnimationFrame(function () {\n        self._animate();\n      });\n\n      let dt: number = Math.max(0.1, Math.min(3, (Date.now() - this._now) / (1000 / 60)));\n      this._now = Date.now();\n      this._progress = this._progress + (this._targetProgress - this._progress) * (this._speed * dt);\n    }\n\n    let progress: number = Math.max(0, Math.min(100, Math.round(this._progress * 100)));\n    if (progress !== this._lastProgress) {\n      this._lastProgress = progress;\n      this.emit('progress:' + progress);\n      this.emit('progress', progress);\n    }\n\n    this._inner.style.width = (this._progress * 100) + '%';\n  }\n\n\n}","import { Element } from \"./element\"\n\n// 下拉选择列表\nexport class SelectField extends Element {\n\n\n    public elementValue: HTMLElement;\n    public elementOptions: HTMLElement;\n\n    public options: any;\n    public optionsKeys: string[];\n\n    private _oldValue: any;\n    private _value: any;\n    private _type: string;\n    private _optionClassNamePrefix: string;\n    private timerClickAway: any;\n    private evtTouchId: number;\n    private evtTouchSecond: boolean;\n    private evtMouseDist: number[] = [0, 0];\n\n    public optionElements: { [key: string]: HTMLElement };\n\n\n    public get value(): any {\n        if (this._link) {\n            return this._link.get(this.path);\n        } else {\n            return this._value;\n        }\n    }\n    public set value(raw: any) {\n        var value = this.valueToType(raw);\n\n        if (this._link) {\n            this._oldValue = this._value;\n            this.emit('change:before', value);\n            this._link.set(this.path, value);\n        } else {\n            if ((value === null || value === undefined || raw === '') && this.optionElements[''])\n                value = '';\n\n            if (this._oldValue === value) return;\n            if (value !== null && this.options[value] === undefined) return;\n\n            // deselect old one\n            if (this.optionElements[this._oldValue])\n                this.optionElements[this._oldValue].classList.remove('selected');\n\n            this._value = value;\n            if (value !== '')\n                this._value = this.valueToType(this._value);\n\n            this.emit('change:before', this._value);\n            this._oldValue = this._value;\n            if (this.options[this._value]) {\n                this.elementValue.textContent = this.options[this._value];\n                // console.warn(this._value);\n                this.optionElements[this._value].classList.add('selected');\n            } else {\n                this.elementValue.textContent = '';\n            }\n            this.emit('change', this._value);\n        }\n    }\n\n    public get placeholder(): string {\n        return this.elementValue.getAttribute('placeholder') || '';\n    }\n    public set placeholder(val: string) {\n        if (!val) {\n            this.elementValue.removeAttribute('placeholder');\n        } else {\n            this.elementValue.setAttribute('placeholder', val);\n        }\n    }\n\n    public constructor(args: any) {\n        super();\n\n        // let self = this;\n\n        args = args || {};\n        this.options = args.options || {};\n        this.optionsKeys = [];\n\n        if (this.options instanceof Array) {\n            var options: any = {};\n            for (var i = 0; i < this.options.length; i++) {\n                this.optionsKeys.push(this.options[i].v);\n                options[this.options[i].v] = this.options[i].t;\n            }\n            this.options = options;\n        } else {\n            this.optionsKeys = Object.keys(this.options);\n        }\n\n        this.element = document.createElement('div');\n        this.element.tabIndex = 0;\n        this.element.classList.add('ui-select-field', 'noSelect');\n\n        this.elementValue = document.createElement('div');\n        this.elementValue.ui = this;\n        this.elementValue.classList.add('value');\n        this.element.appendChild(this.elementValue);\n\n        this._oldValue = null;\n        this._value = null;\n        this._type = args.type || 'string';\n\n        this._optionClassNamePrefix = args.optionClassNamePrefix || '';\n\n        this.timerClickAway = null;\n        this.evtTouchId = -9;\n        this.evtTouchSecond = false;\n        this.evtMouseDist = [0, 0];\n\n        this.elementValue.addEventListener('mousedown', this._onMouseDown.bind(this), false);\n        this.elementValue.addEventListener('touchstart', this._onTouchStart.bind(this), false);\n\n        this.elementOptions = document.createElement('ul');\n        this.element.appendChild(this.elementOptions);\n\n\n        this.optionElements = {};\n\n        if (args.default !== undefined && this.options[args.default] !== undefined) {\n            this._value = this.valueToType(args.default);\n            this._oldValue = this._value;\n        }\n\n        this.on('link', this._onLink);\n        this._updateOptions();\n\n        this.on('change', this._onChange.bind(this));\n\n        // arrows - change\n        this.element.addEventListener('keydown', this._onKeyDown.bind(this), false);\n\n        if (args.placeholder)\n            this.placeholder = args.placeholder;\n    }\n\n\n    private _onHoldSelect(target: HTMLElement, x: number, y: number, evt: TouchEvent | MouseEvent) {\n        if (target && target.uiElement && target.uiElement === this && target.classList.contains('selected'))\n            return;\n        if ((Math.abs(x - this.evtMouseDist[0]) + Math.abs(y - this.evtMouseDist[1])) < 8)\n            return;\n        if (target && target.uiElement && target.uiElement === this && evt !== undefined) {\n            this._onOptionSelect(evt);\n        }\n        // console.log(target.textContent);\n        this.close(target.textContent!);\n    };\n\n    private _onMouseDown(evt: MouseEvent): void {\n        if (this.disabled && !this.disabledClick)\n            return;\n\n        if (this.element!.classList.contains('active')) {\n            this.close();\n        } else {\n            evt.preventDefault();\n            evt.stopPropagation();\n            this.evtMouseDist[0] = evt.pageX;\n            this.evtMouseDist[1] = evt.pageY;\n            this.element!.focus();\n            this.open();\n            window.addEventListener('mouseup', this.evtMouseUp.bind(this));\n        }\n    };\n\n    private _onTouchStart(evt: TouchEvent): void {\n        if (this.disabled && !this.disabledClick)\n            return;\n\n        if (this.element!.classList.contains('active')) {\n            this.close();\n        } else {\n            evt.preventDefault();\n            evt.stopPropagation();\n\n            var touch;\n\n            for (var i = 0; i < evt.changedTouches.length; i++) {\n                if ((<HTMLElement>(evt.changedTouches[i].target)).uiElement !== this)\n                    continue;\n\n                touch = evt.changedTouches[i];\n\n                break;\n            }\n\n            if (!touch) return;\n\n            this.evtTouchId = touch.identifier;\n            this.evtMouseDist[0] = touch.pageX;\n            this.evtMouseDist[1] = touch.pageY;\n            this.element!.focus();\n            this.open();\n            window.addEventListener('touchend', this.evtTouchEnd.bind(this));\n        }\n    };\n\n    private _onLink(path: string): void {\n        if (this._link!.schema && this._link!.schema.has(path)) {\n            var field = this._link!.schema.get(path);\n            var options = field.options || {};\n            this._updateOptions(options);\n        }\n    };\n\n    private _onChange(): void {\n        if (!this.renderChanges)\n            return;\n\n        this.flash();\n    };\n\n    private _onKeyDown(evt: KeyboardEvent): void {\n        if (evt.keyCode === 27) {\n            this.close();\n            (<HTMLElement>evt.target).blur();\n            return;\n        }\n\n        if ((this.disabled && !this.disabledClick) || [38, 40].indexOf(evt.keyCode) === -1)\n            return;\n\n        evt.stopPropagation();\n        evt.preventDefault();\n\n        var keys = Object.keys(this.options);\n        var ind = keys.indexOf(this.value !== undefined ? this.value.toString() : null);\n\n        var y = evt.keyCode === 38 ? -1 : 1;\n\n        // already first item\n        if (y === -1 && ind <= 0)\n            return;\n\n        // already last item\n        if (y === 1 && ind === (keys.length - 1))\n            return\n\n        // set new item\n        this.value = keys[ind + y];\n    };\n\n    private valueToType(value: any): any {\n        switch (this._type) {\n            case 'boolean':\n                return !!value;\n                break;\n            case 'number':\n                return parseInt(value, 10);\n                break;\n            case 'string':\n                return '' + value;\n                break;\n        }\n    };\n\n\n\n\n    private evtMouseUp(evt: MouseEvent): void {\n        evt.preventDefault();\n        evt.stopPropagation();\n        this._onHoldSelect(<HTMLElement>evt.target, evt.pageX, evt.pageY, evt);\n    };\n\n    private evtTouchEnd(evt: TouchEvent): void {\n        for (var i = 0; i < evt.changedTouches.length; i++) {\n            var touch = evt.changedTouches[i];\n            if (touch.identifier !== this.evtTouchId)\n                continue;\n\n            this.evtTouchId = -9;\n\n            evt.preventDefault();\n            evt.stopPropagation();\n\n            var target = document.elementFromPoint(touch.pageX, touch.pageY);\n\n            this._onHoldSelect(<HTMLElement>target, touch.pageX, touch.pageY, evt);\n        }\n\n        if (this.evtTouchSecond) {\n            evt.preventDefault();\n            evt.stopPropagation();\n            self.close();\n        } else if (this.element!.classList.contains('active')) {\n            this.evtTouchSecond = true;\n        }\n    };\n\n\n    private open(): void {\n        if ((this.disabled && !this.disabledClick) || this.element!.classList.contains('active'))\n            return;\n\n        this.element!.classList.add('active');\n\n        var rect = this.element!.getBoundingClientRect();\n\n        // left\n        var left = Math.round(rect.left) + ((Math.round(rect.width) - this.element!.clientWidth) / 2);\n\n        // top\n        var top = rect.top;\n        if (this.optionElements[this._value]) {\n            top -= this.optionElements[this._value].offsetTop;\n            top += (Math.round(rect.height) - this.optionElements[this._value].clientHeight) / 2;\n            top = rect.top + rect.height + 3;\n        }\n\n        // limit to bottom / top of screen\n        if (top + this.elementOptions.clientHeight > window.innerHeight) {\n            top = window.innerHeight - this.elementOptions.clientHeight + 1;\n        } else if (top < 0) {\n            top = 0;\n        }\n\n        // top \n        this.elementOptions.style.top = Math.max(0, top) + 'px';\n        // left\n        this.elementOptions.style.left = left + 'px';\n        // right\n        this.elementOptions.style.width = Math.round(this.element!.clientWidth) + 'px';\n        // bottom\n        if (top <= 0 && this.elementOptions.offsetHeight >= window.innerHeight) {\n            this.elementOptions.style.bottom = '0';\n            this.elementOptions.style.height = 'auto';\n\n            // scroll to item\n            if (this.optionElements[this._value]) {\n                var off = this.optionElements[this._value].offsetTop - rect.top;\n                this.elementOptions.scrollTop = off;\n            }\n        } else {\n            this.elementOptions.style.bottom = '';\n            this.elementOptions.style.height = '';\n        }\n\n        var self = this;\n        this.timerClickAway = setTimeout(function () {\n            var looseActive = function () {\n                self.element!.classList.remove('active');\n                self.element!.blur();\n                window.removeEventListener('click', looseActive);\n            };\n\n            window.addEventListener('click', looseActive);\n        }, 300);\n\n        this.emit('open');\n    };\n\n\n    private close(title: string = ''): void {\n        if ((this.disabled && !this.disabledClick) || !this.element!.classList.contains('active'))\n            return;\n\n        window.removeEventListener('mouseup', this.evtMouseUp.bind(this));\n        window.removeEventListener('touchend', this.evtTouchEnd.bind(this));\n\n        if (this.timerClickAway) {\n            clearTimeout(this.timerClickAway);\n            this.timerClickAway = null;\n        }\n\n        this.element!.classList.remove('active');\n\n        this.elementOptions.style.top = '';\n        this.elementOptions.style.right = '';\n        this.elementOptions.style.bottom = '';\n        this.elementOptions.style.left = '';\n        this.elementOptions.style.width = '';\n        this.elementOptions.style.height = '';\n\n        this.emit('close', title);\n\n        this.evtTouchSecond = false;\n    };\n\n    private toggle(): void {\n        if (this.element!.classList.contains('active')) {\n            this.close();\n        } else {\n            this.open();\n        }\n    };\n\n    public _updateOptions(options?: any) {\n        if (options !== undefined) {\n            if (options instanceof Array) {\n                this.options = {};\n                this.optionsKeys = [];\n                for (var i = 0; i < options.length; i++) {\n                    this.optionsKeys.push(options[i].v);\n                    this.options[options[i].v] = options[i].t;\n                }\n            } else {\n                this.options = options;\n                this.optionsKeys = Object.keys(options);\n            }\n        }\n\n        this.optionElements = {};\n        this.elementOptions.innerHTML = '';\n\n        for (var i = 0; i < this.optionsKeys.length; i++) {\n            if (!this.options.hasOwnProperty(this.optionsKeys[i]))\n                continue;\n\n            // 用|分隔，前面是name，后面是class\n            let infos = this.options[this.optionsKeys[i]].split('|');\n            this.options[this.optionsKeys[i]] = infos[0];\n\n            var element = document.createElement('li');\n            element.textContent = infos[0];\n            element.uiElement = this;\n            element.uiValue = this.optionsKeys[i];\n            element.addEventListener('touchstart', this._onOptionSelect.bind(this));\n            element.addEventListener('mouseover', this._onOptionHover.bind(this));\n            element.addEventListener('mouseout', this._onOptionOut.bind(this));\n\n            if (this._optionClassNamePrefix && infos.length > 1) {\n                element.classList.add(this._optionClassNamePrefix + '-' + infos[1].toLowerCase());\n            }\n\n            this.elementOptions.appendChild(element);\n            // console.log(this.optionsKeys[i]);\n            this.optionElements[this.optionsKeys[i]] = element;\n        }\n    };\n\n    private _onOptionSelect(evt: TouchEvent | MouseEvent): void {\n        this.value = (<HTMLElement>evt.target).uiValue;\n    };\n\n    private _onOptionHover(): void {\n        this.element!.classList.add('hover');\n    };\n\n    private _onOptionOut(): void {\n        this.element!.classList.remove('hover');\n    };\n\n    public _onLinkChange(value: any) {\n        if (this.optionElements[value] === undefined)\n            return;\n\n        if (this.optionElements[this._oldValue]) {\n            this.optionElements[this._oldValue].classList.remove('selected');\n        }\n\n        this._value = this.valueToType(value);\n        this.elementValue.textContent = this.options[value];\n        this.optionElements[value].classList.add('selected');\n        this.emit('change', value);\n    };\n\n\n}","import { Element } from \"./element\";\n\nexport class Slider extends Element {\n\n    private _value: number;\n    private _lastValue: number;\n    public precision: number;\n\n    public elementBar: HTMLElement;\n    public elementHandle: HTMLElement;\n    public evtTouchId: any;\n\n    private _min: number;\n    public get min(): number {\n        return this._min;\n    }\n    public set min(val: number) {\n        if (this._min === val)\n            return;\n\n        this._min = val;\n        this._updateHandle(this._value);\n    }\n\n    private _max: number;\n    public get max(): number {\n        return this._max;\n    }\n    public set max(val: number) {\n        if (this._max === val)\n            return;\n\n        this._max = val;\n        this._updateHandle(this._value);\n    }\n\n    public get value(): number {\n        if (this._link) {\n            return this._link.get(this.path);\n        } else {\n            return this._value;\n        }\n    }\n    public set value(val: number) {\n        if (this._link) {\n            if (!this._link.set(this.path, val))\n                this._updateHandle(this._link.get(this.path));\n        } else {\n            if (this._max !== null && this._max < val)\n                val = this._max;\n\n            if (this._min !== null && this._min > val)\n                val = this._min;\n\n            // TODO\n            if (val === null) {\n                this.class!.add('null');\n            } else {\n                if (typeof val !== 'number')\n                    val = 0;\n\n                val = (val !== undefined && this.precision !== null) ? parseFloat(val.toFixed(this.precision)) : val;\n                this.class!.remove('null');\n            }\n\n            this._updateHandle(val);\n            this._value = val;\n\n            if (this._lastValue !== val) {\n                this._lastValue = val;\n                this.emit('change', val);\n            }\n        }\n    }\n\n    private evtMouseMove: any;\n    private evtMouseUp: any;\n    private evtTouchMove: any;\n    private evtTouchEnd: any;\n\n    public constructor(args?: SliderArgs) {\n        super();\n\n        let self = this;\n        args = args || {};\n        this._value = 0;\n        this._lastValue = 0;\n\n        this.precision = (args.precision === undefined) ? 2 : args.precision;\n        this._min = (args.min === undefined) ? 0 : args.min;\n        this._max = (args.max === undefined) ? 1 : args.max;\n\n        this.element = document.createElement('div');\n        this.element.classList.add('ui-slider');\n\n        this.elementBar = document.createElement('div');\n        this.elementBar.ui = this;\n        this.elementBar.classList.add('bar');\n        this.element.appendChild(this.elementBar);\n\n        this.elementHandle = document.createElement('div');\n        this.elementHandle.ui = this;\n        this.elementHandle.tabIndex = 0;\n        this.elementHandle.classList.add('handle');\n        this.elementBar.appendChild(this.elementHandle);\n\n        this.element.addEventListener('mousedown', self._onMouseDown.bind(self), false);\n        this.element.addEventListener('touchstart', self._onTouchStart.bind(self), false);\n\n        this.evtTouchId = null;\n\n        this.on('change', this._onChange);\n\n        // arrows - change\n        this.element.addEventListener('keydown', self._onKeyDown.bind(self), false);\n\n        self.evtMouseMove = (evt: MouseEvent) => {\n            evt.stopPropagation();\n            evt.preventDefault();\n\n            self._onSlideMove(evt.pageX);\n        };\n\n        self.evtMouseUp = (evt: MouseEvent) => {\n            evt.stopPropagation();\n            evt.preventDefault();\n\n            this._onSlideEnd(evt.pageX);\n        };\n\n        self.evtTouchMove = (evt: TouchEvent) => {\n            for (let i = 0; i < evt.changedTouches.length; i++) {\n                let touch = evt.changedTouches[i];\n\n                if (touch.identifier !== this.evtTouchId)\n                    continue;\n\n                evt.stopPropagation();\n                evt.preventDefault();\n\n                this._onSlideMove(touch.pageX);\n                break;\n            }\n        };\n\n        self.evtTouchEnd = (evt: TouchEvent) => {\n            for (let i = 0; i < evt.changedTouches.length; i++) {\n                let touch = evt.changedTouches[i];\n\n                if (touch.identifier !== this.evtTouchId)\n                    continue;\n\n                evt.stopPropagation();\n                evt.preventDefault();\n\n                this._onSlideEnd(touch.pageX);\n                this.evtTouchId = null;\n                break;\n            }\n        };\n\n    }\n\n\n\n\n    private _onChange() {\n        if (!this.renderChanges)\n            return;\n\n        this.flash();\n    };\n\n    private _onKeyDown(evt: KeyboardEvent) {\n        if (evt.keyCode === 27)\n            return this.elementHandle.blur();\n\n        if (this.disabled || [37, 39].indexOf(evt.keyCode) === -1)\n            return;\n\n        evt.stopPropagation();\n        evt.preventDefault();\n\n        let x = evt.keyCode === 37 ? -1 : 1;\n\n        if (evt.shiftKey)\n            x *= 10;\n\n        let rect = this.element!.getBoundingClientRect();\n        let step = (this._max - this._min) / rect.width;\n        let value = Math.max(this._min, Math.min(this._max, this.value + x * step));\n        value = parseFloat(value.toFixed(this.precision));\n\n        this.renderChanges = false;\n        this._updateHandle(value);\n        this.value = value;\n        this.renderChanges = true;\n    };\n\n    public _onLinkChange(value: number) {\n        this._updateHandle(value);\n        this._value = value;\n        this.emit('change', value || 0);\n    };\n\n    private _updateHandle(value: number) {\n        this.elementHandle.style.left = (Math.max(0, Math.min(1, ((value || 0) - this._min) / (this._max - this._min))) * 100) + '%';\n    };\n\n    private _onMouseDown(evt: MouseEvent) {\n        if (evt.button !== 0 || this.disabled)\n            return;\n\n        this._onSlideStart(evt.pageX);\n    };\n\n    private _onTouchStart(evt: TouchEvent) {\n        if (this.disabled)\n            return;\n\n        for (let i = 0; i < evt.changedTouches.length; i++) {\n            let touch = evt.changedTouches[i];\n            if (!(<HTMLElement>(touch.target)).ui || (<HTMLElement>(touch.target)).ui !== this)\n                continue;\n\n            this.evtTouchId = touch.identifier;\n            this._onSlideStart(touch.pageX);\n            break;\n        }\n    };\n\n    private _onSlideStart(pageX: number) {\n        this.elementHandle.focus();\n\n        this.renderChanges = false;\n\n        if (this.evtTouchId === null) {\n            window.addEventListener('mousemove', this.evtMouseMove, false);\n            window.addEventListener('mouseup', this.evtMouseUp, false);\n        } else {\n            window.addEventListener('touchmove', this.evtTouchMove, false);\n            window.addEventListener('touchend', this.evtTouchEnd, false);\n        }\n\n        this.class!.add('active');\n\n        this.emit('start', this.value);\n\n        this._onSlideMove(pageX);\n\n        if (this._link && this._link.history)\n            this._link.history.combine = true;\n    };\n\n    private _onSlideMove(pageX: number) {\n        let rect = this.element!.getBoundingClientRect();\n        let x = Math.max(0, Math.min(1, (pageX - rect.left) / rect.width));\n\n        let range = this._max - this._min;\n        let value = (x * range) + this._min;\n        value = parseFloat(value.toFixed(this.precision));\n\n        this._updateHandle(value);\n        this.value = value;\n    };\n\n    private _onSlideEnd(pageX: number) {\n        this._onSlideMove(pageX);\n\n        this.renderChanges = true;\n\n        this.class!.remove('active');\n\n        if (this.evtTouchId === null) {\n            window.removeEventListener('mousemove', this.evtMouseMove);\n            window.removeEventListener('mouseup', this.evtMouseUp);\n        } else {\n            console.log(this.evtTouchId);\n            window.removeEventListener('touchmove', this.evtTouchMove);\n            window.removeEventListener('touchend', this.evtTouchEnd);\n        }\n\n        if (this._link && this._link.history)\n            this._link.history.combine = false;\n\n        this.emit('end', this.value);\n    };\n\n\n\n\n}\n\n\nexport interface SliderArgs {\n    precision?: number;\n    min?: number;\n    max?: number;\n}","import { Element } from \"./element\";\nimport { TopElement } from \"./top\";\n\nexport class TextField extends Element {\n\n    public elementInput: HTMLInputElement;\n\n    public evtKeyChange: boolean;\n    public ignoreChange: boolean;\n    public blurOnEnter: boolean;\n    public refocusable: boolean;\n\n\n    public get value(): string {\n        if (this._link) {\n            return this._link.get(this.path);\n        } else {\n            return this.elementInput.value;\n        }\n    }\n    public set value(val: string) {\n        if (this._link) {\n            // TODO\n            // if (!this._link.set(this.path, value)) {\n            //   this.elementInput.value = this._link.get(this.path);\n            // }\n        } else {\n            if (this.elementInput.value === val)\n                return;\n\n            this.elementInput.value = val || '';\n            this.emit('change', val);\n        }\n    }\n\n\n    public get placeholder(): string {\n        return this.element!.getAttribute('placeholder') || '';\n    }\n    public set placeholder(val: string) {\n        if (!val) {\n            this.element!.removeAttribute('placeholder');\n        } else {\n            this.element!.setAttribute('placeholder', val);\n        }\n    }\n\n    public get proxy(): string {\n        return this.element!.getAttribute('proxy') || '';\n    }\n    public set proxy(val: string) {\n        if (!val) {\n            this.element!.removeAttribute('proxy');\n        } else {\n            this.element!.setAttribute('proxy', val);\n        }\n    }\n\n    public get keyChange(): boolean {\n        return this.evtKeyChange;\n    }\n    public set keyChange(val: boolean) {\n        if (this.evtKeyChange === !!val)\n            return;\n\n        if (val) {\n            this.elementInput.addEventListener('keyup', this._onChange.bind(this), false);\n        } else {\n            this.elementInput.removeEventListener('keyup', this._onChange.bind(this));\n        }\n    }\n\n\n    public constructor(placeholder?: string, value?: string) {\n        super();\n\n        this.element = document.createElement('div');\n        this.element.classList.add('ui-text-field');\n\n        this.elementInput = document.createElement('input');\n        this.elementInput.ui = this;\n        this.elementInput.classList.add('field');\n        this.elementInput.type = 'text';\n        this.elementInput.tabIndex = 0;\n        this.elementInput.addEventListener('focus', this._onInputFocus.bind(this), false);\n        this.elementInput.addEventListener('blur', this._onInputBlur.bind(this), false);\n        this.element.appendChild(this.elementInput);\n\n        if (value !== undefined)\n            this.value = value;\n\n        this.elementInput.addEventListener('change', this._onChange.bind(this), false);\n        this.elementInput.addEventListener('keydown', this._onKeyDown.bind(this), false);\n\n        this.elementInput.addEventListener('click', this._onClick.bind(this), false);\n        this.elementInput.addEventListener('contextmenu', this._onFullSelect.bind(this), false);\n        this.evtKeyChange = false;\n        this.ignoreChange = false;\n\n        this.blurOnEnter = true;\n        this.refocusable = true;\n\n        this.on('disable', this._onDisable);\n        this.on('enable', this._onEnable);\n        this.on('change', this._onChangeField);\n\n        if (placeholder)\n            this.placeholder = placeholder;\n\n    }\n\n    public _onLinkChange(value: string): void {\n        this.elementInput.value = value;\n        this.emit('change', value);\n    }\n\n    private _onChange(): void {\n        if (this.ignoreChange) return;\n\n        this.value = this.value || '';\n\n        if (!this._link)\n            this.emit('change', this.value);\n    }\n\n    private _onClick(evt: MouseEvent): void {\n        // console.log('click');\n        // this.elementInput.blur();\n        // this.elementInput.focus();\n    }\n\n    private _onKeyDown(evt: KeyboardEvent) {\n        if (evt.keyCode === 27) {\n            // console.warn(evt.key);\n            (<HTMLInputElement>evt.target).blur();\n        } else if (this.blurOnEnter && evt.keyCode === 13) {\n            let focused: boolean = false;\n\n            let parent: Nullable<Element> | Nullable<TopElement> = this.parent;\n            while (parent) {\n                if (parent.element && parent.element.focus) {\n                    parent.element.focus();\n                    focused = true;\n                    break;\n                }\n                parent = parent.parent;\n            }\n            if (!focused)\n                (<HTMLElement>evt.target).blur();\n        }\n    }\n\n    private _onFullSelect(): void {\n        this.elementInput.select();\n    }\n\n    public focus(select?: boolean): void {\n        this.elementInput.focus();\n        if (select) this.elementInput.select();\n    }\n\n    private _onInputFocus(): void {\n        this.class!.add('focus');\n        this.emit('input:focus');\n    }\n\n    private _onInputBlur(): void {\n        this.class!.remove('focus');\n        this.emit('input:blur');\n    }\n\n    private _onDisable(): void {\n        this.elementInput.readOnly = true;\n    }\n\n    private _onEnable(): void {\n        this.elementInput.readOnly = false;\n    }\n\n    private _onChangeField(): void {\n        if (!this.renderChanges)\n            return;\n\n        this.flash();\n    }\n\n}","import { Element } from \"./element\";\nimport { TopElement } from \"./top\";\n\nexport class TextAreaField extends Element {\n\n  public elementInput: HTMLTextAreaElement;\n  public evtKeyChange: boolean;\n  public ignoreChange: boolean;\n  public blurOnEnter: boolean;\n  public refocusable: boolean;\n\n  public get value(): string {\n    if (this._link) {\n      return this._link.get(this.path);\n    } else {\n      return this.elementInput.value;\n    }\n  }\n  public set value(val: string) {\n    if (this._link) {\n      // TODO\n      // if (!this._link.set(this.path, value)) {\n      //   this.elementInput.value = this._link.get(this.path);\n      // }\n\n      this._link.set(this.path, val);\n      this.elementInput.value = this._link.get(this.path);\n    } else {\n      if (this.elementInput.value === val)\n        return;\n\n      this.elementInput.value = val || '';\n      this.emit('change', val);\n    }\n  }\n\n  public get placeholder(): string {\n    return this.element!.getAttribute('placeholder') || '';\n  }\n  public set placeholder(val: string) {\n    if (!val) {\n      this.element!.removeAttribute('placeholder');\n    } else {\n      this.element!.setAttribute('placeholder', val);\n    }\n  }\n\n  public get keyChange(): boolean {\n    return this.evtKeyChange;\n  }\n  public set keyChange(val: boolean) {\n    if (this.evtKeyChange === !!val)\n      return;\n\n    if (val) {\n      this.elementInput.addEventListener('keyup', this._onChange.bind(this), false);\n    } else {\n      this.elementInput.removeEventListener('keyup', this._onChange.bind(this));\n    }\n  }\n\n  public get proxy(): string {\n    return this.element!.getAttribute('proxy') || '';\n  }\n  public set proxy(val: string) {\n    if (!val) {\n      this.element!.removeAttribute('proxy');\n    } else {\n      this.element!.setAttribute('proxy', val);\n    }\n  }\n\n  public constructor(placeholder?: string, value?: string, blurOnEnter?: boolean) {\n    super();\n\n    this.element = document.createElement('div');\n    this.element.classList.add('ui-textarea-field');\n\n    this.elementInput = document.createElement('textarea');\n    this.elementInput.ui = this;\n    this.elementInput.classList.add('field');\n    this.elementInput.tabIndex = 0;\n    this.elementInput.addEventListener('focus', this._onInputFocus.bind(this), false);\n    this.elementInput.addEventListener('blur', this._onInputBlur.bind(this), false);\n    this.element.appendChild(this.elementInput);\n\n    if (value !== undefined)\n      this.value = value;\n\n    this.elementInput.addEventListener('change', this._onChange.bind(this), false);\n    this.elementInput.addEventListener('keydown', this._onKeyDown.bind(this), false);\n    this.elementInput.addEventListener('contextmenu', this._onFullSelect.bind(this), false);\n    this.evtKeyChange = false;\n    this.ignoreChange = false;\n\n    this.blurOnEnter = blurOnEnter !== undefined ? blurOnEnter : true;\n    this.refocusable = true;\n\n    this.on('disable', this._onDisable);\n    this.on('enable', this._onEnable);\n    this.on('change', this._onChangeField);\n\n    if (placeholder)\n      this.placeholder = placeholder;\n\n  }\n\n  private _onChange(): void {\n    if (this.ignoreChange) return;\n\n    this.value = this.value || '';\n\n    if (!this._link)\n      this.emit('change', this.value);\n  }\n\n  private _onKeyDown(evt: KeyboardEvent): void {\n    if (evt.keyCode === 27) {\n      (<HTMLElement>evt.target).blur();\n    } else if (this.blurOnEnter && evt.keyCode === 13 && !evt.shiftKey) {\n      let focused: boolean = false;\n\n      let parent: Nullable<Element> | Nullable<TopElement> = this.parent;\n      while (parent) {\n        if (parent.element && parent.element.focus) {\n          parent.element.focus();\n          focused = true;\n          break;\n        }\n        parent = parent.parent;\n      }\n\n      if (!focused)\n        (<HTMLElement>evt.target).blur();\n    }\n  }\n\n  private _onFullSelect(): void {\n    this.elementInput.select();\n  }\n\n  private _onInputFocus(): void {\n    this.class!.add('focus');\n    this.emit('input:focus');\n  }\n\n  private _onInputBlur(): void {\n    this.class!.remove('focus');\n    this.emit('input:blur');\n  }\n\n  private _onDisable(): void {\n    this.elementInput.readOnly = true;\n  }\n\n  private _onEnable() {\n    this.elementInput.readOnly = false;\n  }\n\n  private _onChangeField(): void {\n    if (!this.renderChanges)\n      return;\n\n    this.flash();\n  };\n\n  public focus(select: boolean) {\n    this.elementInput.focus();\n    if (select) this.elementInput.select();\n  }\n\n  public _onLinkChange(value: string) {\n    this.elementInput.value = value;\n    this.emit('change', value);\n  }\n\n\n\n}","import { ContainerElement } from \"./container-element\";\nimport { TopElementContainer } from \"./top\";\n\nexport class Tooltip extends ContainerElement {\n\n  public arrow: HTMLElement;\n  public hoverable: boolean;\n  public x: number;\n  public y: number;\n\n  private _align: string;\n  public get align(): string {\n    return this._align;\n  }\n  public set align(val: string) {\n    if (this._align === val)\n      return;\n\n    this.class!.remove('align-' + this._align);\n    this._align = val;\n    this.class!.add('align-' + this._align);\n\n    this._reflow();\n  }\n\n  public get html(): string {\n    return this.innerElement!.innerHTML;\n  }\n  public set html(val: string) {\n    if (this.innerElement!.innerHTML === val)\n      return;\n\n    this.innerElement!.innerHTML = val;\n  }\n\n  public get text(): string {\n    return this.innerElement!.textContent || '';\n  }\n  public set text(val: string) {\n    if (this.innerElement!.textContent === val)\n      return;\n\n    this.innerElement!.textContent = val;\n  }\n\n  public get flip(): boolean {\n    return this.class!.contains('flip');\n  }\n  public set flip(val: boolean) {\n    if (this.class!.contains('flip') === val)\n      return;\n\n    if (val) {\n      this.class!.add('flip');\n    } else {\n      this.class!.remove('flip');\n    }\n\n    this._reflow();\n  }\n\n  public constructor(args?: TooltipArgs) {\n    super();\n    args = args || {};\n    let self = this;\n\n    this.element = document.createElement('div');\n    this.element.classList.add('ui-tooltip', 'align-left');\n\n    this.innerElement = document.createElement('div');\n    this.innerElement.classList.add('inner');\n    this.element.appendChild(this.innerElement);\n\n    this.arrow = document.createElement('div');\n    this.arrow.classList.add('arrow');\n    this.element.appendChild(this.arrow);\n\n    this.hoverable = args.hoverable || false;\n    this.x = args.x || 0;\n    this.y = args.y || 0;\n    this._align = 'left';\n    this.align = args.align || 'left';\n\n    this.on('show', this._reflow);\n    this.hidden = args.hidden !== undefined ? args.hidden : true;\n    if (args.html) {\n      this.html = args.html;\n    } else {\n      this.text = args.text || '';\n    }\n\n    this.element.addEventListener('mouseover', this._onMouseOver.bind(this), false);\n    this.element.addEventListener('mouseleave', this._onMouseLeave.bind(this), false);\n\n  }\n\n  private _onMouseOver(evt: MouseEvent): void {\n    if (!this.hoverable)\n      return;\n\n    this.hidden = false;\n    this.emit('hover', evt);\n  }\n\n  private _onMouseLeave(): void {\n    if (!this.hoverable)\n      return;\n\n    this.hidden = true;\n  }\n\n  public position(x: number, y: number): void {\n    x = Math.floor(x);\n    y = Math.floor(y);\n\n    if (this.x === x && this.y === y)\n      return;\n\n    this.x = x;\n    this.y = y;\n\n    this._reflow();\n  }\n\n  private _reflow(): void {\n    if (this.hidden)\n      return;\n\n    this.element!.style.top = '';\n    this.element!.style.right = '';\n    this.element!.style.bottom = '';\n    this.element!.style.left = '';\n\n    this.arrow.style.top = '';\n    this.arrow.style.right = '';\n    this.arrow.style.bottom = '';\n    this.arrow.style.left = '';\n\n    this.element!.style.display = 'block';\n\n    // alignment\n    switch (this._align) {\n      case 'top':\n        this.element!.style.top = this.y + 'px';\n        if (this.flip) {\n          this.element!.style.right = 'calc(100% - ' + this.x + 'px)';\n        } else {\n          this.element!.style.left = this.x + 'px';\n        }\n        break;\n      case 'right':\n        this.element!.style.top = this.y + 'px';\n        this.element!.style.right = 'calc(100% - ' + this.x + 'px)';\n        break;\n      case 'bottom':\n        this.element!.style.bottom = 'calc(100% - ' + this.y + 'px)';\n        if (this.flip) {\n          this.element!.style.right = 'calc(100% - ' + this.x + 'px)';\n        } else {\n          this.element!.style.left = this.x + 'px';\n        }\n        break;\n      case 'left':\n        this.element!.style.top = this.y + 'px';\n        this.element!.style.left = this.x + 'px';\n        break;\n    }\n\n    // limit to screen bounds\n    let rect = this.element!.getBoundingClientRect();\n\n    if (rect.left < 0) {\n      this.element!.style.left = '0px';\n      this.element!.style.right = '';\n    }\n    if (rect.top < 0) {\n      this.element!.style.top = '0px';\n      this.element!.style.bottom = '';\n    }\n    if (rect.right > window.innerWidth) {\n      this.element!.style.right = '0px';\n      this.element!.style.left = '';\n      this.arrow.style.left = Math.floor(rect.right - window.innerWidth + 8) + 'px';\n    }\n    if (rect.bottom > window.innerHeight) {\n      this.element!.style.bottom = '0px';\n      this.element!.style.top = '';\n      this.arrow.style.top = Math.floor(rect.bottom - window.innerHeight + 8) + 'px';\n    }\n\n    this.element!.style.display = '';\n  }\n\n  public evtHover(): void {\n\n  }\n\n  public evtBlur(): void {\n\n  }\n\n\n  public static attach(args: TooltipArgs): Tooltip {\n    let data: TooltipArgs = {\n      align: args.align,\n      hoverable: args.hoverable\n    }\n\n    if (args.html) {\n      data.html = args.html;\n    } else {\n      data.text = args.text || '';\n    }\n\n    let item: Tooltip = new Tooltip(data);\n\n    item.evtHover = function () {\n      let rect = args.target!.getBoundingClientRect();\n      let off = 16;\n\n      switch (item.align) {\n        case 'top':\n          if (rect.width < 64) off = rect.width / 2;\n          item.flip = rect.left + off > window.innerWidth / 2;\n          if (item.flip) {\n            item.position(rect.right - off, rect.bottom);\n          } else {\n            item.position(rect.left + off, rect.bottom);\n          }\n          break;\n        case 'right':\n          if (rect.height < 64) off = rect.height / 2;\n          item.flip = false;\n          item.position(rect.left, rect.top + off);\n          break;\n        case 'bottom':\n          if (rect.width < 64) off = rect.width / 2;\n          item.flip = rect.left + off > window.innerWidth / 2;\n          if (item.flip) {\n            item.position(rect.right - off, rect.top);\n          } else {\n            item.position(rect.left + off, rect.top);\n          }\n          break;\n        case 'left':\n          if (rect.height < 64) off = rect.height / 2;\n          item.flip = false;\n          item.position(rect.right, rect.top + off);\n          break;\n      }\n\n      item.hidden = false;\n    };\n\n    item.evtBlur = function () {\n      item.hidden = true;\n    };\n\n    args.target!.addEventListener('mouseover', item.evtHover, false);\n    args.target!.addEventListener('mouseout', item.evtBlur, false);\n\n    item.on('destroy', function () {\n      args.target!.removeEventListener('mouseover', item.evtHover);\n      args.target!.removeEventListener('mouseout', item.evtBlur);\n    });\n\n    args.root!.append(item);\n\n    return item;\n  }\n\n\n  public attachReference(args: any): void {\n\n  }\n\n\n}\n\n\n\nexport interface TooltipArgs {\n\n  target?: HTMLElement;\n  text?: string;\n  align?: string;\n  root?: TopElementContainer;\n  hoverable?: boolean;\n  html?: string;\n  x?: number;\n  y?: number;\n  hidden?: boolean;\n\n}","export * from './top-element';\nexport * from './top-element-container';\nexport * from './top-element-panel';","import { TopElement } from \"./top-element\";\nimport { Element } from \"../element\";\n\nexport class TopElementContainer extends TopElement {\n\n\n    public RESIZE_HANDLE_SIZE = 4;\n\n    public VALID_RESIZABLE_VALUES = [\n        null,\n        'top',\n        'right',\n        'bottom',\n        'left'\n    ];\n\n    private _flex: boolean = false;\n    private _grid: boolean = false;\n    private _scrollable: boolean = false;\n    private _resizable: Nullable<string> = null;\n    private _resizeMin: number = 0;\n    private _resizeMax: number = 0;\n\n    private _domContent: Nullable<HTMLElement> = null;\n\n    private _domEventScroll: any;\n    private _domResizeHandle: any;\n    private _resizeHorizontally: boolean;\n\n    private _domEventResizeStart: any;\n    private _domEventResizeMove: any;\n    private _domEventResizeEnd: any;\n    private _domEventResizeTouchStart: any;\n    private _domEventResizeTouchMove: any;\n    private _domEventResizeTouchEnd: any;\n    private _resizeTouchId: any;\n    private _resizeData: any;\n\n\n    public get flex(): boolean {\n        return this._flex;\n    }\n    public set flex(value: boolean) {\n        if (value === this._flex) return;\n\n        this._flex = value;\n\n        if (value) {\n            this.class!.add('pcui-flex');\n        } else {\n            this.class!.remove('pcui-flex');\n        }\n    }\n\n    public get grid(): boolean {\n        return this._grid;\n    }\n    public set grid(value: boolean) {\n        if (value === this._grid) return;\n\n        this._grid = value;\n\n        if (value) {\n            this.class!.add('pcui-grid');\n        } else {\n            this.class!.remove('pcui-grid');\n        }\n    }\n\n    public get scrollable(): boolean {\n        return this._scrollable;\n    }\n    public set scrollable(value: boolean) {\n        if (value === this._scrollable) return;\n\n        this._scrollable = value;\n\n        if (value) {\n            this.class!.add('pcui-scrollable');\n        } else {\n            this.class!.remove('pcui-scrollable');\n        }\n    }\n\n    public get resizable(): Nullable<string> {\n        return this._resizable;\n    }\n    public set resizable(value: Nullable<string>) {\n        if (value === this._resizable) return;\n\n        if (this.VALID_RESIZABLE_VALUES.indexOf(value) === -1) {\n            console.error('Invalid resizable value: must be one of ' + this.VALID_RESIZABLE_VALUES.join(','));\n            return;\n        }\n\n        // remove old class\n        if (this._resizable) {\n            this.class!.remove('pcui-resizable-' + this._resizable);\n        }\n\n        this._resizable = value;\n        this._resizeHorizontally = (value === 'right' || value === 'left');\n\n        if (value) {\n            // add resize class and create / append resize handle\n            this.class!.add('pcui-resizable');\n            this.class!.add('pcui-resizable-' + value);\n\n            if (!this._domResizeHandle) {\n                this._createResizeHandle();\n            }\n            this.dom!.appendChild(this._domResizeHandle);\n        } else {\n            // remove resize class and resize handle\n            this.class!.remove('pcui-resizable');\n            if (this._domResizeHandle) {\n                this.dom!.removeChild(this._domResizeHandle);\n            }\n        }\n    }\n\n    public get resizeMin(): number {\n        return this._resizeMin;\n    }\n    public set resizeMin(value: number) {\n        this._resizeMin = Math.max(0, Math.min(value, this._resizeMax));\n    }\n\n    public get resizeMax(): number {\n        return this._resizeMax;\n    }\n    public set resizeMax(value: number) {\n        this._resizeMax = Math.max(this._resizeMin, value);\n    }\n\n    public get domContent(): Nullable<HTMLElement> {\n        return this._domContent;\n    }\n    public set domContent(value: Nullable<HTMLElement>) {\n        if (this._domContent === value) return;\n\n        if (this._domContent) {\n            this._domContent.removeEventListener('scroll', this._domEventScroll);\n        }\n\n        this._domContent = value;\n\n        if (this._domContent) {\n            this._domContent.addEventListener('scroll', this._domEventScroll);\n        }\n    }\n\n    public get innerElement(): Nullable<HTMLElement> {\n        return this.domContent;\n    }\n    public set innerElement(value: Nullable<HTMLElement>) {\n        this.domContent = value;\n    }\n\n\n    public constructor(args: any) {\n        super(document.createElement('div'), args);\n\n        if (!args) args = {}\n\n        var dom = this.dom!;\n        dom.classList.add('pcui-container');\n\n        this._domEventScroll = this._onScroll.bind(this);\n        this.domContent = dom;\n\n        // pcui.Element.call(this, dom, args);\n        // pcui.IContainer.call(this);\n        // pcui.IFlex.call(this);\n        // pcui.IGrid.call(this);\n        // pcui.IScrollable.call(this);\n        // pcui.IResizable.call(this);\n\n        // scroll\n        this.scrollable = args.scrollable !== undefined ? args.scrollable : false;\n\n        // flex\n        this.flex = !!args.flex;\n\n        // grid\n        var grid = !!args.grid;\n        if (grid) {\n            if (this.flex) {\n                console.error('Invalid pcui.Container arguments: \"grid\" and \"flex\" cannot both be true.');\n                grid = false;\n            }\n        }\n        this.grid = grid;\n\n        // resize related\n        this._domResizeHandle = null;\n        this._domEventResizeStart = this._onResizeStart.bind(this);\n        this._domEventResizeMove = this._onResizeMove.bind(this);\n        this._domEventResizeEnd = this._onResizeEnd.bind(this);\n        this._domEventResizeTouchStart = this._onResizeTouchStart.bind(this);\n        this._domEventResizeTouchMove = this._onResizeTouchMove.bind(this);\n        this._domEventResizeTouchEnd = this._onResizeTouchEnd.bind(this);\n        this._resizeTouchId = null;\n        this._resizeData = null;\n        this._resizeHorizontally = true;\n\n        this.resizable = args.resizable || null;\n        this._resizeMin = 100;\n        this._resizeMax = 300;\n\n        if (args.resizeMin !== undefined) {\n            this.resizeMin = args.resizeMin;\n        }\n        if (args.resizeMax !== undefined) {\n            this.resizeMax = args.resizeMax;\n        }\n\n    }\n\n    public append(element: HTMLElement | TopElement | Element) {\n        var dom = this._getDomFromElement(element);\n        this._domContent!.appendChild(dom);\n        this._onAppendChild(element);\n    };\n\n    public appendBefore(element: HTMLElement | TopElement | Element, referenceElement: HTMLElement | TopElement | Element) {\n        var dom = this._getDomFromElement(element);\n        this._domContent!.appendChild(dom);\n        var referenceDom = referenceElement && this._getDomFromElement(referenceElement);\n\n        if ((referenceDom)) {\n            this._domContent!.insertBefore(dom, referenceDom);\n        } else {\n            this._domContent!.appendChild(dom);\n        }\n\n        this._onAppendChild(element);\n    };\n\n    public appendAfter(element: HTMLElement | TopElement | Element, referenceElement: HTMLElement | TopElement | Element) {\n        var dom = this._getDomFromElement(element);\n        var referenceDom = referenceElement && this._getDomFromElement(referenceElement);\n\n        var elementBefore = referenceDom ? referenceDom.nextSibling : null;\n        if (elementBefore) {\n            this._domContent!.insertBefore(dom, elementBefore);\n        } else {\n            this._domContent!.appendChild(dom);\n        }\n\n        this._onAppendChild(element);\n    };\n\n    public prepend(element: HTMLElement | TopElement | Element) {\n        var dom = this._getDomFromElement(element);\n        var first = this._domContent!.firstChild;\n        if (first) {\n            this._domContent!.insertBefore(dom, first);\n        } else {\n            this._domContent!.appendChild(dom);\n        }\n\n        this._onAppendChild(element);\n    };\n\n    public remove(element: HTMLElement | TopElement | Element) {\n        let html: boolean = (element instanceof HTMLElement);\n        if (!html && (<TopElement>element).parent !== this) return;\n        var dom = this._getDomFromElement(element);\n        this._domContent!.removeChild(dom);\n        if (!html)\n            (<TopElement>element).parent = null;\n        this.emit('remove', element);\n    };\n\n    public clear() {\n        if (this._domContent) {\n            var i = this._domContent.childNodes.length;\n            while (i--) {\n                var node = this._domContent.childNodes[i];\n                if ((<HTMLElement>node).ui) {\n                    (<HTMLElement>node).ui.destroy();\n                }\n            }\n\n            this._domContent.innerHTML = '';\n        }\n    };\n\n    private _getDomFromElement(element: HTMLElement | TopElement | Element) {\n        if (element instanceof HTMLElement)\n            return element;\n        else if (element instanceof TopElement)\n            return (<TopElement>element).dom!;\n        else\n            return (<Element>element).element!;\n        // if (element.dom) {\n        //     return element.dom;\n        // }\n        // if (element.element) {\n        //     // console.log('Legacy ui.Element passed to pcui.Container', this.class, element.class);\n        //     return element.element;\n        // }\n        // return element;\n    };\n\n    private _onAppendChild(element: HTMLElement | TopElement | Element) {\n        if (element instanceof TopElement)\n            (<TopElement>element).parent = this;\n        else if (element instanceof Element)\n            (<Element>element).parent = this;\n        this.emit('append', element);\n    };\n\n    private _onScroll(evt: MouseEvent) {\n        this.emit('scroll', evt);\n    };\n\n    private _createResizeHandle() {\n        var handle = document.createElement('div');\n        handle.classList.add('pcui-resizable-handle');\n        handle.ui = this;\n\n        handle.addEventListener('mousedown', this._domEventResizeStart);\n        handle.addEventListener('touchstart', this._domEventResizeTouchStart);\n\n        this._domResizeHandle = handle;\n    };\n\n    private _onResizeStart(evt: MouseEvent) {\n        evt.preventDefault();\n        evt.stopPropagation();\n\n        window.addEventListener('mousemove', this._domEventResizeMove);\n        window.addEventListener('mouseup', this._domEventResizeEnd);\n\n        this._resizeStart();\n    };\n\n    private _onResizeMove(evt: MouseEvent) {\n        evt.preventDefault();\n        evt.stopPropagation();\n\n        this._resizeMove(evt.clientX, evt.clientY);\n    };\n\n    private _onResizeEnd(evt: MouseEvent) {\n        evt.preventDefault();\n        evt.stopPropagation();\n\n        window.removeEventListener('mousemove', this._domEventResizeMove);\n        window.removeEventListener('mouseup', this._domEventResizeEnd);\n\n        this._resizeEnd();\n    };\n\n    private _onResizeTouchStart(evt: TouchEvent) {\n        evt.preventDefault();\n        evt.stopPropagation();\n\n        for (var i = 0; i < evt.changedTouches.length; i++) {\n            var touch = evt.changedTouches[i];\n            if (touch.target === this._domResizeHandle) {\n                this._resizeTouchId = touch.identifier;\n            }\n        }\n\n        window.addEventListener('touchmove', this._domEventResizeTouchMove);\n        window.addEventListener('touchend', this._domEventResizeTouchEnd);\n\n        this._resizeStart();\n    };\n\n    private _onResizeTouchMove(evt: TouchEvent) {\n        for (var i = 0; i < evt.changedTouches.length; i++) {\n            var touch = evt.changedTouches[i];\n            if (touch.identifier !== this._resizeTouchId) {\n                continue;\n            }\n\n            evt.stopPropagation();\n            evt.preventDefault();\n\n            this._resizeMove(touch.clientX, touch.clientY);\n\n            break;\n        }\n    };\n\n    private _onResizeTouchEnd(evt: TouchEvent) {\n        for (var i = 0; i < evt.changedTouches.length; i++) {\n            var touch = evt.changedTouches[i];\n            if (touch.identifier === this._resizeTouchId) {\n                continue;\n            }\n\n            this._resizeTouchId = null;\n\n            evt.preventDefault();\n            evt.stopPropagation();\n\n            window.removeEventListener('touchmove', this._domEventResizeTouchMove);\n            window.removeEventListener('touchend', this._domEventResizeTouchEnd);\n\n            this._resizeEnd();\n\n            break;\n        }\n    };\n\n    private _resizeStart() {\n        this.class!.add('pcui-resizable-resizing');\n    };\n\n    private _resizeMove(x: number, y: number) {\n        // if we haven't initialized resizeData do so now\n        if (!this._resizeData) {\n            this._resizeData = {\n                x: x,\n                y: y,\n                width: this.dom!.clientWidth,\n                height: this.dom!.clientHeight\n            };\n\n            return;\n        }\n\n        if (this._resizeHorizontally) {\n            // horizontal resizing\n            var offsetX = this._resizeData.x - x;\n\n            if (this._resizable === 'right') {\n                offsetX = -offsetX;\n            }\n\n            this.width = this.RESIZE_HANDLE_SIZE + Math.max(this._resizeMin, Math.min(this._resizeMax, (this._resizeData.width + offsetX)));\n        } else {\n            // vertical resizing\n            var offsetY = this._resizeData.y - y;\n\n            if (this._resizable === 'bottom') {\n                offsetY = -offsetY;\n            }\n\n            this.height = Math.max(this._resizeMin, Math.min(this._resizeMax, (this._resizeData.height + offsetY)));\n        }\n\n        this.emit('resize');\n    };\n\n    private _resizeEnd() {\n        this._resizeData = null;\n        this.class!.remove('pcui-resizable-resizing');\n    };\n\n    public destroy() {\n        this.domContent = null;\n\n        if (this._domResizeHandle) {\n            this._domResizeHandle.removeEventListener('mousedown', this._domEventResizeStart);\n            window.removeEventListener('mousemove', this._domEventResizeMove);\n            window.removeEventListener('mouseup', this._domEventResizeEnd);\n\n            this._domResizeHandle.removeEventListener('touchstart', this._domEventResizeTouchStart);\n            window.removeEventListener('touchmove', this._domEventResizeTouchMove);\n            window.removeEventListener('touchend', this._domEventResizeTouchEnd);\n        }\n\n        this._domResizeHandle = null;\n        this._domEventResizeStart = null;\n        this._domEventResizeMove = null;\n        this._domEventResizeEnd = null;\n        this._domEventResizeTouchStart = null;\n        this._domEventResizeTouchMove = null;\n        this._domEventResizeTouchEnd = null;\n\n        super.destroy.call(this);\n    };\n\n\n\n}","import { TopElementContainer } from \"./top-element-container\";\n\nexport class TopElementPanel extends TopElementContainer {\n\n    private _suspendReflow: boolean;\n\n    private _containerHeader: TopElementContainer;\n    private _domHeaderTitle: HTMLElement;\n    private _headerSize: number = 0\n\n    private _containerContent: TopElementContainer;\n\n    private _collapsible: boolean = false;\n    private _collapsed: boolean = false;\n    private _collapseHorizontally: boolean = false;\n\n    private _reflowTimeout: Nullable<number> = null;\n    private _widthBeforeCollapse: Nullable<number> = null;\n    private _heightBeforeCollapse: Nullable<number> = null;\n\n    private _evtAppend: Nullable<EventHandle>;\n    private _evtRemove: Nullable<EventHandle>;\n\n\n    public get collapsible(): boolean {\n        return this._collapsible;\n    }\n    public set collapsible(value: boolean) {\n        if (value === this._collapsible) return;\n\n        this._collapsible = value;\n\n        if (this._evtAppend) {\n            this._evtAppend.unbind();\n            this._evtAppend = null;\n        }\n\n        if (this._evtRemove) {\n            this._evtRemove.unbind();\n            this._evtRemove = null;\n        }\n\n        if (value) {\n            // listen to append / remove events so we can change our height\n            var onChange = this._onChildrenChange.bind(this);\n            this._evtAppend = this._containerContent.on('append', onChange);\n            this._evtRemove = this._containerContent.on('remove', onChange);\n\n            this.class!.add('pcui-collapsible');\n        } else {\n            this.class!.remove('pcui-collapsible');\n        }\n\n        this._reflow();\n\n        if (this.collapsed) {\n            this.emit(value ? 'collapse' : 'expand');\n        }\n    }\n\n    public get collapsed(): boolean {\n        return this._collapsed;\n    }\n    public set collapsed(value: boolean) {\n        if (this._collapsed === value) return;\n\n        this._collapsed = value;\n\n        if (value) {\n            this.class!.add('pcui-collapsed');\n        } else {\n            this.class!.remove('pcui-collapsed');\n        }\n\n        this._reflow();\n\n        if (this.collapsible) {\n            this.emit(value ? 'collapse' : 'expand');\n        }\n    }\n\n    public get collapseHorizontally(): boolean {\n        return this._collapseHorizontally;\n    }\n    public set collapseHorizontally(value: boolean) {\n        if (this._collapseHorizontally === value) return;\n\n        this._collapseHorizontally = value;\n        if (value) {\n            this.class!.add('pcui-panel-horizontal');\n        } else {\n            this.class!.remove('pcui-panel-horizontal');\n        }\n\n        this._reflow();\n    }\n\n    public get content(): TopElementContainer {\n        return this._containerContent;\n    }\n\n    public get header(): TopElementContainer {\n        return this._containerHeader;\n    }\n\n    public get headerText(): string {\n        return this._domHeaderTitle.textContent || '';\n    }\n    public set headerText(value: string) {\n        this._domHeaderTitle.textContent = value;\n    }\n\n    public get headerSize(): number {\n        return this._headerSize;\n    }\n    public set headerSize(value: number) {\n        this._headerSize = value;\n        let style = this._containerHeader.dom!.style;\n        style.height = Math.max(0, value) + 'px';\n        style.lineHeight = style.height;\n        this._reflow();\n    }\n\n\n\n    public constructor(args: any) {\n        super(args);\n\n        if (!args) args = {};\n\n        var panelArgs = Object.assign({}, args);\n        panelArgs.flex = true;\n        delete panelArgs.flexDirection;\n        delete panelArgs.scrollable;\n\n        this.class!.add('pcui-panel');\n\n        if (args.panelType) {\n            this.class!.add('pcui-panel-' + args.panelType);\n        }\n\n        // do not call reflow on every update while\n        // we are initializing\n        this._suspendReflow = true;\n\n        // initialize header container\n        // this._initializeHeader(args);\n        // header container\n        this._containerHeader = new TopElementContainer({\n            flex: true,\n            flexDirection: 'row'\n        });\n        this._containerHeader.class!.add('pcui-panel-header');\n\n        // header title\n        this._domHeaderTitle = document.createElement('span');\n        this._domHeaderTitle.textContent = args.headerText || '';\n        this._domHeaderTitle.classList.add('pcui-panel-header-title');\n        this._domHeaderTitle.ui = this._containerHeader;\n        this._containerHeader.dom!.appendChild(this._domHeaderTitle);\n\n        // use native click listener because the pcui.Element#click event is only fired\n        // if the element is enabled. However we still want to catch header click events in order\n        // to collapse them\n        this._containerHeader.dom!.addEventListener('click', this._onHeaderClick.bind(this));\n\n        this.append(this._containerHeader);\n\n        // initialize content container\n        // this._initializeContent(args);\n        this._containerContent = new TopElementContainer({\n            flex: args.flex,\n            flexDirection: args.flexDirection,\n            scrollable: args.scrollable\n        });\n        this._containerContent.class!.add('pcui-panel-content');\n        this._containerContent.style.height = '100%';\n\n        this.appendAfter(this._containerContent, this._containerHeader);\n\n        // event handlers\n        this._evtAppend = null;\n        this._evtRemove = null;\n\n        // header size\n        this.headerSize = args.headerSize !== undefined ? args.headerSize : 32;\n\n        // collapse related\n        this._reflowTimeout = null;\n        this._widthBeforeCollapse = null;\n        this._heightBeforeCollapse = null;\n\n        // if we initialize the panel collapsed\n        // then use the width / height passed in the arguments\n        // as the size to expand to\n        if (args.collapsed) {\n            if (args.width) {\n                this._widthBeforeCollapse = args.width;\n            }\n            if (args.height) {\n                this._heightBeforeCollapse = args.height;\n            }\n        }\n\n        this.collapsible = args.collapsible || false;\n        this.collapsed = args.collapsed || false;\n        this.collapseHorizontally = args.collapseHorizontally || false;\n\n        // set the contents container to be the content DOM element\n        // from now on calling append functions on the panel will append themn\n        // elements to the contents container\n        this.domContent = this._containerContent.dom;\n\n        // execute reflow now after all fields have been initialized\n        this._suspendReflow = false;\n        this._reflow();\n\n    }\n\n\n    private _onHeaderClick(evt: MouseEvent) {\n        if (!this._collapsible) return;\n        if (evt.target !== this.header.dom && evt.target !== this._domHeaderTitle) return;\n        // toggle collapsed\n        this.collapsed = !this.collapsed;\n    };\n\n    private _onChildrenChange() {\n        if (!this.collapsible || this.collapsed || this._collapseHorizontally || this.hidden) {\n            return;\n        }\n        this.height = this.headerSize + this._containerContent.dom!.clientHeight;\n    };\n\n    // Collapses or expands the panel as needed\n    private _reflow() {\n        let self = this;\n\n        if (this._suspendReflow) {\n            return;\n        }\n\n        if (this._reflowTimeout) {\n            cancelAnimationFrame(this._reflowTimeout);\n            this._reflowTimeout = null;\n        }\n\n        if (this.hidden || !this.collapsible) return;\n\n        if (this.collapsed && this.collapseHorizontally) {\n            this._containerHeader.style.top = -this.headerSize + 'px';\n        } else {\n            this._containerHeader.style.top = '';\n        }\n\n        // we rely on the content width / height and we have to\n        // wait for 1 frame before we can get the final values back\n        this._reflowTimeout = requestAnimationFrame(function () {\n            self._reflowTimeout = null;\n\n            if (self.collapsed) {\n                // remember size before collapse\n                if (!self._widthBeforeCollapse) {\n                    self._widthBeforeCollapse = self.dom!.clientWidth;\n                }\n                if (!self._heightBeforeCollapse) {\n                    self._heightBeforeCollapse = self.dom!.clientHeight;\n                }\n\n                if (self._collapseHorizontally) {\n                    self.height = '';\n                    self.width = self.headerSize;\n                } else {\n                    self.height = self.headerSize;\n                }\n            } else {\n                if (self._collapseHorizontally) {\n                    self.height = '';\n                    if (self._widthBeforeCollapse !== null) {\n                        self.width = self._widthBeforeCollapse;\n                    }\n                } else {\n                    if (self._heightBeforeCollapse !== null) {\n                        self.height = self._heightBeforeCollapse;\n                    }\n                }\n\n                // reset before collapse vars\n                self._widthBeforeCollapse = null;\n                self._heightBeforeCollapse = null;\n            }\n        }.bind(self));\n    };\n\n    public destroy() {\n        if (this._reflowTimeout) {\n            cancelAnimationFrame(this._reflowTimeout);\n            this._reflowTimeout = null;\n        }\n\n        super.destroy.call(this);\n    };\n\n\n\n\n\n}","import { Events } from \"../../lib\";\n\nexport class TopElement extends Events {\n\n    public SIMPLE_CSS_PROPERTIES: {[key: string]: string} = {\n        'flexDirection': 'flex-direction',\n        'flexGrow': 'flex-grow',\n        'flexBasis': 'flex-basis',\n        'flexShrink': 'flex-shrink',\n        'flexWrap': 'flex-wrap',\n        'alignItems': 'align-items',\n        'justifyContent': 'justify-content'\n    };\n\n    private _destroyed = false;\n    private _enabled = true;\n    private _hidden = false;\n    private _parent: Nullable<TopElement> = null;\n\n    private _domEventClick: any;\n    private _domEventMouseOver: any;\n    private _domEventMouseOut: any;\n\n    private _evtParentDestroy: Nullable<EventHandle> = null;\n    private _evtParentDisable: Nullable<EventHandle> = null;\n    private _evtParentEnable: Nullable<EventHandle> = null;\n\n    private _dom: Nullable<HTMLElement>;\n    // private domContent: Nullable<HTMLElement> = null;\n\n\n    public get enabled(): boolean {\n        return this._enabled && (!this._parent || this._parent.enabled);\n    }\n    public set enabled(value: boolean) {\n        if (this._enabled === value) return;\n\n        // remember if enabled in hierarchy\n        let enabled = this.enabled;\n\n        this._enabled = value;\n\n        // only fire event if hierarchy state changed\n        if (enabled !== value) {\n            this._onEnabledChange(value);\n        }\n    }\n\n    public get dom(): Nullable<HTMLElement> {\n        return this._dom;\n    }\n    public set dom(value: Nullable<HTMLElement>) {\n        this._dom = value;\n    }\n\n    public get parent(): Nullable<TopElement> {\n        return this._parent;\n    }\n    public set parent(value: Nullable<TopElement>) {\n        if (value === this._parent) return;\n\n        var oldEnabled = this.enabled;\n\n        if (this._parent) {\n            this._evtParentDestroy!.unbind();\n            this._evtParentDisable!.unbind();\n            this._evtParentEnable!.unbind();\n        }\n\n        this._parent = value;\n\n        if (this._parent) {\n            this._evtParentDestroy = this._parent.once('destroy', this._onParentDestroy.bind(this));\n            this._evtParentDisable = this._parent.on('disable', this._onParentDisable.bind(this));\n            this._evtParentEnable = this._parent.on('enable', this._onParentEnable.bind(this));\n        }\n\n        this.emit('parent', this._parent);\n\n        var newEnabled = this.enabled;\n        if (newEnabled !== oldEnabled) {\n            this._onEnabledChange(newEnabled);\n        }\n    }\n\n    public get hidden(): boolean {\n        return this._hidden;\n    }\n    public set hidden(value: boolean) {\n        if (value === this._hidden) return;\n\n        this._hidden = value;\n\n        if (value) {\n            this.class!.add('pcui-hidden');\n        } else {\n            this.class!.remove('pcui-hidden');\n        }\n\n        this.emit(value ? 'hide' : 'show');\n    }\n\n    public get style(): CSSStyleDeclaration {\n        return this._dom!.style;\n    }\n\n    public get class(): Nullable<DOMTokenList> {\n        return this._dom!.classList;\n    }\n\n    public get width(): number | string {\n        return this._dom!.clientWidth;\n    }\n    public set width(value: number | string) {\n        if (typeof value === 'number') {\n            value = value.toString() + 'px';\n        }\n        this.style.width = value;\n    }\n\n    public get height(): number | string {\n        return this._dom!.clientHeight;\n    }\n    public set height(value: number | string) {\n        if (typeof value === 'number') {\n            value = value.toString() + 'px';\n        }\n        this.style.height = value;\n    }\n\n    public get disabled(): boolean {\n        return !this.enabled;\n    }\n    public set disabled(value: boolean) {\n        this.enabled = !value;\n    }\n\n\n    public get element(): Nullable<HTMLElement> {\n        return this.dom;\n    }\n    public set element(value: Nullable<HTMLElement>) {\n        this.dom = value;\n    }\n\n    // public get innerElement(): Nullable<HTMLElement> {\n    //     return this.domContent;\n    // }\n    // public set innerElement(value: Nullable<HTMLElement>) {\n    //     this.domContent = value;\n    // }\n\n\n\n    public constructor(dom: HTMLElement, args: any) {\n        super();\n\n        if (!args) args = {};\n\n        this._destroyed = false;\n        this._enabled = true;\n        this._hidden = false;\n        this._parent = null;\n\n        this._domEventClick = this._onClick.bind(this);\n        this._domEventMouseOver = this._onMouseOver.bind(this);\n        this._domEventMouseOut = this._onMouseOut.bind(this);\n\n        this._evtParentDestroy = null;\n        this._evtParentDisable = null;\n        this._evtParentEnable = null;\n\n        this._dom = dom;\n\n        if (args.id !== undefined) {\n            this._dom.id = args.id;\n        }\n\n        // add ui reference\n        this._dom.ui = this;\n\n        // add event listeners\n        this._dom.addEventListener('click', this._domEventClick);\n        this._dom.addEventListener('mouseover', this._domEventMouseOver);\n        this._dom.addEventListener('mouseout', this._domEventMouseOut);\n\n        // add element class\n        this._dom.classList.add('pcui-element');\n\n        if (args.enabled !== undefined) {\n            this.enabled = args.enabled;\n        }\n        if (args.hidden !== undefined) {\n            this.hidden = args.hidden;\n        }\n        if (args.width !== undefined) {\n            this.width = args.width;\n        }\n        if (args.height !== undefined) {\n            this.height = args.height;\n        }\n\n        // copy CSS properties from args\n        for (var key in args) {\n            if (args[key] === undefined) continue;\n            if (this.SIMPLE_CSS_PROPERTIES[key] !== null) {\n                this.style.setProperty(this.SIMPLE_CSS_PROPERTIES[key], args[key]);\n            }\n        }\n\n    }\n\n    public exposeCssProperty(name: string) {\n        Object.defineProperty(TopElement.prototype, name, {\n            get: function () {\n                return this.style[name];\n            },\n            set: function (value) {\n                this.style[name] = value;\n            }\n        });\n    }\n\n\n    public link(observer: any, path: any) {\n        throw new Error('Not implemented');\n    };\n\n    public unlink() {\n        throw new Error('Not implemented');\n    };\n\n    public flash() {\n        let self = this;\n        this.class!.add('flash');\n        setTimeout(function () {\n            self.class!.remove('flash');\n        }.bind(self), 200);\n    };\n\n    private _onClick(evt: MouseEvent) {\n        if (this.enabled) {\n            this.emit('click', evt);\n        }\n    };\n\n    private _onMouseOver(evt: MouseEvent) {\n        this.emit('hover', evt);\n    };\n\n    private _onMouseOut(evt: MouseEvent) {\n        this.emit('hoverend', evt);\n    };\n\n    private _onEnabledChange(enabled: boolean) {\n        if (enabled) {\n            this.class!.remove('pcui-disabled');\n        } else {\n            this.class!.add('pcui-disabled');\n        }\n\n        this.emit(enabled ? 'enable' : 'disable');\n    };\n\n    private _onParentDestroy() {\n        this.destroy();\n    };\n\n    private _onParentDisable() {\n        if (this._enabled) {\n            this._onEnabledChange(false);\n        }\n    };\n\n    private _onParentEnable() {\n        if (this._enabled) {\n            this._onEnabledChange(true);\n        }\n    };\n\n    public destroy() {\n        if (this._destroyed) return;\n\n        this._destroyed = true;\n\n        if (this.parent && this.parent.element) {\n            if (this.element && this.element.parentNode) {\n                this.element.parentNode.removeChild(this.parent.element);\n            }\n        }\n\n        if (this._dom) {\n            // remove event listeners\n            this._dom.removeEventListener('click', this._domEventClick);\n            this._dom.removeEventListener('mouseover', this._domEventMouseOver);\n            this._dom.removeEventListener('mouseout', this._domEventMouseOut);\n\n            // remove ui reference\n            if(this._dom.ui)\n                this._dom.ui.destroy();\n\n            this._dom = null;\n        }\n\n        this._domEventClick = null;\n        this._domEventMouseOver = null;\n        this._domEventMouseOut = null;\n    };\n\n\n}","import { Element } from \"./element\";\nimport { Tree } from \"./tree\";\nimport { TextField } from \"./text-field\";\nimport { Observer } from \"../lib\";\n\nexport class TreeItem extends Element {\n\n    public tree: Nullable<Tree>;\n\n    public elementTitle: HTMLElement;\n    public elementIcon: HTMLElement;\n    public elementText: HTMLElement;\n\n    public _children: number;\n    public selectable: boolean;\n\n    public _onMouseUp: any;\n    private _dragRelease: any;\n\n    private _dragging: boolean;\n    private _allowDrop: boolean;\n\n    public _dragId: number = -1;\n\n    public entity!: Observer;\n\n    public asset: any;\n    public users: any;\n\n    public get selected(): boolean {\n        return this.class!.contains('selected');\n    }\n    public set selected(val: boolean) {\n        if (this.class!.contains('selected') === !!val)\n            return;\n\n        if (val) {\n            this.class!.add('selected');\n\n            // console.warn('tree selected');\n\n            this.emit('select');\n            if (this.tree)\n                this.tree.emit('select', this);\n\n        } else {\n            this.class!.remove('selected');\n\n            this.emit('deselect');\n            if (this.tree)\n                this.tree.emit('deselect', this);\n        }\n    }\n\n    public get text(): string {\n        return this.elementText.textContent || '';\n    }\n    public set text(val: string) {\n        if (this.elementText.textContent === val)\n            return;\n        this.elementText.textContent = val;\n    }\n\n    public get open(): boolean {\n        return this.class!.contains('open');\n    }\n    public set open(val: boolean) {\n        if (this.class!.contains('open') === !!val)\n            return;\n\n        if (val) {\n            this.class!.add('open');\n            this.emit('open');\n            this.tree!.emit('open', this);\n        } else {\n            this.class!.remove('open');\n            this.emit('close');\n            this.tree!.emit('close', this);\n        }\n\n        // if (this.element) {\n        // }\n    }\n\n    public get prev(): Nullable<TreeItem> {\n        if ((<HTMLElement>this.element).previousElementSibling && (<HTMLElement>(<HTMLElement>this.element).previousElementSibling).ui && (<HTMLElement>(<HTMLElement>this.element).previousElementSibling).ui instanceof TreeItem) {\n            return (<TreeItem>(<HTMLElement>(<HTMLElement>this.element).previousElementSibling).ui);\n        } else {\n            return null;\n        }\n    }\n\n    public get next(): Nullable<TreeItem> {\n        if ((<HTMLElement>this.element).nextElementSibling && (<HTMLElement>(<HTMLElement>this.element).nextElementSibling).ui && (<HTMLElement>(<HTMLElement>this.element).nextElementSibling).ui instanceof TreeItem) {\n            return (<TreeItem>(<HTMLElement>(<HTMLElement>this.element).nextElementSibling).ui);\n        } else {\n            return null;\n        }\n    }\n\n\n    public get allowDrop(): boolean {\n        return this._allowDrop;\n    }\n    public set allowDrop(val: boolean) {\n        this._allowDrop = val;\n    }\n\n\n    public constructor(args: TreeItemArgs) {\n        super();\n\n        let self = this;\n        args = args || {};\n\n        this.tree = null;\n\n        this.element = document.createElement('div');\n        this.element.classList.add('ui-tree-item');\n        this.element.ui = this;\n\n        if (args.classList) {\n            args.classList.forEach(function (className: string): void {\n                self.element!.classList.add(className);\n            }, this);\n        }\n\n        this.elementTitle = document.createElement('div');\n        this.elementTitle.classList.add('title');\n        this.elementTitle.draggable = true;\n        this.elementTitle.tabIndex = 0;\n        this.elementTitle.ui = this;\n        this.element.appendChild(this.elementTitle);\n\n        this.elementIcon = document.createElement('span');\n        this.elementIcon.classList.add('icon');\n        this.elementTitle.appendChild(this.elementIcon);\n\n        this.elementText = document.createElement('span');\n        this.elementText.textContent = args.text || '';\n        this.elementText.classList.add('text');\n        this.elementTitle.appendChild(this.elementText);\n\n        this._children = 0;\n        this.selectable = true;\n\n        this._onMouseUp = function (evt: MouseEvent) {\n            window.removeEventListener('mouseup', self._dragRelease);\n            self._dragRelease = null;\n\n            evt.preventDefault();\n            evt.stopPropagation();\n\n            self._dragging = false;\n            self.emit('dragend');\n        };\n\n        this.elementTitle.addEventListener('click', this._onClick, false);\n        this.elementTitle.addEventListener('dblclick', this._onDblClick, false);\n\n        this._dragRelease = null;\n        this._dragging = false;\n        this._allowDrop = (args.allowDrop !== undefined ? !!args.allowDrop : true);\n\n        this.elementTitle.addEventListener('mousedown', this._onMouseDown, false);\n        this.elementTitle.addEventListener('dragstart', this._onDragStart, false);\n        this.elementTitle.addEventListener('mouseover', this._onMouseOver, false);\n\n        this.on('destroy', this._onDestroy);\n        this.on('append', this._onAppend);\n        this.on('remove', this._onRemove);\n        this.on('select', this._onSelect);\n        this.on('deselect', this._onDeselect);\n\n        this.elementTitle.addEventListener('keydown', this._onKeyDown, false);\n\n\n    }\n\n    // TODO\n    public child(index: number): HTMLElement {\n        return <HTMLElement>this.element!.children[index + 1];\n    };\n\n    private _onClick(evt: MouseEvent): void {\n        let htmlEle: HTMLElement = <HTMLElement>evt.target;\n\n        // 可能点击title或者title子项\n        if (!(<TreeItem>htmlEle.ui)) {\n            if (htmlEle.parentElement && <TreeItem>(htmlEle.parentElement).ui) {\n                htmlEle = htmlEle.parentElement;\n            } else {\n                return;\n            }\n        }\n\n        if (evt.button !== 0 || !(<TreeItem>htmlEle.ui).selectable)\n            return;\n\n        let rect = htmlEle.getBoundingClientRect();\n\n        if ((<TreeItem>htmlEle.ui)._children && (evt.clientX - rect.left) < 0) {\n            (<TreeItem>htmlEle.ui).open = !(<TreeItem>htmlEle.ui).open;\n        } else {\n            (<TreeItem>htmlEle.ui).tree!._onItemClick((<TreeItem>htmlEle.ui));\n            evt.stopPropagation();\n        }\n    };\n\n    private _onDblClick(evt: MouseEvent): void {\n        let htmlEle: HTMLElement = <HTMLElement>evt.target;\n\n        // 可能点击title或者title子项\n        if (!(<TreeItem>htmlEle.ui)) {\n            if (htmlEle.parentElement && <TreeItem>(htmlEle.parentElement).ui) {\n                htmlEle = htmlEle.parentElement;\n            } else {\n                return;\n            }\n        }\n\n        if (!(<TreeItem>htmlEle.ui).tree!.allowRenaming || evt.button !== 0)\n            return;\n\n        evt.stopPropagation();\n        let rect = htmlEle.getBoundingClientRect();\n\n        if ((<TreeItem>htmlEle.ui)._children && (evt.clientX - rect.left) < 0) {\n            return;\n        } else {\n            (<TreeItem>htmlEle.ui)._onRename(true);\n        }\n    };\n\n    private _onMouseDown(evt: MouseEvent): void {\n        let htmlEle: HTMLElement = <HTMLElement>evt.target;\n\n        // 可能点击title或者title子项\n        if (!(<TreeItem>htmlEle.ui)) {\n            if (htmlEle.parentElement && <TreeItem>(htmlEle.parentElement).ui) {\n                htmlEle = htmlEle.parentElement;\n            } else {\n                return;\n            }\n        }\n\n        if ((<TreeItem>htmlEle.ui).tree && !(<TreeItem>htmlEle.ui).tree!.draggable)\n            return;\n\n        evt.stopPropagation();\n\n    };\n\n    private _onDragStart = function (evt: MouseEvent): void {\n        let htmlEle: HTMLElement = <HTMLElement>evt.target;\n\n        // 可能点击title或者title子项\n        if (!(<TreeItem>htmlEle.ui)) {\n            if (htmlEle.parentElement && <TreeItem>(htmlEle.parentElement).ui) {\n                htmlEle = htmlEle.parentElement;\n            } else {\n                return;\n            }\n        }\n\n        if (!(<TreeItem>htmlEle.ui).tree!.draggable) {\n            evt.stopPropagation();\n            evt.preventDefault();\n            return;\n        }\n\n        (<TreeItem>htmlEle.ui)._dragging = true;\n\n        if ((<TreeItem>htmlEle.ui)._dragRelease)\n            window.removeEventListener('mouseup', (<TreeItem>htmlEle.ui)._dragRelease);\n\n        (<TreeItem>htmlEle.ui)._dragRelease = (<TreeItem>htmlEle.ui)._onMouseUp;\n        window.addEventListener('mouseup', (<TreeItem>htmlEle.ui)._dragRelease, false);\n\n        evt.stopPropagation();\n        evt.preventDefault();\n\n        // console.log('drag start');\n\n        (<TreeItem>htmlEle.ui).emit('dragstart');\n    };\n\n    private _onMouseOver(evt: MouseEvent): void {\n        let htmlEle: HTMLElement = <HTMLElement>evt.target;\n\n        // 可能点击title或者title子项\n        if (!(<TreeItem>htmlEle.ui)) {\n            if (htmlEle.parentElement && <TreeItem>(htmlEle.parentElement).ui) {\n                htmlEle = htmlEle.parentElement;\n            } else {\n                return;\n            }\n        }\n\n        evt.stopPropagation();\n        (<TreeItem>htmlEle.ui).emit('mouseover', evt);\n\n    };\n\n\n    private _onSelect(): void {\n        this.elementTitle.focus();\n    };\n\n    private _onDeselect(): void {\n        this.elementTitle.blur();\n    };\n\n\n    private _onKeyDown(evt: KeyboardEvent) {\n        let htmlEle: HTMLElement = <HTMLElement>evt.target;\n\n        if (!(<TreeItem>htmlEle.ui)) return;\n\n        let currentItem: TreeItem = <TreeItem>htmlEle.ui;\n\n        if (evt.target && htmlEle.tagName.toLowerCase() === 'input')\n            return;\n\n        if ([9, 38, 40, 37, 39].indexOf(evt.keyCode) === -1)\n            return;\n\n        evt.preventDefault();\n        evt.stopPropagation();\n\n        let selectedItem: Nullable<TreeItem> = null;\n        let item: Nullable<TreeItem> = null;\n        switch (evt.keyCode) {\n            case 9: // tab\n                break;\n            case 40: // down\n                let downItem = currentItem.element!.nextElementSibling;\n                if (downItem)\n                    item = <TreeItem>(<HTMLElement>downItem).ui;\n\n                if (currentItem._children && currentItem.open) {\n                    let first = currentItem.element!.firstElementChild!.nextElementSibling;\n                    if (first && (<HTMLElement>first).ui) {\n                        selectedItem = <TreeItem>(<HTMLElement>first).ui;\n                        // first.ui.selected = true;\n                    } else if (item) {\n                        selectedItem = item;\n                        // item.selected = true;\n                    }\n                } else if (item) {\n                    selectedItem = item;\n                    // item.selected = true;\n                } else if (currentItem.parent && currentItem.parent instanceof TreeItem) {\n                    let parent: Nullable<TreeItem> = currentItem.parent;\n\n                    let findNext = function (from: TreeItem): Nullable<TreeItem> {\n                        let next = from.next;\n                        if (next) {\n                            selectedItem = next;\n                            // next.selected = true;\n                        } else if (from.parent instanceof TreeItem) {\n                            return from.parent;\n                        }\n                        return null;\n                    };\n                    parent = findNext(parent);\n                    while (parent) {\n                        parent = findNext(parent);\n                    }\n                }\n                break;\n            case 38: // up\n                let itemUp = currentItem.element!.previousElementSibling;\n                if (itemUp)\n                    item = <TreeItem>(<HTMLElement>itemUp).ui;\n\n                if (item) {\n                    if (item._children && item.open && item !== currentItem.parent) {\n                        let lastItem = item.element!.lastElementChild;\n                        let last: Nullable<TreeItem> = null;\n                        if (lastItem && (<HTMLElement>lastItem).ui)\n                            last = <TreeItem>(<HTMLElement>lastItem).ui;\n\n                        if (last) {\n                            let findLast = function (inside: TreeItem): Nullable<TreeItem> {\n                                if (inside._children && inside.open) {\n                                    if (inside.element!.lastElementChild && (<HTMLElement>inside.element!.lastElementChild).ui) {\n                                        return <TreeItem>(<HTMLElement>inside.element!.lastElementChild).ui;\n                                    }\n                                    return null;\n                                } else {\n                                    return null;\n                                }\n                            }\n\n                            let found: boolean = false;\n                            while (!found) {\n                                let deeper: Nullable<TreeItem> = findLast(last);\n                                if (deeper) {\n                                    last = deeper\n                                } else {\n                                    found = true;\n                                }\n                            }\n\n                            selectedItem = last;\n                            // last.selected = true;\n                        } else {\n                            selectedItem = item;\n                            // item.selected = true;\n                        }\n                    } else {\n                        selectedItem = item;\n                        // item.selected = true;\n                    }\n                } else if (currentItem.parent && currentItem.parent instanceof TreeItem) {\n                    selectedItem = currentItem.parent;\n                    // this.ui.parent.selected = true;\n                }\n\n                break;\n            case 37: // left (close)\n                if (currentItem.parent !== currentItem.tree && currentItem.open)\n                    currentItem.open = false;\n                break;\n            case 39: // right (open)\n                if (currentItem._children && !currentItem.open)\n                    currentItem.open = true;\n                break;\n        }\n\n        if (selectedItem) {\n            if (!(Tree._ctrl && Tree._ctrl()) && !(Tree._shift && Tree._shift()))\n                currentItem.tree!.clear();\n            selectedItem.selected = true;\n        }\n    }\n\n    private _onRename(select: boolean): void {\n        if (select) {\n            this.tree!.clear();\n            this.tree!._onItemClick(this);\n        }\n\n        var self = this;\n        this.class!.add('rename');\n        // console.log('tree item rename');\n        // add remaning field\n        var field = new TextField();\n        field.parent = this;\n        field.renderChanges = false;\n        field.value = this.text;\n        // field.elementInput.readOnly = !this.tree!.allowRenaming;\n        field.elementInput.addEventListener('blur', function () {\n            field.destroy();\n            self.class!.remove('rename');\n        }, false);\n        field.on('click', function (evt: MouseEvent) {\n            evt.stopPropagation();\n        });\n        field.element!.addEventListener('dblclick', function (evt) {\n            evt.stopPropagation();\n        });\n        field.on('change', function (value: string) {\n            value = value.trim();\n            if (value) {\n                // 关联observer\n                if (self.entity) {\n                  self.entity.set('name', value);\n                }\n                self.emit('rename', value);\n            }\n\n            field.destroy();\n            self.class!.remove('rename');\n        });\n        this.elementTitle.appendChild(field.element!);\n        field.elementInput.focus();\n        field.elementInput.select();\n    }\n\n    private _onDestroy(): void {\n        this.elementTitle.removeEventListener('click', this._onClick);\n        this.elementTitle.removeEventListener('dblclick', this._onDblClick);\n        this.elementTitle.removeEventListener('mousedown', this._onMouseDown);\n        this.elementTitle.removeEventListener('dragstart', this._onDragStart);\n        this.elementTitle.removeEventListener('mouseover', this._onMouseOver);\n        this.elementTitle.removeEventListener('keydown', this._onKeyDown);\n    }\n\n    private _onAppend(item: TreeItem): void {\n        if (this.parent)\n            this.parent.emit('append', item);\n    }\n\n    private _onRemove(item: TreeItem): void {\n        if (this.parent)\n            this.parent.emit('remove', item);\n    }\n\n\n    public focus(): void {\n        this.elementTitle.focus();\n    }\n\n    public append(item: TreeItem): void {\n        if (this._children === 1) {\n            this.element!.children[1].classList.remove('single');\n        }\n\n        item.parent = this;\n        this.element!.appendChild(item.element!);\n        this._children++;\n\n        if (this._children === 1) {\n            item.class!.add('single');\n            this.class!.add('container');\n        } else if (this._children > 1) {\n            item.class!.remove('single');\n        }\n\n        let appendChildren = function (treeItem: TreeItem): void {\n            treeItem.emit('append', treeItem);\n\n            if (treeItem._children) {\n                for (let i = 1; i < treeItem.element!.children.length; i++) {\n                    appendChildren(<TreeItem>(<HTMLElement>treeItem.element!.children[i]).ui);\n                }\n            }\n        };\n        appendChildren(item);\n    }\n\n    public appendBefore(item: TreeItem, referenceItem: TreeItem): void {\n        if (this._children === 1) {\n            this.element!.children[1].classList.remove('single');\n        }\n\n        item.parent = this;\n        this.element!.insertBefore(item.element!, referenceItem.element);\n        this._children++;\n\n        if (this._children === 1) {\n            item.class!.add('single');\n            this.class!.add('container');\n        } else if (this._children > 1) {\n            item.class!.remove('single');\n        }\n\n        var appendChildren = function (treeItem: TreeItem): void {\n            treeItem.emit('append', treeItem);\n\n            if (treeItem._children) {\n                for (var i = 1; i < treeItem.element!.children.length; i++) {\n                    appendChildren(<TreeItem>(<HTMLElement>treeItem.element!.children[i]).ui);\n                }\n            }\n        };\n        appendChildren(item);\n    }\n\n    public appendAfter(item: TreeItem, referenceItem: TreeItem): void {\n        item.parent = this;\n\n        // might be last\n        if (!referenceItem)\n            this.append(item);\n\n        this.element!.insertBefore(item.element!, referenceItem.element!.nextElementSibling);\n        this._children++;\n\n        if (this._children === 1) {\n            item.class!.add('single');\n            this.class!.add('container');\n        } else if (this._children === 2) {\n            this.element!.children[1].classList.remove('single');\n        }\n\n        var appendChildren = function (treeItem: TreeItem): void {\n            treeItem.emit('append', treeItem);\n\n            if (treeItem._children) {\n                for (var i = 1; i < treeItem.element!.children.length; i++) {\n                    appendChildren(<TreeItem>(<HTMLElement>treeItem.element!.children[i]).ui);\n                }\n            }\n        };\n        appendChildren(item);\n    }\n\n\n    public remove(item: TreeItem): void {\n        if (!this._children || !this.element!.contains(item.element))\n            return;\n\n        this.element!.removeChild(item.element!);\n        this._children--;\n\n        if (this._children === 0) {\n            this.class!.remove('container');\n        } else if (this._children === 1 && this.element!.children.length > 2) {\n            this.element!.children[1].classList.add('single');\n        }\n\n        let removeChildren = function (treeItem: TreeItem): void {\n            treeItem.emit('remove', treeItem);\n\n            if (treeItem._children) {\n                for (let i: number = 1; i < treeItem.element!.children.length; i++) {\n                    if ((<HTMLElement>treeItem.element!.children[i]).ui && (<HTMLElement>treeItem.element!.children[i]).ui instanceof TreeItem) {\n                        removeChildren(<TreeItem>(<HTMLElement>treeItem.element!.children[i]).ui);\n                    }\n                }\n            }\n        };\n        removeChildren(item);\n    }\n}","import { ContainerElement } from \"./container-element\";\nimport { TreeItem } from \"./tree-item\";\nimport { Hotkeys } from \"../editor\";\nimport { Element } from \"./element\";\nimport { TopElement } from \"./top\";\n\nexport class Tree extends ContainerElement {\n\n    private elementDrag: HTMLElement;\n    public draggable: boolean;\n    public _dragging: boolean;\n    public _dragItems: TreeItem[] = [];\n    public _dragOver: Nullable<TreeItem>;\n    private _dragArea: string;\n    private _evtDragMove: any;\n    public reordering: boolean;\n    public dragInstant: boolean;\n    private _selected: TreeItem[] = [];\n\n    public allowRenaming: boolean = true;\n\n    public get selected(): TreeItem[] {\n        return this._selected.slice(0);\n    }\n\n    public constructor() {\n        super();\n\n        this.element = document.createElement('div');\n        this.element.classList.add('ui-tree');\n\n        this.innerElement = this.element;\n\n\n        this.elementDrag = document.createElement('div');\n        this.elementDrag.classList.add('drag-handle');\n        this.element.appendChild(this.elementDrag);\n\n        let self = this;\n        this.elementDrag.addEventListener('mousemove', function (evt: MouseEvent): void {\n            evt.preventDefault();\n            evt.stopPropagation();\n\n            self._onDragMove(evt);\n        });\n        this.element.addEventListener('mouseleave', function (evt: MouseEvent): void {\n            self._onDragOut();\n        });\n\n        this.on('select', this._onSelect);\n        this.on('deselect', this._onDeselect);\n        this.on('append', this._onAppend);\n        this.on('remove', this._onRemove);\n\n        this.draggable = true;\n        this._dragging = false;\n        this._dragItems = [];\n        this._dragOver = null;\n        this._dragArea = 'inside';\n        this._evtDragMove = null;\n        this.reordering = true;\n        this.dragInstant = true;\n\n        this._selected = [];\n\n    }\n\n    public static _ctrl(): boolean {\n        return Hotkeys.ctrl;\n    }\n\n    public static _shift(): boolean {\n        return Hotkeys.shift;\n    }\n\n\n    private _onDragMove(evt: MouseEvent): void {\n        if (!this.draggable)\n            return;\n\n        this._hoverCalculate(evt);\n        this.emit('dragmove', evt);\n    }\n\n    private _hoverCalculate(evt: MouseEvent): void {\n        if (!this.draggable || !this._dragOver)\n            return;\n\n        let rect = this.elementDrag.getBoundingClientRect();\n        let area: number = Math.floor((evt.clientY - rect.top) / rect.height * 5);\n\n        let oldArea = this._dragArea;\n        let oldDragOver = this._dragOver;\n\n        if (this._dragOver.parent === this) {\n            let parent = false;\n            for (let i = 0; i < this._dragItems.length; i++) {\n                if (this._dragItems[i].parent === this._dragOver) {\n                    parent = true;\n                    this._dragOver = null;\n                    break;\n                }\n            }\n            if (!parent)\n                this._dragArea = 'inside';\n        } else {\n            // check if we are trying to drag item inside any of its children\n            let invalid = false;\n            for (let i = 0; i < this._dragItems.length; i++) {\n                let parent = this._dragOver.parent;\n                while (parent) {\n                    if (parent === this._dragItems[i]) {\n                        invalid = true;\n                        break;\n                    }\n\n                    parent = parent.parent;\n                }\n            }\n\n            if (invalid) {\n                this._dragOver = null;\n            } else if (this.reordering && area <= 1 && this._dragItems.indexOf(this._dragOver.prev!) === -1) {\n                this._dragArea = 'before';\n            } else if (this.reordering && area >= 4 && this._dragItems.indexOf(this._dragOver.next!) === -1 && (this._dragOver._children === 0 || !this._dragOver.open)) {\n                this._dragArea = 'after';\n            } else {\n                let parent = false;\n                if (this.reordering && this._dragOver.open) {\n                    for (let i = 0; i < this._dragItems.length; i++) {\n                        if (this._dragItems[i].parent === this._dragOver) {\n                            parent = true;\n                            this._dragArea = 'before';\n                            break;\n                        }\n                    }\n                }\n                if (!parent)\n                    this._dragArea = 'inside';\n            }\n        }\n\n        if (oldArea !== this._dragArea || oldDragOver !== this._dragOver)\n            this._updateDragHandle();\n    }\n\n\n    public _onItemClick(item: TreeItem): void {\n        if (Tree._ctrl && Tree._ctrl()) {\n            // 按住ctrl键，针对某个item，按第1次选中，按第2次取消选中\n            item.selected = !item.selected;\n        } else if (Tree._shift && Tree._shift() && this._selected.length) {\n            // shift按住以后，往上往下都可进行选择，不断添加选择项，不减少\n            //   console.log('shift按钮')\n            let from: TreeItem = this._selected[this._selected.length - 1];\n            let to: TreeItem = item;\n\n            let up: TreeItem[] = [];\n            let down: TreeItem[] = [];\n\n            let prev = function (refItem: TreeItem): Nullable<TreeItem> {\n                if (!refItem) return null;\n                let result: Nullable<TreeItem> = null;\n                let prevItem = refItem.element!.previousElementSibling;\n                let item: Nullable<TreeItem> = null;\n                if (prevItem) item = <TreeItem>(<HTMLElement>prevItem).ui;\n\n                if (item) {\n                    if (refItem.parent && refItem.parent === item && refItem.parent instanceof TreeItem) {\n                        result = refItem.parent;\n                    } else if (item.open && item._children) {  // 没有open貌似就没有选中\n                        // element above is open, find last available element\n                        let lastItem = item.element!.lastElementChild;\n                        let last: Nullable<TreeItem> = null;\n                        if (lastItem && (<HTMLElement>lastItem).ui)\n                            last = <TreeItem>(<HTMLElement>lastItem).ui;\n\n                        if (last) {\n                            let findLast = function (inside: Nullable<TreeItem>) {\n                                if (inside && inside.open && inside._children) {\n                                    if (inside.element!.lastElementChild && (<HTMLElement>inside.element!.lastChild).ui) {\n                                        return <TreeItem>(<HTMLElement>inside.element!.lastChild).ui;\n                                    } else {\n                                        return null;\n                                    }\n                                } else {\n                                    return null;\n                                }\n                            }\n\n                            let found: boolean = false;\n                            while (!found) {\n                                let deeper: Nullable<TreeItem> = findLast(last);\n                                if (deeper) {\n                                    last = deeper;\n                                } else {\n                                    found = true;\n                                }\n                            }\n\n                            result = last;\n                        } else {\n                            result = item;\n                        }\n                    } else {\n                        result = item;\n                    }\n                }\n\n                return result;\n            };\n\n            let next = function (refItem: TreeItem): Nullable<TreeItem> {\n                let result: Nullable<TreeItem> = null;\n                let nextItem = refItem.element!.nextElementSibling;\n                let item: Nullable<TreeItem> = null;\n                if (nextItem) item = <TreeItem>(<HTMLElement>nextItem).ui;\n\n                if (refItem.open && refItem._children) {\n                    // select a child\n                    let first = refItem.element!.firstElementChild!.nextElementSibling;\n                    if (first && (<HTMLElement>first).ui) {\n                        result = <TreeItem>(<HTMLElement>first).ui;\n                    } else if (item) {\n                        result = item;\n                    }\n                } else if (item) {\n                    // select next item\n                    result = item;\n                } else if (refItem.parent && refItem.parent instanceof TreeItem) {\n                    // no next element, go to parent\n                    let parent: Nullable<TreeItem> = refItem.parent;\n\n                    let findNext = function (from: TreeItem): Nullable<TreeItem> {\n                        let next: Nullable<TreeItem> = from.next;\n                        if (next) {\n                            result = next;\n                        } else if (from.parent instanceof TreeItem) {\n                            return from.parent;\n                        }\n                        return null;\n                    }\n                    parent = findNext(parent);\n                    while (parent) {\n                        parent = findNext(parent);\n                    }\n                }\n\n                return result;\n            };\n\n            let done: boolean = false;\n            let path: TreeItem[] = [];\n            let lookUp: boolean = true;\n            let lookDown: boolean = true;\n            let lookingUp: boolean = true;\n            // TODO\n            while (!done) {\n                lookingUp = !lookingUp;\n\n                let item: Nullable<TreeItem> = null;\n                let lookFrom: TreeItem = from;\n                if ((!lookDown || lookingUp) && lookUp) {\n                    // up\n                    if (up.length)\n                        lookFrom = up[up.length - 1];\n\n                    item = prev(lookFrom);\n                    if (item) {\n                        up.push(item);\n\n                        if (item === to) {\n                            done = true;\n                            path = up;\n                            break;\n                        }\n                    } else {\n                        lookUp = false;\n                    }\n                } else if (lookDown) {\n                    // down\n                    if (down.length)\n                        lookFrom = down[down.length - 1];\n\n                    item = next(lookFrom);\n                    if (item) {\n                        down.push(item);\n\n                        if (item === to) {\n                            done = true;\n                            path = down;\n                            break;\n                        }\n                    } else {\n                        lookDown = false;\n                    }\n                } else {\n                    done = true;\n                }\n            }\n\n            if (path) {\n                for (let i = 0; i < path.length; i++) {\n                    path[i].selected = true;\n                }\n            }\n\n\n        } else {\n            let selected: boolean = item.selected && ((this._selected.indexOf(item) === -1) || (this._selected.length === 1 && this._selected[0] === item));\n            this.clear();\n\n            if (!selected)\n                item.selected = true;\n        }\n    }\n\n    private _onSelect(item: TreeItem): void {\n        this._selected.push(item);\n    }\n\n    private _onDeselect(item: TreeItem): void {\n        let index: number = this._selected.indexOf(item);\n        if (index === -1)\n            return;\n\n        this._selected.splice(index, 1);\n    }\n\n\n    private _onDragStart(item: TreeItem): void {\n        if (!this.draggable || this._dragging)\n            return;\n\n        this._dragItems = [];\n\n        if (this._selected && this._selected.length > 1 && this._selected.indexOf(item) !== -1) {\n            let items: TreeItem[] = [];\n            let index: { [key: number]: TreeItem } = {};\n            let defaultLevel = -1;\n\n            // build index\n            for (let i: number = 0; i < this._selected.length; i++) {\n                // cant drag parent\n                if (this._selected[i].parent === this)\n                    return;\n\n                this._selected[i]._dragId = i + 1;\n                index[this._selected[i]._dragId] = this._selected[i];\n            }\n\n            for (let i: number = 0; i < this._selected.length; i++) {\n                let s: TreeItem = this._selected[i];\n                let level: number = 0;\n                let child: boolean = false;\n                let parent: Nullable<Element> | Nullable<TopElement> = this._selected[i].parent;\n                if (!parent || !(parent instanceof TreeItem))\n                    parent = null;\n\n                while (parent) {\n                    if (parent._dragId && index[parent._dragId]) {\n                        // child, to be ignored\n                        child = true;\n                        break;\n                    }\n\n                    parent = parent.parent;\n                    if (!(parent instanceof TreeItem)) {\n                        parent = null;\n                        break;\n                    }\n\n                    level++;\n                }\n\n                if (!child) {\n                    if (defaultLevel === -1) {\n                        defaultLevel = level;\n                    } else if (defaultLevel !== level) {\n                        // multi-level drag no allowed\n                        return;\n                    }\n\n                    items.push(this._selected[i]);\n                }\n            }\n\n            // clean ids\n            for (let i: number = 0; i < this._selected.length; i++)\n                this._selected[i]._dragId = -1;\n\n            this._dragItems = items;\n\n            // sort items by their number of apperance in hierarchy\n            if (items.length > 1) {\n                let commonParent: Nullable<TreeItem> = null;\n\n                // find common parent\n                let findCommonParent = function (items: TreeItem[]): TreeItem[] {\n                    let parents: TreeItem[] = [];\n                    for (let i: number = 0; i < items.length; i++) {\n                        if (items[i].parent && items[i].parent instanceof TreeItem) {\n                            if (parents.indexOf(<TreeItem>items[i].parent) === -1)\n                                parents.push(<TreeItem>items[i].parent);\n                        }\n                    }\n                    if (parents.length === 1) {\n                        commonParent = parents[0];\n                    }\n                    return parents;\n                };\n                let parents: TreeItem[] = items;\n                while (!commonParent && parents)\n                    parents = findCommonParent(parents);\n\n                // calculate ind number\n                for (let i: number = 0; i < items.length; i++) {\n                    let ind: number = 0;\n\n                    let countChildren = function (item: TreeItem): number {\n                        if (!item._children) {\n                            return 0;\n                        } else {\n                            let count: number = 0;\n                            let children = item.element!.children;\n                            for (let i: number = 0; i < children.length; i++) {\n                                if ((<HTMLElement>children[i]).ui && (<HTMLElement>children[i]).ui instanceof TreeItem)\n                                    count += countChildren(<TreeItem>(<HTMLElement>children[i]).ui) + 1;\n                            }\n                            return count;\n                        }\n                    };\n\n                    let scanUpForIndex = function (item: TreeItem): Nullable<TreeItem> {\n                        ind++;\n                        let sibling = item.element!.previousElementSibling;\n                        let siblingItem: Nullable<TreeItem> = null;\n                        if (sibling && (<HTMLElement>sibling).ui && (<HTMLElement>sibling).ui instanceof TreeItem) {\n                            siblingItem = <TreeItem>(<HTMLElement>sibling).ui;\n                        }\n\n                        if (siblingItem) {\n                            ind += countChildren(siblingItem);\n                            return siblingItem;\n                        } else if (item.parent === commonParent) {\n                            return null;\n                        } else {\n                            if (item.parent instanceof TreeItem) {\n                                return <TreeItem>item.parent;\n                            } else {\n                                return null;\n                            }\n                        }\n                    };\n\n                    let prev: Nullable<TreeItem> = scanUpForIndex(items[i]);\n                    while (prev)\n                        prev = scanUpForIndex(prev);\n\n                    items[i]._dragId = ind;\n                }\n\n                items.sort(function (a, b) {\n                    return a._dragId - b._dragId;\n                });\n            }\n        } else {\n            // single drag\n            this._dragItems = [item];\n        }\n\n        if (this._dragItems.length) {\n            this._dragging = true;\n\n            this.class!.add('dragging');\n            for (let i: number = 0; i < this._dragItems.length; i++) {\n                this._dragItems[i].class!.add('dragged');\n            }\n\n            this._updateDragHandle();\n            this.emit('dragstart');\n        }\n    }\n\n    private _onDragOver(item: TreeItem, evt: MouseEvent): void {\n        if (!this.draggable || !this._dragging || (this._dragItems.indexOf(item) !== -1 && !this._dragOver) || this._dragOver === item)\n            return;\n\n        let dragOver = null;\n\n        if (item.allowDrop) {\n            if (this._dragItems.indexOf(item) === -1)\n                dragOver = item;\n\n            if (this._dragOver === null && dragOver)\n                this.emit('dragin');\n        }\n\n\n\n        this._dragOver = dragOver;\n\n        this._updateDragHandle();\n        this._onDragMove(evt);\n    }\n\n    private _onDragEnd(): void {\n        if (!this.draggable || !this._dragging)\n            return;\n\n\n        // TODO：UI元素不能随便拖动\n        let reparentedItems: ReparentDragItems[] = [];\n        this._dragging = false;\n        this.class!.remove('dragging');\n\n        let lastDraggedItem: Nullable<TreeItem> = this._dragOver;\n\n        for (let i: number = 0; i < this._dragItems.length; i++) {\n            this._dragItems[i].class!.remove('dragged');\n\n            if (this._dragOver && this._dragOver !== this._dragItems[i]) {\n\n                let oldParent: Nullable<Element> | Nullable<TopElement> = this._dragItems[i].parent;\n\n                if (oldParent !== this._dragOver || this._dragArea !== 'inside') {\n                    let newParent: Nullable<Element> | Nullable<TopElement> = null;\n\n                    // if (this.dragInstant) {\n                    //     if (this._dragItems[i].parent) {\n                    //         (<TreeItem>(this._dragItems[i].parent!)).remove(this._dragItems[i]);\n                    //     }\n                    // }\n\n                    if (this._dragArea === 'before') {\n                        newParent = this._dragOver.parent;\n                        if (this.dragInstant) {\n                            let allow = editor.call('item:drag:allow', this._dragItems[i].entity, (<TreeItem>this._dragOver).entity, 'before');\n                            if (allow) {\n                                if (this._dragItems[i].parent) {\n                                    (<TreeItem>(this._dragItems[i].parent!)).remove(this._dragItems[i]);\n                                }\n                                (<TreeItem>this._dragOver.parent).appendBefore(this._dragItems[i], this._dragOver);\n                                editor.call('status:text', 'VeRyEngine');\n                            } else {\n                                editor.call('status:error', '当前选中物体不允许拖拽到目标物体！');\n                                return;\n                            }\n                        }\n                    } else if (this._dragArea === 'inside') {\n                        newParent = this._dragOver;\n                        if (this.dragInstant) {\n                            let allow = editor.call('item:drag:allow', this._dragItems[i].entity, (<TreeItem>this._dragOver).entity, 'inside');\n                            if (allow) {\n                                if (this._dragItems[i].parent) {\n                                    (<TreeItem>(this._dragItems[i].parent!)).remove(this._dragItems[i]);\n                                }\n                                this._dragOver.open = true;\n                                this._dragOver.append(this._dragItems[i]);\n                                editor.call('status:text', 'VeRyEngine');\n                            } else {\n                                editor.call('status:error', '当前选中物体不允许拖拽到目标物体！');\n                                return;\n                            }\n                        }\n                    } else if (this._dragArea === 'after') {\n                        newParent = this._dragOver.parent;\n                        if (this.dragInstant) {\n                            let allow = editor.call('item:drag:allow', this._dragItems[i].entity, (<TreeItem>this._dragOver).entity, 'after');\n                            if (allow) {\n                                if (this._dragItems[i].parent) {\n                                    (<TreeItem>(this._dragItems[i].parent!)).remove(this._dragItems[i]);\n                                }\n                                (<TreeItem>this._dragOver.parent).appendAfter(this._dragItems[i], lastDraggedItem!);\n                                lastDraggedItem = this._dragItems[i];\n                                editor.call('status:text', 'VeRyEngine');\n                            } else {\n                                editor.call('status:error', '当前选中物体不允许拖拽到目标物体！');\n                                return;\n                            }\n                        }\n                    }\n\n                    reparentedItems.push({\n                        item: this._dragItems[i],\n                        old: oldParent,\n                        new: newParent\n                    });\n                }\n            }\n        }\n\n        this.emit('reparent', reparentedItems);\n\n        this._dragItems = [];\n\n        if (this._dragOver)\n            this._dragOver = null;\n\n        this.emit('dragend');\n\n    }\n\n    private _onDragOut(): void {\n        if (!this.draggable || !this._dragging || !this._dragOver)\n            return;\n\n        this._dragOver = null;\n        this._updateDragHandle();\n        this.emit('dragout');\n    }\n\n    public _updateDragHandle(): void {\n        if (!this.draggable || !this._dragging)\n            return;\n\n        if (!this._dragOver) {\n            this.elementDrag.classList.add('hidden');\n        } else {\n            let rect = this._dragOver.elementTitle.getBoundingClientRect();\n\n            this.elementDrag.classList.remove('before', 'inside', 'after', 'hidden')\n            this.elementDrag.classList.add(this._dragArea);\n\n            this.elementDrag.style.top = rect.top + 'px';\n            this.elementDrag.style.left = rect.left + 'px';\n            this.elementDrag.style.width = (rect.width - 4) + 'px';\n        }\n    }\n\n    private _onAppend(item: TreeItem): void {\n        // console.error('_onAppend');\n        item.tree = this;\n\n        let self = this;\n\n        item.on('dragstart', function () {\n            // can't drag root  TODO\n            if (item.parent === self)\n                return;\n\n            self._onDragStart(item);\n        });\n\n        item.on('mouseover', function (evt: MouseEvent) {\n            self._onDragOver(item, evt);\n        });\n\n        item.on('dragend', function () {\n            self._onDragEnd();\n        });\n    }\n\n    private _onRemove(item: TreeItem): void {\n        item.tree = null;\n        item.unbind('dragstart');\n        item.unbind('mouseover');\n        item.unbind('dragend');\n    }\n\n\n    public clear(): void {\n        if (!this._selected.length)\n            return;\n\n        let i: number = this._selected.length;\n        while (i--) {\n            this._selected[i].selected = false;\n        }\n        this._selected = [];\n    }\n\n\n}\n\n\n\nexport interface ReparentDragItems {\n    item: TreeItem;\n    old: Nullable<Element> | Nullable<TopElement>;\n    new: Nullable<Element> | Nullable<TopElement>;\n}"]}