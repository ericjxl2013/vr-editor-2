!function r(a,s,l){function c(t,e){if(!s[t]){if(!a[t]){var n="function"==typeof require&&require;if(!e&&n)return n(t,!0);if(d)return d(t,!0);var i=new Error("Cannot find module '"+t+"'");throw i.code="MODULE_NOT_FOUND",i}var o=s[t]={exports:{}};a[t][0].call(o.exports,function(e){return c(a[t][1][e]||e)},o,o.exports,r,a,s,l)}return s[t].exports}for(var d="function"==typeof require&&require,e=0;e<l.length;e++)c(l[e]);return c}({1:[function(e,t,n){var i,o,r=t.exports={};function a(){throw new Error("setTimeout has not been defined")}function s(){throw new Error("clearTimeout has not been defined")}function l(t){if(i===setTimeout)return setTimeout(t,0);if((i===a||!i)&&setTimeout)return i=setTimeout,setTimeout(t,0);try{return i(t,0)}catch(e){try{return i.call(null,t,0)}catch(e){return i.call(this,t,0)}}}!function(){try{i="function"==typeof setTimeout?setTimeout:a}catch(e){i=a}try{o="function"==typeof clearTimeout?clearTimeout:s}catch(e){o=s}}();var c,d=[],u=!1,h=-1;function p(){u&&c&&(u=!1,c.length?d=c.concat(d):h=-1,d.length&&f())}function f(){if(!u){var e=l(p);u=!0;for(var t=d.length;t;){for(c=d,d=[];++h<t;)c&&c[h].run();h=-1,t=d.length}c=null,u=!1,function(t){if(o===clearTimeout)return clearTimeout(t);if((o===s||!o)&&clearTimeout)return o=clearTimeout,clearTimeout(t);try{o(t)}catch(e){try{return o.call(null,t)}catch(e){return o.call(this,t)}}}(e)}}function m(e,t){this.fun=e,this.array=t}function g(){}r.nextTick=function(e){var t=new Array(arguments.length-1);if(1<arguments.length)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];d.push(new m(e,t)),1!==d.length||u||l(f)},m.prototype.run=function(){this.fun.apply(null,this.array)},r.title="browser",r.browser=!0,r.env={},r.argv=[],r.version="",r.versions={},r.on=g,r.addListener=g,r.once=g,r.off=g,r.removeListener=g,r.removeAllListeners=g,r.emit=g,r.prependListener=g,r.prependOnceListener=g,r.listeners=function(e){return[]},r.binding=function(e){throw new Error("process.binding is not supported")},r.cwd=function(){return"/"},r.chdir=function(e){throw new Error("process.chdir is not supported")},r.umask=function(){return 0}},{}],2:[function(e,n,i){!function(e){if("object"==typeof i)n.exports=e();else if("function"==typeof define&&define.amd)define(e);else{var t;try{t=window}catch(e){t=self}t.SparkMD5=e()}}(function(c){"use strict";var i=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"];function d(e,t){var n=e[0],i=e[1],o=e[2],r=e[3],i=((i+=((o=((o+=((r=((r+=((n=((n+=(i&o|~i&r)+t[0]-680876936|0)<<7|n>>>25)+i|0)&i|~n&o)+t[1]-389564586|0)<<12|r>>>20)+n|0)&n|~r&i)+t[2]+606105819|0)<<17|o>>>15)+r|0)&r|~o&n)+t[3]-1044525330|0)<<22|i>>>10)+o|0;i=((i+=((o=((o+=((r=((r+=((n=((n+=(i&o|~i&r)+t[4]-176418897|0)<<7|n>>>25)+i|0)&i|~n&o)+t[5]+1200080426|0)<<12|r>>>20)+n|0)&n|~r&i)+t[6]-1473231341|0)<<17|o>>>15)+r|0)&r|~o&n)+t[7]-45705983|0)<<22|i>>>10)+o|0,i=((i+=((o=((o+=((r=((r+=((n=((n+=(i&o|~i&r)+t[8]+1770035416|0)<<7|n>>>25)+i|0)&i|~n&o)+t[9]-1958414417|0)<<12|r>>>20)+n|0)&n|~r&i)+t[10]-42063|0)<<17|o>>>15)+r|0)&r|~o&n)+t[11]-1990404162|0)<<22|i>>>10)+o|0,i=((i+=((o=((o+=((r=((r+=((n=((n+=(i&o|~i&r)+t[12]+1804603682|0)<<7|n>>>25)+i|0)&i|~n&o)+t[13]-40341101|0)<<12|r>>>20)+n|0)&n|~r&i)+t[14]-1502002290|0)<<17|o>>>15)+r|0)&r|~o&n)+t[15]+1236535329|0)<<22|i>>>10)+o|0,i=((i+=((o=((o+=((r=((r+=((n=((n+=(i&r|o&~r)+t[1]-165796510|0)<<5|n>>>27)+i|0)&o|i&~o)+t[6]-1069501632|0)<<9|r>>>23)+n|0)&i|n&~i)+t[11]+643717713|0)<<14|o>>>18)+r|0)&n|r&~n)+t[0]-373897302|0)<<20|i>>>12)+o|0,i=((i+=((o=((o+=((r=((r+=((n=((n+=(i&r|o&~r)+t[5]-701558691|0)<<5|n>>>27)+i|0)&o|i&~o)+t[10]+38016083|0)<<9|r>>>23)+n|0)&i|n&~i)+t[15]-660478335|0)<<14|o>>>18)+r|0)&n|r&~n)+t[4]-405537848|0)<<20|i>>>12)+o|0,i=((i+=((o=((o+=((r=((r+=((n=((n+=(i&r|o&~r)+t[9]+568446438|0)<<5|n>>>27)+i|0)&o|i&~o)+t[14]-1019803690|0)<<9|r>>>23)+n|0)&i|n&~i)+t[3]-187363961|0)<<14|o>>>18)+r|0)&n|r&~n)+t[8]+1163531501|0)<<20|i>>>12)+o|0,i=((i+=((o=((o+=((r=((r+=((n=((n+=(i&r|o&~r)+t[13]-1444681467|0)<<5|n>>>27)+i|0)&o|i&~o)+t[2]-51403784|0)<<9|r>>>23)+n|0)&i|n&~i)+t[7]+1735328473|0)<<14|o>>>18)+r|0)&n|r&~n)+t[12]-1926607734|0)<<20|i>>>12)+o|0,i=((i+=((o=((o+=((r=((r+=((n=((n+=(i^o^r)+t[5]-378558|0)<<4|n>>>28)+i|0)^i^o)+t[8]-2022574463|0)<<11|r>>>21)+n|0)^n^i)+t[11]+1839030562|0)<<16|o>>>16)+r|0)^r^n)+t[14]-35309556|0)<<23|i>>>9)+o|0,i=((i+=((o=((o+=((r=((r+=((n=((n+=(i^o^r)+t[1]-1530992060|0)<<4|n>>>28)+i|0)^i^o)+t[4]+1272893353|0)<<11|r>>>21)+n|0)^n^i)+t[7]-155497632|0)<<16|o>>>16)+r|0)^r^n)+t[10]-1094730640|0)<<23|i>>>9)+o|0,i=((i+=((o=((o+=((r=((r+=((n=((n+=(i^o^r)+t[13]+681279174|0)<<4|n>>>28)+i|0)^i^o)+t[0]-358537222|0)<<11|r>>>21)+n|0)^n^i)+t[3]-722521979|0)<<16|o>>>16)+r|0)^r^n)+t[6]+76029189|0)<<23|i>>>9)+o|0,i=((i+=((o=((o+=((r=((r+=((n=((n+=(i^o^r)+t[9]-640364487|0)<<4|n>>>28)+i|0)^i^o)+t[12]-421815835|0)<<11|r>>>21)+n|0)^n^i)+t[15]+530742520|0)<<16|o>>>16)+r|0)^r^n)+t[2]-995338651|0)<<23|i>>>9)+o|0,i=((i+=((r=((r+=(i^((n=((n+=(o^(i|~r))+t[0]-198630844|0)<<6|n>>>26)+i|0)|~o))+t[7]+1126891415|0)<<10|r>>>22)+n|0)^((o=((o+=(n^(r|~i))+t[14]-1416354905|0)<<15|o>>>17)+r|0)|~n))+t[5]-57434055|0)<<21|i>>>11)+o|0,i=((i+=((r=((r+=(i^((n=((n+=(o^(i|~r))+t[12]+1700485571|0)<<6|n>>>26)+i|0)|~o))+t[3]-1894986606|0)<<10|r>>>22)+n|0)^((o=((o+=(n^(r|~i))+t[10]-1051523|0)<<15|o>>>17)+r|0)|~n))+t[1]-2054922799|0)<<21|i>>>11)+o|0,i=((i+=((r=((r+=(i^((n=((n+=(o^(i|~r))+t[8]+1873313359|0)<<6|n>>>26)+i|0)|~o))+t[15]-30611744|0)<<10|r>>>22)+n|0)^((o=((o+=(n^(r|~i))+t[6]-1560198380|0)<<15|o>>>17)+r|0)|~n))+t[13]+1309151649|0)<<21|i>>>11)+o|0,i=((i+=((r=((r+=(i^((n=((n+=(o^(i|~r))+t[4]-145523070|0)<<6|n>>>26)+i|0)|~o))+t[11]-1120210379|0)<<10|r>>>22)+n|0)^((o=((o+=(n^(r|~i))+t[2]+718787259|0)<<15|o>>>17)+r|0)|~n))+t[9]-343485551|0)<<21|i>>>11)+o|0,e[0]=n+e[0]|0,e[1]=i+e[1]|0,e[2]=o+e[2]|0,e[3]=r+e[3]|0}function u(e){for(var t=[],n=0;n<64;n+=4)t[n>>2]=e.charCodeAt(n)+(e.charCodeAt(n+1)<<8)+(e.charCodeAt(n+2)<<16)+(e.charCodeAt(n+3)<<24);return t}function h(e){for(var t=[],n=0;n<64;n+=4)t[n>>2]=e[n]+(e[n+1]<<8)+(e[n+2]<<16)+(e[n+3]<<24);return t}function o(e){for(var t,n,i,o,r,a=e.length,s=[1732584193,-271733879,-1732584194,271733878],l=64;l<=a;l+=64)d(s,u(e.substring(l-64,l)));for(t=(e=e.substring(l-64)).length,n=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],l=0;l<t;l+=1)n[l>>2]|=e.charCodeAt(l)<<(l%4<<3);if(n[l>>2]|=128<<(l%4<<3),55<l)for(d(s,n),l=0;l<16;l+=1)n[l]=0;return i=(i=8*a).toString(16).match(/(.*?)(.{0,8})$/),o=parseInt(i[2],16),r=parseInt(i[1],16)||0,n[14]=o,n[15]=r,d(s,n),s}function a(e){for(var t=0;t<e.length;t+=1)e[t]=function(e){for(var t="",n=0;n<4;n+=1)t+=i[e>>8*n+4&15]+i[e>>8*n&15];return t}(e[t]);return e.join("")}function p(e,t){return(e=0|e||0)<0?Math.max(e+t,0):Math.min(e,t)}function n(e){return/[\u0080-\uFFFF]/.test(e)&&(e=unescape(encodeURIComponent(e))),e}function s(e){for(var t=[],n=e.length,i=0;i<n-1;i+=2)t.push(parseInt(e.substr(i,2),16));return String.fromCharCode.apply(String,t)}function r(){this.reset()}return"5d41402abc4b2a76b9719d911017c592"!==a(o("hello"))&&0,"undefined"==typeof ArrayBuffer||ArrayBuffer.prototype.slice||(ArrayBuffer.prototype.slice=function(e,t){var n,i,o,r,a=this.byteLength,s=p(e,a),l=a;return t!==c&&(l=p(t,a)),l<s?new ArrayBuffer(0):(n=l-s,i=new ArrayBuffer(n),o=new Uint8Array(i),r=new Uint8Array(this,s,n),o.set(r),i)}),r.prototype.append=function(e){return this.appendBinary(n(e)),this},r.prototype.appendBinary=function(e){this._buff+=e,this._length+=e.length;for(var t=this._buff.length,n=64;n<=t;n+=64)d(this._hash,u(this._buff.substring(n-64,n)));return this._buff=this._buff.substring(n-64),this},r.prototype.end=function(e){for(var t,n=this._buff,i=n.length,o=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],r=0;r<i;r+=1)o[r>>2]|=n.charCodeAt(r)<<(r%4<<3);return this._finish(o,i),t=a(this._hash),e&&(t=s(t)),this.reset(),t},r.prototype.reset=function(){return this._buff="",this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},r.prototype.getState=function(){return{buff:this._buff,length:this._length,hash:this._hash.slice()}},r.prototype.setState=function(e){return this._buff=e.buff,this._length=e.length,this._hash=e.hash,this},r.prototype.destroy=function(){delete this._hash,delete this._buff,delete this._length},r.prototype._finish=function(e,t){var n,i,o,r=t;if(e[r>>2]|=128<<(r%4<<3),55<r)for(d(this._hash,e),r=0;r<16;r+=1)e[r]=0;n=(n=8*this._length).toString(16).match(/(.*?)(.{0,8})$/),i=parseInt(n[2],16),o=parseInt(n[1],16)||0,e[14]=i,e[15]=o,d(this._hash,e)},r.hash=function(e,t){return r.hashBinary(n(e),t)},r.hashBinary=function(e,t){var n=a(o(e));return t?s(n):n},(r.ArrayBuffer=function(){this.reset()}).prototype.append=function(e){var t,n,i,o,r,a=(n=this._buff.buffer,i=e,o=!0,(r=new Uint8Array(n.byteLength+i.byteLength)).set(new Uint8Array(n)),r.set(new Uint8Array(i),n.byteLength),o?r:r.buffer),s=a.length;for(this._length+=e.byteLength,t=64;t<=s;t+=64)d(this._hash,h(a.subarray(t-64,t)));return this._buff=t-64<s?new Uint8Array(a.buffer.slice(t-64)):new Uint8Array(0),this},r.ArrayBuffer.prototype.end=function(e){for(var t,n=this._buff,i=n.length,o=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],r=0;r<i;r+=1)o[r>>2]|=n[r]<<(r%4<<3);return this._finish(o,i),t=a(this._hash),e&&(t=s(t)),this.reset(),t},r.ArrayBuffer.prototype.reset=function(){return this._buff=new Uint8Array(0),this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},r.ArrayBuffer.prototype.getState=function(){var e,t=r.prototype.getState.call(this);return t.buff=(e=t.buff,String.fromCharCode.apply(null,new Uint8Array(e))),t},r.ArrayBuffer.prototype.setState=function(e){return e.buff=function(e,t){for(var n=e.length,i=new ArrayBuffer(n),o=new Uint8Array(i),r=0;r<n;r+=1)o[r]=e.charCodeAt(r);return t?o:i}(e.buff,!0),r.prototype.setState.call(this,e)},r.ArrayBuffer.prototype.destroy=r.prototype.destroy,r.ArrayBuffer.prototype._finish=r.prototype._finish,r.ArrayBuffer.hash=function(e,t){var n=a(function(e){for(var t,n,i,o,r,a=e.length,s=[1732584193,-271733879,-1732584194,271733878],l=64;l<=a;l+=64)d(s,h(e.subarray(l-64,l)));for(t=(e=l-64<a?e.subarray(l-64):new Uint8Array(0)).length,n=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],l=0;l<t;l+=1)n[l>>2]|=e[l]<<(l%4<<3);if(n[l>>2]|=128<<(l%4<<3),55<l)for(d(s,n),l=0;l<16;l+=1)n[l]=0;return i=(i=8*a).toString(16).match(/(.*?)(.{0,8})$/),o=parseInt(i[2],16),r=parseInt(i[1],16)||0,n[14]=o,n[15]=r,d(s,n),s}(new Uint8Array(e)));return t?s(n):n},r})},{}],3:[function(l,e,c){(function(e,t){var i=l("process/browser.js").nextTick,n=Function.prototype.apply,o=Array.prototype.slice,r={},a=0;function s(e,t){this._id=e,this._clearFn=t}c.setTimeout=function(){return new s(n.call(setTimeout,window,arguments),clearTimeout)},c.setInterval=function(){return new s(n.call(setInterval,window,arguments),clearInterval)},c.clearTimeout=c.clearInterval=function(e){e.close()},s.prototype.unref=s.prototype.ref=function(){},s.prototype.close=function(){this._clearFn.call(window,this._id)},c.enroll=function(e,t){clearTimeout(e._idleTimeoutId),e._idleTimeout=t},c.unenroll=function(e){clearTimeout(e._idleTimeoutId),e._idleTimeout=-1},c._unrefActive=c.active=function(e){clearTimeout(e._idleTimeoutId);var t=e._idleTimeout;0<=t&&(e._idleTimeoutId=setTimeout(function(){e._onTimeout&&e._onTimeout()},t))},c.setImmediate="function"==typeof e?e:function(e){var t=a++,n=!(arguments.length<2)&&o.call(arguments,1);return r[t]=!0,i(function(){r[t]&&(n?e.apply(null,n):e.call(null),c.clearImmediate(t))}),t},c.clearImmediate="function"==typeof t?t:function(e){delete r[e]}}).call(this,l("timers").setImmediate,l("timers").clearImmediate)},{"process/browser.js":1,timers:3}],4:[function(e,t,n){"use strict";var i=this&&this.__awaiter||function(e,a,s,l){return new(s=s||Promise)(function(n,t){function i(e){try{r(l.next(e))}catch(e){t(e)}}function o(e){try{r(l.throw(e))}catch(e){t(e)}}function r(e){var t;e.done?n(e.value):((t=e.value)instanceof s?t:new s(function(e){e(t)})).then(i,o)}r((l=l.apply(e,a||[])).next())})},c=this&&this.__generator||function(n,i){var o,r,a,s={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]},e={next:t(0),throw:t(1),return:t(2)};return"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(t){return function(e){return function(t){if(o)throw new TypeError("Generator is already executing.");for(;s;)try{if(o=1,r&&(a=2&t[0]?r.return:t[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,t[1])).done)return a;switch(r=0,a&&(t=[2&t[0],a.value]),t[0]){case 0:case 1:a=t;break;case 4:return s.label++,{value:t[1],done:!1};case 5:s.label++,r=t[1],t=[0];continue;case 7:t=s.ops.pop(),s.trys.pop();continue;default:if(!(a=0<(a=s.trys).length&&a[a.length-1])&&(6===t[0]||2===t[0])){s=0;continue}if(3===t[0]&&(!a||t[1]>a[0]&&t[1]<a[3])){s.label=t[1];break}if(6===t[0]&&s.label<a[1]){s.label=a[1],a=t;break}if(a&&s.label<a[2]){s.label=a[2],s.ops.push(t);break}a[2]&&s.ops.pop(),s.trys.pop();continue}t=i.call(n,s)}catch(e){t=[6,e],r=0}finally{o=a=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}([t,e])}}};Object.defineProperty(n,"__esModule",{value:!0}),n.InitializeData=void 0;function o(){var e=this;this.init=function(){return i(e,void 0,void 0,function(){var t,n,i,o,r,a,s,l;return c(this,function(e){switch(e.label){case 0:d.Config.projectID=window.location.pathname.substring(8),e.label=1;case 1:return e.trys.push([1,7,,8]),t=document.referrer,[4,p.login(d.Config.projectID,t)];case 2:return"00000"!==(n=e.sent()).code?[3,5]:(d.Config.projectName=n.data,document.title=d.Config.projectName+" - 万维引擎",editor.call("toolbar.project.set",d.Config.projectName),[4,p.getJsonConfig(d.Config.projectID,"assets")]);case 3:return""===(i=e.sent())?(p.upLoadJsonConfig(d.Config.assetStandard,d.Config.projectID,"assets"),d.Config.assetsData=JSON.parse(d.Config.assetStandard)):d.Config.assetsData=JSON.parse(i),u.BabylonLoader.assetsData=d.Config.assetsData,editor.call("initAssets",d.Config.assetsData),[4,p.getJsonConfig(d.Config.projectID,"scenes")];case 4:return""===(i=e.sent())&&(i=d.Config.sceneStandard,(o=JSON.parse(i)).scenes[0].id=h.UUid.createUuid().substring(0,8),r=h.UUid.createdAtTime(),o.scenes[0].projectId=d.Config.projectID,o.scenes[0].created=r,o.scenes[0].modified=r,i=JSON.stringify(o),p.upLoadJsonConfig(i,d.Config.projectID,"scenes")),a=JSON.parse(i),s=a.last,d.Config.scenesData=a.scenes[s],d.Config.sceneIndex=s,u.BabylonLoader.scenesData=d.Config.scenesData,u.BabylonLoader.sceneIndex=s,editor.emit("scene:raw",d.Config.scenesData),editor.call("toolbar.scene.set",d.Config.scenesData.name),[3,6];case 5:console.error(n.message),e.label=6;case 6:return[3,8];case 7:return l=e.sent(),console.error(l),[3,8];case 8:return[2]}})})},this.init()}var d=e("./global"),u=e("./middleware/loader/babylonLoader"),h=e("./utility/uuid"),p=e("../tools/ossfile");n.InitializeData=o},{"../tools/ossfile":150,"./global":66,"./middleware/loader/babylonLoader":86,"./utility/uuid":127}],5:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.AssetsContextMenu=void 0;function i(){var o=null,e=b.VeryEngine.root,r=[],i=new v.Menu;e.append(i);var a=new v.MenuItem({text:"New Script",icon:"&#57864;",value:"script"});a.on("select",function(){editor.call("picker:script-create",function(e){editor.call("assets:create:script",{filename:e,boilerplate:!0})})}),i.append(a);var s=new v.MenuItem({text:"添加资源",icon:"&#57632;",value:"new"});i.append(s);for(var l={upload:"&#57909;",folder:"&#57657;",table:"&#57864;",cubemap:"&#57879;",html:"&#57864;",json:"&#57864;",layers:"&#57992",material:"&#57749;",script:"&#57864;",shader:"&#57864;",text:"&#57864;",texture:"&#57857;",textureatlas:"&#57857;",model:"&#57735;",scene:"&#57735;",animation:"&#57875;",audio:"&#57872;",bundle:"&#58384;"},t="&#57640;",n="&#57648;",c="&#57638;",d="&#57636;",u={upload:"上传",folder:"新建文件夹",table:"表格"},h=Object.keys(u),p=0;p<h.length;p++)u.hasOwnProperty(h[p])&&function(t,e){var n=new v.MenuItem({text:e,icon:l[t]||"",value:t});n.on("select",function(){var e={};o&&"folder"===o.get("type")?e.parent=o:void 0===o&&(e.parent=null),"upload"===t?editor.call("assets:upload:picker",e):"script"===t?editor.call("picker:script-create",function(e){editor.call("assets:create:script",{filename:e,boilerplate:!0})}):editor.call("assets:create:"+t,e)}),s.append(n),"script"===t&&editor.on("repositories:load",function(e){"directory"!==e.get("current")&&(n.disabled=!0)})}(h[p],u[h[p]]);var f=new v.MenuItem({text:"加载",icon:t,value:"replace"});f.on("select",function(){editor.call("load:from:asset",o)}),i.append(f);var m=new v.MenuItem({text:"编辑",icon:n,value:"edit"});m.on("select",function(){editor.call("assets:open-table",o.get("name"))}),i.append(m);var g=new v.MenuItem({text:"创建副本",icon:c,value:"duplicate"});g.on("select",function(){editor.call("status:text","抱歉，创建副本功能待添加！"),editor.call("assets:duplicate",o)}),i.append(g);var y=new v.MenuItem({text:"删除",icon:d,value:"delete"});y.style.fontWeight="200",y.on("select",function(){editor.call("status:text","抱歉，删除功能待添加！");var e=o,t=!1;if(e){var n;e.get("type");if("asset"===editor.call("selector:type")){n=editor.call("selector:items");for(var i=0;i<n.length;i++)if(0,n[i].get("id")===e.get("id")){t=!0;break}}editor.call("assets:delete:picker",t?n:[e])}}),i.append(y),i.on("open",function(){var e,t,n;a.hidden=!((null===o||o&&"script"===o.get("type"))&&"scripts"===editor.call("assets:panel:currentFolder")),s.hidden=!a.hidden,o?("material"===o.get("type")||"sprite"===o.get("type")?(m.hidden=!0,"asset"===editor.call("selector:type")?(e=editor.call("selector:items"),g.hidden=1<e.length&&-1!==e.indexOf(o)):g.hidden=!1):g.hidden=!0,o.get("source")||-1===["html","table","json","text","script","shader"].indexOf(o.get("type"))?m.hidden=!0:"asset"===editor.call("selector:type")?(e=editor.call("selector:items"),m.hidden=1<e.length&&-1!==e.indexOf(o)):m.hidden=!1,y.hidden=!1,o.get("source")?f.hidden=!0:!(t=o.get("source_asset_id"))||(n=editor.call("assets:get",t))&&("scene"!==n.get("type")||-1===["texture","material"].indexOf(o.get("type"))&&n.get("meta"))&&("animation"===o.get("type")&&!n.get("meta.animation.available")||"material"!==o.get("type")||o.has("meta.index"))):(g.hidden=!0,m.hidden=!0,y.hidden=!0,f.hidden=!0);for(var i=0;i<r.length;i++)r[i].filter&&(r[i].hidden=!r[i].filter(o))}),editor.on("assets:add",function(t){var e,n=editor.call("assets:panel:get",t.get("id"));n&&(e=function(e){e.stopPropagation(),e.preventDefault(),o=t,i.open=!0,i.position(e.clientX+1,e.clientY)},n.element.addEventListener("contextmenu",e,!1),n.tree&&n.tree.elementTitle.addEventListener("contextmenu",e,!1))}),editor.call("assets:panel:folders").innerElement.addEventListener("contextmenu",function(e){e.preventDefault(),e.stopPropagation(),o=void 0,i.open=!0,i.position(e.clientX+1,e.clientY)},!1),editor.call("assets:panel:files").innerElement.addEventListener("contextmenu",function(e){e.preventDefault(),e.stopPropagation(),o=null,i.open=!0,i.position(e.clientX+1,e.clientY)},!1)}var v=e("../../ui"),b=e("../../engine");n.AssetsContextMenu=i},{"../../engine":139,"../../ui":162}],6:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.AssetsCreateFolder=void 0;function i(){editor.method("assets:create:folder",function(e){e=e||{};var t=[],n=editor.call("assets:panel:currentFolder");n&&n.get&&(t=n.get("path").concat(n.get("id")));var i={name:"新建文件夹",type:"folder",source:!0,preload:!1,data:null,parent:void 0!==e.parent?e.parent:editor.call("assets:panel:currentFolder"),scope:{type:"project",id:o.Config.projectID},path:t.join(",")};editor.call("assets:create",i)})}var o=e("../global");n.AssetsCreateFolder=i},{"../global":66}],7:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.AssetsCreateTable=void 0;function i(){editor.method("assets:create:table",function(e){if(""!==o.Config.tableAssetsID)return console.warn("抱歉，暂时只允许创建一个表格！"),void editor.call("status:text","抱歉，暂时只允许创建一个表格！");e=e||{};var t=[],n=editor.call("assets:panel:currentFolder");n&&n.get&&(t=n.get("path").concat(n.get("id")));var i={name:"新表格.table",type:"table",source:!1,preload:!1,parent:void 0!==e.parent?e.parent:editor.call("assets:panel:currentFolder"),filename:"新表格.table",scope:{type:"project",id:o.Config.projectID},path:t.join(",")};editor.call("assets:create",i)}),editor.method("assets:open-table",function(e){window.open(window.location.protocol+"//"+window.location.host+"/table/"+o.Config.projectID+"?name="+e+"&id="+o.Config.tableAssetsID)}),editor.on("assets:add",function(e){"table"===e.get("type")&&(o.Config.tableAssetsID=e.get("id"))})}var o=e("../global");n.AssetsCreateTable=i},{"../global":66}],8:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.AssetsDrop=void 0;function i(){var e=editor.call("layout.assets");editor.call("drop:target",{ref:e.element,type:"files",drop:function(e,t){"files"===e&&editor.call("assets:upload:files",t)}}).element.classList.add("assets-drop-area")}n.AssetsDrop=i},{}],9:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.AssetsFilter=void 0;function i(){var e,t=l.VeryEngine.root,n=l.VeryEngine.assets,y=null,v=[],i="",b=null,o=new c.Panel;function r(e,t){if(!t)return!1;var n,i;if((r=!0)&&"all"!==_.value&&("asset"===e?("texture"===(n=t.get("type"))?n=t.get("source")?"textureSource":"textureTarget":"textureatlas"===n?n=t.get("source")?"textureAtlasSource":"textureAtlasTarget":"font"===n&&(n=t.get("source")?"fontSource":"fontTarget"),r=n===_.value):"script"===e&&(r="script"===_.value)),r&&w.value){var o,r,a="scripts"===e?t:t.get("asset"===e?"name":"filename"),s=!0;if(!1!==b&&(b instanceof Array||"["===w.value[0]&&2<w.value.length&&/^\[.+\]$/.test(w.value))){if(null===b)try{for(var l=w.value.slice(1,-1).split(","),c=[],d="",u=0;u<l.length;u++){var h=l[u].trim();if(h)if("["===h[0]&&"]"!==h[h.length-1]||d&&"]"!==h[h.length-1])d+=h+",";else if(d&&"]"===h[h.length-1]&&(h=d+h,d=""),"["===h[0]&&2<h.length&&"]"===h[h.length-1]){var p=h.slice(1,-1).split(",");if(1===p.length){if(!(f=p[0].trim()))continue;c.push(f)}else{for(var f,m=[],g=0;g<p.length;g++){(f=p[g].trim())&&m.push(f)}if(0===m.length)continue;1===m.length?c.push(m[0]):c.push(m)}}else c.push(h)}b=c,s=!1}catch(e){b=!1}else s=!1;b?r="scripts"!==e&&function(e,t){var n=e.get("tags");if(!n.length)return!1;if(!n.length||!t.length)return!1;for(var i=0;i<t.length;i++)if(1===t[i].length){if(-1!==n.indexOf(t[i][0]))return!0}else{for(var o=!0,r=0;r<t[i].length;r++)if(-1===n.indexOf(t[i][r])){o=!1;break}if(o)return!0}return!1}(t,b):s=!0}else if("*"===w.value[0]&&1<w.value.length)try{r=new RegExp(w.value.slice(1),"i").test(a),s=!1}catch(e){}s&&((r=-1!==a.toLowerCase().indexOf(w.value.toLowerCase()))||"asset"!==e||(o=parseInt(w.value,10))&&o.toString()===w.value&&(r=parseInt(t.get("id"),10)===o))}return r&&!w.value&&(r="script"===e||"scripts"===y?"scripts"===y&&"script"===e:"scripts"===e?!y&&"all"===_.value:(i=t.get("path"),null===y?0===i.length:i.length===v.length+1&&i[i.length-1]===y)),r}o.class.add("filters"),n.header.append(o),editor.method("assets:panel:filter:default",function(){return r}),e={options:{all:"所有资源",material:"材质",model:"模型",textureTarget:"贴图",table:"表格"}};var _=new c.SelectField(e);_.class.add("options"),_.value="all",_.renderChanges=!1,o.append(_),_.on("change",function(e){"all"!==e?_.class.add("not-empty"):_.class.remove("not-empty"),editor.call("assets:panel:filter",r)});var a=c.Tooltip.attach({target:_.element,text:"资源过滤器",align:"bottom",root:t});_.on("open",function(){a.disabled=!0}),_.on("close",function(){a.disabled=!1}),editor.method("assets:filter:search",function(e){return void 0===e||(w.value=e),w.value}),editor.method("assets:filter:type",function(e){return void 0===e?_.value:void(_.value=e||"all")}),editor.method("assets:filter:type:disabled",function(e){_.disabled=e}),editor.on("assets:panel:currentFolder",function(e){v=!e||"string"==typeof e?y=null:(y=e.get("id"),e.get("path")),editor.call("assets:panel:filter",r,!0)}),editor.on("assets:add",function(e){"all"===_.value&&!w.value||(r("script"===e.get("type")?"script":"asset",e)?editor.call("assets:panel:message",null):editor.call("assets:panel:get",e.get("id")).hidden=!0)}),editor.on("sourcefiles:add",function(e){"all"===_.value&&!w.value||(r("script",e)?editor.call("assets:panel:message",null):editor.call("assets:panel:get",e.get("filename")).hidden=!0)});var w=new c.TextField("搜索");w.blurOnEnter=!1,w.keyChange=!0,w.class.add("search"),w.renderChanges=!1,o.append(w),w.element.addEventListener("keydown",function(e){27===e.keyCode&&s.click()},!1),editor.call("hotkey:register","assets-focus-search",{key:"a",alt:!0,callback:function(e){editor.call("picker:isOpen:otherThan","curve")||w.focus()}});var s=document.createElement("div");s.innerHTML="&#57650;",s.classList.add("clear"),w.element.appendChild(s),s.addEventListener("click",function(){w.value=""},!1),w.on("change",function(e){e=e.trim(),i!==e&&((i=e)?w.class.add("not-empty"):w.class.remove("not-empty"),b=null,editor.call("assets:panel:filter",r))})}var l=e("../../engine"),c=e("../../ui");n.AssetsFilter=i},{"../../engine":139,"../../ui":162}],10:[function(e,t,n){"use strict";var i=this&&this.__awaiter||function(e,a,s,l){return new(s=s||Promise)(function(n,t){function i(e){try{r(l.next(e))}catch(e){t(e)}}function o(e){try{r(l.throw(e))}catch(e){t(e)}}function r(e){var t;e.done?n(e.value):((t=e.value)instanceof s?t:new s(function(e){e(t)})).then(i,o)}r((l=l.apply(e,a||[])).next())})},L=this&&this.__generator||function(n,i){var o,r,a,s={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]},e={next:t(0),throw:t(1),return:t(2)};return"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(t){return function(e){return function(t){if(o)throw new TypeError("Generator is already executing.");for(;s;)try{if(o=1,r&&(a=2&t[0]?r.return:t[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,t[1])).done)return a;switch(r=0,a&&(t=[2&t[0],a.value]),t[0]){case 0:case 1:a=t;break;case 4:return s.label++,{value:t[1],done:!1};case 5:s.label++,r=t[1],t=[0];continue;case 7:t=s.ops.pop(),s.trys.pop();continue;default:if(!(a=0<(a=s.trys).length&&a[a.length-1])&&(6===t[0]||2===t[0])){s=0;continue}if(3===t[0]&&(!a||t[1]>a[0]&&t[1]<a[3])){s.label=t[1];break}if(6===t[0]&&s.label<a[1]){s.label=a[1],a=t;break}if(a&&s.label<a[2]){s.label=a[2],s.ops.push(t);break}a[2]&&s.ops.pop(),s.trys.pop();continue}t=i.call(n,s)}catch(e){t=[6,e],r=0}finally{o=a=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}([t,e])}}};Object.defineProperty(n,"__esModule",{value:!0}),n.AssetsFs=void 0;function o(){function B(e){e instanceof Array||(e=[e]);for(var t=[],n=0;n<e.length;n++)t.push(e[n].get("id"));return t}var e=this;editor.method("assets:fs:delete",function(e){editor.call("realtime:send","fs",{op:"delete",ids:B(e)})}),editor.method("assets:fs:move",function(x,O){return i(e,void 0,void 0,function(){var t,n,i,o,r,a,s,l,c,d,u,h,p,f,m,g,y,v,b,_,w;return L(this,function(e){switch(e.label){case 0:return console.warn("assets:fs:move"),console.warn(x),console.warn(O),t=B(x),n=O?O.get("id"):"",editor.call("realtime:send","fs",{op:"move",ids:t,to:n}),i=t.join(","),o=i.split(","),[4,A.getJsonConfig(C.Config.projectID,"assets")];case 1:for(r=e.sent(),a={},s=JSON.parse(r),l=0;l<o.length;l++){for(c=s.assets[o[l]],d=c.path&&0!==c.path.length?c.path[c.path.length-1]:"root",""===n?s.assets[o[l]].path=[]:(s.assets[o[l]].path=s.assets[n].path.slice(0),s.assets[o[l]].path.push(n)),a[o[l]]=s.assets[o[l]].path,s.assets[o[l]].modifiedAt=k.UUid.createdAtTime(),u=Object.keys(s.assets),h=0;h<u.length;h++)u[h]!==o[l]&&u[h]!==n&&void 0!==s.assets[u[h]].path&&null!==s.assets[u[h]].path&&-1!==(p=s.assets[u[h]].path.indexOf(o[l]))&&(f=s.assets[u[h]].path.slice(p),s.assets[u[h]].path=""===n?f:s.assets[o[l]].path.concat(f),s.assets[u[h]].modifiedAt=k.UUid.createdAtTime(),a[u[h]]=s.assets[u[h]].path);m=s.assets[o[l]],g=m.path&&0!==m.path.length?m.path[m.path.length-1]:"root",m.type&&"model"===m.type&&(y=m.name.split("."),"babylon"===y[y.length-1].toLowerCase()&&(s.babylon||(s.babylon={path:{}}),s.babylon.path||(s.babylon.path={}),s.babylon.path[d]&&delete s.babylon.path[d][o[l]],s.babylon.path[g]||(s.babylon.path[g]={}),s.babylon.path[g][o[l]]=!0))}for(A.upLoadJsonConfig(JSON.stringify(s),C.Config.projectID,"assets"),v=Object.keys(a),b=0,_=v.length;b<_;b++)w=editor.call("assets:get",v[b]),console.warn(w),w&&w.set("path",a[v[b]]);return[2]}})})}),editor.method("assets:fs:duplicate",function(e){editor.call("realtime:send","fs",{op:"duplicate",ids:B(e)})})}var C=e("../global"),A=e("../../tools/ossfile"),k=e("../utility/uuid");n.AssetsFs=o},{"../../tools/ossfile":150,"../global":66,"../utility/uuid":127}],11:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.AssetsPanelControl=void 0;function i(){var e=y.VeryEngine.root,t=y.VeryEngine.assets,i=new g.Menu;e.append(i);for(var n={upload:{title:"上传",icon:"&#57909;"},folder:{title:"新建文件夹",icon:"&#57657;"},table:{title:"表格",icon:"&#57864;"},material:{title:"材质",icon:"&#57749;"}},o=Object.keys(n),r=0;r<o.length;r++)n.hasOwnProperty(o[r])&&function(t,e){var n=new g.MenuItem({text:e.title,icon:e.icon||"",value:t});n.on("select",function(){var e={parent:editor.call("assets:panel:currentFolder")};"upload"===t?editor.call("assets:upload:picker",e):"script"===t?editor.call("settings:project").get("useLegacyScripts")?editor.call("sourcefiles:new"):editor.call("picker:script-create",function(e){editor.call("assets:create:script",{filename:e,boilerplate:!0})}):editor.call("assets:create:"+t,e)}),i.append(n),"script"===t&&editor.on("repositories:load",function(e){"directory"!==e.get("current")&&(n.disabled=!0)})}(o[r],n[o[r]]);var a=new g.Panel;a.class.add("assets-controls"),t.header.append(a),editor.on("permissions:writeState",function(e){a.enabled=e});var s=new g.Button;s.class.add("create-asset"),s.text="&#57632;",s.on("click",function(e){var t=s.element.getBoundingClientRect();i.position(t.right,t.top),i.open=!0}),a.append(s);var l=g.Tooltip.attach({target:s.element,text:"添加资源",align:"bottom",root:e});i.on("open",function(e){l.disabled=e});var c=new g.Button("&#57636;");c.style.fontWeight="200",c.disabled=!0,c.class.add("delete"),c.on("click",function(){editor.call("permissions:write")&&"asset"===editor.call("selector:type")&&editor.call("assets:delete:picker",editor.call("selector:items"))}),a.append(c);var d=g.Tooltip.attach({target:c.element,text:"删除资源",align:"bottom",root:e});d.class.add("innactive"),editor.on("permissions:writeState",function(e){s.hidden=!e,c.hidden=!e});var u=new g.Button("&#58117;");u.style.fontWeight="200",u.disabled=!0,u.class.add("up"),u.on("click",function(){var e,t,n=editor.call("assets:panel:currentFolder");n&&("scripts"!==n&&(e=n.get("path")).length&&(t=editor.call("assets:get",e[e.length-1]))?editor.call("assets:panel:currentFolder",t):editor.call("assets:panel:currentFolder",null))}),a.append(u),editor.on("assets:panel:currentFolder",function(e){e?(u.disabled=!1,h.class.remove("innactive")):(u.disabled=!0,h.class.add("innactive"))});var h=g.Tooltip.attach({target:u.element,text:"上一层",align:"bottom",root:e});h.class.add("innactive");var p=y.VeryEngine.assetsGrid,f=new g.Button("&#57669;");f.style.fontWeight="200",f.class.add("size"),f.on("click",function(){p.class.contains("small")?(p.class.remove("small"),m.html='<span style="color:#fff">大图标</span> / 小图标',editor.call("localStorage:set","editor:assets:thumbnail:size","large")):(p.class.add("small"),m.html='大图标 / <span style="color:#fff">小图标</span>',editor.call("localStorage:set","editor:assets:thumbnail:size","small"))}),a.append(f);var m=g.Tooltip.attach({target:f.element,align:"bottom",root:e});"small"===editor.call("localStorage:get","editor:assets:thumbnail:size")?(p.class.add("small"),m.html='大图标 / <span style="color:#fff">小图标</span>'):(p.class.remove("small"),m.html='<span style="color:#fff">大图标</span> / 小图标'),m.class.add("innactive"),editor.on("attributes:clear",function(){c.disabled=!0,d.class.add("innactive")}),editor.on("attributes:inspect[*]",function(e){e.startsWith("asset")?(c.enabled=!0,d.class.remove("innactive")):(c.enabled=!1,d.class.add("innactive"))})}var g=e("../../ui"),y=e("../../engine");n.AssetsPanelControl=i},{"../../engine":139,"../../ui":162}],12:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.AssetsPanel=void 0;function i(){var e=H.VeryEngine.root,t=H.VeryEngine.assets,u=!1,h={},g={type:"",items:new Array,prev:{type:"",items:new Array}},s=!1,n=new U.TopElementContainer({flex:!0});n.class.add("progress-overlay"),t.append(n);var i=new U.Progress;i.progress=.01,i.on("progress:100",function(){n.hidden=!0}),n.append(i),n.hidden=!0,editor.method("assets:progress",function(e){i.progress=e});var o=new U.Panel;o.class.add("folders"),o.flexShrink="0",o.style.width="200px",o.innerElement.style.width="200px",o.foldable=!1,o.horizontal=!0,o.scroll=!0,o.resizable="right",o.resizeMin=100,o.resizeMax=300,t.append(o),editor.method("assets:panel:folders",function(){return o});var p=new U.Panel;p.class.add("files"),p.flexGrow="1",p.foldable=!1,p.horizontal=!0,p.scroll=!0,t.append(p),editor.method("assets:panel:files",function(){return p});var y=new U.Grid;y.class.add("assets"),p.append(y),H.VeryEngine.assetsGrid=y;var v=new U.Tree;v.draggable=!1,v.class.add("assets"),o.append(v);var b=new U.TreeItem({text:"/"});function r(){l=!1,v.element.style.width="",v.element.style.width=o.innerElement.scrollWidth-5+"px"}function _(){l||(l=!0,requestAnimationFrame(r))}v.append(b),b.open=!0,b.class.add("current"),b.on("select",function(){b.selected=!1});var a,l=!1;o.on("resize",_),v.on("open",_),v.on("close",_),setInterval(_,1e3);var w=null;editor.method("assets:panel:currentFolder",function(e){if(void 0===e)return w;if(e===w)return null;if(w&&"string"!=typeof w&&x[w.get("id")]?x[w.get("id")].tree.class.remove("current"):null===w?b.class.remove("current"):a&&"scripts"===w&&a.class.remove("current"),(w=e)&&"string"!=typeof w){x[w.get("id")].tree.class.add("current");for(var t=w.get("path"),n=0;n<t.length;n++)x[t[n]]&&x[t[n]].tree&&(x[t[n]].tree.open=!0)}else null===w?b.class.add("current"):a&&"scripts"===w&&(a.class.add("current"),editor.call("assets:filter:type","all"));return editor.emit("assets:panel:currentFolder",w),w}),editor.call("hotkey:register","assets:fs:up",{key:"backspace",callback:function(){var e;w&&"asset"===editor.call("selector:type")&&(0===(e="string"==typeof w?[]:w.get("path")).length?editor.call("assets:panel:currentFolder",null):editor.call("assets:panel:currentFolder",editor.call("assets:get",e[e.length-1])))}}),editor.on("drop:active",function(e,t,n){(u=e)||(y.dragOver=void 0,O.classList.remove("active"),B.classList.remove("active"))}),editor.on("drop:set",function(e,t){h=t}),editor.call("drop:target",{ref:o.element,hole:!0,passThrough:!0,filter:function(e,t){return e.startsWith("asset")},drop:function(e,t){if(console.warn("drop: "+e),e&&void 0!==y.dragOver&&e.startsWith("asset")){var n=editor.call("selector:items"),i=[],o=function(e){var t=editor.call("assets:get",e);-1!==n.indexOf(t)&&editor.call("selector:remove",t),i.push(t)};if(t.ids&&0<t.ids.length)for(var r=0;r<t.ids.length;r++)o(t.ids[r]);else o(t.id);editor.call("assets:fs:move",i,y.dragOver)}}}).element.classList.add("assets-drop-area");var f={};b.elementTitle.addEventListener("mouseover",function(){var e;u&&null!==y.dragOver&&(h.id||h.ids)&&editor.call("assets:get",h.id||h.ids[0]).get("path").length&&(O.classList.remove("active"),e=b.elementTitle.getBoundingClientRect(),B.classList.add("active"),B.style.left=e.left+"px",B.style.top=e.top+"px",B.style.right=window.innerWidth-e.right+"px",B.style.bottom=window.innerHeight-e.bottom+"px",y.dragOver=null)},!1),b.elementTitle.addEventListener("mouseout",function(){u&&void 0!==y.dragOver&&(O.classList.remove("active"),B.classList.remove("active"),y.dragOver=void 0)},!1),editor.call("drop:target",{ref:p.element,hole:!0,passThrough:!0,filter:function(e,t){return e.startsWith("asset")},drop:function(e,t){if(e&&void 0!==y.dragOver&&e.startsWith("asset")){console.warn("drop2: "+e),console.warn(t),console.log(y.dragOver);var n,i=[],o=editor.call("selector:items"),r=function(e){var t=editor.call("assets:get",e);-1!==o.indexOf(t)&&editor.call("selector:remove",t),i.push(t)};if(t.ids&&0<t.ids.length)for(var a=0;a<t.ids.length;a++)r(t.ids[a]);else r(t.id);"folder"===y.dragOver.get("type")?editor.call("assets:fs:move",i,y.dragOver):"bundle"===y.dragOver.get("type")&&editor.call("assets:bundles:addAssets",i,y.dragOver)&&((n=x[y.dragOver.get("id")]).class.add("confirm-animation"),setTimeout(function(){n.class.remove("confirm-animation")},800))}}}).element.classList.add("assets-drop-area"),editor.on("permissions:writeState",function(e){v.enabled=e,y.enabled=e});var c=new U.Label(void 0,void 0,!0);c.renderChanges=!1,c.class.add("no-assets"),c.hidden=!0,p.append(c),editor.method("assets:panel:message",function(e){c.text=e,c.hidden=!e});var d={},x={},m=!1;editor.method("assets:grid:assetsIndex",function(){return x});var O=document.createElement("div");O.classList.add("assets-drop-border"),e.append(O);var B=document.createElement("div");B.classList.add("assets-drop-border"),e.append(B);var L=new U.Tooltip({text:"Asset",align:"top",hoverable:!1});function C(){if(E){for(;E&&"LI"!==E.nodeName&&!E.classList.contains("ui-grid-item");)E=E.parentNode;var e,t;E&&E.ui&&(t=16,(e=E.getBoundingClientRect()).width<64&&(t=e.width/2),L.flip=e.left+t>window.innerWidth/2,L.flip?L.position(e.right-t,e.bottom):L.position(e.left+t,e.bottom),L.text=E.ui.asset.get("name"),L.hidden=!1)}}function A(e){M&&(clearTimeout(M),M=null),E=e.target,M=setTimeout(C,300)}function k(){L.hidden=!0,M&&(clearTimeout(M),M=null)}e.append(L);var E=null,M=null;y.innerElement.addEventListener("mousewheel",function(){L.hidden=!0,M&&(clearTimeout(M),M=null)},!1),v.on("select",function(e){m||(e.asset&&(U.Tree._ctrl&&U.Tree._ctrl()?editor.call("selector:add","asset",e.asset):w!==e.asset?e.selected=!1:editor.call("selector:set","asset",[e.asset])),e.asset?U.Tree._ctrl&&U.Tree._ctrl()||(editor.call("assets:filter:search",""),editor.call("assets:panel:currentFolder",e.asset)):e===b?(editor.call("assets:filter:search",""),editor.call("assets:panel:currentFolder",null)):e===a&&(editor.call("assets:filter:search",""),editor.call("assets:panel:currentFolder","scripts")))}),v.on("deselect",function(e){m||e.asset&&editor.call("selector:remove",e.asset)}),y.on("select",function(e){m||e.asset&&editor.call("selector:add","asset",e.asset)}),y.on("deselect",function(e){m||e.asset&&editor.call("selector:remove",e.asset)}),editor.on("selector:change",function(e,t){if(m=!0,g.prev.type=g.type,g.prev.items=g.items,g.type=editor.call("selector:type"),g.items=editor.call("selector:items"),"asset"===e){v.clear(),t=t.slice(0);for(var n=[],i=0;i<t.length;i++)if(0,n.push(x[t[i].get("id")]),n[i].tree){n[i].tree.selected=!0;for(var o=t[i].get("path"),r=0;r<o.length;r++)x[o[r]]&&x[o[r]].tree&&(x[o[r]].tree.open=!0)}y.selected=n}else"asset"!==g.type&&(y.selected=[]),v.clear();m=!1}),editor.method("assets:grid",function(){return y});var P=!1,T=null,z=null,N=512,S=function(){for(var e=0;T&&(0===N||e<N);){var t=T.ui;t&&(t.asset?t.hidden=!z("asset",t.asset):t.script&&(t.hidden=!z("script",t.script)),e++),T=T.nextSibling}T?requestAnimationFrame(S):P=!1};editor.method("assets:panel:filter",function(e,t){e=e||editor.call("assets:panel:filter:default"),c.hidden=!0,T=y.element.firstChild,z=e;editor.call("assets:filter:type");var n=editor.call("assets:filter:search");if(N=!n||t?0:512,P||(P=!0,requestAnimationFrame(S)),s&&!n&&(s=!1,"asset"===g.type)){for(var i=g.items[0].get("path"),o=!1,r=1;r<g.items.length;r++){var a=g.items[r];if(!1!=("script"===a.get("type"))||!i.equals(a.get("path"))){o=!0;break}}o||(i.length?(editor.call("assets:panel:currentFolder",editor.call("assets:get",i[i.length-1])),x[g.items[0].get("id")].element.focus()):editor.call("assets:panel:currentFolder",null))}n&&(s=!0)}),editor.method("assets:panel:get",function(e){return x[e]||d[e]});var I=function(e){var t=f[e.asset.get("id")];if(t&&t.length){for(var n=0;n<t.length;n++){var i=D(e.tree,t[n].tree);-1===i?e.tree.append(t[n].tree):e.tree.appendBefore(t[n].tree,e.tree.child(i).ui),I(t[n])}delete f[e.asset.get("id")]}},D=function(e,t,n){n=n||t.text;var i,o=Array.prototype.slice.call(e.element.childNodes,1),r=0,a=o.length-1,s=-1,l="",c="";if(0===o.length)return-1;if((i===t?n.toLowerCase():o[0].ui.text.toLowerCase())===c)return 0;for(;r<=a;)if(l=(i=o[s=Math.floor((r+a)/2)])===t?n.toLowerCase():i.ui.text.toLowerCase(),(c=t.text.toLowerCase())<l)a=s-1;else{if(!(l<c))return s;r=s+1}return c<l?s:s+1===o.length?-1:s+1};editor.call("hotkey:register","asset:select-all",{ctrl:!0,key:"a",callback:function(){var e,t=[];for(e in x)x[e].hidden||t.push(x[e].asset);for(e in d)d[e].hidden||t.push(d[e].script);t.length?editor.call("selector:set","asset",t):editor.call("selector:clear")}});var j=[],Y={},G=function(){if(requestAnimationFrame(G),j.length)for(var e=0;e<4&&j.length;){e++;var t=j.shift();delete Y[t],x[t]&&x[t].thumbnail&&x[t].thumbnail.render&&x[t].thumbnail.render()}};function R(e){var t=p.element.getBoundingClientRect(),n=e.element.getBoundingClientRect(),i=Math.max(n.top,t.top),o=Math.min(n.bottom,t.bottom);8<o-i&&(O.classList.add("active"),O.style.left=n.left+"px",O.style.top=i+"px",O.style.right=window.innerWidth-n.right+"px",O.style.bottom=window.innerHeight-o+"px")}function V(c,d){d.tree=new U.TreeItem({text:c.get("name")});var e,t,n,i=(d.tree.asset=c).get("path");function o(){if(u&&y.dragOver!==c){if(h.ids&&0<h.ids.length){if(h.ids.indexOf(-1!==c.get("id")))return}else{if(!h.id)return;if(c.get("id")===h.id)return}var e,t,n,i,o,r=editor.call("assets:get",h.id||h.ids[0]),a=r.get("path");if(!a.length||a[a.length-1]!==c.get("id")){if(h.ids&&0<h.ids.length){for(var s=c.get("path"),l=0;l<h.ids.length;l++)if(-1!==s.indexOf(h.ids[l]))return}else if(-1!==c.get("path").indexOf(r.get("id")))return;R(d),e=d,t=p.element.getBoundingClientRect(),n=e.tree.elementTitle.getBoundingClientRect(),i=Math.max(n.top,t.top),o=Math.min(n.bottom,t.bottom),n.height&&4<o-i&&(B.classList.add("active"),B.style.left=n.left+"px",B.style.top=i+"px",B.style.right=window.innerWidth-n.right+"px",B.style.bottom=window.innerHeight-o+"px"),y.dragOver=c}}}function r(){u&&y.dragOver===c&&(O.classList.remove("active"),B.classList.remove("active"),y.dragOver=void 0)}i.length&&0<i.length?(t=i[i.length-1],x[t]?e=x[t].tree:(f[t]||(f[t]=[]),f[t].push(d))):e=b,e&&(-1===(n=D(e,d.tree))?e.append(d.tree):e.appendBefore(d.tree,e.child(n).ui),I(d)),d.tree.elementTitle.draggable=!0,d.element.addEventListener("mouseout",r,!1),d.tree.elementTitle.addEventListener("mouseout",r,!1),d.element.addEventListener("mouseover",o,!1),d.tree.elementTitle.addEventListener("mouseover",o,!1)}requestAnimationFrame(G),editor.on("assets:add",function(l,e){var t=[],o=new U.GridItem;o.asset=l,o.class.add("type-"+l.get("type")),o.element.addEventListener("mouseover",A,!1),o.element.addEventListener("mouseout",k,!1),l.once("destroy",function(){E&&E.ui&&k()}.bind(l));function n(e){e.stopPropagation()}function i(e){e.preventDefault(),e.stopPropagation();var t="asset."+l.get("type"),n={id:l.get("id"),ids:new Array},i=editor.call("selector:type"),o=editor.call("selector:items");if("asset"===i&&1<o.length){var r=o[0].get("path");if(-1!==o.indexOf(l)){for(var a=[],s=0;s<o.length;s++){if(r.length!==o[s].get("path").length||r[r.length-1]!==o[s].get("path")[r.length-1])return;a.push(o[s].get("id"))}t="assets",n={id:"",ids:a}}}editor.call("drop:set",t,n),editor.call("drop:activate",!0)}var r,a,s;"folder"===l.get("type")?(V(l,o),o.tree.elementTitle.addEventListener("mousedown",n,!1),o.tree.elementTitle.addEventListener("dragstart",i,!1)):"script"===l.get("type")?(r=l,a=o,(s=t).push(editor.on("assets["+r.get("id")+"]:scripts:collide",function(e){a.class.add("scripts-collide")})),s.push(editor.on("assets["+r.get("id")+"]:scripts:resolve",function(e){a.class.remove("scripts-collide")}))):l.get("type");function c(){var e=l.get("task");o.class.remove("task","failed","running"),e&&"string"==typeof e&&"{"!==e[0]&&o.class.add("task",e)}c(),l.on("task:set",c),o.element.draggable=!0,o.element.addEventListener("mousedown",n,!1),o.element.addEventListener("dragstart",i,!1),x[l.get("id")]=o,l.get("source")&&o.class.add("source"),editor.call("assets:panel:filter:default")("asset",l)||(o.hidden=!0);var d;l.get("file.size");l.get("source")||(l.on("thumbnails.m:set",function(e){W.getThumbnailUrl(K.Config.projectID,l.get("id"),l.get("name"),l.get("file.hash")).then(function(e){d.style.backgroundImage='url("'+e+'")'}),d.classList.remove("placeholder")}),l.on("thumbnails.m:unset",function(){d.style.backgroundImage="none",d.classList.add("placeholder")})),"folder"===l.get("type")&&o.element.addEventListener("dblclick",function(){v.clear(),o.tree.open=!0,editor.call("assets:filter:search",""),editor.call("assets:panel:currentFolder",o.asset),g.type&&editor.call("selector:set",g.prev.type,g.prev.items)},!1),"sprite"!==l.get("type")&&"textureatlas"!==l.get("type")||o.element.addEventListener("dblclick",function(){editor.call("picker:sprites",o.asset)},!1),"material"===l.get("type")||"models"===l.get("type")||"sprite"===l.get("type")||"font"===l.get("type")&&!l.get("source")?((d=document.createElement("img")).width=64,d.height=64,"sprite"!==l.get("type")&&d.classList.add("flipY"),editor.call("material:preview",d,l)):d=document.createElement("div"),(o.thumbnail=d).classList.add("thumbnail"),o.element.appendChild(d),l.has("has_thumbnail")&&!0===l.get("has_thumbnail")&&!l.get("source")?W.getThumbnailUrl(K.Config.projectID,l.get("id"),l.get("name"),l.get("file.hash")).then(function(e){d.style.backgroundImage='url("'+e+'")'}):d.classList.add("placeholder");var u=document.createElement("div");u.classList.add("icon"),o.element.appendChild(u);var h=o.labelElement=document.createElement("div");h.classList.add("label"),h.textContent=l.get("name"),o.element.appendChild(h);var p,f=o.users=document.createElement("div");f.classList.add("users"),o.element.appendChild(f),t.push(l.on("name:set",function(e,t){var n,i;h.textContent=l.get("name"),o.tree&&(o.tree.text=l.get("name"),n=o.tree.parent,o.tree.parent.element.removeChild(o.tree.element),-1===(i=D(n,o.tree,t))?n.element.appendChild(o.tree.element):n.element.insertBefore(o.tree.element,n.child(i)),_()),F()})),t.push(l.on("path:set",function(e,t){var n,i;o.hidden=!editor.call("assets:panel:filter:default")("asset",l),o.tree&&(t.length&&e.length&&e[e.length-1]===t[t.length-1]||(o.tree.parent.remove(o.tree),n=e.length?x[e[e.length-1]].tree:b,-1===(i=D(n,o.tree))?n.append(o.tree):n.appendBefore(o.tree,n.child(i).ui)),w===l&&editor.emit("assets:panel:currentFolder",w)),F()})),l.get("source")||(p=editor.on("assets:used:"+l.get("id"),function(e){e?o.class.remove("unused"):o.class.add("unused")}),editor.call("assets:used:get",l.get("id"))||o.class.add("unused"),o.once("destroy",function(){p.unbind()})),o.once("destroy",function(){editor.call("selector:remove",l);for(var e=0;e<t.length;e++)t[e].unbind();t=null,delete x[l.get("id")]});var m=editor.call("assets:raw");-1!==e&&m.data[e+1]?y.appendBefore(o,x[m.data[e+1].get("id")]):y.append(o),_(),F()});var F=function(){};editor.on("assets:move",function(e,t){var n=x[e.get("id")];y.element.removeChild(n.element),-1===t?y.append(n):y.appendBefore(n,x[editor.call("assets:raw").data[t+1].get("id")])}),editor.on("assets:remove",function(e){var t=x[e.get("id")].tree;if(t&&(t.parent&&t.parent.remove(t),t.destroy()),x[e.get("id")].destroy(),_(),w&&"string"!=typeof w){var n=w.get("id"),i=e.get("path"),o=i.indexOf(n);if(n===e.get("id")||-1!==o){-1===o&&(o=i.length-1);for(var r=!1,a=o+1;a--;)if(x[i[a]]){r=!0,editor.call("assets:panel:currentFolder",x[i[a]].asset);break}r||editor.call("assets:panel:currentFolder",null)}}}),editor.on("sourcefiles:add",function(e){e.set("type","script");var n=new U.GridItem;n.script=e,n.class.add("type-script"),y.append(n),editor.call("assets:panel:filter:default")("script",e)||(n.hidden=!0),d[e.get("filename")]=n;var t=document.createElement("div");t.classList.add("thumbnail","placeholder"),n.element.appendChild(t);var i=document.createElement("div");i.classList.add("icon"),n.element.appendChild(i);var o=n.labelElement=document.createElement("div");o.classList.add("label"),o.textContent=e.get("filename"),n.element.appendChild(o);var r=n.users=document.createElement("div");r.classList.add("users"),n.element.appendChild(r);var a=e.on("filename:set",function(e,t){o.textContent=e,d[e]=n,delete d[t]});n.on("destroy",function(){editor.call("selector:remove",e),a.unbind(),delete d[e.get("filename")]}),e.on("destroy",function(){n.destroy()}),editor.call("drop:item",{element:n.element,type:"asset.script",data:{filename:e.get("filename")}})}),editor.on("sourcefiles:remove",function(e){e.destroy()})}var U=e("../../ui"),H=e("../../engine"),W=e("../../tools/ossfile"),K=e("../global");n.AssetsPanel=i},{"../../engine":139,"../../tools/ossfile":150,"../../ui":162,"../global":66}],13:[function(e,t,n){"use strict";var h=this&&this.__awaiter||function(e,a,s,l){return new(s=s||Promise)(function(n,t){function i(e){try{r(l.next(e))}catch(e){t(e)}}function o(e){try{r(l.throw(e))}catch(e){t(e)}}function r(e){var t;e.done?n(e.value):((t=e.value)instanceof s?t:new s(function(e){e(t)})).then(i,o)}r((l=l.apply(e,a||[])).next())})},p=this&&this.__generator||function(n,i){var o,r,a,s={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]},e={next:t(0),throw:t(1),return:t(2)};return"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(t){return function(e){return function(t){if(o)throw new TypeError("Generator is already executing.");for(;s;)try{if(o=1,r&&(a=2&t[0]?r.return:t[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,t[1])).done)return a;switch(r=0,a&&(t=[2&t[0],a.value]),t[0]){case 0:case 1:a=t;break;case 4:return s.label++,{value:t[1],done:!1};case 5:s.label++,r=t[1],t=[0];continue;case 7:t=s.ops.pop(),s.trys.pop();continue;default:if(!(a=0<(a=s.trys).length&&a[a.length-1])&&(6===t[0]||2===t[0])){s=0;continue}if(3===t[0]&&(!a||t[1]>a[0]&&t[1]<a[3])){s.label=t[1];break}if(6===t[0]&&s.label<a[1]){s.label=a[1],a=t;break}if(a&&s.label<a[2]){s.label=a[2],s.ops.push(t);break}a[2]&&s.ops.pop(),s.trys.pop();continue}t=i.call(n,s)}catch(e){t=[6,e],r=0}finally{o=a=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}([t,e])}}};Object.defineProperty(n,"__esModule",{value:!0}),n.AssetsPreview=void 0;function i(){var e=this;editor.method("preview:render",function(e,t,n,i,o){t=t||1,n=n||1,editor.call("preview:"+e.get("type")+":render",e,t,n,i,o)});var t=document.createElement("canvas");t.width=64,t.height=64,t.style.display="none",document.body.append(t);var i=new BABYLON.Engine(t,!0),o=new BABYLON.Scene(i);o.clearColor.a=0,new BABYLON.HemisphericLight("__previewlight",new BABYLON.Vector3(-3,1,-5),o).intensity=.6;var r=new BABYLON.UniversalCamera("__previewCamera",new BABYLON.Vector3(0,62,-120),o),n=new BABYLON.TransformNode("__previewNode",o);n.position.copyFrom(r.position),n.rotation.copyFrom(r.rotation),r.parent=n,r.position=BABYLON.Vector3.Zero(),r.rotation=BABYLON.Vector3.Zero(),r.inputs.clear(),n.rotation.x=27.2*Math.PI/180;var a=BABYLON.MeshBuilder.CreateSphere("__previewSphere",{diameter:100},o),s=new BABYLON.StandardMaterial("__previewShere",o);function l(){return h(e,void 0,void 0,function(){var t,n;return p(this,function(e){switch(e.label){case 0:d=!0,t=function(){var t,n;return p(this,function(e){switch(e.label){case 0:return t=c.shift(),[4,f.BabylonLoader.loadMaterial(t[1]._data2.data,o,"")];case 1:return(n=e.sent(),a.material=n||s,o.isReady())?(o.render(),BABYLON.Tools.CreateScreenshotUsingRenderTarget(i,r,64,function(e){t[0].src=e}),[2]):(setTimeout(function(){u(t[0])},300),d=!1,[2,{value:void 0}])}})},e.label=1;case 1:return 0<c.length?[5,t()]:[3,3];case 2:return"object"==typeof(n=e.sent())?[2,n.value]:[3,1];case 3:return d=!1,[2]}})})}a.material=s;var c=[],d=!1,u=function(t){o.isReady()?(o.render(),BABYLON.Tools.CreateScreenshotUsingRenderTarget(i,r,64,function(e){t.src=e}),setTimeout(l,0)):setTimeout(function(){u(t)},300)};editor.method("material:preview",function(e,t){c.push([e,t])}),editor.method("material:preview:start",function(){d||setTimeout(l,0)}),editor.method("material:preview:assemble",function(e){if(e&&e.babylon)for(var t in e.babylon)if(e.babylon[t].materials){var n,i,o,r=e.babylon[t].materials;for(n in r){r[n].asset_id&&(i=r[n].asset_id,r[n].diffuseTexture&&(o=e.assets[i].data.diffuseTexture.texture_id,e.assets[i].data.diffuseTexture.name=f.BabylonLoader.prefix+o+"/"+e.assets[o].name),r[n].specularTexture&&(o=e.assets[i].data.specularTexture.texture_id,e.assets[i].data.specularTexture.name=f.BabylonLoader.prefix+o+"/"+e.assets[o].name),r[n].reflectionTexture&&(o=e.assets[i].data.reflectionTexture.texture_id,e.assets[i].data.reflectionTexture.name=f.BabylonLoader.prefix+o+"/"+e.assets[o].name),r[n].refractionTexture&&(o=e.assets[i].data.refractionTexture.texture_id,e.assets[i].data.refractionTexture.name=f.BabylonLoader.prefix+o+"/"+e.assets[o].name),r[n].emissiveTexture&&(o=e.assets[i].data.emissiveTexture.texture_id,e.assets[i].data.emissiveTexture.name=f.BabylonLoader.prefix+o+"/"+e.assets[o].name),r[n].bumpTexture&&(o=e.assets[i].data.bumpTexture.texture_id,e.assets[i].data.bumpTexture.name=f.BabylonLoader.prefix+o+"/"+e.assets[o].name),r[n].opacityTexture&&(o=e.assets[i].data.opacityTexture.texture_id,e.assets[i].data.opacityTexture.name=f.BabylonLoader.prefix+o+"/"+e.assets[o].name),r[n].ambientTexture&&(o=e.assets[i].data.ambientTexture.texture_id,e.assets[i].data.ambientTexture.name=f.BabylonLoader.prefix+o+"/"+e.assets[o].name),r[n].lightmapTexture&&(o=e.assets[i].data.lightmapTexture.texture_id,e.assets[i].data.lightmapTexture.name=f.BabylonLoader.prefix+o+"/"+e.assets[o].name))}}})}var f=e("../middleware/loader/babylonLoader");n.AssetsPreview=i},{"../middleware/loader/babylonLoader":86}],14:[function(e,t,n){"use strict";var i=this&&this.__awaiter||function(e,a,s,l){return new(s=s||Promise)(function(n,t){function i(e){try{r(l.next(e))}catch(e){t(e)}}function o(e){try{r(l.throw(e))}catch(e){t(e)}}function r(e){var t;e.done?n(e.value):((t=e.value)instanceof s?t:new s(function(e){e(t)})).then(i,o)}r((l=l.apply(e,a||[])).next())})},s=this&&this.__generator||function(n,i){var o,r,a,s={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]},e={next:t(0),throw:t(1),return:t(2)};return"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(t){return function(e){return function(t){if(o)throw new TypeError("Generator is already executing.");for(;s;)try{if(o=1,r&&(a=2&t[0]?r.return:t[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,t[1])).done)return a;switch(r=0,a&&(t=[2&t[0],a.value]),t[0]){case 0:case 1:a=t;break;case 4:return s.label++,{value:t[1],done:!1};case 5:s.label++,r=t[1],t=[0];continue;case 7:t=s.ops.pop(),s.trys.pop();continue;default:if(!(a=0<(a=s.trys).length&&a[a.length-1])&&(6===t[0]||2===t[0])){s=0;continue}if(3===t[0]&&(!a||t[1]>a[0]&&t[1]<a[3])){s.label=t[1];break}if(6===t[0]&&s.label<a[1]){s.label=a[1],a=t;break}if(a&&s.label<a[2]){s.label=a[2],s.ops.push(t);break}a[2]&&s.ops.pop(),s.trys.pop();continue}t=i.call(n,s)}catch(e){t=[6,e],r=0}finally{o=a=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}([t,e])}}};Object.defineProperty(n,"__esModule",{value:!0}),n.AssetsRename=void 0;function o(){function o(r,a){return i(e,void 0,void 0,function(){var t,n,i,o;return s(this,function(e){switch(e.label){case 0:return[4,c.getJsonConfig(l.Config.projectID,"assets")];case 1:return t=e.sent(),(n=JSON.parse(t)).assets[r].name=a,null!==n.assets[r].file&&void 0!==n.assets[r].file&&(i=n.assets[r].file.filename.split(".").pop(),a.endsWith(i)?n.assets[r].file.filename=a:n.assets[r].file.filename=a+"."+i,n.assets[r].modifiedAt=d.UUid.createdAtTime()),c.upLoadJsonConfig(JSON.stringify(n),l.Config.projectID,"assets"),(o=editor.call("assets:get",r))&&o.set("name",a),[2]}})})}var e=this;editor.method("assets:rename",function(e,t){var n=e.get("name"),i=e.get("id");editor.call("history:add",{name:"asset rename",undo:function(){editor.call("assets:get",i)&&o(i,n)},redo:function(){editor.call("assets:get",i)&&o(i,t)}}),o(i,t)})}var l=e("../global"),c=e("../../tools/ossfile"),d=e("../utility/uuid");n.AssetsRename=o},{"../../tools/ossfile":150,"../global":66,"../utility/uuid":127}],15:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.AssetsStore=void 0;function i(){var e=r.VeryEngine.assets,t=new o.Button("说明文档");t.class.add("store"),e.header.append(t),t.on("click",function(){window.open("http://doc.veryengine.cn/readme/web/?#/12","_blank")})}var o=e("../../ui"),r=e("../../engine");n.AssetsStore=i},{"../../engine":139,"../../ui":162}],16:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.AssetsSync=void 0;function i(){function a(e){editor.call("selector:set","asset",[e]);var t=e.get("path");t.length?editor.call("assets:panel:currentFolder",editor.call("assets:get",t[t.length-1])):editor.call("assets:panel:currentFolder",null)}editor.method("initAssets",function(e){e.assets&&(t(e.assets),editor.call("material:preview:assemble",e),editor.call("material:preview:start"))}),editor.method("loadAsset",function(e,t){var n=new o.Observer(e);editor.call("assets:add",n),t&&t(n)});var t=function(e){editor.call("assets:progress",.5);var t,n,i=0,o=Object.getOwnPropertyNames(e).length;for(t in e)n=e[t],editor.call("loadAsset",n,function(){i++,editor.call("assets:progress",i/o*.5+.5),o<=i&&(editor.call("assets:progress",1),editor.emit("assets:load"))})};editor.method("assets:create",function(e,i,o){var r;o||editor.once("selector:change",function(){r&&(r.unbind(),r=null)}),editor.call("assets:uploadFile",e,function(e,t){return e?(editor.call("status:error",e),void(i&&i(e))):(o||((n=editor.call("assets:get",t.id))?a(n):r=editor.once("assets:add["+t.id+"]",a)),void(i&&i(e,t.id)));var n})})}var o=e("../../lib");n.AssetsSync=i},{"../../lib":143}],17:[function(e,t,n){"use strict";var o=this&&this.__awaiter||function(e,a,s,l){return new(s=s||Promise)(function(n,t){function i(e){try{r(l.next(e))}catch(e){t(e)}}function o(e){try{r(l.throw(e))}catch(e){t(e)}}function r(e){var t;e.done?n(e.value):((t=e.value)instanceof s?t:new s(function(e){e(t)})).then(i,o)}r((l=l.apply(e,a||[])).next())})},R=this&&this.__generator||function(n,i){var o,r,a,s={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]},e={next:t(0),throw:t(1),return:t(2)};return"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(t){return function(e){return function(t){if(o)throw new TypeError("Generator is already executing.");for(;s;)try{if(o=1,r&&(a=2&t[0]?r.return:t[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,t[1])).done)return a;switch(r=0,a&&(t=[2&t[0],a.value]),t[0]){case 0:case 1:a=t;break;case 4:return s.label++,{value:t[1],done:!1};case 5:s.label++,r=t[1],t=[0];continue;case 7:t=s.ops.pop(),s.trys.pop();continue;default:if(!(a=0<(a=s.trys).length&&a[a.length-1])&&(6===t[0]||2===t[0])){s=0;continue}if(3===t[0]&&(!a||t[1]>a[0]&&t[1]<a[3])){s.label=t[1];break}if(6===t[0]&&s.label<a[1]){s.label=a[1],a=t;break}if(a&&s.label<a[2]){s.label=a[2],s.ops.push(t);break}a[2]&&s.ops.pop(),s.trys.pop();continue}t=i.call(n,s)}catch(e){t=[6,e],r=0}finally{o=a=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}([t,e])}}};Object.defineProperty(n,"__esModule",{value:!0}),n.AssetsUpload=void 0;function i(){var e,t=this,I=0,D={},j=0,Y=0,n=(editor.call("settings:projectUser"),{model:["fbx","dae","obj","3ds","babylon"],data:["txt","xml","atlas","table"],html:["html"],json:["json"],texture:["tif","tga","png","jpg","jpeg","gif","bmp","dds","hdr","exr"],audio:["wav","mp3","mp4","ogg","m4a"],shader:["glsl","frag","vert"],script:["js"],font:["ttf","ttc","otf","dfont"]}),c={};for(e in n)for(var i=0;i<n[e].length;i++)c[n[e][i]]=e;function G(e,t){var n;return t.parent&&(t.parent instanceof V.Observer?e.parent=t.parent.get("id"):(n=parseInt(t.parent,10),isNaN(n)||(e.parent=n+""))),t.filename&&(e.filename=t.filename),t.file&&t.file.size&&(e.file=t.file,t.filename||t.name),e}editor.method("assets:canUploadFiles",function(e){for(var t=0,n=0;n<e.length;n++)t+=e[n].size;return console.log("资源总容量："+t/1024/1024),!0}),editor.method("assets:uploadFile",function(S,e){return o(t,void 0,void 0,function(){var r,a,s,l,c,d,u,h,p,f,m,g,y,v,b,_,w,x,O,B,L,C,A,k,E,M,P,T,z,N;return R(this,function(e){switch(e.label){case 0:return 0!=Y?[3,2]:(Y=1,[4,H.getJsonConfig(F.Config.projectID,"assets")]);case 1:r=e.sent(),D=JSON.parse(r),e.label=2;case 2:return(s=!(a={}),S.asset&&S.type&&"model"!==S.type?(l=S.asset.get("id"),i=S,(o={}).assetId=l,a=o=G(o,i),s=!0,a.replaceAsset=l,S.type&&(a.type=S.type)):(n={},(t=S).type||console.error("'type' required for upload request"),n.type=t.type,t.name&&(n.name=t.name),t.tags&&(n.tags=t.tags.join("\n")),t.source_asset_id&&(n.source_asset_id=t.source_asset_id),t.data&&(n.data=JSON.stringify(t.data)),t.meta&&(n.meta=JSON.stringify(t.meta)),n.preload=void 0===t.preload||t.preload,a=n=G(n,t)),a.projectID=F.Config.projectID,a.path=S.path,c=++I,editor.call("status:job","asset-upload:"+c,0),s)?[3,14]:(d=[],T={},a.file?null!=a.file.length?[3,8]:[4,U.UUid.getmd5(a.file)]:[3,10]);case 3:return z=e.sent(),A=U.UUid.createAssetID(),[4,H.uploadFile(a.file,F.Config.projectID,A,a.name,z)];case 4:if(e.sent(),k=U.UUid.createdAtTime(),T={id:A,type:a.type,createdAt:k,modifiedAt:k,name:a.name,preload:a.preload,has_thumbnail:!1,scope:{type:"project",id:a.projectID},file:{filename:a.file.name,size:a.file.size,hash:z},data:null,path:""===a.path?[]:a.path.split(",")},u=T.path&&0!==T.path.length?T.path[T.path.length-1]:"root",D.assets||(D.assets={}),"texture"!==a.type)return[3,5];if(T.has_thumbnail=!0,void 0===D.assets[A]&&(D.assets[A]=T),d.push(T),D.babylon_resource||(D.babylon_resource={}),D.babylon_resource[u]||(D.babylon_resource[u]={}),D.babylon_resource[u][A]=!0,D.babylon||(D.babylon={path:{}}),D.babylon.path[u])for(h in D.babylon.path[u])if(D.babylon[h]&&D.babylon[h].materials)for(f in p=D.babylon[h].materials)for(m in p[f])"asset_id"!==m&&p[f][m]===a.name&&p[f].asset_id&&D.assets[p[f].asset_id]&&(D.assets[p[f].asset_id].data[m].texture_id=A);return[3,7];case 5:return"model"!==a.type?[3,7]:(void 0===D.assets[A]&&(D.assets[A]=T),d.push(T),g=a.file.name.split("."),"babylon"!==g[g.length-1].toLowerCase()?[3,7]:(D.babylon||(D.babylon={path:{}}),D.babylon_resource||(D.babylon_resource={}),D.babylon.path[u]||(D.babylon.path[u]={}),D.babylon.path[u][A]=!0,D.babylon[A]={materials:{}},[4,new Promise(function(t,n){var i=new FileReader;i.readAsText(a.file,"utf-8"),i.onload=function(e){t(i.result.toString())},i.onerror=function(e){n(e)}})]));case 6:if(y=e.sent(),(y=JSON.parse(y)).materials)for(C=0,v=y.materials.length;C<v;C++)b=U.UUid.createAssetID(),x=y.materials[C],_={id:b,type:"material",createdAt:k,modifiedAt:k,name:x.name,preload:!1,has_thumbnail:!1,scope:{type:"project",id:a.projectID},file:null,data:x,path:T.path},void 0===D.assets[b]&&(D.assets[b]=_),d.push(_),D.babylon[A].materials[x.id]={asset_id:b},x.diffuseTexture&&(D.babylon[A].materials[x.id].diffuseTexture=x.diffuseTexture.name),x.specularTexture&&(D.babylon[A].materials[x.id].specularTexture=x.specularTexture.name),x.reflectionTexture&&(D.babylon[A].materials[x.id].reflectionTexture=x.reflectionTexture.name),x.refractionTexture&&(D.babylon[A].materials[x.id].refractionTexture=x.refractionTexture.name),x.emissiveTexture&&(D.babylon[A].materials[x.id].emissiveTexture=x.emissiveTexture.name),x.bumpTexture&&(D.babylon[A].materials[x.id].bumpTexture=x.bumpTexture.name),x.opacityTexture&&(D.babylon[A].materials[x.id].opacityTexture=x.opacityTexture.name),x.ambientTexture&&(D.babylon[A].materials[x.id].ambientTexture=x.ambientTexture.name),x.lightmapTexture&&(D.babylon[A].materials[x.id].lightmapTexture=x.lightmapTexture.name);if(D.babylon_resource[u])for(O in w=D.babylon_resource[u],x=D.babylon[A].materials)for(B in x[O])if("asset_id"!==B)for(L in w)D.assets[L].name===x[O][B]&&(D.assets[x[O].asset_id].data[B].texture_id=L);e.label=7;case 7:return[3,9];case 8:for(C=0;C<a.file.length;C++)console.error("上传资源未知情况！！！！！"),console.error(a.file[C]);e.label=9;case 9:return[3,13];case 10:return"folder"!==a.type?[3,11]:(A=U.UUid.createAssetID(),k=U.UUid.createdAtTime(),T={id:A,type:a.type,createdAt:k,modifiedAt:k,name:a.name,preload:a.preload,has_thumbnail:!1,scope:{type:"project",id:a.projectID},file:null,data:null,path:""===a.path?[]:a.path.split(",")},D.assets||(D.assets={}),void 0===D.assets[A]&&(D.assets[A]=T),d.push(T),[3,13]);case 11:return"table"!==a.type?[3,13]:(A=U.UUid.createAssetID(),k=U.UUid.createdAtTime(),[4,H.uploadJsonAsset(F.Config.tableStandard,a.projectID,A,"table")]);case 12:e.sent(),k=U.UUid.createdAtTime(),T={id:A,type:a.type,createdAt:k,modifiedAt:k,name:a.name,preload:void 0!==a.preload&&a.preload,has_thumbnail:!1,scope:{type:"project",id:a.projectID},file:{filename:a.name,size:0,hash:U.UUid.createUuid()},data:null,path:""===a.path?[]:a.path.split(",")},D.assets||(D.assets={}),void 0===D.assets[A]&&(D.assets[A]=T),d.push(T),e.label=13;case 13:for(W.BabylonLoader.assetsData.babylon=D.babylon,W.BabylonLoader.assetsData.babylon_resource=D.babylon_resource,E=0,M=d.length;E<M;E++)W.BabylonLoader.assetsData.assets[d[E].id]=d[E],P=new V.Observer(d[E]),editor.call("assets:add",P);return editor.call("material:preview:assemble",W.BabylonLoader.assetsData),editor.call("material:preview:start"),[3,19];case 14:return T={},"texture"===a.type&&a.file?[4,U.UUid.getmd5(a.file)]:[3,17];case 15:return z=e.sent(),[4,H.uploadFile(a.file,F.Config.projectID,a.assetID,a.name,z)];case 16:return e.sent(),D.assets[a.assetID].modifiedAt=U.UUid.createdAtTime(),D.assets[a.assetID].file.size=a.file.size,D.assets[a.assetID].file.hash=z,T=D.assets[a.assetID],[3,18];case 17:a.type,e.label=18;case 18:T&&(N=editor.call("assets:get",T.id))&&"texture"===N.get("type")&&(N.set("modifiedAt",T.modifiedAt),N.set("file.size",T.file.size),N.set("file.hash",T.file.hash),N.emit("thumbnails.m:set",T.name+"?"+T.file.hash)),e.label=19;case 19:return++j===Y&&(console.log("所有文件上传完成"),H.upLoadJsonConfig(JSON.stringify(D),F.Config.projectID,"assets"),Y=j=0,D={}),[2]}var t,n,i,o})})}),editor.method("assets:upload:files",function(t){if(0==Y){if(editor.call("assets:canUploadFiles",t)){var e=editor.call("assets:panel:currentFolder");Y=t.length;for(var n=j=0;n<t.length;n++){var i=[];e&&e.get&&(i=e.get("path").concat(e.get("id")));var o,r,a,s,l=t[n].name.split(".");1!==l.length&&(o=l[l.length-1].toLowerCase(),r=c[o]||"binary",a=editor.call("assets:find",function(e){return e.get("path").join(",")===i.join(",")&&t[n].name===e.get("name")}),s="js"===o?{order:100,scripts:{}}:null,editor.call("assets:uploadFile",{asset:a&&0<a.length?a[0][1]:null,file:t[n],type:r,path:i.join(","),name:t[n].name,parent:editor.call("assets:panel:currentFolder"),pipeline:!0,data:s,meta:null},function(e,t){function n(e){e.get("file.url")?editor.call("scripts:parse",e):e.once("file.url:set",function(){editor.call("scripts:parse",e)})}var i=editor.call("assets:get",t.id);i?n(i):editor.once("assets:add["+t.id+"]",n)}))}}}else console.error("上一次上传指令还未执行完成")}),editor.method("assets:upload:picker",function(e){(e=e||{}).parent||editor.call("assets:panel:currentFolder");var i=document.createElement("input");i.type="file",i.name="file",i.multiple=!0,i.style.display="none",i.style.verticalAlign="middle",i.style.textAlign="center",r.VeryEngine.assets.append(i);var o=function(){H.getJsonConfig(F.Config.projectID,"assets").then(function(e){D=JSON.parse(e),editor.call("assets:upload:files",i.files);for(var t=i.files.length,n=0;n<t;){i.files[n];n++}i.value="",i.removeEventListener("change",o),i.parentNode.removeChild(i)})};i.addEventListener("change",o,!1),i.click()})}var r=e("../../engine"),V=e("../../lib"),F=e("../global"),U=e("../utility/uuid"),H=e("../../tools/ossfile"),W=e("../middleware/loader/babylonLoader");n.AssetsUpload=i},{"../../engine":139,"../../lib":143,"../../tools/ossfile":150,"../global":66,"../middleware/loader/babylonLoader":86,"../utility/uuid":127}],18:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.Assets=void 0;function i(){var r=new o.ObserverList({id:"id",sorted:function(e,t){var n="folder"===e.get("type"),i="folder"===t.get("type");if(n!=i)return n&&!i?-1:1;var o=e.get("name").toLowerCase(),r=t.get("name").toLowerCase();return o===r?0:r<o?1:-1}});editor.method("assets:raw",function(){return r}),editor.method("assets:add",function(o){var e=r.add(o);null!==e&&(o.on("name:set",function(e,t){e=e.toLowerCase(),t=t.toLowerCase();var n=r.data.indexOf(o),i=r.positionNextClosest(o,function(e,t){var n="folder"===e.get("type"),i="folder"===t.get("type");if(n!=i)return n&&!i?-1:1;var o=e.get("name").toLowerCase(),r=t.get("name").toLowerCase();return o===r?0:r<o?1:-1});-1===i&&n+1==r.data.length||-1!==n&&n+1===i||n===i||(n<i&&i--,r.move(o,i),editor.emit("assets:move",o,i))}),editor.emit("assets:add["+o.get("id")+"]",o,e),editor.emit("assets:add",o,e))}),editor.method("assets:remove",function(e){r.remove(e)}),editor.method("assets:clear",function(){r.clear(),editor.emit("assets:clear")}),editor.method("assets:get",function(e){return r.get(e)}),editor.method("assets:find",function(e){return r.find(e)}),editor.method("assets:findOne",function(e){return r.findOne(e)}),editor.method("assets:map",function(e){r.map(e)}),editor.method("assets:list",function(){return r.array()}),r.on("remove",function(e){e.destroy(),editor.emit("assets:remove",e),editor.emit("assets:remove["+e.get("id")+"]")})}var o=e("../../lib");n.Assets=i},{"../../lib":143}],19:[function(e,t,n){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,n,i){void 0===i&&(i=n),Object.defineProperty(e,i,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,i){void 0===i&&(i=n),e[i]=t[n]}),o=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||t.hasOwnProperty(n)||i(t,e,n)};Object.defineProperty(n,"__esModule",{value:!0}),o(e("./assets"),n),o(e("./assets-fs"),n),o(e("./assets-sync"),n),o(e("./assets-preview"),n),o(e("./assets-panel"),n),o(e("./assets-preview"),n),o(e("./assets-panel-control"),n),o(e("./assets-context-menu"),n),o(e("./assets-filter"),n),o(e("./assets-upload"),n),o(e("./assets-drop"),n),o(e("./assets-store"),n),o(e("./assets-create-folder"),n),o(e("./assets-create-table"),n),o(e("./assets-rename"),n),o(e("./keeper"),n)},{"./assets":18,"./assets-context-menu":5,"./assets-create-folder":6,"./assets-create-table":7,"./assets-drop":8,"./assets-filter":9,"./assets-fs":10,"./assets-panel":12,"./assets-panel-control":11,"./assets-preview":13,"./assets-rename":14,"./assets-store":15,"./assets-sync":16,"./assets-upload":17,"./keeper":20}],20:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.AssetsKeeper=void 0;function i(){new d.Assets,new h.AssetsSync,new g.AssetsFs,new y.AssetsPreview,new o.AssetsPanel,new r.AssetsPanelControl,new a.AssetsFilter,new u.AssetsCreateFolder,new c.AssetsContextMenu,new f.AssetsCreateTable,new s.AssetsUpload,new p.AssetsDrop,new l.AssetsStore,new m.AssetsRename}var o=e("./assets-panel"),r=e("./assets-panel-control"),a=e("./assets-filter"),s=e("./assets-upload"),l=e("./assets-store"),c=e("./assets-context-menu"),d=e("./assets"),u=e("./assets-create-folder"),h=e("./assets-sync"),p=e("./assets-drop"),f=e("./assets-create-table"),m=e("./assets-rename"),g=e("./assets-fs"),y=e("./assets-preview");n.AssetsKeeper=i},{"./assets":18,"./assets-context-menu":5,"./assets-create-folder":6,"./assets-create-table":7,"./assets-drop":8,"./assets-filter":9,"./assets-fs":10,"./assets-panel":12,"./assets-panel-control":11,"./assets-preview":13,"./assets-rename":14,"./assets-store":15,"./assets-sync":16,"./assets-upload":17}],21:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.AttributeAssetsTexture=void 0;function i(){var M={};editor.on("attributes:inspect[asset]",function(n){for(var e=0;e<n.length;e++)if("texture"!==n[e].get("type")&&"textureatlas"!==n[e].get("type")||n[e].get("source"))return;for(var t=[],i=[],e=0;e<n.length;e++)i.push(n[e].get("id"));var o=i.sort(function(e,t){return e.localeCompare(t)}).join(","),r=M[o];if(r||((r=M[o]={}).texture=!1,r.compression=!1),1<n.length){for(var a=0,s=0,e=0;e<n.length;e++)"texture"===n[e].get("type")?a++:s++;var l="",c="";a&&(l+=a+"张贴图",c=", "),s&&(l+=c+s+" Texture Atlas"+(1<s?"es":"")),editor.call("attributes:header",l)}var d=editor.call("attributes:addPanel",{name:"贴图",foldable:!0,folded:r.texture});d.class.add("component"),d.on("fold",function(){r.texture=!0}),d.on("unfold",function(){r.texture=!1}),editor.call("attributes:reference:attach","asset:texture:asset",d,d.headerElement);var u=new P.Button("Calculate Meta");u.class.add("calculate-meta","large-with-icon");function h(){for(var e=!1,t=0;t<n.length;t++)e||n[t].get("meta")||(e=!0);u.hidden=!e}u.on("click",function(){if(editor.call("permissions:write")){for(var e=0;e<n.length;e++)n[e].get("meta")||editor.call("realtime:send","pipeline",{name:"meta",id:n[e].get("uniqueId")});u.enabled=!1}}),d.append(u),h();for(e=0;e<n.length;e++)u.hidden&&!n[e].get("meta")&&(u.hidden=!1),t.push(n[e].on("meta:set",function(){h()})),t.push(n[e].on("meta:unset",function(){u.hidden=!1}));var p=editor.call("attributes:addField",{parent:d,name:"Width",link:n,path:"meta.width",placeholder:"pixels"});editor.call("attributes:reference:attach","asset:texture:width",p.parent.innerElement.firstChild.ui);var f=editor.call("attributes:addField",{parent:d,name:"Height",link:n,path:"meta.height",placeholder:"pixels"});editor.call("attributes:reference:attach","asset:texture:height",f.parent.innerElement.firstChild.ui);function m(){g.value||(g.element.innerHTML="unknown")}var g=editor.call("attributes:addField",{parent:d,name:"Depth",link:n,path:"meta.depth",placeholder:"bit"});m(),g.on("change",m),editor.call("attributes:reference:attach","asset:texture:depth",g.parent.innerElement.firstChild.ui);function y(){v.value||(v.element.innerHTML="false")}var v=editor.call("attributes:addField",{parent:d,name:"Alpha",link:n,path:"meta.alpha"});y(),v.on("change",y),editor.call("attributes:reference:attach","asset:texture:alpha",v.parent.innerElement.firstChild.ui);function b(){_.value||(_.element.innerHTML="false")}var _=editor.call("attributes:addField",{parent:d,name:"Interlaced",link:n,path:"meta.interlaced"});b(),_.on("change",b),editor.call("attributes:reference:attach","asset:texture:interlaced",_.parent.innerElement.firstChild.ui);var w=editor.call("attributes:addField",{parent:d,name:"Rgbm",link:n,path:"data.rgbm",type:"checkbox"});editor.call("attributes:reference:attach","asset:texture:rgbm",w.parent.innerElement.firstChild.ui);var x=editor.call("attributes:addField",{parent:d,name:"Mipmaps",link:n,path:"data.mipmaps",type:"checkbox"});editor.call("attributes:reference:attach","asset:texture:mipmaps",x.parent.innerElement.firstChild.ui);var O,B,L,C,A,k,E=editor.call("attributes:addField",{parent:d,name:"Filtering",type:"string",enum:{"":"...",nearest:"Point",linear:"Linear"}});editor.call("attributes:reference:attach","asset:texture:filtering",E.parent.innerElement.firstChild.ui),1===n.length&&(O=editor.call("attributes.rootPanel"),B=function(){n[0].get("file")?T.getUrl(z.Config.projectID,n[0].get("id"),n[0].get("name"),n[0].get("file.hash")).then(function(e){A.src=e,L.style.display=""}):L.style.display="none"},(L=document.createElement("div")).classList.add("asset-preview-container"),(C=document.createElement("div")).classList.add("asset-preview"),(A=new Image).onload=function(){O.class.add("animate"),C.style.backgroundImage='url("'+A.src+'")'},B(),L.appendChild(C),C.addEventListener("click",function(){O.element.classList.contains("large")?O.element.classList.remove("large"):O.element.classList.add("large")},!1),O.class.add("asset-preview"),O.element.insertBefore(L,O.innerElement),(k=[]).push(n[0].on("file.hash:set",B)),k.push(n[0].on("file.url:set",B)),d.on("destroy",function(){for(var e=0;e<k.length;e++)k[e].unbind();L.parentNode.removeChild(L),O.class.remove("asset-preview","animate")})),d.once("destroy",function(){for(var e=0;e<t.length;e++)t[e].unbind()})})}var P=e("../../../ui"),T=e("../../../tools/ossfile"),z=e("../../global/config");n.AttributeAssetsTexture=i},{"../../../tools/ossfile":150,"../../../ui":162,"../../global/config":65}],22:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.AttributesAssets=void 0;function i(){var v={"-1":"various",0:"yes",1:"no"},b=null;editor.on("attributes:inspect[asset]",function(t){var n=[],e=editor.call("attributes.rootPanel");e.folded&&(e.folded=!1);var i,o,r,a,s,l,c,d,u,h,p,f,m=1<t.length,g=(t[0].get("source")&&"folder"!==t[0].get("type")?"source ":"")+t[0].get("type");if(m){editor.call("attributes:header",t.length+" assets");for(var y=0;y<t.length;y++)if(g!==(t[0].get("source")&&"folder"!==t[0].get("type")?"source ":"")+t[y].get("type")){g="";break}}else editor.call("attributes:header",g);(e=editor.call("attributes:addPanel")).class.add("component"),(b=e).once("destroy",function(){b=null;for(var e=0;e<n.length;e++)n[e].unbind();n=null}),m?editor.call("attributes:addField",{parent:e,name:"Assets",value:t.length}):(i=editor.call("attributes:addField",{parent:e,name:"ID",link:t[0],path:"id"}),editor.call("attributes:reference:attach","asset:id",i.parent.innerElement.firstChild.ui),o=editor.call("attributes:addField",{parent:e,name:"名字",type:"string",value:t[0].get("name")}),n.push(t[0].on("name:set",function(e){o.value=e})),n.push(o.on("change",function(e){e!==t[0].get("name")&&editor.call("assets:rename",t[0],e)})),o.class.add("asset-name"),editor.call("attributes:reference:attach","asset:name",o.parent.innerElement.firstChild.ui),t[0].get("source")||"folder"===t[0].get("type")||(r=editor.call("attributes:addField",{parent:e,name:"Tags",placeholder:"Add Tag",type:"tags",tagType:"string",link:t[0],path:"tags"}),editor.call("attributes:reference:attach","asset:tags",r.parent.parent.innerElement.firstChild.ui)),a=v[t[0].get("source")?"1":"0"],"folder"===t[0].get("type")&&(a=v[1]),s=editor.call("attributes:addField",{parent:e,name:"Runtime",value:a}),editor.call("attributes:reference:attach","asset:runtime",s.parent.innerElement.firstChild.ui),(l=editor.call("attributes:addField",{parent:e,name:"Failed",link:t[0],path:"taskInfo"})).class.add("error"),(c=function(){l.parent.hidden="failed"!==t[0].get("task")||!t[0].get("taskInfo")})(),n.push(t[0].on("task:set",c)),n.push(t[0].on("taskInfo:set",c)),n.push(t[0].on("taskInfo:unset",c)),d=editor.call("attributes:addField",{parent:e,name:"Type",value:g}),editor.call("attributes:reference:attach","asset:type",d.parent.innerElement.firstChild.ui),t[0].get("source")||editor.call("attributes:reference:asset:"+t[0].get("type")+":asset:attach",d),"folder"===t[0].get("type")||t[0].get("source")||((u=editor.call("attributes:addField",{parent:e,name:"Preload",type:"checkbox",link:t[0],path:"preload"})).parent.class.add("preload"),editor.call("attributes:reference:attach","asset:preload",u.parent.innerElement.firstChild.ui)),(h=new _.Panel).class.add("buttons"),e.append(h),"folder"!==t[0].get("type")&&"sprite"!==t[0].get("type")&&((p=new _.Button).hidden=!editor.call("permissions:read"),f=editor.on("permissions:set:id",function(){p.hidden=!editor.call("permissions:read")}),p.text="下载",p.class.add("download-asset","large-with-icon"),p.element.addEventListener("click",function(e){t[0].get("source")||"texture"===t[0].get("type")||"audio"===t[0].get("type")||"model"===t[0].get("type")?w.donwLoad(x.Config.projectID,t[0].get("id"),t[0].get("name"),t[0].get("file.hash")):window.open("/api/assets/"+t[0].get("id")+"/download?branchId=id")}),h.append(p),p.once("destroy",function(){f.unbind()})))}),editor.on("attributes:assets:toggleInfo",function(e){b&&(b.hidden=!e)}),editor.method("attributes:assets:panel",function(){return b})}var _=e("../../ui"),w=e("../../tools/ossfile"),x=e("../global");n.AttributesAssets=i},{"../../tools/ossfile":150,"../../ui":162,"../global":66}],23:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.AttributesEntity=void 0;function i(){var d;editor.method("attributes:entity.panelComponents",function(){return d}),editor.method("attributes:entity:addComponentPanel",function(e){var n,t=e.title,i=e.name,o=e.entities,r=[],a=editor.call("attributes:addPanel",{parent:d,name:t});a.class.add("component","entity",i);function s(){n=!1;for(var e=o[0].get("type")===i,t=1;t<o.length;t++)if(e!==o[t].get("type")===i){e=!1;break}a.disabled=!e,a.hidden=!e}function l(){n||(n=!0,setTimeout(s))}s();for(var c=0;c<o.length;c++)r.push(o[c].on("components."+i+":set",l)),r.push(o[c].on("components."+i+":unset",l));return a.once("destroy",function(){for(var e=0;e<o.length;e++)r[e].unbind()}),a});var c=null,u=[],h=[];editor.on("attributes:beforeClear",function(){for(var e=0;e<u.length;e++)u[e].link=null,u[e].unlinkField();c&&c.panel&&c.panel.parent&&(c.panel.parent.remove(c.panel),c.panelComponents.parent.remove(c.panelComponents),c.panelComponents.clear())});var o=[];editor.on("attributes:inspect[entity]",function(e){1<e.length?editor.call("attributes:header",e.length+"个物体"):editor.call("attributes:header","物体属性"),c||function(){var e=(c={}).panel=editor.call("attributes:addPanel");e.class.add("component");var t={parent:e,name:"激活",type:"checkbox",path:"enabled"};c.fieldEnabled=editor.call("attributes:addField",t),u.push(t),h.push(c.fieldEnabled);var n={parent:e,name:"名字",type:"string",trim:!0,path:"name"};c.fieldName=editor.call("attributes:addField",n),c.fieldName.class.add("entity-name"),u.push(n),h.push(c.fieldName);var i={parent:e,name:"位置",placeholder:["X","Y","Z"],precision:3,step:.05,type:"vec3",path:"position"};c.fieldPosition=editor.call("attributes:addField",i),u.push(i),h=h.concat(c.fieldPosition);var o={parent:e,name:"角度",placeholder:["X","Y","Z"],precision:2,step:.1,type:"vec3",path:"rotation"};c.fieldRotation=editor.call("attributes:addField",o),u.push(o),h=h.concat(c.fieldRotation);var r={parent:e,name:"比例",placeholder:["X","Y","Z"],precision:3,step:.05,type:"vec3",path:"scale"};c.fieldScale=editor.call("attributes:addField",r),u.push(r),h=h.concat(c.fieldScale);var a={parent:e,name:"碰撞检测",type:"checkbox",path:"checkCollisions"};c.checkCollisions=editor.call("attributes:addField",a),u.push(a),h.push(c.checkCollisions);var s={parent:e,name:"可选中",type:"checkbox",path:"pickable"};c.pickable=editor.call("attributes:addField",s),u.push(s),h.push(c.pickable),d=c.panelComponents=editor.call("attributes:addPanel");var l=c.btnAddComponent=new p.Button;l.text="To Be Continued",l.class.add("add-component"),l.style.textAlign="center",e.append(l)}();var t=editor.call("attributes.rootPanel");c.panel.parent||t.append(c.panel),c.panelComponents.parent||t.append(c.panelComponents);for(var n=0;n<h.length;n++)h[n].renderChanges=!1;for(n=0;n<u.length;n++)u[n].link=e,u[n].linkField();for(n=0;n<h.length;n++)h[n].renderChanges=!0;r(e),1===e.length&&"2d-gui"===e[0].get("type")?c.panel.element.style.display="none":c.panel.element.style.display="block",i(e)}),editor.on("attributes:clear",function(){a()});var r=function(e){for(var t=!1,n=!1,i=!1,o=0,r=e.length;o<r;o++){var a=e[o];a.get("components.screen.screenSpace")&&(i=n=!0),editor.call("entities:layout:isUnderControlOfLayoutGroup",a)&&(t=!0)}c.fieldPosition[0].enabled=!t,c.fieldPosition[1].enabled=!t;for(o=0;o<3;o++)c.fieldRotation[o].enabled=!n,c.fieldScale[o].enabled=!i,c.fieldRotation[o].renderChanges=!n,c.fieldScale[o].renderChanges=!i},i=function(e){a();for(var n=function(e){editor.call("selector:has",e)&&r(editor.call("selector:items"))},t=0,i=e.length;t<i;t++)!function(t){o.push(t.on("*:set",function(e){(/components.screen.screenSpace/.test(e)||/^parent/.test(e)||/components.layoutchild.excludeFromLayout/.test(e))&&n(t)}))}(e[t])},a=function(){for(var e=0;e<o.length;e++)o[e].unbind();o.length=0}}var p=e("../../ui");n.AttributesEntity=i},{"../../ui":162}],24:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.AttributeHistory=void 0;function i(){}n.AttributeHistory=i},{}],25:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.AttributesPanel=void 0;function i(){var e=this;function o(){editor.emit("attributes:beforeClear"),e.root.clear(),editor.emit("attributes:clear")}this.title="属性面板",this.root=a.VeryEngine.attributes;var V=this;function F(e,t){void 0!==e.history?"boolean"==typeof e.history?e.history=t:e.history.enabled=t:e._parent&&void 0!==e._parent.history&&(e._parent.history.enabled=t)}function U(e,t){return e.paths&&0<e.paths.length?e.paths[t]:e.path}editor.method("attributes:header",function(e){"texture"===e.toLowerCase()?e="贴图":"material"===e.toLowerCase()?e="材质":"model"===e.toLowerCase()?e="模型":"folder"===e.toLowerCase()&&(e="文件夹"),V.root.headerText=e}),editor.method("attributes.rootPanel",function(){return V.root}),editor.method("attributes:addPanel",function(e){e=e||{};var t=new H.Panel(e.name||"");return(e.parent||V.root).append(t),t.foldable=e.foldable||e.folded||!1,t.folded=e.folded||!1,t}),editor.method("attributes:linkField",function(s){s.field._changing=!1;var t=[];s.link instanceof Array||(s.link=[s.link]);function e(){var e=!1,t=U(s,0),n=s.link[0].has(t)?s.link[0].get(t):void 0;if("rgb"===s.type){if(n)for(var i=1;i<s.link.length;i++)if(t=U(s,i),!n.equals(s.link[i].get(t))){e=!(n=null);break}n=n&&n.map(function(e){return Math.floor(255*e)})}else if("asset"===s.type){for(var o=void 0===n?1:0,i=1;i<s.link.length;i++)if(t=U(s,i),s.link[i].has(t)){var r=s.link[i].get(t);if((n||0)!==(s.link[i].get(t)||0)&&void 0!==n){n=s.enum?"":null,e=!0;break}n=r}else o++;o&&o!=s.link.length?(s.field.class.add("star"),/^\* /.test(s.field._title.text)||(s.field._title.text="* "+s.field._title.text)):(s.field.class.remove("star"),/^\* /.test(s.field._title.text)&&(s.field._title.text=s.field._title.text.substring(2))),e?(s.field.class.add("null"),s.field._title.text="various"):s.field.class.remove("null")}else if("entity"===s.type||!s.type){for(i=1;i<s.link.length;i++)if(t=U(s,i),n!==s.link[i].get(t)){n="various",e=!0;break}e?(s.field.class.add("null"),s.field.text="various"):s.field.class.remove("null")}s.field._changing=!0,s.field.value=n,"checkbox"===s.type&&s.field._onLinkChange(n),s.field._changing=!1}var l,c,d,n,i=function(i){if(!s.field._changing){s.enum,s.trim&&(i=i.trim()),"rgb"===s.type?i=i.map(function(e){return e/255}):"asset"===s.type&&s.field.class.remove("null");var o=[];s.field._changing=!0,"string"===s.type&&s.trim&&(s.field.value=i);for(var e=0;e<s.link.length;e++){var t=U(s,e);s.link[e].has(t)&&(o.push({get:void 0!==s.link[e].history?s.link[e].history._getItemFn:null,item:s.link[e],value:s.link[e].has(t)?s.link[e].get(t):void 0}),F(s.link[e],!1),s.link[e].set(t,i),F(s.link[e],!0))}s.field._changing=!1,"rgb"===s.type||s.slider||s.stopHistory||editor.call("history:add",{name:U(s,0),undo:function(){for(var e=!1,t=0;t<o.length;t++){var n,i=U(s,t);if(o[t].get){if(!(n=o[t].get()))continue}else n=o[t].item;e||o[0].value===o[t].value||(e=!0),F(n,!1),void 0===o[t].value?n.unset(i):n.set(i,o[t].value),F(n,!0)}e?s.field.class.add("null"):s.field.class.remove("null")},redo:function(){for(var e=0;e<o.length;e++){var t,n=U(s,e);if(o[e].get){if(!(t=o[e].get()))continue}else t=o[e].item;F(t,!1),void 0===i?t.unset(n):t.set(n,i),t.set(n,i),F(t,!0)}s.field.class.remove("null")}})}},o=function(){s.field._changing||(s.field._changing=!0,setTimeout(function(){s.field._changing=!1,e()},0))};"rgb"!==s.type&&!s.slider||(l=function(){for(var e=[],t=0;t<s.link.length;t++){var n=s.link[t].get(U(s,t));n instanceof Array&&(n=n.slice(0)),e.push({get:void 0!==s.link[t].history?s.link[t].history._getItemFn:null,item:s.link[t],value:n})}return e},c=function(n,i){editor.call("history:add",{name:U(s,0),undo:function(){for(var e,t=0;t<n.length;t++){if(n[t].get){if(!(e=n[t].get()))continue}else e=n[t].item;F(e,!1),e.set(U(s,t),n[t].value),F(e,!0)}},redo:function(){for(var e,t=0;t<n.length;t++){if(n[t].get){if(!(e=n[t].get()))continue}else e=n[t].item;F(e,!1),e.set(U(s,t),i),F(e,!0)}}})}),"rgb"===s.type?(d=!1,t.push(s.field.on("click",function(){d=!0,editor.call("picker:color",s.field.value);var e=[],t=editor.on("picker:color:start",function(){e=l()}),n=editor.on("picker:color",function(e){s.field.value=e}),i=editor.on("picker:color:end",function(){c(e.slice(0),s.field.value.map(function(e){return e/255}))}),o=editor.call("picker:color:rect"),r=s.field.element.getBoundingClientRect();editor.call("picker:color:position",r.left-o.width,r.top);var a=s.field.on("change",function(){editor.call("picker:color:set",s.field.value)});editor.once("picker:color:close",function(){n.unbind(),t.unbind(),i.unbind(),a.unbind(),d=!1,s.field.element.focus()})})),s.field.once("destroy",function(){d&&editor.call("picker:color:close")})):s.slider&&(t.push(s.field.on("start",function(){n=l()})),t.push(s.field.on("end",function(){c(n.slice(0),s.field.value)}))),e(),t.push(s.field.on("change",i));for(var r=0;r<s.link.length;r++)t.push(s.link[r].on(U(s,r)+":set",o)),t.push(s.link[r].on(U(s,r)+":unset",o));return t.push(s.field.once("destroy",function(){for(var e=0;e<t.length;e++)t[e].unbind()})),t}),editor.method("attributes:addField",function(a){var o=a.panel;o||((o=new H.Panel).flexWrap="nowrap",o.WebkitFlexWrap="nowrap",o.style.display="",o.innerElement.style.display="flex",a.type?o.class.add("field-"+a.type):o.class.add("field"),(a.parent||V.root).append(o));var e=null;if(a.name&&((e=new H.Label(a.name)).class.add("label-field"),o._label=e,o.append(e),a.reference&&(e.tooltip=editor.call("attributes:reference",{element:e.element,title:a.reference.title,subTitle:a.reference.subTitle,description:a.reference.description})).attach({target:e,element:e.element})),a.linkEvents=[],a.paths&&a.paths instanceof Array&&a.link&&!(a.link instanceof Array)){var t=a.link;a.link=[];for(var n=0;n<a.paths.length;n++)a.link.push(t)}var r,i=a.linkField=function(){if(a.link){var e=function(e,t){var n={field:e,type:a.type,slider:a.slider,enum:a.enum,link:a.link,trim:a.trim,name:a.name,stopHistory:a.stopHistory,paths:new Array,path:""};(t=t||(a.paths||a.path))instanceof Array?n.paths=t:n.path=t,a.linkEvents=a.linkEvents.concat(editor.call("attributes:linkField",n)),e.element&&"string"==typeof t&&e.element.classList.add("field-path-"+t.replace(/\./g,"-"))};if(w instanceof Array)for(var t=0;t<w.length;t++){var n=(n=a.paths)&&n.map(function(e){return e+"."+t.toString()});e(w[t],n||a.path+"."+t)}else e(w)}};a.unlinkField=function(){for(var e=0;e<a.linkEvents.length;e++)a.linkEvents[e].unbind();a.linkEvents=[]};switch(a.type){case"string":(w=a.enum?new H.SelectField({options:a.enum}):new H.TextField).value=a.value||"",w.flexGrow=1,a.placeholder&&(w.placeholder=a.placeholder),i(),o.append(w);break;case"tags":var s,l=new H.Panel,c=a.tagType||"string";a.enum?((w=new H.SelectField({options:a.enum,type:c})).renderChanges=!1,w.on("change",function(e){if("string"===c){if(!e)return;e=e.trim()}f(e),w.value=""}),l.append(w)):((w=new H.TextField).blurOnEnter=!1,w.renderChanges=!1,w.element.addEventListener("keydown",function(e){13===e.keyCode&&w.value&&(f(w.value.trim()),w.value="")}),l.append(w),(s=new H.Button("&#57632")).flexGrow="0",s.on("click",function(){w.value&&(f(w.value.trim()),w.value="")}),l.append(s));var d=new H.Panel;d.class.add("tags"),d.flex=!0,l.append(d);var u={},h={},p=[],f=function(e){var n=[],t=0;if("number"!==a.tagType||(t=parseInt(e,10),!isNaN(t))){for(var i=0;i<a.link.length;i++){var o=U(a,i);-1===a.link[i].get(o).indexOf(t)&&(n.push({get:void 0!==a.link[i].history?a.link[i].history._getItemFn:null,item:a.link[i],path:o,value:t}),F(a.link[i],!1),a.link[i].insert(o,t),F(a.link[i],!0))}a.stopHistory||editor.call("history:add",{name:U(a,0),undo:function(){for(var e,t=0;t<n.length;t++){if(n[t].get){if(!(e=n[t].get()))continue}else e=n[t].item;F(e,!1),e.removeValue(n[t].path,n[t].value),F(e,!0)}},redo:function(){for(var e,t=0;t<n.length;t++){if(n[t].get){if(!(e=n[t].get()))continue}else e=n[t].item;F(e,!1),e.insert(n[t].path,n[t].value),F(e,!0)}}})}},m=function(e){h.hasOwnProperty(e)||(h[e]=0,p.push(e)),h[e]++,v(e)},g=function(e){var t;h[e]&&(h[e]--,h[e]?h[e]===a.link.length?u[e].classList.remove("partial"):u[e].classList.add("partial"):(d.innerElement.removeChild(u[e]),-1!==(t=p.indexOf(e))&&p.splice(t,1),delete u[e],delete h[e]))},y=function(e){for(var t=0;t<e.length;t++){var n=e[t];m(n)}},v=function(e){var t,n,i,o;u[e]||(b(),t=document.createElement("div"),(u[e]=t).classList.add("tag"),(n=document.createElement("span")).textContent=a.tagToString?a.tagToString(e):e,t.appendChild(n),a.onClickTag&&n.addEventListener("click",a.onClickTag.bind(t)),(i=document.createElement("span")).innerHTML="&#57650;",i.classList.add("icon"),i.addEventListener("click",function(){l.disabled},!1),t.appendChild(i),o=p.indexOf(e),u[p[o+1]]?d.appendBefore(t,u[p[o+1]]):d.append(t)),h[e]===a.link.length?u[e].classList.remove("partial"):u[e].classList.add("partial")},b=function(){p.sort(function(e,t){return a.tagToString&&(e=a.tagToString(e),t=a.tagToString(t)),t<e?1:e<t?-1:0})};a.placeholder&&(w.placeholder=a.placeholder),a.linkEvents=[],a.linkField=function(){if(a.link){a.link instanceof Array||(a.link=[a.link]);for(var e=0;e<a.link.length;e++){var t=U(a,e),n=a.link[e].get(t);if(a.linkEvents.push(a.link[e].on(t+":set",y)),a.linkEvents.push(a.link[e].on(t+":insert",m)),a.linkEvents.push(a.link[e].on(t+":remove",g)),n)for(var i=0;i<n.length;i++)"string"===c&&!n[i]||null===n[i]||void 0===n[i]||(h.hasOwnProperty(n[i])||(h[n[i]]=0,p.push(n[i])),h[n[i]]++)}}b();for(e=0;e<p.length;e++)v(p[e])},a.unlinkField=function(){for(var e,t=0;t<a.linkEvents.length;t++)a.linkEvents[t].unbind();for(e in a.linkEvents=[],u)d.innerElement.removeChild(u[e]);p=[],h={},u={}},a.linkField(),o.once("destroy",a.unlinkField),o.append(l);break;case"text":(w=new H.TextAreaField).value=a.value||"",w.flexGrow=1,a.placeholder&&(w.placeholder=a.placeholder),i(),o.append(w);break;case"number":(w=a.enum?new H.SelectField({options:a.enum,type:"number"}):a.slider?new H.Slider:new H.NumberField).value=a.value||0,w.flexGrow=1,a.allowNull&&(w.allowNull=!0),a.placeholder&&(w.placeholder=a.placeholder),null!=a.precision&&(w.precision=a.precision),null!=a.step&&(w.step=a.step),null!=a.min&&(w.min=a.min),null!=a.max&&(w.max=a.max),i(),o.append(w);break;case"checkbox":a.enum?(w=new H.SelectField({options:a.enum,type:"boolean"})).flexGrow=1:w=new H.Checkbox,w.value=a.value||0,w.class.add("tick"),i(),o.append(w);break;case"vec2":case"vec3":case"vec4":for(var _=parseInt(a.type[3],10),w=[],n=0;n<_;n++)w[n]=new H.NumberField,w[n].flexGrow=1,w[n].style.width="24px",w[n].value=a.value&&a.value[n]||0,o.append(w[n]),a.placeholder&&(w[n].placeholder=a.placeholder[n]),null!=a.precision&&(w[n].precision=a.precision),null!=a.step&&(w[n].step=a.step),null!=a.min&&(w[n].min=a.min),null!=a.max&&(w[n].max=a.max);i();break;case"rgb":w=new H.ColorField,null!=a.channels&&(w.channels=a.channels),i();var x=!1;w.on("click",function(){x=!0;editor.call("picker:color",w.value);var e=editor.on("picker:color:start",function(){0}),t=editor.on("picker:color",function(e){w.value=e}),n=editor.call("picker:color:rect"),i=w.element.getBoundingClientRect();editor.call("picker:color:position",i.left-n.width,i.top);var o=w.on("change",function(){editor.call("picker:color:set",w.value)});editor.once("picker:color:close",function(){t.unbind(),e.unbind(),o.unbind(),x=!1,w.element.focus()})}),w.on("destroy",function(){x&&editor.call("picker:color:close")}),o.append(w);break;case"asset":w=new H.ImageField,null!==e&&(e.renderChanges=!1,(w._label=e).style.width="32px",e.flexGrow="1");var O=document.createElement("div");O.classList.add("top");var B=document.createElement("div");B.classList.add("controls");var L=w._title=new H.Label;L.text="Empty",L.parent=o,L.flexGrow="1",L.placeholder="...";var C=new H.Button("&#57648;");C.disabled=!0,C.parent=o,C.flexGrow="0";var A=new H.Button("&#57650;");A.disabled=!0,A.parent=o,A.flexGrow="0",L.on("click",function(){var e=editor.call("assets:get",w.value);editor.call("picker:asset",{type:a.kind,currentAsset:e}),r=editor.once("picker:asset",function(e){var t={};if(a.onSet&&a.link&&a.link instanceof Array)for(var n=0;n<a.link.length;n++){var i=0;if("asset"===a.link[n]._type)i=a.link[n].get("id");else{if("entity"!==a.link[n]._type)continue;i=a.link[n].get("resource_id")}t[i]=a.link[n].get(U(a,n))}w.emit("beforechange",e.get("id")),w.value=e.get("id"),r=null,a.onSet&&a.onSet(e,t)}),editor.once("picker:asset:close",function(){r&&(r.unbind(),r=null),w.element.focus()})}),w.on("click",function(){var e,t;!w.value||(e=editor.call("assets:get",w.value))&&(editor.call("selector:set","asset",[e]),(t=e.get("path")).length?editor.call("assets:panel:currentFolder",editor.call("assets:get",t[t.length-1])):editor.call("assets:panel:currentFolder",null))}),C.on("click",function(){w.emit("click")}),A.on("click",function(){w.emit("beforechange",null),w.value=null});var k,E,M,P,T,z,N,S=null,I=null,D=function(e){var t=editor.call("assets:get",w.value);S&&(editor.call("assets:"+I.get("type")+":unwatch",I,S),I=S=null),e?w.image="":t?(W.getThumbnailUrl(K.Config.projectID,t.get("id"),t.get("name"),t.get("file.hash")).then(function(e){w.image=e}),"material"!==a.kind&&"model"!==a.kind&&"cubemap"!==a.kind&&"font"!=a.kind&&"sprite"!==a.kind||(I=t,S=editor.call("assets:"+a.kind+":watch",{asset:I,autoLoad:!0,callback:E}))):w.image="/editor/static/asset-placeholder-texture.png",E&&E()};"material"===a.kind||"model"===a.kind||"font"===a.kind||"sprite"===a.kind?("sprite"!==a.kind&&w.elementImage.classList.add("flipY"),(N=function(){k=!1,I?editor.call("preview:render",I,128,128,w.elementImage):(w.elementImage.ctx||(w.elementImage.ctx=w.elementImage.getContext("2d"))).clearRect(0,0,w.elementImage.width,w.elementImage.height)})(),E=function(){k||(k=!0,requestAnimationFrame(N))},P=editor.on("preview:scene:changed",E),w.once("destroy",function(){P.unbind(),P=null,S&&(editor.call("assets:"+I.get("type")+":unwatch",I,S),I=S=null)})):"cubemap"===a.kind&&(w.elementImage.width=60,w.elementImage.height=60,T=[[30,22],[0,22],[15,7],[15,37],[15,22],[45,22]],z=[null,null,null,null,null,null],(N=function(){k=!1;var e=w.elementImage.ctx;if((e=e||(w.elementImage.ctx=w.elementImage.getContext("2d"))).clearRect(0,0,w.elementImage.width,w.elementImage.height),I)for(var t=0;t<6;t++){var n,i,o,r=I.get("data.textures."+t),a=null;r&&(n=editor.call("assets:get",r))?(i=n.get("file.hash"),z[t]&&z[t].hash===i?a=z[t]:(o=n.get("thumbnails.s"),z[t]&&(z[t].onload=null),z[t]=null,o&&((a=z[t]=new Image).hash=i,a.onload=E,a.src=o.appendQuery("t="+i)))):z[t]&&(z[t].onload=null,z[t]=null),a?e.drawImage(a,T[t][0],T[t][1],15,15):(e.beginPath(),e.rect(T[t][0],T[t][1],15,15),e.fillStyle="#000",e.fill())}})(),E=function(){k||(k=!0,requestAnimationFrame(N))},w.once("destroy",function(){S&&(editor.call("assets:cubemap:unwatch",I,S),I=S=null)})),i();var j=function(){var e=w.value;if(L.text=w.class.contains("null")?"various":"Empty",C.disabled=!e,A.disabled=!e&&!w.class.contains("null"),M&&(M.unbind(),M=null),!e)return w.class.contains("star")&&(L.text="* "+L.text),w.empty=!0,void D(!0);w.empty=!1;var t=editor.call("assets:get",e);if(!t)return D();M=t.on("file.hash.m:set",D),D(),L.text=t.get("name"),w.class.contains("star")&&(L.text="* "+L.text)};w.on("change",j),a.value&&(w.value=a.value),j();var Y=editor.call("drop:target",{ref:o.element,filter:function(e,t){var n=V.root.innerElement.getBoundingClientRect(),i=o.element.getBoundingClientRect();return t.id&&("*"===a.kind||e==="asset."+a.kind)&&parseInt(t.id,10)!==w.value&&!editor.call("assets:get",parseInt(t.id,10)).get("source")&&i.top>n.top&&i.bottom<n.bottom},drop:function(e,t){if(!("*"!==a.kind&&e!=="asset."+a.kind||editor.call("assets:get",parseInt(t.id,10)).get("source"))){var n,i={};if(a.onSet&&a.link&&a.link instanceof Array)for(var o=0;o<a.link.length;o++){var r=0;if("asset"===a.link[o]._type)r=a.link[o].get("id");else{if("entity"!==a.link[o]._type)continue;r=a.link[o].get("resource_id")}i[r]=a.link[o].get(U(a,o))}w.emit("beforechange",parseInt(t.id,10)),w.value=parseInt(t.id,10),!a.onSet||(n=editor.call("assets:get",parseInt(t.id,10)))&&a.onSet(n,i)}},over:function(e,t){a.over&&a.over(e,t)},leave:function(){a.leave&&a.leave()}});w.on("destroy",function(){Y.unregister(),M&&(M.unbind(),M=null)}),o.append(w),o.append(O),O.appendChild(B),e&&(o.innerElement.removeChild(e.element),B.appendChild(e.element)),B.classList.remove("label-field"),B.appendChild(C.element),B.appendChild(A.element),O.appendChild(L.element);break;case"entity":(w=new H.Label).class.add("add-entity"),w.flexGrow=1,w.class.add("null"),w.text="Select Entity",w.placeholder="...",o.append(w);var G=document.createElement("span");G.classList.add("icon"),G.addEventListener("click",function(e){e.stopPropagation()}),w.on("change",function(e){if(e){var t=editor.call("entities:get",e);if(!t)return void(w.text=null);w.element.innerHTML=t.get("name"),w.element.appendChild(G),w.placeholder="","various"!==e&&w.class.remove("null")}else w.element.innerHTML="Select Entity",w.placeholder="...",w.class.add("null")}),i();var R=function(){var e=null;if(a.link){a.link instanceof Array||(a.link=[a.link]);for(var t=0,n=a.link.length;t<n;t++){var i=a.link[t].get(U(a,t));if(e!==i){if(e){e=null;break}e=i}}}return e};w.on("click",function(){var t=editor.once("picker:entity",function(e){w.text=e?e.get("resource_id"):null,t=null}),e=R();editor.call("picker:entity",e,a.filter||null),editor.once("picker:entity:close",function(){t&&(t.unbind(),t=null)})}),w.on("hover",function(){var e=R();e&&(editor.call("entities:panel:highlight",e,!0),w.once("blur",function(){editor.call("entities:panel:highlight",e,!1)}),w.once("click",function(){editor.call("entities:panel:highlight",e,!1)}))});Y=editor.call("drop:target",{ref:w.element,filter:function(e,t){var n=V.root.innerElement.getBoundingClientRect(),i=w.element.getBoundingClientRect();return"entity"===e&&t.resource_id!==w.value&&i.top>n.top&&i.bottom<n.bottom},drop:function(e,t){"entity"===e&&(w.value=t.resource_id)},over:function(e,t){a.over&&a.over(e,t)},leave:function(){a.leave&&a.leave()}});w.on("destroy",function(){Y.unregister()});break;case"image":o.flex=!1,(w=new Image).style.maxWidth="100%",w.style.display="block",w.src=a.src,o.append(w);break;case"progress":(w=new H.Progress).flexGrow=1,o.append(w);break;case"button":(w=new H.Button).flexGrow=1,w.text=a.text||"Button",o.append(w);break;case"element":w=a.element,o.append(w);break;case"array":w=editor.call("attributes:addArray",a),o.append(w);break;default:(w=new H.Label).flexGrow="1",w.text=a.value||"",w.class.add("selectable"),a.placeholder&&(w.placeholder=a.placeholder),i(),o.append(w)}return a.className&&w instanceof H.Element&&w.class.add(a.className),w});var r=[];editor.on("attributes:clear",function(){for(var e=0;e<r.length;e++)r[e].unbind();r=[]}),editor.method("attributes:inspect",function(e,t){o(),r.push(t.once("destroy",function(){editor.call("attributes:clear")})),V.root.headerText=e,editor.emit("attributes:inspect["+e+"]",[t]),editor.emit("attributes:inspect[*]",e,[t])}),editor.on("selector:change",function(e,t){if(o(),0===t.length){var n=new H.Label("请选择物体或资源");return n.style.display="block",n.style.textAlign="center",n.style.width="100%",V.root.append(n),void(V.root.headerText=V.title)}for(var i=0;i<t.length;i++)r.push(t[i].once("destroy",function(){editor.call("attributes:clear")}));V.root.headerText=e,editor.emit("attributes:inspect["+e+"]",t),editor.emit("attributes:inspect[*]",e,t)}),editor.emit("selector:change",null,[]),editor.method("attributes:clear",o)}var H=e("../../ui"),a=e("../../engine"),W=e("../../tools/ossfile"),K=e("../global");n.AttributesPanel=i},{"../../engine":139,"../../tools/ossfile":150,"../../ui":162,"../global":66}],26:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.AttributesReference=void 0;var i=e("../../ui"),o=e("../../engine"),r=(a.prototype.init=function(){var p=this;editor.method("attributes:reference:add",function(e){p.index[e.name]=editor.call("attributes:reference",e)}),editor.method("attributes:reference:attach",function(e,t,n,i){var o=p.index[e];if(o)return o.attachReference({target:t,panel:i,element:n||t.ui}),o;p.missing[e]||(p.missing[e]=!0)}),editor.method("attributes:reference:template",function(e){var t="";return e.title&&(t+="<h1>"+p.sanitize(e.title)+"</h1>"),e.subTitle&&(t+="<h2>"+p.sanitize(e.subTitle)+"</h2>"),e.webgl2&&(t+='<div class="tag">WebGL 2.0 Only</div>'),e.description&&(t+="<p>"+p.sanitize(e.description).replace(/\n/g,"<br />").replace(/&lt;b&gt;/g,"<b>").replace(/&lt;\/b&gt;/g,"</b>")+"</p>"),e.code&&(t+='<pre class="ui-code">'+p.sanitize(e.code)+"</pre>"),e.url&&(t+='<a class="reference" href="'+p.sanitize(e.url)+'" target="_blank">API Reference</a>'),t}),editor.method("attributes:reference",function(e){var c=new i.Tooltip({align:"right"});c.hoverable=!0,c.class.add("reference"),c.html=editor.call("attributes:reference:template",e);var d=null,u=null;c.attachReference=function(e){function t(){a&&!a.hidden&&(c.position(l.element.getBoundingClientRect().left,s.getBoundingClientRect().top+16),c.hidden=!1)}function n(){null!==d&&clearTimeout(d),null!==u&&clearTimeout(u),c.hidden=!0}function i(){null!==u&&clearTimeout(u),d=setTimeout(t,500)}function o(){null!==d&&clearTimeout(d),u=setTimeout(h,200)}function r(){null!==d&&clearTimeout(d),null!==u&&clearTimeout(u),t()}var a=e.target,s=e.element,l=e.panel||p.attributesPanel;a.on("hide",n),a.once("destroy",function(){s.removeEventListener("mouseover",i),s.removeEventListener("mouseout",o),s.removeEventListener("click",r),a.unbind("hide",n),(s=a=null)!==d&&clearTimeout(d),null!==u&&clearTimeout(u),c.hidden=!0}),s.addEventListener("mouseover",i,!1),s.addEventListener("mouseout",o,!1),s.addEventListener("click",r,!1)};var h=function(){c.hidden=!0};return c.on("hover",function(){clearTimeout(u)}),p.root.append(c),c})},a.prototype.sanitize=function(e){return e.replace(/</g,"&lt;").replace(/>/g,"&gt;")},a);function a(){this.index={},this.missing={},this.root=o.VeryEngine.root,this.attributesPanel=o.VeryEngine.attributes,this.init()}n.AttributesReference=r},{"../../engine":139,"../../ui":162}],27:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.AttributeComponentCamera=void 0;function i(){editor.on("attributes:inspect[entity]",function(e){var t,n,i,o;1===e.length&&"camera"===e[0].get("type")&&editor.call("attributes:entity.panelComponents")&&(editor.call("settings:project"),t=editor.call("attributes:entity:addComponentPanel",{title:"摄像机属性",name:"camera",entities:e}),editor.call("attributes:addField",{parent:t,name:"背景色",type:"rgb",link:e,path:"clearColor"}),n=editor.call("attributes:addField",{parent:t,name:"相机类型",type:"number",enum:[{v:0,t:"透视相机"},{v:1,t:"正交相机"}],link:e,path:"mode"}),(i=editor.call("attributes:addField",{parent:t,name:"视野角度",placeholder:"弧度",type:"number",precision:2,step:1,min:0,link:e,path:"fov"})).style.width="32px",i.parent.hidden=0!==n.value&&""!==n.value,n.on("change",function(e){i.parent.hidden=0!==e&&""!==e}),editor.call("attributes:addField",{panel:i.parent,precision:2,step:1,min:0,max:Math.PI/2,type:"number",slider:!0,link:e,path:"fov"}).flexGrow=4,(o=editor.call("attributes:addField",{parent:t,name:"视野宽度",type:"number",link:e,path:"orthoSize"})).parent.hidden=1!==n.value&&""!==n.value,n.on("change",function(e){o.parent.hidden=1!==e&&""!==e}),editor.call("attributes:addField",{parent:t,name:"近平面",type:"number",precision:2,step:.1,min:-1e5,link:e,path:"minZ"}).style.width="32px",editor.call("attributes:addField",{parent:t,name:"远平面",type:"number",precision:2,step:.1,min:0,link:e,path:"maxZ"}).style.width="32px",editor.call("attributes:addField",{parent:t,name:"Viewport",placeholder:["X","Y","W","H"],type:"vec4",precision:3,step:.01,min:0,max:1,link:e,path:"viewport"}),editor.call("attributes:addField",{parent:t,name:"启用重力",type:"checkbox",link:e,path:"applyGravity"}))})}n.AttributeComponentCamera=i},{}],28:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.AttributeComponentGUI=void 0;function i(){editor.method("item:drag:allow",function(e,t,n){if(!e||!t)return!0;var i=e.get("type"),o=t.get("type");if("2d-gui"!==i)return"2d-gui"!==o||"root"===(r=t.get("subtype"))&&"inside"!==n;if("root"===e.get("subtype"))return"root"===o&&"inside"===n||"inside"!==n&&editor.call("entities:root").get("resource_id")===t.get("parent");if("2d-gui"!==o)return!1;var r=t.get("subtype");return"inside"===n?"root"===r||"panel"===r:"root"!==r}),editor.on("attributes:inspect[entity]",function(e){var t,n,i,o,r,a,s,l,c;1===e.length&&"2d-gui"===e[0].get("type")&&editor.call("attributes:entity.panelComponents")&&(1===e.length&&editor.call("attributes:header","GUI属性"),editor.call("settings:project"),(t=editor.call("attributes:entity:addComponentPanel",{title:"2D界面属性",name:"2d-gui",entities:e})).headerElement.style.display="none",editor.call("attributes:addField",{parent:t,name:"激活",type:"checkbox",link:e,path:"gui.isVisible"}),editor.call("attributes:addField",{parent:t,name:"名字",type:"string",trim:!0,link:e,path:"name"}),editor.call("attributes:addField",{parent:t,name:"位置X单位类型",type:"number",enum:[{v:0,t:"像素"},{v:1,t:"百分比"}],link:e,path:"gui.xType"}),editor.call("attributes:addField",{parent:t,name:"位置X",type:"number",link:e,path:"gui.x"}),editor.call("attributes:addField",{parent:t,name:"位置Y单位类型",type:"number",enum:[{v:0,t:"像素"},{v:1,t:"百分比"}],link:e,path:"gui.yType"}),editor.call("attributes:addField",{parent:t,name:"位置Y",type:"number",link:e,path:"gui.y"}),editor.call("attributes:addField",{parent:t,name:"宽度单位类型",type:"number",enum:[{v:0,t:"像素"},{v:1,t:"百分比"}],link:e,path:"gui.widthType"}),editor.call("attributes:addField",{parent:t,name:"宽度",type:"number",link:e,path:"gui.width"}),editor.call("attributes:addField",{parent:t,name:"高度单位类型",type:"number",enum:[{v:0,t:"像素"},{v:1,t:"百分比"}],link:e,path:"gui.heightType"}),editor.call("attributes:addField",{parent:t,name:"高度",type:"number",link:e,path:"gui.height"}),editor.call("attributes:addField",{parent:t,name:"水平对齐方式",type:"number",enum:[{v:0,t:"居左"},{v:1,t:"居右"},{v:2,t:"居中"}],link:e,path:"gui.horizontal_alignment"}),editor.call("attributes:addField",{parent:t,name:"垂直对齐方式",type:"number",enum:[{v:0,t:"居上"},{v:1,t:"居下"},{v:2,t:"居中"}],link:e,path:"gui.vertical_alignment"}),(n=editor.call("attributes:addField",{parent:t,name:"透明度",type:"number",precision:2,step:1,min:0,link:e,path:"gui.alpha"})).style.width="32px",editor.call("attributes:addField",{panel:n.parent,precision:2,step:1,min:0,max:1,type:"number",slider:!0,link:e,path:"gui.alpha"}).flexGrow=4,(i=editor.call("attributes:addField",{parent:t,name:"旋转角度",type:"number",precision:2,step:1,min:0,link:e,path:"gui.rotation"})).style.width="32px",editor.call("attributes:addField",{panel:i.parent,precision:2,step:1,min:0,max:360,type:"number",slider:!0,link:e,path:"gui.rotation"}).flexGrow=4,editor.call("attributes:addField",{parent:t,name:"显示元素边界",type:"checkbox",link:e,path:"gui.isHighlighted"}),e[0].node instanceof BABYLON.GUI.AdvancedDynamicTexture||(e[0].node instanceof BABYLON.GUI.Button?(o=editor.call("attributes:entity:addComponentPanel",{title:"按钮 Button",name:"2d-gui",entities:e}),editor.call("attributes:addField",{parent:o,name:"背景色",type:"rgb",link:e,path:"gui.background"}),editor.call("attributes:addField",{parent:o,name:"边框色",type:"rgb",link:e,path:"gui.color"}),editor.call("attributes:addField",{parent:o,name:"字体颜色",type:"rgb",link:e,path:"gui.textColor"}),editor.call("attributes:addField",{parent:o,name:"文字",type:"string",trim:!1,link:e,path:"gui.text"}),editor.call("attributes:addField",{parent:o,name:"字体大小",type:"number",link:e,path:"gui.fontSize"}),editor.call("attributes:addField",{parent:o,type:"asset",kind:"texture",name:"图片",link:e,path:"gui.source",onSet:function(e,t){}}),editor.call("attributes:addField",{parent:o,name:"边框厚度",type:"number",link:e,path:"gui.thickness"}),editor.call("attributes:addField",{parent:o,name:"边框圆角半径",type:"number",link:e,path:"gui.cornerRadius"})):e[0].node instanceof BABYLON.GUI.Rectangle?(r=editor.call("attributes:entity:addComponentPanel",{title:"容器 Container",name:"2d-gui",entities:e}),editor.call("attributes:addField",{parent:r,name:"背景色",type:"rgb",link:e,path:"gui.background"}),editor.call("attributes:addField",{parent:r,name:"边框色",type:"rgb",link:e,path:"gui.color"}),editor.call("attributes:addField",{parent:r,name:"边框厚度",type:"number",link:e,path:"gui.thickness"}),editor.call("attributes:addField",{parent:r,name:"边框圆角半径",type:"number",link:e,path:"gui.cornerRadius"})):e[0].node instanceof BABYLON.GUI.TextBlock?(a=editor.call("attributes:entity:addComponentPanel",{title:"文字 Text",name:"2d-gui",entities:e}),editor.call("attributes:addField",{parent:a,name:"文字颜色",type:"rgb",link:e,path:"gui.color"}),editor.call("attributes:addField",{parent:a,name:"文字",type:"string",trim:!1,link:e,path:"gui.text"}),editor.call("attributes:addField",{parent:a,name:"字体大小",type:"number",link:e,path:"gui.fontSize"}),editor.call("attributes:addField",{parent:a,name:"文字水平对齐",type:"number",enum:[{v:0,t:"居左"},{v:1,t:"居右"},{v:2,t:"居中"}],link:e,path:"gui.textHorizontalAlignment"}),editor.call("attributes:addField",{parent:a,name:"文字垂直对齐",type:"number",enum:[{v:0,t:"居上"},{v:1,t:"居下"},{v:2,t:"居中"}],link:e,path:"gui.textVerticalAlignment"}),editor.call("attributes:addField",{parent:a,name:"文字环绕方式",type:"number",enum:[{v:0,t:"裁剪显示"},{v:1,t:"自动换行"},{v:2,t:"省略显示"}],link:e,path:"gui.textWrapping"})):e[0].node instanceof BABYLON.GUI.InputText?(s=editor.call("attributes:entity:addComponentPanel",{title:"输入框 Input",name:"2d-gui",entities:e}),editor.call("attributes:addField",{parent:s,name:"背景色",type:"rgb",link:e,path:"gui.background"}),editor.call("attributes:addField",{parent:s,name:"文字颜色",type:"rgb",link:e,path:"gui.color"}),editor.call("attributes:addField",{parent:s,name:"文字",type:"string",trim:!1,link:e,path:"gui.text"}),editor.call("attributes:addField",{parent:s,name:"字体大小",type:"number",link:e,path:"gui.fontSize"}),editor.call("attributes:addField",{parent:s,name:"预留文字",type:"string",trim:!1,link:e,path:"gui.placeholderText"}),editor.call("attributes:addField",{parent:s,name:"预留文字颜色",type:"rgb",link:e,path:"gui.placeholderColor"}),editor.call("attributes:addField",{parent:s,name:"聚焦背景色",type:"rgb",link:e,path:"gui.focusedBackground"}),editor.call("attributes:addField",{parent:s,name:"边框厚度",type:"number",link:e,path:"gui.thickness"})):e[0].node instanceof BABYLON.GUI.RadioButton?(l=editor.call("attributes:entity:addComponentPanel",{title:"复选框 Checkbox",name:"2d-gui",entities:e}),editor.call("attributes:addField",{parent:l,name:"背景色",type:"rgb",link:e,path:"gui.background"}),editor.call("attributes:addField",{parent:l,name:"前景色",type:"rgb",link:e,path:"gui.color"}),editor.call("attributes:addField",{parent:l,name:"值",type:"checkbox",link:e,path:"gui.isChecked"}),editor.call("attributes:addField",{parent:s,name:"边框厚度",type:"number",link:e,path:"gui.thickness"})):e[0].node instanceof BABYLON.GUI.Image&&(c=editor.call("attributes:entity:addComponentPanel",{title:"图片 Image",name:"2d-gui",entities:e}),editor.call("attributes:addField",{parent:c,type:"asset",kind:"texture",name:"图片",link:e,path:"gui.source",onSet:function(e,t){}}))))})}n.AttributeComponentGUI=i},{}],29:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.AttributeComponentLight=void 0;function i(){editor.on("attributes:inspect[entity]",function(e){1===e.length&&"light"===e[0].get("type")&&editor.call("attributes:entity.panelComponents")&&(editor.call("settings:project"),editor.call("attributes:entity:addComponentPanel",{title:"灯光属性",name:"light",entities:e}))})}n.AttributeComponentLight=i},{}],30:[function(e,t,n){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,n,i){void 0===i&&(i=n),Object.defineProperty(e,i,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,i){void 0===i&&(i=n),e[i]=t[n]}),o=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||t.hasOwnProperty(n)||i(t,e,n)};Object.defineProperty(n,"__esModule",{value:!0}),o(e("./attributes-panel"),n),o(e("./attributes-entity"),n),o(e("./attributes-history"),n),o(e("./attributes-reference"),n),o(e("./attributes-assets"),n),o(e("./components/attributes-component-camera"),n),o(e("./components/attributes-component-light"),n),o(e("./components/attributes-component-gui"),n),o(e("./keeper"),n)},{"./attributes-assets":22,"./attributes-entity":23,"./attributes-history":24,"./attributes-panel":25,"./attributes-reference":26,"./components/attributes-component-camera":27,"./components/attributes-component-gui":28,"./components/attributes-component-light":29,"./keeper":31}],31:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.AttributesKeeper=void 0;function i(){new o.AttributesPanel,new l.AttributeHistory,new r.AttributesReference,new a.AttributesEntity,new s.AttributesAssets,new c.AttributeAssetsTexture,new d.AttributeComponentCamera,new u.AttributeComponentLight,new h.AttributeComponentGUI}var o=e("./attributes-panel"),r=e("./attributes-reference"),a=e("./attributes-entity"),s=e("./attributes-assets"),l=e("./attributes-history"),c=e("./assets/attributes-assets-texture"),d=e("./components/attributes-component-camera"),u=e("./components/attributes-component-light"),h=e("./components/attributes-component-gui");n.AttributesKeeper=i},{"./assets/attributes-assets-texture":21,"./attributes-assets":22,"./attributes-entity":23,"./attributes-history":24,"./attributes-panel":25,"./attributes-reference":26,"./components/attributes-component-camera":27,"./components/attributes-component-gui":28,"./components/attributes-component-light":29}],32:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.CameraDepth=void 0;function i(){}n.CameraDepth=i},{}],33:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.CameraPreview=void 0;function i(){var n=null,i=null,o=null,r=!1,e=editor.call("layout.viewport"),a=document.createElement("div");a.classList.add("camera-preview"),a.classList.add("clickable");var t=new l.Button("&#58177;");t.class.add("pin"),a.appendChild(t.element),t.on("click",function(e){e.stopPropagation(),o?(o=null,t.class.remove("active"),r=!1,n||s()):(o=i,t.class.add("active"),r=!0)}),l.Tooltip.attach({target:t.element,text:"锁定画面",align:"left",root:editor.call("layout.root")}),e.append(a),editor.on("selector:change",function(e,t){if("entity"===e&&t&&1===t.length)if((n=t[0]).node instanceof c.VeryCamera){if(i){if(i===n.node)return;s()}(i=n.node).renderCamera(!0),a.classList.contains("active")||a.classList.add("active"),r&&(o=i)}else n=null,r||s();else n=null,r||s()});var s=function(){i&&i.renderCamera(!1),i=null,a.classList.contains("active")&&a.classList.remove("active")}}var l=e("../../ui"),c=e("../middleware");n.CameraPreview=i},{"../../ui":162,"../middleware":85}],34:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.CameraUserdata=void 0;function i(){}n.CameraUserdata=i},{}],35:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.CameraViewport=void 0;function i(){var i,o=!1,r=!1,a=new BABYLON.TransformNode("__viewCameraTarget__",A.VeryEngine.viewScene);a.position.copyFromFloats(0,0,0),a.rotation.copyFromFloats(0,0,0);var s,l,c,d,u=1,h=0,p=0,f=300,m=BABYLON.Vector3.Zero(),e=k.Tools.radianToEulerAngle(A.VeryEngine.viewCamera.rotation),h=e.y,p=e.x,g=a.position.clone(),y=a.position.clone(),v=BABYLON.Quaternion.FromEulerVector(k.Tools.eulerAngleToRadian(new BABYLON.Vector3(p+60,h,0)));A.VeryEngine.viewCamera.rotation=v.toEulerAngles();var b=k.Tools.quatMultiplyVector3(v,new BABYLON.Vector3(0,0,-f)).add(g);A.VeryEngine.viewCamera.position.copyFrom(b),editor.method("viewport:camera:initilize",function(e,t){}),editor.on("viewport:update",function(e){var t,n;i=.001*e,x&&(t=A.VeryEngine.viewCamera.position.clone(),.1<L.copyFrom(t).subtract(w).length()?(n=Math.min(1,Math.min(1,B*((O?1/60:1.8*i)/(1/60)))),L=k.Tools.lerpVector3(t,w,n),A.VeryEngine.viewCamera.position.copyFrom(L)):(A.VeryEngine.viewCamera.position.copyFrom(w),x=!1,editor.emit("camera:focus:end",_,L.copyFrom(_).subtract(A.VeryEngine.viewCamera.position).length())),O=!1)}),editor.on("viewport:mouse:down",function(e,t){x||(1===e.button&&(r=!0,s=A.VeryEngine.viewCamera.right,l=A.VeryEngine.viewCamera.up,A.VeryEngine.viewCamera.forward,c=new BABYLON.Vector3(e.clientX-t.left,t.height-e.clientY,y.z),y=k.Tools.worldToScreenPoint(g,A.VeryEngine.viewScene,A.VeryEngine.viewCamera.camera,A.VeryEngine.viewEngine),m.copyFrom(g)),2===e.button&&(o=!0,"透视相机"!==C&&"正交相机"!==C&&(editor.call("camera:ortho:set"),C="正交相机")))}),editor.on("viewport:mouse:up",function(e,t){1===e.button&&(r=!1,g.copyFrom(a.position)),2===e.button&&(o=!1)}),editor.on("viewport:mouse:move",function(e,t){var n;x||(o&&(h+=250*e.movementX*.002,p-=120*-e.movementY*.002,p=k.Tools.clampAngle(p,-360,360),v=BABYLON.Quaternion.FromEulerVector(k.Tools.eulerAngleToRadian(new BABYLON.Vector3(p+60,h,0))),b=k.Tools.quatMultiplyVector3(v,new BABYLON.Vector3(0,0,-f)).add(g),A.VeryEngine.viewCamera.rotation=v.toEulerAngles(),A.VeryEngine.viewCamera.position.copyFrom(b)),r&&(d=new BABYLON.Vector3(e.clientX-t.left,t.height-e.clientY,y.z),u=A.VeryEngine.viewCamera.mode!==BABYLON.Camera.PERSPECTIVE_CAMERA&&A.VeryEngine.viewCamera.orthoSize<.05?.4:1,a.position=m.subtract(s.scale(d.x-c.x).add(l.scale(d.y-c.y)).scale(+u)),n=k.Tools.quatMultiplyVector3(v,new BABYLON.Vector3(0,0,-f)).add(a.position),A.VeryEngine.viewCamera.position.copyFrom(n)))}),editor.on("viewport:mouse:wheel",function(e,t){var n;x||(A.VeryEngine.viewCamera.mode===BABYLON.Camera.PERSPECTIVE_CAMERA?(.1<=f&&f<=1e4&&(f+=.1*e.deltaY),f<.1&&(f=.1),1e4<f&&(f=1e4),b=k.Tools.quatMultiplyVector3(v,new BABYLON.Vector3(0,0,-f)).add(g),A.VeryEngine.viewCamera.position.copyFrom(b)):(.1<=f&&f<=1e4&&(f+=.1*e.deltaY*.5),f<.1&&(f=.1),1e4<f&&(f=1e4),n=.1*e.deltaY*.0012,(.01<A.VeryEngine.viewCamera.orthoSize||A.VeryEngine.viewCamera.orthoSize<=.01&&0<n)&&(A.VeryEngine.viewCamera.orthoSize+=n,b=k.Tools.quatMultiplyVector3(v,new BABYLON.Vector3(0,0,-f)).add(g),A.VeryEngine.viewCamera.position.copyFrom(b)),A.VeryEngine.viewCamera.orthoSize<=.01&&(A.VeryEngine.viewCamera.orthoSize=.01)))});var _=BABYLON.Vector3.Zero(),w=BABYLON.Vector3.Zero(),x=!1,O=!1,B=.25,L=BABYLON.Vector3.Zero();BABYLON.Vector3.Zero(),editor.method("camera:focus",function(e,t){O=x=!0,_.copyFrom(e),g.copyFrom(_),f=t,L=k.Tools.quatMultiplyVector3(v,new BABYLON.Vector3(0,0,-f)).add(g),w.copyFrom(L),editor.emit("camera:focus",e,t)}),editor.method("camera:focus:stop",function(){x=x&&!1}),editor.on("camera:focus:end",function(e,t){a.position.copyFrom(e),f=t});var C="透视相机";editor.method("camera:change:mode",function(e){var t,n;e!==C&&("透视相机"===e?A.VeryEngine.viewCamera.mode=BABYLON.Camera.PERSPECTIVE_CAMERA:(t=f,"透视相机"===C&&(t=300,A.VeryEngine.viewCamera.mode=BABYLON.Camera.ORTHOGRAPHIC_CAMERA),"正交相机"===e||("左视图"===e?A.VeryEngine.viewCamera.rotation=k.Tools.eulerAngleToRadian(new BABYLON.Vector3(0,90,0)):"右视图"===e?A.VeryEngine.viewCamera.rotation=k.Tools.eulerAngleToRadian(new BABYLON.Vector3(0,-90,0)):"顶视图"===e?A.VeryEngine.viewCamera.rotation=k.Tools.eulerAngleToRadian(new BABYLON.Vector3(90,0,0)):"底视图"===e?A.VeryEngine.viewCamera.rotation=k.Tools.eulerAngleToRadian(new BABYLON.Vector3(-90,0,0)):"前视图"===e?A.VeryEngine.viewCamera.rotation=k.Tools.eulerAngleToRadian(new BABYLON.Vector3(0,180,0)):"后视图"===e&&(A.VeryEngine.viewCamera.rotation=k.Tools.eulerAngleToRadian(new BABYLON.Vector3(0,0,0)))),v=A.VeryEngine.viewCamera.rotation.toQuaternion(),n=k.Tools.radianToEulerAngle(A.VeryEngine.viewCamera.rotation),h=n.y,p=n.x-60,editor.call("camera:focus",a.getAbsolutePosition(),t)),C=e)}),editor.method("viewport:focus",function(){var e=editor.call("selection:aabb");e&&editor.call("camera:focus",e,300)}),editor.method("selection:aabb",function(){return"entity"!==editor.call("selector:type")?null:editor.call("entities:aabb",editor.call("selector:items"))}),editor.method("entities:aabb",function(e){return e?(e instanceof Array||(e=[e]),e[e.length-1].node?e[e.length-1].node.getAbsolutePosition().clone():null):null})}var A=e("../../engine"),k=e("../utility");n.CameraViewport=i},{"../../engine":139,"../utility":124}],36:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.Cameras=void 0;function i(){}n.Cameras=i},{}],37:[function(e,t,n){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,n,i){void 0===i&&(i=n),Object.defineProperty(e,i,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,i){void 0===i&&(i=n),e[i]=t[n]}),o=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||t.hasOwnProperty(n)||i(t,e,n)};Object.defineProperty(n,"__esModule",{value:!0}),o(e("./cameras"),n),o(e("./camera-viewport"),n),o(e("./camera-userdata"),n),o(e("./camera-depth"),n),o(e("./camera-preview"),n),o(e("./keeper"),n)},{"./camera-depth":32,"./camera-preview":33,"./camera-userdata":34,"./camera-viewport":35,"./cameras":36,"./keeper":38}],38:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.CameraKeeper=void 0;function i(){new o.Cameras,new a.CameraViewport,new r.CameraPreview}var o=e("./cameras"),r=e("./camera-preview"),a=e("./camera-viewport");n.CameraKeeper=i},{"./camera-preview":33,"./camera-viewport":35,"./cameras":36}],39:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.Drop=void 0;function i(){var d=document.createElement("div");d.classList.add("drop-overlay"),editor.call("layout.root").append(d);for(var u=["top","right","bottom","left"],h=[],e=0;e<u.length;e++){var t=document.createElement("div");t.classList.add("drop-overlay-hole-part",u[e]),editor.call("layout.root").append(t),h.push(t)}var p=document.createElement("div");p.classList.add("drop-areas"),editor.call("layout.root").append(p);var n=!1,f="",m={},i=!1,g=[],o=null,r=function(e){var t;editor.call("permissions:write")&&n!==e&&((n=e)?(d.classList.add("active"),p.classList.add("active"),editor.call("cursor:set","grabbing")):(d.classList.remove("active"),p.classList.remove("active"),i=!1,f="",m={},editor.emit("drop:set",f,m),editor.call("cursor:clear")),t=function(){window.removeEventListener("mouseup",t),r(!1)},window.addEventListener("mouseup",t,!1),editor.emit("drop:active",n))};function a(e){var t;e.preventDefault(),e.stopPropagation(),e.target.classList.add("over"),o&&o!==e.target&&s.call(o,e),(o=e.target)._ref&&o._ref.over&&f&&(t=m,"files"==f&&e.dataTransfer&&(t=e.dataTransfer.files),o._ref.over(f,t))}function y(e){var t;window.navigator.userAgent.indexOf("Chrome")<0||e.style.flexGrow&&(t=e.style.overflow,e.style.overflow="hidden",requestAnimationFrame(function(){requestAnimationFrame(function(){e.style.overflow=t})}))}editor.method("drop:activate",r),editor.method("drop:active",function(){return n}),window.addEventListener("dragenter",function(e){e.preventDefault(),editor.call("permissions:write")&&(i||(i=!0,f||(f="files",editor.emit("drop:set",f,m)),r(!0)))},!1),window.addEventListener("dragover",function(e){e.preventDefault(),editor.call("permissions:write")&&(e.dataTransfer.dropEffect="move",i||r(i=!0))},!1),window.addEventListener("dragleave",function(e){e.preventDefault(),0===e.clientX&&0===e.clientY&&editor.call("permissions:write")&&i&&(i=!1,setTimeout(function(){i||r(!1)},0))},!1),window.addEventListener("drop",function(e){e.preventDefault(),r(!1)},!1);var s=function(e){e&&e.preventDefault(),e.target.classList.remove("over");var t=e.target;t._ref&&t._ref.leave&&f&&t._ref.leave(),o===e.target&&(o=null)};editor.method("drop:target",function(n){g.push(n),n.element=document.createElement("div"),(n.element._ref=n).element.classList.add("drop-area"),n.hole&&n.element.classList.add("hole"),n.passThrough&&(n.element.style.pointerEvents="none"),p.appendChild(n.element),n.evtDrop=function(e){var t;e.preventDefault(),f&&(n.element.classList.contains("over")&&(n.leave&&f&&n.leave(),n.element.classList.remove("over")),t=m,"files"==f&&e.dataTransfer&&(t=e.dataTransfer.files),n.drop&&n.drop(f,t))},n.element.addEventListener("dragenter",a,!1),n.element.addEventListener("mouseenter",a,!1),n.element.addEventListener("dragleave",s,!1),n.element.addEventListener("mouseleave",s,!1);var t=n.element;return n.passThrough&&(t=n.ref),t.addEventListener("drop",n.evtDrop,!1),t.addEventListener("mouseup",n.evtDrop,!1),n.unregister=function(){var e;n.element.classList.contains("drop-area")&&(n.element.removeEventListener("dragenter",a),n.element.removeEventListener("mouseenter",a),n.element.removeEventListener("dragleave",s),n.element.removeEventListener("mouseleave",s),t.removeEventListener("drop",n.evtDrop),t.removeEventListener("mouseup",n.evtDrop),-1!==(e=g.indexOf(n))&&g.splice(e,1),n.ref.classList.contains("drop-ref-highlight")&&(n.ref.classList.remove("drop-ref-highlight"),y(n.ref)),n.element.classList.remove("drop-area"),p.removeChild(n.element))},n}),editor.method("drop:item",function(t){t.element.draggable=!0,t.element.addEventListener("mousedown",function(e){e.stopPropagation()},!1),t.element.addEventListener("dragstart",function(e){e.preventDefault(),e.stopPropagation(),editor.call("permissions:write")&&(f=t.type,m=t.data,o=null,editor.emit("drop:set",f,m),r(!0))},!1)}),editor.method("drop:set",function(e,t){f=e||"",m=t||{},editor.emit("drop:set",f,m)}),editor.on("drop:active",function(e){if(p.style.pointerEvents="",e)for(var t=0,n=window.innerHeight,i=window.innerWidth,o=0,r=0;r<g.length;r++){var a=!g[r].disabled;if(a&&(g[r].filter?a=g[r].filter(f,m):g[r].type!==f&&(a=!1)),a)for(var s=g[r].ref.getBoundingClientRect(),l=4,c=g[r].ref;l--;){if(!s.width||!s.height||!c.offsetHeight||"hidden"===window.getComputedStyle(c).getPropertyValue("visibility")){a=!1;break}c=c.parentNode}a?(g[r].element.style.display="block",g[r].hole?(g[r].element.style.left=s.left+2+"px",g[r].element.style.top=s.top+2+"px",g[r].element.style.width=s.width-4+"px",g[r].element.style.height=s.height-4+"px",d.classList.remove("active"),n>s.top&&(n=s.top),t<s.bottom&&(t=s.bottom),i>s.left&&(i=s.left),o<s.right&&(o=s.right),h[0].classList.add("active"),h[0].style.height=n+"px",h[1].classList.add("active"),h[1].style.top=n+"px",h[1].style.bottom=window.innerHeight-t+"px",h[1].style.width=window.innerWidth-o+"px",h[2].classList.add("active"),h[2].style.height=window.innerHeight-t+"px",h[3].classList.add("active"),h[3].style.top=n+"px",h[3].style.bottom=window.innerHeight-t+"px",h[3].style.width=i+"px",g[r].passThrough&&(p.style.pointerEvents="none")):(g[r].element.style.left=s.left+1+"px",g[r].element.style.top=s.top+1+"px",g[r].element.style.width=s.width-2+"px",g[r].element.style.height=s.height-2+"px",g[r].ref.classList.add("drop-ref-highlight"))):(g[r].element.style.display="none",g[r].ref.classList.contains("drop-ref-highlight")&&(g[r].ref.classList.remove("drop-ref-highlight"),y(g[r].ref)))}else{for(r=0;r<u.length;r++)h[r].classList.remove("active");for(r=0;r<g.length;r++)g[r].ref.classList.contains("drop-ref-highlight")&&(g[r].ref.classList.remove("drop-ref-highlight"),y(g[r].ref))}})}n.Drop=i},{}],40:[function(e,t,n){"use strict";var i,o=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0}),n.Editor=void 0;var r,a=e("../lib"),s=(r=a.Events,o(l,r),l.prototype.method=function(e,t){if(void 0!==this._hooks[e])throw new Error("can't override hook: "+e);this._hooks[e]=t},l.prototype.methodRemove=function(e){delete this._hooks[e]},l.prototype.call=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(this._hooks[t]){e=Array.prototype.slice.call(arguments,1);try{return this._hooks[t].apply(null,e)}catch(e){console.error("%c%s %c(editor.method error)","color: #06f",t,"color: #f00"),console.error(e.stack)}}return null},l);function l(){var e=r.call(this)||this;return e._hooks={},e}n.Editor=s},{"../lib":143}],41:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.Entities=void 0;var i=e("../middleware"),o=e("../../lib"),r=(a.prototype.addRaw=function(e){var t=this.createGameObject(e);this.container.addGameObject(t)},a.prototype.addEntity=function(e){},a.prototype.create=function(e){e.get("type").toLowerCase();return new i.GameObject(e.get("name"))},a.prototype.createGameObject=function(e){var t=new i.GameObject(e.name);return t.guid=e.resource_id,t.setActive(e.enabled),t},a.prototype.add=function(e){},a.prototype.has=function(e){return!1},a.prototype.set=function(e,t){},a.prototype.get=function(e){return this._indexed[e]},a.prototype.indexOf=function(e){return this.lists.indexOf(e)},a);function a(){this.lists=[],this._indexed={},this.container=new i.ResourceContainer;var t=new o.ObserverList({id:"resource_id"}),n=null;t.on("add",function(e){editor.emit("entities:add",e,e===n)}),t.on("remove",function(e){editor.emit("entities:remove",e),e.destroy()}),editor.method("entities:add",function(e){e.get("root")&&(n=e),t.add(e)}),editor.method("entities:remove",function(e){t.remove(e)}),editor.method("entities:clear",function(){t.clear()}),editor.method("entities:get",function(e){return t.get(e)}),editor.method("entities:list",function(){return t.array()}),editor.method("entities:root",function(){return n})}n.Entities=r},{"../../lib":143,"../middleware":85}],42:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.EntityCreate=void 0;function i(){editor.method("entity:new:babylon",function(e){e=e||{};var t=new p.Observer(e);return editor.call("entities:add",t),t}),editor.method("entities:new",function(n){n=n||{};var o,r,e=editor.call("entities:get",n.parent)||editor.call("entities:root");if(!n.noHistory&&(o=editor.call("selector:type"),r=editor.call("selector:items"),"entity"===o))for(var t=0;t<r.length;t++)r[t]=r[t].get("resource_id");var a,i,s=new p.Observer(n);return editor.call("entities:addEntity",s,e,!n.noSelect),n.noHistory||(a=s.get("resource_id"),i=e.get("resource_id"),editor.call("history:add",{name:"new entity "+a,undo:function(){var e=editor.call("entities:get",a);if(e&&(editor.call("entities:removeEntity",e),"entity"===o&&r.length)){for(var t=[],n=0;n<r.length;n++){var i=editor.call("entities:get",r[n]);i&&t.push(i)}t.length&&(editor.call("selector:history",!1),editor.call("selector:set",o,t),editor.once("selector:change",function(){editor.call("selector:history",!0)}))}},redo:function(){var e,t=editor.call("entities:get",i);t&&(e=new p.Observer(n),editor.call("entities:addEntity",e,t,!0))}})),s}),editor.method("entities:editor:new",function(e){var t,n,i=(e=e||{}).parent||editor.call("entities:root");e.type&&(t=r(e.type,e.subtype,i.get("resource_id")),n=new p.Observer(t),a(e.type,e.subtype,n),editor.call("entities:addEntity",n,i,!e.noSelect),editor.call("selector:set","entity",[n]))});var o={empty:"空物体",box:"立方体",sphere:"球体",plane:"平面",cylinder:"圆柱体",hemispheric:"环境光",directional:"平行光",point:"点光源",spot:"聚光灯",camera:"摄像机"},r=function(e,t,n){var i={name:o[e]||o[t]||"空物体",type:e,subtype:t,resource_id:m.GUID.create(),parent:n,position:[0,0,0],rotation:[0,0,0],scale:[1,1,1],enabled:!0,tags:Array(),children:Array()};return"primitive"===e?(i.checkCollisions=!1,i.pickable=!0,i.isVisible=!0,i.material_id=""):"light"===e?(i.position=[300,300,300],"directional"===t&&(i.rotation=[50,-30,0])):"camera"===e&&(i.position=[0,100,-200],i.mode=0,i.fov=.8,i.inertia=.9,i.orthoSize=.5,i.ellipsoid=[.5,1,.5],i.ellipsoidOffset=[0,0,0],i.checkCollisions=!0,i.applyGravity=!0,i.minZ=1,i.maxZ=2e4,i.priority=0,i.viewport=[0,0,1,1],i.clearColor=[.176,.569,.729,1]),i},a=function(e,t,n){if("empty"===e){var i=new BABYLON.TransformNode(n.get("name"),h.VeryEngine.viewScene);return(n.node=i).id=n.get("resource_id"),i.position=BABYLON.Vector3.FromArray(n.get("position")),i.rotation=m.Tools.eulerAngleToRadian(BABYLON.Vector3.FromArray(n.get("rotation"))),i.scaling=BABYLON.Vector3.FromArray(n.get("scale")),i.isEnabled(n.get("enabled")),i}if("primitive"===e){if("box"===t){var o=BABYLON.MeshBuilder.CreateBox(n.get("name"),{size:100},h.VeryEngine.viewScene);return(n.node=o).id=n.get("resource_id"),o.position=BABYLON.Vector3.FromArray(n.get("position")),o.rotation=m.Tools.eulerAngleToRadian(BABYLON.Vector3.FromArray(n.get("rotation"))),o.scaling=BABYLON.Vector3.FromArray(n.get("scale")),n.has("checkCollisions")&&(o.checkCollisions=n.get("checkCollisions")),n.has("pickable")&&(o.isPickable=n.get("pickable")),n.has("isVisible")&&(o.isVisible=n.get("isVisible")),o}if("sphere"===t){var r=BABYLON.MeshBuilder.CreateSphere(n.get("name"),{segments:20,diameter:100},h.VeryEngine.viewScene);return(n.node=r).id=n.get("resource_id"),r.position=BABYLON.Vector3.FromArray(n.get("position")),r.rotation=m.Tools.eulerAngleToRadian(BABYLON.Vector3.FromArray(n.get("rotation"))),r.scaling=BABYLON.Vector3.FromArray(n.get("scale")),n.has("checkCollisions")&&(r.checkCollisions=n.get("checkCollisions")),n.has("pickable")&&(r.isPickable=n.get("pickable")),n.has("isVisible")&&(r.isVisible=n.get("isVisible")),r}if("plane"===t){var a=BABYLON.MeshBuilder.CreateGround(n.get("name"),{width:5e3,height:5e3,subdivisions:10},h.VeryEngine.viewScene);return(n.node=a).id=n.get("resource_id"),a.position=BABYLON.Vector3.FromArray(n.get("position")),a.rotation=m.Tools.eulerAngleToRadian(BABYLON.Vector3.FromArray(n.get("rotation"))),a.scaling=BABYLON.Vector3.FromArray(n.get("scale")),n.has("checkCollisions")&&(a.checkCollisions=n.get("checkCollisions")),n.has("pickable")&&(a.isPickable=n.get("pickable")),n.has("isVisible")&&(a.isVisible=n.get("isVisible")),a}if("cylinder"===t){var s=BABYLON.MeshBuilder.CreateCylinder(n.get("name"),{height:200,diameter:100},h.VeryEngine.viewScene);return(n.node=s).id=n.get("resource_id"),s.position=BABYLON.Vector3.FromArray(n.get("position")),s.rotation=m.Tools.eulerAngleToRadian(BABYLON.Vector3.FromArray(n.get("rotation"))),s.scaling=BABYLON.Vector3.FromArray(n.get("scale")),n.has("checkCollisions")&&(s.checkCollisions=n.get("checkCollisions")),n.has("pickable")&&(s.isPickable=n.get("pickable")),n.has("isVisible")&&(s.isVisible=n.get("isVisible")),s}}return null};editor.method("entities:2D-GUI:new",function(e){var t,n,i,o,r,a,s=(e=e||{}).parent||editor.call("entities:root");"root"===s.get("type")?("root"===e.subtype?(r=c(e.type,e.subtype,s.get("resource_id")),a=new p.Observer(r),d(e.type,e.subtype,a),editor.call("entities:addEntity",a,s,!e.noSelect)):(a=(r=(o=(t=(f.GUIManager.getActiveCanvas()||(editor.call("entities:2D-GUI:new",{parent:editor.call("entities:root"),type:"2d-gui",subtype:"root"}),f.GUIManager.getActiveCanvas()),f.GUIManager.getActiveID()),editor.call("entities:get",t)),c(e.type,e.subtype,o.get("resource_id"))),new p.Observer(r)),d(e.type,e.subtype,a),editor.call("entities:addEntity",a,o,!e.noSelect)),editor.call("selector:set","entity",[a])):"root"===e.subtype?(o=editor.call("entities:root"),r=c(e.type,e.subtype,o.get("resource_id")),a=new p.Observer(r),d(e.type,e.subtype,a),editor.call("entities:addEntity",a,o,!e.noSelect),editor.call("selector:set","entity",[a])):s.node instanceof BABYLON.Node?(a=(r=(o=(t=(f.GUIManager.getActiveCanvas()||(editor.call("entities:2D-GUI:new",{parent:editor.call("entities:root"),type:"2d-gui",subtype:"root"}),f.GUIManager.getActiveCanvas()),f.GUIManager.getActiveID()),editor.call("entities:get",t)),c(e.type,e.subtype,o.get("resource_id"))),new p.Observer(r)),d(e.type,e.subtype,a),editor.call("entities:addEntity",a,o,!e.noSelect),editor.call("selector:set","entity",[a])):s.node instanceof BABYLON.GUI.AdvancedDynamicTexture?(r=c(e.type,e.subtype,s.get("resource_id")),a=new p.Observer(r),d(e.type,e.subtype,a),editor.call("entities:addEntity",a,s,!e.noSelect),editor.call("selector:set","entity",[a])):s.node instanceof BABYLON.GUI.Control?s.node instanceof BABYLON.GUI.Rectangle&&!(s.node instanceof BABYLON.GUI.Button)?(r=c(e.type,e.subtype,s.get("resource_id")),a=new p.Observer(r),d(e.type,e.subtype,a),editor.call("entities:addEntity",a,s,!e.noSelect),editor.call("selector:set","entity",[a])):!(n=l(s.node))||(i=f.GUIManager.getResourceID(n.uniqueId))&&(o=editor.call("entities:get",i))&&(r=c(e.type,e.subtype,o.get("resource_id")),a=new p.Observer(r),d(e.type,e.subtype,a),editor.call("entities:addEntity",a,o,!e.noSelect),editor.call("selector:set","entity",[a])):(console.error("当前类型还未考虑"),console.error(s.node))});var l=function(e){return null===e.parent?null:e.parent instanceof BABYLON.GUI.Container&&"root"===e.parent.name&&!e.parent.parent?e.parent.host:e.parent instanceof BABYLON.GUI.Rectangle&&!(e.parent instanceof BABYLON.GUI.Button)?e.parent:l(e.parent)},s={root:"2D画布",panel:"容器",button:"按钮",image:"图片",text:"文字",input:"输入框",checkbox:"复选框"},c=function(e,t,n){var i={name:s[e]||s[t]||"2D画布",type:e,subtype:t,resource_id:m.GUID.create(),enabled:!0,parent:n,parent_gui:n,gui:{isVisible:!0,xType:0,x:0,yType:0,y:0,widthType:0,width:100,heightType:0,height:30,scaleX:1,scaleY:1,horizontal_alignment:2,vertical_alignment:2,alpha:1,color:[1,1,1,1],rotation:0,isHighlighted:!1},children:Array()};return"root"===t?(i.gui.widthType=1,i.gui.width=100,i.gui.heightType=1,i.gui.height=100):"panel"===t?(i.gui.widthType=1,i.gui.width=60,i.gui.heightType=1,i.gui.height=80,i.gui.color=[1,1,1,1],i.gui.background=[1,1,1,.3922],i.gui.thickness=1,i.gui.cornerRadius=10):"button"===t?(i.gui.widthType=0,i.gui.width=120,i.gui.heightType=0,i.gui.height=30,i.gui.color=[1,1,1,1],i.gui.background=[1,1,1,1],i.gui.thickness=1,i.gui.cornerRadius=4,i.gui.text="按钮",i.gui.fontSize=18,i.gui.textColor=[0,0,0,1],i.gui.source=""):"image"===t?(i.gui.widthType=0,i.gui.width=100,i.gui.heightType=0,i.gui.height=100,i.gui.color=[1,1,1,1],i.gui.source=""):"text"===t?(i.gui.widthType=0,i.gui.width=160,i.gui.heightType=0,i.gui.height=30,i.gui.color=[0,0,0,1],i.gui.fontSize=18,i.gui.text="文字",i.gui.textHorizontalAlignment=0,i.gui.textVerticalAlignment=2,i.gui.textWrapping=1):"input"===t?(i.gui.widthType=0,i.gui.width=160,i.gui.heightType=0,i.gui.height=30,i.gui.color=[0,0,0,1],i.gui.background=[1,1,1,1],i.gui.thickness=1,i.gui.fontSize=18,i.gui.placeholderColor=[0,0,0,.3922],i.gui.placeholderText="输入...",i.gui.focusedBackground=[.502,.502,.502,1],i.gui.text=""):"checkbox"===t&&(i.gui.widthType=0,i.gui.width=20,i.gui.heightType=0,i.gui.height=20,i.gui.color=[.502,.502,.502,1],i.gui.background=[1,1,1,1],i.gui.thickness=2,i.gui.isChecked=!0),i},d=function(e,t,n){if("root"===t){var i=BABYLON.GUI.AdvancedDynamicTexture.CreateFullscreenUI(n.get("name"));return f.GUIManager.add2DCanvas(n.get("resource_id"),i),n.node=i,n.has("gui.isHighlighted")&&(i.rootContainer.isHighlighted=n.get("gui.isHighlighted")),f.GUIManager.addUniqueIDIndex(i.uniqueId,n.get("resource_id")),i}if("panel"===t){var o=new BABYLON.GUI.Rectangle(n.get("name"));return n.node=o,n.has("gui.color")&&(o.color=m.Tools.rgba2hsvString(n.get("gui.color"))),n.has("gui.background")&&(o.background=m.Tools.rgba2hsvString(n.get("gui.background"))),u(o,n),n.has("gui.thickness")&&(o.thickness=n.get("gui.thickness")),n.has("gui.cornerRadius")&&(o.cornerRadius=n.get("gui.cornerRadius")),o}if("button"===t){var r=BABYLON.GUI.Button.CreateImageWithCenterTextButton(n.get("name"),"","");return n.node=r,n.has("gui.color")&&(r.color=m.Tools.rgba2hsvString(n.get("gui.color"))),n.has("gui.background")&&(r.background=m.Tools.rgba2hsvString(n.get("gui.background"))),u(r,n),n.has("gui.thickness")&&(r.thickness=n.get("gui.thickness")),n.has("gui.cornerRadius")&&(r.cornerRadius=n.get("gui.cornerRadius")),n.has("gui.text")&&(r.textBlock.text=n.get("gui.text")),n.has("gui.fontSize")&&(r.fontSize=n.get("gui.fontSize"),r.textBlock.fontSize=n.get("gui.fontSize")),n.has("gui.textColor")&&(r.textBlock.color=m.Tools.rgba2hsvString(n.get("gui.textColor"))),r}if("image"===t){var a=new BABYLON.GUI.Image(n.get("name"),"");return n.node=a,n.has("gui.color")&&(a.color=m.Tools.rgba2hsvString(n.get("gui.color"))),u(a,n),a}if("text"===t){var s=new BABYLON.GUI.TextBlock(n.get("name"),"");return n.node=s,n.has("gui.color")&&(s.color=m.Tools.rgba2hsvString(n.get("gui.color"))),u(s,n),n.has("gui.fontSize")&&(s.fontSize=n.get("gui.fontSize")),n.has("gui.text")&&(s.text=n.get("gui.text")),n.has("gui.textWrapping")&&(s.textWrapping=n.get("gui.textWrapping")),n.has("gui.textHorizontalAlignment")&&(s.textHorizontalAlignment=n.get("gui.textHorizontalAlignment")),n.has("gui.textVerticalAlignment")&&(s.textVerticalAlignment=n.get("gui.textVerticalAlignment")),s}if("input"===t){var l=new BABYLON.GUI.InputText(n.get("name"),"");return n.node=l,n.has("gui.color")&&(l.color=m.Tools.rgba2hsvString(n.get("gui.color"))),n.has("gui.background")&&(l.background=m.Tools.rgba2hsvString(n.get("gui.background"))),u(l,n),n.has("gui.thickness")&&(l.thickness=n.get("gui.thickness")),n.has("gui.fontSize")&&(l.fontSize=n.get("gui.fontSize")),n.has("gui.placeholderColor")&&(l.placeholderColor=m.Tools.rgba2hsvString(n.get("gui.placeholderColor"))),n.has("gui.placeholderText")&&(l.placeholderText=n.get("gui.placeholderText")),n.has("gui.focusedBackground")&&(l.focusedBackground=m.Tools.rgba2hsvString(n.get("gui.focusedBackground"))),n.has("gui.text")&&(l.text=n.get("gui.text")),l}if("checkbox"!==t)return null;var c=new BABYLON.GUI.RadioButton(n.get("name"));return n.node=c,n.has("gui.color")&&(c.color=m.Tools.rgba2hsvString(n.get("gui.color"))),n.has("gui.background")&&(c.background=m.Tools.rgba2hsvString(n.get("gui.background"))),u(c,n),n.has("gui.thickness")&&(c.thickness=n.get("gui.thickness")),n.has("gui.isChecked")&&(c.isChecked=n.get("gui.isChecked")),c},u=function(e,t){t.has("gui.x")&&(t.has("gui.xType")&&1===t.get("gui.xType")?e.left=t.get("gui.x")+"%":e.left=t.get("gui.x")+"px"),t.has("gui.y")&&(t.has("gui.yType")&&1===t.get("gui.yType")?e.top=t.get("gui.y")+"%":e.top=t.get("gui.y")+"px"),t.has("gui.width")&&(t.has("gui.widthType")&&1===t.get("gui.widthType")?e.width=t.get("gui.width")+"%":e.width=t.get("gui.width")+"px"),t.has("gui.height")&&(t.has("gui.heightType")&&1===t.get("gui.heightType")?e.height=t.get("gui.height")+"%":e.height=t.get("gui.height")+"px"),t.has("gui.scaleX")&&(e.scaleX=t.get("gui.scaleX")),t.has("gui.scaleY")&&(e.scaleY=t.get("gui.scaleY")),t.has("gui.horizontal_alignment")&&(e.horizontalAlignment=t.get("gui.horizontal_alignment")),t.has("gui.vertical_alignment")&&(e.verticalAlignment=t.get("gui.vertical_alignment")),t.has("gui.isHighlighted")&&(e.isHighlighted=t.get("gui.isHighlighted"))}}var h=e("../../engine"),p=e("../../lib"),f=e("../gui"),m=e("../utility");n.EntityCreate=i},{"../../engine":139,"../../lib":143,"../gui":68,"../utility":124}],43:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.EntityDelete=void 0;function i(){editor.method("entities:delete",function(e){for(var t=[],n=[],i={},o=0;o<e.length;o++)i[e[o].get("resource_id")]=e[o];for(o=0;o<e.length;o++){for(var r=!1,a=editor.call("entities:getParentResourceId",e[o].get("resource_id"));!r&&a;)i[a]?r=!0:a=editor.call("entities:getParentResourceId",a);r||n.push(e[o])}for(e=n,o=0;o<e.length;o++){var s,l=e[o].get("resource_id"),c=editor.call("entities:getParentResourceId",l);c&&(a=editor.call("entities:get",c))&&(s=a.get("children").indexOf(l)),t.push({resourceId:l,parentId:c,ind:s,data:e[o]._data2})}for(o=0;o<e.length;o++)editor.call("entities:removeEntity",e[o],null);t.sort(function(e,t){return e.ind-t.ind})})}n.EntityDelete=i},{}],44:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.EntityEdit=void 0;function i(){var c={},d={};editor.on("entities:add",function(t){for(var e=t.get("children"),n=0;n<e.length;n++)c[e[n]]=t.get("resource_id");t.on("children:insert",function(e){c[e]=t.get("resource_id"),h.BabylonLoader.updateSceneData(t.get("resource_id"),t._data2),editor.call("make:scene:dirty")}),t.on("children:remove",function(e){delete c[e],h.BabylonLoader.updateSceneData(t.get("resource_id"),t._data2),editor.call("make:scene:dirty")})});var u=function(e,t){t=t||{},d[e.get("resource_id")]=e._data2;var n=e.get("children");if(n&&0<n.length)for(var i=0,o=(n=n.slice(0)).length;i<o;i++){var r=editor.call("entities:get",n[i]);if(!r)return;u(r,t)}"entity"===editor.call("selector:type")&&-1!==editor.call("selector:items").indexOf(e)&&(editor.call("selector:history",!1),editor.call("selector:remove",e),editor.once("selector:change",function(){editor.call("selector:history",!0)}));var a,s=c[e.get("resource_id")];!s||(a=editor.call("entities:get",s))&&a.removeValue("children",e.get("resource_id"));var l=e.get("resource_id");editor.call("entities:remove",e),h.BabylonLoader.removeSceneData(l),editor.call("make:scene:dirty")};editor.method("entities:addEntity",function(e,t,n,i,o){c[e.get("resource_id")]=t.get("resource_id"),e.get("children").length&&e.set("children",[]),editor.call("entities:add",e),t.insert("children",e.get("resource_id"),i),h.BabylonLoader.addSceneData(e.get("resource_id"),e.origin)}),editor.method("entities:removeEntity",u),editor.method("entities:getParentResourceId",function(e){return c[e]}),editor.method("entities:updateChildToParentIndex",function(e,t){c[e]=t}),editor.method("entities:getFromDeletedCache",function(e){return d[e]}),editor.method("save:scene",function(){h.BabylonLoader.saveScene()})}var h=e("../middleware/loader/babylonLoader");n.EntityEdit=i},{"../middleware/loader/babylonLoader":86}],45:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.EntityLoad=void 0;function i(){this.loadedEntities=!1;var e=new o.TopElementContainer({flex:!0});e.class.add("progress-overlay"),editor.call("layout.hierarchy").append(e);var r=new o.Progress;r.on("progress:100",function(){e.hidden=!0}),e.append(r);var a=!(r.hidden=!0);editor.method("entities:loaded",function(){return a}),editor.on("scene:raw",function(e){var t,n=Object.keys(e.entities).length,i=0;for(t in e.entities){var o=new s.Observer(e.entities[t]);editor.call("entities:add",o),r.progress=++i/n*.8+.1,e.entities[t].root||editor.call("create:scene:element",o)}r.progress=1,a=!0,editor.emit("entities:load")}),editor.call("attributes:clear"),editor.on("scene:unload",function(){editor.call("entities:clear"),editor.call("attributes:clear")}),editor.on("scene:beforeload",function(){e.hidden=!1,r.hidden=!1,r.progress=.1})}var s=e("../../lib"),o=e("../../ui");n.EntityLoad=i},{"../../lib":143,"../../ui":162}],46:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.EntitySync=void 0;function i(){}n.EntitySync=i},{}],47:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.Entity=void 0;var i=(o.prototype.get=function(e){},o);function o(){}n.Entity=i},{}],48:[function(e,t,n){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,n,i){void 0===i&&(i=n),Object.defineProperty(e,i,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,i){void 0===i&&(i=n),e[i]=t[n]}),o=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||t.hasOwnProperty(n)||i(t,e,n)};Object.defineProperty(n,"__esModule",{value:!0}),o(e("./entity"),n),o(e("./entities"),n),o(e("./entity-load"),n),o(e("./entity-create"),n),o(e("./entity-sync"),n),o(e("./entity-edit"),n),o(e("./entity-delete"),n),o(e("./keeper"),n)},{"./entities":41,"./entity":47,"./entity-create":42,"./entity-delete":43,"./entity-edit":44,"./entity-load":45,"./entity-sync":46,"./keeper":49}],49:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.EntityKeeper=void 0;function i(){new r.Entities,new l.EntityEdit,new a.EntityCreate,new o.EntityLoad,new s.EntitySync,new c.EntityDelete}var o=e("./entity-load"),r=e("./entities"),a=e("./entity-create"),s=e("./entity-sync"),l=e("./entity-edit"),c=e("./entity-delete");n.EntityKeeper=i},{"./entities":41,"./entity-create":42,"./entity-delete":43,"./entity-edit":44,"./entity-load":45,"./entity-sync":46}],50:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.UtilityLayerRenderer=void 0;var i=(o.prototype.getRenderCamera=function(e){if(this._renderCamera)return this._renderCamera;var t=void 0,t=1<this.originalScene.activeCameras.length?this.originalScene.activeCameras[0]:this.originalScene.activeCamera;return e&&t&&t.isRightCamera?t.rightCamera:t},o.prototype.setRenderCamera=function(e){this._renderCamera=e},o.prototype._getSharedGizmoLight=function(){return this._sharedGizmoLight||(this._sharedGizmoLight=new BABYLON.HemisphericLight("shared gizmo light",new BABYLON.Vector3(0,1,0),this.utilityLayerScene),this._sharedGizmoLight.intensity=2,this._sharedGizmoLight.groundColor=BABYLON.Color3.Gray()),this._sharedGizmoLight},Object.defineProperty(o,"DefaultUtilityLayer",{get:function(){return null==o._DefaultUtilityLayer&&(o._DefaultUtilityLayer=new o(BABYLON.EngineStore.LastCreatedScene)).originalScene.onDisposeObservable.addOnce(function(){o._DefaultUtilityLayer=null}),o._DefaultUtilityLayer},enumerable:!1,configurable:!0}),Object.defineProperty(o,"DefaultKeepDepthUtilityLayer",{get:function(){return null==o._DefaultKeepDepthUtilityLayer&&((o._DefaultKeepDepthUtilityLayer=new o(BABYLON.EngineStore.LastCreatedScene)).utilityLayerScene.autoClearDepthAndStencil=!1,o._DefaultKeepDepthUtilityLayer.originalScene.onDisposeObservable.addOnce(function(){o._DefaultKeepDepthUtilityLayer=null})),o._DefaultKeepDepthUtilityLayer},enumerable:!1,configurable:!0}),o.prototype._notifyObservers=function(e,t,n){e.skipOnPointerObservable||(this.utilityLayerScene.onPointerObservable.notifyObservers(new BABYLON.PointerInfo(e.type,e.event,t),e.type),this._lastPointerEvents[n.pointerId]=!0)},o.prototype.render=function(){var e,t;this._updateCamera(),this.utilityLayerScene.activeCamera&&(e=this.utilityLayerScene.activeCamera.getScene(),(t=this.utilityLayerScene.activeCamera)._scene=this.utilityLayerScene,t.leftCamera&&(t.leftCamera._scene=this.utilityLayerScene),t.rightCamera&&(t.rightCamera._scene=this.utilityLayerScene),this.utilityLayerScene.render(!1),t._scene=e,t.leftCamera&&(t.leftCamera._scene=e),t.rightCamera&&(t.rightCamera._scene=e))},o.prototype.dispose=function(){this.onPointerOutObservable.clear(),this._afterRenderObserver&&this.originalScene.onAfterCameraRenderObservable.remove(this._afterRenderObserver),this._sceneDisposeObserver&&this.originalScene.onDisposeObservable.remove(this._sceneDisposeObserver),this._originalPointerObserver&&this.originalScene.onPrePointerObservable.remove(this._originalPointerObserver),this.utilityLayerScene.dispose()},o.prototype._updateCamera=function(){var e=this.getRenderCamera();this.utilityLayerScene.cameraToUseForPointers=e,this.utilityLayerScene.activeCamera=e},o.prototype.orthoSize=function(e,t){void 0===t&&(t=!1),e.mode===BABYLON.Camera.ORTHOGRAPHIC_CAMERA&&(t?this.setOrthoSize(e,this._backUpOrtho):(this._backUpOrtho=e.orthoRight/this.utilityLayerScene.getEngine().getRenderWidth(),this.setOrthoSize(e,.5)))},o.prototype.setOrthoSize=function(e,t){e.mode===BABYLON.Camera.ORTHOGRAPHIC_CAMERA&&(e.orthoRight=t*this.utilityLayerScene.getEngine().getRenderWidth(),e.orthoLeft=-t*this.utilityLayerScene.getEngine().getRenderWidth(),e.orthoTop=t*this.utilityLayerScene.getEngine().getRenderHeight(),e.orthoBottom=-t*this.utilityLayerScene.getEngine().getRenderHeight())},o._DefaultUtilityLayer=null,o._DefaultKeepDepthUtilityLayer=null,o);function o(a,e){var s=this;void 0===e&&(e=!0),this.originalScene=a,this._pointerCaptures={},this._lastPointerEvents={},this._sharedGizmoLight=null,this._renderCamera=null,this.pickUtilitySceneFirst=!0,this.shouldRender=!0,this.onlyCheckPointerDownEvents=!0,this.processAllEvents=!1,this.onPointerOutObservable=new BABYLON.Observable,this.mainSceneTrackerPredicate=null,this._originalPointerObserver=null,this._backUpOrtho=0,this.utilityLayerScene=new BABYLON.Scene(a.getEngine(),{virtual:!0}),this.utilityLayerScene.useRightHandedSystem=a.useRightHandedSystem,this.utilityLayerScene._allowPostProcessClearColor=!1,this.utilityLayerScene.detachControl(),e&&(this._originalPointerObserver=a.onPrePointerObservable.add(function(e,t){if(s.utilityLayerScene.activeCamera&&(s.processAllEvents||e.type===BABYLON.PointerEventTypes.POINTERMOVE||e.type===BABYLON.PointerEventTypes.POINTERUP||e.type===BABYLON.PointerEventTypes.POINTERDOWN||e.type===BABYLON.PointerEventTypes.POINTERDOUBLETAP)){s.utilityLayerScene.pointerX=a.pointerX,s.utilityLayerScene.pointerY=a.pointerY;var n=e.event;if(a.isPointerCaptured(n.pointerId))s._pointerCaptures[n.pointerId]=!1;else{var i,o,r=e.ray?s.utilityLayerScene.pickWithRay(e.ray):s.utilityLayerScene.pick(a.pointerX,a.pointerY);if(!e.ray&&r&&(e.ray=r.ray),s.utilityLayerScene.onPrePointerObservable.notifyObservers(e),s.onlyCheckPointerDownEvents&&e.type!=BABYLON.PointerEventTypes.POINTERDOWN)return e.skipOnPointerObservable||s.utilityLayerScene.onPointerObservable.notifyObservers(new BABYLON.PointerInfo(e.type,e.event,r),e.type),void(e.type===BABYLON.PointerEventTypes.POINTERUP&&s._pointerCaptures[n.pointerId]&&(s._pointerCaptures[n.pointerId]=!1));s.utilityLayerScene.autoClearDepthAndStencil||s.pickUtilitySceneFirst?r&&r.hit&&(e.skipOnPointerObservable||s.utilityLayerScene.onPointerObservable.notifyObservers(new BABYLON.PointerInfo(e.type,e.event,r),e.type),e.skipOnPointerObservable=!0):(i=e.ray?a.pickWithRay(e.ray):a.pick(a.pointerX,a.pointerY),o=e.event,i&&r&&(0===r.distance&&i.pickedMesh?s.mainSceneTrackerPredicate&&s.mainSceneTrackerPredicate(i.pickedMesh)?(s._notifyObservers(e,i,o),e.skipOnPointerObservable=!0):e.type===BABYLON.PointerEventTypes.POINTERDOWN?s._pointerCaptures[o.pointerId]=!0:s._lastPointerEvents[o.pointerId]&&(s.onPointerOutObservable.notifyObservers(o.pointerId),delete s._lastPointerEvents[o.pointerId]):!s._pointerCaptures[o.pointerId]&&(r.distance<i.distance||0===i.distance)?(s._notifyObservers(e,r,o),e.skipOnPointerObservable||(e.skipOnPointerObservable=0<r.distance)):!s._pointerCaptures[o.pointerId]&&r.distance>i.distance&&(s.mainSceneTrackerPredicate&&s.mainSceneTrackerPredicate(i.pickedMesh)?(s._notifyObservers(e,i,o),e.skipOnPointerObservable=!0):s._lastPointerEvents[o.pointerId]&&(s.onPointerOutObservable.notifyObservers(o.pointerId),delete s._lastPointerEvents[o.pointerId])),e.type===BABYLON.PointerEventTypes.POINTERUP&&s._pointerCaptures[o.pointerId]&&(s._pointerCaptures[o.pointerId]=!1)))}}}),this._originalPointerObserver&&a.onPrePointerObservable.makeObserverTopPriority(this._originalPointerObserver)),this.utilityLayerScene.autoClear=!1,this._afterRenderObserver=this.originalScene.onAfterCameraRenderObservable.add(function(e){s.shouldRender&&e==s.getRenderCamera()&&s.render()}),this._sceneDisposeObserver=this.originalScene.onDisposeObservable.add(function(){s.dispose()}),this._updateCamera()}n.UtilityLayerRenderer=i},{}],51:[function(e,t,n){"use strict";var i,o=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0}),n.AxisDragGizmo=void 0;var h,r=e("./gizmo"),p=e("./UtilityLayerRenderer"),a=(h=r.Gizmo,o(f,h),f._CreateArrow=function(e,t,n){void 0===n&&(n=1);var i=new BABYLON.TransformNode("arrow",e),o=BABYLON.CylinderBuilder.CreateCylinder("cylinder",{diameterTop:0,height:.075,diameterBottom:.0375*(1+(n-1)/4),tessellation:96},e),r=BABYLON.CylinderBuilder.CreateCylinder("cylinder",{diameterTop:.005*n,height:.275,diameterBottom:.005*n,tessellation:96},e);return r.material=t,o.parent=i,r.parent=i,o.material=t,o.rotation.x=Math.PI/2,o.position.z+=.3,r.position.z+=.1375,r.rotation.x=Math.PI/2,i},f._CreateArrowInstance=function(e,t){for(var n=new BABYLON.TransformNode("arrow",e),i=0,o=t.getChildMeshes();i<o.length;i++){var r=o[i];r.createInstance(r.name).parent=n}return n},f.prototype._attachedNodeChanged=function(e){this.dragBehavior&&(this.dragBehavior.enabled=!!e)},Object.defineProperty(f.prototype,"isEnabled",{get:function(){return this._isEnabled},set:function(e){(this._isEnabled=e)?this._parent&&(this.attachedMesh=this._parent.attachedMesh,this.attachedNode=this._parent.attachedNode):(this.attachedMesh=null,this.attachedNode=null)},enumerable:!1,configurable:!0}),f.prototype.dispose=function(){this.onSnapObservable.clear(),this.gizmoLayer.utilityLayerScene.onPointerObservable.remove(this._pointerObserver),this.dragBehavior.detach(),this._arrow&&this._arrow.dispose(),[this._coloredMaterial,this._hoverMaterial].forEach(function(e){e&&e.dispose()}),h.prototype.dispose.call(this)},f);function f(e,t,n,i,o){void 0===t&&(t=BABYLON.Color3.Gray()),void 0===n&&(n=p.UtilityLayerRenderer.DefaultUtilityLayer),void 0===i&&(i=null),void 0===o&&(o=1);var r=h.call(this,n)||this;r._pointerObserver=null,r.snapDistance=0,r.onSnapObservable=new BABYLON.Observable,r._isEnabled=!0,r._parent=null,r._parent=i,r._coloredMaterial=new BABYLON.StandardMaterial("",n.utilityLayerScene),r._coloredMaterial.diffuseColor=t,r._coloredMaterial.specularColor=t.subtract(new BABYLON.Color3(.1,.1,.1)),r._hoverMaterial=new BABYLON.StandardMaterial("",n.utilityLayerScene),r._hoverMaterial.diffuseColor=t.add(new BABYLON.Color3(.3,.3,.3)),r._arrow=f._CreateArrow(n.utilityLayerScene,r._coloredMaterial,o),r._arrow.lookAt(r._rootMesh.position.add(e)),r._arrow.scaling.scaleInPlace(1/3),r._arrow.parent=r._rootMesh;var a=0,s=new BABYLON.Vector3,l={snapDistance:0};r.dragBehavior=new BABYLON.PointerDragBehavior({dragAxis:e}),r.dragBehavior.moveAttached=!1,r._rootMesh.addBehavior(r.dragBehavior);var c=new BABYLON.Vector3,d=new BABYLON.Matrix;r.dragBehavior.onDragObservable.add(function(e){var t;r.attachedNode&&(r.attachedNode.parent?(r.attachedNode.parent.getWorldMatrix().invertToRef(d),d.setTranslationFromFloats(0,0,0),BABYLON.Vector3.TransformCoordinatesToRef(e.delta,d,c)):c.copyFrom(e.delta),0==r.snapDistance?(r.attachedNode.position&&r.attachedNode.position.addInPlaceFromFloats(c.x,c.y,c.z),r.attachedNode._worldMatrix.addTranslationFromFloats(c.x,c.y,c.z),r.attachedNode.updateCache()):(a+=e.dragDistance,Math.abs(a)>r.snapDistance&&(t=Math.floor(Math.abs(a)/r.snapDistance),a%=r.snapDistance,c.normalizeToRef(s),s.scaleInPlace(r.snapDistance*t),r.attachedNode._worldMatrix.addTranslationFromFloats(s.x,s.y,s.z),r.attachedNode.updateCache(),l.snapDistance=r.snapDistance*t,r.onSnapObservable.notifyObservers(l))),r._operationType="translate",r._matrixChanged())}),r._pointerObserver=n.utilityLayerScene.onPointerObservable.add(function(e){var t;r._customMeshSet||(t=e.pickInfo&&-1!=r._rootMesh.getChildMeshes().indexOf(e.pickInfo.pickedMesh)?r._hoverMaterial:r._coloredMaterial,r._rootMesh.getChildMeshes().forEach(function(e){e.material=t,e.color&&(e.color=t.diffuseColor)}))});var u=n._getSharedGizmoLight();return u.includedOnlyMeshes=u.includedOnlyMeshes.concat(r._rootMesh.getChildMeshes(!1)),r}n.AxisDragGizmo=a},{"./UtilityLayerRenderer":50,"./gizmo":56}],52:[function(e,t,n){"use strict";var i,o=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0}),n.AxisScaleGizmo=void 0;var h,r=e("./gizmo"),p=e("./UtilityLayerRenderer"),a=(h=r.Gizmo,o(s,h),s.prototype._attachedNodeChanged=function(e){this.dragBehavior&&(this.dragBehavior.enabled=!!e)},Object.defineProperty(s.prototype,"isEnabled",{get:function(){return this._isEnabled},set:function(e){(this._isEnabled=e)?this._parent&&(this.attachedMesh=this._parent.attachedMesh,this.attachedNode=this._parent.attachedNode):(this.attachedMesh=null,this.attachedNode=null)},enumerable:!1,configurable:!0}),s.prototype.dispose=function(){this.onSnapObservable.clear(),this.gizmoLayer.utilityLayerScene.onPointerObservable.remove(this._pointerObserver),this.dragBehavior.detach(),this._arrow&&this._arrow.dispose(),[this._coloredMaterial,this._hoverMaterial].forEach(function(e){e&&e.dispose()}),h.prototype.dispose.call(this)},s.prototype.setCustomMesh=function(e,t){var n=this;void 0===t&&(t=!1),h.prototype.setCustomMesh.call(this,e),t&&(this._rootMesh.getChildMeshes().forEach(function(e){e.material=n._coloredMaterial,e.color&&(e.color=n._coloredMaterial.diffuseColor)}),this._customMeshSet=!1)},s);function s(r,e,t,n,i){void 0===e&&(e=BABYLON.Color3.Gray()),void 0===t&&(t=p.UtilityLayerRenderer.DefaultUtilityLayer),void 0===n&&(n=null),void 0===i&&(i=1);var a=h.call(this,t)||this;a._pointerObserver=null,a.snapDistance=0,a.onSnapObservable=new BABYLON.Observable,a.uniformScaling=!1,a.sensitivity=1,a._isEnabled=!0,a._parent=null,a._parent=n,a._coloredMaterial=new BABYLON.StandardMaterial("",t.utilityLayerScene),a._coloredMaterial.diffuseColor=e,a._coloredMaterial.specularColor=e.subtract(new BABYLON.Color3(.1,.1,.1)),a._hoverMaterial=new BABYLON.StandardMaterial("",t.utilityLayerScene),a._hoverMaterial.diffuseColor=e.add(new BABYLON.Color3(.3,.3,.3)),a._arrow=new BABYLON.AbstractMesh("",t.utilityLayerScene);var o=BABYLON.BoxBuilder.CreateBox("yPosMesh",{size:.4*(1+(i-1)/4)},t.utilityLayerScene),s=BABYLON.CylinderBuilder.CreateCylinder("cylinder",{diameterTop:.005*i,height:.275,diameterBottom:.005*i,tessellation:96},t.utilityLayerScene);s.material=a._coloredMaterial,a._arrow.addChild(o),a._arrow.addChild(s),o.scaling.scaleInPlace(.1),o.material=a._coloredMaterial,o.rotation.x=Math.PI/2,o.position.z+=.3,s.position.z+=.1375,s.rotation.x=Math.PI/2,a._arrow.lookAt(a._rootMesh.position.add(r)),a._rootMesh.addChild(a._arrow),a._arrow.scaling.scaleInPlace(1/3),a.dragBehavior=new BABYLON.PointerDragBehavior({dragAxis:r}),a.dragBehavior.moveAttached=!1,a._rootMesh.addBehavior(a.dragBehavior);var l=0,c=new BABYLON.Vector3,d={snapDistance:0};a.dragBehavior.onDragObservable.add(function(e){var t,n,i,o;a.attachedNode&&(t=a.sensitivity*e.dragDistance*(3*a.scaleRatio/a._rootMesh.scaling.length()),n=!1,i=0,a.uniformScaling?(a.attachedNode.getWorldMatrix().decompose(c),c.normalize(),c.y<0&&c.scaleInPlace(-1)):c.copyFrom(r),0==a.snapDistance?c.scaleToRef(t,c):(l+=t,Math.abs(l)>a.snapDistance?(i=Math.floor(Math.abs(l)/a.snapDistance),l<0&&(i*=-1),l%=a.snapDistance,c.scaleToRef(a.snapDistance*i,c),n=!0):c.scaleInPlace(0)),o=new BABYLON.Matrix,BABYLON.Matrix.ScalingToRef(1+c.x,1+c.y,1+c.z,o),a.attachedNode.getWorldMatrix().copyFrom(o.multiply(a.attachedNode.getWorldMatrix())),n&&(d.snapDistance=a.snapDistance*i,a.onSnapObservable.notifyObservers(d)),a._operationType="scale",a._matrixChanged())}),a._pointerObserver=t.utilityLayerScene.onPointerObservable.add(function(e){var t;a._customMeshSet||(t=e.pickInfo&&-1!=a._rootMesh.getChildMeshes().indexOf(e.pickInfo.pickedMesh)?a._hoverMaterial:a._coloredMaterial,a._rootMesh.getChildMeshes().forEach(function(e){e.material=t,e.color&&(e.color=t.diffuseColor)}))});var u=t._getSharedGizmoLight();return u.includedOnlyMeshes=u.includedOnlyMeshes.concat(a._rootMesh.getChildMeshes()),a}n.AxisScaleGizmo=a},{"./UtilityLayerRenderer":50,"./gizmo":56}],53:[function(e,t,n){"use strict";var i,o=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0}),n.BoundingBoxGizmo=void 0;var a,r=e("./gizmo"),p=e("./UtilityLayerRenderer"),s=(a=r.Gizmo,o(l,a),l.prototype.setColor=function(t){this.coloredMaterial.emissiveColor=t,this.hoverColoredMaterial.emissiveColor=t.clone().add(new BABYLON.Color3(.3,.3,.3)),this._lineBoundingBox.getChildren().forEach(function(e){e.color&&(e.color=t)})},l.prototype._attachedNodeChanged=function(e){var t,n=this;e&&(BABYLON.PivotTools._RemoveAndStorePivotPoint(e),t=e.parent,this._anchorMesh.addChild(e),this._anchorMesh.removeChild(e),e.setParent(t),BABYLON.PivotTools._RestorePivotPoint(e),this.updateBoundingBox(),e.getChildMeshes(!1).forEach(function(e){e.markAsDirty("scaling")}),this.gizmoLayer.utilityLayerScene.onAfterRenderObservable.addOnce(function(){n._updateDummy()}))},l.prototype._selectNode=function(t){this._rotateSpheresParent.getChildMeshes().concat(this._scaleBoxesParent.getChildMeshes()).forEach(function(e){e.isVisible=!t||e==t})},l.prototype.updateBoundingBox=function(){var e,t,n;this.attachedMesh&&(BABYLON.PivotTools._RemoveAndStorePivotPoint(this.attachedMesh),e=this.attachedMesh.parent,this.attachedMesh.setParent(null),t=null,this.attachedMesh.skeleton&&(t=this.attachedMesh.skeleton.overrideMesh,this.attachedMesh.skeleton.overrideMesh=null),this._update(),this.attachedMesh.rotationQuaternion||(this.attachedMesh.rotationQuaternion=BABYLON.Quaternion.RotationYawPitchRoll(this.attachedMesh.rotation.y,this.attachedMesh.rotation.x,this.attachedMesh.rotation.z)),this._anchorMesh.rotationQuaternion||(this._anchorMesh.rotationQuaternion=BABYLON.Quaternion.RotationYawPitchRoll(this._anchorMesh.rotation.y,this._anchorMesh.rotation.x,this._anchorMesh.rotation.z)),this._anchorMesh.rotationQuaternion.copyFrom(this.attachedMesh.rotationQuaternion),this._tmpQuaternion.copyFrom(this.attachedMesh.rotationQuaternion),this._tmpVector.copyFrom(this.attachedMesh.position),this.attachedMesh.rotationQuaternion.set(0,0,0,1),this.attachedMesh.position.set(0,0,0),(n=this.attachedMesh.getHierarchyBoundingVectors(!this.ignoreChildren,this.includeChildPredicate)).max.subtractToRef(n.min,this._boundingDimensions),this._lineBoundingBox.scaling.copyFrom(this._boundingDimensions),this._lineBoundingBox.position.set((n.max.x+n.min.x)/2,(n.max.y+n.min.y)/2,(n.max.z+n.min.z)/2),this._rotateSpheresParent.position.copyFrom(this._lineBoundingBox.position),this._scaleBoxesParent.position.copyFrom(this._lineBoundingBox.position),this._lineBoundingBox.computeWorldMatrix(),this._anchorMesh.position.copyFrom(this._lineBoundingBox.absolutePosition),this.attachedMesh.rotationQuaternion.copyFrom(this._tmpQuaternion),this.attachedMesh.position.copyFrom(this._tmpVector),this.attachedMesh.setParent(e),this.attachedMesh.skeleton&&(this.attachedMesh.skeleton.overrideMesh=t)),this._updateRotationSpheres(),this._updateScaleBoxes(),this.attachedMesh&&(this._existingMeshScale.copyFrom(this.attachedMesh.scaling),BABYLON.PivotTools._RestorePivotPoint(this.attachedMesh))},l.prototype._updateRotationSpheres=function(){for(var e=this._rotateSpheresParent.getChildMeshes(),t=0;t<3;t++)for(var n=0;n<2;n++)for(var i=0;i<2;i++){var o,r=4*t+2*n+i;0==t&&(e[r].position.set(this._boundingDimensions.x/2,this._boundingDimensions.y*n,this._boundingDimensions.z*i),e[r].position.addInPlace(new BABYLON.Vector3(-this._boundingDimensions.x/2,-this._boundingDimensions.y/2,-this._boundingDimensions.z/2)),e[r].lookAt(BABYLON.Vector3.Cross(e[r].position.normalizeToNew(),BABYLON.Vector3.Right()).normalizeToNew().add(e[r].position))),1==t&&(e[r].position.set(this._boundingDimensions.x*n,this._boundingDimensions.y/2,this._boundingDimensions.z*i),e[r].position.addInPlace(new BABYLON.Vector3(-this._boundingDimensions.x/2,-this._boundingDimensions.y/2,-this._boundingDimensions.z/2)),e[r].lookAt(BABYLON.Vector3.Cross(e[r].position.normalizeToNew(),BABYLON.Vector3.Up()).normalizeToNew().add(e[r].position))),2==t&&(e[r].position.set(this._boundingDimensions.x*n,this._boundingDimensions.y*i,this._boundingDimensions.z/2),e[r].position.addInPlace(new BABYLON.Vector3(-this._boundingDimensions.x/2,-this._boundingDimensions.y/2,-this._boundingDimensions.z/2)),e[r].lookAt(BABYLON.Vector3.Cross(e[r].position.normalizeToNew(),BABYLON.Vector3.Forward()).normalizeToNew().add(e[r].position))),this.fixedDragMeshScreenSize&&this.gizmoLayer.utilityLayerScene.activeCamera?(e[r].absolutePosition.subtractToRef(this.gizmoLayer.utilityLayerScene.activeCamera.position,this._tmpVector),o=this.rotationSphereSize*this._tmpVector.length()/this.fixedDragMeshScreenSizeDistanceFactor,e[r].scaling.set(o,o,o)):e[r].scaling.set(this.rotationSphereSize,this.rotationSphereSize,this.rotationSphereSize)}},l.prototype._updateScaleBoxes=function(){for(var e=this._scaleBoxesParent.getChildMeshes(),t=0,n=0;n<3;n++)for(var i=0;i<3;i++)for(var o=0;o<3;o++){var r,a=(1===n?1:0)+(1===i?1:0)+(1===o?1:0);1!=a&&3!=a&&(e[t]&&(e[t].position.set(this._boundingDimensions.x*(n/2),this._boundingDimensions.y*(i/2),this._boundingDimensions.z*(o/2)),e[t].position.addInPlace(new BABYLON.Vector3(-this._boundingDimensions.x/2,-this._boundingDimensions.y/2,-this._boundingDimensions.z/2)),this.fixedDragMeshScreenSize&&this.gizmoLayer.utilityLayerScene.activeCamera?(e[t].absolutePosition.subtractToRef(this.gizmoLayer.utilityLayerScene.activeCamera.position,this._tmpVector),r=this.scaleBoxSize*this._tmpVector.length()/this.fixedDragMeshScreenSizeDistanceFactor,e[t].scaling.set(r,r,r)):e[t].scaling.set(this.scaleBoxSize,this.scaleBoxSize,this.scaleBoxSize)),t++)}},l.prototype.setEnabledRotationAxis=function(n){this._rotateSpheresParent.getChildMeshes().forEach(function(e,t){t<4?e.setEnabled(-1!=n.indexOf("x")):t<8?e.setEnabled(-1!=n.indexOf("y")):e.setEnabled(-1!=n.indexOf("z"))})},l.prototype.setEnabledScaling=function(i,o){void 0===o&&(o=!1),this._scaleBoxesParent.getChildMeshes().forEach(function(e,t){var n=i;o&&!0===e.metadata&&(n=!1),e.setEnabled(n)})},l.prototype._updateDummy=function(){this._dragMesh&&(this._dragMesh.position.copyFrom(this._lineBoundingBox.getAbsolutePosition()),this._dragMesh.scaling.copyFrom(this._lineBoundingBox.scaling),this._dragMesh.rotationQuaternion.copyFrom(this._rootMesh.rotationQuaternion))},l.prototype.enableDragBehavior=function(){this._dragMesh=BABYLON.Mesh.CreateBox("dummy",1,this.gizmoLayer.utilityLayerScene),this._dragMesh.visibility=0,this._dragMesh.rotationQuaternion=new BABYLON.Quaternion,this.pointerDragBehavior.useObjectOrienationForDragging=!1,this._dragMesh.addBehavior(this.pointerDragBehavior)},l.prototype.dispose=function(){this.gizmoLayer.utilityLayerScene.onPointerObservable.remove(this._pointerObserver),this.gizmoLayer.originalScene.onBeforeRenderObservable.remove(this._renderObserver),this._lineBoundingBox.dispose(),this._rotateSpheresParent.dispose(),this._scaleBoxesParent.dispose(),this._dragMesh&&this._dragMesh.dispose(),a.prototype.dispose.call(this)},l.MakeNotPickableAndWrapInBoundingBox=function(e){var t=function(e){e.isPickable=!1,e.getChildMeshes().forEach(function(e){t(e)})};t(e),e.rotationQuaternion||(e.rotationQuaternion=BABYLON.Quaternion.RotationYawPitchRoll(e.rotation.y,e.rotation.x,e.rotation.z));var n=e.position.clone(),i=e.rotationQuaternion.clone();e.rotationQuaternion.set(0,0,0,1),e.position.set(0,0,0);var o=BABYLON.BoxBuilder.CreateBox("box",{size:1},e.getScene()),r=e.getHierarchyBoundingVectors();return r.max.subtractToRef(r.min,o.scaling),0===o.scaling.y&&(o.scaling.y=BABYLON.Epsilon),0===o.scaling.x&&(o.scaling.x=BABYLON.Epsilon),0===o.scaling.z&&(o.scaling.z=BABYLON.Epsilon),o.position.set((r.max.x+r.min.x)/2,(r.max.y+r.min.y)/2,(r.max.z+r.min.z)/2),e.addChild(o),e.rotationQuaternion.copyFrom(i),e.position.copyFrom(n),e.removeChild(o),o.addChild(e),o.visibility=0,o},l.prototype.setCustomMesh=function(e){BABYLON.Logger.Error("Custom meshes are not supported on this gizmo")},l);function l(t,n){void 0===t&&(t=BABYLON.Color3.Gray()),void 0===n&&(n=p.UtilityLayerRenderer.DefaultKeepDepthUtilityLayer);var c=a.call(this,n)||this;c._boundingDimensions=new BABYLON.Vector3(1,1,1),c._renderObserver=null,c._pointerObserver=null,c._scaleDragSpeed=.2,c._tmpQuaternion=new BABYLON.Quaternion,c._tmpVector=new BABYLON.Vector3(0,0,0),c._tmpRotationMatrix=new BABYLON.Matrix,c.ignoreChildren=!1,c.includeChildPredicate=null,c.rotationSphereSize=.1,c.scaleBoxSize=.1,c.fixedDragMeshScreenSize=!1,c.fixedDragMeshScreenSizeDistanceFactor=10,c.onDragStartObservable=new BABYLON.Observable,c.onScaleBoxDragObservable=new BABYLON.Observable,c.onScaleBoxDragEndObservable=new BABYLON.Observable,c.onRotationSphereDragObservable=new BABYLON.Observable,c.onRotationSphereDragEndObservable=new BABYLON.Observable,c.scalePivot=null,c._existingMeshScale=new BABYLON.Vector3,c._dragMesh=null,c.pointerDragBehavior=new BABYLON.PointerDragBehavior,c.updateScale=!1,c._anchorMesh=new BABYLON.AbstractMesh("anchor",n.utilityLayerScene),c.coloredMaterial=new BABYLON.StandardMaterial("",n.utilityLayerScene),c.coloredMaterial.disableLighting=!0,c.hoverColoredMaterial=new BABYLON.StandardMaterial("",n.utilityLayerScene),c.hoverColoredMaterial.disableLighting=!0,c._lineBoundingBox=new BABYLON.AbstractMesh("",n.utilityLayerScene),c._lineBoundingBox.rotationQuaternion=new BABYLON.Quaternion;var e=[];e.push(BABYLON.LinesBuilder.CreateLines("lines",{points:[new BABYLON.Vector3(0,0,0),new BABYLON.Vector3(c._boundingDimensions.x,0,0)]},n.utilityLayerScene)),e.push(BABYLON.LinesBuilder.CreateLines("lines",{points:[new BABYLON.Vector3(0,0,0),new BABYLON.Vector3(0,c._boundingDimensions.y,0)]},n.utilityLayerScene)),e.push(BABYLON.LinesBuilder.CreateLines("lines",{points:[new BABYLON.Vector3(0,0,0),new BABYLON.Vector3(0,0,c._boundingDimensions.z)]},n.utilityLayerScene)),e.push(BABYLON.LinesBuilder.CreateLines("lines",{points:[new BABYLON.Vector3(c._boundingDimensions.x,0,0),new BABYLON.Vector3(c._boundingDimensions.x,c._boundingDimensions.y,0)]},n.utilityLayerScene)),e.push(BABYLON.LinesBuilder.CreateLines("lines",{points:[new BABYLON.Vector3(c._boundingDimensions.x,0,0),new BABYLON.Vector3(c._boundingDimensions.x,0,c._boundingDimensions.z)]},n.utilityLayerScene)),e.push(BABYLON.LinesBuilder.CreateLines("lines",{points:[new BABYLON.Vector3(0,c._boundingDimensions.y,0),new BABYLON.Vector3(c._boundingDimensions.x,c._boundingDimensions.y,0)]},n.utilityLayerScene)),e.push(BABYLON.LinesBuilder.CreateLines("lines",{points:[new BABYLON.Vector3(0,c._boundingDimensions.y,0),new BABYLON.Vector3(0,c._boundingDimensions.y,c._boundingDimensions.z)]},n.utilityLayerScene)),e.push(BABYLON.LinesBuilder.CreateLines("lines",{points:[new BABYLON.Vector3(0,0,c._boundingDimensions.z),new BABYLON.Vector3(c._boundingDimensions.x,0,c._boundingDimensions.z)]},n.utilityLayerScene)),e.push(BABYLON.LinesBuilder.CreateLines("lines",{points:[new BABYLON.Vector3(0,0,c._boundingDimensions.z),new BABYLON.Vector3(0,c._boundingDimensions.y,c._boundingDimensions.z)]},n.utilityLayerScene)),e.push(BABYLON.LinesBuilder.CreateLines("lines",{points:[new BABYLON.Vector3(c._boundingDimensions.x,c._boundingDimensions.y,c._boundingDimensions.z),new BABYLON.Vector3(0,c._boundingDimensions.y,c._boundingDimensions.z)]},n.utilityLayerScene)),e.push(BABYLON.LinesBuilder.CreateLines("lines",{points:[new BABYLON.Vector3(c._boundingDimensions.x,c._boundingDimensions.y,c._boundingDimensions.z),new BABYLON.Vector3(c._boundingDimensions.x,0,c._boundingDimensions.z)]},n.utilityLayerScene)),e.push(BABYLON.LinesBuilder.CreateLines("lines",{points:[new BABYLON.Vector3(c._boundingDimensions.x,c._boundingDimensions.y,c._boundingDimensions.z),new BABYLON.Vector3(c._boundingDimensions.x,c._boundingDimensions.y,0)]},n.utilityLayerScene)),e.forEach(function(e){e.color=t,e.position.addInPlace(new BABYLON.Vector3(-c._boundingDimensions.x/2,-c._boundingDimensions.y/2,-c._boundingDimensions.z/2)),e.isPickable=!1,c._lineBoundingBox.addChild(e)}),c._rootMesh.addChild(c._lineBoundingBox),c.setColor(t),c._rotateSpheresParent=new BABYLON.AbstractMesh("",n.utilityLayerScene),c._rotateSpheresParent.rotationQuaternion=new BABYLON.Quaternion;for(var i=this,o=0;o<12;o++)!function(a){var e=BABYLON.SphereBuilder.CreateSphere("",{diameter:1},n.utilityLayerScene);e.rotationQuaternion=new BABYLON.Quaternion,e.material=i.coloredMaterial,(d=new BABYLON.PointerDragBehavior({})).moveAttached=!1,d.updateDragPlane=!1,e.addBehavior(d);var s=new BABYLON.Vector3(1,0,0),l=0;d.onDragStartObservable.add(function(){s.copyFrom(e.forward),l=0}),d.onDragObservable.add(function(e){if(c.onRotationSphereDragObservable.notifyObservers({}),c.attachedMesh){var t=c.attachedMesh.parent;if(t&&t.scaling&&t.scaling.isNonUniformWithinEpsilon(.001))return void BABYLON.Logger.Warn("BoundingBoxGizmo controls are not supported on child meshes with non-uniform parent scaling");BABYLON.PivotTools._RemoveAndStorePivotPoint(c.attachedMesh);var n=s,i=e.dragPlaneNormal.scale(BABYLON.Vector3.Dot(e.dragPlaneNormal,n)),o=n.subtract(i).normalizeToNew(),r=(r=BABYLON.Vector3.Dot(o,e.delta)<0?Math.abs(e.delta.length()):-Math.abs(e.delta.length()))/c._boundingDimensions.length()*c._anchorMesh.scaling.length();c.attachedMesh.rotationQuaternion||(c.attachedMesh.rotationQuaternion=BABYLON.Quaternion.RotationYawPitchRoll(c.attachedMesh.rotation.y,c.attachedMesh.rotation.x,c.attachedMesh.rotation.z)),c._anchorMesh.rotationQuaternion||(c._anchorMesh.rotationQuaternion=BABYLON.Quaternion.RotationYawPitchRoll(c._anchorMesh.rotation.y,c._anchorMesh.rotation.x,c._anchorMesh.rotation.z)),l+=r,Math.abs(l)<=2*Math.PI&&(8<=a?BABYLON.Quaternion.RotationYawPitchRollToRef(0,0,r,c._tmpQuaternion):4<=a?BABYLON.Quaternion.RotationYawPitchRollToRef(r,0,0,c._tmpQuaternion):BABYLON.Quaternion.RotationYawPitchRollToRef(0,r,0,c._tmpQuaternion),c._anchorMesh.addChild(c.attachedMesh),c._anchorMesh.rotationQuaternion.multiplyToRef(c._tmpQuaternion,c._anchorMesh.rotationQuaternion),c._anchorMesh.removeChild(c.attachedMesh),c.attachedMesh.setParent(t)),c.updateBoundingBox(),BABYLON.PivotTools._RestorePivotPoint(c.attachedMesh)}c._updateDummy()}),d.onDragStartObservable.add(function(){c.onDragStartObservable.notifyObservers({}),c._selectNode(e)}),d.onDragEndObservable.add(function(){c.onRotationSphereDragEndObservable.notifyObservers({}),c._selectNode(null),c._updateDummy()}),i._rotateSpheresParent.addChild(e)}(o);c._rootMesh.addChild(c._rotateSpheresParent),c._scaleBoxesParent=new BABYLON.AbstractMesh("",n.utilityLayerScene),c._scaleBoxesParent.rotationQuaternion=new BABYLON.Quaternion;for(var s=0;s<3;s++)for(var l=0;l<3;l++)for(var d,u=this,h=0;h<3;h++)!function(){var o=(1===s?1:0)+(1===l?1:0)+(1===h?1:0);if(1==o||3==o)return;var r=BABYLON.BoxBuilder.CreateBox("",{size:1},n.utilityLayerScene);r.material=u.coloredMaterial,r.metadata=2==o;var a=new BABYLON.Vector3(s-1,l-1,h-1).normalize();(d=new BABYLON.PointerDragBehavior({dragAxis:a})).updateDragPlane=!1,d.moveAttached=!1,r.addBehavior(d),d.onDragObservable.add(function(e){if(c.onScaleBoxDragObservable.notifyObservers({}),c.attachedMesh){var t=c.attachedMesh.parent;if(t&&t.scaling&&t.scaling.isNonUniformWithinEpsilon(.001))return void BABYLON.Logger.Warn("BoundingBoxGizmo controls are not supported on child meshes with non-uniform parent scaling");BABYLON.PivotTools._RemoveAndStorePivotPoint(c.attachedMesh);var n=e.dragDistance/c._boundingDimensions.length()*c._anchorMesh.scaling.length(),i=new BABYLON.Vector3(n,n,n);2==o&&(i.x*=Math.abs(a.x),i.y*=Math.abs(a.y),i.z*=Math.abs(a.z)),i.scaleInPlace(c._scaleDragSpeed),c.updateBoundingBox(),c.scalePivot?(c.attachedMesh.getWorldMatrix().getRotationMatrixToRef(c._tmpRotationMatrix),c._boundingDimensions.scaleToRef(.5,c._tmpVector),BABYLON.Vector3.TransformCoordinatesToRef(c._tmpVector,c._tmpRotationMatrix,c._tmpVector),c._anchorMesh.position.subtractInPlace(c._tmpVector),c._boundingDimensions.multiplyToRef(c.scalePivot,c._tmpVector),BABYLON.Vector3.TransformCoordinatesToRef(c._tmpVector,c._tmpRotationMatrix,c._tmpVector),c._anchorMesh.position.addInPlace(c._tmpVector)):(r.absolutePosition.subtractToRef(c._anchorMesh.position,c._tmpVector),c._anchorMesh.position.subtractInPlace(c._tmpVector)),c._anchorMesh.addChild(c.attachedMesh),c._anchorMesh.scaling.addInPlace(i),(c._anchorMesh.scaling.x<0||c._anchorMesh.scaling.y<0||c._anchorMesh.scaling.z<0)&&c._anchorMesh.scaling.subtractInPlace(i),c._anchorMesh.removeChild(c.attachedMesh),c.attachedMesh.setParent(t),BABYLON.PivotTools._RestorePivotPoint(c.attachedMesh)}c._updateDummy()}),d.onDragStartObservable.add(function(){c.onDragStartObservable.notifyObservers({}),c._selectNode(r)}),d.onDragEndObservable.add(function(){c.onScaleBoxDragEndObservable.notifyObservers({}),c._selectNode(null),c._updateDummy()}),u._scaleBoxesParent.addChild(r)}();c._rootMesh.addChild(c._scaleBoxesParent);var r=new Array;return c._pointerObserver=n.utilityLayerScene.onPointerObservable.add(function(t){r[t.event.pointerId]?t.pickInfo&&t.pickInfo.pickedMesh!=r[t.event.pointerId]&&(r[t.event.pointerId].material=c.coloredMaterial,delete r[t.event.pointerId]):c._rotateSpheresParent.getChildMeshes().concat(c._scaleBoxesParent.getChildMeshes()).forEach(function(e){t.pickInfo&&t.pickInfo.pickedMesh==e&&((r[t.event.pointerId]=e).material=c.hoverColoredMaterial)})}),c._renderObserver=c.gizmoLayer.originalScene.onBeforeRenderObservable.add(function(){c.attachedMesh&&!c._existingMeshScale.equals(c.attachedMesh.scaling)?c.updateBoundingBox():c.fixedDragMeshScreenSize&&(c._updateRotationSpheres(),c._updateScaleBoxes()),c._dragMesh&&c.attachedMesh&&c.pointerDragBehavior.dragging&&(c._lineBoundingBox.position.rotateByQuaternionToRef(c._rootMesh.rotationQuaternion,c._tmpVector),c.attachedMesh.setAbsolutePosition(c._dragMesh.position.add(c._tmpVector.scale(-1))))}),c.updateBoundingBox(),c}n.BoundingBoxGizmo=s},{"./UtilityLayerRenderer":50,"./gizmo":56}],54:[function(e,t,n){"use strict";var i,o=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0}),n.CameraGizmo=void 0;var r,a=e("../middleware"),s=e("./gizmo"),l=e("./UtilityLayerRenderer"),c=(r=s.Gizmo,o(d,r),Object.defineProperty(d.prototype,"displayFrustum",{get:function(){return this._cameraLinesMesh.isEnabled()},set:function(e){this._cameraLinesMesh.setEnabled(e)},enumerable:!1,configurable:!0}),Object.defineProperty(d.prototype,"camera",{get:function(){return this._camera},set:function(e){var t,n=this;this._camera=e,(this.attachedNode=e)&&(this._cameraMesh&&this._cameraMesh.dispose(),this._cameraLinesMesh&&this._cameraLinesMesh.dispose(),this._cameraMesh=d._CreateCameraMesh(this.gizmoLayer.utilityLayerScene),this._cameraLinesMesh=d._CreateCameraFrustum(this.gizmoLayer.utilityLayerScene),this._cameraMesh.getChildMeshes(!1).forEach(function(e){e.material=n._material}),this._cameraMesh.parent=this._rootMesh,this._cameraLinesMesh.parent=this._rootMesh,this.gizmoLayer.utilityLayerScene.activeCamera&&this.gizmoLayer.utilityLayerScene.activeCamera.maxZ<1.5*e.maxZ&&(this.gizmoLayer.utilityLayerScene.activeCamera.maxZ=1.5*e.maxZ),this.attachedNode.reservedDataStore||(this.attachedNode.reservedDataStore={}),(t=(this.attachedNode.reservedDataStore.cameraGizmo=this).gizmoLayer._getSharedGizmoLight()).includedOnlyMeshes=t.includedOnlyMeshes.concat(this._cameraMesh.getChildMeshes(!1)),this._update())},enumerable:!1,configurable:!0}),Object.defineProperty(d.prototype,"material",{get:function(){return this._material},enumerable:!1,configurable:!0}),d.prototype._update=function(){r.prototype._update.call(this),this._camera&&(this._camera.getProjectionMatrix().invertToRef(this._invProjection),this._cameraLinesMesh.setPivotMatrix(this._invProjection,!1),this._cameraLinesMesh.scaling.x=1/this._rootMesh.scaling.x,this._cameraLinesMesh.scaling.y=1/this._rootMesh.scaling.y,this._cameraLinesMesh.scaling.z=1/this._rootMesh.scaling.z,this._cameraMesh.parent=null,this._cameraMesh.rotation.y=.5*Math.PI*(this._camera.getScene().useRightHandedSystem?1:-1),this._cameraMesh.parent=this._rootMesh)},d.prototype.dispose=function(){this.onClickedObservable.clear(),this.gizmoLayer.utilityLayerScene.onPointerObservable.remove(this._pointerObserver),this._cameraMesh&&this._cameraMesh.dispose(),this._cameraLinesMesh&&this._cameraLinesMesh.dispose(),this._material.dispose(),r.prototype.dispose.call(this)},d._CreateCameraMesh=function(e){var t=new BABYLON.Mesh("rootCameraGizmo",e),n=new BABYLON.Mesh(t.name,e);n.parent=t,BABYLON.BoxBuilder.CreateBox(t.name,{width:1,height:.8,depth:.5},e).parent=n;var i=BABYLON.CylinderBuilder.CreateCylinder(t.name,{height:.5,diameterTop:.8,diameterBottom:.8},e);i.parent=n,i.position.y=.3,i.position.x=-.6,i.rotation.x=.5*Math.PI;var o=BABYLON.CylinderBuilder.CreateCylinder(t.name,{height:.5,diameterTop:.6,diameterBottom:.6},e);o.parent=n,o.position.y=.5,o.position.x=.4,o.rotation.x=.5*Math.PI;var r=BABYLON.CylinderBuilder.CreateCylinder(t.name,{height:.5,diameterTop:.5,diameterBottom:.5},e);return r.parent=n,r.position.y=0,r.position.x=.6,r.rotation.z=.5*Math.PI,t.scaling.scaleInPlace(d._Scale),n.position.x=-.9,t},d._CreateCameraFrustum=function(e){var t=new BABYLON.Mesh("rootCameraGizmo",e),n=new BABYLON.Mesh(t.name,e);n.parent=t;for(var i=0;i<4;i+=2)for(var o=0;o<4;o+=2){var r=BABYLON.LinesBuilder.CreateLines("lines",{points:[new BABYLON.Vector3(-1+o,-1+i,-1),new BABYLON.Vector3(-1+o,-1+i,1)]},e);r.parent=n,r.alwaysSelectAsActiveMesh=!0,r.isPickable=!1,(r=BABYLON.LinesBuilder.CreateLines("lines",{points:[new BABYLON.Vector3(-1,-1+o,-1+i),new BABYLON.Vector3(1,-1+o,-1+i)]},e)).parent=n,r.alwaysSelectAsActiveMesh=!0,r.isPickable=!1,(r=BABYLON.LinesBuilder.CreateLines("lines",{points:[new BABYLON.Vector3(-1+o,-1,-1+i),new BABYLON.Vector3(-1+o,1,-1+i)]},e)).parent=n,r.alwaysSelectAsActiveMesh=!0,r.isPickable=!1}return t},d._Scale=.05,d);function d(e){void 0===e&&(e=l.UtilityLayerRenderer.DefaultUtilityLayer);var n=r.call(this,e)||this;return n._pointerObserver=null,n.onClickedObservable=new BABYLON.Observable,n._camera=null,n._invProjection=new BABYLON.Matrix,n._material=new BABYLON.StandardMaterial("cameraGizmoMaterial",n.gizmoLayer.utilityLayerScene),n._material.diffuseColor=new BABYLON.Color3(.5,.5,.5),n._material.specularColor=new BABYLON.Color3(.1,.1,.1),n._pointerObserver=e.utilityLayerScene.onPointerObservable.add(function(e){var t;n._camera&&e.pickInfo&&-1!=n._rootMesh.getChildMeshes().indexOf(e.pickInfo.pickedMesh)&&0===e.event.button&&(n._camera.parent&&n._camera.parent instanceof a.VeryCamera&&((t=editor.call("entities:get",n._camera.parent.id))?editor.call("selector:set","entity",[t]):console.error("失败")),n.onClickedObservable.notifyObservers(n._camera))},BABYLON.PointerEventTypes.POINTERDOWN),n}n.CameraGizmo=c},{"../middleware":85,"./UtilityLayerRenderer":50,"./gizmo":56}],55:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.GizmosCenter=void 0;var i=e("."),o=e("../utility"),s=e("../middleware"),l=e("./cameraGizmo"),r=(c.init=function(e){var r=this;(c.gizmoManager=new i.GizmoManager(e)).positionGizmoEnabled=!0,c.gizmoManager.rotationGizmoEnabled=!0,c.gizmoManager.scaleGizmoEnabled=!0,c.gizmoManager.gizmos.positionGizmo.scaleRatio=1.5,c.gizmoManager.gizmos.rotationGizmo.scaleRatio=1.5,c.gizmoManager.gizmos.scaleGizmo.scaleRatio=1.5,c.gizmoManager.positionGizmoEnabled=!1,c.gizmoManager.rotationGizmoEnabled=!1,c.gizmoManager.scaleGizmoEnabled=!1;var a=null;editor.on("selector:change",function(e,t){if(c.clear(),"entity"===e){if(t&&0===t.length)return;var n=void 0;if(!((n=1===t.length?t[0].node:t[t.length-1].node)instanceof BABYLON.Node))return void c.attach(null);if(c.attach(n),n&&n instanceof s.VeryCamera){var i=editor.call("gizmo:get",n.id);if(i===a)return;a&&(a.displayFrustum=!1,a=null),i&&i instanceof l.CameraGizmo&&(i.displayFrustum=!0,a=i)}else a&&(a.displayFrustum=!1,a=null);r.currentItems=t;for(var o=0;o<r.currentItems.length;o++)r.currentEvents.push(r.currentItems[o].on("position:set",function(e){})),r.currentEvents.push(r.currentItems[o].on("position.0:set",function(e){})),r.currentEvents.push(r.currentItems[o].on("position.1:set",function(e){})),r.currentEvents.push(r.currentItems[o].on("position.2:set",function(e){})),r.currentEvents.push(r.currentItems[o].on("rotation:set",function(e){})),r.currentEvents.push(r.currentItems[o].on("rotation.0:set",function(e){})),r.currentEvents.push(r.currentItems[o].on("rotation.1:set",function(e){})),r.currentEvents.push(r.currentItems[o].on("rotation.2:set",function(e){})),r.currentEvents.push(r.currentItems[o].on("scale:set",function(e){})),r.currentEvents.push(r.currentItems[o].on("scale.0:set",function(e){})),r.currentEvents.push(r.currentItems[o].on("scale.1:set",function(e){})),r.currentEvents.push(r.currentItems[o].on("scale.2:set",function(e){}))}})},c.setMode=function(e){this.mode=e,0==this.mode?(this.gizmoManager.positionGizmoEnabled=!0,this.gizmoManager.rotationGizmoEnabled=!1,this.gizmoManager.scaleGizmoEnabled=!1):1===this.mode?(this.gizmoManager.positionGizmoEnabled=!1,this.gizmoManager.rotationGizmoEnabled=!0,this.gizmoManager.scaleGizmoEnabled=!1):(this.gizmoManager.positionGizmoEnabled=!1,this.gizmoManager.rotationGizmoEnabled=!1,this.gizmoManager.scaleGizmoEnabled=!0)},c.attach=function(e){e instanceof BABYLON.AbstractMesh?this.gizmoManager.attachToMesh(e):this.gizmoManager.attachToNode(e),this.setMode(this.mode)},c.setPosition=function(e){this.currentItems&&(1===this.currentItems.length?(this.currentItems[0].set("position.0",e.x),this.currentItems[0].set("position.1",e.y),this.currentItems[0].set("position.2",e.z)):(this.currentItems[this.currentItems.length-1].set("position.0",e.x),this.currentItems[this.currentItems.length-1].set("position.1",e.y),this.currentItems[this.currentItems.length-1].set("position.2",e.z)))},c.setRotation=function(e){var t=o.Tools.radianToEulerAngle(e);this.currentItems&&(1===this.currentItems.length?(this.currentItems[0].set("rotation.0",t.x),this.currentItems[0].set("rotation.1",t.y),this.currentItems[0].set("rotation.2",t.z)):(this.currentItems[this.currentItems.length-1].set("rotation.0",t.x),this.currentItems[this.currentItems.length-1].set("rotation.1",t.y),this.currentItems[this.currentItems.length-1].set("rotation.2",t.z)))},c.setScale=function(e){this.currentItems&&(1===this.currentItems.length?(this.currentItems[0].set("scale.0",e.x),this.currentItems[0].set("scale.1",e.y),this.currentItems[0].set("scale.2",e.z)):(this.currentItems[this.currentItems.length-1].set("scale.0",e.x),this.currentItems[this.currentItems.length-1].set("scale.1",e.y),this.currentItems[this.currentItems.length-1].set("scale.2",e.z)))},c.clear=function(){if(this.gizmoManager.attachToMesh(null),this.currentEvents&&0<this.currentEvents.length)for(var e=0;e<this.currentEvents.length;e++)this.currentEvents[e].unbind();this.currentEvents=[],this.currentItems=[]},c.mode=0,c.currentItems=[],c.currentEvents=[],c);function c(){}n.GizmosCenter=r},{".":58,"../middleware":85,"../utility":124,"./cameraGizmo":54}],56:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.Gizmo=void 0;var d=e("."),i=e("./UtilityLayerRenderer"),o=(Object.defineProperty(r.prototype,"scaleRatio",{get:function(){return this._scaleRatio},set:function(e){this._scaleRatio=e},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"attachedMesh",{get:function(){return this._attachedMesh},set:function(e){(this._attachedMesh=e)&&(this._attachedNode=e),this._rootMesh.setEnabled(!!e),this._attachedNodeChanged(e)},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"attachedNode",{get:function(){return this._attachedNode},set:function(e){this._attachedNode=e,this._attachedMesh=null,this._rootMesh.setEnabled(!!e),this._attachedNodeChanged(e)},enumerable:!1,configurable:!0}),r.prototype.setCustomMesh=function(e){if(e.getScene()!=this.gizmoLayer.utilityLayerScene)throw"When setting a custom mesh on a gizmo, the custom meshes scene must be the same as the gizmos (eg. gizmo.gizmoLayer.utilityLayerScene)";this._rootMesh.getChildMeshes().forEach(function(e){e.dispose()}),e.parent=this._rootMesh,this._customMeshSet=!0},Object.defineProperty(r.prototype,"updateGizmoRotationToMatchAttachedMesh",{get:function(){return this._updateGizmoRotationToMatchAttachedMesh},set:function(e){this._updateGizmoRotationToMatchAttachedMesh=e},enumerable:!1,configurable:!0}),r.prototype._attachedNodeChanged=function(e){},r.prototype._update=function(){var e,t,n,i,o,r,a;this.attachedNode&&(e=this.attachedNode,this.attachedMesh&&(e=this.attachedMesh._effectiveMesh||this.attachedNode),this.updateGizmoPositionToMatchAttachedMesh&&(n=(t=e.getWorldMatrix().getRow(3))?t.toVector3():new BABYLON.Vector3(0,0,0),this._rootMesh.position.copyFrom(n)),this.updateGizmoRotationToMatchAttachedMesh?e.getWorldMatrix().decompose(void 0,this._rootMesh.rotationQuaternion):this._rootMesh.rotationQuaternion?this._rootMesh.rotationQuaternion.set(0,0,0,1):this._rootMesh.rotation=BABYLON.Vector3.Zero(),this.updateScale?(o=(i=this.gizmoLayer.utilityLayerScene.activeCamera).globalPosition,i.devicePosition&&(o=i.devicePosition),i.mode===BABYLON.Camera.PERSPECTIVE_CAMERA?(this._rootMesh.position.subtractToRef(o,this._tempVector),r=this._tempVector.length()*this.scaleRatio,this._rootMesh.scaling.set(r,r,r)):(a=600*this.scaleRatio,a*=2.2*(i.orthoRight?i.orthoRight/this.gizmoLayer.utilityLayerScene.getEngine().getRenderWidth():1),this._rootMesh.scaling.set(a,a,a)),e._getWorldMatrixDeterminant()<0&&(this._rootMesh.scaling.y*=-1)):this._rootMesh.scaling.setAll(this.scaleRatio))},r.prototype._matrixChanged=function(){var e,t,n,i,o,r,a,s,l,c;this._attachedNode&&(this._attachedNode._isCamera?(t=(e=this._attachedNode).parent?(o=this._tempMatrix2,e.parent._worldMatrix.invertToRef(o),this._attachedNode._worldMatrix.multiplyToRef(o,this._tempMatrix1),this._tempMatrix1):this._attachedNode._worldMatrix,(e.getScene().useRightHandedSystem?(this._rightHandtoLeftHandMatrix.multiplyToRef(t,this._tempMatrix2),this._tempMatrix2):t).decompose(this._tempVector2,this._tempQuaternion,this._tempVector),"FreeCamera"!==this._attachedNode.getClassName()&&"FlyCamera"!==this._attachedNode.getClassName()&&"ArcFollowCamera"!==this._attachedNode.getClassName()&&"TargetCamera"!==this._attachedNode.getClassName()&&"TouchCamera"!==this._attachedNode.getClassName()&&"UniversalCamera"!==this._attachedNode.getClassName()||((n=this._attachedNode).rotation=this._tempQuaternion.toEulerAngles(),n.rotationQuaternion&&n.rotationQuaternion.copyFrom(this._tempQuaternion)),e.position.copyFrom(this._tempVector)):this._attachedNode._isMesh||"AbstractMesh"===this._attachedNode.getClassName()||"TransformNode"===this._attachedNode.getClassName()||"InstancedMesh"===this._attachedNode.getClassName()?((i=this._attachedNode).parent?(o=this._tempMatrix1,r=this._tempMatrix2,i.parent.getWorldMatrix().invertToRef(o),this._attachedNode._worldMatrix.multiplyToRef(o,r),r.decompose(i.scaling,this._tempQuaternion,i.position)):this._attachedNode._worldMatrix.decompose(i.scaling,this._tempQuaternion,i.position),i.rotationQuaternion?i.rotationQuaternion.copyFrom(this._tempQuaternion):i.rotation=this._tempQuaternion.toEulerAngles(),"translate"===this._operationType||"plane"===this._operationType?d.GizmosCenter.setPosition(i.position):"rotate"===this._operationType?d.GizmosCenter.setRotation(i.rotation):this._operationType):"Bone"!==this._attachedNode.getClassName()||(s=(a=this._attachedNode).getParent())&&(l=this._tempMatrix1,c=this._tempMatrix2,s.getWorldMatrix().invertToRef(l),a.getWorldMatrix().multiplyToRef(l,c),a.getLocalMatrix().copyFrom(c),a.markAsDirty()))},r.prototype.dispose=function(){this._rootMesh.dispose(),this._beforeRenderObserver&&this.gizmoLayer.utilityLayerScene.onBeforeRenderObservable.remove(this._beforeRenderObserver)},r);function r(e){var t=this;void 0===e&&(e=i.UtilityLayerRenderer.DefaultUtilityLayer),this.gizmoLayer=e,this._attachedMesh=null,this._attachedNode=null,this._scaleRatio=1,this._operationType="",this._customMeshSet=!1,this._updateGizmoRotationToMatchAttachedMesh=!0,this.updateGizmoPositionToMatchAttachedMesh=!0,this.updateScale=!0,this._interactionsEnabled=!0,this._tempQuaternion=new BABYLON.Quaternion(0,0,0,1),this._tempVector=new BABYLON.Vector3,this._tempVector2=new BABYLON.Vector3,this._tempMatrix1=new BABYLON.Matrix,this._tempMatrix2=new BABYLON.Matrix,this._rightHandtoLeftHandMatrix=BABYLON.Matrix.RotationY(Math.PI),this._rootMesh=new BABYLON.Mesh("gizmoRootNode",e.utilityLayerScene),this._rootMesh.rotationQuaternion=BABYLON.Quaternion.Identity(),this._beforeRenderObserver=this.gizmoLayer.utilityLayerScene.onBeforeRenderObservable.add(function(){t._update()})}n.Gizmo=o},{".":58,"./UtilityLayerRenderer":50}],57:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.GizmoManager=void 0;var i=e("./rotationGizmo"),o=e("./positionGizmo"),r=e("./scaleGizmo"),a=e("./boundingBoxGizmo"),s=e("."),l=e("./UtilityLayerRenderer"),c=(Object.defineProperty(d.prototype,"keepDepthUtilityLayer",{get:function(){return this._defaultKeepDepthUtilityLayer},enumerable:!1,configurable:!0}),Object.defineProperty(d.prototype,"utilityLayer",{get:function(){return this._defaultUtilityLayer},enumerable:!1,configurable:!0}),d.prototype.initialize=function(){editor.on("selector:change",function(e,t){})},d.prototype.attachToMesh=function(e){for(var t in this._attachedMesh&&(this._attachedMesh.removeBehavior(this.boundingBoxDragBehavior),this._attachedMesh.showBoundingBox=!1),this._attachedNode&&this._attachedNode.removeBehavior(this.boundingBoxDragBehavior),this._attachedMesh=e,this._attachedMesh&&(this._attachedMesh.showBoundingBox=!0),this._attachedNode=null,this.gizmos){var n=this.gizmos[t];n&&this._gizmosEnabled[t]&&(n.attachedMesh=e)}this.boundingBoxGizmoEnabled&&this._attachedMesh&&this._attachedMesh.addBehavior(this.boundingBoxDragBehavior),this.onAttachedToMeshObservable.notifyObservers(e)},d.prototype.attachToNode=function(e){for(var t in this._attachedMesh&&(this._attachedMesh.removeBehavior(this.boundingBoxDragBehavior),this._attachedMesh.showBoundingBox=!1),this._attachedNode&&this._attachedNode.removeBehavior(this.boundingBoxDragBehavior),this._attachedMesh=null,this._attachedNode=e,this.gizmos){var n=this.gizmos[t];n&&this._gizmosEnabled[t]&&(n.attachedNode=e)}this.boundingBoxGizmoEnabled&&this._attachedNode&&this._attachedNode.addBehavior(this.boundingBoxDragBehavior),this.onAttachedToNodeObservable.notifyObservers(e)},Object.defineProperty(d.prototype,"positionGizmoEnabled",{get:function(){return this._gizmosEnabled.positionGizmo},set:function(e){e?(this.gizmos.positionGizmo||(this.gizmos.positionGizmo=new o.PositionGizmo(this._defaultUtilityLayer,this._thickness)),this._attachedNode?this.gizmos.positionGizmo.attachedNode=this._attachedNode:this.gizmos.positionGizmo.attachedMesh=this._attachedMesh):this.gizmos.positionGizmo&&(this.gizmos.positionGizmo.attachedNode=null),this._gizmosEnabled.positionGizmo=e},enumerable:!1,configurable:!0}),Object.defineProperty(d.prototype,"rotationGizmoEnabled",{get:function(){return this._gizmosEnabled.rotationGizmo},set:function(e){e?(this.gizmos.rotationGizmo||(this.gizmos.rotationGizmo=new i.RotationGizmo(this._defaultUtilityLayer,32,!1,this._thickness)),this._attachedNode?this.gizmos.rotationGizmo.attachedNode=this._attachedNode:this.gizmos.rotationGizmo.attachedMesh=this._attachedMesh):this.gizmos.rotationGizmo&&(this.gizmos.rotationGizmo.attachedNode=null),this._gizmosEnabled.rotationGizmo=e},enumerable:!1,configurable:!0}),Object.defineProperty(d.prototype,"scaleGizmoEnabled",{get:function(){return this._gizmosEnabled.scaleGizmo},set:function(e){e?(this.gizmos.scaleGizmo=this.gizmos.scaleGizmo||new r.ScaleGizmo(this._defaultUtilityLayer,this._thickness),this._attachedNode?this.gizmos.scaleGizmo.attachedNode=this._attachedNode:this.gizmos.scaleGizmo.attachedMesh=this._attachedMesh):this.gizmos.scaleGizmo&&(this.gizmos.scaleGizmo.attachedNode=null),this._gizmosEnabled.scaleGizmo=e},enumerable:!1,configurable:!0}),Object.defineProperty(d.prototype,"boundingBoxGizmoEnabled",{get:function(){return this._gizmosEnabled.boundingBoxGizmo},set:function(e){e?(this.gizmos.boundingBoxGizmo=this.gizmos.boundingBoxGizmo||new a.BoundingBoxGizmo(this._boundingBoxColor,this._defaultKeepDepthUtilityLayer),this._attachedMesh?this.gizmos.boundingBoxGizmo.attachedMesh=this._attachedMesh:this.gizmos.boundingBoxGizmo.attachedNode=this._attachedNode,this._attachedMesh?(this._attachedMesh.removeBehavior(this.boundingBoxDragBehavior),this._attachedMesh.addBehavior(this.boundingBoxDragBehavior)):this._attachedNode&&(this._attachedNode.removeBehavior(this.boundingBoxDragBehavior),this._attachedNode.addBehavior(this.boundingBoxDragBehavior))):this.gizmos.boundingBoxGizmo&&(this._attachedMesh?this._attachedMesh.removeBehavior(this.boundingBoxDragBehavior):this._attachedNode&&this._attachedNode.removeBehavior(this.boundingBoxDragBehavior),this.gizmos.boundingBoxGizmo.attachedNode=null),this._gizmosEnabled.boundingBoxGizmo=e},enumerable:!1,configurable:!0}),d.prototype.dispose=function(){for(var e in this.scene.onPointerObservable.remove(this._pointerObserver),this.gizmos){var t=this.gizmos[e];t&&t.dispose()}this._defaultKeepDepthUtilityLayer.dispose(),this._defaultUtilityLayer.dispose(),this.boundingBoxDragBehavior.detach(),this.onAttachedToMeshObservable.clear()},d);function d(e,t){var i=this;void 0===t&&(t=1),this.scene=e,this.clearGizmoOnEmptyPointerEvent=!1,this.onAttachedToMeshObservable=new BABYLON.Observable,this.onAttachedToNodeObservable=new BABYLON.Observable,this._gizmosEnabled={positionGizmo:!1,rotationGizmo:!1,scaleGizmo:!1,boundingBoxGizmo:!1},this._pointerObserver=null,this._attachedMesh=null,this._attachedNode=null,this._boundingBoxColor=BABYLON.Color3.FromHexString("#0984e3"),this._thickness=1,this.boundingBoxDragBehavior=new BABYLON.SixDofDragBehavior,this.attachableMeshes=null,this.attachableNodes=null,this.usePointerToAttachGizmos=!0,this._defaultKeepDepthUtilityLayer=new l.UtilityLayerRenderer(e),this._defaultKeepDepthUtilityLayer.utilityLayerScene.autoClearDepthAndStencil=!1,this._defaultUtilityLayer=new l.UtilityLayerRenderer(e),this._thickness=t,this.gizmos={positionGizmo:null,rotationGizmo:null,scaleGizmo:null,boundingBoxGizmo:null},this._pointerObserver=e.onPointerObservable.add(function(e){var t,n;i.usePointerToAttachGizmos&&e.type==BABYLON.PointerEventTypes.POINTERDOWN&&(e.pickInfo&&0===e.event.button&&e.pickInfo.pickedMesh&&(t=e.pickInfo.pickedMesh)instanceof BABYLON.AbstractMesh?(n=editor.call("entities:get",t.id))?editor.call("selector:set","entity",[n]):console.error("失败"):i.clearGizmoOnEmptyPointerEvent&&s.GizmosCenter.clear())}),this.initialize()}n.GizmoManager=c},{".":58,"./UtilityLayerRenderer":50,"./boundingBoxGizmo":53,"./positionGizmo":62,"./rotationGizmo":63,"./scaleGizmo":64}],58:[function(e,t,n){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,n,i){void 0===i&&(i=n),Object.defineProperty(e,i,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,i){void 0===i&&(i=n),e[i]=t[n]}),o=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||t.hasOwnProperty(n)||i(t,e,n)};Object.defineProperty(n,"__esModule",{value:!0}),o(e("./axisDragGizmo"),n),o(e("./axisScaleGizmo"),n),o(e("./boundingBoxGizmo"),n),o(e("./gizmo"),n),o(e("./gizmoManager"),n),o(e("./planeRotationGizmo"),n),o(e("./positionGizmo"),n),o(e("./rotationGizmo"),n),o(e("./scaleGizmo"),n),o(e("./lightGizmo"),n),o(e("./cameraGizmo"),n),o(e("./planeDragGizmo"),n),o(e("./gizmo-center"),n)},{"./axisDragGizmo":51,"./axisScaleGizmo":52,"./boundingBoxGizmo":53,"./cameraGizmo":54,"./gizmo":56,"./gizmo-center":55,"./gizmoManager":57,"./lightGizmo":59,"./planeDragGizmo":60,"./planeRotationGizmo":61,"./positionGizmo":62,"./rotationGizmo":63,"./scaleGizmo":64}],59:[function(e,t,n){"use strict";var i,o=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0}),n.LightGizmo=void 0;var r,a=e("../middleware"),s=e("../utility"),l=e("./gizmo"),c=e("./UtilityLayerRenderer"),d=(r=l.Gizmo,o(u,r),Object.defineProperty(u.prototype,"light",{get:function(){return this._light},set:function(e){var t,n,i=this;(this._light=e)&&(this._lightMesh&&this._lightMesh.dispose(),e instanceof BABYLON.HemisphericLight?this._lightMesh=u._CreateHemisphericLightMesh(this.gizmoLayer.utilityLayerScene):e instanceof BABYLON.DirectionalLight?this._lightMesh=u._CreateDirectionalLightMesh(this.gizmoLayer.utilityLayerScene):e instanceof BABYLON.SpotLight?this._lightMesh=u._CreateSpotLightMesh(this.gizmoLayer.utilityLayerScene):this._lightMesh=u._CreatePointLightMesh(this.gizmoLayer.utilityLayerScene),this._lightMesh.getChildMeshes(!1).forEach(function(e){e.material=i._material}),this._lightMesh.parent=this._rootMesh,(t=this.gizmoLayer._getSharedGizmoLight()).includedOnlyMeshes=t.includedOnlyMeshes.concat(this._lightMesh.getChildMeshes(!1)),this._lightMesh.rotationQuaternion=new BABYLON.Quaternion,this.attachedMesh.reservedDataStore||(this.attachedMesh.reservedDataStore={}),this.attachedMesh.reservedDataStore.lightGizmo=this,e.parent&&this._attachedMeshParent.freezeWorldMatrix(),e.parent&&e.parent instanceof a.VeryLight?e instanceof BABYLON.HemisphericLight?(this.attachedMesh.position.copyFrom(e.parent.position),this.attachedMesh.computeWorldMatrix(!0),this._cachedPosition.copyFrom(this.attachedMesh.position),n=s.Tools.transformLocalToWorldDirection(e.parent,BABYLON.Vector3.Down()),this.attachedMesh.setDirection(n),this.attachedMesh.computeWorldMatrix(!0),this._cachedForward.copyFrom(this.attachedMesh.forward)):(e.position&&(this.attachedMesh.position.copyFrom(e.parent.position),this.attachedMesh.computeWorldMatrix(!0),this._cachedPosition.copyFrom(this.attachedMesh.position)),e.direction&&(n=s.Tools.transformLocalToWorldDirection(e,e.direction),this.attachedMesh.setDirection(n),this.attachedMesh.computeWorldMatrix(!0),this._cachedForward.copyFrom(this.attachedMesh.forward))):(e.position&&(this.attachedMesh.position.copyFrom(e.position),this.attachedMesh.computeWorldMatrix(!0),this._cachedPosition.copyFrom(this.attachedMesh.position)),e.direction&&(this.attachedMesh.setDirection(e.direction),this.attachedMesh.computeWorldMatrix(!0),this._cachedForward.copyFrom(this.attachedMesh.forward))),this._update())},enumerable:!1,configurable:!0}),Object.defineProperty(u.prototype,"material",{get:function(){return this._material},enumerable:!1,configurable:!0}),u.prototype._update=function(){var e;r.prototype._update.call(this),this._light&&(this._light.parent&&this._attachedMeshParent.freezeWorldMatrix(),this._light.parent&&this._light.parent instanceof a.VeryLight?this._light instanceof BABYLON.HemisphericLight?(this.attachedMesh.position.equals(this._cachedPosition)?(this.attachedMesh.position.copyFrom(this._light.parent.position),this.attachedMesh.computeWorldMatrix(!0)):this._light.parent.position.copyFrom(this.attachedMesh.position),this._cachedPosition.copyFrom(this.attachedMesh.position),e=s.Tools.transformLocalToWorldDirection(this._light.parent,BABYLON.Vector3.Up()),1e-4<BABYLON.Vector3.DistanceSquared(this.attachedMesh.forward,this._cachedForward)?this._cachedForward.copyFrom(this.attachedMesh.forward):1e-4<BABYLON.Vector3.DistanceSquared(this.attachedMesh.forward,e)&&(this.attachedMesh.setDirection(e),this.attachedMesh.computeWorldMatrix(!0),this._cachedForward.copyFrom(this.attachedMesh.forward),this.light.direction.copyFrom(this._light.parent.up))):(this._light.position&&(this.attachedMesh.position.equals(this._cachedPosition)?(this.attachedMesh.position.copyFrom(this._light.parent.position),this.attachedMesh.computeWorldMatrix(!0)):this._light.position.copyFrom(this.attachedMesh.position),this._cachedPosition.copyFrom(this.attachedMesh.position)),this._light.direction&&(e=s.Tools.transformLocalToWorldDirection(this._light,this._light.direction),1e-4<BABYLON.Vector3.DistanceSquared(this.attachedMesh.forward,this._cachedForward)?(console.log("light"),e.copyFrom(this.attachedMesh.forward),this._cachedForward.copyFrom(this.attachedMesh.forward)):1e-4<BABYLON.Vector3.DistanceSquared(this.attachedMesh.forward,e)&&(this.attachedMesh.setDirection(e),this.attachedMesh.computeWorldMatrix(!0),this._cachedForward.copyFrom(this.attachedMesh.forward)))):(this._light.position&&(this.attachedMesh.position.equals(this._cachedPosition)?(this.attachedMesh.position.copyFrom(this._light.position),this.attachedMesh.computeWorldMatrix(!0)):this._light.position.copyFrom(this.attachedMesh.position),this._cachedPosition.copyFrom(this.attachedMesh.position)),this._light.direction&&(1e-4<BABYLON.Vector3.DistanceSquared(this.attachedMesh.forward,this._cachedForward)?(this._light.direction.copyFrom(this.attachedMesh.forward),this._cachedForward.copyFrom(this.attachedMesh.forward)):1e-4<BABYLON.Vector3.DistanceSquared(this.attachedMesh.forward,this._light.direction)&&(this.attachedMesh.setDirection(this._light.direction),this.attachedMesh.computeWorldMatrix(!0),this._cachedForward.copyFrom(this.attachedMesh.forward)))))},u.prototype.dispose=function(){this.onClickedObservable.clear(),this.gizmoLayer.utilityLayerScene.onPointerObservable.remove(this._pointerObserver),this._material.dispose(),r.prototype.dispose.call(this),this._attachedMeshParent.dispose()},u._CreateHemisphericLightMesh=function(e){var t=new BABYLON.Mesh("hemisphereLight",e),n=BABYLON.HemisphereBuilder.CreateHemisphere(t.name,{segments:10,diameter:1},e);n.position.z=-.15,n.rotation.x=Math.PI/2,n.parent=t;var i=this._CreateLightLines(3,e);return i.parent=t,i.position.z,t.scaling.scaleInPlace(u._Scale),t.rotation.x=Math.PI/2,t},u._CreatePointLightMesh=function(e){var t=new BABYLON.Mesh("pointLight",e),n=BABYLON.SphereBuilder.CreateSphere(t.name,{segments:10,diameter:1},e);return n.rotation.x=Math.PI/2,n.parent=t,(this._CreateLightLines(5,e).parent=t).scaling.scaleInPlace(u._Scale),t.rotation.x=Math.PI/2,t},u._CreateSpotLightMesh=function(e){var t=new BABYLON.Mesh("spotLight",e);BABYLON.SphereBuilder.CreateSphere(t.name,{segments:10,diameter:1},e).parent=t;var n=BABYLON.HemisphereBuilder.CreateHemisphere(t.name,{segments:10,diameter:2},e);return n.parent=t,n.rotation.x=-Math.PI/2,(this._CreateLightLines(2,e).parent=t).scaling.scaleInPlace(u._Scale),t.rotation.x=Math.PI/2,t},u._CreateDirectionalLightMesh=function(e){var t=new BABYLON.Mesh("directionalLight",e),n=new BABYLON.Mesh(t.name,e);n.parent=t,BABYLON.SphereBuilder.CreateSphere(t.name,{diameter:1.2,segments:10},e).parent=n;var i=BABYLON.Mesh.CreateCylinder(t.name,6,.3,.3,6,1,e);i.parent=n;var o=i.clone(t.name);o.scaling.y=.5,o.position.x+=1.25;var r=i.clone(t.name);r.scaling.y=.5,r.position.x+=-1.25;var a=BABYLON.Mesh.CreateCylinder(t.name,1,0,.6,6,1,e);return a.position.y+=3,a.parent=n,(o=a.clone(t.name)).position.y=1.5,o.position.x+=1.25,(r=a.clone(t.name)).position.y=1.5,r.position.x+=-1.25,n.scaling.scaleInPlace(u._Scale),n.rotation.z=Math.PI/2,n.rotation.y=Math.PI/2,t},u._Scale=.007,u._CreateLightLines=function(e,t){var n=new BABYLON.Mesh("root",t);n.rotation.x=Math.PI/2;var i=new BABYLON.Mesh("linePivot",t);i.parent=n;var o=BABYLON.Mesh.CreateCylinder("line",2,.2,.3,6,1,t);if(o.position.y=o.scaling.y/2+1.2,o.parent=i,e<2)return i;for(var r=0;r<4;r++){(a=i.clone("lineParentClone")).rotation.z=Math.PI/4,a.rotation.y=Math.PI/2+Math.PI/2*r,a.getChildMeshes()[0].scaling.y=.5,a.getChildMeshes()[0].scaling.x=a.getChildMeshes()[0].scaling.z=.8,a.getChildMeshes()[0].position.y=a.getChildMeshes()[0].scaling.y/2+1.2}if(e<3)return n;for(r=0;r<4;r++){(a=i.clone("linePivotClone")).rotation.z=Math.PI/2,a.rotation.y=Math.PI/2*r}if(e<4)return n;for(var a,r=0;r<4;r++){(a=i.clone("linePivotClone")).rotation.z=Math.PI+Math.PI/4,a.rotation.y=Math.PI/2+Math.PI/2*r,a.getChildMeshes()[0].scaling.y=.5,a.getChildMeshes()[0].scaling.x=a.getChildMeshes()[0].scaling.z=.8,a.getChildMeshes()[0].position.y=a.getChildMeshes()[0].scaling.y/2+1.2}return e<5||((a=i.clone("linePivotClone")).rotation.z=Math.PI),n},u);function u(e){void 0===e&&(e=c.UtilityLayerRenderer.DefaultUtilityLayer);var n=r.call(this,e)||this;return n._cachedPosition=new BABYLON.Vector3,n._cachedForward=new BABYLON.Vector3(0,0,1),n._pointerObserver=null,n.onClickedObservable=new BABYLON.Observable,n._light=null,n.attachedMesh=new BABYLON.AbstractMesh("",n.gizmoLayer.utilityLayerScene),n._attachedMeshParent=new BABYLON.TransformNode("parent",n.gizmoLayer.utilityLayerScene),n.attachedMesh.parent=n._attachedMeshParent,n._material=new BABYLON.StandardMaterial("light",n.gizmoLayer.utilityLayerScene),n._material.diffuseColor=new BABYLON.Color3(.5,.5,.5),n._material.specularColor=new BABYLON.Color3(.1,.1,.1),n._pointerObserver=e.utilityLayerScene.onPointerObservable.add(function(e){var t;n._light&&e.pickInfo&&-1!=n._rootMesh.getChildMeshes().indexOf(e.pickInfo.pickedMesh)&&0===e.event.button&&(n._light.parent&&n._light.parent instanceof a.VeryLight&&((t=editor.call("entities:get",n._light.parent.id))?editor.call("selector:set","entity",[t]):console.error("失败")),n.onClickedObservable.notifyObservers(n._light))},BABYLON.PointerEventTypes.POINTERDOWN),n}n.LightGizmo=d},{"../middleware":85,"../utility":124,"./UtilityLayerRenderer":50,"./gizmo":56}],60:[function(e,t,n){"use strict";var i,o=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0}),n.PlaneDragGizmo=void 0;var u,r=e("./gizmo"),h=e("./UtilityLayerRenderer"),a=(u=r.Gizmo,o(p,u),p._CreatePlane=function(e,t){var n=new BABYLON.TransformNode("plane",e),i=BABYLON.PlaneBuilder.CreatePlane("dragPlane",{width:.1375,height:.1375,sideOrientation:2},e);return i.material=t,i.parent=n},p._CreateArrowInstance=function(e,t){for(var n=new BABYLON.TransformNode("arrow",e),i=0,o=t.getChildMeshes();i<o.length;i++){var r=o[i];r.createInstance(r.name).parent=n}return n},p.prototype._attachedNodeChanged=function(e){this.dragBehavior&&(this.dragBehavior.enabled=!!e)},Object.defineProperty(p.prototype,"isEnabled",{get:function(){return this._isEnabled},set:function(e){(this._isEnabled=e)?this._parent&&(this.attachedNode=this._parent.attachedNode):this.attachedNode=null},enumerable:!1,configurable:!0}),p.prototype.dispose=function(){this.onSnapObservable.clear(),this.gizmoLayer.utilityLayerScene.onPointerObservable.remove(this._pointerObserver),this.dragBehavior.detach(),u.prototype.dispose.call(this),this._plane&&this._plane.dispose(),[this._coloredMaterial,this._hoverMaterial].forEach(function(e){e&&e.dispose()})},p);function p(e,t,n,i){void 0===t&&(t=BABYLON.Color3.Gray()),void 0===n&&(n=h.UtilityLayerRenderer.DefaultUtilityLayer),void 0===i&&(i=null);var o=u.call(this,n)||this;o._pointerObserver=null,o.snapDistance=0,o.onSnapObservable=new BABYLON.Observable,o._isEnabled=!1,o._parent=null,o._parent=i,o._coloredMaterial=new BABYLON.StandardMaterial("",n.utilityLayerScene),o._coloredMaterial.diffuseColor=t,o._coloredMaterial.specularColor=t.subtract(new BABYLON.Color3(.1,.1,.1)),o._coloredMaterial.alpha=.5,o._hoverMaterial=new BABYLON.StandardMaterial("",n.utilityLayerScene),o._hoverMaterial.diffuseColor=t.add(new BABYLON.Color3(.3,.3,.3)),o._hoverMaterial.alpha=.4,o._plane=p._CreatePlane(n.utilityLayerScene,o._coloredMaterial),o._plane.lookAt(o._rootMesh.position.add(e)),o._plane.scaling.scaleInPlace(1/6),o._plane.parent=o._rootMesh,0<e.x?o._plane.position=new BABYLON.Vector3(0,.1375/12,.1375/12):0<e.y?o._plane.position=new BABYLON.Vector3(.1375/12,0,.1375/12):o._plane.position=new BABYLON.Vector3(.1375/12,.1375/12,0);var r=0,a=new BABYLON.Vector3,s={snapDistance:0};o.dragBehavior=new BABYLON.PointerDragBehavior({dragPlaneNormal:e}),o.dragBehavior.moveAttached=!1,o._rootMesh.addBehavior(o.dragBehavior);var l=new BABYLON.Vector3,c=new BABYLON.Matrix;o.dragBehavior.onDragObservable.add(function(e){var t;o.attachedNode&&(o.attachedNode.parent?(o.attachedNode.parent.computeWorldMatrix().invertToRef(c),c.setTranslationFromFloats(0,0,0),BABYLON.Vector3.TransformCoordinatesToRef(e.delta,c,l)):l.copyFrom(e.delta),0==o.snapDistance?o.attachedNode.getWorldMatrix().addTranslationFromFloats(l.x,l.y,l.z):(r+=e.dragDistance,Math.abs(r)>o.snapDistance&&(t=Math.floor(Math.abs(r)/o.snapDistance),r%=o.snapDistance,l.normalizeToRef(a),a.scaleInPlace(o.snapDistance*t),o.attachedNode.getWorldMatrix().addTranslationFromFloats(a.x,a.y,a.z),s.snapDistance=o.snapDistance*t,o.onSnapObservable.notifyObservers(s))),o._operationType="plane",o._matrixChanged())}),o._pointerObserver=n.utilityLayerScene.onPointerObservable.add(function(e){var t;o._customMeshSet||(t=e.pickInfo&&-1!=o._rootMesh.getChildMeshes().indexOf(e.pickInfo.pickedMesh)?o._hoverMaterial:o._coloredMaterial,o._rootMesh.getChildMeshes().forEach(function(e){e.material=t}))});var d=n._getSharedGizmoLight();return d.includedOnlyMeshes=d.includedOnlyMeshes.concat(o._rootMesh.getChildMeshes(!1)),o}n.PlaneDragGizmo=a},{"./UtilityLayerRenderer":50,"./gizmo":56}],61:[function(e,t,n){"use strict";var i,o=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0}),n.PlaneRotationGizmo=void 0;var u,r=e("./gizmo"),h=e("./UtilityLayerRenderer"),a=(u=r.Gizmo,o(s,u),s.prototype._attachedNodeChanged=function(e){this.dragBehavior&&(this.dragBehavior.enabled=!!e)},Object.defineProperty(s.prototype,"isEnabled",{get:function(){return this._isEnabled},set:function(e){(this._isEnabled=e)?this._parent&&(this.attachedMesh=this._parent.attachedMesh):this.attachedMesh=null},enumerable:!1,configurable:!0}),s.prototype.dispose=function(){this.onSnapObservable.clear(),this.gizmoLayer.utilityLayerScene.onPointerObservable.remove(this._pointerObserver),this.dragBehavior.detach(),u.prototype.dispose.call(this)},s);function s(f,e,m,t,n,i,o){void 0===e&&(e=BABYLON.Color3.Gray()),void 0===m&&(m=h.UtilityLayerRenderer.DefaultUtilityLayer),void 0===t&&(t=32),void 0===n&&(n=null),void 0===i&&(i=!1),void 0===o&&(o=1);var g=u.call(this,m)||this;g._pointerObserver=null,g.snapDistance=0,g.onSnapObservable=new BABYLON.Observable,g._isEnabled=!0,g._parent=null,g._parent=n;var r=new BABYLON.StandardMaterial("",m.utilityLayerScene);r.diffuseColor=e,r.specularColor=e.subtract(new BABYLON.Color3(.1,.1,.1));var a=new BABYLON.StandardMaterial("",m.utilityLayerScene);a.diffuseColor=e.add(new BABYLON.Color3(.3,.3,.3));var s=new BABYLON.AbstractMesh("",m.utilityLayerScene),l=BABYLON.Mesh.CreateTorus("",.6,.03*o,t,m.utilityLayerScene);l.visibility=0;var c=BABYLON.Mesh.CreateTorus("",.6,.005*o,t,m.utilityLayerScene);c.material=r,c.rotation.x=Math.PI/2,l.rotation.x=Math.PI/2,s.addChild(c),s.addChild(l),s.lookAt(g._rootMesh.position.add(f)),g._rootMesh.addChild(s),s.scaling.scaleInPlace(1/3),g.dragBehavior=new BABYLON.PointerDragBehavior({dragPlaneNormal:f}),g.dragBehavior.moveAttached=!1,g.dragBehavior.maxDragAngle=9*Math.PI/20,g.dragBehavior._useAlternatePickedPointAboveMaxDragAngle=!0,g._rootMesh.addBehavior(g.dragBehavior);var y=new BABYLON.Vector3;g.dragBehavior.onDragStartObservable.add(function(e){g.attachedNode&&y.copyFrom(e.dragPlanePoint)});var v=new BABYLON.Matrix,b=new BABYLON.Vector3,_=new BABYLON.Vector3,w={snapDistance:0},x=0,O=new BABYLON.Matrix,B=new BABYLON.Quaternion;g.dragBehavior.onDragObservable.add(function(e){var t,n,i,o,r,a,s,l,c,d,u,h,p;g.attachedNode&&(t=new BABYLON.Vector3(1,1,1),n=new BABYLON.Quaternion(0,0,0,1),i=new BABYLON.Vector3(0,0,0),g.attachedNode.getWorldMatrix().decompose(t,n,i),o=e.dragPlanePoint.subtract(i).normalize(),r=y.subtract(i).normalize(),a=BABYLON.Vector3.Cross(o,r),s=BABYLON.Vector3.Dot(o,r),l=Math.atan2(a.length(),s),b.copyFrom(f),_.copyFrom(f),g.updateGizmoRotationToMatchAttachedMesh&&(n.toRotationMatrix(v),_=BABYLON.Vector3.TransformCoordinates(b,v)),m.utilityLayerScene.activeCamera&&(c=m.utilityLayerScene.activeCamera.position.subtract(i),0<BABYLON.Vector3.Dot(c,_)&&(b.scaleInPlace(-1),_.scaleInPlace(-1))),0<BABYLON.Vector3.Dot(_,a)&&(l=-l),d=!1,0!=g.snapDistance&&(x+=l,Math.abs(x)>g.snapDistance?(u=Math.floor(Math.abs(x)/g.snapDistance),x<0&&(u*=-1),x%=g.snapDistance,l=g.snapDistance*u,d=!0):l=0),h=Math.sin(l/2),B.set(b.x*h,b.y*h,b.z*h,Math.cos(l/2)),0<O.determinant()&&(p=new BABYLON.Vector3,B.toEulerAnglesToRef(p),BABYLON.Quaternion.RotationYawPitchRollToRef(p.y,-p.x,-p.z,B)),g.updateGizmoRotationToMatchAttachedMesh?n.multiplyToRef(B,n):B.multiplyToRef(n,n),g.attachedNode.getWorldMatrix().copyFrom(BABYLON.Matrix.Compose(t,n,i)),y.copyFrom(e.dragPlanePoint),d&&(w.snapDistance=l,g.onSnapObservable.notifyObservers(w)),g._operationType="rotate",g._matrixChanged())}),g._pointerObserver=m.utilityLayerScene.onPointerObservable.add(function(e){var t;g._customMeshSet||(t=e.pickInfo&&-1!=g._rootMesh.getChildMeshes().indexOf(e.pickInfo.pickedMesh)?a:r,g._rootMesh.getChildMeshes().forEach(function(e){e.material=t,e.color&&(e.color=t.diffuseColor)}))});var d=m._getSharedGizmoLight();return d.includedOnlyMeshes=d.includedOnlyMeshes.concat(g._rootMesh.getChildMeshes(!1)),g}n.PlaneRotationGizmo=a},{"./UtilityLayerRenderer":50,"./gizmo":56}],62:[function(e,t,n){"use strict";var i,o=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0}),n.PositionGizmo=void 0;var r,a=e("./gizmo"),s=e("./axisDragGizmo"),l=e("./planeDragGizmo"),c=e("./UtilityLayerRenderer"),d=(r=a.Gizmo,o(u,r),Object.defineProperty(u.prototype,"attachedMesh",{get:function(){return this._meshAttached},set:function(t){this._meshAttached=t,this._nodeAttached=t,[this.xGizmo,this.yGizmo,this.zGizmo,this.xPlaneGizmo,this.yPlaneGizmo,this.zPlaneGizmo].forEach(function(e){e.isEnabled?e.attachedMesh=t:e.attachedMesh=null})},enumerable:!1,configurable:!0}),Object.defineProperty(u.prototype,"attachedNode",{get:function(){return this._nodeAttached},set:function(t){this._meshAttached=null,this._nodeAttached=null,[this.xGizmo,this.yGizmo,this.zGizmo,this.xPlaneGizmo,this.yPlaneGizmo,this.zPlaneGizmo].forEach(function(e){e.isEnabled?e.attachedNode=t:e.attachedNode=null})},enumerable:!1,configurable:!0}),u.prototype.initialize=function(){var t=this;editor.on("gizmo:coordSystem",function(e){t.coordSystem!==e&&(t.coordSystem=e,"world"===t.coordSystem?t.updateGizmoRotationToMatchAttachedMesh=!1:t.updateGizmoRotationToMatchAttachedMesh=!0)})},Object.defineProperty(u.prototype,"planarGizmoEnabled",{get:function(){return this._planarGizmoEnabled},set:function(t){var n=this;this._planarGizmoEnabled=t,[this.xPlaneGizmo,this.yPlaneGizmo,this.zPlaneGizmo].forEach(function(e){e&&(e.isEnabled=t)&&(e.attachedMesh?e.attachedMesh=n.attachedMesh:e.attachedNode=n.attachedNode)},this)},enumerable:!1,configurable:!0}),Object.defineProperty(u.prototype,"updateGizmoRotationToMatchAttachedMesh",{get:function(){return this._updateGizmoRotationToMatchAttachedMesh},set:function(t){this._updateGizmoRotationToMatchAttachedMesh=t,[this.xGizmo,this.yGizmo,this.zGizmo,this.xPlaneGizmo,this.yPlaneGizmo,this.zPlaneGizmo].forEach(function(e){e&&(e.updateGizmoRotationToMatchAttachedMesh=t)})},enumerable:!1,configurable:!0}),Object.defineProperty(u.prototype,"snapDistance",{get:function(){return this._snapDistance},set:function(t){this._snapDistance=t,[this.xGizmo,this.yGizmo,this.zGizmo,this.xPlaneGizmo,this.yPlaneGizmo,this.zPlaneGizmo].forEach(function(e){e&&(e.snapDistance=t)})},enumerable:!1,configurable:!0}),Object.defineProperty(u.prototype,"scaleRatio",{get:function(){return this._scaleRatio},set:function(t){this._scaleRatio=t,[this.xGizmo,this.yGizmo,this.zGizmo,this.xPlaneGizmo,this.yPlaneGizmo,this.zPlaneGizmo].forEach(function(e){e&&(e.scaleRatio=t)})},enumerable:!1,configurable:!0}),u.prototype.dispose=function(){[this.xGizmo,this.yGizmo,this.zGizmo,this.xPlaneGizmo,this.yPlaneGizmo,this.zPlaneGizmo].forEach(function(e){e&&e.dispose()}),this.onDragStartObservable.clear(),this.onDragEndObservable.clear()},u.prototype.setCustomMesh=function(e){BABYLON.Logger.Error("Custom meshes are not supported on this gizmo, please set the custom meshes on the gizmos contained within this one (gizmo.xGizmo, gizmo.yGizmo, gizmo.zGizmo,gizmo.xPlaneGizmo, gizmo.yPlaneGizmo, gizmo.zPlaneGizmo)")},u);function u(e,t){void 0===e&&(e=c.UtilityLayerRenderer.DefaultUtilityLayer),void 0===t&&(t=1);var n=r.call(this,e)||this;return n._meshAttached=null,n._nodeAttached=null,n.onDragStartObservable=new BABYLON.Observable,n.onDragEndObservable=new BABYLON.Observable,n._planarGizmoEnabled=!1,n.coordSystem="local",n.xGizmo=new s.AxisDragGizmo(new BABYLON.Vector3(1,0,0),BABYLON.Color3.Red().scale(.5),e,n,t),n.yGizmo=new s.AxisDragGizmo(new BABYLON.Vector3(0,1,0),BABYLON.Color3.Green().scale(.5),e,n,t),n.zGizmo=new s.AxisDragGizmo(new BABYLON.Vector3(0,0,1),BABYLON.Color3.Blue().scale(.5),e,n,t),n.xPlaneGizmo=new l.PlaneDragGizmo(new BABYLON.Vector3(1,0,0),BABYLON.Color3.Red().scale(.5),n.gizmoLayer,n),n.yPlaneGizmo=new l.PlaneDragGizmo(new BABYLON.Vector3(0,1,0),BABYLON.Color3.Green().scale(.5),n.gizmoLayer,n),n.zPlaneGizmo=new l.PlaneDragGizmo(new BABYLON.Vector3(0,0,1),BABYLON.Color3.Blue().scale(.5),n.gizmoLayer,n),n.onDragEndObservable.add(function(){}),[n.xGizmo,n.yGizmo,n.zGizmo,n.xPlaneGizmo,n.yPlaneGizmo,n.zPlaneGizmo].forEach(function(e){e.dragBehavior.onDragStartObservable.add(function(){n.onDragStartObservable.notifyObservers({})}),e.dragBehavior.onDragEndObservable.add(function(){n.onDragEndObservable.notifyObservers({})})}),n.planarGizmoEnabled=!0,n.attachedMesh=null,n.initialize(),n}n.PositionGizmo=d},{"./UtilityLayerRenderer":50,"./axisDragGizmo":51,"./gizmo":56,"./planeDragGizmo":60}],63:[function(e,t,n){"use strict";var i,o=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0}),n.RotationGizmo=void 0;var r,a=e("./gizmo"),s=e("./planeRotationGizmo"),l=e("./UtilityLayerRenderer"),c=(r=a.Gizmo,o(d,r),Object.defineProperty(d.prototype,"attachedMesh",{get:function(){return this._meshAttached},set:function(t){this._meshAttached=t,this._nodeAttached=t,[this.xGizmo,this.yGizmo,this.zGizmo].forEach(function(e){e.isEnabled?e.attachedMesh=t:e.attachedMesh=null})},enumerable:!1,configurable:!0}),Object.defineProperty(d.prototype,"attachedNode",{get:function(){return this._nodeAttached},set:function(t){this._meshAttached=null,this._nodeAttached=t,[this.xGizmo,this.yGizmo,this.zGizmo].forEach(function(e){e.isEnabled?e.attachedNode=t:e.attachedNode=null})},enumerable:!1,configurable:!0}),d.prototype.initialize=function(){var t=this;editor.on("gizmo:coordSystem",function(e){t.coordSystem!==e&&(t.coordSystem=e,"world"===t.coordSystem?t.updateGizmoRotationToMatchAttachedMesh=!1:t.updateGizmoRotationToMatchAttachedMesh=!0)})},Object.defineProperty(d.prototype,"updateGizmoRotationToMatchAttachedMesh",{get:function(){return this.xGizmo.updateGizmoRotationToMatchAttachedMesh},set:function(e){this.xGizmo&&(this.xGizmo.updateGizmoRotationToMatchAttachedMesh=e,this.yGizmo.updateGizmoRotationToMatchAttachedMesh=e,this.zGizmo.updateGizmoRotationToMatchAttachedMesh=e)},enumerable:!1,configurable:!0}),Object.defineProperty(d.prototype,"snapDistance",{get:function(){return this.xGizmo.snapDistance},set:function(e){this.xGizmo&&(this.xGizmo.snapDistance=e,this.yGizmo.snapDistance=e,this.zGizmo.snapDistance=e)},enumerable:!1,configurable:!0}),Object.defineProperty(d.prototype,"scaleRatio",{get:function(){return this.xGizmo.scaleRatio},set:function(e){this.xGizmo&&(this.xGizmo.scaleRatio=e,this.yGizmo.scaleRatio=e,this.zGizmo.scaleRatio=e)},enumerable:!1,configurable:!0}),d.prototype.dispose=function(){this.xGizmo.dispose(),this.yGizmo.dispose(),this.zGizmo.dispose(),this.onDragStartObservable.clear(),this.onDragEndObservable.clear()},d.prototype.setCustomMesh=function(e){BABYLON.Logger.Error("Custom meshes are not supported on this gizmo, please set the custom meshes on the gizmos contained within this one (gizmo.xGizmo, gizmo.yGizmo, gizmo.zGizmo)")},d);function d(e,t,n,i){void 0===e&&(e=l.UtilityLayerRenderer.DefaultUtilityLayer),void 0===t&&(t=32),void 0===n&&(n=!1),void 0===i&&(i=1);var o=r.call(this,e)||this;return o.onDragStartObservable=new BABYLON.Observable,o.onDragEndObservable=new BABYLON.Observable,o.coordSystem="local",o.xGizmo=new s.PlaneRotationGizmo(new BABYLON.Vector3(1,0,0),BABYLON.Color3.Red().scale(.5),e,t,o,n,i),o.yGizmo=new s.PlaneRotationGizmo(new BABYLON.Vector3(0,1,0),BABYLON.Color3.Green().scale(.5),e,t,o,n,i),o.zGizmo=new s.PlaneRotationGizmo(new BABYLON.Vector3(0,0,1),BABYLON.Color3.Blue().scale(.5),e,t,o,n,i),[o.xGizmo,o.yGizmo,o.zGizmo].forEach(function(e){e.dragBehavior.onDragStartObservable.add(function(){o.onDragStartObservable.notifyObservers({})}),e.dragBehavior.onDragEndObservable.add(function(){o.onDragEndObservable.notifyObservers({})})}),o.attachedMesh=null,o.attachedNode=null,o.initialize(),o}n.RotationGizmo=c},{"./UtilityLayerRenderer":50,"./gizmo":56,"./planeRotationGizmo":61}],64:[function(e,t,n){"use strict";var i,o=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0}),n.ScaleGizmo=void 0;var r,a=e("./gizmo"),s=e("./axisScaleGizmo"),l=e("./UtilityLayerRenderer"),c=(r=a.Gizmo,o(d,r),Object.defineProperty(d.prototype,"attachedMesh",{get:function(){return this._meshAttached},set:function(t){this._meshAttached=t,this._nodeAttached=t,[this.xGizmo,this.yGizmo,this.zGizmo,this.uniformScaleGizmo].forEach(function(e){e.isEnabled?e.attachedMesh=t:e.attachedMesh=null})},enumerable:!1,configurable:!0}),Object.defineProperty(d.prototype,"attachedNode",{get:function(){return this._nodeAttached},set:function(t){this._meshAttached=null,this._nodeAttached=t,[this.xGizmo,this.yGizmo,this.zGizmo,this.uniformScaleGizmo].forEach(function(e){e.isEnabled?e.attachedNode=t:e.attachedNode=null})},enumerable:!1,configurable:!0}),d.prototype.initialize=function(){var t=this;editor.on("gizmo:coordSystem",function(e){t.coordSystem!==e&&(t.coordSystem=e)})},Object.defineProperty(d.prototype,"updateGizmoRotationToMatchAttachedMesh",{get:function(){return this._updateGizmoRotationToMatchAttachedMesh},set:function(t){t?(this._updateGizmoRotationToMatchAttachedMesh=t,[this.xGizmo,this.yGizmo,this.zGizmo,this.uniformScaleGizmo].forEach(function(e){e&&(e.updateGizmoRotationToMatchAttachedMesh=t)})):BABYLON.Logger.Warn("Setting updateGizmoRotationToMatchAttachedMesh = false on scaling gizmo is not supported.")},enumerable:!1,configurable:!0}),Object.defineProperty(d.prototype,"snapDistance",{get:function(){return this._snapDistance},set:function(t){this._snapDistance=t,[this.xGizmo,this.yGizmo,this.zGizmo,this.uniformScaleGizmo].forEach(function(e){e&&(e.snapDistance=t)})},enumerable:!1,configurable:!0}),Object.defineProperty(d.prototype,"scaleRatio",{get:function(){return this._scaleRatio},set:function(t){this._scaleRatio=t,[this.xGizmo,this.yGizmo,this.zGizmo,this.uniformScaleGizmo].forEach(function(e){e&&(e.scaleRatio=t)})},enumerable:!1,configurable:!0}),Object.defineProperty(d.prototype,"sensitivity",{get:function(){return this._sensitivity},set:function(t){this._sensitivity=t,[this.xGizmo,this.yGizmo,this.zGizmo,this.uniformScaleGizmo].forEach(function(e){e&&(e.sensitivity=t)})},enumerable:!1,configurable:!0}),d.prototype.dispose=function(){[this.xGizmo,this.yGizmo,this.zGizmo,this.uniformScaleGizmo].forEach(function(e){e&&e.dispose()}),this.onDragStartObservable.clear(),this.onDragEndObservable.clear(),[this._uniformScalingMesh,this._octahedron].forEach(function(e){e&&e.dispose()})},d);function d(e,t){void 0===e&&(e=l.UtilityLayerRenderer.DefaultUtilityLayer),void 0===t&&(t=1);var n=r.call(this,e)||this;n._meshAttached=null,n._nodeAttached=null,n._sensitivity=1,n.onDragStartObservable=new BABYLON.Observable,n.onDragEndObservable=new BABYLON.Observable,n.coordSystem="local",n.xGizmo=new s.AxisScaleGizmo(new BABYLON.Vector3(1,0,0),BABYLON.Color3.Red().scale(.5),e,n,t),n.yGizmo=new s.AxisScaleGizmo(new BABYLON.Vector3(0,1,0),BABYLON.Color3.Green().scale(.5),e,n,t),n.zGizmo=new s.AxisScaleGizmo(new BABYLON.Vector3(0,0,1),BABYLON.Color3.Blue().scale(.5),e,n,t),n.uniformScaleGizmo=new s.AxisScaleGizmo(new BABYLON.Vector3(0,1,0),BABYLON.Color3.Yellow().scale(.5),e,n),n.uniformScaleGizmo.updateGizmoRotationToMatchAttachedMesh=!1,n.uniformScaleGizmo.uniformScaling=!0,n._uniformScalingMesh=BABYLON.PolyhedronBuilder.CreatePolyhedron("",{type:1},n.uniformScaleGizmo.gizmoLayer.utilityLayerScene),n._uniformScalingMesh.scaling.scaleInPlace(.02),n._uniformScalingMesh.visibility=0,n._octahedron=BABYLON.PolyhedronBuilder.CreatePolyhedron("",{type:1},n.uniformScaleGizmo.gizmoLayer.utilityLayerScene),n._octahedron.scaling.scaleInPlace(.007),n._uniformScalingMesh.addChild(n._octahedron),n.uniformScaleGizmo.setCustomMesh(n._uniformScalingMesh,!0);var i=e._getSharedGizmoLight();return i.includedOnlyMeshes=i.includedOnlyMeshes.concat(n._octahedron),[n.xGizmo,n.yGizmo,n.zGizmo,n.uniformScaleGizmo].forEach(function(e){e.dragBehavior.onDragStartObservable.add(function(){n.onDragStartObservable.notifyObservers({})}),e.dragBehavior.onDragEndObservable.add(function(){n.onDragEndObservable.notifyObservers({})})}),n.attachedMesh=null,n.attachedNode=null,n.initialize(),n}n.ScaleGizmo=c},{"./UtilityLayerRenderer":50,"./axisScaleGizmo":52,"./gizmo":56}],65:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.Config=void 0;var i=(o.projectID="projectID",o.sceneIndex=0,o.sceneID="sceneID",o.isSceneDirty=!1,o.x=4,o.y=291,o.width=444,o.height=250,o.tableAssetsID="",o.assetStandard='{"assets":{},"geometry":{},"babylon":{"path":{}},"babylon_resource":{}}',o.sceneStandard='{"scenes":[{"id":"33a884dd","projectId":"2af1e58b","name":"新建场景","created":"2020-07-04 18:00","modified":"2020-07-04 18:00","entities":{"799f7762-3ef2-4564-a59b-c0ae959a90ce":{"name":"新建场景","type":"root","root":true,"parent":null,"resource_id":"799f7762-3ef2-4564-a59b-c0ae959a90ce","tags":[],"enabled":true,"scale":[1,1,1],"position":[0,0,0],"rotation":[0,0,0],"children":["5e7ecc24-75b7-445a-b381-a66bd7699163","3109cca1-b962-4fd5-a83a-0b28719d2616","3e8d0d21-726a-427d-bf34-7baaebdff54c"],"asset_id":"","babylon_id":""},"5e7ecc24-75b7-445a-b381-a66bd7699163":{"name":"主相机","type":"camera","parent":"799f7762-3ef2-4564-a59b-c0ae959a90ce","resource_id":"5e7ecc24-75b7-445a-b381-a66bd7699163","tags":[],"enabled":true,"scale":[1,1,1],"position":[0,100,-200],"rotation":[0,0,0],"mode":0,"fov":0.8,"inertia":0.9,"orthoSize":0.5,"children":[],"ellipsoid":[0.5,1,0.5],"ellipsoidOffset":[0,0,0],"checkCollisions":true,"applyGravity":true,"minZ":1,"maxZ":20000,"priority":0,"viewport":[0,0,1,1],"clearColor":[0.176,0.569,0.729,1]},"3109cca1-b962-4fd5-a83a-0b28719d2616":{"name":"环境光","type":"light","parent":"799f7762-3ef2-4564-a59b-c0ae959a90ce","resource_id":"3109cca1-b962-4fd5-a83a-0b28719d2616","tags":[],"subtype":"hemispheric","enabled":true,"position":[300,300,300],"rotation":[0,0,0],"scale":[1,1,1],"children":[]},"3e8d0d21-726a-427d-bf34-7baaebdff54c":{"name":"立方体","type":"primitive","subtype":"box","resource_id":"3e8d0d21-726a-427d-bf34-7baaebdff54c","babylon_id":"","asset_id":"","parent":"799f7762-3ef2-4564-a59b-c0ae959a90ce","position":[0,0,0],"rotation":[0,0,0],"scale":[1,1,1],"children":[],"enabled":true,"checkCollisions":false,"pickable":true,"isVisible":true,"tags":[],"material_id":""}}}],"last":0}',o.tableStandard='{"table":[["对象/模板对象","触发激活条件","触发名","触发参数","逻辑条件","变量定义/状态定义和赋值","响应名","响应参数/变量赋值","关联状态"],["","","","","","","","",""],["","","","","","","","",""],["","","","","","","","",""],["","","","","","","","",""],["","","","","","","","",""],["","","","","","","","",""],["","","","","","","","",""],["","","","","","","","",""],["","","","","","","","",""],["","","","","","","","",""],["","","","","","","","",""],["","","","","","","","",""],["","","","","","","","",""],["","","","","","","","",""],["","","","","","","","",""],["","","","","","","","",""],["","","","","","","","",""],["","","","","","","","",""],["","","","","","","","",""],["","","","","","","","",""],["","","","","","","","",""],["","","","","","","","",""],["","","","","","","","",""],["","","","","","","","",""],["","","","","","","","",""],["","","","","","","","",""],["","","","","","","","",""],["","","","","","","","",""],["","","","","","","","",""],["","","","","","","","",""],["","","","","","","","",""],["","","","","","","","",""],["","","","","","","","",""],["","","","","","","","",""],["","","","","","","","",""],["","","","","","","","",""],["","","","","","","","",""],["","","","","","","","",""],["","","","","","","","",""],["","","","","","","","",""],["","","","","","","","",""],["","","","","","","","",""],["","","","","","","","",""],["","","","","","","","",""],["","","","","","","","",""],["","","","","","","","",""]]}',o);function o(){}n.Config=i},{}],66:[function(e,t,n){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,n,i){void 0===i&&(i=n),Object.defineProperty(e,i,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,i){void 0===i&&(i=n),e[i]=t[n]}),o=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||t.hasOwnProperty(n)||i(t,e,n)};Object.defineProperty(n,"__esModule",{value:!0}),o(e("./config"),n)},{"./config":65}],67:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.GUIManager=void 0;var i=(o.add2DCanvas=function(e,t){this._2dCanvasGroup.push(t),this._2dCanvasGroupID.push(e),this._2dCanvasGroupDic[e]=t},o.getActiveCanvas=function(){return o._2dCanvasGroup&&0<o._2dCanvasGroup.length?o._2dCanvasGroup[o._2dCanvasGroup.length-1]:null},o.getActiveID=function(){return o._2dCanvasGroupID&&0<o._2dCanvasGroupID.length?o._2dCanvasGroupID[o._2dCanvasGroupID.length-1]:""},o.getCanvasFromIndex=function(e){return o._2dCanvasGroup&&0<o._2dCanvasGroup.length&&0<=e&&e<o._2dCanvasGroup.length?o._2dCanvasGroup[e]:null},o.addUniqueIDIndex=function(e,t){o._uniqueID2resourceID[e]=t},o.getResourceID=function(e){return o._uniqueID2resourceID[e]?o._uniqueID2resourceID[e]:""},o.dragAllow=function(e,t,n,i){return!1},o._2dCanvasGroup=[],o._2dCanvasGroupID=[],o._2dCanvasGroupDic={},o._uniqueID2resourceID={},o);function o(){}n.GUIManager=i},{}],68:[function(e,t,n){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,n,i){void 0===i&&(i=n),Object.defineProperty(e,i,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,i){void 0===i&&(i=n),e[i]=t[n]}),o=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||t.hasOwnProperty(n)||i(t,e,n)};Object.defineProperty(n,"__esModule",{value:!0}),o(e("./gui-manager"),n),o(e("./keeper"),n)},{"./gui-manager":67,"./keeper":69}],69:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.GUIKeeper=void 0;function i(){}n.GUIKeeper=i},{}],70:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.HierarchyContextMenu=void 0;var i=e("../../ui"),o=(r.prototype.initMenu=function(){var e=this,t={};t["new-empty"]={title:"创建空物体",className:"menu-item-new-entity",icon:"&#57632;",select:function(){editor.call("entities:editor:new",{parent:e.items[0],type:"empty",subtype:""})}},t["add-primitive"]={title:"创建3D物体",className:"menu-item-primitive-sub-menu",icon:"&#57736;",items:{"add-new-box":{title:"立方体",className:"menu-item-add-box-primitive",icon:"&#57736;",select:function(){editor.call("entities:editor:new",{parent:e.items[0],type:"primitive",subtype:"box"})}},"add-new-sphere":{title:"球",className:"menu-item-add-sphere-primitive",icon:"&#57736;",select:function(){editor.call("entities:editor:new",{parent:e.items[0],type:"primitive",subtype:"sphere"})}},"add-new-plane":{title:"平面",className:"menu-item-add-plane-primitive",icon:"&#57736;",select:function(){editor.call("entities:editor:new",{parent:e.items[0],type:"primitive",subtype:"plane"})}},"add-new-cylinder":{title:"圆柱体",className:"menu-item-add-cylinder-primitive",icon:"&#57736;",select:function(){editor.call("entities:editor:new",{parent:e.items[0],type:"primitive",subtype:"cylinder"})}}}},t["add-new-light"]={title:"创建灯光",className:"menu-item-light-sub-menu",icon:"&#57748;",filter:function(){return!1},items:{"add-new-hemispheric":{title:"环境光",className:"menu-item-add-directional-light",icon:"&#57748;",select:function(){editor.call("entities:editor:new",{parent:e.items[0],type:"light",subtype:"hemispheric"})}},"add-new-directional":{title:"平行光",className:"menu-item-add-directional-light",icon:"&#57746;",select:function(){editor.call("entities:editor:new",{parent:e.items[0],type:"light",subtype:"directional"})}},"add-new-point":{title:"点光源",className:"menu-item-add-point-light",icon:"&#57745;",select:function(){editor.call("entities:editor:new",{parent:e.items[0],type:"light",subtype:"point"})}},"add-new-spot":{title:"聚光灯",className:"menu-item-add-spot-light",icon:"&#57747;",select:function(){editor.call("entities:editor:new",{parent:e.items[0],type:"light",subtype:"spot"})}}}},t["add-new-camera"]={title:"创建摄像机",className:"menu-item-add-camera",icon:"&#57874;",filter:function(){return!1},select:function(){editor.call("entities:editor:new",{parent:e.items[0],type:"camera",subtype:""})}},t["add-new-2d-gui"]={title:"创建2D界面",className:"menu-item-add-2d-gui",icon:"&#58371;",items:{"add-new-2d-canvas":{title:"2D画布",className:"menu-item-add-2d-canvas",icon:"&#58232;",select:function(){editor.call("entities:2D-GUI:new",{parent:e.items[0],type:"2d-gui",subtype:"root"})}},"add-new-panel":{title:"容器",className:"menu-item-add-panel",icon:"&#58232;",select:function(){editor.call("entities:2D-GUI:new",{parent:e.items[0],type:"2d-gui",subtype:"panel"})}},"add-new-button":{title:"按钮",className:"menu-item-add-button",icon:"&#58373;",select:function(){editor.call("entities:2D-GUI:new",{parent:e.items[0],type:"2d-gui",subtype:"button"})}},"add-new-image":{title:"图片",className:"menu-item-add-image",icon:"&#58005;",select:function(){editor.call("entities:2D-GUI:new",{parent:e.items[0],type:"2d-gui",subtype:"image"})}},"add-new-text":{title:"文字",className:"menu-item-add-text",icon:"&#58374;",select:function(){editor.call("entities:2D-GUI:new",{parent:e.items[0],type:"2d-gui",subtype:"text"})}},"add-new-input":{title:"输入框",className:"menu-item-add-input",icon:"&#58374;",select:function(){editor.call("entities:2D-GUI:new",{parent:e.items[0],type:"2d-gui",subtype:"input"})}},"add-new-checkbox":{title:"复选框",className:"menu-item-add-checkbox",icon:"&#57910;",select:function(){editor.call("entities:2D-GUI:new",{parent:e.items[0],type:"2d-gui",subtype:"checkbox"})}}}},t.duplicate={title:"创建副本",className:"menu-item-duplicate",icon:"&#57638;",filter:function(){return!1}},t.delete={title:"删除",className:"menu-item-delete",icon:"&#57636;",select:function(){editor.call("entities:delete",e.items)}},this.menu=i.Menu.fromData(t,{clickableSubmenus:this.clickableSubmenus}),this.root.append(this.menu)},r.prototype.getSelection=function(){var e=editor.call("selector:items");return-1!==e.indexOf(this.entity)?e:[this.entity]},r.prototype.initFunction=function(){var o=this;editor.method("entities:contextmenu:open",function(e,t,n,i){if(o.menu)return o.entity=e,o.items=i?[]:o.getSelection(),o.menu.open=!0,o.menu.position(t+1,n),!0}),editor.method("entities:contextmenu:entity",function(){return o.entity}),editor.on("entities:add",function(t){var e=editor.call("entities:panel:get",t.get("resource_id"));e&&e.element.addEventListener("contextmenu",function(e){editor.call("entities:contextmenu:open",t,e.clientX,e.clientY)&&(e.preventDefault(),e.stopPropagation())})})},r);function r(){this.customMenuItems=[],this.items=[],this.root=editor.call("layout.root"),this.clickableSubmenus=/clickableContextSubmenus=true/.test(location.search),this.initMenu(),this.initFunction()}n.HierarchyContextMenu=o},{"../../ui":162}],71:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.HierarchyControl=void 0;function i(){var e=l.VeryEngine.root,t=l.VeryEngine.hierarchy,n=new c.TopElementContainer({flex:!0,flexDirection:"row",alignItems:"center"});n.class.add("hierarchy-controls"),t.header.append(n);var i=new c.Button("&#57632;");i.class.add("add"),i.on("click",function(){}),n.append(i),c.Tooltip.attach({target:i.element,text:"添加",align:"top",root:e}),editor.on("attributes:clear",function(){o.disabled=!0,a.disabled=!0,s.class.add("innactive"),r.class.add("innactive")});var o=new c.Button("&#57638;");o.disabled=!0,o.class.add("duplicate"),o.on("click",function(){var e=editor.call("selector:type"),t=editor.call("selector:items");"entity"===e&&t.length&&editor.call("entities:duplicate",t)}),n.append(o);var r=c.Tooltip.attach({target:o.element,text:"复制",align:"top",root:e});r.class.add("innactive");var a=new c.Button("&#57636;");a.class.add("delete"),a.style.fontWeight="200",a.on("click",function(){"entity"===editor.call("selector:type")&&editor.call("entities:delete",editor.call("selector:items"))}),n.append(a);var s=c.Tooltip.attach({target:a.element,text:"删除",align:"top",root:e});s.class.add("innactive"),editor.on("attributes:inspect[*]",function(e,t){var n=editor.call("entities:root");"entity"===e&&t[0]!==n?(a.enabled=!0,o.enabled=!0,s.class.remove("innactive"),r.class.remove("innactive")):(a.enabled=!1,o.enabled=!1,s.class.add("innactive"),r.class.add("innactive"))})}var l=e("../../engine"),c=e("../../ui");n.HierarchyControl=i},{"../../engine":139,"../../ui":162}],72:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.HierarchyMenu=void 0;function i(){editor.call("components:logos")}n.HierarchyMenu=i},{}],73:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.HierarchyPanel=void 0;function i(){this.uiItemIndex={};var c=this,n=f.VeryEngine.hierarchy,d=new p.Tree;function e(){t=!1,d.element.style.width="",d.element.style.width=n.content.dom.scrollWidth-5+"px"}function u(){t||(t=!0,requestAnimationFrame(e))}(f.VeryEngine.hierarchyTree=d).draggable=d.allowRenaming,d.class.add("hierarchy"),n.append(d);var t=!1;n.on("resize",u),d.on("open",u),d.on("close",u),setInterval(u,1e3),editor.method("entities:hierarchy",function(){return d}),d.on("select",function(e){for(var t=e.parent;t&&t instanceof p.TreeItem;)t.open=!0,t=t.parent;e.elementTitle.focus(),editor.call("selector:add","entity",e.entity)}),d.on("deselect",function(e){editor.call("selector:remove",e.entity)});var h,i=0,o=null,r=function(e){if(!d._dragging)return clearInterval(Number(o)),void window.removeEventListener("mousemove",r);var t=n.content.dom.getBoundingClientRect();i=e.clientY-t.top<32&&0<n.content.dom.scrollTop?-1:t.bottom-e.clientY<32&&0<n.content.dom.scrollHeight-(t.height+n.content.dom.scrollTop)?1:0};d.on("dragstart",function(){o=setInterval(function(){0!==i&&(n.content.dom.scrollTop+=8*i,d._dragOver=null,d._updateDragHandle())},1e3/60),i=0,window.addEventListener("mousemove",r,!1);var e=d._dragItems[0].entity.get("resource_id");editor.call("drop:set","entity",{resource_id:e}),editor.call("drop:activate",!0)}),d.on("dragend",function(){editor.call("drop:activate",!1),editor.call("drop:set")}),editor.call("drop:target",{ref:n.content.dom,type:"entity",hole:!0,passThrough:!0}).element.style.outline="none",d.on("reparent",function(e){for(var t=[],n=!p.Tree._ctrl||!p.Tree._ctrl(),i=0;i<e.length;i++){e[i].item.entity.reparenting||("2d-gui"===(o={item:e[i].item,parent:e[i].item.parent.entity,entity:e[i].item.entity,parentOld:e[i].old.entity,resourceId:e[i].item.entity.get("resource_id"),parentId:e[i].item.parent.entity.get("resource_id"),parentIdOld:e[i].old.entity.get("resource_id")}).entity.get("type")||n&&o.entity&&(o.position=o.entity.node.position.clone(),o.rotation=o.entity.node.rotation.clone()),o.indOld=o.parentOld.get("children").indexOf(o.resourceId),o.indNew=Array.prototype.indexOf.call(o.item.parent.element.childNodes,o.item.element)-1,t.push(o))}for(var o,i=0;i<t.length;i++){(o=t[i]).entity.reparenting=!0,o.parent===o.parentOld?(o.parent.removeValue("children",o.resourceId),o.parent.insert("children",o.resourceId,o.indNew+(o.indNew>o.indOld?t.length-1-i:0))):(o.parentOld.removeValue("children",o.resourceId),-1!==o.indNew?o.parent.insert("children",o.resourceId,o.indNew):o.parent.insert("children",o.resourceId),o.entity.set("parent",o.parentId)),a.BabylonLoader.updateSceneData(o.parentOld.get("resource_id"),o.parentOld._data2),a.BabylonLoader.updateSceneData(o.parent.get("resource_id"),o.parent._data2),a.BabylonLoader.updateSceneData(o.entity.get("resource_id"),o.entity._data2),editor.call("make:scene:dirty"),n&&o.position,o.entity.reparenting=!1}u()}),editor.on("selector:add",function(e,t){"entity"===t&&(c.uiItemIndex[e.get("resource_id")].selected=!0)}),editor.on("selector:remove",function(e,t){"entity"===t&&(c.uiItemIndex[e.get("resource_id")].selected=!1)}),editor.on("selector:change",function(e,t){if("entity"!==e)d.clear();else{for(var n=d.selected,i={},o=0;o<t.length;o++)i[t[o].get("resource_id")]=!0;for(o=0;o<n.length;o++)i[n[o].entity.get("resource_id")]||(n[o].selected=!1)}}),editor.on("entities:remove",function(e){c.uiItemIndex[e.get("resource_id")].destroy(),u()}),editor.on("entities:add",function(a,e){var t,n,i,o;"transformnode"!==a.get("type")&&"mesh"!==a.get("type")||(a.node=f.VeryEngine.viewScene.getNodeByID(a.get("resource_id")));var r=["tree-item-entity","entity-id-"+a.get("resource_id")];e&&r.push("tree-item-root");var s=new p.TreeItem({text:a.get("name"),classList:r});e||("camera"===a.get("type")?null!==(t=s.class)&&void 0!==t&&t.add("c-camera"):"light"===a.get("type")?null!==(n=s.class)&&void 0!==n&&n.add("c-light"):"2d-gui"===a.get("type")?null!==(i=s.class)&&void 0!==i&&i.add("c-element"):null!==(o=s.class)&&void 0!==o&&o.add("c-model")),"2d-gui"===(s.entity=a).get("type")?s.enabled=a.get("gui.isVisible"):s.enabled=a.get("enabled"),h=h||editor.call("components:list"),c.uiItemIndex[a.get("resource_id")]=s,a.on("name:set",function(e){s.text=e,u()}),a.on("enabled:set",function(e){s.enabled=e}),a.on("gui.isVisible:set",function(e){s.enabled=e}),a.on("children:move",function(e,t,n){var i,o,r=c.uiItemIndex[e];r&&!r.entity.reparenting&&(s.remove(r),o=null,i=c.uiItemIndex[a.get("children."+(t+1))],i===r&&0<t&&(o=c.uiItemIndex[a.get("children."+t)]),r.parent&&r.parent.remove(r),i?s.appendBefore(r,i):o?s.appendAfter(r,o):s.append(r))}),a.on("children:remove",function(e){var t=c.uiItemIndex[e];t&&!t.entity.reparenting&&s.remove(t)}),a.on("children:insert",function(e,t){var n,i=c.uiItemIndex[e];i&&!i.entity.reparenting&&(i.parent&&i.parent.remove(i),(n=c.uiItemIndex[a.get("children."+(t+1))])?s.appendBefore(i,n):s.append(i))});var l=s.users=document.createElement("span");l.classList.add("users"),s.elementTitle.appendChild(l),u()}),editor.on("entities:load",function(e){for(var t=editor.call("entities:list"),n=0;n<t.length;n++){var i=t[n],o=c.uiItemIndex[i.get("resource_id")];i.get("root")&&(d.append(o),o.open=!0,0);var r=i.get("children");if(r.length)for(var a=0;a<r.length;a++){var s,l=c.uiItemIndex[r[a]];l?o.append(l):(s="父物体： "+i.get("name")+"，hierarchy菜单无法关联到子物体，子物体ID："+r[a],editor.call("status:error",s),console.error(s))}}}),editor.on("entity:delete",function(e){editor.call("entities:remove",e)}),editor.method("entities:panel:get",function(e){return c.uiItemIndex[e]}),editor.method("entities:panel:highlight",function(e,t){var n=c.uiItemIndex[e];n&&(t?n.class.add("highlight"):n.class.remove("highlight"))})}var p=e("../../ui"),f=e("../../engine"),a=e("../middleware/loader/babylonLoader");n.HierarchyPanel=i},{"../../engine":139,"../../ui":162,"../middleware/loader/babylonLoader":86}],74:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.HierarchySearch=void 0;function i(){editor.method("entities:fuzzy-search",function(e){for(var t=[],n=editor.call("entities:list"),i=0;i<n.length;i++)t.push([n[i].get("name"),n[i]]);return editor.call("search:items",t,e)});var e=g.VeryEngine.hierarchy,r=editor.call("entities:hierarchy"),o=!1,a={},s=new m.List;s.element.tabIndex=0,s.hidden=!0,s.class.add("search-results"),e.append(s);var l="",c=new m.TextField("搜索");c.blurOnEnter=!1,c.keyChange=!0,c.class.add("search"),c.renderChanges=!1,e.prepend(c);var d=document.createElement("div");d.innerHTML="&#57650;",d.classList.add("clear"),c.element.appendChild(d),d.addEventListener("click",function(){c.value=""},!1),s.element.addEventListener("keydown",function(e){var t;27===e.keyCode?d.click():13===e.keyCode?(s.selected||(t=s.element.firstChild)&&t.ui&&t.ui.entity&&editor.call("selector:set","entity",[t.ui.entity]),c.value=""):40===e.keyCode?(u(),e.stopPropagation()):38===e.keyCode&&(h(),e.stopPropagation())},!1),s.unbind("deselect",s._onDeselect),s._onDeselect=function(e){var t=s.selected.indexOf(e);if(-1!==t&&s.selected.splice(t,1),!this._changing){if(!m.List._ctrl||!m.List._ctrl()){this._changing=!0;var n="entity"===editor.call("selector:type")&&editor.call("selector:items")||[],i=-1!==n.indexOf(e.entity);if(2<=n.length&&i){for(var o=this.selected,r=0;r<o.length;r++)o[r].selected=!1;e.selected=!0}this._changing=!1}this.emit("change")}},s.on("deselect",s._onDeselect),s.on("change",function(){o||(s.selected?editor.call("selector:set","entity",s.selected.map(function(e){return e.entity})):editor.call("selector:clear"))}),editor.on("selector:change",function(e,t){if(!o){if(o=!0,"entity"===e){s.selected=[];for(var n=0;n<t.length;n++){var i=a[t[n].get("resource_id")];i&&(i.selected=!0)}}else s.selected=[];o=!1}});var u=function(){var e,t,n,i,o=s.element.children;o.length&&(e=null,t=s.element.querySelectorAll(".ui-list-item.selected"),n=m.List._ctrl&&m.List._ctrl()||m.List._shift&&m.List._shift(),t.length?(i=t[t.length-1].nextSibling)?e=i.ui:n||(e=o[0].ui):e=o[0].ui,e&&(n||(s.selected=[]),e.selected=!0))},h=function(){var e,t,n,i,o=s.element.children;o.length&&(e=null,t=s.element.querySelectorAll(".ui-list-item.selected"),n=m.List._ctrl&&m.List._ctrl()||m.List._shift&&m.List._shift(),t.length?(i=t[0].previousSibling)?e=i.ui:n||(e=o[o.length-1].ui):e=o[o.length-1].ui,e&&(n||(s.selected=[]),e.selected=!0))};function p(t){var n=[],i=new m.ListItem(t.get("name"));i.disabledClick=!0,(i.entity=t).get("children").length&&i.class.add("container");var e=editor.call("entities:panel:get",t.get("resource_id"));function o(){i.disabled=e.disabled}i.disabled=e.disabled,n.push(e.on("enable",o)),n.push(e.on("disable",o)),n.push(t.on("name:set",function(e){i.text=e}));for(var r=Object.keys(t.get("components")),a=0;a<r.length;a++)i.class.add("c-"+r[a]);function s(e){editor.call("entities:contextmenu:open",t,e.clientX,e.clientY)&&(e.preventDefault(),e.stopPropagation())}function l(e){c.value="",editor.call("selector:set","entity",[t]),e.stopPropagation(),e.preventDefault()}return i.element.addEventListener("contextmenu",s),i.element.addEventListener("dblclick",l),n.push(i.once("destroy",function(){for(var e=0;e<n.length;e++)n[e].unbind();n=null,i.element.removeEventListener("contextmenu",s),i.element.removeEventListener("dblclick",l)})),n.push(e.once("destroy",function(){f()})),i}c.element.addEventListener("keydown",function(e){if(27===e.keyCode)d.click();else if(13===e.keyCode){var t;s.selected.length||(t=s.element.firstChild)&&t.ui&&t.ui.entity&&editor.call("selector:set","entity",[t.ui.entity]),c.value=""}else if(40===e.keyCode)editor.call("hotkey:updateModifierKeys",e),u(),e.stopPropagation(),e.preventDefault();else if(38===e.keyCode)editor.call("hotkey:updateModifierKeys",e),h(),e.stopPropagation(),e.preventDefault();else if(65===e.keyCode&&e.ctrlKey){for(var n=[],i=s.element.querySelectorAll(".ui-list-item"),o=0;o<i.length;o++)n.push(i[o].ui);s.selected=n,e.stopPropagation(),e.preventDefault()}},!1),editor.on("entities:add",function(e){var t,n=c.value.trim();n&&(t=[[e.get("name"),e]],editor.call("search:items",t,n).length&&f())});var f=function(){var e=l;if(s.clear(),a={},e){var t=editor.call("entities:fuzzy-search",e);r.hidden=!0,s.hidden=!1;var n=[];"entity"===editor.call("selector:type")&&(n=editor.call("selector:items"));for(var i=0;i<t.length;i++){var o=p(t[i]);a[t[i].get("resource_id")]=o,-1!==n.indexOf(t[i])&&(o.selected=!0),s.append(o)}}else s.hidden=!0,r.hidden=!1};c.on("change",function(e){e=e.trim(),l!==e&&((l=e)?c.class.add("not-empty"):c.class.remove("not-empty"),f())})}var m=e("../../ui"),g=e("../../engine");n.HierarchySearch=i},{"../../engine":139,"../../ui":162}],75:[function(e,t,n){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,n,i){void 0===i&&(i=n),Object.defineProperty(e,i,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,i){void 0===i&&(i=n),e[i]=t[n]}),o=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||t.hasOwnProperty(n)||i(t,e,n)};Object.defineProperty(n,"__esModule",{value:!0}),o(e("./keeper"),n),o(e("./hierarchy-panel"),n),o(e("./hierarchy-menu"),n),o(e("./hierarchy-control"),n),o(e("./hierarchy-search"),n),o(e("./hierarchy-context-menu"),n)},{"./hierarchy-context-menu":70,"./hierarchy-control":71,"./hierarchy-menu":72,"./hierarchy-panel":73,"./hierarchy-search":74,"./keeper":76}],76:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.HierarchyKeeper=void 0;function i(){new s.HierarchyPanel,new r.HierarchyMenu,new o.HierarchySearch,new a.HierarchyContextMenu}var o=e("./hierarchy-search"),r=e("./hierarchy-menu"),a=e("./hierarchy-context-menu"),s=e("./hierarchy-panel");n.HierarchyKeeper=i},{"./hierarchy-context-menu":70,"./hierarchy-menu":72,"./hierarchy-panel":73,"./hierarchy-search":74}],77:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.Hotkeys=void 0;var i=(l.prototype.keyMapInit=function(){for(var e in this.keyMap={backspace:{keyCode:8,code:"Backspace"},tab:{keyCode:9,code:"Tab"},enter:{keyCode:13,code:["enter","NumpadEnter","Enter"]},shift:{keyCode:16,code:["ShiftLeft","ShiftRight"]},ctrl:{keyCode:17,code:["CtrlLeft","CtrlRight"]},alt:{keyCode:18,code:["AltLeft","AltRight"]},"pause/break":{keyCode:19,code:"Pause"},"caps lock":{keyCode:20,code:"CapsLock"},esc:{keyCode:27,code:"Escape"},space:{keyCode:32,code:"Space"},"page up":{keyCode:33,code:"PageUp"},"page down":{keyCode:34,code:"PageDown"},end:{keyCode:35,code:"End"},home:{keyCode:36,code:"Home"},"left arrow":{keyCode:37,code:"ArrowLeft"},"up arrow":{keyCode:38,code:"ArrowUp"},"right arrow":{keyCode:39,code:"ArrowRight"},"down arrow":{keyCode:40,code:"ArrowDown"},insert:{keyCode:45,code:"Insert"},delete:{keyCode:46,code:"Delete"},0:{keyCode:48,code:"Digit0"},1:{keyCode:49,code:"Digit1"},2:{keyCode:50,code:"Digit2"},3:{keyCode:51,code:"Digit3"},4:{keyCode:52,code:"Digit4"},5:{keyCode:53,code:"Digit5"},6:{keyCode:54,code:"Digit6"},7:{keyCode:55,code:"Digit7"},8:{keyCode:56,code:"Digit8"},9:{keyCode:57,code:"Digit9"},a:{keyCode:65,code:"KeyA"},b:{keyCode:66,code:"KeyB"},c:{keyCode:67,code:"KeyC"},d:{keyCode:68,code:"KeyD"},e:{keyCode:69,code:"KeyE"},f:{keyCode:70,code:"KeyF"},g:{keyCode:71,code:"KeyG"},h:{keyCode:72,code:"KeyH"},i:{keyCode:73,code:"KeyI"},j:{keyCode:74,code:"KeyJ"},k:{keyCode:75,code:"KeyK"},l:{keyCode:76,code:"KeyL"},m:{keyCode:77,code:"KeyM"},n:{keyCode:78,code:"KeyN"},o:{keyCode:79,code:"KeyO"},p:{keyCode:80,code:"KeyP"},q:{keyCode:81,code:"KeyQ"},r:{keyCode:82,code:"KeyR"},s:{keyCode:83,code:"KeyS"},t:{keyCode:84,code:"KeyT"},u:{keyCode:85,code:"KeyU"},v:{keyCode:86,code:"KeyV"},w:{keyCode:87,code:"KeyW"},x:{keyCode:88,code:"KeyX"},y:{keyCode:89,code:"KeyY"},z:{keyCode:90,code:"KeyZ"},"left window key":{keyCode:91,code:"MetaLeft"},"right window key":{keyCode:92,code:"MetaRight"},"select key":{keyCode:93,code:"ContextMenu"},"numpad 0":{keyCode:96,code:"Numpad0"},"numpad 1":{keyCode:97,code:"Numpad1"},"numpad 2":{keyCode:98,code:"Numpad2"},"numpad 3":{keyCode:99,code:"Numpad3"},"numpad 4":{keyCode:100,code:"Numpad4"},"numpad 5":{keyCode:101,code:"Numpad5"},"numpad 6":{keyCode:102,code:"Numpad6"},"numpad 7":{keyCode:103,code:"Numpad7"},"numpad 8":{keyCode:104,code:"Numpad8"},"numpad 9":{keyCode:105,code:"Numpad9"},multiply:{keyCode:106,code:"NumpadMultiply"},add:{keyCode:107,code:"NumpadAdd"},subtract:{keyCode:109,code:"NumpadSubtract"},"decimal point":{keyCode:110,code:"NumpadDecimal"},divide:{keyCode:111,code:"NumpadDivide"},f1:{keyCode:112,code:"F1"},f2:{keyCode:113,code:"F2"},f3:{keyCode:114,code:"F3"},f4:{keyCode:115,code:"F4"},f5:{keyCode:116,code:"F5"},f6:{keyCode:117,code:"F6"},f7:{keyCode:118,code:"F7"},f8:{keyCode:119,code:"F8"},f9:{keyCode:120,code:"F9"},f10:{keyCode:121,code:"F10"},f11:{keyCode:122,code:"F11"},f12:{keyCode:123,code:"F12"},"num lock":{keyCode:144,code:"NumLock"},"scroll lock":{keyCode:145,code:"ScrollLock"},"semi-colon":{keyCode:186,code:"Semicolon"},"equal sign":{keyCode:187,code:"Equal"},comma:{keyCode:188,code:"Comma"},dash:{keyCode:189,code:"Minus"},period:{keyCode:190,code:"Period"},"forward slash":{keyCode:191,code:""},"grave accent":{keyCode:192,code:"Backquote"},"open bracket":{keyCode:219,code:"BracketLeft"},"back slash":{keyCode:220,code:["Backslash","IntlBackslash"]},"close bracket":{keyCode:221,code:"BracketRight"},"single quote":{keyCode:222,code:"Quote"}},this.keyMap)if(this.keyByKeyCode[this.keyMap[e].keyCode]=e,this.keyMap[e].code instanceof Array)for(var t=0;t<this.keyMap[e].code.length;t++)this.keyByCode[this.keyMap[e].code[t]]=e;else this.keyByCode[this.keyMap[e].code]=e},l.ctrl=!1,l.shift=!1,l.alt=!1,l);function l(){this.hotkeys={},this.keyIndex={},this.isMac=-1!==navigator.userAgent.indexOf("Mac OS X"),this.keyByKeyCode={},this.keyByCode={},this.keyMap={},this.keyMapInit();var a=this;editor.method("hotkey:register",function(e,t){var n=[(a.hotkeys[e]=t).ctrl?"1":"0",t.alt?"1":"0",t.shift?"1":"0"];"number"==typeof t.key&&(t.key=a.keyByKeyCode[t.key]),t.key?(n.push(t.key),t.index=n.join("+"),a.keyIndex[t.index]||(a.keyIndex[t.index]=[]),a.keyIndex[t.index].push(e)):console.error("未知的hotkeys: "+e+", "+t.key)}),editor.method("hotkey:unregister",function(e){var t=a.hotkeys[e];t&&(1===a.keyIndex[t.index].length?delete a.keyIndex[t.index]:a.keyIndex[t.index].splice(a.keyIndex[t.index].indexOf(e),1),delete a.hotkeys[e])}),editor.method("hotkey:shift",function(){return l.shift}),editor.method("hotkey:ctrl",function(){return l.ctrl}),editor.method("hotkey:alt",function(){return l.alt});function s(e){(e instanceof KeyboardEvent||e instanceof MouseEvent)&&(l.shift=e.shiftKey,l.ctrl=e.ctrlKey||e.metaKey,l.alt=e.altKey)}editor.method("hotkey:updateModifierKeys",s),window.addEventListener("keydown",function(e){if(e.target){var t=e.target.tagName;if(/(input)|(textarea)/i.test(t)&&!e.target.classList.contains("hotkeys"))return}s(e);var n=e.code?a.keyByCode[e.code]:a.keyByKeyCode[e.keyCode];if(92!==e.keyCode&&93!==e.keyCode){var i=[l.ctrl?"1":"0",l.alt?"1":"0",l.shift?"1":"0",n].join("+");if(a.keyIndex[i]){for(var o=!1,r=0;r<a.keyIndex[i].length;r++)!o&&a.hotkeys[a.keyIndex[i][r]].skipPreventDefault&&(o=!0),a.hotkeys[a.keyIndex[i][r]].callback(e);o||e.preventDefault()}}},!1),editor.method("hotkey:ctrl:string",function(){return a.isMac?"Cmd":"Ctrl"}),window.addEventListener("keyup",s,!1),window.addEventListener("mousedown",s,!1),window.addEventListener("mouseup",s,!1),window.addEventListener("click",s,!1),editor.call("hotkey:register","save:scene",{key:"s",ctrl:!0,callback:function(){editor.call("save:scene")}})}n.Hotkeys=i},{}],78:[function(e,t,n){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,n,i){void 0===i&&(i=n),Object.defineProperty(e,i,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,i){void 0===i&&(i=n),e[i]=t[n]}),o=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||t.hasOwnProperty(n)||i(t,e,n)};Object.defineProperty(n,"__esModule",{value:!0}),o(e("./initialize-before"),n),o(e("./editor"),n),o(e("./layout"),n),o(e("./viewport"),n),o(e("./hierarchy"),n),o(e("./hotkeys"),n),o(e("./entity"),n),o(e("./assets"),n),o(e("./scenes"),n),o(e("./camera"),n),o(e("./toolbar"),n),o(e("./pickers"),n),o(e("./settings"),n),o(e("./utility"),n),o(e("./middleware"),n),o(e("./initialize-after"),n),o(e("./localstorage"),n),o(e("./search"),n),o(e("./drop"),n),o(e("./global"),n),o(e("./Initialize-data"),n),o(e("./gizmos"),n),o(e("./gui"),n)},{"./Initialize-data":4,"./assets":19,"./camera":37,"./drop":39,"./editor":40,"./entity":48,"./gizmos":58,"./global":66,"./gui":68,"./hierarchy":75,"./hotkeys":77,"./initialize-after":79,"./initialize-before":80,"./layout":81,"./localstorage":82,"./middleware":85,"./pickers":91,"./scenes":95,"./search":98,"./settings":102,"./toolbar":105,"./utility":124,"./viewport":128}],79:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.InitializeAfter=void 0;function i(){new s.EntityKeeper,new l.ScenesKeeper,new c.CameraKeeper,new o.AttributesKeeper,new r.ToolbarKeeper,new d.SettingsKeeper,new u.PickerKeeper,new a.ViewportKeeper}var o=e("./attributes"),r=e("./toolbar"),a=e("./viewport"),s=e("./entity"),l=e("./scenes"),c=e("./camera"),d=e("./settings"),u=e("./pickers");n.InitializeAfter=i},{"./attributes":30,"./camera":37,"./entity":48,"./pickers":91,"./scenes":95,"./settings":102,"./toolbar":105,"./viewport":128}],80:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.InitializeBefore=void 0;var i=e("./hotkeys"),o=e("./utility"),r=e("./selector"),a=e("./localstorage"),s=(l.prototype.init=function(){new i.Hotkeys,new a.LocalStorage,new o.ComponentsLogos,new o.ContextMenu,new r.Selector},l);function l(){editor.method("permissions:write",function(){return!0}),this.init()}n.InitializeBefore=s},{"./hotkeys":77,"./localstorage":82,"./selector":99,"./utility":124}],81:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.Layout=void 0;var s=e("../ui"),l=e("../engine"),i=(o.prototype.init=function(){var e=new s.TopElementContainer({id:"layout-root",grid:!0});document.body.appendChild(e.dom),editor.method("layout.root",function(){return e}),l.VeryEngine.root=e;var t=new s.TopElementContainer({id:"layout-toolbar",flex:!0});e.append(t),editor.method("layout.toolbar",function(){return t}),l.VeryEngine.toolbar=t;var n=new s.TopElementPanel({headerText:"层级菜单",id:"layout-hierarchy",flex:!0,enabled:!0,width:editor.call("localStorage:get","editor:layout:hierarchy:width")||256,panelType:"normal",collapsible:!0,collapseHorizontally:!0,collapsed:editor.call("localStorage:get","editor:layout:hierarchy:collapse")||window.innerWidth<=480,scrollable:!0,resizable:"right",resizeMin:196,resizeMax:512});n.on("resize",function(){editor.call("localStorage:set","editor:layout:hierarchy:width",n.width)}),n.on("collapse",function(){editor.call("localStorage:set","editor:layout:hierarchy:collapse",!0)}),n.on("expand",function(){editor.call("localStorage:set","editor:layout:hierarchy:collapse",!1)}),e.append(n),editor.method("layout.hierarchy",function(){return n}),editor.on("permissions:writeState",function(e){n.enabled=e}),l.VeryEngine.hierarchy=n;var i=new s.TopElementContainer({id:"layout-viewport"});i.class.add("viewport"),e.append(i),editor.method("layout.viewport",function(){return i}),l.VeryEngine.viewportPanel=i;var o=new s.TopElementPanel({id:"layout-assets",headerText:"资源面板",flex:!0,flexDirection:"row",panelType:"normal",collapsible:!0,collapsed:editor.call("localStorage:get","editor:layout:assets:collapse")||window.innerHeight<=480,height:editor.call("localStorage:get","editor:layout:assets:height")||212,scrollable:!0,resizable:"top",resizeMin:106,resizeMax:636});o.class.add("assets"),o.on("resize",function(){editor.call("localStorage:set","editor:layout:assets:height",o.height)}),o.on("collapse",function(){editor.call("localStorage:set","editor:layout:assets:collapse",!0)}),o.on("expand",function(){editor.call("localStorage:set","editor:layout:assets:collapse",!1)}),e.append(o),editor.method("layout.assets",function(){return o}),l.VeryEngine.assets=o;var r=new s.TopElementPanel({id:"layout-attributes",headerText:"属性面板",enabled:!0,panelType:"normal",width:editor.call("localStorage:get","editor:layout:attributes:width")||320,collapsible:!0,collapseHorizontally:!0,collapsed:editor.call("localStorage:get","editor:layout:attributes:collapse")||!1,scrollable:!0,resizable:"left",resizeMin:256,resizeMax:512});r.class.add("attributes"),r.on("resize",function(){editor.call("localStorage:set","editor:layout:attributes:width",r.width)}),r.on("collapse",function(){editor.call("localStorage:set","editor:layout:attributes:collapse",!0)}),r.on("expand",function(){editor.call("localStorage:set","editor:layout:attributes:collapse",!1)}),e.append(r),editor.method("layout.attributes",function(){return r}),editor.on("permissions:writeState",function(e){r.enabled=e}),l.VeryEngine.attributes=r;var a=new s.TopElementContainer({id:"layout-statusbar",flex:!0,flexDirection:"row"});e.append(a),editor.method("layout.statusBar",function(){return a}),l.VeryEngine.statusBar=a,window.innerWidth<=720&&console.warn("folder")},o);function o(){this.ignoreClasses=/(ui-list-item)|(ui-button)|(ui-text-field)|(ui-number-field)/i,this.ignoreElements=/(input)|(textarea)/i;var n=this;window.addEventListener("mousedown",function(e){if(e.target){if(n.ignoreClasses.test(e.target.className))return;if(n.ignoreElements.test(e.target.tagName))return;if(e.target.classList.contains("selectable"))return}var t;!window.getSelection||(t=window.getSelection().focusNode)&&("INPUT"===t.tagName?t.blur():t.firstChild&&"INPUT"===t.firstChild.tagName&&t.firstChild.blur()),e.preventDefault()},!1)}n.Layout=i},{"../engine":139,"../ui":162}],82:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.LocalStorage=void 0;function i(){editor.method("localStorage:get",function(e){var t=localStorage.getItem(e);if(t)try{t=JSON.parse(t)}catch(e){console.error(e)}return t}),editor.method("localStorage:set",function(e,t){localStorage.setItem(e,JSON.stringify(t))}),editor.method("localStorage:has",function(e){return!!localStorage.getItem(e)})}n.LocalStorage=i},{}],83:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.Component=void 0;var i=e("./transform"),o=e("./gameobject"),r=(Object.defineProperty(a.prototype,"transform",{get:function(){return new i.Transform},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"gameObject",{get:function(){return new o.GameObject},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"tag",{get:function(){return""},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"camera",{get:function(){return new a},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"light",{get:function(){return new a},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"renderer",{get:function(){return new a},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"collider",{get:function(){return new a},enumerable:!1,configurable:!0}),a);function a(){}n.Component=r},{"./gameobject":84,"./transform":88}],84:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.GameObject=void 0;var i=e("./transform"),o=e("../../engine"),r=(Object.defineProperty(a.prototype,"gameObject",{get:function(){return this},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"transform",{get:function(){return this._transform},set:function(e){this._transform=e},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"name",{get:function(){return this.transform.name},set:function(e){this.transform.name=e},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"guid",{get:function(){return this._guid},set:function(e){this._guid=e},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"isEmpty",{get:function(){return this._transform.isEmpty},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"mesh",{get:function(){return this._transform.mesh},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"tag",{get:function(){return this._tag},set:function(e){this._tag=e},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"isActive",{get:function(){return!this.isEmpty&&this.transform.transformNode.isEnabled()},enumerable:!1,configurable:!0}),a.Find=function(e,t){var n=(t=t||o.BabylonEngine.Scene).getNodeByName(e);return n?n instanceof BABYLON.AbstractMesh?new a("",n):n instanceof BABYLON.TransformNode?new a("",null,n):(console.error("GameObject.Find函数查找到不支持的类型："+n.getClassName()),null):null},a.FindGameObjectWithTag=function(e){},a.FindGameObjectsWithTag=function(e){},a.Destroy=function(e){e&&e.transform.destroy()},a.CreateInstance=function(e){if(!e)return null;if(e.isEmpty)return new a;if(e.transform.mesh){return new a("",e.transform.mesh instanceof BABYLON.Mesh?e.transform.mesh.createInstance(e.name+"_instance"):e.transform.mesh.sourceMesh.createInstance(e.name+"_instance"))}return new a("",null,e.transform.transformNode.clone(e.name+"_intance"))},a.prototype.addMesh=function(e){null===this._transform.mesh&&this._transform.transformNode&&this._transform.transformNode.dispose(),this._transform.mesh=e},a.prototype.setActive=function(e){},a.prototype.setActiveRecursively=function(e){},a.AddComponent=function(){},a);function a(e,t,n){void 0===t&&(t=null),void 0===n&&(n=null),this._guid="",this._tag="",this._transform=t?new i.Transform("",t):n?new i.Transform("",null,n):e?new i.Transform(e):new i.Transform}n.GameObject=r},{"../../engine":139,"./transform":88}],85:[function(e,t,n){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,n,i){void 0===i&&(i=n),Object.defineProperty(e,i,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,i){void 0===i&&(i=n),e[i]=t[n]}),o=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||t.hasOwnProperty(n)||i(t,e,n)};Object.defineProperty(n,"__esModule",{value:!0}),o(e("./transform"),n),o(e("./gameobject"),n),o(e("./component"),n),o(e("./resource-container"),n),o(e("./very-camera"),n),o(e("./very-light"),n)},{"./component":83,"./gameobject":84,"./resource-container":87,"./transform":88,"./very-camera":89,"./very-light":90}],86:[function(e,t,n){"use strict";var i=this&&this.__awaiter||function(e,a,s,l){return new(s=s||Promise)(function(n,t){function i(e){try{r(l.next(e))}catch(e){t(e)}}function o(e){try{r(l.throw(e))}catch(e){t(e)}}function r(e){var t;e.done?n(e.value):((t=e.value)instanceof s?t:new s(function(e){e(t)})).then(i,o)}r((l=l.apply(e,a||[])).next())})},B=this&&this.__generator||function(n,i){var o,r,a,s={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]},e={next:t(0),throw:t(1),return:t(2)};return"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(t){return function(e){return function(t){if(o)throw new TypeError("Generator is already executing.");for(;s;)try{if(o=1,r&&(a=2&t[0]?r.return:t[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,t[1])).done)return a;switch(r=0,a&&(t=[2&t[0],a.value]),t[0]){case 0:case 1:a=t;break;case 4:return s.label++,{value:t[1],done:!1};case 5:s.label++,r=t[1],t=[0];continue;case 7:t=s.ops.pop(),s.trys.pop();continue;default:if(!(a=0<(a=s.trys).length&&a[a.length-1])&&(6===t[0]||2===t[0])){s=0;continue}if(3===t[0]&&(!a||t[1]>a[0]&&t[1]<a[3])){s.label=t[1];break}if(6===t[0]&&s.label<a[1]){s.label=a[1],a=t;break}if(a&&s.label<a[2]){s.label=a[2],s.ops.push(t);break}a[2]&&s.ops.pop(),s.trys.pop();continue}t=i.call(n,s)}catch(e){t=[6,e],r=0}finally{o=a=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}([t,e])}}};Object.defineProperty(n,"__esModule",{value:!0}),n.BabylonLoader=void 0;var L=e("../../../editor/utility"),C=e("../../../engine"),l=e("../../../editor/global"),o=e("../very-light"),r=e("../very-camera"),c=e("../../../tools/ossfile"),a=(A.loadFromBabylonAsset=function(){},A.loadBabylon=function(e){var n=e.get("id"),i=null;A.babylonCacheData[n]?(console.log(A.babylonCacheData[n]),i=A.babylonCacheData[n],A.parseBabylon(n,i),A.assembleBabylon(n,i)):c.getJsonAsset(l.Config.projectID,n,e.get("name"),e.get("file.hash")).then(function(e){var t=JSON.parse(e);i=t,A.babylonCacheData[n]=i,A.parseBabylon(n,i),A.assembleBabylon(n,i)})},A.parseBabylon=function(e,t){var n;t&&(n={},t.materials&&(n.materials={},t.materials.forEach(function(e){n.materials[e.id]=e})),t.geometries&&t.geometries.vertexData&&(n.geometries={},t.geometries.vertexData.forEach(function(e){n.geometries[e.id]=e})),t.meshes&&(n.meshes={},t.meshes.forEach(function(e){n.meshes[e.id]=e})),t.transformNodes&&(n.transformNodes={},t.transformNodes.forEach(function(e){n.transformNodes[e.id]=e})),A.babylonParsedData[e]=n)},A.hasBabylobData=function(e){return e in A.babylonCacheData},A.getBabylonData=function(e){return e in A.babylonCacheData?A.babylonCacheData[e]:null},A.hasParsedBabylonData=function(e){return e in A.babylonParsedData},A.getParsedBabylonData=function(e){return e in A.babylonParsedData?A.babylonParsedData[e]:null},A.meshParseRecursion=function(e,t,n,i,o){if(e){var r="";r=null!==e.parent?e.parent.id:editor.call("entities:root").get("resource_id");for(var a=e.getChildren(),s=[],l=0;l<a.length;l++)s.push(a[l].id);var c=L.Tools.radianToEulerAngle(e.rotation),d={name:e.name,resource_id:e.id,babylon_id:n[e.id],asset_id:t,parent:r,position:[e.position.x,e.position.y,e.position.z],rotation:[c.x,c.y,c.z],scale:[e.scaling.x,e.scaling.y,e.scaling.z],children:s,enabled:e.isEnabled(),checkCollisions:e.checkCollisions,pickable:e.isPickable,isVisible:e.isVisible,tags:[],type:"mesh"};e.isPickable=!0;var u=editor.call("entities:new",d);i.push(u),o.push(u.origin);for(l=0;l<a.length;l++)A.meshParseRecursion(a[l],t,n,i,o)}},A.addSceneData=function(e,t){A.scenesData.entities[e]=t,A.scenesData.modified=A.createdAtTime()},A.removeSceneData=function(e){delete A.scenesData.entities[e],A.scenesData.modified=A.createdAtTime()},A.updateSceneData=function(e,t){A.scenesData.entities[e]=t,A.scenesData.modified=A.createdAtTime()},A.changeSceneName=function(e,t){A.scenesData.entities[e].name=t,A.scenesData.name=t,A.scenesData.modified=A.createdAtTime(),editor.call("make:scene:dirty")},A.createdAtTime=function(){var e=new Date;return e.getFullYear()+"-"+A.getRealTime(e.getMonth()+1)+"-"+A.getRealTime(e.getDate())+" "+A.getRealTime(e.getHours())+":"+A.getRealTime(e.getMinutes())},A.getRealTime=function(e){return e<10?"0"+e:e.toString()},A.saveScene=function(){l.Config.isSceneDirty&&c.getJsonConfig(l.Config.projectID,"scenes").then(function(e){var t=JSON.parse(e);t.scenes[A.sceneIndex]=A.scenesData,c.upLoadJsonConfig(JSON.stringify(t),l.Config.projectID,"scenes"),editor.call("make:scene:clear")})},A.loadLight=function(e,t){return null==e?null:BABYLON.Light.Parse(e,t)},A.loadReflectionProbe=function(e,t,n){return null==e?null:BABYLON.ReflectionProbe.Parse(e,t,n)},A.loadAnimation=function(e){if(null==e)return null;var t=BABYLON._TypeStore.GetClass("BABYLON.Animation");return t?t.Parse(e):null},A.loadMultiMaterial=function(e,t){return null==e?null:BABYLON.MultiMaterial.ParseMultiMaterial(e,t)},A.loadMorphTargetManager=function(e,t){return null==e?null:BABYLON.MorphTargetManager.Parse(e,t)},A.loadSkeleton=function(e,t){return null==e?null:BABYLON.Skeleton.Parse(e,t)},A.loadGeometry=function(e,t,n){return null==e?null:BABYLON.Geometry.Parse(e,t,n)},A.loadTransformNode=function(e,t,n){return null==e?null:BABYLON.TransformNode.Parse(e,t,n)},A.loadMesh=function(e,t,n){return null==e?null:BABYLON.Mesh.Parse(e,t,n)},A.loadCamera=function(e,t){return null==e?null:BABYLON.Camera.Parse(e,t)},A.loadAnimationGroup=function(e,t){return null==e?null:BABYLON.AnimationGroup.Parse(e,t)},A.setBabylonParent=function(e){for(var t,n=0,i=0,o=e.cameras.length;i<o;i++){var r=e.cameras[i];r._waitingParentId&&(r.parent=e.getLastEntryByID(r._waitingParentId),r._waitingParentId=null)}for(t=0,n=e.lights.length;t<n;t++){var a=e.lights[t];a&&a._waitingParentId&&(a.parent=e.getLastEntryByID(a._waitingParentId),a._waitingParentId=null)}for(t=0,n=e.transformNodes.length;t<n;t++){var s=e.transformNodes[t];s._waitingParentId&&(s.parent=e.getLastEntryByID(s._waitingParentId),s._waitingParentId=null)}for(t=0,n=e.meshes.length;t<n;t++){var l=e.meshes[t];l._waitingParentId&&(l.parent=e.getLastEntryByID(l._waitingParentId),l._waitingParentId=null)}},A.createCameraWraper=function(e,t,n){var i=new BABYLON.UniversalCamera(e,new BABYLON.Vector3(0,100,-200),t);i.maxZ=2e4;var o=new r.VeryCamera(i,t,n);return o.orthoSize=.5,o},A.createLightWraper=function(e,t,n){var i=A.createLight(e,t,n);return new o.VeryLight(i,n)},A.createLight=function(e,t,n){return"point"===(e=e.toLowerCase())?new BABYLON.PointLight(t,BABYLON.Vector3.Zero(),n):"spot"===e?new BABYLON.SpotLight(t,BABYLON.Vector3.Zero(),new BABYLON.Vector3(0,-1,0),.75*Math.PI,8,n):"hemispheric"===e?new BABYLON.HemisphericLight(t,BABYLON.Vector3.Up(),n):new BABYLON.DirectionalLight(t,BABYLON.Vector3.Forward(),n)},A.createPrimitive=function(e,t,n){var i="box"===e?BABYLON.MeshBuilder.CreateBox(t,{},n):"sphere"===e?BABYLON.MeshBuilder.CreateSphere(t,{},n):"plane"===e?BABYLON.MeshBuilder.CreateGround(t,{},n):"cylinder"===e?BABYLON.MeshBuilder.CreateCylinder(t,{},n):new BABYLON.TransformNode(t,n);return i},A.load=function(e,t,n){void 0===t&&(t="")},A._getFileInfo=function(e,t){var n=null;if(t)if(t.name)var i=e+t.name,o=t.name,n=t;else{var r=t;if("/"===r.substr(0,1))return L.Tools.Error("Wrong sceneFilename parameter"),null;i=e+r,o=r}else i=e,o=L.Tools.GetFilename(e),e=L.Tools.GetFolderPath(e);return{url:i,rootUrl:e,name:o,file:n}},A.prefix="/assets/",A.assetsData={},A.projectData={},A.scenesData={},A.sceneIndex=0,A.babylonCacheData={},A.babylonParsedData={},A.assembleBabylon=function(x,O){return i(void 0,void 0,void 0,function(){var t,n,i,o,r,a,s,l,c,d,u,h,p,f,m,g,y,v,b,_,w;return B(this,function(e){switch(e.label){case 0:if(null===O)return[3,5];if(!A.assetsData.babylon[x])return[3,4];for(i in t=A.assetsData.babylon[x].materials,n=[],t)n.push(i);o=0,e.label=1;case 1:return o<n.length?(r=n[o],t[r].asset_id&&A.assetsData.assets[t[r].asset_id]?(a=A.assetsData.assets[t[r].asset_id].data,[4,A.loadMaterial(a,C.VeryEngine.viewScene,"")]):[3,3]):[3,4];case 2:e.sent(),e.label=3;case 3:return o++,[3,1];case 4:for(O.geometries&&O.geometries.vertexData&&O.geometries.vertexData.forEach(function(e){A.loadGeometry(e,C.VeryEngine.viewScene,"")}),s=[],O.transformNodes&&O.transformNodes.forEach(function(e){var t=A.loadTransformNode(e,C.VeryEngine.viewScene,"");s.push(t)}),l=[],c=[],d={},u={},O.meshes&&(O.meshes.forEach(function(e){var t,n;A.scenesData.entities[e.id]?(t=L.GUID.create(),n=e.id,u[t]=n,e.id=t,O.meshes.forEach(function(e){e.parentId===n&&(e.parentId=t)})):u[e.id]=e.id}),O.meshes.forEach(function(e){var t=A.loadMesh(e,C.VeryEngine.viewScene,"");l.push(t),d[e.id]=t})),p=h=null,"entity"===editor.call("selector:type")&&(h=editor.call("selector:items")[0]),h?h.node&&(p=h.node):h=editor.call("entities:root"),f=[],m=[],g=0,y=s.length;g<y;g++)(v=s[g])&&v._waitingParentId&&(v.parent=C.VeryEngine.viewScene.getLastEntryByID(v._waitingParentId),v._waitingParentId=null);for(_=0,b=l.length;_<b;_++)null!==l[_]&&(l[_]._waitingParentId&&d[l[_]._waitingParentId]?l[_].parent=d[l[_]._waitingParentId]:(l[_].parent=p,c.push(l[_])),l[_]._waitingParentId=null);for(_=0;_<c.length;_++)A.meshParseRecursion(c[_],x,u,f,m);editor.call("selector:history",!1),editor.call("selector:set","entity",[editor.call("entities:get",null===(w=c[0])||void 0===w?void 0:w.id)]),editor.once("selector:change",function(){editor.call("selector:history",!0)}),editor.call("make:scene:dirty"),e.label=5;case 5:return[2]}})})},A.loadMaterial=function(r,a,s){return i(void 0,void 0,void 0,function(){return B(this,function(e){return[2,new Promise(function(o,e){return i(void 0,void 0,void 0,function(){var t,n,i;return B(this,function(e){switch(e.label){case 0:return null==r?[3,19]:(t="",r.diffuseTexture&&r.diffuseTexture.texture_id?(n=r.diffuseTexture.texture_id,[4,c.getUrl(l.Config.projectID,n,A.assetsData.assets[n].name,A.assetsData.assets[n].file.hash)]):[3,2]);case 1:t=e.sent(),r.diffuseTexture.name=t,e.label=2;case 2:return r.specularTexture&&r.specularTexture.texture_id?(n=r.specularTexture.texture_id,[4,c.getUrl(l.Config.projectID,n,A.assetsData.assets[n].name,A.assetsData.assets[n].file.hash)]):[3,4];case 3:t=e.sent(),r.specularTexture.name=t,e.label=4;case 4:return r.reflectionTexture&&r.reflectionTexture.texture_id?(n=r.reflectionTexture.texture_id,[4,c.getUrl(l.Config.projectID,n,A.assetsData.assets[n].name,A.assetsData.assets[n].file.hash)]):[3,6];case 5:t=e.sent(),r.reflectionTexture.name=t,e.label=6;case 6:return r.refractionTexture&&r.refractionTexture.texture_id?(n=r.refractionTexture.texture_id,[4,c.getUrl(l.Config.projectID,n,A.assetsData.assets[n].name,A.assetsData.assets[n].file.hash)]):[3,8];case 7:t=e.sent(),r.refractionTexture.name=t,e.label=8;case 8:return r.emissiveTexture&&r.emissiveTexture.texture_id?(n=r.emissiveTexture.texture_id,[4,c.getUrl(l.Config.projectID,n,A.assetsData.assets[n].name,A.assetsData.assets[n].file.hash)]):[3,10];case 9:t=e.sent(),r.emissiveTexture.name=t,e.label=10;case 10:return r.bumpTexture&&r.bumpTexture.texture_id?(n=r.bumpTexture.texture_id,[4,c.getUrl(l.Config.projectID,n,A.assetsData.assets[n].name,A.assetsData.assets[n].file.hash)]):[3,12];case 11:t=e.sent(),r.bumpTexture.name=t,e.label=12;case 12:return r.opacityTexture&&r.opacityTexture.texture_id?(n=r.opacityTexture.texture_id,[4,c.getUrl(l.Config.projectID,n,A.assetsData.assets[n].name,A.assetsData.assets[n].file.hash)]):[3,14];case 13:t=e.sent(),r.opacityTexture.name=t,e.label=14;case 14:return r.ambientTexture&&r.ambientTexture.texture_id?(n=r.ambientTexture.texture_id,[4,c.getUrl(l.Config.projectID,n,A.assetsData.assets[n].name,A.assetsData.assets[n].file.hash)]):[3,16];case 15:t=e.sent(),r.ambientTexture.name=t,e.label=16;case 16:return r.lightmapTexture&&r.lightmapTexture.texture_id?(n=r.lightmapTexture.texture_id,[4,c.getUrl(l.Config.projectID,n,A.assetsData.assets[n].name,A.assetsData.assets[n].file.hash)]):[3,18];case 17:t=e.sent(),r.lightmapTexture.name=t,e.label=18;case 18:i=BABYLON.Material.Parse(r,a,s),o(i),e.label=19;case 19:return o(null),[2]}})})})]})})},A);function A(){}n.BabylonLoader=a},{"../../../editor/global":66,"../../../editor/utility":124,"../../../engine":139,"../../../tools/ossfile":150,"../very-camera":89,"../very-light":90}],87:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.ResourceContainer=void 0;var i=(o.prototype.addGameObject=function(e){this.gameObjects.push()},o);function o(){this.gameObjects=[]}n.ResourceContainer=i},{}],88:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.Transform=void 0;var i=(Object.defineProperty(o.prototype,"transformNode",{get:function(){return this._mesh?this._mesh:this._transformNode?this._transformNode:null},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"mesh",{get:function(){return this._mesh},set:function(e){this._mesh=e},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"isMesh",{get:function(){return!!this._mesh},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"isEmpty",{get:function(){return!this._transformNode&&!this._mesh},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"name",{get:function(){return this._name},set:function(e){this._transformNode&&(this._transformNode.name=e),this._mesh&&(this._mesh.name=e),this._name=e},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"parent",{get:function(){return this._parent},set:function(e){this.isEmpty||(e&&!e.isEmpty?(this._transformNode.setParent(e.transformNode),this._parent=e):(this._transformNode.setParent(null),this._parent=null))},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"localPosition",{get:function(){return this.isEmpty?BABYLON.Vector3.Zero():(this._tempVec.copyFrom(this.transformNode.position),this._tempVec)},set:function(e){this.isEmpty||(this.transformNode.position=e)},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"position",{get:function(){return this.isEmpty?BABYLON.Vector3.Zero():(this._tempVec.copyFrom(this.transformNode.getAbsolutePosition()),this._tempVec)},set:function(e){this.isEmpty||this.transformNode.setAbsolutePosition(e)},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"localEulerAngles",{get:function(){if(this.isEmpty)return BABYLON.Vector3.Zero();var e=180/Math.PI;return this.transformNode.rotation.multiplyByFloats(e,e,e)},set:function(e){var t;this.isEmpty||(t=Math.PI/180,this.transformNode.rotation=e.multiplyByFloats(t,t,t))},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"localRotation",{get:function(){return this.isEmpty?BABYLON.Vector3.Zero():(this._tempVec.copyFrom(this.transformNode.rotation),this._tempVec)},set:function(e){this.isEmpty||(this.transformNode.rotation=e)},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"eulerAngles",{get:function(){if(this.isEmpty)return BABYLON.Vector3.Zero();var e=this.transformNode.parent,t=180/Math.PI;this.transformNode.setParent(null);var n=this.transformNode.rotation.multiplyByFloats(t,t,t);return this.transformNode.setParent(e),n},set:function(e){var t,n;this.isEmpty||(t=this.transformNode.parent,n=Math.PI/180,this.transformNode.setParent(null),this.transformNode.rotation=e.multiplyByFloats(n,n,n),this.transformNode.setParent(t))},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"rotation",{get:function(){if(this.isEmpty)return BABYLON.Vector3.Zero();var e=this.transformNode.parent;return this.transformNode.setParent(null),this._tempVec.copyFrom(this.transformNode.rotation),this.transformNode.setParent(e),this._tempVec},set:function(e){var t;this.isEmpty||(t=this.transformNode.parent,this.transformNode.setParent(null),this.transformNode.rotation=e,this.transformNode.setParent(t))},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"children",{get:function(){return this.transformNode.getChildren()},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"childCount",{get:function(){return 0},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"hierarchyCount",{get:function(){return 0},enumerable:!1,configurable:!0}),o.prototype.translate=function(e,t){this.transformNode&&this.transformNode.translate(e,1,t)},o.prototype.translateRelativeTo=function(e,t){var n;this.transformNode&&(n=e.clone(),t&&t.transformNode&&(n=this.transformDirection(n)),this.transformNode.translate(n,1,BABYLON.Space.WORLD))},o.prototype.rotate=function(e,t){var n,i;this.transformNode&&(n=BABYLON.Vector3.Zero().copyFrom(e.normalize()),i=e.length(),this.transformNode.rotate(n,i,t))},o.prototype.rotateAround=function(e,t,n){this.transformNode&&this.transformNode.rotateAround(e,t,n)},o.prototype.transformPosition=function(e){if(this.transformNode){var t=this.transformNode.computeWorldMatrix();return BABYLON.Vector3.TransformCoordinates(e,t)}return e},o.prototype.transformDirection=function(e){if(this.transformNode){var t=this.transformNode.computeWorldMatrix();return BABYLON.Vector3.TransformCoordinates(e,t).subtract(this.transformNode.getAbsolutePosition())}return e},o.prototype.inverseTransformPosition=function(e){if(this.transformNode){var t=BABYLON.Matrix.Invert(this.transformNode.computeWorldMatrix());return BABYLON.Vector3.TransformCoordinates(e,t)}return e},o.prototype.inverseTransformDirection=function(e){if(this.transformNode){var t=BABYLON.Matrix.Invert(this.transformNode.computeWorldMatrix()),n=BABYLON.Vector3.TransformCoordinates(e,t),i=BABYLON.Vector3.TransformCoordinates(BABYLON.Vector3.Zero(),t);return n.subtract(i)}return e},o.prototype.destroy=function(){this.mesh&&this.mesh.dispose(),this.transformNode&&this.transformNode.dispose()},o.prototype.lookAt=function(e,t){void 0===t&&(t=BABYLON.Vector3.Up())},o.prototype.setParent=function(e){},o.prototype.detachChildren=function(){},o.prototype.findChild=function(e){},o.prototype.isChildOf=function(e){return!0},o.prototype.getChild=function(e){},o);function o(e,t,n){var i;void 0===e&&(e="空物体"),void 0===t&&(t=null),void 0===n&&(n=null),this._transformNode=null,this._mesh=null,this._name="",this._tempVec=BABYLON.Vector3.Zero(),this._parent=null,this.forward=BABYLON.Vector3.Forward(),this.localScale=new BABYLON.Vector3(1,1,1),t?(this._mesh=t,this._transformNode=t,this._name=t.name):n?(this._mesh=null,this._transformNode=n,this._name=n.name):(this._mesh=null,this._transformNode=new BABYLON.TransformNode(e),this._name=e),this._transformNode?(i=this._transformNode.parent)&&(i instanceof BABYLON.AbstractMesh?this._parent=new o(i.name,i):this._parent=new o(i.name,null,i)):this._parent=null}n.Transform=i},{}],89:[function(e,t,n){"use strict";var i,o=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0}),n.VeryCamera=void 0;var r,a=e("../../engine"),s=e("../global"),l=(r=BABYLON.TransformNode,o(c,r),Object.defineProperty(c.prototype,"mode",{get:function(){return this.camera.mode},set:function(e){(this.camera.mode=e)===BABYLON.Camera.ORTHOGRAPHIC_CAMERA&&(this.orthoSize=this._orthoSize)},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"fov",{get:function(){return this.camera.fov},set:function(e){this.camera.fov=e},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"inertia",{get:function(){return this.camera.inertia},set:function(e){this.camera.inertia=e},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"orthoSize",{get:function(){return this.camera.mode===BABYLON.Camera.ORTHOGRAPHIC_CAMERA?(this._orthoSize=this.camera.orthoRight/this._scene.getEngine().getRenderWidth()/this.camera.viewport.width,this._orthoSize):0},set:function(e){this._orthoSize=e,this.camera.mode===BABYLON.Camera.ORTHOGRAPHIC_CAMERA&&(this.camera.orthoRight=e*this._scene.getEngine().getRenderWidth()*this.camera.viewport.width,this.camera.orthoLeft=-e*this._scene.getEngine().getRenderWidth()*this.camera.viewport.width,this.camera.orthoTop=e*this._scene.getEngine().getRenderHeight()*this.camera.viewport.height,this.camera.orthoBottom=-e*this._scene.getEngine().getRenderHeight()*this.camera.viewport.height)},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"clearColor",{get:function(){return this._clearColor},set:function(e){this._clearColor=e},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"minZ",{get:function(){return this.camera.minZ},set:function(e){this.camera.minZ=e},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"maxZ",{get:function(){return this.camera.minZ},set:function(e){this.camera.maxZ=e},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"checkCollisions",{get:function(){return this.camera.checkCollisions},set:function(e){this.camera.checkCollisions=e},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"applyGravity",{get:function(){return this.camera.applyGravity},set:function(e){this.camera.applyGravity=e},enumerable:!1,configurable:!0}),c.prototype.renderCamera=function(e){this._render!==e&&((this._render=e)?this.camera.viewport=this._backupViewport.clone():(this._backupViewport=this.camera.viewport.clone(),this.camera.viewport=new BABYLON.Viewport(0,0,0,0)))},c.prototype.resize=function(e){var t,n;this.camera&&this._canvas&&(this._canvas.width===this._width&&this._canvas.height===this._height||(this._width=this._canvas.width,this._height=this._canvas.height,t=this._scene.getEngine().getRenderWidth(),n=this._scene.getEngine().getRenderHeight(),e&&this!==a.VeryEngine.viewCamera&&(this._render?this.camera.viewport=new BABYLON.Viewport(s.Config.x/t,(n-s.Config.y)/n,s.Config.width/t,s.Config.height/n):this._backupViewport=new BABYLON.Viewport(s.Config.x/t,(n-s.Config.y)/n,s.Config.width/t,s.Config.height/n)),this.camera.mode===BABYLON.Camera.ORTHOGRAPHIC_CAMERA&&(this.camera.orthoRight=this._orthoSize*t*this.camera.viewport.width,this.camera.orthoLeft=-this._orthoSize*t*this.camera.viewport.width,this.camera.orthoTop=this._orthoSize*n*this.camera.viewport.height,this.camera.orthoBottom=-this._orthoSize*n*this.camera.viewport.height)))},c);function c(e,t,n){var i=r.call(this,e.name,t)||this;return i._orthoSize=0,i._clearColor=null,i._backupViewport=new BABYLON.Viewport(0,0,1,1),i._render=!0,(i.camera=e).name+="-Camera",i._canvas=n,i._width=n.width,i._height=n.height,i.position.copyFrom(e.position),i.rotation.copyFrom(e.rotation),e.parent=i,e.position=BABYLON.Vector3.Zero(),e.rotation=BABYLON.Vector3.Zero(),e.inputs.clear(),i}n.VeryCamera=l},{"../../engine":139,"../global":66}],90:[function(e,t,n){"use strict";var i,o=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0}),n.VeryLight=void 0;var r,a=(r=BABYLON.TransformNode,o(s,r),Object.defineProperty(s.prototype,"type",{get:function(){return this.light.getTypeID()},enumerable:!1,configurable:!0}),Object.defineProperty(s.prototype,"intensity",{get:function(){return this.light.intensity},set:function(e){this.light.intensity=e},enumerable:!1,configurable:!0}),Object.defineProperty(s.prototype,"diffuse",{get:function(){return this.light.diffuse},set:function(e){this.light.diffuse=e},enumerable:!1,configurable:!0}),Object.defineProperty(s.prototype,"specular",{get:function(){return this.light.specular},set:function(e){this.light.specular=e},enumerable:!1,configurable:!0}),Object.defineProperty(s.prototype,"angle",{get:function(){return this.light instanceof BABYLON.SpotLight?this.light.angle:0},set:function(e){this.light instanceof BABYLON.SpotLight&&(this.light.angle=e)},enumerable:!1,configurable:!0}),Object.defineProperty(s.prototype,"exponent",{get:function(){return this.light instanceof BABYLON.SpotLight?this.light.exponent:0},set:function(e){this.light instanceof BABYLON.SpotLight&&(this.light.exponent=e)},enumerable:!1,configurable:!0}),s);function s(e,t){var n=r.call(this,e.name,t)||this;return e.name+="-Light",n.light=e,n.position.copyFrom(e.getAbsolutePosition()),e.parent=n}n.VeryLight=a},{}],91:[function(e,t,n){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,n,i){void 0===i&&(i=n),Object.defineProperty(e,i,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,i){void 0===i&&(i=n),e[i]=t[n]}),o=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||t.hasOwnProperty(n)||i(t,e,n)};Object.defineProperty(n,"__esModule",{value:!0}),o(e("./picker-color"),n),o(e("./picker-asset"),n),o(e("./keeper"),n)},{"./keeper":92,"./picker-asset":93,"./picker-color":94}],92:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.PickerKeeper=void 0;function i(){new r.PickerColor,new o.PickerAsset}var o=e("./picker-asset"),r=e("./picker-color");n.PickerKeeper=i},{"./picker-asset":93,"./picker-color":94}],93:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.PickerAsset=void 0;function i(){var r=new o.Overlay;function a(e){return e+" assets"}r.class.add("picker-asset"),r.center=!1,r.hidden=!0,editor.call("layout.root").append(r);var s="",l=null,c=!1,d=!1,u=[],h=!1,p="",f="",m=null,g=editor.call("assets:grid"),y=editor.call("layout.assets");editor.call("hotkey:register","picker:assets:close",{key:"esc",callback:function(){r.hidden||(r.hidden=!0)}}),g.on("deselect",function(e){var t;!r.hidden&&e.asset&&(e.asset===l?g.selected=[e]:!d||-1!==(t=u.indexOf(e.asset))&&(u.splice(t,1),editor.emit("picker:assets",u)))}),g.on("select",function(e){if(e.asset){if(r.hidden||"*"!==s&&e.asset.get("type")!==s||e.asset===l)return;e.asset&&(d?(u.push(e.asset),editor.emit("picker:assets",u)):editor.emit("picker:asset",e.asset))}else if(e.script){if(r.hidden||"*"!==s&&"script"!==s)return;e.script&&(d?(u.push(e.script),editor.emit("picker:assets",u)):editor.emit("picker:asset",e.script))}d||(r.hidden=!0)}),r.on("hide",function(){editor.call("assets:filter:type:disabled",!1),editor.call("assets:filter:type",p),editor.call("assets:filter:search",f),editor.call("assets:panel:currentFolder",m),h&&(y.collapsed=!0),editor.call("selector:enabled",!0),g.selected=c,d&&editor.emit("picker:assets",u),editor.emit("picker:asset:close"),y.style.zIndex="",y.style.overflow=""}),editor.method("picker:asset",function(e){var i=e.type;d=!!e.multi,u.length=0,p=editor.call("assets:filter:type"),f=editor.call("assets:filter:search"),m=editor.call("assets:panel:currentFolder"),c=g.selected;var t,n,o=i;"texture"===i?o="textureTarget":"textureatlas"===i?o="textureAtlasTarget":"font"===i&&(o="fontTarget"),editor.call("assets:filter:type","*"===o?"all":o),editor.call("assets:filter:type:disabled",!(!o||"*"===o)),editor.call("selector:enabled",!1),s=i,!(l=e.currentAsset)||(t=editor.call("assets:grid:assetsIndex")[l.get("id")])&&(g.selected=[t],(n=l.get("path")).length?editor.call("assets:panel:currentFolder",editor.call("assets:get",n[n.length-1])):editor.call("assets:panel:currentFolder",null)),y.style.zIndex=102,y.style.overflow="visible",(h=y.collapsed)&&(y.collapsed=!1),r.hidden=!1,y.flash(),setTimeout(function(){var e,t,n;g.selected&&g.selected.length?g.selected[0].element.focus():g.element.focus(),0===g.element.querySelectorAll(".ui-grid-item:not(.hidden)").length&&(n="material"===(t=i)||"cubemap"===t||"text"===t||"json"===t||"html"===t||"shader"===t||"css"===t?"There are no "+a(t)+' in this folder. Click on the <span class="font-icon" style="font-size: 18px">&#57632;</span> button to add one':"There are no "+a(t)+" in this folder. Add one by uploading a "+t+" file",e=n+=f?" or change your search term.":".",editor.call("assets:panel:message",e))},100)}),editor.method("picker:asset:deselect",function(){g.selected=l?[l]:[]}),editor.method("picker:asset:close",function(){r.hidden=!0})}var o=e("../../ui");n.PickerAsset=i},{"../../ui":162}],94:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.PickerColor=void 0;function i(){function a(){for(var e="",t=0;t<o;t++)e+=("00"+c[t].value.toString(16)).slice(-2).toUpperCase();return e}function t(e){d=!0;var t=v.getBoundingClientRect(),n=Math.max(0,Math.min(144,Math.floor(e.clientX-t.left))),i=Math.max(0,Math.min(144,Math.floor(e.clientY-t.top)));l[1]=n/144,l[2]=1-i/144,s=!1;for(var o=z.Tools.hsv2rgb([l[0],l[1],l[2]]),r=0;r<3;r++)c[r].value=o[r];P.value=a(),s=!0,w.style.left=Math.max(4,Math.min(140,n))+"px",w.style.top=Math.max(4,Math.min(140,i))+"px",d=!1}function n(e){d=!0;var t=x.getBoundingClientRect(),n=Math.max(0,Math.min(144,Math.floor(e.clientY-t.top)))/144,i=z.Tools.hsv2rgb([n,l[1],l[2]]);l[0]=n,s=!1;for(var o=0;o<3;o++)c[o].value=i[o];P.value=a(),f(),d=!(s=!0)}function i(e){d=!0;var t=x.getBoundingClientRect(),n=1-Math.max(0,Math.min(144,Math.floor(e.clientY-t.top)))/144;s=!1,M.value=Math.max(0,Math.min(255,Math.round(255*n))),P.value=a(),d=!(s=!0)}function e(){m=!1,editor.emit("picker:color",c.map(function(e){return e.value||0}).slice(0,o))}var s=!0,l=[0,0,0],c=[],o=4,d=!1,r=!1,u=function(){window.removeEventListener("mousemove",t,!1),window.removeEventListener("mouseup",u,!1),r=!1,editor.emit("picker:color:end")},h=function(){window.removeEventListener("mousemove",n,!1),window.removeEventListener("mouseup",h,!1),r=!1,editor.emit("picker:color:end")},p=function(){window.removeEventListener("mousemove",i,!1),window.removeEventListener("mouseup",p,!1),r=!1,editor.emit("picker:color:end")},f=function(){var e,t,n=c.map(function(e){return e.value||0}).slice(0,o),i=z.Tools.rgb2hsv(n);s&&(765!==(e=n[0]+n[1]+n[2])&&0!==e&&(l[0]=i[0]),l[1]=i[1],l[2]=i[2],r=!0,editor.emit("picker:color:start")),O.style.top=Math.floor(144*l[0])+"px",w.style.left=Math.max(4,Math.min(140,144*l[1]))+"px",w.style.top=Math.max(4,Math.min(140,144*(1-l[2])))+"px",3<=o&&(t=z.Tools.hsv2rgb([l[0],1,1]).join(","),v.style.backgroundColor="rgb("+t+")",w.style.backgroundColor="rgb("+n.slice(0,3).join(",")+")",O.style.backgroundColor="rgb("+t+")"),g()},m=!1,g=function(){m||(m=!0,setTimeout(e,1e3/60))},y=new T.Overlay;y.class.add("picker-color"),y.center=!1,y.transparent=!0,y.hidden=!0;var v=document.createElement("div");v.classList.add("pick-rect"),y.append(v),v.addEventListener("mousedown",function(e){t(e),window.addEventListener("mousemove",t,!1),window.addEventListener("mouseup",u,!1),e.stopPropagation(),e.preventDefault(),r=!0,editor.emit("picker:color:start")});var b=document.createElement("div");b.classList.add("white"),v.appendChild(b);var _=document.createElement("div");_.classList.add("black"),v.appendChild(_);var w=document.createElement("div");w.classList.add("handle"),v.appendChild(w);var x=document.createElement("div");x.classList.add("pick-hue"),y.append(x),x.addEventListener("mousedown",function(e){n(e),window.addEventListener("mousemove",n,!1),window.addEventListener("mouseup",h,!1),e.stopPropagation(),e.preventDefault(),r=!0,editor.emit("picker:color:start")});var O=document.createElement("div");O.classList.add("handle"),x.appendChild(O);var B=document.createElement("div");B.classList.add("pick-opacity"),y.append(B),B.addEventListener("mousedown",function(e){i(e),window.addEventListener("mousemove",i,!1),window.addEventListener("mouseup",p,!1),e.stopPropagation(),e.preventDefault(),r=!0,editor.emit("picker:color:start")});var L=document.createElement("div");L.classList.add("handle"),B.appendChild(L);var C=document.createElement("div");C.classList.add("fields"),y.append(C);var A=new T.NumberField({precision:1,step:1,min:0,max:255});c.push(A),A.renderChanges=!1,A.placeholder="r",A.flexGrow="1",A.class.add("field","field-r"),A.on("change",f),C.appendChild(A.element);var k=new T.NumberField({precision:1,step:1,min:0,max:255});c.push(k),k.renderChanges=!1,k.placeholder="g",k.class.add("field","field-g"),k.on("change",f),C.appendChild(k.element);var E=new T.NumberField({precision:1,step:1,min:0,max:255});c.push(E),E.renderChanges=!1,E.placeholder="b",E.class.add("field","field-b"),E.on("change",f),C.appendChild(E.element);var M=new T.NumberField({precision:1,step:1,min:0,max:255});c.push(M),M.renderChanges=!1,M.placeholder="a",M.class.add("field","field-a"),M.on("change",function(e){4===o&&(L.style.top=Math.floor(144*(1-Math.max(0,Math.min(255,e))/255))+"px",L.style.backgroundColor="rgb("+[e,e,e].join(",")+")",g())}),C.appendChild(M.element);var P=new T.TextField;P.renderChanges=!1,P.placeholder="#",P.class.add("field","field-hex"),P.on("change",function(){!function(){if(s){d=!0;var e=P.value.trim().toLowerCase();if(/^([0-9a-f]{2}){3,4}$/.test(e))for(var t=0;t<o;t++)c[t].value=parseInt(e.slice(2*t,2*t+2),16);d=!1}}()}),C.appendChild(P.element),editor.call("layout.root").append(y),editor.call("hotkey:register","picker:color:close",{key:"esc",callback:function(){y.hidden||(y.hidden=!0)}}),y.on("hide",function(){editor.emit("picker:color:close")}),editor.method("picker:color",function(e){for(var t,n=0;n<4;n++)e.length-1<n?y.class.remove("c-"+(n+1)):y.class.add("c-"+(n+1));3<=(o=e.length)&&(t=z.Tools.rgb2hsv(e),l[0]=t[0],l[1]=t[1],l[2]=t[2]),s=!1;for(n=0;n<e.length;n++)c[n].value=e[n];P.value=a(),s=!0,y.hidden=!1,P.elementInput.focus(),setTimeout(function(){P.elementInput.focus(),P.elementInput.select()},100)}),editor.method("picker:color:close",function(){y.hidden=!0}),editor.method("picker:color:rect",function(){return y.rect}),editor.method("picker:color:position",function(e,t){y.position(e,t)}),editor.method("picker:color:set",function(e){if(!d&&!r){var t;3<=o&&(t=z.Tools.rgb2hsv(e),l[0]=t[0],l[1]=t[1],l[2]=t[2]),s=!1;for(var n=0;n<e.length;n++)c[n].value=e[n];P.value=a(),s=!0}})}var T=e("../../ui"),z=e("../utility");n.PickerColor=i},{"../../ui":162,"../utility":124}],95:[function(e,t,n){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,n,i){void 0===i&&(i=n),Object.defineProperty(e,i,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,i){void 0===i&&(i=n),e[i]=t[n]}),o=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||t.hasOwnProperty(n)||i(t,e,n)};Object.defineProperty(n,"__esModule",{value:!0}),o(e("./keeper"),n),o(e("./scenes"),n)},{"./keeper":96,"./scenes":97}],96:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.ScenesKeeper=void 0;function i(){new o.Scenes}var o=e("./scenes");n.ScenesKeeper=i},{"./scenes":97}],97:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.Scenes=void 0;function i(){this._prefix="（未保存）";var e=this;editor.method("make:scene:dirty",function(){document.title.startsWith(e._prefix)||(document.title=e._prefix+document.title),o.Config.isSceneDirty=!0}),editor.method("make:scene:clear",function(){o.Config.isSceneDirty=!1,document.title.startsWith(e._prefix)&&(document.title=document.title.substring(e._prefix.length))})}var o=e("../global");n.Scenes=i},{"../global":66}],98:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.Search=void 0;function i(){editor.method("search:stringEditDistance",function(e,t){if(0===e.length)return t.length;if(0===t.length)return e.length;if(e===t)return 0;for(var n,i=[],o=0;o<=t.length;o++)i[o]=[o];for(n=0;n<=e.length;n++)i[0][n]=n;for(o=1;o<=t.length;o++)for(n=1;n<=e.length;n++)t.charAt(o-1)===e.charAt(n-1)?i[o][n]=i[o-1][n-1]:i[o][n]=Math.min(i[o-1][n-1]+1,Math.min(i[o][n-1]+1,i[o-1][n]+1));return i[t.length][e.length]}),editor.method("search:charsContains",function(e,t){if(e===t)return e.length;for(var n=0,i={},o=0;o<t.length;o++)i[t.charAt(o)]=!0;for(o=0;o<e.length;o++)i[e.charAt(o)]&&n++;return n}),editor.method("search:stringTokenize",function(e){for(var t=[],n=e.replace(/([^A-Z])([A-Z][^A-Z])/g,"$1 $2").replace(/([A-Z0-9]{2,})/g," $1").split(/(\s|\-|_)/g),i=0;i<n.length;i++)n[i]=n[i].toLowerCase().trim(),n[i]&&"-"!==n[i]&&"_"!==n[i]&&t.push(n[i]);return t}),editor.method("search:items",function(e,t,n){if(!(t=(t||"").toLowerCase().trim()))return[];var i=editor.call("search:stringTokenize",t);if(!i.length)return[];(n=n||{}).containsCharsTolerance=n.containsCharsTolerance||.5,n.editsDistanceTolerance=n.editsDistanceTolerance||.5;for(var o=[],r=0;r<e.length;r++){var a=e[r][0].toLowerCase().trim().indexOf(t);o.push({name:e[r][0],item:e[r][1],tokens:editor.call("search:stringTokenize",e[r][0]),edits:1/0,subFull:-1!==a?a:1/0,sub:1/0})}for(r=0;r<i.length;r++)o=function(e,t,n){for(var i=[],o=0;o<e.length;o++){var r=e[o];if(r.subFull===1/0)if(r.name!==t&&0!==r.name.indexOf(t)){if(!(editor.call("search:charsContains",t,r.name)/t.length<n.containsCharsTolerance)){for(var a=1/0,s=1/0,l=0;l<r.tokens.length;l++){if(r.tokens[l]===t){a=0,s=l;break}var c=editor.call("search:stringEditDistance",t,r.tokens[l]);(s===1/0||c<a)&&-1!==r.tokens[l].indexOf(t)?(s=l,a=c):s===1/0&&c<a&&c/Math.max(t.length,r.tokens[l].length)<=n.editsDistanceTolerance&&(a=c)}a!==1/0&&(i.push(r),r.edits=r.edits===1/0?a:r.edits+a,r.sub=r.sub===1/0?s:r.sub+s)}}else i.push(r),r.edits===1/0&&(r.edits=0),r.sub===1/0&&(r.sub=0);else i.push(r),r.edits===1/0&&(r.edits=0),r.sub===1/0&&(r.sub=r.subFull)}return i}(o,i[r],n);o.sort(function(e,t){return e.subFull!==t.subFull?e.subFull-t.subFull:e.sub!==t.sub?e.sub-t.sub:e.edits!==t.edits?e.edits-t.edits:e.name.length-t.name.length});for(r=0;r<o.length;r++)o[r]=o[r].item;return n.hasOwnProperty("limitResults")&&o.length>n.limitResults&&(o=o.slice(0,n.limitResults)),o})}n.Search=i},{}],99:[function(e,t,n){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,n,i){void 0===i&&(i=n),Object.defineProperty(e,i,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,i){void 0===i&&(i=n),e[i]=t[n]}),o=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||t.hasOwnProperty(n)||i(t,e,n)};Object.defineProperty(n,"__esModule",{value:!0}),o(e("./selector"),n),o(e("./selector-history"),n)},{"./selector":101,"./selector-history":100}],100:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.SelectorHistory=void 0;function i(){}n.SelectorHistory=i},{}],101:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.Selector=void 0;var i=e("../../lib"),o=(r.prototype.init=function(){function r(e){switch(e){case"entity":return"resource_id";case"asset":return"id"}return""}function a(){c=!1,editor.emit("selector:change",s.selector.type,s.selector.array())}var s=this,l={},c=!1;s.selector.on("add",function(e){var t,n,i;t=s.type,n=e,(i=r(t))&&(l[t]||(l[t]={}),l[t][n.get(i)]=n.once("destroy",function(){var e=editor.call("selector:history");e&&editor.call("selector:history",!1),s.selector.remove(n),delete l[t][n.get(i)],e&&editor.call("selector:history",!0)})),editor.emit("selector:add",e,s.type),c||(c=!0,setTimeout(a,0))}),s.selector.on("remove",function(e){var t,n,i,o;editor.emit("selector:remove",e,s.type),t=s.type,n=e,l[t]&&(!(i=r(t))||(o=l[t][n.get(i)])&&o.unbind()),0===s.length&&(s.type=""),c||(c=!0,setTimeout(a,0))}),editor.method("selector:toggle",function(e,t){s.enabled&&(s.selector.length&&s.selector.type!==e&&s.selector.clear(),s.selector.type=e,s.type=e,s.selector.has(t)?s.selector.remove(t):s.selector.add(t))}),editor.method("selector:set",function(e,t){var n;if(s.enabled&&(s.selector.clear(),e&&t.length&&("asset"===e?t=t.filter(function(e){return s.legacyScripts&&"script"===e.get("type")||!!editor.call("assets:get",e.get("id"))}):"entity"===e&&(t=t.filter(function(e){return!!editor.call("entities:get",e.get("resource_id"))}),n=editor.call("entities:root"),-1!==t.indexOf(n)&&(editor.call("selector:set","entity",[]),e="editorSettings",t=[editor.call("settings:data")])),t.length))){s.selector.type=e,s.type=e;for(var i=0;i<t.length;i++)s.selector.add(t[i])}}),editor.method("selector:add",function(e,t){s.enabled&&(s.selector.has(t)||(0<s.selector.length&&s.selector.type!==e&&s.selector.clear(),"entity"===e&&"root"===t.get("type")&&(editor.call("selector:set","entity",[]),e="editorSettings",t=editor.call("settings:data")),s.selector.type=e,s.type=e,s.selector.add(t)))}),editor.method("selector:remove",function(e){s.enabled&&s.selector.has(e)&&s.selector.remove(e)}),editor.method("selector:clear",function(){s.enabled&&s.selector.clear()}),editor.method("selector:type",function(){return s.selector.type}),editor.method("selector:count",function(){return s.selector.length}),editor.method("selector:items",function(){return s.selector.array()}),editor.method("selector:itemsRaw",function(){return s.selector.data}),editor.method("selector:has",function(e){return s.selector.has(e)}),editor.method("selector:enabled",function(e){s.enabled=e})},r);function r(){this.enabled=!0,this.legacyScripts=!1,this.type="",this.length=0,this.selector=new i.ObserverList,this.evtChange=!1,this.init()}n.Selector=o},{"../../lib":143}],102:[function(e,t,n){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,n,i){void 0===i&&(i=n),Object.defineProperty(e,i,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,i){void 0===i&&(i=n),e[i]=t[n]}),o=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||t.hasOwnProperty(n)||i(t,e,n)};Object.defineProperty(n,"__esModule",{value:!0}),o(e("./settings-attribute"),n),o(e("./keeper"),n)},{"./keeper":103,"./settings-attribute":104}],103:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.SettingsKeeper=void 0;function i(){new o.SettingsAttribute}var o=e("./settings-attribute");n.SettingsKeeper=i},{"./settings-attribute":104}],104:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.SettingsAttribute=void 0;function i(){var n="新建场景",t=new o.Observer({scene_name:n});editor.method("settings:data",function(){return t}),editor.on("scene:name",function(e){t.set("scene_name",e),n=e}),editor.method("editorSettings:panel:unfold",function(e){var t=editor.call("layout.attributes").dom.querySelector(".ui-panel.component.foldable."+e);t&&t.ui&&(t.ui.folded=!1)}),editor.on("attributes:inspect[editorSettings]",function(){editor.call("attributes:header","场景设置")}),editor.on("attributes:inspect[editorSettings]",function(){var e=editor.call("attributes:addPanel");e.class.add("component");var t=editor.call("attributes:addField",{parent:e,name:"场景名",type:"string",value:n});t.on("change",function(e){editor.emit("scene:name",e);var t=editor.call("entities:root");t&&(t.set("name",e),r.BabylonLoader.changeSceneName(t.get("resource_id"),e))})})}var o=e("../../lib"),r=e("../middleware/loader/babylonLoader");n.SettingsAttribute=i},{"../../lib":143,"../middleware/loader/babylonLoader":86}],105:[function(e,t,n){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,n,i){void 0===i&&(i=n),Object.defineProperty(e,i,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,i){void 0===i&&(i=n),e[i]=t[n]}),o=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||t.hasOwnProperty(n)||i(t,e,n)};Object.defineProperty(n,"__esModule",{value:!0}),o(e("./toolbar-top-control"),n),o(e("./keeper"),n),o(e("./toolbar-logo"),n),o(e("./toolbar-gizmos"),n),o(e("./toolbar-history"),n),o(e("./toolbar-help"),n),o(e("./toolbar-control"),n),o(e("./toolbar-editor-settings"),n),o(e("./toolbar-publish"),n),o(e("./toolbar-scene"),n),o(e("./toolbar-camera"),n),o(e("./toolbar-status"),n)},{"./keeper":106,"./toolbar-camera":107,"./toolbar-control":108,"./toolbar-editor-settings":109,"./toolbar-gizmos":110,"./toolbar-help":111,"./toolbar-history":112,"./toolbar-logo":113,"./toolbar-publish":114,"./toolbar-scene":115,"./toolbar-status":116,"./toolbar-top-control":117}],106:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.ToolbarKeeper=void 0;function i(){new p.ToolbarStatus,new o.ToolbarLogo,new r.ToolbarGizmos,new a.ToolbarHistory,new s.ToolbarHelp,new l.ToolbarControl,new c.ToolbarEditorSettings,new d.ToolbarPublish,new u.ToolbarScene,new h.ToolbarCamera}var o=e("./toolbar-logo"),r=e("./toolbar-gizmos"),a=e("./toolbar-history"),s=e("./toolbar-help"),l=e("./toolbar-control"),c=e("./toolbar-editor-settings"),d=e("./toolbar-publish"),u=e("./toolbar-scene"),h=e("./toolbar-camera"),p=e("./toolbar-status");n.ToolbarKeeper=i},{"./toolbar-camera":107,"./toolbar-control":108,"./toolbar-editor-settings":109,"./toolbar-gizmos":110,"./toolbar-help":111,"./toolbar-history":112,"./toolbar-logo":113,"./toolbar-publish":114,"./toolbar-scene":115,"./toolbar-status":116}],107:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.ToolbarCamera=void 0;function i(){var t=editor.call("layout.viewport"),e={"透视相机":"透视相机|perspective","正交相机":"正交相机|orthographic","左视图":"左视图|left","右视图":"右视图|right","顶视图":"顶视图|top","底视图":"底视图|bottom","前视图":"前视图|front","后视图":"后视图|back"},n=new o.SelectField({options:e,optionClassNamePrefix:"viewport-camera"});n.disabledClick=!0,n.class.add("viewport-camera");var i=o.Tooltip.attach({target:n.element,text:"场景相机类型选择",align:"top",root:editor.call("layout.root")});n.on("open",function(){i.disabled=!0}),n.on("close",function(e){i.disabled=!1,e&&(n.value=e)}),n.on("change",function(e){editor.call("camera:change:mode",e),t.value=e}),t.append(n),n.value="透视相机",editor.method("camera:ortho:set",function(){n.value="正交相机"}),new BABYLON.Vector3(9.2,6,9),new BABYLON.Vector3(-25,45,0),new BABYLON.Vector3(0,1e3,0),new BABYLON.Vector3(-90,0,0),new BABYLON.Vector3(0,-1e3,0),new BABYLON.Vector3(90,0,0),new BABYLON.Vector3(0,0,1e3),new BABYLON.Vector3(0,0,0),new BABYLON.Vector3(0,0,-1e3),new BABYLON.Vector3(0,180,0),new BABYLON.Vector3(-1e3,0,0),new BABYLON.Vector3(0,-90,0),new BABYLON.Vector3(1e3,0,0),new BABYLON.Vector3(0,90,0)}var o=e("../../ui");n.ToolbarCamera=i},{"../../ui":162}],108:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.ToolbarControl=void 0;function i(){}n.ToolbarControl=i},{}],109:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.ToolbarEditorSettings=void 0;function i(){var e=o.VeryEngine.toolbar,t=new r.Button("&#57652;");t.class.add("pc-icon","editor-settings","bottom"),e.append(t),t.on("click",function(){}),editor.on("attributes:clear",function(){t.class.remove("active")}),editor.on("attributes:inspect[editorSettings]",function(){editor.call("attributes.rootPanel").collapsed=!1,t.class.add("active")}),editor.on("viewport:expand",function(e){t.disabled=e}),r.Tooltip.attach({target:t.element,text:"设置",align:"left",root:editor.call("layout.root")})}var o=e("../../engine"),r=e("../../ui");n.ToolbarEditorSettings=i},{"../../engine":139,"../../ui":162}],110:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.ToolbarGizmos=void 0;function i(){var i=editor.call("layout.root"),o=editor.call("layout.toolbar"),r=null,a={};[{icon:"&#57617;",tooltip:"移动",op:"translate"},{icon:"&#57619;",tooltip:"旋转",op:"rotate"},{icon:"&#57618;",tooltip:"缩放",op:"scale"}].forEach(function(e,t){var n=new l.Button(e.icon);n.op=e.op,n.class.add("pc-icon"),(a[e.op]=n).on("click",function(){r.op!==n.op&&(r.class.remove("active"),r.tooltip.class.add("innactive"),(r=n).class.add("active"),r.tooltip.class.remove("innactive"),editor.call("gizmo:type",n.op),"translate"===n.op?c.GizmosCenter.setMode(0):"rotate"===n.op?c.GizmosCenter.setMode(1):c.GizmosCenter.setMode(2))}),o.append(n),n.tooltip=l.Tooltip.attach({target:n.element,text:e.tooltip,align:"left",root:i}),"translate"===e.op?(r=n).class.add("active"):n.tooltip.class.add("innactive")});var e=new l.Button("&#57624;");e.class.add("pc-icon"),o.append(e),e.on("click",function(){e.class.contains("active")?(e.class.remove("active"),t.html='<span style="color:#fff">局部坐标</span> / 世界坐标'):(e.class.add("active"),t.html='局部坐标 / <span style="color:#fff">世界坐标</span>'),editor.emit("gizmo:coordSystem",e.class.contains("active")?"world":"local")});var t=l.Tooltip.attach({target:e.element,align:"left",root:i});t.html='<span style="color:#fff">局部坐标</span> / 世界坐标',t.class.add("innactive"),editor.on("permissions:writeState",function(e){});var n=new l.Button("&#57623;");n.disabled=!0,n.class.add("pc-icon"),n.on("click",function(){editor.call("viewport:focus")}),o.append(n),editor.on("attributes:clear",function(){n.disabled=!0,s.class.add("innactive")}),editor.on("attributes:inspect[*]",function(e){n.disabled="entity"!==e,"entity"===e?s.class.remove("innactive"):s.class.add("innactive")});var s=l.Tooltip.attach({target:n.element,text:"镜头聚焦当前物体 / F键",align:"left",root:i});s.class.add("innactive"),editor.call("hotkey:register","viewport:focus",{key:"f",callback:function(){editor.call("viewport:focus")}})}var l=e("../../ui"),c=e("../gizmos/gizmo-center");n.ToolbarGizmos=i},{"../../ui":162,"../gizmos/gizmo-center":55}],111:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.ToolbarHelp=void 0;function i(){var e=o.VeryEngine.toolbar,t=new r.Button("&#57656;");t.class.add("pc-icon","help-howdoi","bottom","push-top"),e.append(t),t.on("click",function(){window.open("http://doc.veryengine.cn/readme/web/#/12?page_id=816","_blank")}),r.Tooltip.attach({target:t.element,text:"引擎版本更新说明",align:"left",root:editor.call("layout.root")})}var o=e("../../engine"),r=e("../../ui");n.ToolbarHelp=i},{"../../engine":139,"../../ui":162}],112:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.ToolbarHistory=void 0;function i(){var e=a.VeryEngine.root,t=a.VeryEngine.toolbar,n=new s.Button("&#57620;");n.class.add("pc-icon"),n.enabled=editor.call("history:canUndo"),t.append(n),editor.on("history:canUndo",function(e){(n.enabled=e)?i.class.remove("innactive"):i.class.add("innactive")}),n.on("click",function(){editor.call("history:undo")});var i=s.Tooltip.attach({target:n.element,text:"撤销",align:"left",root:e});editor.call("history:canUndo")||i.class.add("innactive");var o=new s.Button("&#57621;");o.class.add("pc-icon"),o.enabled=editor.call("history:canRedo"),t.append(o),editor.on("history:canRedo",function(e){(o.enabled=e)?r.class.remove("innactive"):r.class.add("innactive")}),o.on("click",function(){editor.call("history:redo")});var r=s.Tooltip.attach({target:o.element,text:"重做",align:"left",root:e});editor.call("history:canUndo")||r.class.add("innactive"),editor.on("permissions:writeState",function(e){n.hidden=o.hidden=!e})}var a=e("../../engine"),s=e("../../ui");n.ToolbarHistory=i},{"../../engine":139,"../../ui":162}],113:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.ToolbarLogo=void 0;function i(){editor.call("layout.root");var e=editor.call("layout.toolbar"),t=new o.Button;t.class.add("logo"),t.on("click",function(){console.log("logo click")}),e.append(t)}var o=e("../../ui");n.ToolbarLogo=i},{"../../ui":162}],114:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.ToolbarPublish=void 0;function i(){var e=o.VeryEngine.toolbar,t=new r.Button("&#57911;");t.class.add("pc-icon","publish-download"),e.append(t),t.on("click",function(){editor.call("picker:publish")}),editor.on("picker:publish:open",function(){t.class.add("active")}),editor.on("picker:publish:close",function(){t.class.remove("active")}),r.Tooltip.attach({target:t.element,text:"发布",align:"left",root:editor.call("layout.root")})}var o=e("../../engine"),r=e("../../ui");n.ToolbarPublish=i},{"../../engine":139,"../../ui":162}],115:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.ToolbarScene=void 0;function i(){var e=r.VeryEngine.root,t=r.VeryEngine.viewportPanel,n=new a.Panel;n.class.add("widget-title"),t.append(n),editor.method("layout.toolbar.scene",function(){return n});var i=new a.Label;i.text="当前项目名称",i.class.add("project-name"),i.renderChanges=!1,n.append(i),i.on("click",function(e){}),editor.method("toolbar.project.set",function(e){i.text=e}),a.Tooltip.attach({target:i.element,text:"项目名",align:"top",root:e});var o=new a.Label;o.text="当前场景名",o.class.add("scene-name"),o.renderChanges=!1,n.append(o),editor.method("toolbar.scene.set",function(e){o.text=e}),a.Tooltip.attach({target:o.element,text:"场景名",align:"top",root:e}),editor.on("scene:name",function(e){o.text=e}),o.on("click",function(){editor.call("selector:set","editorSettings",[editor.call("settings:data")])}),editor.on("attributes:clear",function(){o.class.remove("active")}),editor.on("attributes:inspect[editorSettings]",function(){o.class.add("active")}),editor.on("scene:unload",function(){o.text=""})}var r=e("../../engine"),a=e("../../ui");n.ToolbarScene=i},{"../../engine":139,"../../ui":162}],116:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.ToolbarStatus=void 0;function i(){var i={},e=editor.call("layout.statusBar"),t=new a.Label("VeRyEngine");t.renderChanges=!1,t.class.add("status"),e.append(t);var o=new a.Progress;o.class.add("jobsProgress"),e.append(o);var r=new a.Label("0");r.renderChanges=!1,r.class.add("jobsCount"),e.append(r),editor.method("status:text",function(e){t.text=e,t.class.remove("error")}),editor.method("status:error",function(e){t.text=e,t.class.add("error")}),editor.method("status:job",function(e,t){i.hasOwnProperty(e)&&void 0===t?delete i[e]:i[e]=t,function(){var e=Object.keys(i).length;if(r.text=e.toString(),0<e){var t,n=1;for(t in i)i[t]<n&&(n=i[t]);o.progress=n,o.class.add("active")}else o.class.remove("active"),o.progress=1}()})}var a=e("../../ui");n.ToolbarStatus=i},{"../../ui":162}],117:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.ToolbarTopControl=void 0;function i(){var e=new r.Panel;e.class.add("top-controls"),a.VeryEngine.viewportPanel.append(e),editor.method("layout.toolbar.launch",function(){return e});var t=new r.Button("&#57639;");t.class.add("icon","expand"),e.append(t),t.on("click",function(){editor.call("viewport:expand")}),editor.on("viewport:expand",function(e){e?(n.text="还原 / 空格键",t.class.add("active")):(n.text="最大化 / 空格键",t.class.remove("active")),n.hidden=!0});var n=r.Tooltip.attach({target:t.element,text:"最大化 / 空格键",align:"top",root:a.VeryEngine.root}),i=new r.Panel;i.class.add("launch"),e.append(i),i.style.marginRight="2px";var o=new r.Button("&#57649;");o.class.add("icon"),i.append(o),o.on("click",function(){window.open(window.location.protocol+"//"+window.location.host+"/publish/"+s.Config.projectID)}),r.Tooltip.attach({target:o.element,text:"运行",align:"top",root:a.VeryEngine.root})}var r=e("../../ui"),a=e("../../engine"),s=e("../global");n.ToolbarTopControl=i},{"../../engine":139,"../../ui":162,"../global":66}],118:[function(e,t,n){"use strict";var i,o=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0}),n.AjaxRequest=n.Ajax=void 0;var r=e("../../lib"),l=(a.get=function(e){return new s({url:e})},a.post=function(e,t){return new s({method:"POST",url:e,data:t})},a.put=function(e,t){return new s({method:"PUT",url:e,data:t})},a.delete=function(e){return new s({method:"DELETE",url:e})},a.param=function(e,t){a.params[e]=t},a.params={},a);function a(e){return"string"==typeof e&&(e={url:e}),new s(e)}n.Ajax=l;var c,s=(c=r.Events,o(d,c),d.prototype._onLoad=function(){if(this._progress=1,this.emit("progress",1),200===this._xhr.status||201===this._xhr.status)if(this.notJson)this.emit("load",this._xhr.status,this._xhr.responseText);else{try{var e=JSON.parse(this._xhr.responseText)}catch(e){return void this.emit("error",this._xhr.status||0,new Error("invalid json"))}this.emit("load",this._xhr.status,e)}else try{var t=(e=JSON.parse(this._xhr.responseText)).message;t=(t=t||(e.error||e.response&&e.response.error))||this._xhr.responseText,this.emit("error",this._xhr.status,t)}catch(e){this.emit("error",this._xhr.status)}},d.prototype._onError=function(e){this.emit("error",0,e)},d.prototype._onAbort=function(e){this.emit("error",0,e)},d.prototype._onProgress=function(e){var t;!e.lengthComputable||(t=e.loaded/e.total)!==this._progress&&(this._progress=t,this.emit("progress",this._progress))},d.prototype.abort=function(){this._xhr.abort()},d);function d(e){var t=c.call(this)||this;if(t._progress=0,!e)throw new Error("ajax请求无参数，请检查！");t._progress=0,t.emit("progress",t._progress),t._xhr=new XMLHttpRequest,e.cookies&&(t._xhr.withCredentials=!0),t._xhr.addEventListener("load",t._onLoad.bind(t),!1),t._xhr.upload.addEventListener("progress",t._onProgress.bind(t),!1),t._xhr.addEventListener("error",t._onError.bind(t),!1),t._xhr.addEventListener("abort",t._onAbort.bind(t),!1);var n=e.url;if(e.query&&Object.keys(e.query).length){-1===n.indexOf("?")&&(n+="?");var i=[];for(s in e.query)i.push(s+"="+e.query[s]);n+=i.join("&")}var o=n.split("{{");if(1<o.length){for(var r=1;r<o.length;r++){var a=o[r].indexOf("}}"),s=o[r].slice(0,a);void 0!==l.params[s]&&(o[r]=l.params[s]+o[r].slice(a+2))}n=o.join("")}if(t._xhr.open(e.method||"GET",n,!0),t.notJson=e.notJson||!1,e.ignoreContentType||"PUT"!==e.method&&"POST"!==e.method&&"DELETE"!==e.method||t._xhr.setRequestHeader("Content-Type","application/json"),e.headers)for(var s in e.headers)t._xhr.setRequestHeader(s,e.headers[s]);return!e.data||"string"==typeof e.data||e.data instanceof FormData||(e.data=JSON.stringify(e.data)),t._xhr.send(e.data||null),t}n.AjaxRequest=s},{"../../lib":143}],119:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.ComponentsLogos=void 0;function i(){editor.method("components:logos",function(){return{animation:"&#57875;",audiolistener:"&#57750;",audiosource:"&#57751;",sound:"&#57751;",camera:"&#57874;",collision:"&#57735;",directional:"&#57746;",point:"&#57745;",spot:"&#57747;",light:"&#57748;",model:"&#57736;",particlesystem:"&#57753;",rigidbody:"&#57737;",script:"&#57910;",screen:"&#58371;",sprite:"&#58261;",element:"&#58232;",layoutgroup:"&#57667;",layoutchild:"&#57667;",scrollview:"&#58376;",scrollbar:"&#58377;",button:"&#58373;",zone:"&#57910;","2d-screen":"&#58371;","3d-screen":"&#58372;","text-element":"&#58374;","image-element":"&#58005;","group-element":"&#58375;",userinterface:"&#58370;"}})}n.ComponentsLogos=i},{}],120:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.ContextMenu=void 0;function i(){window.addEventListener("contextmenu",function(e){e.preventDefault()},!1)}n.ContextMenu=i},{}],121:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.Debug=void 0;var i=(o.prototype.log=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];this.allow&&console.log(e,t)},o.prototype.warn=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];this.allow&&console.warn(e,t)},o.prototype.error=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];this.allow&&console.error(e,t)},o);function o(e){void 0===e&&(e=!0),this.allow=e}n.Debug=i},{}],122:[function(e,t,i){(function(t,n){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.EventProxy=void 0;var e=(r.prototype.addListener=function(e,t){return this.debug("Add listener for %s",e),this._callbacks[e]=this._callbacks[e]||[],this._callbacks[e].push(t),this},r.prototype.bind=function(e,t){return this.addListener(e,t)},r.prototype.on=function(e,t){return this.addListener(e,t)},r.prototype.subscribe=function(e,t){return this.addListener(e,t)},r.prototype.headbind=function(e,t){return this.debug("Add listener for %s",e),this._callbacks[e]=this._callbacks[e]||[],this._callbacks[e].unshift(t),this},r.prototype.removeListener=function(e,t){var n=this._callbacks;if(e)if(t){var i=n[e];if(i)for(var o=i.length,r=0;r<o;r++)t===i[r]&&(this.debug("Remove a listener of %s",e),i.splice(r,1))}else this.debug("Remove all listeners of %s",e),n[e]=[];else this.debug("Remove all listeners"),this._callbacks={};return this},r.prototype.unbind=function(e,t){return this.removeListener(e,t)},r.prototype.removeAllListeners=function(){return this.unbind()},r.prototype.bindForAll=function(e){this.bind(this.ALL_EVENT,e)},r.prototype.unbindForAll=function(e){this.unbind(this.ALL_EVENT,e)},r.prototype.trigger=function(e,t){for(var n,i,o,r,a=[],s=2;s<arguments.length;s++)a[s-2]=arguments[s];var l=2,c=this._callbacks;for(this.debug("Emit event %s with data %j",e,t);l--;)if(n=c[l?e:this.ALL_EVENT])for(o=0,r=n.length;o<r;o++)if(i=n[o]){for(var a=[],d=l?1:0;d<arguments.length;d++)a.push(arguments[d]);i.apply(this,a)}else n.splice(o,1),o--,r--;return this},r.prototype.emit=function(e,t){return this.trigger(e,t)},r.prototype.fire=function(e,t){return this.trigger(e,t)},r.prototype.once=function(e,t){var n=this,i=function(){t.apply(n,arguments),n.unbind(e,i)};return this.bind(e,i),this},r.prototype.immediate=function(e,t,n){return this.bind(e,t),this.trigger(e,n),this},r.prototype._assign=function(e,t,n){var i=this,o=0,r={},a=e,s=t,l=n;if("function"==typeof s){this.debug("Assign listener for events %j, once is %s",a,!!l);for(var c=a.length,d=0;d<c;d++)!function(t){l?i.once(t,function(e){i._fired[t]=i._fired[t]||{},i._fired[t].data=e,r[t]||(r[t]=!0,o++)}):i.bind(t,function(e){i._fired[t]=i._fired[t]||{},i._fired[t].data=e,r[t]||(r[t]=!0,o++)})}(a[d]);var u=function(e){if(!(o<c)&&r[e]){for(var t=[],n=0;n<c;n++)t.push(i._fired[a[n]].data);l&&i.unbindForAll(u),i.debug("Events %j all emited with data %j",a,t),s.apply(null,t)}};i.bindForAll(u)}},r.prototype.all=function(e,t,n){var i=[];return"string"==typeof e?i.push(e):i=this.CONCAT.apply(i,e),"string"==typeof t?i.push(t):i=this.CONCAT.apply(i,t),this._assign.apply(this,[i,n,!0]),this},r.prototype.assign=function(e,t,n){return this.all(e,t,n)},r.prototype.fail=function(e){var t=this;return t.once("error",function(){t.unbind(),e.apply(null,arguments)}),this},r.prototype.throw=function(e){this.emit("error",e)},r.prototype.tail=function(e,t,n){var i=[];return"string"==typeof e?i.push(e):i=this.CONCAT.apply(i,e),"string"==typeof t?i.push(t):i=this.CONCAT.apply(i,t),this._assign.apply(this,[i,n,!1]),this},r.prototype.assignAll=function(e,t,n){return this.tail(e,t,n)},r.prototype.assignAlways=function(e,t,n){return this.tail(e,t,n)},r.prototype.after=function(n,i,o){if(0===i)return o.call(null,[]),this;var r=this,a=[];this._after=this._after||{};var s=n+"_group";this._after[s]={index:0,results:[]},this.debug("After emit %s times, event %s's listenner will execute",i,n);var l=function(e,t){e===n&&(i--,a.push(t),i<1&&(r.debug("Event %s was emit %s, and execute the listenner",n,i),r.unbindForAll(l),o.apply(null,[a]))),e===s&&(i--,r._after[s].results[t.index]=t.result,i<1&&(r.debug("Event %s was emit %s, and execute the listenner",n,i),r.unbindForAll(l),o.call(null,r._after[s].results)))};return r.bindForAll(l),this},r.prototype.group=function(e,n){var i=this,o=e+"_group",r=i._after[o].index;return i._after[o].index++,function(e,t){e&&i.throw(e),i.emit(o,{index:r,result:n?n.apply(null,i.SLICE.call(arguments,1)):t})}},r.prototype.any=function(e,t,n){var i=this,o=i.SLICE.call(arguments,0,-1),r=o.join("_");i.debug("Add listenner for Any of events %j emit",o),i.once(r,n);for(var a=0;a<o.length;a++)!function(t){i.bind(t,function(e){i.debug("One of events %j emited, execute the listenner"),i.trigger(r,{data:e,eventName:t})})}(o[a])},r.prototype.not=function(n,i){var o=this;o.debug("Add listenner for not event %s",n),o.bindForAll(function(e,t){e!==n&&(o.debug("listenner execute of event %s emit, but not event %s.",e,n),i(t))})},r.prototype.done=function(i,o){var r=this;return function(e,t){if(e)return r.emit.apply(r,["error",e]);var n=r.SLICE.call(arguments,1);return"string"==typeof i?o?r.emit(i,o.apply(null,n)):r.emit.apply(r,[i,n]):arguments.length<=2?i(t):void i.apply(null,n)}},r.create=function(){return new r},r.createWithArgs=function(e,t,n){var i=new r,o=[];return"string"==typeof e?o.push(e):o=i.CONCAT.apply(o,e),"string"==typeof t?o.push(t):o=i.CONCAT.apply(o,t),i._assign.apply(this,[o,n,!0]),i},r);function r(e){this._fired={},this.SLICE=Array.prototype.slice,this.CONCAT=Array.prototype.concat,this.ALL_EVENT="__all__",this.later=void 0!==n&&n||void 0!==t&&t.nextTick||function(e){setTimeout(e,0)},this.debug=e||function(){},this._callbacks={}}i.EventProxy=e}).call(this,e("_process"),e("timers").setImmediate)},{_process:1,timers:3}],123:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.GUID=void 0;var i=(o.create=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)})},o);function o(){}n.GUID=i},{}],124:[function(e,t,n){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,n,i){void 0===i&&(i=n),Object.defineProperty(e,i,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,i){void 0===i&&(i=n),e[i]=t[n]}),o=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||t.hasOwnProperty(n)||i(t,e,n)};Object.defineProperty(n,"__esModule",{value:!0}),o(e("./components-logos"),n),o(e("./context-menu"),n),o(e("./guid"),n),o(e("./eventproxy"),n),o(e("./debug"),n),o(e("./tools"),n),o(e("./ajax"),n),o(e("./sha1"),n)},{"./ajax":118,"./components-logos":119,"./context-menu":120,"./debug":121,"./eventproxy":122,"./guid":123,"./sha1":125,"./tools":126}],125:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.SHA1=void 0;var i=(g.add=function(e,t){return(2147483647&e)+(2147483647&t)^2147483648&e^2147483648&t},g.SHA1hex=function(e){for(var t="",n=7;0<=n;n--)t+="0123456789abcdef".charAt(e>>4*n&15);return t},g.AlignSHA1=function(e){for(var t=1+(e.length+8>>6),n=new Array(16*t),i=0;i<16*t;i++)n[i]=0;for(i=0;i<e.length;i++)n[i>>2]|=e.charCodeAt(i)<<24-8*(3&i);return n[i>>2]|=128<<24-8*(3&i),n[16*t-1]=8*e.length,n},g.rol=function(e,t){return e<<t|e>>>32-t},g.ft=function(e,t,n,i){return e<20?t&n|~t&i:!(e<40)&&e<60?t&n|t&i|n&i:t^n^i},g.kt=function(e){return e<20?1518500249:e<40?1859775393:e<60?-1894007588:-899497514},g.SHA1=function(e){for(var t=g.AlignSHA1(e),n=new Array(80),i=1732584193,o=-271733879,r=-1732584194,a=271733878,s=-1009589776,l=0;l<t.length;l+=16){for(var c=i,d=o,u=r,h=a,p=s,f=0;f<80;f++){n[f]=f<16?t[l+f]:g.rol(n[f-3]^n[f-8]^n[f-14]^n[f-16],1);var m=g.add(g.add(g.rol(i,5),g.ft(f,o,r,a)),g.add(g.add(s,n[f]),g.kt(f))),s=a,a=r,r=g.rol(o,30),o=i,i=m}i=g.add(i,c),o=g.add(o,d),r=g.add(r,u),a=g.add(a,h),s=g.add(s,p)}return g.SHA1hex(i)+g.SHA1hex(o)+g.SHA1hex(r)+g.SHA1hex(a)+g.SHA1hex(s)},g);function g(){}n.SHA1=i},{}],126:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.Tools=void 0;var g=e("../../engine"),i=e("./sha1"),o=(r.eulerAngleToRadian=function(e){var t=Math.PI/180;return e.multiplyByFloats(t,t,t)},r.radianToEulerAngle=function(e){var t=180/Math.PI;return e.multiplyByFloats(t,t,t)},r.eulerAngleFloatToRadian=function(e){return e*Math.PI/180},r.radianFloatToEulerAngle=function(e){return 180*e/Math.PI},r.vector3ToArray=function(e){return[e.x,e.y,e.z]},r.quatTransfromVector3=function(e,t){var n=BABYLON.Vector3.Zero(),i=t.x,o=t.y,r=t.z,a=e.x,s=e.y,l=e.z,c=e.w,d=c*i+s*r-l*o,u=c*o+l*i-a*r,h=c*r+a*o-s*i,p=-a*i-s*o-l*r;return n.x=d*c+p*-a+u*-l-h*-s,n.y=u*c+p*-s+h*-a-d*-l,n.z=h*c+p*-l+d*-s-u*-a,n},r.quatMultiplyVector3=function(e,t){var n=2*e.x,i=2*e.y,o=2*e.z,r=e.x*n,a=e.y*i,s=e.z*o,l=e.x*i,c=e.x*o,d=e.y*o,u=e.w*n,h=e.w*i,p=e.w*o,f=BABYLON.Vector3.Zero();return f.x=(1-(a+s))*t.x+(l-p)*t.y+(c+h)*t.z,f.y=(l+p)*t.x+(1-(r+s))*t.y+(d-u)*t.z,f.z=(c-h)*t.x+(d+u)*t.y+(1-(r+a))*t.z,f},r.clampAngle=function(e,t,n){return e<-360&&(e+=360),360<e&&(e-=360),e<t?e=t:n<e&&(e=n),e},r.worldToScreenPoint=function(e,t,n,i){return BABYLON.Vector3.Project(e,BABYLON.Matrix.Identity(),t.getTransformMatrix(),n.viewport.toGlobal(i.getRenderWidth(),i.getRenderHeight()))},r.lerpVector2=function(e,t,n){var i=BABYLON.Vector2.Zero();return n<0&&(n=0),1<n&&(n=1),i.x=e.x+n*(t.x-e.x),i.y=e.y+n*(t.y-e.y),i},r.lerpVector3=function(e,t,n){var i=BABYLON.Vector3.Zero();return n<0&&(n=0),1<n&&(n=1),i.x=e.x+n*(t.x-e.x),i.y=e.y+n*(t.y-e.y),i.z=e.z+n*(t.z-e.z),i},r.lerpVector4=function(e,t,n){var i=BABYLON.Vector4.Zero();return n<0&&(n=0),1<n&&(n=1),i.x=e.x+n*(t.x-e.x),i.y=e.y+n*(t.y-e.y),i.z=e.z+n*(t.z-e.z),i.w=e.w+n*(t.w-e.w),i},r.transformLocalToWorldDirection=function(e,t){if(e){var n=e.computeWorldMatrix();return BABYLON.Vector3.TransformCoordinates(t,n).subtract(e.getAbsolutePosition())}return t},r.sha1=function(e){return i.SHA1.SHA1(e)},r.rgb2hsv=function(e){function t(e){return(d-e)/6/u+.5}var n,i,o,r,a=e[0]/255,s=e[1]/255,l=e[2]/255,c=0,d=Math.max(a,s,l),u=d-Math.min(a,s,l);return 0==u?c=r=0:(r=u/d,n=t(a),i=t(s),o=t(l),a===d?c=o-i:s===d?c=1/3+n-o:l===d&&(c=2/3+i-n),c<0?c+=1:1<c&&--c),[c,r,d]},r.hsv2rgb=function(e){var t=e[0],n=e[1],i=e[2],o=0,r=0,a=0,s=Math.floor(6*t),l=6*t-s,c=i*(1-n),d=i*(1-l*n),u=i*(1-(1-l)*n);switch(s%6){case 0:o=i,r=u,a=c;break;case 1:o=d,r=i,a=c;break;case 2:o=c,r=i,a=u;break;case 3:o=c,r=d,a=i;break;case 4:o=u,r=c,a=i;break;case 5:o=i,r=c,a=d}return[Math.round(255*o),Math.round(255*r),Math.round(255*a)]},r.rgba2hsvString=function(e){for(var t="#",n=0,i=(e=r.to255rgba(e)).length;n<i;n++){t+=("0"+e[n].toString(16)).slice(-2)}return t},r.hsvString2rgba=function(e){for(var t=[],n=1;n<e.length;n+=2)t.push(parseInt("0x"+e.slice(n,n+2)));return t=r.toSmallrgba(t)},r.to255rgba=function(e){var t=[];return e.forEach(function(e){t.push(255*e)}),t},r.toSmallrgba=function(e){var t=[];return e.forEach(function(e){t.push(e/255)}),t},r.GetFilename=function(e){var t=e.lastIndexOf("/");return t<0?e:e.substring(t+1)},r.GetFolderPath=function(e,t){void 0===t&&(t=!1);var n=e.lastIndexOf("/");return n<0?t?e:"":e.substring(0,n+1)},r.Error=function(e){debug.error(e)},r.CleanUrl=function(e){return e=e.replace(/#/gm,"%23")},r.loadBabylon=function(){axios.get("scene/dude.json").then(function(e){console.warn(typeof e.data),console.log(e.data),r.loadBlue(e.data,"scene/")})},r.loadBlue=function(e,t){if(void 0!==e.lights&&null!==e.lights)for(var n=0,i=e.lights.length;n<i;n++){var o=e.lights[n];BABYLON.Light.Parse(o,g.VeryEngine.viewScene)}if(void 0!==e.animations&&null!==e.animations)for(n=0,i=e.animations.length;n<i;n++){var r,a=e.animations[n],s=BABYLON._TypeStore.GetClass("BABYLON.Animation");s&&(r=s.Parse(a),g.VeryEngine.viewScene.animations.push(r))}if(void 0!==e.materials&&null!==e.materials)for(n=0,i=e.materials.length;n<i;n++){var l=e.materials[n];BABYLON.Material.Parse(l,g.VeryEngine.viewScene,t)}if(void 0!==e.multiMaterials&&null!==e.multiMaterials)for(n=0,i=e.multiMaterials.length;n<i;n++){var c=e.multiMaterials[n];BABYLON.MultiMaterial.ParseMultiMaterial(c,g.VeryEngine.viewScene)}if(void 0!==e.skeletons&&null!==e.skeletons)for(n=0,i=e.skeletons.length;n<i;n++){var d=e.skeletons[n];BABYLON.Skeleton.Parse(d,g.VeryEngine.viewScene).beginAnimation("Skeleton0",!0)}var u=e.geometries;if(null!=u){var h=new Array,p=u.vertexData;if(null!=p)for(n=0,i=p.length;n<i;n++){var f=p[n];h.push(BABYLON.Geometry.Parse(f,g.VeryEngine.viewScene,t))}}if(void 0!==e.meshes&&null!==e.meshes)for(n=0,i=e.meshes.length;n<i;n++){var m=e.meshes[n];BABYLON.Mesh.Parse(m,g.VeryEngine.viewScene,t)}console.log(g.VeryEngine.viewEngine._internalTexturesCache)},r.isLegalName=function(e){return!/[\\\/*<>?|'':]/.test(e)},r.stringCompare=function(e,t){return(e=e.toLowerCase())===(t=t.toLowerCase())?0:e.localeCompare(t)},r.appendQuery=function(e,t){return this+(-1!==e.indexOf("?")?"&":"?")+t},r.BaseUrl="",r.PreprocessUrl=function(e){return e},r);function r(){}n.Tools=o},{"../../engine":139,"./sha1":125}],127:[function(e,t,n){"use strict";var i=this&&this.__awaiter||function(e,a,s,l){return new(s=s||Promise)(function(n,t){function i(e){try{r(l.next(e))}catch(e){t(e)}}function o(e){try{r(l.throw(e))}catch(e){t(e)}}function r(e){var t;e.done?n(e.value):((t=e.value)instanceof s?t:new s(function(e){e(t)})).then(i,o)}r((l=l.apply(e,a||[])).next())})},h=this&&this.__generator||function(n,i){var o,r,a,s={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]},e={next:t(0),throw:t(1),return:t(2)};return"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(t){return function(e){return function(t){if(o)throw new TypeError("Generator is already executing.");for(;s;)try{if(o=1,r&&(a=2&t[0]?r.return:t[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,t[1])).done)return a;switch(r=0,a&&(t=[2&t[0],a.value]),t[0]){case 0:case 1:a=t;break;case 4:return s.label++,{value:t[1],done:!1};case 5:s.label++,r=t[1],t=[0];continue;case 7:t=s.ops.pop(),s.trys.pop();continue;default:if(!(a=0<(a=s.trys).length&&a[a.length-1])&&(6===t[0]||2===t[0])){s=0;continue}if(3===t[0]&&(!a||t[1]>a[0]&&t[1]<a[3])){s.label=t[1];break}if(6===t[0]&&s.label<a[1]){s.label=a[1],a=t;break}if(a&&s.label<a[2]){s.label=a[2],s.ops.push(t);break}a[2]&&s.ops.pop(),s.trys.pop();continue}t=i.call(n,s)}catch(e){t=[6,e],r=0}finally{o=a=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}([t,e])}}},o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0}),n.UUid=void 0;var p=o(e("spark-md5")),r=(a.getRealTime=function(e){return e<10?"0"+e:e},a.createdAtTime=function(){var e=new Date;return e.getFullYear()+"-"+a.getRealTime(e.getMonth()+1)+"-"+a.getRealTime(e.getDate())+" "+a.getRealTime(e.getHours())+":"+a.getRealTime(e.getMinutes())},a.createUuid=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)})},a.createAssetID=function(){return Math.round((new Date).getTime()/1e3).toString()+"-"+a.createUuid().substring(0,8)},a.getmd5=function(u){return i(void 0,void 0,void 0,function(){return h(this,function(e){return[2,new Promise(function(c,d){return i(void 0,void 0,void 0,function(){function t(){var e=new FileReader;e.onload=s,e.onerror=l;var t=r*o,n=t+o>=u.size?u.size:t+o;e.readAsArrayBuffer(i.call(u,t,n))}var i,o,n,r,a,s,l;return h(this,function(e){return i=File.prototype.slice,o=2097152,n=Math.ceil(u.size/o),r=0,a=new p.default.ArrayBuffer,s=function(e){a.append(e.target.result),++r<n?t():c(a.end())},l=function(){d("error")},t(),[2]})})})]})})},a);function a(){}n.UUid=r},{"spark-md5":2}],128:[function(e,t,n){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,n,i){void 0===i&&(i=n),Object.defineProperty(e,i,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,i){void 0===i&&(i=n),e[i]=t[n]}),o=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||t.hasOwnProperty(n)||i(t,e,n)};Object.defineProperty(n,"__esModule",{value:!0}),o(e("./viewport"),n),o(e("./viewport-expand"),n),o(e("./viewport-application"),n),o(e("./viewport-entities-observer-binding"),n),o(e("./viewport-instance-create"),n),o(e("./viewport-drop-model"),n),o(e("./viewport-tap"),n),o(e("./keeper"),n)},{"./keeper":129,"./viewport":136,"./viewport-application":130,"./viewport-drop-model":131,"./viewport-entities-observer-binding":132,"./viewport-expand":133,"./viewport-instance-create":134,"./viewport-tap":135}],129:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.ViewportKeeper=void 0;function i(){new o.ViewportApplication,new s.ViewportEntitiesObserverBinding,new r.ViewportInstanceCreate,new a.ViewportDropModel,new l.ViewportTap}var o=e("./viewport-application"),r=e("./viewport-instance-create"),a=e("./viewport-drop-model"),s=e("./viewport-entities-observer-binding"),l=e("./viewport-tap");n.ViewportKeeper=i},{"./viewport-application":130,"./viewport-drop-model":131,"./viewport-entities-observer-binding":132,"./viewport-instance-create":134,"./viewport-tap":135}],130:[function(e,t,n){"use strict";var l=this&&this.__awaiter||function(e,a,s,l){return new(s=s||Promise)(function(n,t){function i(e){try{r(l.next(e))}catch(e){t(e)}}function o(e){try{r(l.throw(e))}catch(e){t(e)}}function r(e){var t;e.done?n(e.value):((t=e.value)instanceof s?t:new s(function(e){e(t)})).then(i,o)}r((l=l.apply(e,a||[])).next())})},h=this&&this.__generator||function(n,i){var o,r,a,s={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]},e={next:t(0),throw:t(1),return:t(2)};return"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(t){return function(e){return function(t){if(o)throw new TypeError("Generator is already executing.");for(;s;)try{if(o=1,r&&(a=2&t[0]?r.return:t[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,t[1])).done)return a;switch(r=0,a&&(t=[2&t[0],a.value]),t[0]){case 0:case 1:a=t;break;case 4:return s.label++,{value:t[1],done:!1};case 5:s.label++,r=t[1],t=[0];continue;case 7:t=s.ops.pop(),s.trys.pop();continue;default:if(!(a=0<(a=s.trys).length&&a[a.length-1])&&(6===t[0]||2===t[0])){s=0;continue}if(3===t[0]&&(!a||t[1]>a[0]&&t[1]<a[3])){s.label=t[1];break}if(6===t[0]&&s.label<a[1]){s.label=a[1],a=t;break}if(a&&s.label<a[2]){s.label=a[2],s.ops.push(t);break}a[2]&&s.ops.pop(),s.trys.pop();continue}t=i.call(n,s)}catch(e){t=[6,e],r=0}finally{o=a=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}([t,e])}}};Object.defineProperty(n,"__esModule",{value:!0}),n.ViewportApplication=void 0;function i(){var e=this,r={},v={},b={};editor.method("gizmo:get",function(e){return e in b?b[e]:null}),editor.method("create:scene:element",function(e){var t,n,i,o,r,a,s,l,c,d,u,h,p,f,m,g,y;"light"===e.get("type")?((t=L.BabylonLoader.createLightWraper(e.get("subtype"),e.get("name"),x.VeryEngine.viewScene)).light.intensity=e.has("intensity")?e.get("intensity"):1,e.has("diffuse")&&3===e.get("diffuse").length&&(t.light.diffuse=BABYLON.Color3.FromArray(e.get("diffuse"))),e.has("specular")&&3===e.get("specular").length&&(t.light.specular=BABYLON.Color3.FromArray(e.get("specular"))),t.light instanceof BABYLON.SpotLight&&(e.has("angle")&&(t.light.angle=e.get("angle")),e.has("exponent")&&(t.light.exponent=e.get("exponent"))),t.id=e.get("resource_id"),v[e.get("resource_id")]=t,e.node=t,e.has("enabled")&&t.setEnabled(e.get("enabled")),e.has("position")&&3===e.get("position").length&&(t.position=BABYLON.Vector3.FromArray(e.get("position"))),e.has("rotation")&&3===e.get("rotation").length&&(t.rotation=C.Tools.eulerAngleToRadian(BABYLON.Vector3.FromArray(e.get("rotation"))),t.type===BABYLON.Light.LIGHTTYPEID_HEMISPHERICLIGHT&&t.light.direction.copyFrom(t.up)),e.has("scale")&&3===e.get("scale").length&&(t.scaling=BABYLON.Vector3.FromArray(e.get("scale"))),(n=new O.LightGizmo).scaleRatio=2,n.light=t.light,b[e.get("resource_id")]=n,_(e,t)):"camera"===e.get("type")?(i=L.BabylonLoader.createCameraWraper(e.get("name"),x.VeryEngine.viewScene,x.VeryEngine.viewCanvasElement),o=x.VeryEngine.viewEngine.getRenderWidth(),r=x.VeryEngine.viewEngine.getRenderHeight(),i.camera.viewport=new BABYLON.Viewport(B.Config.x/o,(r-B.Config.y)/r,B.Config.width/o,B.Config.height/r),i.id=e.get("resource_id"),v[e.get("resource_id")]=i,e.node=i,e.has("enabled")&&i.setEnabled(e.get("enabled")),e.has("position")&&3===e.get("position").length&&(i.position=BABYLON.Vector3.FromArray(e.get("position"))),e.has("rotation")&&3===e.get("rotation").length&&(i.rotation=C.Tools.eulerAngleToRadian(BABYLON.Vector3.FromArray(e.get("rotation")))),e.has("scale")&&3===e.get("scale").length&&(i.scaling=BABYLON.Vector3.FromArray(e.get("scale"))),e.has("checkCollisions")&&(i.checkCollisions=e.get("checkCollisions")),e.has("applyGravity")&&(i.applyGravity=e.get("applyGravity")),e.has("viewport"),e.has("clearColor")?(a=e.get("clearColor"))&&a.length&&4===a.length&&(i.clearColor=new BABYLON.Color4(a[0],a[1],a[2],a[3])):i.clearColor=new BABYLON.Color4(45/255,145/255,186/255,1),e.has("mode")&&(i.mode=e.get("mode")),e.has("fov")&&(i.fov=e.get("fov")),e.has("inertia")&&(i.inertia=e.get("inertia")),e.has("orthoSize")&&(i.orthoSize=e.get("orthoSize")),x.VeryEngine.addCamera(i),x.VeryEngine.viewScene.activeCameras.push(i.camera),(s=new O.CameraGizmo).camera=i.camera,(b[e.get("resource_id")]=s).displayFrustum=!1,i.resize(!0),i.renderCamera(!1),_(e,i)):"empty"===e.get("type")?(l=new BABYLON.TransformNode(e.get("name"),x.VeryEngine.viewScene),(e.node=l).id=e.get("resource_id"),l.position=BABYLON.Vector3.FromArray(e.get("position")),l.rotation=C.Tools.eulerAngleToRadian(BABYLON.Vector3.FromArray(e.get("rotation"))),l.scaling=BABYLON.Vector3.FromArray(e.get("scale")),l.isEnabled(e.get("enabled")),v[e.get("resource_id")]=l,_(e,l)):"primitive"===e.get("type")?e.get("subtype")&&"box"===e.get("subtype")?(c=BABYLON.MeshBuilder.CreateBox(e.get("name"),{size:100},x.VeryEngine.viewScene),e.node=c,(v[e.get("resource_id")]=c).id=e.get("resource_id"),e.has("enabled")&&c.setEnabled(e.get("enabled")),e.has("position")&&3===e.get("position").length&&(c.position=BABYLON.Vector3.FromArray(e.get("position"))),e.has("rotation")&&3===e.get("rotation").length&&(c.rotation=C.Tools.eulerAngleToRadian(BABYLON.Vector3.FromArray(e.get("rotation")))),e.has("scale")&&3===e.get("scale").length&&(c.scaling=BABYLON.Vector3.FromArray(e.get("scale"))),e.has("checkCollisions")&&(c.checkCollisions=e.get("checkCollisions")),e.has("pickable")&&(c.isPickable=e.get("pickable")),e.has("isVisible")&&(c.isVisible=e.get("isVisible")),e.get("material_id"),_(e,c)):e.get("subtype")&&"sphere"===e.get("subtype")?(c=BABYLON.MeshBuilder.CreateSphere(e.get("name"),{segments:20,diameter:100},x.VeryEngine.viewScene),e.node=c,(v[e.get("resource_id")]=c).id=e.get("resource_id"),e.has("enabled")&&c.setEnabled(e.get("enabled")),e.has("position")&&3===e.get("position").length&&(c.position=BABYLON.Vector3.FromArray(e.get("position"))),e.has("rotation")&&3===e.get("rotation").length&&(c.rotation=C.Tools.eulerAngleToRadian(BABYLON.Vector3.FromArray(e.get("rotation")))),e.has("scale")&&3===e.get("scale").length&&(c.scaling=BABYLON.Vector3.FromArray(e.get("scale"))),e.has("checkCollisions")&&(c.checkCollisions=e.get("checkCollisions")),e.has("pickable")&&(c.isPickable=e.get("pickable")),e.has("isVisible")&&(c.isVisible=e.get("isVisible")),e.get("material_id"),_(e,c)):e.get("subtype")&&"plane"===e.get("subtype")?(c=BABYLON.MeshBuilder.CreateGround(e.get("name"),{width:5e3,height:5e3,subdivisions:10},x.VeryEngine.viewScene),e.node=c,(v[e.get("resource_id")]=c).id=e.get("resource_id"),e.has("enabled")&&c.setEnabled(e.get("enabled")),e.has("position")&&3===e.get("position").length&&(c.position=BABYLON.Vector3.FromArray(e.get("position"))),e.has("rotation")&&3===e.get("rotation").length&&(c.rotation=C.Tools.eulerAngleToRadian(BABYLON.Vector3.FromArray(e.get("rotation")))),e.has("scale")&&3===e.get("scale").length&&(c.scaling=BABYLON.Vector3.FromArray(e.get("scale"))),e.has("checkCollisions")&&(c.checkCollisions=e.get("checkCollisions")),e.has("pickable")&&(c.isPickable=e.get("pickable")),e.has("isVisible")&&(c.isVisible=e.get("isVisible")),e.get("material_id"),_(e,c)):e.get("subtype")&&"cylinder"===e.get("subtype")&&(c=BABYLON.MeshBuilder.CreateCylinder(e.get("name"),{height:200,diameter:100},x.VeryEngine.viewScene),e.node=c,(v[e.get("resource_id")]=c).id=e.get("resource_id"),e.has("enabled")&&c.setEnabled(e.get("enabled")),e.has("position")&&3===e.get("position").length&&(c.position=BABYLON.Vector3.FromArray(e.get("position"))),e.has("rotation")&&3===e.get("rotation").length&&(c.rotation=C.Tools.eulerAngleToRadian(BABYLON.Vector3.FromArray(e.get("rotation")))),e.has("scale")&&3===e.get("scale").length&&(c.scaling=BABYLON.Vector3.FromArray(e.get("scale"))),e.has("checkCollisions")&&(c.checkCollisions=e.get("checkCollisions")),e.has("pickable")&&(c.isPickable=e.get("pickable")),e.has("isVisible")&&(c.isVisible=e.get("isVisible")),e.get("material_id"),_(e,c)):"mesh"===e.get("type")?editor.call("scene:mesh:create",e):"2d-gui"===e.get("type")&&(e.get("subtype")&&"root"===e.get("subtype")?(d=BABYLON.GUI.AdvancedDynamicTexture.CreateFullscreenUI(e.get("name")),k.GUIManager.add2DCanvas(e.get("resource_id"),d),e.node=d,w(d.rootContainer,e),k.GUIManager.addUniqueIDIndex(d.uniqueId,e.get("resource_id")),v[e.get("resource_id")]=d.rootContainer,_(e,d.rootContainer)):e.get("subtype")&&"panel"===e.get("subtype")?(u=new BABYLON.GUI.Rectangle(e.get("name")),e.node=u,w(u,e),e.has("gui.color")&&(u.color=C.Tools.rgba2hsvString(e.get("gui.color"))),e.has("gui.background")&&(u.background=C.Tools.rgba2hsvString(e.get("gui.background"))),e.has("gui.thickness")&&(u.thickness=e.get("gui.thickness")),e.has("gui.cornerRadius")&&(u.cornerRadius=e.get("gui.cornerRadius")),v[e.get("resource_id")]=u,_(e,u)):e.get("subtype")&&"button"===e.get("subtype")?(h=BABYLON.GUI.Button.CreateImageWithCenterTextButton(e.get("name"),"",""),e.node=h,w(h,e),e.has("gui.color")&&(h.color=C.Tools.rgba2hsvString(e.get("gui.color"))),e.has("gui.background")&&(h.background=C.Tools.rgba2hsvString(e.get("gui.background"))),e.has("gui.thickness")&&(h.thickness=e.get("gui.thickness")),e.has("gui.cornerRadius")&&(h.cornerRadius=e.get("gui.cornerRadius")),e.has("gui.text")&&(h.textBlock.text=e.get("gui.text")),e.has("gui.fontSize")&&(h.fontSize=e.get("gui.fontSize"),h.textBlock.fontSize=e.get("gui.fontSize")),e.has("gui.textColor")&&(h.textBlock.color=C.Tools.rgba2hsvString(e.get("gui.textColor"))),e.has("gui.source")&&e.get("gui.source")&&(f=editor.call("assets:get",e.get("gui.source")))&&A.getUrl(B.Config.projectID,f.get("id"),f.get("name"),f.get("file.hash")).then(function(e){h.image.source=e}),v[e.get("resource_id")]=h,_(e,h)):e.get("subtype")&&"image"===e.get("subtype")?(p=new BABYLON.GUI.Image(e.get("name"),""),e.node=p,w(p,e),e.has("gui.color")&&(p.color=C.Tools.rgba2hsvString(e.get("gui.color"))),e.has("gui.source")&&e.get("gui.source")&&(f=editor.call("assets:get",e.get("gui.source")))&&A.getUrl(B.Config.projectID,f.get("id"),f.get("name"),f.get("file.hash")).then(function(e){p.source=e}),v[e.get("resource_id")]=p,_(e,p)):e.get("subtype")&&"text"===e.get("subtype")?(m=new BABYLON.GUI.TextBlock(e.get("name"),""),e.node=m,w(m,e),e.has("gui.color")&&(m.color=C.Tools.rgba2hsvString(e.get("gui.color"))),e.has("gui.fontSize")&&(m.fontSize=e.get("gui.fontSize")),e.has("gui.text")&&(m.text=e.get("gui.text")),e.has("gui.textWrapping")&&(m.textWrapping=e.get("gui.textWrapping")),e.has("gui.textHorizontalAlignment")&&(m.textHorizontalAlignment=e.get("gui.textHorizontalAlignment")),e.has("gui.textVerticalAlignment")&&(m.textVerticalAlignment=e.get("gui.textVerticalAlignment")),v[e.get("resource_id")]=m,_(e,m)):e.get("subtype")&&"input"===e.get("subtype")?(g=new BABYLON.GUI.InputText(e.get("name"),""),e.node=g,w(g,e),e.has("gui.color")&&(g.color=C.Tools.rgba2hsvString(e.get("gui.color"))),e.has("gui.background")&&(g.background=C.Tools.rgba2hsvString(e.get("gui.background"))),e.has("gui.thickness")&&(g.thickness=e.get("gui.thickness")),e.has("gui.fontSize")&&(g.fontSize=e.get("gui.fontSize")),e.has("gui.placeholderColor")&&(g.placeholderColor=C.Tools.rgba2hsvString(e.get("gui.placeholderColor"))),e.has("gui.placeholderText")&&(g.placeholderText=e.get("gui.placeholderText")),e.has("gui.focusedBackground")&&(g.focusedBackground=C.Tools.rgba2hsvString(e.get("gui.focusedBackground"))),e.has("gui.text")&&(g.text=e.get("gui.text")),v[e.get("resource_id")]=g,_(e,g)):e.get("subtype")&&"checkbox"===e.get("subtype")&&(y=new BABYLON.GUI.RadioButton(e.get("name")),e.node=y,w(y,e),e.has("gui.color")&&(y.color=C.Tools.rgba2hsvString(e.get("gui.color"))),e.has("gui.background")&&(y.background=C.Tools.rgba2hsvString(e.get("gui.background"))),e.has("gui.thickness")&&(y.thickness=e.get("gui.thickness")),e.has("gui.isChecked")&&(y.isChecked=e.get("gui.isChecked")),v[e.get("resource_id")]=y,_(e,y)))});var _=function(e,t){for(var n,i=e.get("children"),o=0;o<i.length;o++)r[i[o]]={index:o,parent:t},v[i[o]]&&a(t,v[i[o]],o,e.get("resource_id"));!e.get("parent")||(n=r[e.get("resource_id")])&&n.parent&&a(n.parent,t,n.index,e.get("resource_id"))},a=function(e,t,n,i){var o;t&&t instanceof BABYLON.Node?(null===e||e instanceof BABYLON.Node)&&(t.parent=e):t&&t instanceof BABYLON.GUI.Control&&e instanceof BABYLON.GUI.Container&&(e.addControl(t),o=e.children.pop(),e.children.splice(n,0,o),k.GUIManager.addUniqueIDIndex(t.uniqueId,i))},w=function(e,t){t.has("gui.isVisible")&&(e.isVisible=t.get("gui.isVisible")),t.has("gui.x")&&(t.has("gui.xType")&&1===t.get("gui.xType")?e.left=t.get("gui.x")+"%":e.left=t.get("gui.x")+"px"),t.has("gui.y")&&(t.has("gui.yType")&&1===t.get("gui.yType")?e.top=t.get("gui.y")+"%":e.top=t.get("gui.y")+"px"),t.has("gui.width")&&(t.has("gui.widthType")&&1===t.get("gui.widthType")?e.width=t.get("gui.width")+"%":e.width=t.get("gui.width")+"px"),t.has("gui.height")&&(t.has("gui.heightType")&&1===t.get("gui.heightType")?e.height=t.get("gui.height")+"%":e.height=t.get("gui.height")+"px"),t.has("gui.scaleX")&&(e.scaleX=t.get("gui.scaleX")),t.has("gui.scaleY")&&(e.scaleY=t.get("gui.scaleY")),t.has("gui.horizontal_alignment")&&(e.horizontalAlignment=t.get("gui.horizontal_alignment")),t.has("gui.vertical_alignment")&&(e.verticalAlignment=t.get("gui.vertical_alignment")),t.has("gui.alpha")&&(e.alpha=t.get("gui.alpha")),t.has("gui.rotation")&&(e.rotation=C.Tools.eulerAngleFloatToRadian(t.get("gui.rotation"))),t.has("gui.isHighlighted")&&(e.isHighlighted=t.get("gui.isHighlighted"))};editor.method("scene:mesh:create",function(e){t(e)});var i={},o={},t=function(e){var t=e.get("asset_id"),n=null;L.BabylonLoader.hasBabylobData(t)?(n=L.BabylonLoader.getParsedBabylonData(t),s(e,n)):t in i?o[t].push(e):(i[t]=!0,o[t]=[e],A.getJsonAsset(B.Config.projectID,t,L.BabylonLoader.assetsData.assets[t].name,L.BabylonLoader.assetsData.assets[t].file.hash).then(function(e){n=JSON.parse(e),L.BabylonLoader.babylonCacheData[t]=n,L.BabylonLoader.parseBabylon(t,n),n=L.BabylonLoader.getParsedBabylonData(t),o[t].forEach(function(e){s(e,n)})}))},s=function(d,u){return l(e,void 0,void 0,function(){var t,n,i,o,r,a,s,l,c;return h(this,function(e){switch(e.label){case 0:return u?(t=d.get("asset_id"),n=d.get("babylon_id"),u.meshes[n]?((i=u.meshes[n]).position=d.has("position")&&d.get("position")?d.get("position"):i.position,o=(o=d.get("rotation"))&&0<o.length?C.Tools.vector3ToArray(C.Tools.eulerAngleToRadian(BABYLON.Vector3.FromArray(o))):i.rotation,i.rotation=o,i.scaling=d.has("scale")&&d.get("scale")?d.get("scale"):i.scaling,i.name=d.has("name")&&d.get("name")?d.get("name"):i.name,i.id=d.has("resource_id")&&d.get("resource_id")?d.get("resource_id"):i.id,i.isEnabled=d.has("enabled")?d.get("enabled"):i.isEnabled,i.isVisible=d.has("isVisible")?d.get("isVisible"):i.isVisible,i.pickable=!0,i.checkCollisions=d.has("checkCollisions")?d.get("checkCollisions"):i.checkCollisions,i.materialId=d.has("material_id")?d.get("material_id"):i.materialId,i.parentId=d.has("parent")?d.get("parent"):i.parentId,i.geometryId&&null===x.VeryEngine.viewScene.getGeometryByID(i.geometryId)&&u.geometries&&u.geometries[i.geometryId]?(r=u.geometries[i.geometryId],[4,L.BabylonLoader.loadGeometry(r,x.VeryEngine.viewScene,"")]):[3,2]):[3,8]):[3,9];case 1:e.sent(),e.label=2;case 2:return i.materialId?null!==x.VeryEngine.viewScene.getMaterialByID(i.materialId)?[3,7]:L.BabylonLoader.assetsData.babylon[t]?(a=L.BabylonLoader.assetsData.babylon[t].materials)&&a[i.materialId]?(s=a[i.materialId].asset_id,L.BabylonLoader.assetsData.assets[s]?((l=L.BabylonLoader.assetsData.assets[s].data).diffuseTexture&&l.diffuseTexture.texture_id&&(l.diffuseTexture.name=L.BabylonLoader.prefix+l.diffuseTexture.texture_id+"/"+L.BabylonLoader.assetsData.assets[l.diffuseTexture.texture_id].name),l.specularTexture&&l.specularTexture.texture_id&&(l.specularTexture.name=L.BabylonLoader.prefix+l.specularTexture.texture_id+"/"+L.BabylonLoader.assetsData.assets[l.specularTexture.texture_id].name),l.reflectionTexture&&l.reflectionTexture.texture_id&&(l.reflectionTexture.name=L.BabylonLoader.prefix+l.reflectionTexture.texture_id+"/"+L.BabylonLoader.assetsData.assets[l.reflectionTexture.texture_id].name),l.refractionTexture&&l.refractionTexture.texture_id&&(l.refractionTexture.name=L.BabylonLoader.prefix+l.refractionTexture.texture_id+"/"+L.BabylonLoader.assetsData.assets[l.refractionTexture.texture_id].name),l.emissiveTexture&&l.emissiveTexture.texture_id&&(l.emissiveTexture.name=L.BabylonLoader.prefix+l.emissiveTexture.texture_id+"/"+L.BabylonLoader.assetsData.assets[l.emissiveTexture.texture_id].name),l.bumpTexture&&l.bumpTexture.texture_id&&(l.bumpTexture.name=L.BabylonLoader.prefix+l.bumpTexture.texture_id+"/"+L.BabylonLoader.assetsData.assets[l.bumpTexture.texture_id].name),l.opacityTexture&&l.opacityTexture.texture_id&&(l.opacityTexture.name=L.BabylonLoader.prefix+l.opacityTexture.texture_id+"/"+L.BabylonLoader.assetsData.assets[l.opacityTexture.texture_id].name),l.ambientTexture&&l.ambientTexture.texture_id&&(l.ambientTexture.name=L.BabylonLoader.prefix+l.ambientTexture.texture_id+"/"+L.BabylonLoader.assetsData.assets[l.ambientTexture.texture_id].name),l.lightmapTexture&&l.lightmapTexture.texture_id&&(l.lightmapTexture.name=L.BabylonLoader.prefix+l.lightmapTexture.texture_id+"/"+L.BabylonLoader.assetsData.assets[l.lightmapTexture.texture_id].name),[4,L.BabylonLoader.loadMaterial(l,x.VeryEngine.viewScene,"")]):[3,4]):[3,5]:[3,6]:[3,7];case 3:return e.sent(),[3,5];case 4:console.warn("scene mesh warn"),e.label=5;case 5:return[3,7];case 6:console.warn("scene mesh warn"),e.label=7;case 7:return c=L.BabylonLoader.loadMesh(i,x.VeryEngine.viewScene,""),d.node=c,v[d.get("resource_id")]=c,_(d,c),[3,9];case 8:console.warn("scene mesh warn"),e.label=9;case 9:return[2]}})})}}var x=e("../../engine"),O=e("../gizmos"),B=e("../global"),L=e("../middleware/loader/babylonLoader"),C=e("../utility"),A=e("../../tools/ossfile"),k=e("../gui");n.ViewportApplication=i},{"../../engine":139,"../../tools/ossfile":150,"../gizmos":58,"../global":66,"../gui":68,"../middleware/loader/babylonLoader":86,"../utility":124}],131:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.ViewportDropModel=void 0;function i(){editor.method("load:from:asset",function(e){r.BabylonLoader.loadBabylon(e)}),editor.method("pick",function(e){var t;null===e?(a.GizmosCenter.clear(),console.log("clear gizmos")):(console.log("pick mesh"),t=editor.call("entities:get",e.id),console.error(t),t?editor.call("selector:set","entity",[t]):console.error("失败"))}),editor.method("loadTempModel",function(e){r.BabylonLoader.loadBabylon(e),console.log("加载模型"),console.log(e)}),editor.method("loadTempModel2",function(e,t){BABYLON.SceneLoader.Append(e,t,o.VeryEngine.viewScene,function(e){for(var t=0;t<e.meshes.length;t++){var n=e.meshes[t];n.checkCollisions=!0,n.isPickable=!0,(i=editor.call("entities:get",n.id))&&(i.node=n)}for(t=0;t<e.transformNodes.length;t++){var i,o=e.transformNodes[t];null!==o.parent&&o.parent.id,(i=editor.call("entities:get",o.id))&&(i.node=o)}e.onPointerObservable.add(function(e){e.type===BABYLON.PointerEventTypes.POINTERDOWN&&(null!=e.pickInfo.pickedMesh?editor.call("pick",e.pickInfo.pickedMesh):editor.call("pick",null))})})});var e=editor.call("viewport:canvas");e&&editor.call("drop:target",{ref:e.element,filter:function(e,t){if("asset.model"===e)return!0;if("assets"!==e)return!1;for(var n=0;n<t.ids.length;n++){var i=editor.call("assets:get",t.ids[n]);if(!i)return!1;if("model"!==i.get("type"))return!1}return!0},drop:function(e,t){console.warn("viewport drop: "+e);var n,i=[];if("asset.model"===e)(o=editor.call("assets:get",t.id))&&i.push(o);else if("assets"===e)for(var o,r=0;r<t.ids.length;r++){(o=editor.call("assets:get",t.ids[r]))&&"model"===o.get("type")&&i.push(o)}i.length&&(n=null,"entity"===editor.call("selector:type")&&(n=editor.call("selector:items")[0]),n=n||editor.call("entities:root"),t=[])}})}var o=e("../../engine"),r=e("../middleware/loader/babylonLoader"),a=e("../gizmos");n.ViewportDropModel=i},{"../../engine":139,"../gizmos":58,"../middleware/loader/babylonLoader":86}],132:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.ViewportEntitiesObserverBinding=void 0;function i(){editor.on("entities:add",function(l){l.on("*:set",function(e,t){var n,i=l.node;i&&("name"===e?i.name=l.get("name"):e.startsWith("position")?i.position=new BABYLON.Vector3(l.get("position.0"),l.get("position.1"),l.get("position.2")):e.startsWith("rotation")?i.rotation=c.Tools.eulerAngleToRadian(new BABYLON.Vector3(l.get("rotation.0"),l.get("rotation.1"),l.get("rotation.2"))):e.startsWith("scale")?i.scaling=new BABYLON.Vector3(l.get("scale.0"),l.get("scale.1"),l.get("scale.2")):e.startsWith("enabled")?i.setEnabled(l.get("enabled")):e.startsWith("checkCollisions")?i.checkCollisions=l.get("checkCollisions"):e.startsWith("pickable")||(e.startsWith("isVisible")?i.isVisible=l.get("isVisible"):e.startsWith("parent")?editor.call("entities:get",l.get("parent")):"components.model.type"===e&&"asset"===t||("clearColor"===e?i instanceof r.VeryCamera&&(i.clearColor=BABYLON.Color4.FromArray(t)):"mode"===e?i instanceof r.VeryCamera&&(i.mode=t):"orthoSize"===e?i instanceof r.VeryCamera&&(i.orthoSize=t):"fov"===e?i instanceof r.VeryCamera&&(i.fov=t):"minZ"===e?i instanceof r.VeryCamera&&(i.minZ=t):"maxZ"===e?i instanceof r.VeryCamera&&(i.maxZ=t):"applyGravity"===e?i instanceof r.VeryCamera&&(i.applyGravity=t):"gui.isVisible"===e?i instanceof BABYLON.GUI.Control?i.isVisible=t:i instanceof BABYLON.GUI.AdvancedDynamicTexture&&(i.rootContainer.isVisible=t):"gui.xType"===e?i instanceof BABYLON.GUI.Control?i.left=0===t?l.get("gui.x")+"px":l.get("gui.x")+"%":i instanceof BABYLON.GUI.AdvancedDynamicTexture&&(i.rootContainer.left=0===t?l.get("gui.x")+"px":l.get("gui.x")+"%"):"gui.x"===e?i instanceof BABYLON.GUI.Control?0===l.get("gui.xType")?i.left=t+"px":i.left=t+"%":i instanceof BABYLON.GUI.AdvancedDynamicTexture&&(0===l.get("gui.xType")?i.rootContainer.left=t+"px":i.rootContainer.left=t+"%"):"gui.yType"===e?i instanceof BABYLON.GUI.Control?i.top=0===t?l.get("gui.y")+"px":l.get("gui.y")+"%":i instanceof BABYLON.GUI.AdvancedDynamicTexture&&(i.rootContainer.top=0===t?l.get("gui.y")+"px":l.get("gui.y")+"%"):"gui.y"===e?i instanceof BABYLON.GUI.Control?0===l.get("gui.yType")?i.top=t+"px":i.top=t+"%":i instanceof BABYLON.GUI.AdvancedDynamicTexture&&(0===l.get("gui.yType")?i.rootContainer.top=t+"px":i.rootContainer.top=t+"%"):"gui.widthType"===e?i instanceof BABYLON.GUI.Control?i.width=0===t?l.get("gui.width")+"px":l.get("gui.width")+"%":i instanceof BABYLON.GUI.AdvancedDynamicTexture&&(i.rootContainer.width=0===t?l.get("gui.width")+"px":l.get("gui.width")+"%"):"gui.width"===e?i instanceof BABYLON.GUI.Control?0===l.get("gui.widthType")?i.width=t+"px":i.width=t+"%":i instanceof BABYLON.GUI.AdvancedDynamicTexture&&(0===l.get("gui.widthType")?i.rootContainer.width=t+"px":i.rootContainer.width=t+"%"):"gui.heightType"===e?i instanceof BABYLON.GUI.Control?i.height=0===t?l.get("gui.height")+"px":l.get("gui.height")+"%":i instanceof BABYLON.GUI.AdvancedDynamicTexture&&(i.rootContainer.height=0===t?l.get("gui.height")+"px":l.get("gui.height")+"%"):"gui.height"===e?i instanceof BABYLON.GUI.Control?0===l.get("gui.heightType")?i.height=t+"px":i.height=t+"%":i instanceof BABYLON.GUI.AdvancedDynamicTexture&&(0===l.get("gui.heightType")?i.rootContainer.height=t+"px":i.rootContainer.height=t+"%"):"gui.horizontal_alignment"===e?i instanceof BABYLON.GUI.Control?i.horizontalAlignment=t:i instanceof BABYLON.GUI.AdvancedDynamicTexture&&(i.rootContainer.horizontalAlignment=t):"gui.vertical_alignment"===e?i instanceof BABYLON.GUI.Control?i.verticalAlignment=t:i instanceof BABYLON.GUI.AdvancedDynamicTexture&&(i.rootContainer.verticalAlignment=t):"gui.alpha"===e?i instanceof BABYLON.GUI.Control?i.alpha=t:i instanceof BABYLON.GUI.AdvancedDynamicTexture&&(i.rootContainer.alpha=t):"gui.rotation"===e?i instanceof BABYLON.GUI.Control?i.rotation=c.Tools.eulerAngleFloatToRadian(t):i instanceof BABYLON.GUI.AdvancedDynamicTexture&&(i.rootContainer.rotation=c.Tools.eulerAngleFloatToRadian(t)):"gui.color"===e?i instanceof BABYLON.GUI.Control?i.color=c.Tools.rgba2hsvString(t):i instanceof BABYLON.GUI.AdvancedDynamicTexture&&(i.rootContainer.color=c.Tools.rgba2hsvString(t)):"gui.background"===e?i instanceof BABYLON.GUI.Control&&(i.background=c.Tools.rgba2hsvString(t)):"gui.textColor"===e?i instanceof BABYLON.GUI.Button&&(i.textBlock.color=c.Tools.rgba2hsvString(t)):"gui.text"===e?i instanceof BABYLON.GUI.Button?i.textBlock.text=t:(i instanceof BABYLON.GUI.TextBlock||i instanceof BABYLON.GUI.InputText)&&(i.text=t):"gui.thickness"===e?(i instanceof BABYLON.GUI.Button||i instanceof BABYLON.GUI.Rectangle||i instanceof BABYLON.GUI.InputText||i instanceof BABYLON.GUI.Checkbox)&&(i.thickness=t):"gui.cornerRadius"===e?(i instanceof BABYLON.GUI.Button||i instanceof BABYLON.GUI.Rectangle)&&(i.cornerRadius=t):"gui.fontSize"===e?i instanceof BABYLON.GUI.TextBlock||i instanceof BABYLON.GUI.InputText?i.fontSize=t:i instanceof BABYLON.GUI.Button&&(i.textBlock.fontSize=t):"gui.placeholderText"===e?i instanceof BABYLON.GUI.InputText&&(i.placeholderText=t):"gui.placeholderColor"===e?i instanceof BABYLON.GUI.InputText&&(i.placeholderColor=c.Tools.rgba2hsvString(t)):"gui.focusedBackground"===e?i instanceof BABYLON.GUI.InputText&&(i.focusedBackground=c.Tools.rgba2hsvString(t)):"gui.isChecked"===e?i instanceof BABYLON.GUI.RadioButton&&(i.isChecked=t):"gui.textWrapping"===e?i instanceof BABYLON.GUI.TextBlock&&(i.textWrapping=t):"gui.textHorizontalAlignment"===e?i instanceof BABYLON.GUI.TextBlock&&(i.textHorizontalAlignment=t):"gui.textVerticalAlignment"===e?i instanceof BABYLON.GUI.TextBlock&&(i.textVerticalAlignment=t):"gui.isHighlighted"===e?i instanceof BABYLON.GUI.AdvancedDynamicTexture?i.rootContainer.isHighlighted=t:i instanceof BABYLON.GUI.Control&&(i.isHighlighted=t):"gui.zIndex"===e?i instanceof BABYLON.GUI.AdvancedDynamicTexture?(i.rootContainer.zIndex=t,i.rootContainer._markAllAsDirty()):i instanceof BABYLON.GUI.Control&&(i.zIndex=t,i._markAllAsDirty()):"gui.source"===e&&(t?(n=editor.call("assets:get",t))&&(i instanceof BABYLON.GUI.Image?o.getUrl(s.Config.projectID,n.get("id"),n.get("name"),n.get("file.hash")).then(function(e){i.source=e}):i instanceof BABYLON.GUI.Button&&o.getUrl(s.Config.projectID,n.get("id"),n.get("name"),n.get("file.hash")).then(function(e){i.image.source=e})):i instanceof BABYLON.GUI.Image?(i.source="",i._markAsDirty()):i instanceof BABYLON.GUI.Button&&(i.image.source="",i._markAsDirty())))),a.BabylonLoader.updateSceneData(l.get("resource_id"),l._data2),editor.call("make:scene:dirty"))});function e(e,t){var n,i,o,r,a,s=editor.call("entities:get",e);s&&s.node&&(s.node instanceof BABYLON.TransformNode?(BABYLON.Vector3.Zero().copyFrom(s.node.getAbsolutePosition()),s.node.setParent(l.node?l.node:null),o=s.node.position.clone(),r=c.Tools.radianToEulerAngle(s.node.rotation.clone()),s.set("position.0",o.x),s.set("position.1",o.y),s.set("position.2",o.z),s.set("rotation.0",r.x),s.set("rotation.1",r.y),s.set("rotation.2",r.z)):s.node instanceof BABYLON.GUI.Control?l.node instanceof BABYLON.GUI.AdvancedDynamicTexture?(s.node.parent&&null!==(n=s.node.parent)&&void 0!==n&&n.removeControl(s.node),l.node.addControl(s.node),a=l.node.rootContainer.children.pop(),l.node.rootContainer.children.splice(t,0,a),d.GUIManager.addUniqueIDIndex(s.node.uniqueId,e)):l.node instanceof BABYLON.GUI.Container?(s.node.parent&&null!==(i=s.node.parent)&&void 0!==i&&i.removeControl(s.node),l.node.addControl(s.node),a=l.node.children.pop(),l.node.children.splice(t,0,a),d.GUIManager.addUniqueIDIndex(s.node.uniqueId,e)):(console.warn(s.get("subtype")),console.warn(s.node),console.log("2D界面未知情况，请截图报错信息并联系管理员！")):s.node instanceof BABYLON.GUI.AdvancedDynamicTexture||(console.error("当前类型还未考虑"),console.error(s)))}l.on("children:insert",e),l.on("children:move",e),l.on("destroy",function(){l.node&&(l.node.dispose(),editor.call("viewport:render"))})}),editor.on("entities:remove",function(e){var t=e.node;t&&t.dispose()})}var o=e("../../tools/ossfile"),r=e("../middleware"),a=e("../middleware/loader/babylonLoader"),c=e("../utility"),s=e("../global"),d=e("../gui");n.ViewportEntitiesObserverBinding=i},{"../../tools/ossfile":150,"../global":66,"../gui":68,"../middleware":85,"../middleware/loader/babylonLoader":86,"../utility":124}],133:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.ViewportExpand=void 0;function i(){var n=[];n.push(o.VeryEngine.hierarchy),n.push(o.VeryEngine.assets),n.push(o.VeryEngine.attributes);var i=!1;window.editor.method("viewport:expand",function(e){if(void 0===e&&(e=!i),i!==e){i=e;for(var t=0;t<n.length;t++)n[t].hidden=i;window.editor.emit("viewport:expand",e)}}),window.editor.method("viewport:expand:state",function(){return i}),window.editor.call("hotkey:register","viewport:expand",{key:"space",callback:function(){window.editor.call("viewport:expand")}})}var o=e("../../engine");n.ViewportExpand=i},{"../../engine":139}],134:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.ViewportInstanceCreate=void 0;var i=(o.prototype.addEntity=function(){},o);function o(){}n.ViewportInstanceCreate=i},{}],135:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.Tap=n.ViewportTap=void 0;function i(){var n,e,i=editor.call("viewport:canvas");i?(n=![],editor.method("viewport:inViewport",function(){return n}),e=function(e){var t=i.element.getBoundingClientRect();editor.emit("viewport:mouse:move",e,t),e.clientX>=t.left&&e.clientX<=t.right&&e.clientY>=t.top&&e.clientY<=t.bottom?n||(n=!0,editor.emit("viewport:hover",!0)):n&&(n=!1,editor.emit("viewport:hover",!1))},i.element.addEventListener("mousedown",function(e){var t=i.element.getBoundingClientRect();editor.emit("viewport:mouse:down",e,t)},!1),i.element.addEventListener("mouseover",function(){editor.emit("viewport:hover",!0)},!1),i.element.addEventListener("mouseleave",function(e){var t=e.target||e.relatedTarget;t&&t.classList.contains("cursor-tooltip")||editor.emit("viewport:hover",!1)},!1),window.addEventListener("mousemove",e,!1),window.addEventListener("dragover",e,!1),window.addEventListener("mouseup",function(e){var t=i.element.getBoundingClientRect();editor.emit("viewport:mouse:up",e,t)},!1),window.addEventListener("wheel",function(e){editor.emit("viewport:mouse:wheel",e)},!1)):console.warn("Viewport Canvas组件没有创建成功！")}n.ViewportTap=i;var o=(r.prototype.update=function(e,t){var n=e.clientX-t.left,i=e.clientY-t.top;this.down&&!this.move&&8<Math.abs(this.sx-n)+Math.abs(this.sy-i)&&(this.move=!0),this.move&&(this.nx=n-this.lx,this.ny=i-this.ly,this.lx=this.x,this.ly=this.y),this.x=n,this.y=i},r);function r(e,t,n){this.x=this.lx=this.sx=e.clientX-t.left,this.y=this.ly=this.sy=e.clientY-t.top,this.nx=0,this.ny=0,this.move=!1,this.down=!0,this.button=e.button,this.mouse=!!n}n.Tap=o},{}],136:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.Viewport=void 0;var i=e("../../ui"),a=e("../../engine"),o=e("../toolbar"),r=e("./viewport-expand"),s=e("../gizmos"),l=e("../middleware"),c=(d.prototype.init=function(){var t=this;this.canvas=new i.Canvas("canvas-viewport"),a.VeryEngine.viewCanvas=this.canvas,this._canvas=this.canvas.element,a.VeryEngine.viewCanvasElement=this._canvas,this._canvas.style.outline="none",this._canvas.style.width="100%",this._canvas.style.height="100%",editor.call("layout.viewport").prepend(this.canvas),editor.method("viewport:canvas",function(){return t.canvas}),setInterval(function(){var e=a.VeryEngine.viewportPanel.element.getBoundingClientRect();t.canvas.resize(Math.floor(e.width),Math.floor(e.height))},100/6),this._engine=new BABYLON.Engine(this._canvas,!0),a.VeryEngine.viewEngine=this._engine;var e=this._engine;window.addEventListener("resize",function(){e.resize()}),this._scene=new BABYLON.Scene(this._engine),a.VeryEngine.viewScene=this._scene,this._scene.preventDefaultOnPointerDown=!1,this._scene.preventDefaultOnPointerUp=!1,s.GizmosCenter.init(this._scene),editor.call("hotkey:register","open:inspector",{key:"q",ctrl:!0,alt:!0,callback:function(){t.toggleDebug()}})},d.prototype.toggleDebug=function(){var e;this._engine&&((e=this._engine.scenes[0]).debugLayer.isVisible()?e.debugLayer.hide():e.debugLayer.show({embedMode:!0}))},d.prototype.expandControl=function(){new o.ToolbarTopControl,new r.ViewportExpand},d);function d(){var n=this;this.init();var r=this;this._engine;this._scene.autoClear=!1;var e=new BABYLON.UniversalCamera("__viewportCamera__",new BABYLON.Vector3(0,1,-20),this._scene);e.minZ=-800,e.maxZ=2e4,this._scene.cameraToUseForPointers=e,this._scene.onBeforeCameraRenderObservable.add(function(e){var t=r._scene.getEngine(),n=t.getRenderWidth(),i=t.getRenderHeight(),o=a.VeryEngine.getCamera(e);o&&(r._scene.getEngine().enableScissor(o.camera.viewport.x*n,o.camera.viewport.y*i,o.camera.viewport.width*n,o.camera.viewport.height*i),r._scene.getEngine().clear(o.clearColor,!0,!0,!0))});var t=new l.VeryCamera(e,this._scene,this._canvas);editor.method("camera:viewport",function(){return t}),this._camera=t,a.VeryEngine.viewCamera=t,this._camera.orthoSize=.5,this._scene.activeCameras.push(e),t.clearColor=new BABYLON.Color4(116/255,116/255,116/255,1),a.VeryEngine.addCamera(t),e.attachControl(this._canvas,!0);function i(){r._engine.resize()}var o=this._canvas.width;this._engine.runRenderLoop(function(){if(n._canvas.width===n._canvas.clientWidth&&n._canvas.height===n._canvas.clientHeight&&n._canvas.width===o||(o=n._canvas.width,n._engine.resize(),setInterval(i,100)),n._scene&&(n._scene.activeCamera||n._scene.activeCameras&&0<n._scene.activeCameras.length)){editor.emit("viewport:update",n._engine.getDeltaTime());for(var e=0,t=a.VeryEngine.cameras.length;e<t;e++)a.VeryEngine.cameras[e].resize(!0);n._scene.render()}}),this.expandControl()}n.Viewport=c},{"../../engine":139,"../../ui":162,"../gizmos":58,"../middleware":85,"../toolbar":105,"./viewport-expand":133}],137:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.Application=void 0;function i(){}n.Application=i},{}],138:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.BabylonEngine=void 0;function i(){}n.BabylonEngine=i},{}],139:[function(e,t,n){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,n,i){void 0===i&&(i=n),Object.defineProperty(e,i,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,i){void 0===i&&(i=n),e[i]=t[n]}),o=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||t.hasOwnProperty(n)||i(t,e,n)};Object.defineProperty(n,"__esModule",{value:!0}),o(e("./babylon-engine"),n),o(e("./very-engine"),n),o(e("./application"),n)},{"./application":137,"./babylon-engine":138,"./very-engine":140}],140:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.VeryEngine=void 0;var i=e("../editor"),o=(r.addCamera=function(e){r.cameras.push(e),r.cameraDic[e.id]=e},r.getCamera=function(e){if(e.parent&&e.parent instanceof i.VeryCamera)return e.parent.id in r.cameraDic?r.cameraDic[e.parent.id]:null;for(var t=0,n=r.cameras.length;t<n;t++)if(r.cameras[t].camera===e)return r.cameras[t];return null},r.cameras=[],r.cameraDic={},r);function r(){}n.VeryEngine=o},{"../editor":78}],141:[function(e,t,n){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,n,i){void 0===i&&(i=n),Object.defineProperty(e,i,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,i){void 0===i&&(i=n),e[i]=t[n]}),o=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||t.hasOwnProperty(n)||i(t,e,n)};Object.defineProperty(n,"__esModule",{value:!0}),o(e("./lib"),n),o(e("./editor"),n),o(e("./ui"),n),o(e("./engine"),n)},{"./editor":78,"./engine":139,"./lib":143,"./ui":162}],142:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.EventHandle=n.Events=void 0;var i=(Object.defineProperty(o.prototype,"suspendEvents",{get:function(){return this._suspendEvents},set:function(e){this._suspendEvents=e},enumerable:!1,configurable:!0}),o.prototype.on=function(e,t){var n=this._events[e];return void 0===n?this._events[e]=[t]:-1==n.indexOf(t)&&n.push(t),new r(this,e,t)},o.prototype.once=function(e,l){var c=this,d=this.on(e,function(e,t,n,i,o,r,a,s){l.call(c,e,t,n,i,o,r,a,s),d.unbind()});return d},o.prototype.emit=function(t,e,n,i,o,r,a,s,l){if(this._suspendEvents)return this;var c=this._events[t];if(!c)return this;c=c.slice(0);for(var d=0;d<c.length;d++)if(c[d])try{c[d].call(this,e,n,i,o,r,a,s,l)}catch(e){console.info("%c%s %c(event error)","color: #06f",t,"color: #f00"),console.log(e.stack)}return this},o.prototype.unbind=function(e,t){if(e){var n,i=this._events[e];if(!i)return this;t?-1!==(n=i.indexOf(t))&&(1===i.length?delete this._events[e]:i.splice(n,1)):delete this._events[e]}else this._events={};return this},o);function o(){this._suspendEvents=!1,this._events={}}n.Events=i;var r=(a.prototype.unbind=function(){this.owner&&(this.owner.unbind(this.name,this.fn),this.owner=null,this.name=null,this.fn=null)},a.prototype.call=function(){this.fn&&this.fn.call(this.owner,arguments[0],arguments[1],arguments[2],arguments[3],arguments[4],arguments[5],arguments[6],arguments[7])},a.prototype.on=function(e,t){return this.owner.on(e,t)},a);function a(e,t,n){this.owner=e,this.name=t,this.fn=n}n.EventHandle=r},{}],143:[function(e,t,n){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,n,i){void 0===i&&(i=n),Object.defineProperty(e,i,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,i){void 0===i&&(i=n),e[i]=t[n]}),o=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||t.hasOwnProperty(n)||i(t,e,n)};Object.defineProperty(n,"__esModule",{value:!0}),o(e("./events"),n),o(e("./observer"),n),o(e("./observer-list"),n),o(e("./observer-sync"),n)},{"./events":142,"./observer":146,"./observer-list":144,"./observer-sync":145}],144:[function(e,t,n){"use strict";var i,o=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0}),n.ObserverList=void 0;var r,a=e("./events"),s=(r=a.Events,o(l,r),Object.defineProperty(l.prototype,"length",{get:function(){return this.data.length},enumerable:!1,configurable:!0}),l.prototype.get=function(e){return this.id&&"string"==typeof e?this._indexed[e]||null:"number"==typeof e&&this.data[e]||null},l.prototype.set=function(e,t){this.id?this._indexed[e]=t:"number"==typeof e&&(this.data[e]=t)},l.prototype.indexof=function(e){return this.data.indexOf(e)},l.prototype.position=function(e,t){var n,i,o=this.data,r=0,a=o.length-1;for(t=t||this.sorted;r<=a;)if(1===(i=t(o[n=Math.floor((r+a)/2)],e)))a=n-1;else{if(-1!==i)return n;r=n+1}return-1},l.prototype.positionNextClosest=function(e,t){var n,i,o=this.data,r=0,a=o.length-1,s=0;if(t=t||this.sorted,0===o.length)return-1;if(0===t(o[0],e))return 0;for(;r<=a;)if(1===(i=t(n=o[s=Math.floor((r+a)/2)],e)))a=s-1;else{if(-1!==i)return s;r=s+1}return 1===t(n,e)?s:s+1===o.length?-1:s+1},l.prototype.has=function(e){if(this.id){var t=e.get(this.id);return!!this._indexed[t]}return-1!==this.data.indexOf(e)},l.prototype.add=function(e){if(this.has(e))return-1;var t;this.id?(t=e.get(this.id),this._indexed[t]=e):this._indexed[this.data.length]=e;var n=0;return this.sorted?-1!==(n=this.positionNextClosest(e,this.sorted))?this.data.splice(n,0,e):this.data.push(e):(this.data.push(e),n=this.data.length-1),this.emit("add",e),n},l.prototype.move=function(e,t){var n=this.data.indexOf(e);this.data.splice(n,1),-1===t?this.data.push(e):this.data.splice(t,0,e)},l.prototype.remove=function(e){var t,n;this.has(e)&&(t=this.data.indexOf(e),this.id&&(n=e.get(this.id),delete this._indexed[n]),this.data.splice(t,1),this.emit("remove",e,t))},l.prototype.removeByKey=function(e){if(this.id){if(!(n=this._indexed[e]))return;var t=this.data.indexOf(n);this.data.splice(t,1),delete this._indexed[e],this.emit("remove",n,t)}else{if(this.data.length<e)return;var n=this.data[e];this.data.splice(e,1),this.emit("remove",n,e)}},l.prototype.removeBy=function(e){for(var t=this.data.length;t--;)e(this.data[t])&&(this.id&&delete this._indexed[this.data[t].get(this.id)],this.data.splice(t,1),this.emit("remove",this.data[t],t))},l.prototype.clear=function(){var e=this.data.slice(0);this.data=[],this._indexed={};for(var t=e.length;t--;)this.emit("remove",e[t],t)},l.prototype.forEach=function(e){for(var t=0;t<this.data.length;t++)e(this.data[t],this.id&&this.data[t].get(this.id)||t)},l.prototype.find=function(e){for(var t,n=[],i=0;i<this.data.length;i++){e(this.data[i])&&(t=i,this.id&&(t=this.data[i].get(this.id)),n.push([t,this.data[i]]))}return n},l.prototype.findOne=function(e){for(var t=0;t<this.data.length;t++)if(e(this.data[t])){var n=t;return this.id&&(n=this.data[t].get(this.id)),[n,this.data[t]]}return null},l.prototype.map=function(e){return this.data.map(e)},l.prototype.sort=function(e){this.data.sort(e)},l.prototype.array=function(){return this.data.slice(0)},l);function l(e){var t=r.call(this)||this;return t.sorted=null,e=e||{},t.type="",t.data=[],t._indexed={},t.sorted=e.sorted||null,t.id=e.id||"",t}n.ObserverList=s},{"./events":142}],145:[function(e,t,n){"use strict";var i,o=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0}),n.ObserverSync=void 0;var r,a=e("./events"),s=(r=a.Events,o(l,r),Object.defineProperty(l.prototype,"enabled",{get:function(){return this._enabled},set:function(e){this._enabled=e},enumerable:!1,configurable:!0}),Object.defineProperty(l.prototype,"prefix",{get:function(){return this._prefix},set:function(e){this._prefix=e||[]},enumerable:!1,configurable:!0}),Object.defineProperty(l.prototype,"paths",{get:function(){return this._paths},set:function(e){this._paths=e||null},enumerable:!1,configurable:!0}),l.prototype._initialize=function(){this.item},l);function l(e){var t=r.call(this)||this;return t._enabled=!0,e=e||{},t.item=e.item,t._enabled=e.enabled||!0,t._prefix=e.prefix||[],t._paths=e.paths||null,t._initialize(),t}n.ObserverSync=s},{"./events":142}],146:[function(e,t,n){"use strict";var i,o=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0}),n.Observer=void 0;var r,a=e("./events"),s=(r=a.Events,o(c,r),Object.defineProperty(c.prototype,"className",{get:function(){return"Observer"},enumerable:!1,configurable:!0}),c.prototype.patchData=function(e){if("object"==typeof e)for(var t in e)"object"==typeof e[t]?this.parserObject(t,t,e[t]):(this.set(t,e[t]),this._dataType[t]=!1,this._dataType2[t]=!1);else debug.warn(this.className+": 不是正确的json对象，打印：\n"+e)},c.prototype.set=function(e,t){for(var n,i=this._data[e],o=e.split("."),r="",a=0;a<o.length-1;a++)0===a?r=o[a]:r+=this.SEPARATOR+o[a];1<o.length&&this._dataType[e]?(n=parseInt(o[o.length-1]),this._data[e]=t,this._data[r][n]=t):(this._data[e]=t,this.updateChildData(e,t),this._data2[e]=t),this.emit(e+":set",t,i),this.emit("*:set",e,t,i)},c.prototype.isNumber=function(e){var t=Number(e);return!isNaN(t)},c.prototype.updateChildData=function(e,t){if(t instanceof Array){for(var n in this._data)n.startsWith(e+this.SEPARATOR)&&(delete this._data[n],delete this._dataType[n]);for(var i,o=0;o<t.length;o++)i=e+this.SEPARATOR+o.toString(),this._data[i]=t[o],this._dataType[i]=!0}},c.prototype.unset=function(e,t){if(!this.has(e))return!1;var n=this._data[e];return delete this._data[e],delete this._dataType[e],delete this._data2[e],delete this._dataType2[e],this.emit(e+":set",t,n),this.emit("*:set",e,t,n),!0},c.prototype.insert=function(e,t,n){if(!(this.has(e)&&this._data[e]instanceof Array))return!1;var i=this._data[e];return t instanceof Array&&(t=t.slice(0)),void 0===n?(i.push(t),n=i.length-1):i.splice(n,0,t),this.updateChildData(e,i),this.emit(e+":insert",t,n),this.emit("*:insert",e,t,n),!0},c.prototype.remove=function(e,t){if(!(this.has(e)&&this._data[e]instanceof Array))return!1;var n=this._data[e];if(n.length<t)return!1;var i=n[t];return n.splice(t,1),this.updateChildData(e,n),this.emit(e+":remove",i,t),this.emit("*:remove",e,i,t),!0},c.prototype.removeValue=function(e,t){if(!(this.has(e)&&this._data[e]instanceof Array))return!1;var n=this._data[e],i=n.indexOf(t);if(-1===i)return!1;var o=n[i];return n.splice(i,1),this.updateChildData(e,n),this.emit(e+":remove",o,i),this.emit("*:remove",e,o,i),!0},c.prototype.move=function(e,t,n){if(!(this.has(e)&&this._data[e]instanceof Array))return!1;var i=this._data[e];if(i.length<t||i.length<n||t===n)return!1;var o=i[t];return i.splice(t,1),-1===n&&(n=i.length),i.splice(n,0,o),this.updateChildData(e,i),this.emit(e+":move",o,n,t),this.emit("*:move",e,o,n,t),!0},c.prototype.parserObject=function(e,t,n){var i;this.set(e,n),this._dataType[e]=!1;var o=typeof n;if("object"==o&&n instanceof Array){this._dataType2[e]=!0;for(var r=0;r<n.length;r++)i=e+this.SEPARATOR+r.toString(),this.set(i,n[r]),this._dataType[i]=!0}else if("object"==o&&n instanceof Object)for(var a in n)"object"==typeof n[a]?this.parserObject(e+this.SEPARATOR+a,a,n[a]):(i=e+this.SEPARATOR+a,this.set(i,n[a]),this._dataType[i]=!1,this._dataType2[e]=!1)},c.prototype.has=function(e){return e in this._data},c.prototype.get=function(e){return e in this._data?this._data[e]:null},c.prototype.propagate=function(r){var a=this;return function(e,t,n,i){var o;a._parent&&(!a._parentKey&&a._parentField instanceof Array&&-1===a._parentField.indexOf(a)||(a._silent&&(o=a._parent.silence()),a._parent.emit(e+":"+r,t,n,i),a._parent.emit("*:"+r,e,t,n,i),a._silent&&a._parent.silenceRestore(o)))}},c.prototype._prepare=function(e,t,n,i,o){var r,a=(e._path?e._path+".":"")+t,s=typeof n;if(e._keys.push(t),"object"==s&&n instanceof Array){e._data[t]=n.slice(0);for(var l=0;l<e._data[t].length;l++)"object"==typeof e._data[t][l]&&null!==e._data[t][l]?e._data[t][l]instanceof Array?e._data[t][l].slice(0):e._data[t][l]=new c(e._data[t][l],{parent:this,parentPath:a,parentField:e._data[t],parentKey:null}):(r=this.silence(),this.emit(a+"."+l+":set",e._data[t][l],null,o),this.emit("*:set",a+"."+l,e._data[t][l],null,o),this.silenceRestore(r));i&&(r=this.silence()),this.emit(a+":set",e._data[t],null,o),this.emit("*:set",a,e._data[t],null,o),i&&this.silenceRestore(r)}else if("object"==s&&n instanceof Object){for(var l in"object"!=typeof e._data[t]&&(e._data[t]={_path:a,_keys:[],_data:{}}),n)"object"==typeof n[l]?this._prepare(e._data[t],l,n[l],!0,o):(r=this.silence(),e._data[t]._data[l]=n[l],e._data[t]._keys.push(l),this.emit(a+"."+l+":set",n[l],null,o),this.emit("*:set",a+"."+l,n[l],null,o),this.silenceRestore(r));i&&(r=this.silence()),this.emit(a+":set",n,void 0,o),this.emit("*:set",a,n,void 0,o),i&&this.silenceRestore(r)}else i&&(r=this.silence()),e._data[t]=n,this.emit(a+":set",n,void 0,o),this.emit("*:set",a,n,void 0,o),i&&this.silenceRestore(r);return!0},c.prototype.silence=function(){this._silent=!0;var e=void 0!==this.history&&void 0!==this.history.enabled;e&&(this.history.enabled=!1);var t=null!==this.sync&&void 0!==this.sync.enabled;return null!==this.sync&&void 0!==this.sync.enabled&&(this.sync.enabled=!1),[e,t]},c.prototype.silenceRestore=function(e){this._silent=!1,e[0]&&(this.history.enabled=!0),e[1]&&null!==this.sync&&void 0!==this.sync.enabled&&(this.sync.enabled=!0)},c.prototype.destroy=function(){this._destroyed||(this._destroyed=!0,this.emit("destroy"),this.unbind())},c);function c(e,t){var n=r.call(this)||this;if(n.entity=null,n.SEPARATOR=".",n._dataType={},n._dataType2={},n.sync=null,n.node=null,n.reparenting=!1,n._pathsWithDuplicates={},n.origin=e,t=t||{},n._destroyed=!1,n._path="",n._keys=[],n._data={},n._data2={},t.pathsWithDuplicates){n._pathsWithDuplicates={};for(var i=0;i<t.pathsWithDuplicates.length;i++)n._pathsWithDuplicates[t.pathsWithDuplicates[i]]=!0}return n.patchData(e),n._silent=!1,n}n.Observer=s},{"./events":142}],147:[function(e,t,n){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,n,i){void 0===i&&(i=n),Object.defineProperty(e,i,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,i){void 0===i&&(i=n),e[i]=t[n]}),o=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||t.hasOwnProperty(n)||i(t,e,n)};Object.defineProperty(n,"__esModule",{value:!0});var r=e("./editor"),a=e("./engine");o(e("./index"),n),window.editor=new r.Editor,window.debug=new r.Debug;new r.InitializeBefore;(new r.Layout).init();new r.Drop,new r.Search,new r.HierarchyKeeper,new r.AssetsKeeper;var s=new r.Viewport;a.VeryEngine.viewport=s;new r.InitializeAfter,new r.InitializeData},{"./editor":78,"./engine":139,"./index":141}],148:[function(e,t,n){"use strict";var i,o=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0}),n.AjaxRequest=n.Ajax=void 0;var r=e("./events"),l=(a.get=function(e){return new s({url:e})},a.post=function(e,t){return new s({method:"POST",url:e,data:t})},a.put=function(e,t){return new s({method:"PUT",url:e,data:t})},a.delete=function(e){return new s({method:"DELETE",url:e})},a.param=function(e,t){a.params[e]=t},a.params={},a);function a(e){return"string"==typeof e&&(e={url:e}),new s(e)}n.Ajax=l;var c,s=(c=r.Events,o(d,c),d.prototype._onLoad=function(){if(this._progress=1,this.emit("progress",1),200===this._xhr.status||201===this._xhr.status)if(this.notJson)this.emit("load",this._xhr.status,this._xhr.responseText);else{try{var e=JSON.parse(this._xhr.responseText)}catch(e){return void this.emit("error",this._xhr.status||0,new Error("invalid json"))}this.emit("load",this._xhr.status,e)}else try{var t=(e=JSON.parse(this._xhr.responseText)).message;t=(t=t||(e.error||e.response&&e.response.error))||this._xhr.responseText,this.emit("error",this._xhr.status,t)}catch(e){this.emit("error",this._xhr.status)}},d.prototype._onError=function(e){this.emit("error",0,e)},d.prototype._onAbort=function(e){this.emit("error",0,e)},d.prototype._onProgress=function(e){var t;!e.lengthComputable||(t=e.loaded/e.total)!==this._progress&&(this._progress=t,this.emit("progress",this._progress))},d.prototype.abort=function(){this._xhr.abort()},d);function d(e){var t=c.call(this)||this;if(t._progress=0,!e)throw new Error("ajax请求无参数，请检查！");t._progress=0,t.emit("progress",t._progress),t._xhr=new XMLHttpRequest,e.cookies&&(t._xhr.withCredentials=!0),t._xhr.addEventListener("load",t._onLoad.bind(t),!1),t._xhr.upload.addEventListener("progress",t._onProgress.bind(t),!1),t._xhr.addEventListener("error",t._onError.bind(t),!1),t._xhr.addEventListener("abort",t._onAbort.bind(t),!1);var n=e.url;if(e.query&&Object.keys(e.query).length){-1===n.indexOf("?")&&(n+="?");var i=[];for(s in e.query)i.push(s+"="+e.query[s]);n+=i.join("&")}var o=n.split("{{");if(1<o.length){for(var r=1;r<o.length;r++){var a=o[r].indexOf("}}"),s=o[r].slice(0,a);void 0!==l.params[s]&&(o[r]=l.params[s]+o[r].slice(a+2))}n=o.join("")}if(t._xhr.open(e.method||"GET",n,!0),t.notJson=e.notJson||!1,e.ignoreContentType||"PUT"!==e.method&&"POST"!==e.method&&"DELETE"!==e.method||t._xhr.setRequestHeader("Content-Type","application/json"),e.headers)for(var s in e.headers)t._xhr.setRequestHeader(s,e.headers[s]);return!e.data||"string"==typeof e.data||e.data instanceof FormData||(e.data=JSON.stringify(e.data)),t._xhr.send(e.data||null),t}n.AjaxRequest=s},{"./events":149}],149:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.EventHandle=n.Events=void 0;var i=(Object.defineProperty(o.prototype,"suspendEvents",{get:function(){return this._suspendEvents},set:function(e){this._suspendEvents=e},enumerable:!1,configurable:!0}),o.prototype.on=function(e,t){var n=this._events[e];return void 0===n?this._events[e]=[t]:-1==n.indexOf(t)&&n.push(t),new r(this,e,t)},o.prototype.once=function(e,l){var c=this,d=this.on(e,function(e,t,n,i,o,r,a,s){l.call(c,e,t,n,i,o,r,a,s),d.unbind()});return d},o.prototype.emit=function(t,e,n,i,o,r,a,s,l){if(this._suspendEvents)return this;var c=this._events[t];if(!c)return this;c=c.slice(0);for(var d=0;d<c.length;d++)if(c[d])try{c[d].call(this,e,n,i,o,r,a,s,l)}catch(e){console.info("%c%s %c(event error)","color: #06f",t,"color: #f00"),console.log(e.stack)}return this},o.prototype.unbind=function(e,t){if(e){var n,i=this._events[e];if(!i)return this;t?-1!==(n=i.indexOf(t))&&(1===i.length?delete this._events[e]:i.splice(n,1)):delete this._events[e]}else this._events={};return this},o);function o(){this._suspendEvents=!1,this._events={}}n.Events=i;var r=(a.prototype.unbind=function(){this.owner&&(this.owner.unbind(this.name,this.fn),this.owner=null,this.name=null,this.fn=null)},a.prototype.call=function(){this.fn&&this.fn.call(this.owner,arguments[0],arguments[1],arguments[2],arguments[3],arguments[4],arguments[5],arguments[6],arguments[7])},a.prototype.on=function(e,t){return this.owner.on(e,t)},a);function a(e,t,n){this.owner=e,this.name=t,this.fn=n}n.EventHandle=r},{}],150:[function(e,t,l){"use strict";var c=this&&this.__awaiter||function(e,a,s,l){return new(s=s||Promise)(function(n,t){function i(e){try{r(l.next(e))}catch(e){t(e)}}function o(e){try{r(l.throw(e))}catch(e){t(e)}}function r(e){var t;e.done?n(e.value):((t=e.value)instanceof s?t:new s(function(e){e(t)})).then(i,o)}r((l=l.apply(e,a||[])).next())})},d=this&&this.__generator||function(n,i){var o,r,a,s={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]},e={next:t(0),throw:t(1),return:t(2)};return"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(t){return function(e){return function(t){if(o)throw new TypeError("Generator is already executing.");for(;s;)try{if(o=1,r&&(a=2&t[0]?r.return:t[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,t[1])).done)return a;switch(r=0,a&&(t=[2&t[0],a.value]),t[0]){case 0:case 1:a=t;break;case 4:return s.label++,{value:t[1],done:!1};case 5:s.label++,r=t[1],t=[0];continue;case 7:t=s.ops.pop(),s.trys.pop();continue;default:if(!(a=0<(a=s.trys).length&&a[a.length-1])&&(6===t[0]||2===t[0])){s=0;continue}if(3===t[0]&&(!a||t[1]>a[0]&&t[1]<a[3])){s.label=t[1];break}if(6===t[0]&&s.label<a[1]){s.label=a[1],a=t;break}if(a&&s.label<a[2]){s.label=a[2],s.ops.push(t);break}a[2]&&s.ops.pop(),s.trys.pop();continue}t=i.call(n,s)}catch(e){t=[6,e],r=0}finally{o=a=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}([t,e])}}};Object.defineProperty(l,"__esModule",{value:!0}),l.login=l.getJsonConfig=l.upLoadJsonConfig=l.donwLoad=l.getThumbnailUrl=l.getUrl=l.getJsonAsset=l.uploadJsonAsset=l.uploadFile=void 0;function u(e){if(e){var t=e.split(".");return 1<t.length?t[t.length-1]:e}return""}var h=e("./ajax");l.uploadFile=function(r,e,a,s,t){return c(void 0,void 0,void 0,function(){return d(this,function(e){return[2,new Promise(function(i,o){return c(void 0,void 0,void 0,function(){var t,n;return d(this,function(e){try{(t=new FormData).append("file",r),t.append("fileName",a+"."+u(s)),n={url:"/api/uploadFile",method:"PUT",data:t,ignoreContentType:!0,headers:{Accept:"application/json"}},new h.Ajax(n).on("load",function(e,t){i()})}catch(e){o(e)}return[2]})})})]})})};l.uploadJsonAsset=function(a,e,s,l,t){return void 0===t&&(t=!0),c(void 0,void 0,void 0,function(){return d(this,function(e){return[2,new Promise(function(o,r){return c(void 0,void 0,void 0,function(){var t,n,i;return d(this,function(e){switch(e.label){case 0:return e.trys.push([0,2,,3]),[4,axios.post("/api/uploadJsonAsset",{jsonName:s+"."+u(l),jsonStr:a})];case 1:return t=e.sent(),"0000"===(n=t.data).code?o(n.data):r(n.message),[3,3];case 2:return i=e.sent(),r(i),[3,3];case 3:return[2]}})})})]})})},l.getJsonAsset=function(e,a,s,t){return c(void 0,void 0,void 0,function(){return d(this,function(e){return[2,new Promise(function(o,r){return c(void 0,void 0,void 0,function(){var t,n,i;return d(this,function(e){switch(e.label){case 0:return e.trys.push([0,2,,3]),[4,axios.post("/api/getJsonAsset",{jsonName:a+"."+u(s)})];case 1:return t=e.sent(),"0000"===(n=t.data).code?o(n.data):r(n.message),[3,3];case 2:return i=e.sent(),r(i),[3,3];case 3:return[2]}})})})]})})};l.getUrl=function(e,n,i,t){return c(void 0,void 0,void 0,function(){return d(this,function(e){return[2,new Promise(function(t,e){return c(void 0,void 0,void 0,function(){return d(this,function(e){return t("/assets/"+n+"."+u(i)),[2]})})})]})})},l.getThumbnailUrl=function(e,n,i,t){return c(void 0,void 0,void 0,function(){return d(this,function(e){return[2,new Promise(function(t,e){return c(void 0,void 0,void 0,function(){return d(this,function(e){return t("/assets/"+n+"."+u(i)),[2]})})})]})})},l.donwLoad=function(o,r,a,s){return c(void 0,void 0,void 0,function(){var t,n,i;return d(this,function(e){switch(e.label){case 0:return[4,l.getUrl(o,r,a,s)];case 1:return t=e.sent(),(n=document.createElement("a")).innerHTML=a,n.download=a,n.href=t,document.body.appendChild(n),(i=document.createEvent("MouseEvents")).initEvent("click",!1,!1),n.dispatchEvent(i),document.body.removeChild(n),[2]}})})},l.upLoadJsonConfig=function(a,s,l){return c(void 0,void 0,void 0,function(){return d(this,function(e){return[2,new Promise(function(o,r){return c(void 0,void 0,void 0,function(){var t,n,i;return d(this,function(e){switch(e.label){case 0:return e.trys.push([0,2,,3]),[4,axios.post("/api/uploadJsonConfig",{projectID:s,jsonName:l,jsonStr:a})];case 1:return t=e.sent(),"0000"===(n=t.data).code?o(n.data):r(n.message),[3,3];case 2:return i=e.sent(),r(i),[3,3];case 3:return[2]}})})})]})})},l.getJsonConfig=function(a,s){return c(void 0,void 0,void 0,function(){return d(this,function(e){return[2,new Promise(function(o,r){return c(void 0,void 0,void 0,function(){var t,n,i;return d(this,function(e){switch(e.label){case 0:return e.trys.push([0,2,,3]),[4,axios.post("/api/getJsonConfig",{projectID:a,jsonName:s})];case 1:return t=e.sent(),"0000"===(n=t.data).code?o(n.data):r(n.message),[3,3];case 2:return i=e.sent(),r(i),[3,3];case 3:return[2]}})})})]})})},l.login=function(s,e){return c(void 0,void 0,void 0,function(){return d(this,function(e){return[2,new Promise(function(r,a){return c(void 0,void 0,void 0,function(){var t,n,i,o;return d(this,function(e){switch(e.label){case 0:return e.trys.push([0,2,,3]),[4,axios.post("/api/getProject",{projectID:s})];case 1:return t=e.sent(),"0000"===(n=t.data).code?((i={code:"00000"}).data=n.data,r(i)):a(n.message),[3,3];case 2:return o=e.sent(),a(o),[3,3];case 3:return[2]}})})})]})})}},{"./ajax":148}],151:[function(e,t,n){"use strict";var i,o=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0}),n.Bubble=void 0;var r,a=e("./element"),s=(r=a.Element,o(l,r),l.prototype._onClick=function(){this.class.contains("active")?this.deactivate():this.activate()},l.prototype.activate=function(){this.class.add("active"),this.emit("activate")},l.prototype.deactivate=function(){this.class.remove("active"),this.emit("deactivate")},l.prototype.position=function(e,t){this.element.getBoundingClientRect();var n=e||0,i=t||0;this.element.style.left="number"==typeof n?n+"px":n,this.element.style.top="number"==typeof i?i+"px":i},l);function l(e,t){var n=r.call(this)||this;n.element=document.createElement("div"),n.element.classList.add("ui-bubble");var i=document.createElement("div");i.classList.add("pulse"),n.element.appendChild(i);var o=document.createElement("div");return o.classList.add("center"),n.element.appendChild(o),n.on("click",n._onClick),void 0!==e&&(n.element.id=e),void 0!==t&&n.element.setAttribute("tabindex",t.toString()),n}n.Bubble=s},{"./element":158}],152:[function(e,t,n){"use strict";var i,o=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0}),n.Button=void 0;var r,a=e("./element"),s=(r=a.Element,o(l,r),Object.defineProperty(l.prototype,"text",{get:function(){return this._text},set:function(e){this._text!==e&&(this._text=e,this.element.innerHTML=this._text)},enumerable:!1,configurable:!0}),l.prototype._onKeyDown=function(e){if(27===e.keyCode)return e.target.blur();32!==e.keyCode||this.disabled||(e.stopPropagation(),e.preventDefault(),this.emit("click"))},l.prototype._onClick=function(){this.element.blur()},l.prototype._onLinkChange=function(e){this.element.value=e},l);function l(e){var t=r.call(this)||this;return t.tooltip=null,t.op="",t._text=e||"",t.element=document.createElement("div"),t.element.classList.add("ui-button"),t.element.innerHTML=t._text,(t.element.ui=t).element.tabIndex=0,t.element.addEventListener("keydown",t._onKeyDown.bind(t),!1),t.on("click",t._onClick),t}n.Button=s},{"./element":158}],153:[function(e,t,n){"use strict";var i,o=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0}),n.Canvas=void 0;var r,a=e("./element"),s=(r=a.Element,o(l,r),Object.defineProperty(l.prototype,"width",{get:function(){return this.element?this.element.width:0},set:function(e){this.element&&this.element.width!==e&&(this.element.width=e,this.emit("resize",this.element.width,this.element.height))},enumerable:!1,configurable:!0}),Object.defineProperty(l.prototype,"height",{get:function(){return this.element?this.element.height:0},set:function(e){this.element&&this.element.height!==e&&(this.element.height=e,this.emit("resize",this.element.width,this.element.height))},enumerable:!1,configurable:!0}),l.prototype.onselectstart=function(){return!1},l.prototype.resize=function(e,t){this.element.width===e&&this.element.height===t||(this.element.width=e,this.element.height=t,this.emit("resize",this.element.width,this.element.height))},l);function l(e){var t=r.call(this)||this;return t.element=document.createElement("canvas"),t.element.classList.add("ui-canvas"),void 0!==e&&(t.element.id=e),t.element.onselectstart=t.onselectstart,t}n.Canvas=s},{"./element":158}],154:[function(e,t,n){"use strict";var i,o=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0}),n.Checkbox=void 0;var r,a=e("./element"),s=(r=a.Element,o(l,r),Object.defineProperty(l.prototype,"value",{get:function(){return this._link?this._link.get(this.path):this.element.classList.contains("checked")},set:function(e){this._link?this._link.set(this.path,e):this.element.classList.contains("checked")!==e&&this._onLinkChange(e)},enumerable:!1,configurable:!0}),l.prototype._onClick=function(){this.value=!this.value,this.element.blur()},l.prototype._onChange=function(){this.renderChanges&&this.flash()},l.prototype._onKeyDown=function(e){if(27===e.keyCode)return e.target.blur();32!==e.keyCode||this.disabled||(e.stopPropagation(),e.preventDefault(),this.value=!this.value)},l.prototype._onLinkChange=function(e){null===e?(this.element.classList.remove("checked"),this.element.classList.add("null")):e?(this.element.classList.add("checked"),this.element.classList.remove("null")):this.element.classList.remove("checked","null"),this.emit("change",e)},l);function l(e){var t=r.call(this)||this;return t._text=e||"",t.element=document.createElement("div"),t.element.classList.add("ui-checkbox","noSelect"),t.element.tabIndex=0,t.element.addEventListener("keydown",t._onKeyDown.bind(t),!1),t.on("click",t._onClick),t.on("change",t._onChange),t}n.Checkbox=s},{"./element":158}],155:[function(e,t,n){"use strict";var i,o=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0}),n.Code=void 0;var r,a=e("./container-element"),s=(r=a.ContainerElement,o(l,r),Object.defineProperty(l.prototype,"text",{get:function(){return this.element.textContent||""},set:function(e){this.element.textContent=e},enumerable:!1,configurable:!0}),l);function l(){var e=r.call(this)||this;return e.element=document.createElement("pre"),e.element.classList.add("ui-code"),e}n.Code=s},{"./container-element":157}],156:[function(e,t,n){"use strict";var i,o=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0}),n.ColorField=void 0;var r,a=e("./element"),s=(r=a.Element,o(l,r),Object.defineProperty(l.prototype,"channels",{get:function(){return this._channels},set:function(e){console.warn(e),this._channels!==e&&(this._channels=e,this.emit("channels",this._channels))},enumerable:!1,configurable:!0}),Object.defineProperty(l.prototype,"r",{get:function(){return this._link?Math.floor(255*this._link.get(this.path+".0")):this._values[0]},set:function(e){e=Math.min(0,Math.max(255,e)),this._values[0]!==e&&(this._values[0]=e,this.emit("r",this._values[0]),this.emit("change",this._values.slice(0,this._channels)))},enumerable:!1,configurable:!0}),Object.defineProperty(l.prototype,"g",{get:function(){return this._link?Math.floor(255*this._link.get(this.path+".1")):this._values[1]},set:function(e){e=Math.min(0,Math.max(255,e)),this._values[1]!==e&&(this._values[1]=e,2<=this._channels&&(this.emit("g",this._values[1]),this.emit("change",this._values.slice(0,this._channels))))},enumerable:!1,configurable:!0}),Object.defineProperty(l.prototype,"b",{get:function(){return this._link?Math.floor(255*this._link.get(this.path+".2")):this._values[2]},set:function(e){e=Math.min(0,Math.max(255,e)),this._values[2]!==e&&(this._values[2]=e,3<=this._channels&&(this.emit("b",this._values[2]),this.emit("change",this._values.slice(0,this._channels))))},enumerable:!1,configurable:!0}),Object.defineProperty(l.prototype,"a",{get:function(){return this._link?Math.floor(255*this._link.get(this.path+".3")):this._values[3]},set:function(e){e=Math.min(0,Math.max(255,e)),this._values[3]!==e&&(this._values[3]=e,4<=this._channels&&(this.emit("a",this._values[3]),this.emit("change",this._values.slice(0,this._channels))))},enumerable:!1,configurable:!0}),Object.defineProperty(l.prototype,"hex",{get:function(){var e=this._values;this._link&&(e=this._link.get(this.path).map(function(e){return Math.floor(255*e)}));for(var t="",n=0;n<this._channels;n++)t+=("00"+e[n].toString(16)).slice(-2);return t},set:function(e){console.log("todo color-field: "+e)},enumerable:!1,configurable:!0}),Object.defineProperty(l.prototype,"value",{get:function(){return this._link?this._link.get(this.path):this._values},set:function(e){this._link?this._link.set(this.path,e):this._values=e,this.emit("change",e)},enumerable:!1,configurable:!0}),l.prototype._onKeyDown=function(e){if(27===e.keyCode)return this.element.blur();13!==e.keyCode||this.disabled||(e.stopPropagation(),e.preventDefault(),this.emit("click"))},l.prototype._onChange=function(e){var t;1===this._channels?this.elementColor.style.backgroundColor="rgb("+[this.r,this.r,this.r].join(",")+")":3===this._channels?this.elementColor.style.backgroundColor="rgb("+this._values.slice(0,3).join(",")+")":4===this._channels?((t=this._values.slice(0,4))[3]/=255,this.elementColor.style.backgroundColor="rgba("+t.join(",")+")"):console.log("unknown channels",e)},l.prototype._onLink=function(){for(var t=this,e=0;e<4;e++)this.evtLinkChannels[e]=this._link.on(this.path+"."+e+":set",function(e){t._setValue(t._link.get(t.path))}.bind(t))},l.prototype._onUnlink=function(){for(var e=0;e<this.evtLinkChannels.length;e++)this.evtLinkChannels[e].unbind();this.evtLinkChannels=[]},l.prototype._onLinkChange=function(e){e&&this._setValue(e)},l.prototype._setValue=function(e){var t=!1;if(e){e.length!==this._channels&&(t=!0,this.channels=e.length);for(var n=0;n<this._channels;n++)this._values[n]!==Math.floor(e[n])&&(t=!0,this._values[n]=Math.floor(e[n]));t&&this.emit("change",this._values.slice(0,this._channels))}},l);function l(){var e=r.call(this)||this;return e.element=document.createElement("div"),e.element.tabIndex=0,e.element.classList.add("ui-color-field","rgb"),e.elementColor=document.createElement("span"),e.elementColor.classList.add("color"),e.element.appendChild(e.elementColor),e._channels=3,e._values=[0,0,0,0],e.element.addEventListener("keydown",e._onKeyDown.bind(e),!1),e.on("change",e._onChange),e.evtLinkChannels=[],e.on("link",e._onLink),e.on("unlink",e._onUnlink),e}n.ColorField=s},{"./element":158}],157:[function(e,t,n){"use strict";var i,o=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0}),n.ContainerElement=void 0;var r,a=e("./element"),s=(r=a.Element,o(l,r),Object.defineProperty(l.prototype,"innerElement",{get:function(){return this._innerElement},set:function(e){this._innerElement&&this._observer.disconnect(),this._innerElement=e,this._observer.observe(this._innerElement,this._observerOptions)},enumerable:!1,configurable:!0}),Object.defineProperty(l.prototype,"flexible",{get:function(){return!!this.element&&this.element.classList.contains("flexible")},set:function(e){this.element&&this.element.classList.contains("flexible")!==e&&(e?this.element.classList.add("flexible"):this.element.classList.remove("flexible"))},enumerable:!1,configurable:!0}),Object.defineProperty(l.prototype,"flex",{get:function(){return!!this.element&&this.element.classList.contains("flex")},set:function(e){this.element&&this.element.classList.contains("flex")!==e&&(e?this.element.classList.add("flex"):this.element.classList.remove("flex"))},enumerable:!1,configurable:!0}),Object.defineProperty(l.prototype,"flexDirection",{get:function(){return this._innerElement&&this._innerElement.style.flexDirection||""},set:function(e){this._innerElement&&(this._innerElement.style.flexDirection=e,this._innerElement.style.webkitFlexDirection=e)},enumerable:!1,configurable:!0}),Object.defineProperty(l.prototype,"flexWrap",{get:function(){return this._innerElement&&this._innerElement.style.flexWrap||""},set:function(e){this._innerElement&&(this._innerElement.style.flexWrap=e,this._innerElement.style.webkitFlexWrap=e)},enumerable:!1,configurable:!0}),Object.defineProperty(l.prototype,"flexGrow",{get:function(){return this.element&&this.element.style.flexGrow||""},set:function(e){e&&(this.flex=!0),this.element&&(this.element.style.flexGrow=e,this.element.style.webkitFlexGrow=e),this._innerElement&&(this._innerElement.style.flexGrow=e,this._innerElement.style.webkitFlexGrow=e)},enumerable:!1,configurable:!0}),Object.defineProperty(l.prototype,"flexShrink",{get:function(){return this.element&&this.element.style.flexShrink||""},set:function(e){e&&(this.flex=!0),this.element&&(this.element.style.flexShrink=e,this.element.style.webkitFlexShrink=e),this._innerElement&&(this._innerElement.style.flexShrink=e,this._innerElement.style.webkitFlexShrink=e)},enumerable:!1,configurable:!0}),Object.defineProperty(l.prototype,"scroll",{get:function(){return!!this.class&&this.class.contains("scrollable")},set:function(e){this.class&&this.class.add("scrollable")},enumerable:!1,configurable:!0}),l.prototype.append=function(e){var t=e instanceof HTMLElement,n=t?e:e.element;this._innerElement.appendChild(n),t||(e.parent=this).emit("append",e)},l.prototype.appendBefore=function(e,t){var n=e instanceof HTMLElement,i=n?e:e.element;t instanceof a.Element&&(t=t.element),this._innerElement.insertBefore(i,t),n||(e.parent=this).emit("append",e)},l.prototype.appendAfter=function(e,t){var n=e instanceof HTMLElement,i=n?e:e.element;t instanceof a.Element&&(t=t.element),t?this._innerElement.insertBefore(i,t.nextSibling):this._innerElement.appendChild(i),n||(e.parent=this).emit("append",e)},l.prototype.prepend=function(e){var t=this._innerElement.firstChild,n=e instanceof HTMLElement,i=n?e:e.element;t?this._innerElement.insertBefore(i,t):this._innerElement.appendChild(i),n||(e.parent=this).emit("append",e)},l.prototype.remove=function(e){var t=e instanceof HTMLElement,n=t?e:e.element;n.parentElement&&n.parentElement===this._innerElement&&(this._innerElement.removeChild(n),t||(e.parent=null,this.emit("remove",e)))},l.prototype.clear=function(){var e;this._observer.disconnect();for(var t=this._innerElement.children.length;t--;)(e=this._innerElement.children[t]).ui&&e.ui.destroy();this._innerElement.innerHTML="",this._observer.observe(this._innerElement,this._observerOptions)},l);function l(){var e=r.call(this)||this;e._innerElement=null,e._observerChanged=!1,e._observerOptions={childList:!0,attributes:!0,characterData:!1,subtree:!0,attributeOldValue:!1,characterDataOldValue:!1};function t(){n._observerChanged=!1,n.emit("nodesChanged")}var n=e;return e._observer=new MutationObserver(function(){n._observerChanged||(n._observerChanged=!0,setTimeout(t,0))}),e}n.ContainerElement=s},{"./element":158}],158:[function(e,t,n){"use strict";var i,o=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0}),n.Element=void 0;var r,a=e("../lib"),s=(r=a.Events,o(l,r),Object.defineProperty(l.prototype,"element",{get:function(){return this._element},set:function(e){var t;this._element||(this._element=e,(this._element.ui=this)._element&&((t=this)._element.addEventListener("click",function(e){t.disabled&&!t.disabledClick||t.emit("click",e)},!1),this._element.addEventListener("mouseover",function(e){t.emit("hover",e)},!1),this._element.addEventListener("mouseout",function(e){t.emit("blur",e)},!1)))},enumerable:!1,configurable:!0}),Object.defineProperty(l.prototype,"parent",{get:function(){return this._parent},set:function(e){this._parent&&(this._parent=null,this._evtParentDestroy.unbind(),this._evtParentDisable.unbind(),this._evtParentEnable.unbind()),e&&(this._parent=e,this._evtParentDestroy=this._parent.once("destroy",this._parentDestroy.bind(this)),this._evtParentDisable=this._parent.on("disable",this._parentDisable.bind(this)),this._evtParentEnable=this._parent.on("enable",this._parentEnable.bind(this)),this._disabledParent!==this._parent.disabled&&(this._disabledParent=this._parent.disabled,this._disabledParent?(this.class.add("disabled"),this.emit("disable")):(this.class.remove("disabled"),this.emit("enable")))),this.emit("parent")},enumerable:!1,configurable:!0}),Object.defineProperty(l.prototype,"disabled",{get:function(){return this._disabled||this._disabledParent},set:function(e){this._disabled!==e&&(this._disabled=!!e,this.emit(this._disabled||this._disabledParent?"disable":"enable"),this._disabled||this._disabledParent?this.class&&this.class.add("disabled"):this.class&&this.class.remove("disabled"))},enumerable:!1,configurable:!0}),Object.defineProperty(l.prototype,"disabledSelf",{get:function(){return this._disabled},enumerable:!1,configurable:!0}),Object.defineProperty(l.prototype,"enabled",{get:function(){return!this._disabled},set:function(e){this.disabled=!e},enumerable:!1,configurable:!0}),Object.defineProperty(l.prototype,"hidden",{get:function(){return!!this._element&&this._element.classList.contains("hidden")},set:function(e){this._element&&this._element.classList.contains("hidden")!==!!e&&(e?(this._element.classList.add("hidden"),this.emit("hide")):(this._element.classList.remove("hidden"),this.emit("show")))},enumerable:!1,configurable:!0}),Object.defineProperty(l.prototype,"value",{get:function(){return this._link?this._link.get(this.path):null},set:function(e){this._link&&this._link.set(this.path,e)},enumerable:!1,configurable:!0}),Object.defineProperty(l.prototype,"class",{get:function(){return this._element?this._element.classList:null},enumerable:!1,configurable:!0}),Object.defineProperty(l.prototype,"style",{get:function(){return this._element?this._element.style:null},enumerable:!1,configurable:!0}),Object.defineProperty(l.prototype,"flexGrow",{get:function(){return this._element&&this._element.style.flexGrow||""},set:function(e){this._element&&(this._element.style.flexGrow=e,this._element.style.webkitFlexGrow=e)},enumerable:!1,configurable:!0}),Object.defineProperty(l.prototype,"flexShrink",{get:function(){return this._element&&this._element.style.flexShrink||""},set:function(e){this._element&&(this._element.style.flexShrink=e,this._element.style.webkitFlexShrink=e)},enumerable:!1,configurable:!0}),l.prototype.flash=function(){this.class&&(this.class.add("flash"),setTimeout(this._onFlashDelay,200))},l.prototype._onFlashDelay=function(){this.class&&this.class.remove("flash")},l.prototype.link=function(e,t){var n,i=this;this._link&&this.unlink(),this._link=e,this.path=t,this.emit("link",t),this._onLinkChange&&(n=this.renderChanges,this.renderChanges=!1,this._linkOnSet=this._link.on(this.path+":set",function(e){i._onLinkChange(e)}),this._linkOnUnset=this._link.on(this.path+":unset",function(e){i._onLinkChange(e)}),this._onLinkChange(this._link.get(this.path)),this.renderChanges=n)},l.prototype.unlink=function(){this._link&&(this.emit("unlink",this.path),this._linkOnSet&&(this._linkOnSet.unbind(),this._linkOnSet=null,this._linkOnUnset.unbind(),this._linkOnUnset=null),this._link=null,this.path="")},l.prototype._onLinkChange=function(e){},l.prototype.destroy=function(){this._destroyed||(this._destroyed=!0,this._parent&&(this._evtParentDestroy.unbind(),this._evtParentDisable.unbind(),this._evtParentEnable.unbind(),this._parent=null),this._element&&this._element.parentNode&&this._element.parentNode.removeChild(this._element),this.unlink(),this.emit("destroy"),this.unbind())},l.prototype._parentDestroy=function(){this.destroy()},l.prototype._parentDisable=function(){this._disabledParent||(this._disabledParent=!0,this._disabled||(this.emit("disable"),this.class.add("disabled")))},l.prototype._parentEnable=function(){this._disabledParent&&(this._disabledParent=!1,this._disabled||(this.emit("enable"),this.class.remove("disabled")))},l);function l(){var e=r.call(this)||this;return e._parent=null,e._destroyed=!1,e._link=null,e._linkOnSet=null,e._linkOnUnset=null,e.path="",e.renderChanges=!1,e.disabledClick=!1,e._disabled=!1,e._disabledParent=!1,e._evtParentDestroy=null,e._evtParentDisable=null,e._evtParentEnable=null,e._element=null,e._parent=null,e}n.Element=s},{"../lib":143}],159:[function(e,t,n){"use strict";var i,o=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0}),n.GridItemArgs=n.GridItem=void 0;var r,a=e("./element"),s=(r=a.Element,o(l,r),Object.defineProperty(l.prototype,"text",{get:function(){return this._text},set:function(e){this._text!==e&&(this._text=e,this.element.innerHTML=this._text)},enumerable:!1,configurable:!0}),Object.defineProperty(l.prototype,"selected",{get:function(){return this._selected},set:function(e){this._selected!==e&&(this._selectPending=e,this.parent&&this._clicked&&this.parent.emit("before"+(e?"Select":"Deselect"),this,this._clicked),this._selected!==this._selectPending&&(this._selected=this._selectPending,this._selected?this.element.classList.add("selected"):this.element.classList.remove("selected"),this.emit(this.selected?"select":"deselect"),this.emit("change",this.selected),this.parent&&this.parent.emit(this.selected?"select":"deselect",this,this._clicked)))},enumerable:!1,configurable:!0}),l.prototype._onClick=function(){this.emit("click"),this._clicked=!0,this._toggleSelectOnClick?this.selected=!this.selected:this.selected=!0,this._clicked=!1},l.prototype._onSelect=function(){this.element.focus()},l.prototype._onDeselect=function(){this.element.blur()},l);function l(e){var t=r.call(this)||this;return e=e||{},t._text=e.text||"",t._selectPending=!1,t._selected=e.selected||!1,t._toggleSelectOnClick=!e||void 0===e.toggleSelectOnClick||e.toggleSelectOnClick,t._clicked=!1,t.element=document.createElement("li"),(t.element.ui=t).element.tabIndex=0,t.element.classList.add("ui-grid-item"),t.element.innerHTML=t._text,t.element.addEventListener("click",t._onClick.bind(t),!1),t.on("select",t._onSelect),t.on("deselect",t._onDeselect),t}n.GridItem=s;function c(){}n.GridItemArgs=c},{"./element":158}],160:[function(e,t,n){"use strict";var i,o=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0}),n.Grid=void 0;var r,a=e("./container-element"),s=e("../editor"),l=(r=a.ContainerElement,o(c,r),Object.defineProperty(c.prototype,"selected",{get:function(){for(var e=[],t=this.element.querySelectorAll(".ui-grid-item.selected"),n=0;n<t.length;n++)e.push(t[n].ui);return e},set:function(e){if(!this._selecting){this._selecting=!0;for(var t=this.selected,n=0;n<t.length;n++)e&&-1!==e.indexOf(t[n])||(t[n].selected=!1);if(e){for(n=0;n<e.length;n++)e[n]&&(e[n].selected=!0);this._selecting=!1}}},enumerable:!1,configurable:!0}),c._ctrl=function(){return s.Hotkeys.ctrl},c._shift=function(){return s.Hotkeys.shift},c.prototype._onAppend=function(){},c.prototype._onRemove=function(){},c.prototype._onSelect=function(e){if(!this._selecting)if(this._multiSelect&&c._shift&&c._shift()){var t=Array.prototype.slice.call(this.element.childNodes,0);if(this._lastSelect){this._selecting=!0;var n,i=t.indexOf(this._lastSelect.element),o=t.indexOf(e.element);o<i&&(n=i,i=o,o=n);for(var r=i;r<o;r++)t[r]&&t[r].ui&&!t[r].ui.hidden&&(t[r].ui.selected=!0);this._selecting=!1}else this._lastSelect=e}else if(this._multiSelect&&c._ctrl&&c._ctrl())this._lastSelect=e;else{var a=this.element.querySelectorAll(".ui-grid-item.selected");if(1<a.length)for(r=0;r<a.length;r++)a[r].ui!==e&&(a[r].ui.selected=!1);this._lastSelect=e}},c.prototype._onBeforeDeselect=function(e){if(!this._selecting){if(this._selecting=!0,this._multiSelect&&c._shift&&c._shift())this._lastSelect=null;else if(this._multiSelect&&c._ctrl&&c._ctrl())this._lastSelect=null;else{var t=this.element.querySelectorAll(".ui-grid-item.selected");if(1<t.length){for(var n=0;n<t.length;n++)t[n].ui!==e&&(t[n].ui.selected=!1);e._selectPending=!0,this._lastSelect=e}}this._selecting=!1}},c.prototype.filter=function(t){this.forEach(function(e){e.hidden=!t(e)})},c.prototype.forEach=function(e){for(var t=this.element.firstChild;t;)t.ui&&e(t.ui),t=t.nextSibling},c);function c(e){var t=r.call(this)||this;return t.element=document.createElement("ul"),t.element.tabIndex=0,t.element.classList.add("ui-grid"),t.innerElement=t.element,t._lastSelect=null,t._selecting=!1,t._multiSelect=void 0===e||e,t.on("select",t._onSelect),t.on("beforeDeselect",t._onBeforeDeselect),t.on("append",t._onAppend),t.on("remove",t._onRemove),t}n.Grid=l},{"../editor":78,"./container-element":157}],161:[function(e,t,n){"use strict";var i,o=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0}),n.ImageField=void 0;var r,a=e("./element"),s=(r=a.Element,o(l,r),Object.defineProperty(l.prototype,"image",{get:function(){return this.elementImage instanceof HTMLCanvasElement?"":this.elementImage.src},set:function(e){this.elementImage instanceof HTMLImageElement?this.elementImage.src=e:this.elementImage.style.backgroundImage='url("'+e+'")'},enumerable:!1,configurable:!0}),Object.defineProperty(l.prototype,"empty",{get:function(){return this.class.contains("empty")},set:function(e){this.class.contains("empty")!==!!e&&(e?(this.class.add("empty"),this.image=""):this.class.remove("empty"))},enumerable:!1,configurable:!0}),Object.defineProperty(l.prototype,"value",{get:function(){return this._link?this._link.get(this.path):this._value},set:function(e){if(this._link)this._link.set(this.path,e)||(this._value=this._link.get(this.path));else{if(this._value===e&&!this.class.contains("null"))return;this._value=e,this.emit("change",e)}},enumerable:!1,configurable:!0}),l.prototype._onClick=function(e){this.emit("click",e)},l.prototype._onChange=function(){this.renderChanges&&this.flash()},l.prototype._onKeyDown=function(e){if(27===e.keyCode)return this.element.blur();32!==e.keyCode||this.disabled||(e.stopPropagation(),e.preventDefault(),this.emit("pick"))},l.prototype._onLinkChange=function(e){this._value=e,this.emit("change",e)},l);function l(e){var t=r.call(this)||this;return t._lable=null,t._title=null,t.element=document.createElement("div"),t.element.classList.add("ui-image-field","empty"),e?(t.elementImage=document.createElement("canvas"),t.elementImage.width=64,t.elementImage.height=64):t.elementImage=new Image,t.elementImage.classList.add("preview"),t.element.appendChild(t.elementImage),t._value=null,t.element.addEventListener("click",t._onClick.bind(t),!1),t.on("change",t._onChange.bind(t)),t.element.addEventListener("keydown",t._onKeyDown.bind(t),!1),t}n.ImageField=s},{"./element":158}],162:[function(e,t,n){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,n,i){void 0===i&&(i=n),Object.defineProperty(e,i,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,i){void 0===i&&(i=n),e[i]=t[n]}),o=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||t.hasOwnProperty(n)||i(t,e,n)};Object.defineProperty(n,"__esModule",{value:!0}),o(e("./top/index"),n),o(e("./link"),n),o(e("./element"),n),o(e("./container-element"),n),o(e("./panel"),n),o(e("./canvas"),n),o(e("./button"),n),o(e("./label"),n),o(e("./text-field"),n),o(e("./textarea-field"),n),o(e("./tree"),n),o(e("./tree-item"),n),o(e("./list"),n),o(e("./list-item"),n),o(e("./checkbox"),n),o(e("./bubble"),n),o(e("./overlay"),n),o(e("./tooltip"),n),o(e("./progress"),n),o(e("./menu-item"),n),o(e("./menu"),n),o(e("./code"),n),o(e("./color-field"),n),o(e("./grid-item"),n),o(e("./grid"),n),o(e("./image-field"),n),o(e("./number-field"),n),o(e("./slider"),n),o(e("./select-field"),n)},{"./bubble":151,"./button":152,"./canvas":153,"./checkbox":154,"./code":155,"./color-field":156,"./container-element":157,"./element":158,"./grid":160,"./grid-item":159,"./image-field":161,"./label":163,"./link":164,"./list":166,"./list-item":165,"./menu":168,"./menu-item":167,"./number-field":169,"./overlay":170,"./panel":171,"./progress":172,"./select-field":173,"./slider":174,"./text-field":175,"./textarea-field":176,"./tooltip":177,"./top/index":178,"./tree":183,"./tree-item":182}],163:[function(e,t,n){"use strict";var i,o=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0}),n.Label=void 0;var r,a=e("./element"),s=(r=a.Element,o(l,r),Object.defineProperty(l.prototype,"text",{get:function(){return this._link?this._link.get(this.path):this._text},set:function(e){if(this._link)this._link.set(this.path,e),e=this._link.get(this.path),this._setText(e);else{if(this._text===e)return;this._text=null==e?"":e,this._setText(this._text),this.emit("change",e)}},enumerable:!1,configurable:!0}),Object.defineProperty(l.prototype,"placeholder",{get:function(){return this.element.getAttribute("placeholder")||""},set:function(e){this.element.setAttribute("placeholder",e)},enumerable:!1,configurable:!0}),Object.defineProperty(l.prototype,"value",{get:function(){return this.text},set:function(e){this.text=e},enumerable:!1,configurable:!0}),l.prototype._setText=function(e){this._unsafe?this.element.innerHTML=e:this.element.textContent=e},l.prototype._onChange=function(){this.renderChanges&&this.flash()},l.prototype._onLinkChange=function(e){this.text=e,this.emit("change",e)},l);function l(e,t,n){var i=r.call(this)||this;return i.tooltip=null,i._text=e||"",i._unsafe=n||!1,i.element=document.createElement("span"),i.element.classList.add("ui-label"),i._text&&i._setText(i._text),i.on("change",i._onChange),t&&(i.placeholder=t),i}n.Label=s},{"./element":158}],164:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.LinkSchema=n.Link=void 0;var i=(o.prototype.get=function(e){return this._value[e]},o.prototype.set=function(e,t){return this._value[e]=t,!0},o.prototype.on=function(e,t){return this._element.on(e,t)},o);function o(e){this._value={},this._element=e}n.Link=i;var r=(a.prototype.has=function(e){return!0},a.prototype.get=function(e){return!0},a);function a(){}n.LinkSchema=r},{}],165:[function(e,t,n){"use strict";var i,o=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0}),n.ListItem=void 0;var r,a=e("./element"),s=(r=a.Element,o(l,r),Object.defineProperty(l.prototype,"text",{get:function(){return this._text},set:function(e){this._text!==e&&(this._text=e,this.elementText.textContent=this._text)},enumerable:!1,configurable:!0}),Object.defineProperty(l.prototype,"selected",{get:function(){return this._selected},set:function(e){this._selected!==e&&(this._selected=e,this._selected?this.element.classList.add("selected"):this.element.classList.remove("selected"),this.emit(this.selected?"select":"deselect"),this.parent&&this.parent.emit(this.selected?"select":"deselect",this),this.emit("change",this.selected))},enumerable:!1,configurable:!0}),l.prototype._onClick=function(){this.selected?this._allowDeselect&&(this.selected=!1):this.selected=!0},l);function l(e,t,n){var i=r.call(this)||this;return i._text=e||"",i._selected=t||!1,i._allowDeselect=n||!1,i.element=document.createElement("li"),i.element.classList.add("ui-list-item"),(i.element.ui=i).elementText=document.createElement("span"),i.elementText.textContent=i._text,i.element.appendChild(i.elementText),i.on("click",i._onClick),i}n.ListItem=s},{"./element":158}],166:[function(e,t,n){"use strict";var i,o=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0}),n.List=void 0;var r,a=e("./container-element"),s=e("../editor"),l=(r=a.ContainerElement,o(c,r),Object.defineProperty(c.prototype,"selectable",{get:function(){return this._selectable},set:function(e){this._selectable!==!!e&&(this._selectable=e,this._selectable?this.class.add("selectable"):this.class.remove("selectable"))},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"selected",{get:function(){return this._selected.slice(0)},set:function(e){this._changing=!0;for(var t=this.selected,n=0;n<t.length;n++)-1===e.indexOf(t[n])&&(t[n].selected=!1);for(n=0;n<e.length;n++)e[n].selected=!0;this._changing=!1},enumerable:!1,configurable:!0}),c.prototype._onSelect=function(e){if(-1===this._selected.indexOf(e)&&this._selected.push(e),!this._changing){if(!(c._ctrl&&c._ctrl()||c._shift&&c._shift()&&this.selected.length)){this._changing=!0;var t=this.selected;if(1<t.length)for(var n=0;n<t.length;n++)t[n]!==e&&(t[n].selected=!1);this._changing=!1}this.emit("change")}},c.prototype._onDeselect=function(e){var t=this._selected.indexOf(e);if(-1!==t&&this._selected.splice(t,1),!this._changing){if(!c._ctrl||!c._ctrl()){this._changing=!0;var n=this.selected;if(n.length){for(var i=0;i<n.length;i++)n[i].selected=!1;e.selected=!0}this._changing=!1}this.emit("change")}},c.prototype._onAppend=function(e){e.selected&&-1===this._selected.indexOf(e)&&this._selected.push(e)},c.prototype.clear=function(){this._selected=[],a.ContainerElement.prototype.clear.call(this)},c._ctrl=function(){return s.Hotkeys.ctrl},c._shift=function(){return s.Hotkeys.shift},c);function c(e){var t=r.call(this)||this;return t.element=document.createElement("ul"),t.element.classList.add("ui-list"),t.innerElement=t.element,t._selectable=e||!0,t._changing=!1,t._selected=[],t.on("select",t._onSelect),t.on("deselect",t._onDeselect),t.on("append",t._onAppend),t}n.List=l},{"../editor":78,"./container-element":157}],167:[function(e,t,n){"use strict";var i,o=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0}),n.MenuItem=void 0;var r,a=e("./container-element"),s=(r=a.ContainerElement,o(l,r),Object.defineProperty(l.prototype,"value",{get:function(){return this._value},set:function(e){var t;this._value!==e&&(t=this._value,this._value=e,this.emit("value",e,t))},enumerable:!1,configurable:!0}),Object.defineProperty(l.prototype,"text",{get:function(){return this.elementText.textContent||""},set:function(e){this.elementText.textContent!==e&&(this.elementText.textContent=e)},enumerable:!1,configurable:!0}),Object.defineProperty(l.prototype,"icon",{get:function(){return null!==this.elementIcon&&this.elementIcon.textContent||""},set:function(e){!e&&!this.elementIcon||this.elementIcon&&this.elementIcon.textContent===e||(e?(this.elementIcon||(this.elementIcon=document.createElement("span"),this.elementIcon.classList.add("icon"),this.elementTitle.insertBefore(this.elementIcon,this.elementText)),this.elementIcon.innerHTML=e):(this.elementIcon&&this.elementIcon.parentNode&&this.elementIcon.parentNode.removeChild(this.elementIcon),this.elementIcon=null))},enumerable:!1,configurable:!0}),l.prototype._onMouseEnter=function(e){e.stopPropagation(),e.preventDefault(),e.target.ui.parent.emit("over",[this._value])},l.prototype._onTouchStart=function(e){var t=e.target.ui;t.parent&&!t.disabled&&(!t._container||t.class.contains("hover")?(t.emit("select",t._value,t._hasChildren),t.parent.emit("select-propagate",[t._value],t._hasChildren),t.class.remove("hover")):t.parent.emit("over",[t._value]))},l.prototype._onTouchEnd=function(e){var t=e.target.ui;t.parent&&!t.disabled&&(e.preventDefault(),e.stopPropagation())},l.prototype._onClick=function(){this.parent&&!this.disabled&&(this.emit("select",this._value,this._hasChildren),this.parent.emit("select-propagate",[this._value],this._hasChildren),this._clickableSubmenus&&this._hasChildren||this.class.remove("hover"))},l.prototype._onOver=function(e){this.parent&&(e.splice(0,0,this._value),this.parent.emit("over",e))},l.prototype._onSelectPropagate=function(e,t){this.parent&&(e.splice(0,0,this._value),this.parent.emit("select-propagate",e,t),this._clickableSubmenus&&t||this.class.remove("hover"))},l.prototype._onAppend=function(n){var i=this;this._container=!0,this.class.add("container"),(this._index[n.value]=n).on("value",function(e,t){delete i._index[t],i._index[e]=n}),n.once("destroy",function(){delete i._index[n.value]})},l);function l(e){var t=r.call(this)||this;return t._clickableSubmenus=!1,t._index={},e=e||{},t._value=e.value||"",t._hasChildren=e.hasChildren||!1,t._clickableSubmenus=e.clickableSubmenus||!1,t.element=document.createElement("div"),t.element.classList.add("ui-menu-item"),e.className&&t.element.classList.add(e.className),t.elementTitle=document.createElement("div"),t.elementTitle.classList.add("title"),(t.elementTitle.ui=t).element.appendChild(t.elementTitle),t.elementIcon=null,t.elementText=document.createElement("span"),t.elementText.classList.add("text"),t.elementText.textContent=e.text||"Untitled",t.elementTitle.appendChild(t.elementText),t.innerElement=document.createElement("div"),t.innerElement.classList.add("content"),t.element.appendChild(t.innerElement),t._index={},t._container=!1,t.elementTitle.addEventListener("mouseenter",t._onMouseEnter.bind(t),!1),t.elementTitle.addEventListener("touchstart",t._onTouchStart,!1),t.elementTitle.addEventListener("touchend",t._onTouchEnd,!1),t.elementTitle.addEventListener("click",t._onClick.bind(t),!1),t.on("over",t._onOver.bind(t)),t.on("select-propagate",t._onSelectPropagate.bind(t)),t.on("append",t._onAppend.bind(t)),e.icon&&(t.icon=e.icon),t}n.MenuItem=s},{"./container-element":157}],168:[function(e,t,n){"use strict";var i,o=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0}),n.Menu=void 0;var r,a=e("./container-element"),s=e("./menu-item"),l=(r=a.ContainerElement,o(c,r),Object.defineProperty(c.prototype,"open",{get:function(){return this.class.contains("open")},set:function(e){this.class.contains("open")!==!!e&&(e?(this.class.add("open"),this.element.focus()):this.class.remove("open"),this.emit("open",!!e))},enumerable:!1,configurable:!0}),c.prototype._onClick=function(){this.open=!1},c.prototype._onContextMenu=function(){this.open=!1},c.prototype._onKeyDown=function(e){this.open&&27===e.keyCode&&(this.open=!1)},c.prototype._onAppend=function(n){var i=this;(this._index[n.value]=n).on("value",function(e,t){delete i._index[t],i._index[e]=n}),n.once("destroy",function(){delete i._index[n.value]})},c.prototype._onOver=function(e){this._updatePath(e)},c.prototype._onOpen=function(e){e||this._updatePath([])},c.prototype._onSelectPropagate=function(e,t){this._clickableSubmenus&&t?this._updatePath(e):(this.open=!1,this.emit(e.join(".")+":select",e),this.emit("select",e))},c.prototype.findByPath=function(e){e instanceof Array||(e=e.split("."));for(var t=null,n=0;n<e.length;n++)if(!(t=0===n?this._index[e[n]]:t._index[e[n]]))return null;return t},c.prototype._updatePath=function(e){for(var t,n=0;n<this._hovered.length;n++)(t=this._hovered[n])&&(t.class.remove("hover"),t.innerElement.style.top="",t.innerElement.style.left="",t.innerElement.style.right="");this._hovered=[];for(var i,n=0;n<e.length;n++){(t=this.findByPath(e.slice(0,n+1)))&&(this._hovered.push(t),t.class.add("hover"),t.innerElement.style.top="",t.innerElement.style.left="",t.innerElement.style.right="",(i=t.innerElement.getBoundingClientRect()).bottom>window.innerHeight&&(t.innerElement.style.top=-(i.bottom-window.innerHeight)+"px"),i.right>window.innerWidth&&(t.innerElement.style.left="auto",t.innerElement.style.right=t.parent.element.clientWidth+"px"))}},c.prototype.position=function(e,t){this.element.style.display="block",this.innerElement.style.width="158px";var n=this.innerElement.getBoundingClientRect(),i=e||0,o=t||0;o+n.height>window.innerHeight?o=window.innerHeight-n.height:o<0&&(o=0),i+n.width>window.innerWidth?i=window.innerWidth-n.width:i<0&&(i=0),this.innerElement.style.left=i+"px",this.innerElement.style.top=o+"px",this.element.style.display=""},c.prototype.createItem=function(e,t){var n=new s.MenuItem({text:t.title||e,className:t.className||null,value:e,icon:t.icon,hasChildren:!!(t.items&&0<Object.keys(t.items).length),clickableSubmenus:this._clickableSubmenus});return t.select&&n.on("select",t.select),t.filter&&this.on("open",function(){n.enabled=t.filter()}),t.hide&&this.on("open",function(){n.hidden=t.hide()}),n},c.fromData=function(e,t){var o=new c(t),r=function(e,t){for(var n in e){var i=o.createItem(n,e[n]);t.append(i),e[n].items&&r(e[n].items,i)}};return r(e,o),o},c);function c(e){var t=r.call(this)||this;return t._clickableSubmenus=!1,t._hovered=[],t._index={},e=e||{},t.element=document.createElement("div"),t.element.tabIndex=1,t.element.classList.add("ui-menu"),t.element.addEventListener("keydown",t._onKeyDown.bind(t),!1),t.elementOverlay=document.createElement("div"),(t.elementOverlay.ui=t).elementOverlay.classList.add("overlay"),t.elementOverlay.addEventListener("click",t._onClick.bind(t),!1),t.elementOverlay.addEventListener("contextmenu",t._onContextMenu.bind(t),!1),t.element.appendChild(t.elementOverlay),t.innerElement=document.createElement("div"),t.innerElement.classList.add("inner"),t.element.appendChild(t.innerElement),t._clickableSubmenus=e.clickableSubmenus,t.on("select-propagate",t._onSelectPropagate.bind(t)),t.on("append",t._onAppend.bind(t)),t.on("over",t._onOver.bind(t)),t.on("open",t._onOpen.bind(t)),t}n.Menu=l},{"./container-element":157,"./menu-item":167}],169:[function(e,t,n){"use strict";var i,o=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0}),n.NumberField=void 0;var r,a=e("./element"),s=(r=a.Element,o(l,r),Object.defineProperty(l.prototype,"value",{get:function(){return this._link?this._link.get(this.path):""!==this.elementInput.value?parseFloat(this.elementInput.value):-1},set:function(e){var t;this._link?this._link.set(this.path,e)||(this.elementInput.value=this._link.get(this.path)):(null!==e&&(null!==this.max&&this.max<e&&(e=this.max),null!==this.min&&this.min>e&&(e=this.min)),void 0===(e=null!=e&&null!==this.precision?parseFloat(e.toFixed(this.precision)):e)&&(e=-1),t=this._lastValue!==e,this._lastValue=e,this.elementInput.value=e.toString(),t&&this.emit("change",e))},enumerable:!1,configurable:!0}),Object.defineProperty(l.prototype,"placeholder",{get:function(){return this.element.getAttribute("placeholder")||""},set:function(e){e?this.element.setAttribute("placeholder",e):this.element.removeAttribute("placeholder")},enumerable:!1,configurable:!0}),Object.defineProperty(l.prototype,"proxy",{get:function(){return this.element.getAttribute("proxy")||""},set:function(e){e?this.element.setAttribute("proxy",e):this.element.removeAttribute("proxy")},enumerable:!1,configurable:!0}),l.prototype._onLinkChange=function(e){this.elementInput.value=e||"0",this.emit("change",e||"0")},l.prototype._onChange=function(){var e=parseFloat(this.elementInput.value);isNaN(e)?this.allowNull?this.value=-1:(this.elementInput.value="0",this.value=0):this.value=e},l.prototype.focus=function(e){this.elementInput.focus(),e&&this.elementInput.select()},l.prototype._onInputFocus=function(){this.class.add("focus")},l.prototype._onInputBlur=function(){this.class.remove("focus")},l.prototype._onKeyDown=function(e){if(27===e.keyCode)return this.elementInput.blur();if(this.blurOnEnter&&13===e.keyCode){for(var t=!1,n=this.parent;n;){if(n.element&&n.element.focus){n.element.focus(),t=!0;break}n=n.parent}t||this.elementInput.blur()}else{var i,o;this.disabled||-1===[38,40].indexOf(e.keyCode)||(i=40===e.keyCode?-1:1,e.shiftKey&&(i*=10),o=this.value+(this.step||1)*i,null!=this.max&&(o=Math.min(this.max,o)),null!=this.min&&(o=Math.max(this.min,o)),null!=this.precision&&(o=parseFloat(o.toFixed(this.precision))),this.value=o)}},l.prototype._onFullSelect=function(){this.elementInput.select()},l.prototype._onDisable=function(){this.elementInput.readOnly=!0},l.prototype._onEnable=function(){this.elementInput.readOnly=!1},l.prototype._onChangeField=function(){this.renderChanges&&this.flash()},l);function l(e){var t=r.call(this)||this;return t._lastValue=-1,e=e||{},t.precision=void 0!==e.precision?e.precision:null,t.step=null!=e.step?e.step:null!=e.precision?1/Math.pow(10,e.precision):1,t.max=void 0!==e.max?e.max:null,t.min=void 0!==e.min?e.min:null,t.allowNull=!!e.allowNull,t.element=document.createElement("div"),t.element.classList.add("ui-number-field"),t.elementInput=document.createElement("input"),(t.elementInput.ui=t).elementInput.tabIndex=0,t.elementInput.classList.add("field"),t.elementInput.type="text",t.elementInput.addEventListener("focus",t._onInputFocus.bind(t),!1),t.elementInput.addEventListener("blur",t._onInputBlur.bind(t),!1),t.elementInput.addEventListener("keydown",t._onKeyDown.bind(t),!1),t.elementInput.addEventListener("dblclick",t._onFullSelect.bind(t),!1),t.elementInput.addEventListener("contextmenu",t._onFullSelect.bind(t),!1),t.element.appendChild(t.elementInput),void 0!==e.default&&(t.value=e.default),t.elementInput.addEventListener("change",t._onChange.bind(t),!1),t.blurOnEnter=!0,t.refocusable=!0,t._lastValue=t.value,t._dragging=!1,t._dragDiff=0,t._dragStart=0,t.on("disable",t._onDisable),t.on("enable",t._onEnable),t.on("change",t._onChangeField),e.placeholder&&(t.placeholder=e.placeholder),t}n.NumberField=s},{"./element":158}],170:[function(e,t,n){"use strict";var i,o=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0}),n.Overlay=void 0;var r,a=e("./container-element"),s=(r=a.ContainerElement,o(l,r),Object.defineProperty(l.prototype,"clickable",{get:function(){return this.elementOverlay.classList.contains("clickable")},set:function(e){e?this.elementOverlay.classList.add("clickable"):this.elementOverlay.classList.remove("clickable")},enumerable:!1,configurable:!0}),Object.defineProperty(l.prototype,"rect",{get:function(){return this.innerElement.getBoundingClientRect()},enumerable:!1,configurable:!0}),Object.defineProperty(l.prototype,"center",{get:function(){return this.element.classList.contains("center")},set:function(e){e?(this.element.classList.add("center"),this.innerElement.style.left="",this.innerElement.style.top=""):this.element.classList.remove("center")},enumerable:!1,configurable:!0}),Object.defineProperty(l.prototype,"transparent",{get:function(){return this.element.classList.contains("transparent")},set:function(e){e?this.element.classList.add("transparent"):this.element.classList.remove("transparent")},enumerable:!1,configurable:!0}),l.prototype._onMouseDown=function(e){var t;this.clickable&&(t=this,document.body.blur(),requestAnimationFrame(function(){t.hidden=!0}),e.preventDefault())},l.prototype.position=function(e,t){var n=this.elementOverlay.getBoundingClientRect(),i=this.innerElement.getBoundingClientRect();e=Math.max(0,Math.min(n.width-i.width,e)),t=Math.max(0,Math.min(n.height-i.height,t)),this.innerElement.style.left=e+"px",this.innerElement.style.top=t+"px"},l);function l(){var e=r.call(this)||this;return e.element=document.createElement("div"),e.element.classList.add("ui-overlay","center"),e.elementOverlay=document.createElement("div"),(e.elementOverlay.ui=e).elementOverlay.classList.add("overlay","clickable"),e.element.appendChild(e.elementOverlay),e.elementOverlay.addEventListener("mousedown",e._onMouseDown.bind(e),!1),e.innerElement=document.createElement("div"),e.innerElement.classList.add("content"),e.element.appendChild(e.innerElement),e}n.Overlay=s},{"./container-element":157}],171:[function(e,t,n){"use strict";var i,o=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0}),n.Panel=void 0;var r,a=e("./container-element"),s=(r=a.ContainerElement,o(l,r),Object.defineProperty(l.prototype,"folded",{get:function(){return!!this.class&&(this.class.contains("foldable")&&this.class.contains("folded"))},set:function(e){this.hidden||this.class.contains("folded")!==!!e&&(this.headerElement&&0===this.headerSize&&(this.headerSize=this.headerElement.clientHeight),e?(this.class.add("folded"),this.class.contains("foldable")&&this.emit("fold")):(this.class.remove("folded"),this.class.contains("foldable")&&this.emit("unfold")),this._reflow())},enumerable:!1,configurable:!0}),Object.defineProperty(l.prototype,"horizontal",{get:function(){return!!this.class&&this.class.contains("horizontal")},set:function(e){e?this.class.add("horizontal"):this.class.remove("horizontal"),this._reflow()},enumerable:!1,configurable:!0}),Object.defineProperty(l.prototype,"resizable",{get:function(){return this._handle},set:function(e){var t;this._handle!==e&&(t=this._handle,this._handle=e,""!==this._handle?(this._handleElement||(this._handleElement=document.createElement("div"),(this._handleElement.ui=this)._handleElement.classList.add("handle"),this._handleElement.addEventListener("mousedown",this._resizeStart.bind(this),!1),this._handleElement.addEventListener("touchstart",this._resizeStart.bind(this),!1)),this._handleElement.parentNode&&this.element.removeChild(this._handleElement),this.element.appendChild(this._handleElement),this.class.add("resizable","resizable-"+this._handle)):(this._handleElement&&this.element.removeChild(this._handleElement),this.class.remove("resizable","resizable-"+t)),this._reflow())},enumerable:!1,configurable:!0}),Object.defineProperty(l.prototype,"resizeMin",{get:function(){return this._resizeLimits.min},set:function(e){this._resizeLimits.min=Math.max(0,Math.min(this._resizeLimits.max,e))},enumerable:!1,configurable:!0}),Object.defineProperty(l.prototype,"resizeMax",{get:function(){return this._resizeLimits.max},set:function(e){this._resizeLimits.max=Math.max(this._resizeLimits.min,e)},enumerable:!1,configurable:!0}),Object.defineProperty(l.prototype,"foldable",{get:function(){return!!this.class&&this.class.contains("foldable")},set:function(e){e?(this.class.add("foldable"),this.class.contains("folded")&&this.emit("fold")):(this.class.remove("foldable"),this.class.contains("folded")&&this.emit("unfold")),this._reflow()},enumerable:!1,configurable:!0}),Object.defineProperty(l.prototype,"header",{get:function(){return this.headerElementTitle&&this.headerElementTitle.textContent||""},set:function(e){var t,n;!this.headerElement&&e?(this.headerElement=document.createElement("header"),this.headerElement.classList.add("ui-header"),this.headerElementTitle=document.createElement("span"),this.headerElementTitle.classList.add("title"),this.headerElementTitle.textContent=e,this.headerElement.appendChild(this.headerElementTitle),(t=this.element.firstChild)?this.element.insertBefore(this.headerElement,t):this.element.appendChild(this.headerElement),this.class.remove("noHeader"),(n=this).headerElement.addEventListener("click",function(e){!n.foldable||e.target!==n.headerElement&&e.target!==n.headerElementTitle||(n.folded=!n.folded)},!1)):this.headerElement&&!e?(this.headerElement.parentNode&&this.headerElement.parentNode.removeChild(this.headerElement),this.headerElement=null,this.headerElementTitle=null,this.class.add("noHeader")):(this.headerElementTitle.textContent=e||"",this.class.remove("noHeader"))},enumerable:!1,configurable:!0}),l.prototype._resizeMove=function(e,t){var n,i,o,r;0===this._resizeData.end?this._resizeData={x:e,y:t,width:this.innerElement.clientWidth,height:this.innerElement.clientHeight,end:1}:"left"===this._handle||"right"===this._handle?(n=this._resizeData.x-e,"right"===this._handle&&(n=-n),i=Math.max(this._resizeLimits.min,Math.min(this._resizeLimits.max,this._resizeData.width+n)),this.style.width=i+4+"px",this.innerElement.style.width=i+4+"px"):(o=this._resizeData.y-t,"bottom"===this._handle&&(o=-o),r=Math.max(this._resizeLimits.min,Math.min(this._resizeLimits.max,this._resizeData.height+o)),this.style.height=r+(-1===this.headerSize?0:this.headerSize||32)+"px",this.innerElement.style.height=r+"px"),this.emit("resize")},l.prototype._resizeEnd=function(){window.removeEventListener("mousemove",this._resizeEvtMove,!1),window.removeEventListener("mouseup",this._resizeEvtEnd,!1),this.class.remove("noAnimation","resizing"),this._resizeData.end=0},l.prototype._resizeStart=function(e){if(""!==this._handle){if(e.changedTouches)for(var t=0;t<e.changedTouches.length;t++){var n=e.changedTouches[t];n.target===this.element&&(this._resizeTouchId=n.identifier)}this.class.add("noAnimation","resizing"),this._resizeData.end=0,window.addEventListener("mousemove",this._resizeEvtMove,!1),window.addEventListener("mouseup",this._resizeEvtEnd,!1),window.addEventListener("touchmove",this._resizeEvtTouchMove,!1),window.addEventListener("touchend",this._resizeEvtTouchEnd,!1),e.preventDefault(),e.stopPropagation()}},l.prototype._onParent=function(){requestAnimationFrame(this._reflow.bind(this))},l.prototype._reflow=function(){this.hidden||(this.folded?this.horizontal?(this.style.height="",this.style.width=(this.headerSize||32)+"px"):this.style.height=(this.headerSize||32)+"px":this.foldable&&(this.horizontal?(this.style.height="",this.style.width=this.innerElement.clientWidth+"px"):this.style.height=(this.headerSize||32)+this.innerElement.clientHeight+"px"))},l.prototype._onNodesChanged=function(){!this.foldable||this.folded||this.horizontal||this.hidden||(this.style.height=Math.max(0,this.headerSize||32)+this.innerElement.clientHeight+"px")},l.prototype.headerAppend=function(e){var t,n;this.headerElement&&(n=(t=e instanceof HTMLElement)?e:e.element,this.headerElement.insertBefore(n,this.headerElementTitle),t||(e.parent=this))},l.prototype._onScroll=function(e){this.emit("scroll",e)},l);function l(e){var t=r.call(this)||this;t.headerElement=null,t.headerElementTitle=null,t._handleElement=null,t._resizeData={end:0},t._resizeLimits={min:0,max:1/0},t._handle="",t.headerSize=0,t._resizeTouchId=-100,t.title="",t._lable=null;var i=t;return t.element=document.createElement("div"),t.element.classList.add("ui-panel","noHeader","noAnimation"),t.innerElement=document.createElement("div"),(t.innerElement.ui=t).innerElement.classList.add("content"),t.element.appendChild(t.innerElement),e&&(t.title=e,t.header=e),t._resizeEvtMove=function(e){e.preventDefault(),e.stopPropagation(),i._resizeMove(e.clientX,e.clientY)},t._resizeEvtEnd=function(e){e.preventDefault(),e.stopPropagation(),i._resizeEnd()},t._resizeEvtTouchMove=function(e){for(var t=0;t<e.changedTouches.length;t++){var n=e.changedTouches[t];if(n.identifier===i._resizeTouchId)return e.preventDefault(),e.stopPropagation(),void i._resizeMove(n.clientX,n.clientY)}},t._resizeEvtTouchEnd=function(e){for(var t=0;t<e.changedTouches.length;t++){if(e.changedTouches[t].identifier===i._resizeTouchId)return i._resizeTouchId=-100,e.preventDefault(),e.stopPropagation(),void i._resizeEnd()}},requestAnimationFrame(function(){requestAnimationFrame(function(){i.class.remove("noAnimation")})}),t.on("parent",t._onParent),t}n.Panel=s},{"./container-element":157}],172:[function(e,t,n){"use strict";var i,o=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0}),n.Progress=void 0;var r,a=e("./element"),s=(r=a.Element,o(l,r),Object.defineProperty(l.prototype,"progress",{get:function(){return this._progress},set:function(e){var t,n=this;e=Math.max(0,Math.min(1,e)),this._targetProgress!==e&&(this._targetProgress=e,0===this._speed||1===this._speed?(this._progress=this._targetProgress,this._inner.style.width=100*this._progress+"%",(t=Math.max(0,Math.min(100,Math.round(100*this._progress))))!==this._lastProgress&&(this._lastProgress=t,this.emit("progress:"+t),this.emit("progress",t))):this._animating||requestAnimationFrame(function(){n._animate()}))},enumerable:!1,configurable:!0}),Object.defineProperty(l.prototype,"speed",{get:function(){return this._speed},set:function(e){this._speed=Math.max(0,Math.min(1,e))},enumerable:!1,configurable:!0}),Object.defineProperty(l.prototype,"failed",{get:function(){return this._failed},set:function(e){this._failed=e,this._failed?this.class.add("failed"):this.class.remove("failed")},enumerable:!1,configurable:!0}),l.prototype._animate=function(){var e,t=this;Math.abs(this._targetProgress-this._progress)<.01?(this._progress=this._targetProgress,this._animating=!1):(this._animating||(this._now=Date.now()-1e3/60,this._animating=!0),requestAnimationFrame(function(){t._animate()}),e=Math.max(.1,Math.min(3,(Date.now()-this._now)/(1e3/60))),this._now=Date.now(),this._progress=this._progress+(this._targetProgress-this._progress)*(this._speed*e));var n=Math.max(0,Math.min(100,Math.round(100*this._progress)));n!==this._lastProgress&&(this._lastProgress=n,this.emit("progress:"+n),this.emit("progress",n)),this._inner.style.width=100*this._progress+"%"},l);function l(e,t){var n=r.call(this)||this;return n._progress=e?Math.max(0,Math.min(1,e)):0,n._targetProgress=n._progress,n._lastProgress=Math.floor(100*n._progress),n.element=document.createElement("div"),n.element.classList.add("ui-progress"),n._inner=document.createElement("div"),n._inner.classList.add("inner"),n._inner.style.width=100*n._progress+"%",n.element.appendChild(n._inner),n._speed=t||1,n._now=Date.now(),n._animating=!1,n._failed=!1,n}n.Progress=s},{"./element":158}],173:[function(e,t,n){"use strict";var i,o=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0}),n.SelectField=void 0;var r,a=e("./element"),s=(r=a.Element,o(l,r),Object.defineProperty(l.prototype,"value",{get:function(){return this._link?this._link.get(this.path):this._value},set:function(e){var t=this.valueToType(e);if(this._link)this._oldValue=this._value,this.emit("change:before",t),this._link.set(this.path,t);else{if(null!=t&&""!==e||!this.optionElements[""]||(t=""),this._oldValue===t)return;if(null!==t&&void 0===this.options[t])return;this.optionElements[this._oldValue]&&this.optionElements[this._oldValue].classList.remove("selected"),""!==(this._value=t)&&(this._value=this.valueToType(this._value)),this.emit("change:before",this._value),this._oldValue=this._value,this.options[this._value]?(this.elementValue.textContent=this.options[this._value],this.optionElements[this._value].classList.add("selected")):this.elementValue.textContent="",this.emit("change",this._value)}},enumerable:!1,configurable:!0}),Object.defineProperty(l.prototype,"placeholder",{get:function(){return this.elementValue.getAttribute("placeholder")||""},set:function(e){e?this.elementValue.setAttribute("placeholder",e):this.elementValue.removeAttribute("placeholder")},enumerable:!1,configurable:!0}),l.prototype._onHoldSelect=function(e,t,n,i){e&&e.uiElement&&e.uiElement===this&&e.classList.contains("selected")||Math.abs(t-this.evtMouseDist[0])+Math.abs(n-this.evtMouseDist[1])<8||(e&&e.uiElement&&e.uiElement===this&&void 0!==i&&this._onOptionSelect(i),this.close(e.textContent))},l.prototype._onMouseDown=function(e){this.disabled&&!this.disabledClick||(this.element.classList.contains("active")?this.close():(e.preventDefault(),e.stopPropagation(),this.evtMouseDist[0]=e.pageX,this.evtMouseDist[1]=e.pageY,this.element.focus(),this.open(),window.addEventListener("mouseup",this.evtMouseUp.bind(this))))},l.prototype._onTouchStart=function(e){if(!this.disabled||this.disabledClick)if(this.element.classList.contains("active"))this.close();else{var t;e.preventDefault(),e.stopPropagation();for(var n=0;n<e.changedTouches.length;n++)if(e.changedTouches[n].target.uiElement===this){t=e.changedTouches[n];break}if(!t)return;this.evtTouchId=t.identifier,this.evtMouseDist[0]=t.pageX,this.evtMouseDist[1]=t.pageY,this.element.focus(),this.open(),window.addEventListener("touchend",this.evtTouchEnd.bind(this))}},l.prototype._onLink=function(e){var t;this._link.schema&&this._link.schema.has(e)&&(t=this._link.schema.get(e).options||{},this._updateOptions(t))},l.prototype._onChange=function(){this.renderChanges&&this.flash()},l.prototype._onKeyDown=function(e){if(27===e.keyCode)return this.close(),void e.target.blur();var t,n,i;this.disabled&&!this.disabledClick||-1===[38,40].indexOf(e.keyCode)||(e.stopPropagation(),e.preventDefault(),n=(t=Object.keys(this.options)).indexOf(void 0!==this.value?this.value.toString():null),-1==(i=38===e.keyCode?-1:1)&&n<=0||1==i&&n===t.length-1||(this.value=t[n+i]))},l.prototype.valueToType=function(e){switch(this._type){case"boolean":return!!e;case"number":return parseInt(e,10);case"string":return""+e}},l.prototype.evtMouseUp=function(e){e.preventDefault(),e.stopPropagation(),this._onHoldSelect(e.target,e.pageX,e.pageY,e)},l.prototype.evtTouchEnd=function(e){for(var t=0;t<e.changedTouches.length;t++){var n,i=e.changedTouches[t];i.identifier===this.evtTouchId&&(this.evtTouchId=-9,e.preventDefault(),e.stopPropagation(),n=document.elementFromPoint(i.pageX,i.pageY),this._onHoldSelect(n,i.pageX,i.pageY,e))}this.evtTouchSecond?(e.preventDefault(),e.stopPropagation(),self.close()):this.element.classList.contains("active")&&(this.evtTouchSecond=!0)},l.prototype.open=function(){var e,t,n,i,o;this.disabled&&!this.disabledClick||this.element.classList.contains("active")||(this.element.classList.add("active"),e=this.element.getBoundingClientRect(),t=Math.round(e.left)+(Math.round(e.width)-this.element.clientWidth)/2,n=e.top,this.optionElements[this._value]&&(n-=this.optionElements[this._value].offsetTop,n+=(Math.round(e.height)-this.optionElements[this._value].clientHeight)/2,n=e.top+e.height+3),n+this.elementOptions.clientHeight>window.innerHeight?n=window.innerHeight-this.elementOptions.clientHeight+1:n<0&&(n=0),this.elementOptions.style.top=Math.max(0,n)+"px",this.elementOptions.style.left=t+"px",this.elementOptions.style.width=Math.round(this.element.clientWidth)+"px",n<=0&&this.elementOptions.offsetHeight>=window.innerHeight?(this.elementOptions.style.bottom="0",this.elementOptions.style.height="auto",this.optionElements[this._value]&&(i=this.optionElements[this._value].offsetTop-e.top,this.elementOptions.scrollTop=i)):(this.elementOptions.style.bottom="",this.elementOptions.style.height=""),(o=this).timerClickAway=setTimeout(function(){var e=function(){o.element.classList.remove("active"),o.element.blur(),window.removeEventListener("click",e)};window.addEventListener("click",e)},300),this.emit("open"))},l.prototype.close=function(e){void 0===e&&(e=""),this.disabled&&!this.disabledClick||!this.element.classList.contains("active")||(window.removeEventListener("mouseup",this.evtMouseUp.bind(this)),window.removeEventListener("touchend",this.evtTouchEnd.bind(this)),this.timerClickAway&&(clearTimeout(this.timerClickAway),this.timerClickAway=null),this.element.classList.remove("active"),this.elementOptions.style.top="",this.elementOptions.style.right="",this.elementOptions.style.bottom="",this.elementOptions.style.left="",this.elementOptions.style.width="",this.elementOptions.style.height="",this.emit("close",e),this.evtTouchSecond=!1)},l.prototype.toggle=function(){this.element.classList.contains("active")?this.close():this.open()},l.prototype._updateOptions=function(e){if(void 0!==e)if(e instanceof Array){this.options={},this.optionsKeys=[];for(var t=0;t<e.length;t++)this.optionsKeys.push(e[t].v),this.options[e[t].v]=e[t].t}else this.options=e,this.optionsKeys=Object.keys(e);this.optionElements={},this.elementOptions.innerHTML="";for(var n,i,t=0;t<this.optionsKeys.length;t++){this.options.hasOwnProperty(this.optionsKeys[t])&&(n=this.options[this.optionsKeys[t]].split("|"),this.options[this.optionsKeys[t]]=n[0],(i=document.createElement("li")).textContent=n[0],i.uiElement=this,i.uiValue=this.optionsKeys[t],i.addEventListener("touchstart",this._onOptionSelect.bind(this)),i.addEventListener("mouseover",this._onOptionHover.bind(this)),i.addEventListener("mouseout",this._onOptionOut.bind(this)),this._optionClassNamePrefix&&1<n.length&&i.classList.add(this._optionClassNamePrefix+"-"+n[1].toLowerCase()),this.elementOptions.appendChild(i),this.optionElements[this.optionsKeys[t]]=i)}},l.prototype._onOptionSelect=function(e){this.value=e.target.uiValue},l.prototype._onOptionHover=function(){this.element.classList.add("hover")},l.prototype._onOptionOut=function(){this.element.classList.remove("hover")},l.prototype._onLinkChange=function(e){void 0!==this.optionElements[e]&&(this.optionElements[this._oldValue]&&this.optionElements[this._oldValue].classList.remove("selected"),this._value=this.valueToType(e),this.elementValue.textContent=this.options[e],this.optionElements[e].classList.add("selected"),this.emit("change",e))},l);function l(e){var t=r.call(this)||this;if(t.evtMouseDist=[0,0],e=e||{},t.options=e.options||{},t.optionsKeys=[],t.options instanceof Array){for(var n={},i=0;i<t.options.length;i++)t.optionsKeys.push(t.options[i].v),n[t.options[i].v]=t.options[i].t;t.options=n}else t.optionsKeys=Object.keys(t.options);return t.element=document.createElement("div"),t.element.tabIndex=0,t.element.classList.add("ui-select-field","noSelect"),t.elementValue=document.createElement("div"),(t.elementValue.ui=t).elementValue.classList.add("value"),t.element.appendChild(t.elementValue),t._oldValue=null,t._value=null,t._type=e.type||"string",t._optionClassNamePrefix=e.optionClassNamePrefix||"",t.timerClickAway=null,t.evtTouchId=-9,t.evtTouchSecond=!1,t.evtMouseDist=[0,0],t.elementValue.addEventListener("mousedown",t._onMouseDown.bind(t),!1),t.elementValue.addEventListener("touchstart",t._onTouchStart.bind(t),!1),t.elementOptions=document.createElement("ul"),t.element.appendChild(t.elementOptions),t.optionElements={},void 0!==e.default&&void 0!==t.options[e.default]&&(t._value=t.valueToType(e.default),t._oldValue=t._value),t.on("link",t._onLink),t._updateOptions(),t.on("change",t._onChange.bind(t)),t.element.addEventListener("keydown",t._onKeyDown.bind(t),!1),e.placeholder&&(t.placeholder=e.placeholder),t}n.SelectField=s},{"./element":158}],174:[function(e,t,n){"use strict";var i,o=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0}),n.Slider=void 0;var r,a=e("./element"),s=(r=a.Element,o(l,r),Object.defineProperty(l.prototype,"min",{get:function(){return this._min},set:function(e){this._min!==e&&(this._min=e,this._updateHandle(this._value))},enumerable:!1,configurable:!0}),Object.defineProperty(l.prototype,"max",{get:function(){return this._max},set:function(e){this._max!==e&&(this._max=e,this._updateHandle(this._value))},enumerable:!1,configurable:!0}),Object.defineProperty(l.prototype,"value",{get:function(){return this._link?this._link.get(this.path):this._value},set:function(e){this._link?this._link.set(this.path,e)||this._updateHandle(this._link.get(this.path)):(null!==this._max&&this._max<e&&(e=this._max),null!==this._min&&this._min>e&&(e=this._min),null===e?this.class.add("null"):("number"!=typeof e&&(e=0),e=void 0!==e&&null!==this.precision?parseFloat(e.toFixed(this.precision)):e,this.class.remove("null")),this._updateHandle(e),this._value=e,this._lastValue!==e&&(this._lastValue=e,this.emit("change",e)))},enumerable:!1,configurable:!0}),l.prototype._onChange=function(){this.renderChanges&&this.flash()},l.prototype._onKeyDown=function(e){if(27===e.keyCode)return this.elementHandle.blur();var t,n,i,o;this.disabled||-1===[37,39].indexOf(e.keyCode)||(e.stopPropagation(),e.preventDefault(),t=37===e.keyCode?-1:1,e.shiftKey&&(t*=10),n=this.element.getBoundingClientRect(),i=(this._max-this._min)/n.width,o=Math.max(this._min,Math.min(this._max,this.value+t*i)),o=parseFloat(o.toFixed(this.precision)),this.renderChanges=!1,this._updateHandle(o),this.value=o,this.renderChanges=!0)},l.prototype._onLinkChange=function(e){this._updateHandle(e),this._value=e,this.emit("change",e||0)},l.prototype._updateHandle=function(e){this.elementHandle.style.left=100*Math.max(0,Math.min(1,((e||0)-this._min)/(this._max-this._min)))+"%"},l.prototype._onMouseDown=function(e){0!==e.button||this.disabled||this._onSlideStart(e.pageX)},l.prototype._onTouchStart=function(e){if(!this.disabled)for(var t=0;t<e.changedTouches.length;t++){var n=e.changedTouches[t];if(n.target.ui&&n.target.ui===this){this.evtTouchId=n.identifier,this._onSlideStart(n.pageX);break}}},l.prototype._onSlideStart=function(e){this.elementHandle.focus(),this.renderChanges=!1,null===this.evtTouchId?(window.addEventListener("mousemove",this.evtMouseMove,!1),window.addEventListener("mouseup",this.evtMouseUp,!1)):(window.addEventListener("touchmove",this.evtTouchMove,!1),window.addEventListener("touchend",this.evtTouchEnd,!1)),this.class.add("active"),this.emit("start",this.value),this._onSlideMove(e),this._link&&this._link.history&&(this._link.history.combine=!0)},l.prototype._onSlideMove=function(e){var t=this.element.getBoundingClientRect(),n=Math.max(0,Math.min(1,(e-t.left)/t.width))*(this._max-this._min)+this._min,n=parseFloat(n.toFixed(this.precision));this._updateHandle(n),this.value=n},l.prototype._onSlideEnd=function(e){this._onSlideMove(e),this.renderChanges=!0,this.class.remove("active"),null===this.evtTouchId?(window.removeEventListener("mousemove",this.evtMouseMove),window.removeEventListener("mouseup",this.evtMouseUp)):(console.log(this.evtTouchId),window.removeEventListener("touchmove",this.evtTouchMove),window.removeEventListener("touchend",this.evtTouchEnd)),this._link&&this._link.history&&(this._link.history.combine=!1),this.emit("end",this.value)},l);function l(e){var i=r.call(this)||this,t=i;return e=e||{},i._value=0,i._lastValue=0,i.precision=void 0===e.precision?2:e.precision,i._min=void 0===e.min?0:e.min,i._max=void 0===e.max?1:e.max,i.element=document.createElement("div"),i.element.classList.add("ui-slider"),i.elementBar=document.createElement("div"),(i.elementBar.ui=i).elementBar.classList.add("bar"),i.element.appendChild(i.elementBar),i.elementHandle=document.createElement("div"),(i.elementHandle.ui=i).elementHandle.tabIndex=0,i.elementHandle.classList.add("handle"),i.elementBar.appendChild(i.elementHandle),i.element.addEventListener("mousedown",t._onMouseDown.bind(t),!1),i.element.addEventListener("touchstart",t._onTouchStart.bind(t),!1),i.evtTouchId=null,i.on("change",i._onChange),i.element.addEventListener("keydown",t._onKeyDown.bind(t),!1),t.evtMouseMove=function(e){e.stopPropagation(),e.preventDefault(),t._onSlideMove(e.pageX)},t.evtMouseUp=function(e){e.stopPropagation(),e.preventDefault(),i._onSlideEnd(e.pageX)},t.evtTouchMove=function(e){for(var t=0;t<e.changedTouches.length;t++){var n=e.changedTouches[t];if(n.identifier===i.evtTouchId){e.stopPropagation(),e.preventDefault(),i._onSlideMove(n.pageX);break}}},t.evtTouchEnd=function(e){for(var t=0;t<e.changedTouches.length;t++){var n=e.changedTouches[t];if(n.identifier===i.evtTouchId){e.stopPropagation(),e.preventDefault(),i._onSlideEnd(n.pageX),i.evtTouchId=null;break}}},i}n.Slider=s},{"./element":158}],175:[function(e,t,n){"use strict";var i,o=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0}),n.TextField=void 0;var r,a=e("./element"),s=(r=a.Element,o(l,r),Object.defineProperty(l.prototype,"value",{get:function(){return this._link?this._link.get(this.path):this.elementInput.value},set:function(e){if(!this._link){if(this.elementInput.value===e)return;this.elementInput.value=e||"",this.emit("change",e)}},enumerable:!1,configurable:!0}),Object.defineProperty(l.prototype,"placeholder",{get:function(){return this.element.getAttribute("placeholder")||""},set:function(e){e?this.element.setAttribute("placeholder",e):this.element.removeAttribute("placeholder")},enumerable:!1,configurable:!0}),Object.defineProperty(l.prototype,"proxy",{get:function(){return this.element.getAttribute("proxy")||""},set:function(e){e?this.element.setAttribute("proxy",e):this.element.removeAttribute("proxy")},enumerable:!1,configurable:!0}),Object.defineProperty(l.prototype,"keyChange",{get:function(){return this.evtKeyChange},set:function(e){this.evtKeyChange!==!!e&&(e?this.elementInput.addEventListener("keyup",this._onChange.bind(this),!1):this.elementInput.removeEventListener("keyup",this._onChange.bind(this)))},enumerable:!1,configurable:!0}),l.prototype._onLinkChange=function(e){this.elementInput.value=e,this.emit("change",e)},l.prototype._onChange=function(){this.ignoreChange||(this.value=this.value||"",this._link||this.emit("change",this.value))},l.prototype._onClick=function(e){},l.prototype._onKeyDown=function(e){if(27===e.keyCode)e.target.blur();else if(this.blurOnEnter&&13===e.keyCode){for(var t=!1,n=this.parent;n;){if(n.element&&n.element.focus){n.element.focus(),t=!0;break}n=n.parent}t||e.target.blur()}},l.prototype._onFullSelect=function(){this.elementInput.select()},l.prototype.focus=function(e){this.elementInput.focus(),e&&this.elementInput.select()},l.prototype._onInputFocus=function(){this.class.add("focus"),this.emit("input:focus")},l.prototype._onInputBlur=function(){this.class.remove("focus"),this.emit("input:blur")},l.prototype._onDisable=function(){this.elementInput.readOnly=!0},l.prototype._onEnable=function(){this.elementInput.readOnly=!1},l.prototype._onChangeField=function(){this.renderChanges&&this.flash()},l);function l(e,t){var n=r.call(this)||this;return n.element=document.createElement("div"),n.element.classList.add("ui-text-field"),n.elementInput=document.createElement("input"),(n.elementInput.ui=n).elementInput.classList.add("field"),n.elementInput.type="text",n.elementInput.tabIndex=0,n.elementInput.addEventListener("focus",n._onInputFocus.bind(n),!1),n.elementInput.addEventListener("blur",n._onInputBlur.bind(n),!1),n.element.appendChild(n.elementInput),void 0!==t&&(n.value=t),n.elementInput.addEventListener("change",n._onChange.bind(n),!1),n.elementInput.addEventListener("keydown",n._onKeyDown.bind(n),!1),n.elementInput.addEventListener("click",n._onClick.bind(n),!1),n.elementInput.addEventListener("contextmenu",n._onFullSelect.bind(n),!1),n.evtKeyChange=!1,n.ignoreChange=!1,n.blurOnEnter=!0,n.refocusable=!0,n.on("disable",n._onDisable),n.on("enable",n._onEnable),n.on("change",n._onChangeField),e&&(n.placeholder=e),n}n.TextField=s},{"./element":158}],176:[function(e,t,n){"use strict";var i,o=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0}),n.TextAreaField=void 0;var r,a=e("./element"),s=(r=a.Element,o(l,r),Object.defineProperty(l.prototype,"value",{get:function(){return this._link?this._link.get(this.path):this.elementInput.value},set:function(e){if(this._link)this._link.set(this.path,e),this.elementInput.value=this._link.get(this.path);else{if(this.elementInput.value===e)return;this.elementInput.value=e||"",this.emit("change",e)}},enumerable:!1,configurable:!0}),Object.defineProperty(l.prototype,"placeholder",{get:function(){return this.element.getAttribute("placeholder")||""},set:function(e){e?this.element.setAttribute("placeholder",e):this.element.removeAttribute("placeholder")},enumerable:!1,configurable:!0}),Object.defineProperty(l.prototype,"keyChange",{get:function(){return this.evtKeyChange},set:function(e){this.evtKeyChange!==!!e&&(e?this.elementInput.addEventListener("keyup",this._onChange.bind(this),!1):this.elementInput.removeEventListener("keyup",this._onChange.bind(this)))},enumerable:!1,configurable:!0}),Object.defineProperty(l.prototype,"proxy",{get:function(){return this.element.getAttribute("proxy")||""},set:function(e){e?this.element.setAttribute("proxy",e):this.element.removeAttribute("proxy")},enumerable:!1,configurable:!0}),l.prototype._onChange=function(){this.ignoreChange||(this.value=this.value||"",this._link||this.emit("change",this.value))},l.prototype._onKeyDown=function(e){if(27===e.keyCode)e.target.blur();else if(this.blurOnEnter&&13===e.keyCode&&!e.shiftKey){for(var t=!1,n=this.parent;n;){if(n.element&&n.element.focus){n.element.focus(),t=!0;break}n=n.parent}t||e.target.blur()}},l.prototype._onFullSelect=function(){this.elementInput.select()},l.prototype._onInputFocus=function(){this.class.add("focus"),this.emit("input:focus")},l.prototype._onInputBlur=function(){this.class.remove("focus"),this.emit("input:blur")},l.prototype._onDisable=function(){this.elementInput.readOnly=!0},l.prototype._onEnable=function(){this.elementInput.readOnly=!1},l.prototype._onChangeField=function(){this.renderChanges&&this.flash()},l.prototype.focus=function(e){this.elementInput.focus(),e&&this.elementInput.select()},l.prototype._onLinkChange=function(e){this.elementInput.value=e,this.emit("change",e)},l);function l(e,t,n){var i=r.call(this)||this;return i.element=document.createElement("div"),i.element.classList.add("ui-textarea-field"),i.elementInput=document.createElement("textarea"),(i.elementInput.ui=i).elementInput.classList.add("field"),i.elementInput.tabIndex=0,i.elementInput.addEventListener("focus",i._onInputFocus.bind(i),!1),i.elementInput.addEventListener("blur",i._onInputBlur.bind(i),!1),i.element.appendChild(i.elementInput),void 0!==t&&(i.value=t),i.elementInput.addEventListener("change",i._onChange.bind(i),!1),i.elementInput.addEventListener("keydown",i._onKeyDown.bind(i),!1),i.elementInput.addEventListener("contextmenu",i._onFullSelect.bind(i),!1),i.evtKeyChange=!1,i.ignoreChange=!1,i.blurOnEnter=void 0===n||n,i.refocusable=!0,i.on("disable",i._onDisable),i.on("enable",i._onEnable),i.on("change",i._onChangeField),e&&(i.placeholder=e),i}n.TextAreaField=s},{"./element":158}],177:[function(e,t,n){"use strict";var i,o=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0}),n.Tooltip=void 0;var r,a=e("./container-element"),s=(r=a.ContainerElement,o(l,r),Object.defineProperty(l.prototype,"align",{get:function(){return this._align},set:function(e){this._align!==e&&(this.class.remove("align-"+this._align),this._align=e,this.class.add("align-"+this._align),this._reflow())},enumerable:!1,configurable:!0}),Object.defineProperty(l.prototype,"html",{get:function(){return this.innerElement.innerHTML},set:function(e){this.innerElement.innerHTML!==e&&(this.innerElement.innerHTML=e)},enumerable:!1,configurable:!0}),Object.defineProperty(l.prototype,"text",{get:function(){return this.innerElement.textContent||""},set:function(e){this.innerElement.textContent!==e&&(this.innerElement.textContent=e)},enumerable:!1,configurable:!0}),Object.defineProperty(l.prototype,"flip",{get:function(){return this.class.contains("flip")},set:function(e){this.class.contains("flip")!==e&&(e?this.class.add("flip"):this.class.remove("flip"),this._reflow())},enumerable:!1,configurable:!0}),l.prototype._onMouseOver=function(e){this.hoverable&&(this.hidden=!1,this.emit("hover",e))},l.prototype._onMouseLeave=function(){this.hoverable&&(this.hidden=!0)},l.prototype.position=function(e,t){e=Math.floor(e),t=Math.floor(t),this.x===e&&this.y===t||(this.x=e,this.y=t,this._reflow())},l.prototype._reflow=function(){if(!this.hidden){switch(this.element.style.top="",this.element.style.right="",this.element.style.bottom="",this.element.style.left="",this.arrow.style.top="",this.arrow.style.right="",this.arrow.style.bottom="",this.arrow.style.left="",this.element.style.display="block",this._align){case"top":this.element.style.top=this.y+"px",this.flip?this.element.style.right="calc(100% - "+this.x+"px)":this.element.style.left=this.x+"px";break;case"right":this.element.style.top=this.y+"px",this.element.style.right="calc(100% - "+this.x+"px)";break;case"bottom":this.element.style.bottom="calc(100% - "+this.y+"px)",this.flip?this.element.style.right="calc(100% - "+this.x+"px)":this.element.style.left=this.x+"px";break;case"left":this.element.style.top=this.y+"px",this.element.style.left=this.x+"px"}var e=this.element.getBoundingClientRect();e.left<0&&(this.element.style.left="0px",this.element.style.right=""),e.top<0&&(this.element.style.top="0px",this.element.style.bottom=""),e.right>window.innerWidth&&(this.element.style.right="0px",this.element.style.left="",this.arrow.style.left=Math.floor(e.right-window.innerWidth+8)+"px"),e.bottom>window.innerHeight&&(this.element.style.bottom="0px",this.element.style.top="",this.arrow.style.top=Math.floor(e.bottom-window.innerHeight+8)+"px"),this.element.style.display=""}},l.prototype.evtHover=function(){},l.prototype.evtBlur=function(){},l.attach=function(n){var e={align:n.align,hoverable:n.hoverable};n.html?e.html=n.html:e.text=n.text||"";var i=new l(e);return i.evtHover=function(){var e=n.target.getBoundingClientRect(),t=16;switch(i.align){case"top":e.width<64&&(t=e.width/2),i.flip=e.left+t>window.innerWidth/2,i.flip?i.position(e.right-t,e.bottom):i.position(e.left+t,e.bottom);break;case"right":e.height<64&&(t=e.height/2),i.flip=!1,i.position(e.left,e.top+t);break;case"bottom":e.width<64&&(t=e.width/2),i.flip=e.left+t>window.innerWidth/2,i.flip?i.position(e.right-t,e.top):i.position(e.left+t,e.top);break;case"left":e.height<64&&(t=e.height/2),i.flip=!1,i.position(e.right,e.top+t)}i.hidden=!1},i.evtBlur=function(){i.hidden=!0},n.target.addEventListener("mouseover",i.evtHover,!1),n.target.addEventListener("mouseout",i.evtBlur,!1),i.on("destroy",function(){n.target.removeEventListener("mouseover",i.evtHover),n.target.removeEventListener("mouseout",i.evtBlur)}),n.root.append(i),i},l.prototype.attachReference=function(e){},l);function l(e){var t=r.call(this)||this;e=e||{};return t.element=document.createElement("div"),t.element.classList.add("ui-tooltip","align-left"),t.innerElement=document.createElement("div"),t.innerElement.classList.add("inner"),t.element.appendChild(t.innerElement),t.arrow=document.createElement("div"),t.arrow.classList.add("arrow"),t.element.appendChild(t.arrow),t.hoverable=e.hoverable||!1,t.x=e.x||0,t.y=e.y||0,t._align="left",t.align=e.align||"left",t.on("show",t._reflow),t.hidden=void 0===e.hidden||e.hidden,e.html?t.html=e.html:t.text=e.text||"",t.element.addEventListener("mouseover",t._onMouseOver.bind(t),!1),t.element.addEventListener("mouseleave",t._onMouseLeave.bind(t),!1),t}n.Tooltip=s},{"./container-element":157}],178:[function(e,t,n){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,n,i){void 0===i&&(i=n),Object.defineProperty(e,i,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,i){void 0===i&&(i=n),e[i]=t[n]}),o=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||t.hasOwnProperty(n)||i(t,e,n)};Object.defineProperty(n,"__esModule",{value:!0}),o(e("./top-element"),n),o(e("./top-element-container"),n),o(e("./top-element-panel"),n)},{"./top-element":181,"./top-element-container":179,"./top-element-panel":180}],179:[function(e,t,n){"use strict";var i,o=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0}),n.TopElementContainer=void 0;var r,a=e("./top-element"),s=e("../element"),l=(r=a.TopElement,o(c,r),Object.defineProperty(c.prototype,"flex",{get:function(){return this._flex},set:function(e){e!==this._flex&&((this._flex=e)?this.class.add("pcui-flex"):this.class.remove("pcui-flex"))},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"grid",{get:function(){return this._grid},set:function(e){e!==this._grid&&((this._grid=e)?this.class.add("pcui-grid"):this.class.remove("pcui-grid"))},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"scrollable",{get:function(){return this._scrollable},set:function(e){e!==this._scrollable&&((this._scrollable=e)?this.class.add("pcui-scrollable"):this.class.remove("pcui-scrollable"))},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"resizable",{get:function(){return this._resizable},set:function(e){e!==this._resizable&&(-1!==this.VALID_RESIZABLE_VALUES.indexOf(e)?(this._resizable&&this.class.remove("pcui-resizable-"+this._resizable),this._resizable=e,this._resizeHorizontally="right"===e||"left"===e,e?(this.class.add("pcui-resizable"),this.class.add("pcui-resizable-"+e),this._domResizeHandle||this._createResizeHandle(),this.dom.appendChild(this._domResizeHandle)):(this.class.remove("pcui-resizable"),this._domResizeHandle&&this.dom.removeChild(this._domResizeHandle))):console.error("Invalid resizable value: must be one of "+this.VALID_RESIZABLE_VALUES.join(",")))},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"resizeMin",{get:function(){return this._resizeMin},set:function(e){this._resizeMin=Math.max(0,Math.min(e,this._resizeMax))},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"resizeMax",{get:function(){return this._resizeMax},set:function(e){this._resizeMax=Math.max(this._resizeMin,e)},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"domContent",{get:function(){return this._domContent},set:function(e){this._domContent!==e&&(this._domContent&&this._domContent.removeEventListener("scroll",this._domEventScroll),this._domContent=e,this._domContent&&this._domContent.addEventListener("scroll",this._domEventScroll))},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"innerElement",{get:function(){return this.domContent},set:function(e){this.domContent=e},enumerable:!1,configurable:!0}),c.prototype.append=function(e){var t=this._getDomFromElement(e);this._domContent.appendChild(t),this._onAppendChild(e)},c.prototype.appendBefore=function(e,t){var n=this._getDomFromElement(e);this._domContent.appendChild(n);var i=t&&this._getDomFromElement(t);i?this._domContent.insertBefore(n,i):this._domContent.appendChild(n),this._onAppendChild(e)},c.prototype.appendAfter=function(e,t){var n=this._getDomFromElement(e),i=t&&this._getDomFromElement(t),o=i?i.nextSibling:null;o?this._domContent.insertBefore(n,o):this._domContent.appendChild(n),this._onAppendChild(e)},c.prototype.prepend=function(e){var t=this._getDomFromElement(e),n=this._domContent.firstChild;n?this._domContent.insertBefore(t,n):this._domContent.appendChild(t),this._onAppendChild(e)},c.prototype.remove=function(e){var t,n=e instanceof HTMLElement;!n&&e.parent!==this||(t=this._getDomFromElement(e),this._domContent.removeChild(t),n||(e.parent=null),this.emit("remove",e))},c.prototype.clear=function(){if(this._domContent){for(var e=this._domContent.childNodes.length;e--;){var t=this._domContent.childNodes[e];t.ui&&t.ui.destroy()}this._domContent.innerHTML=""}},c.prototype._getDomFromElement=function(e){return e instanceof HTMLElement?e:e instanceof a.TopElement?e.dom:e.element},c.prototype._onAppendChild=function(e){(e instanceof a.TopElement||e instanceof s.Element)&&(e.parent=this),this.emit("append",e)},c.prototype._onScroll=function(e){this.emit("scroll",e)},c.prototype._createResizeHandle=function(){var e=document.createElement("div");e.classList.add("pcui-resizable-handle"),e.ui=this,e.addEventListener("mousedown",this._domEventResizeStart),e.addEventListener("touchstart",this._domEventResizeTouchStart),this._domResizeHandle=e},c.prototype._onResizeStart=function(e){e.preventDefault(),e.stopPropagation(),window.addEventListener("mousemove",this._domEventResizeMove),window.addEventListener("mouseup",this._domEventResizeEnd),this._resizeStart()},c.prototype._onResizeMove=function(e){e.preventDefault(),e.stopPropagation(),this._resizeMove(e.clientX,e.clientY)},c.prototype._onResizeEnd=function(e){e.preventDefault(),e.stopPropagation(),window.removeEventListener("mousemove",this._domEventResizeMove),window.removeEventListener("mouseup",this._domEventResizeEnd),this._resizeEnd()},c.prototype._onResizeTouchStart=function(e){e.preventDefault(),e.stopPropagation();for(var t=0;t<e.changedTouches.length;t++){var n=e.changedTouches[t];n.target===this._domResizeHandle&&(this._resizeTouchId=n.identifier)}window.addEventListener("touchmove",this._domEventResizeTouchMove),window.addEventListener("touchend",this._domEventResizeTouchEnd),this._resizeStart()},c.prototype._onResizeTouchMove=function(e){for(var t=0;t<e.changedTouches.length;t++){var n=e.changedTouches[t];if(n.identifier===this._resizeTouchId){e.stopPropagation(),e.preventDefault(),this._resizeMove(n.clientX,n.clientY);break}}},c.prototype._onResizeTouchEnd=function(e){for(var t=0;t<e.changedTouches.length;t++){if(e.changedTouches[t].identifier!==this._resizeTouchId){this._resizeTouchId=null,e.preventDefault(),e.stopPropagation(),window.removeEventListener("touchmove",this._domEventResizeTouchMove),window.removeEventListener("touchend",this._domEventResizeTouchEnd),this._resizeEnd();break}}},c.prototype._resizeStart=function(){this.class.add("pcui-resizable-resizing")},c.prototype._resizeMove=function(e,t){var n,i;this._resizeData?(this._resizeHorizontally?(n=this._resizeData.x-e,"right"===this._resizable&&(n=-n),this.width=this.RESIZE_HANDLE_SIZE+Math.max(this._resizeMin,Math.min(this._resizeMax,this._resizeData.width+n))):(i=this._resizeData.y-t,"bottom"===this._resizable&&(i=-i),this.height=Math.max(this._resizeMin,Math.min(this._resizeMax,this._resizeData.height+i))),this.emit("resize")):this._resizeData={x:e,y:t,width:this.dom.clientWidth,height:this.dom.clientHeight}},c.prototype._resizeEnd=function(){this._resizeData=null,this.class.remove("pcui-resizable-resizing")},c.prototype.destroy=function(){this.domContent=null,this._domResizeHandle&&(this._domResizeHandle.removeEventListener("mousedown",this._domEventResizeStart),window.removeEventListener("mousemove",this._domEventResizeMove),window.removeEventListener("mouseup",this._domEventResizeEnd),this._domResizeHandle.removeEventListener("touchstart",this._domEventResizeTouchStart),window.removeEventListener("touchmove",this._domEventResizeTouchMove),window.removeEventListener("touchend",this._domEventResizeTouchEnd)),this._domResizeHandle=null,this._domEventResizeStart=null,this._domEventResizeMove=null,this._domEventResizeEnd=null,this._domEventResizeTouchStart=null,this._domEventResizeTouchMove=null,this._domEventResizeTouchEnd=null,r.prototype.destroy.call(this)},c);function c(e){var t=r.call(this,document.createElement("div"),e)||this;t.RESIZE_HANDLE_SIZE=4,t.VALID_RESIZABLE_VALUES=[null,"top","right","bottom","left"],t._flex=!1,t._grid=!1,t._scrollable=!1,t._resizable=null,t._resizeMin=0,t._resizeMax=0,t._domContent=null,e=e||{};var n=t.dom;n.classList.add("pcui-container"),t._domEventScroll=t._onScroll.bind(t),t.domContent=n,t.scrollable=void 0!==e.scrollable&&e.scrollable,t.flex=!!e.flex;var i=!!e.grid;return i&&t.flex&&(console.error('Invalid pcui.Container arguments: "grid" and "flex" cannot both be true.'),i=!1),t.grid=i,t._domResizeHandle=null,t._domEventResizeStart=t._onResizeStart.bind(t),t._domEventResizeMove=t._onResizeMove.bind(t),t._domEventResizeEnd=t._onResizeEnd.bind(t),t._domEventResizeTouchStart=t._onResizeTouchStart.bind(t),t._domEventResizeTouchMove=t._onResizeTouchMove.bind(t),t._domEventResizeTouchEnd=t._onResizeTouchEnd.bind(t),t._resizeTouchId=null,t._resizeData=null,t._resizeHorizontally=!0,t.resizable=e.resizable||null,t._resizeMin=100,t._resizeMax=300,void 0!==e.resizeMin&&(t.resizeMin=e.resizeMin),void 0!==e.resizeMax&&(t.resizeMax=e.resizeMax),t}n.TopElementContainer=l},{"../element":158,"./top-element":181}],180:[function(e,t,n){"use strict";var i,o=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0}),n.TopElementPanel=void 0;var r,a=e("./top-element-container"),s=(r=a.TopElementContainer,o(l,r),Object.defineProperty(l.prototype,"collapsible",{get:function(){return this._collapsible},set:function(e){var t;e!==this._collapsible&&(this._collapsible=e,this._evtAppend&&(this._evtAppend.unbind(),this._evtAppend=null),this._evtRemove&&(this._evtRemove.unbind(),this._evtRemove=null),e?(t=this._onChildrenChange.bind(this),this._evtAppend=this._containerContent.on("append",t),this._evtRemove=this._containerContent.on("remove",t),this.class.add("pcui-collapsible")):this.class.remove("pcui-collapsible"),this._reflow(),this.collapsed&&this.emit(e?"collapse":"expand"))},enumerable:!1,configurable:!0}),Object.defineProperty(l.prototype,"collapsed",{get:function(){return this._collapsed},set:function(e){this._collapsed!==e&&((this._collapsed=e)?this.class.add("pcui-collapsed"):this.class.remove("pcui-collapsed"),this._reflow(),this.collapsible&&this.emit(e?"collapse":"expand"))},enumerable:!1,configurable:!0}),Object.defineProperty(l.prototype,"collapseHorizontally",{get:function(){return this._collapseHorizontally},set:function(e){this._collapseHorizontally!==e&&((this._collapseHorizontally=e)?this.class.add("pcui-panel-horizontal"):this.class.remove("pcui-panel-horizontal"),this._reflow())},enumerable:!1,configurable:!0}),Object.defineProperty(l.prototype,"content",{get:function(){return this._containerContent},enumerable:!1,configurable:!0}),Object.defineProperty(l.prototype,"header",{get:function(){return this._containerHeader},enumerable:!1,configurable:!0}),Object.defineProperty(l.prototype,"headerText",{get:function(){return this._domHeaderTitle.textContent||""},set:function(e){this._domHeaderTitle.textContent=e},enumerable:!1,configurable:!0}),Object.defineProperty(l.prototype,"headerSize",{get:function(){return this._headerSize},set:function(e){this._headerSize=e;var t=this._containerHeader.dom.style;t.height=Math.max(0,e)+"px",t.lineHeight=t.height,this._reflow()},enumerable:!1,configurable:!0}),l.prototype._onHeaderClick=function(e){this._collapsible&&(e.target!==this.header.dom&&e.target!==this._domHeaderTitle||(this.collapsed=!this.collapsed))},l.prototype._onChildrenChange=function(){!this.collapsible||this.collapsed||this._collapseHorizontally||this.hidden||(this.height=this.headerSize+this._containerContent.dom.clientHeight)},l.prototype._reflow=function(){var e=this;this._suspendReflow||(this._reflowTimeout&&(cancelAnimationFrame(this._reflowTimeout),this._reflowTimeout=null),!this.hidden&&this.collapsible&&(this.collapsed&&this.collapseHorizontally?this._containerHeader.style.top=-this.headerSize+"px":this._containerHeader.style.top="",this._reflowTimeout=requestAnimationFrame(function(){e._reflowTimeout=null,e.collapsed?(e._widthBeforeCollapse||(e._widthBeforeCollapse=e.dom.clientWidth),e._heightBeforeCollapse||(e._heightBeforeCollapse=e.dom.clientHeight),e._collapseHorizontally?(e.height="",e.width=e.headerSize):e.height=e.headerSize):(e._collapseHorizontally?(e.height="",null!==e._widthBeforeCollapse&&(e.width=e._widthBeforeCollapse)):null!==e._heightBeforeCollapse&&(e.height=e._heightBeforeCollapse),e._widthBeforeCollapse=null,e._heightBeforeCollapse=null)}.bind(e))))},l.prototype.destroy=function(){this._reflowTimeout&&(cancelAnimationFrame(this._reflowTimeout),this._reflowTimeout=null),r.prototype.destroy.call(this)},l);function l(e){var t=r.call(this,e)||this;t._headerSize=0,t._collapsible=!1,t._collapsed=!1,t._collapseHorizontally=!1,t._reflowTimeout=null,t._widthBeforeCollapse=null,t._heightBeforeCollapse=null,e=e||{};var n=Object.assign({},e);return n.flex=!0,delete n.flexDirection,delete n.scrollable,t.class.add("pcui-panel"),e.panelType&&t.class.add("pcui-panel-"+e.panelType),t._suspendReflow=!0,t._containerHeader=new a.TopElementContainer({flex:!0,flexDirection:"row"}),t._containerHeader.class.add("pcui-panel-header"),t._domHeaderTitle=document.createElement("span"),t._domHeaderTitle.textContent=e.headerText||"",t._domHeaderTitle.classList.add("pcui-panel-header-title"),t._domHeaderTitle.ui=t._containerHeader,t._containerHeader.dom.appendChild(t._domHeaderTitle),t._containerHeader.dom.addEventListener("click",t._onHeaderClick.bind(t)),t.append(t._containerHeader),t._containerContent=new a.TopElementContainer({flex:e.flex,flexDirection:e.flexDirection,scrollable:e.scrollable}),t._containerContent.class.add("pcui-panel-content"),t._containerContent.style.height="100%",t.appendAfter(t._containerContent,t._containerHeader),t._evtAppend=null,t._evtRemove=null,t.headerSize=void 0!==e.headerSize?e.headerSize:32,t._reflowTimeout=null,t._widthBeforeCollapse=null,t._heightBeforeCollapse=null,e.collapsed&&(e.width&&(t._widthBeforeCollapse=e.width),e.height&&(t._heightBeforeCollapse=e.height)),t.collapsible=e.collapsible||!1,t.collapsed=e.collapsed||!1,t.collapseHorizontally=e.collapseHorizontally||!1,t.domContent=t._containerContent.dom,t._suspendReflow=!1,t._reflow(),t}n.TopElementPanel=s},{"./top-element-container":179}],181:[function(e,t,n){"use strict";var i,o=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0}),n.TopElement=void 0;var r,a=e("../../lib"),s=(r=a.Events,o(l,r),Object.defineProperty(l.prototype,"enabled",{get:function(){return this._enabled&&(!this._parent||this._parent.enabled)},set:function(e){this._enabled!==e&&this.enabled!==(this._enabled=e)&&this._onEnabledChange(e)},enumerable:!1,configurable:!0}),Object.defineProperty(l.prototype,"dom",{get:function(){return this._dom},set:function(e){this._dom=e},enumerable:!1,configurable:!0}),Object.defineProperty(l.prototype,"parent",{get:function(){return this._parent},set:function(e){var t,n;e!==this._parent&&(t=this.enabled,this._parent&&(this._evtParentDestroy.unbind(),this._evtParentDisable.unbind(),this._evtParentEnable.unbind()),this._parent=e,this._parent&&(this._evtParentDestroy=this._parent.once("destroy",this._onParentDestroy.bind(this)),this._evtParentDisable=this._parent.on("disable",this._onParentDisable.bind(this)),this._evtParentEnable=this._parent.on("enable",this._onParentEnable.bind(this))),this.emit("parent",this._parent),(n=this.enabled)!==t&&this._onEnabledChange(n))},enumerable:!1,configurable:!0}),Object.defineProperty(l.prototype,"hidden",{get:function(){return this._hidden},set:function(e){e!==this._hidden&&((this._hidden=e)?this.class.add("pcui-hidden"):this.class.remove("pcui-hidden"),this.emit(e?"hide":"show"))},enumerable:!1,configurable:!0}),Object.defineProperty(l.prototype,"style",{get:function(){return this._dom.style},enumerable:!1,configurable:!0}),Object.defineProperty(l.prototype,"class",{get:function(){return this._dom.classList},enumerable:!1,configurable:!0}),Object.defineProperty(l.prototype,"width",{get:function(){return this._dom.clientWidth},set:function(e){"number"==typeof e&&(e=e.toString()+"px"),this.style.width=e},enumerable:!1,configurable:!0}),Object.defineProperty(l.prototype,"height",{get:function(){return this._dom.clientHeight},set:function(e){"number"==typeof e&&(e=e.toString()+"px"),this.style.height=e},enumerable:!1,configurable:!0}),Object.defineProperty(l.prototype,"disabled",{get:function(){return!this.enabled},set:function(e){this.enabled=!e},enumerable:!1,configurable:!0}),Object.defineProperty(l.prototype,"element",{get:function(){return this.dom},set:function(e){this.dom=e},enumerable:!1,configurable:!0}),l.prototype.exposeCssProperty=function(t){Object.defineProperty(l.prototype,t,{get:function(){return this.style[t]},set:function(e){this.style[t]=e}})},l.prototype.link=function(e,t){throw new Error("Not implemented")},l.prototype.unlink=function(){throw new Error("Not implemented")},l.prototype.flash=function(){var e=this;this.class.add("flash"),setTimeout(function(){e.class.remove("flash")}.bind(e),200)},l.prototype._onClick=function(e){this.enabled&&this.emit("click",e)},l.prototype._onMouseOver=function(e){this.emit("hover",e)},l.prototype._onMouseOut=function(e){this.emit("hoverend",e)},l.prototype._onEnabledChange=function(e){e?this.class.remove("pcui-disabled"):this.class.add("pcui-disabled"),this.emit(e?"enable":"disable")},l.prototype._onParentDestroy=function(){this.destroy()},l.prototype._onParentDisable=function(){this._enabled&&this._onEnabledChange(!1)},l.prototype._onParentEnable=function(){this._enabled&&this._onEnabledChange(!0)},l.prototype.destroy=function(){this._destroyed||(this._destroyed=!0,this.parent&&this.parent.element&&this.element&&this.element.parentNode&&this.element.parentNode.removeChild(this.parent.element),this._dom&&(this._dom.removeEventListener("click",this._domEventClick),this._dom.removeEventListener("mouseover",this._domEventMouseOver),this._dom.removeEventListener("mouseout",this._domEventMouseOut),this._dom.ui&&this._dom.ui.destroy(),this._dom=null),this._domEventClick=null,this._domEventMouseOver=null,this._domEventMouseOut=null)},l);function l(e,t){var n,i=r.call(this)||this;for(n in i.SIMPLE_CSS_PROPERTIES={flexDirection:"flex-direction",flexGrow:"flex-grow",flexBasis:"flex-basis",flexShrink:"flex-shrink",flexWrap:"flex-wrap",alignItems:"align-items",justifyContent:"justify-content"},i._destroyed=!1,i._enabled=!0,i._hidden=!1,i._parent=null,i._evtParentDestroy=null,i._evtParentDisable=null,i._evtParentEnable=null,t=t||{},i._destroyed=!1,i._enabled=!0,i._hidden=!1,i._parent=null,i._domEventClick=i._onClick.bind(i),i._domEventMouseOver=i._onMouseOver.bind(i),i._domEventMouseOut=i._onMouseOut.bind(i),i._evtParentDestroy=null,i._evtParentDisable=null,i._evtParentEnable=null,i._dom=e,void 0!==t.id&&(i._dom.id=t.id),(i._dom.ui=i)._dom.addEventListener("click",i._domEventClick),i._dom.addEventListener("mouseover",i._domEventMouseOver),i._dom.addEventListener("mouseout",i._domEventMouseOut),i._dom.classList.add("pcui-element"),void 0!==t.enabled&&(i.enabled=t.enabled),void 0!==t.hidden&&(i.hidden=t.hidden),void 0!==t.width&&(i.width=t.width),void 0!==t.height&&(i.height=t.height),t)void 0!==t[n]&&null!==i.SIMPLE_CSS_PROPERTIES[n]&&i.style.setProperty(i.SIMPLE_CSS_PROPERTIES[n],t[n]);return i}n.TopElement=s},{"../../lib":143}],182:[function(e,t,n){"use strict";var i,o=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0}),n.TreeItem=void 0;var r,a=e("./element"),m=e("./tree"),s=e("./text-field"),l=(r=a.Element,o(g,r),Object.defineProperty(g.prototype,"selected",{get:function(){return this.class.contains("selected")},set:function(e){this.class.contains("selected")!==!!e&&(e?(this.class.add("selected"),this.emit("select"),this.tree&&this.tree.emit("select",this)):(this.class.remove("selected"),this.emit("deselect"),this.tree&&this.tree.emit("deselect",this)))},enumerable:!1,configurable:!0}),Object.defineProperty(g.prototype,"text",{get:function(){return this.elementText.textContent||""},set:function(e){this.elementText.textContent!==e&&(this.elementText.textContent=e)},enumerable:!1,configurable:!0}),Object.defineProperty(g.prototype,"open",{get:function(){return this.class.contains("open")},set:function(e){this.class.contains("open")!==!!e&&(e?(this.class.add("open"),this.emit("open"),this.tree.emit("open",this)):(this.class.remove("open"),this.emit("close"),this.tree.emit("close",this)))},enumerable:!1,configurable:!0}),Object.defineProperty(g.prototype,"prev",{get:function(){return this.element.previousElementSibling&&this.element.previousElementSibling.ui&&this.element.previousElementSibling.ui instanceof g?this.element.previousElementSibling.ui:null},enumerable:!1,configurable:!0}),Object.defineProperty(g.prototype,"next",{get:function(){return this.element.nextElementSibling&&this.element.nextElementSibling.ui&&this.element.nextElementSibling.ui instanceof g?this.element.nextElementSibling.ui:null},enumerable:!1,configurable:!0}),Object.defineProperty(g.prototype,"allowDrop",{get:function(){return this._allowDrop},set:function(e){this._allowDrop=e},enumerable:!1,configurable:!0}),g.prototype.child=function(e){return this.element.children[e+1]},g.prototype._onClick=function(e){var t,n=e.target;if(!n.ui){if(!n.parentElement||!n.parentElement.ui)return;n=n.parentElement}0===e.button&&n.ui.selectable&&(t=n.getBoundingClientRect(),n.ui._children&&e.clientX-t.left<0?n.ui.open=!n.ui.open:(n.ui.tree._onItemClick(n.ui),e.stopPropagation()))},g.prototype._onDblClick=function(e){var t,n=e.target;if(!n.ui){if(!n.parentElement||!n.parentElement.ui)return;n=n.parentElement}n.ui.tree.allowRenaming&&0===e.button&&(e.stopPropagation(),t=n.getBoundingClientRect(),n.ui._children&&e.clientX-t.left<0||n.ui._onRename(!0))},g.prototype._onMouseDown=function(e){var t=e.target;if(!t.ui){if(!t.parentElement||!t.parentElement.ui)return;t=t.parentElement}t.ui.tree&&!t.ui.tree.draggable||e.stopPropagation()},g.prototype._onMouseOver=function(e){var t=e.target;if(!t.ui){if(!t.parentElement||!t.parentElement.ui)return;t=t.parentElement}e.stopPropagation(),t.ui.emit("mouseover",e)},g.prototype._onSelect=function(){this.elementTitle.focus()},g.prototype._onDeselect=function(){this.elementTitle.blur()},g.prototype._onKeyDown=function(e){var t=e.target;if(t.ui){var n=t.ui;if((!e.target||"input"!==t.tagName.toLowerCase())&&-1!==[9,38,40,37,39].indexOf(e.keyCode)){e.preventDefault(),e.stopPropagation();var i,o=null,r=null;switch(e.keyCode){case 9:break;case 40:var a=n.element.nextElementSibling;if(a&&(r=a.ui),n._children&&n.open){var s=n.element.firstElementChild.nextElementSibling;s&&s.ui?o=s.ui:r&&(o=r)}else if(r)o=r;else if(n.parent&&n.parent instanceof g)for(var l=function(e){var t=e.next;if(t)o=t;else if(e.parent instanceof g)return e.parent;return null},c=l(c=n.parent);c;)c=l(c);break;case 38:var d=n.element.previousElementSibling;if(d&&(r=d.ui),r)if(r._children&&r.open&&r!==n.parent){var u=r.element.lastElementChild,h=null;if(u&&u.ui&&(h=u.ui),h){for(var p=!1;!p;){var f=(i=h)._children&&i.open&&i.element.lastElementChild&&i.element.lastElementChild.ui?i.element.lastElementChild.ui:null;f?h=f:p=!0}o=h}else o=r}else o=r;else n.parent&&n.parent instanceof g&&(o=n.parent);break;case 37:n.parent!==n.tree&&n.open&&(n.open=!1);break;case 39:n._children&&!n.open&&(n.open=!0)}o&&(m.Tree._ctrl&&m.Tree._ctrl()||m.Tree._shift&&m.Tree._shift()||n.tree.clear(),o.selected=!0)}}},g.prototype._onRename=function(e){e&&(this.tree.clear(),this.tree._onItemClick(this));var t=this;this.class.add("rename");var n=new s.TextField;n.parent=this,n.renderChanges=!1,n.value=this.text,n.elementInput.addEventListener("blur",function(){n.destroy(),t.class.remove("rename")},!1),n.on("click",function(e){e.stopPropagation()}),n.element.addEventListener("dblclick",function(e){e.stopPropagation()}),n.on("change",function(e){(e=e.trim())&&(t.entity&&t.entity.set("name",e),t.emit("rename",e)),n.destroy(),t.class.remove("rename")}),this.elementTitle.appendChild(n.element),n.elementInput.focus(),n.elementInput.select()},g.prototype._onDestroy=function(){this.elementTitle.removeEventListener("click",this._onClick),this.elementTitle.removeEventListener("dblclick",this._onDblClick),this.elementTitle.removeEventListener("mousedown",this._onMouseDown),this.elementTitle.removeEventListener("dragstart",this._onDragStart),this.elementTitle.removeEventListener("mouseover",this._onMouseOver),this.elementTitle.removeEventListener("keydown",this._onKeyDown)},g.prototype._onAppend=function(e){this.parent&&this.parent.emit("append",e)},g.prototype._onRemove=function(e){this.parent&&this.parent.emit("remove",e)},g.prototype.focus=function(){this.elementTitle.focus()},g.prototype.append=function(e){1===this._children&&this.element.children[1].classList.remove("single"),(e.parent=this).element.appendChild(e.element),this._children++,1===this._children?(e.class.add("single"),this.class.add("container")):1<this._children&&e.class.remove("single");var n=function(e){if(e.emit("append",e),e._children)for(var t=1;t<e.element.children.length;t++)n(e.element.children[t].ui)};n(e)},g.prototype.appendBefore=function(e,t){1===this._children&&this.element.children[1].classList.remove("single"),(e.parent=this).element.insertBefore(e.element,t.element),this._children++,1===this._children?(e.class.add("single"),this.class.add("container")):1<this._children&&e.class.remove("single");var n=function(e){if(e.emit("append",e),e._children)for(var t=1;t<e.element.children.length;t++)n(e.element.children[t].ui)};n(e)},g.prototype.appendAfter=function(e,t){e.parent=this,t||this.append(e),this.element.insertBefore(e.element,t.element.nextElementSibling),this._children++,1===this._children?(e.class.add("single"),this.class.add("container")):2===this._children&&this.element.children[1].classList.remove("single");var n=function(e){if(e.emit("append",e),e._children)for(var t=1;t<e.element.children.length;t++)n(e.element.children[t].ui)};n(e)},g.prototype.remove=function(e){var n;this._children&&this.element.contains(e.element)&&(this.element.removeChild(e.element),this._children--,0===this._children?this.class.remove("container"):1===this._children&&2<this.element.children.length&&this.element.children[1].classList.add("single"),(n=function(e){if(e.emit("remove",e),e._children)for(var t=1;t<e.element.children.length;t++)e.element.children[t].ui&&e.element.children[t].ui instanceof g&&n(e.element.children[t].ui)})(e))},g);function g(e){var t=r.call(this)||this;t._dragId=-1,t._onDragStart=function(e){var t=e.target;if(!t.ui){if(!t.parentElement||!t.parentElement.ui)return;t=t.parentElement}if(!t.ui.tree.draggable)return e.stopPropagation(),void e.preventDefault();t.ui._dragging=!0,t.ui._dragRelease&&window.removeEventListener("mouseup",t.ui._dragRelease),t.ui._dragRelease=t.ui._onMouseUp,window.addEventListener("mouseup",t.ui._dragRelease,!1),e.stopPropagation(),e.preventDefault(),t.ui.emit("dragstart")};var n=t;return e=e||{},t.tree=null,t.element=document.createElement("div"),t.element.classList.add("ui-tree-item"),t.element.ui=t,e.classList&&e.classList.forEach(function(e){n.element.classList.add(e)},t),t.elementTitle=document.createElement("div"),t.elementTitle.classList.add("title"),t.elementTitle.draggable=!0,t.elementTitle.tabIndex=0,(t.elementTitle.ui=t).element.appendChild(t.elementTitle),t.elementIcon=document.createElement("span"),t.elementIcon.classList.add("icon"),t.elementTitle.appendChild(t.elementIcon),t.elementText=document.createElement("span"),t.elementText.textContent=e.text||"",t.elementText.classList.add("text"),t.elementTitle.appendChild(t.elementText),t._children=0,t.selectable=!0,t._onMouseUp=function(e){window.removeEventListener("mouseup",n._dragRelease),n._dragRelease=null,e.preventDefault(),e.stopPropagation(),n._dragging=!1,n.emit("dragend")},t.elementTitle.addEventListener("click",t._onClick,!1),t.elementTitle.addEventListener("dblclick",t._onDblClick,!1),t._dragRelease=null,t._dragging=!1,t._allowDrop=void 0===e.allowDrop||!!e.allowDrop,t.elementTitle.addEventListener("mousedown",t._onMouseDown,!1),t.elementTitle.addEventListener("dragstart",t._onDragStart,!1),t.elementTitle.addEventListener("mouseover",t._onMouseOver,!1),t.on("destroy",t._onDestroy),t.on("append",t._onAppend),t.on("remove",t._onRemove),t.on("select",t._onSelect),t.on("deselect",t._onDeselect),t.elementTitle.addEventListener("keydown",t._onKeyDown,!1),t}n.TreeItem=l},{"./element":158,"./text-field":175,"./tree":183}],183:[function(e,t,n){"use strict";var i,o=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0}),n.Tree=void 0;var r,a=e("./container-element"),f=e("./tree-item"),s=e("../editor"),l=(r=a.ContainerElement,o(m,r),Object.defineProperty(m.prototype,"selected",{get:function(){return this._selected.slice(0)},enumerable:!1,configurable:!0}),m._ctrl=function(){return s.Hotkeys.ctrl},m._shift=function(){return s.Hotkeys.shift},m.prototype._onDragMove=function(e){this.draggable&&(this._hoverCalculate(e),this.emit("dragmove",e))},m.prototype._hoverCalculate=function(e){if(this.draggable&&this._dragOver){var t=this.elementDrag.getBoundingClientRect(),n=Math.floor((e.clientY-t.top)/t.height*5),i=this._dragArea,o=this._dragOver;if(this._dragOver.parent===this){for(var r=!1,a=0;a<this._dragItems.length;a++)if(this._dragItems[a].parent===this._dragOver){r=!0,this._dragOver=null;break}r||(this._dragArea="inside")}else{for(var s=!1,a=0;a<this._dragItems.length;a++)for(var l=this._dragOver.parent;l;){if(l===this._dragItems[a]){s=!0;break}l=l.parent}if(s)this._dragOver=null;else if(this.reordering&&n<=1&&-1===this._dragItems.indexOf(this._dragOver.prev))this._dragArea="before";else if(this.reordering&&4<=n&&-1===this._dragItems.indexOf(this._dragOver.next)&&(0===this._dragOver._children||!this._dragOver.open))this._dragArea="after";else{var c=!1;if(this.reordering&&this._dragOver.open)for(a=0;a<this._dragItems.length;a++)if(this._dragItems[a].parent===this._dragOver){c=!0,this._dragArea="before";break}c||(this._dragArea="inside")}}i===this._dragArea&&o===this._dragOver||this._updateDragHandle()}},m.prototype._onItemClick=function(e){if(m._ctrl&&m._ctrl())e.selected=!e.selected;else if(m._shift&&m._shift()&&this._selected.length){for(var t=this._selected[this._selected.length-1],n=e,i=[],o=[],r=!1,a=[],s=!0,l=!0,c=!0;!r;){c=!c;var d=null,u=t;if(l&&!c||!s)if(l)if(o.length&&(u=o[o.length-1]),d=function(e){var n=null,t=e.element.nextElementSibling,i=null;if(t&&(i=t.ui),e.open&&e._children){var o=e.element.firstElementChild.nextElementSibling;o&&o.ui?n=o.ui:i&&(n=i)}else if(i)n=i;else if(e.parent&&e.parent instanceof f.TreeItem)for(var r=function(e){var t=e.next;if(t)n=t;else if(e.parent instanceof f.TreeItem)return e.parent;return null},a=r(a=e.parent);a;)a=r(a);return n}(u)){if(o.push(d),d===n){r=!0,a=o;break}}else l=!1;else r=!0;else if(i.length&&(u=i[i.length-1]),d=function(e){if(!e)return null;var t,n=null,i=e.element.previousElementSibling,o=null;if(i&&(o=i.ui),o)if(e.parent&&e.parent===o&&e.parent instanceof f.TreeItem)n=e.parent;else if(o.open&&o._children){var r=o.element.lastElementChild,a=null;if(r&&r.ui&&(a=r.ui),a){for(var s=!1;!s;){var l=(t=a)&&t.open&&t._children&&t.element.lastElementChild&&t.element.lastChild.ui?t.element.lastChild.ui:null;l?a=l:s=!0}n=a}else n=o}else n=o;return n}(u)){if(i.push(d),d===n){r=!0,a=i;break}}else s=!1}if(a)for(var h=0;h<a.length;h++)a[h].selected=!0}else{var p=e.selected&&(-1===this._selected.indexOf(e)||1===this._selected.length&&this._selected[0]===e);this.clear(),p||(e.selected=!0)}},m.prototype._onSelect=function(e){this._selected.push(e)},m.prototype._onDeselect=function(e){var t=this._selected.indexOf(e);-1!==t&&this._selected.splice(t,1)},m.prototype._onDragStart=function(e){if(this.draggable&&!this._dragging){if(this._dragItems=[],this._selected&&1<this._selected.length&&-1!==this._selected.indexOf(e)){for(var r=[],t={},n=-1,i=0;i<this._selected.length;i++){if(this._selected[i].parent===this)return;this._selected[i]._dragId=i+1,t[this._selected[i]._dragId]=this._selected[i]}for(i=0;i<this._selected.length;i++){this._selected[i];var o=0,a=!1,s=this._selected[i].parent;for(s&&s instanceof f.TreeItem||(s=null);s;){if(s._dragId&&t[s._dragId]){a=!0;break}if(!((s=s.parent)instanceof f.TreeItem)){s=null;break}o++}if(!a){if(-1===n)n=o;else if(n!==o)return;r.push(this._selected[i])}}for(i=0;i<this._selected.length;i++)this._selected[i]._dragId=-1;if(1<(this._dragItems=r).length){for(var l=null,c=r;!l&&c;)c=function(e){for(var t=[],n=0;n<e.length;n++)e[n].parent&&e[n].parent instanceof f.TreeItem&&-1===t.indexOf(e[n].parent)&&t.push(e[n].parent);return 1===t.length&&(l=t[0]),t}(c);for(i=0;i<r.length;i++)!function(e){for(var i=0,o=function(e){if(e._children){for(var t=0,n=e.element.children,i=0;i<n.length;i++)n[i].ui&&n[i].ui instanceof f.TreeItem&&(t+=o(n[i].ui)+1);return t}return 0},t=function(e){i++;var t=e.element.previousElementSibling,n=null;return t&&t.ui&&t.ui instanceof f.TreeItem&&(n=t.ui),n?(i+=o(n),n):e.parent!==l&&e.parent instanceof f.TreeItem?e.parent:null},n=t(r[e]);n;)n=t(n);r[e]._dragId=i}(i);r.sort(function(e,t){return e._dragId-t._dragId})}}else this._dragItems=[e];if(this._dragItems.length){this._dragging=!0,this.class.add("dragging");for(i=0;i<this._dragItems.length;i++)this._dragItems[i].class.add("dragged");this._updateDragHandle(),this.emit("dragstart")}}},m.prototype._onDragOver=function(e,t){var n;this.draggable&&this._dragging&&(-1===this._dragItems.indexOf(e)||this._dragOver)&&this._dragOver!==e&&(n=null,e.allowDrop&&(-1===this._dragItems.indexOf(e)&&(n=e),null===this._dragOver&&n&&this.emit("dragin")),this._dragOver=n,this._updateDragHandle(),this._onDragMove(t))},m.prototype._onDragEnd=function(){if(this.draggable&&this._dragging){var e=[];this._dragging=!1,this.class.remove("dragging");for(var t=this._dragOver,n=0;n<this._dragItems.length;n++)if(this._dragItems[n].class.remove("dragged"),this._dragOver&&this._dragOver!==this._dragItems[n]){var i=this._dragItems[n].parent;if(i!==this._dragOver||"inside"!==this._dragArea){var o=null;if("before"===this._dragArea){if(o=this._dragOver.parent,this.dragInstant){if(!editor.call("item:drag:allow",this._dragItems[n].entity,this._dragOver.entity,"before"))return void editor.call("status:error","当前选中物体不允许拖拽到目标物体！");this._dragItems[n].parent&&this._dragItems[n].parent.remove(this._dragItems[n]),this._dragOver.parent.appendBefore(this._dragItems[n],this._dragOver),editor.call("status:text","VeRyEngine")}}else if("inside"===this._dragArea){if(o=this._dragOver,this.dragInstant){if(!editor.call("item:drag:allow",this._dragItems[n].entity,this._dragOver.entity,"inside"))return void editor.call("status:error","当前选中物体不允许拖拽到目标物体！");this._dragItems[n].parent&&this._dragItems[n].parent.remove(this._dragItems[n]),this._dragOver.open=!0,this._dragOver.append(this._dragItems[n]),editor.call("status:text","VeRyEngine")}}else if("after"===this._dragArea&&(o=this._dragOver.parent,this.dragInstant)){if(!editor.call("item:drag:allow",this._dragItems[n].entity,this._dragOver.entity,"after"))return void editor.call("status:error","当前选中物体不允许拖拽到目标物体！");this._dragItems[n].parent&&this._dragItems[n].parent.remove(this._dragItems[n]),this._dragOver.parent.appendAfter(this._dragItems[n],t),t=this._dragItems[n],editor.call("status:text","VeRyEngine")}e.push({item:this._dragItems[n],old:i,new:o})}}this.emit("reparent",e),this._dragItems=[],this._dragOver&&(this._dragOver=null),this.emit("dragend")}},m.prototype._onDragOut=function(){this.draggable&&this._dragging&&this._dragOver&&(this._dragOver=null,this._updateDragHandle(),this.emit("dragout"))},m.prototype._updateDragHandle=function(){var e;this.draggable&&this._dragging&&(this._dragOver?(e=this._dragOver.elementTitle.getBoundingClientRect(),this.elementDrag.classList.remove("before","inside","after","hidden"),this.elementDrag.classList.add(this._dragArea),this.elementDrag.style.top=e.top+"px",this.elementDrag.style.left=e.left+"px",this.elementDrag.style.width=e.width-4+"px"):this.elementDrag.classList.add("hidden"))},m.prototype._onAppend=function(t){var n=t.tree=this;t.on("dragstart",function(){t.parent!==n&&n._onDragStart(t)}),t.on("mouseover",function(e){n._onDragOver(t,e)}),t.on("dragend",function(){n._onDragEnd()})},m.prototype._onRemove=function(e){e.tree=null,e.unbind("dragstart"),e.unbind("mouseover"),e.unbind("dragend")},m.prototype.clear=function(){if(this._selected.length){for(var e=this._selected.length;e--;)this._selected[e].selected=!1;this._selected=[]}},m);function m(){var e=r.call(this)||this;e._dragItems=[],e._selected=[],e.allowRenaming=!0,e.element=document.createElement("div"),e.element.classList.add("ui-tree"),e.innerElement=e.element,e.elementDrag=document.createElement("div"),e.elementDrag.classList.add("drag-handle"),e.element.appendChild(e.elementDrag);var t=e;return e.elementDrag.addEventListener("mousemove",function(e){e.preventDefault(),e.stopPropagation(),t._onDragMove(e)}),e.element.addEventListener("mouseleave",function(e){t._onDragOut()}),e.on("select",e._onSelect),e.on("deselect",e._onDeselect),e.on("append",e._onAppend),e.on("remove",e._onRemove),e.draggable=!0,e._dragging=!1,e._dragItems=[],e._dragOver=null,e._dragArea="inside",e._evtDragMove=null,e.reordering=!0,e.dragInstant=!0,e._selected=[],e}n.Tree=l},{"../editor":78,"./container-element":157,"./tree-item":182}]},{},[147]);
//# sourceMappingURL=vreditor.js.map
