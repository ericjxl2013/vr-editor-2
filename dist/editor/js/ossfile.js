!function(t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).ossfile=t()}(function(){return function i(s,u,a){function c(e,t){if(!u[e]){if(!s[e]){var n="function"==typeof require&&require;if(!t&&n)return n(e,!0);if(d)return d(e,!0);var r=new Error("Cannot find module '"+e+"'");throw r.code="MODULE_NOT_FOUND",r}var o=u[e]={exports:{}};s[e][0].call(o.exports,function(t){return c(s[e][1][t]||t)},o,o.exports,i,s,u,a)}return u[e].exports}for(var d="function"==typeof require&&require,t=0;t<a.length;t++)c(a[t]);return c}({1:[function(t,e,n){"use strict";var r,o=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0}),n.AjaxRequest=n.Ajax=void 0;var i=t("./events"),a=(s.get=function(t){return new u({url:t})},s.post=function(t,e){return new u({method:"POST",url:t,data:e})},s.put=function(t,e){return new u({method:"PUT",url:t,data:e})},s.delete=function(t){return new u({method:"DELETE",url:t})},s.param=function(t,e){s.params[t]=e},s.params={},s);function s(t){return"string"==typeof t&&(t={url:t}),new u(t)}n.Ajax=a;var c,u=(c=i.Events,o(d,c),d.prototype._onLoad=function(){if(this._progress=1,this.emit("progress",1),200===this._xhr.status||201===this._xhr.status)if(this.notJson)this.emit("load",this._xhr.status,this._xhr.responseText);else{try{var t=JSON.parse(this._xhr.responseText)}catch(t){return void this.emit("error",this._xhr.status||0,new Error("invalid json"))}this.emit("load",this._xhr.status,t)}else try{var e=(t=JSON.parse(this._xhr.responseText)).message;e=(e=e||(t.error||t.response&&t.response.error))||this._xhr.responseText,this.emit("error",this._xhr.status,e)}catch(t){this.emit("error",this._xhr.status)}},d.prototype._onError=function(t){this.emit("error",0,t)},d.prototype._onAbort=function(t){this.emit("error",0,t)},d.prototype._onProgress=function(t){var e;!t.lengthComputable||(e=t.loaded/t.total)!==this._progress&&(this._progress=e,this.emit("progress",this._progress))},d.prototype.abort=function(){this._xhr.abort()},d);function d(t){var e=c.call(this)||this;if(e._progress=0,!t)throw new Error("ajax请求无参数，请检查！");e._progress=0,e.emit("progress",e._progress),e._xhr=new XMLHttpRequest,t.cookies&&(e._xhr.withCredentials=!0),e._xhr.addEventListener("load",e._onLoad.bind(e),!1),e._xhr.upload.addEventListener("progress",e._onProgress.bind(e),!1),e._xhr.addEventListener("error",e._onError.bind(e),!1),e._xhr.addEventListener("abort",e._onAbort.bind(e),!1);var n=t.url;if(t.query&&Object.keys(t.query).length){-1===n.indexOf("?")&&(n+="?");var r=[];for(u in t.query)r.push(u+"="+t.query[u]);n+=r.join("&")}var o=n.split("{{");if(1<o.length){for(var i=1;i<o.length;i++){var s=o[i].indexOf("}}"),u=o[i].slice(0,s);void 0!==a.params[u]&&(o[i]=a.params[u]+o[i].slice(s+2))}n=o.join("")}if(e._xhr.open(t.method||"GET",n,!0),e.notJson=t.notJson||!1,t.ignoreContentType||"PUT"!==t.method&&"POST"!==t.method&&"DELETE"!==t.method||e._xhr.setRequestHeader("Content-Type","application/json"),t.headers)for(var u in t.headers)e._xhr.setRequestHeader(u,t.headers[u]);return!t.data||"string"==typeof t.data||t.data instanceof FormData||(t.data=JSON.stringify(t.data)),e._xhr.send(t.data||null),e}n.AjaxRequest=u},{"./events":2}],2:[function(t,e,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.EventHandle=n.Events=void 0;var r=(Object.defineProperty(o.prototype,"suspendEvents",{get:function(){return this._suspendEvents},set:function(t){this._suspendEvents=t},enumerable:!1,configurable:!0}),o.prototype.on=function(t,e){var n=this._events[t];return void 0===n?this._events[t]=[e]:-1==n.indexOf(e)&&n.push(e),new i(this,t,e)},o.prototype.once=function(t,a){var c=this,d=this.on(t,function(t,e,n,r,o,i,s,u){a.call(c,t,e,n,r,o,i,s,u),d.unbind()});return d},o.prototype.emit=function(e,t,n,r,o,i,s,u,a){if(this._suspendEvents)return this;var c=this._events[e];if(!c)return this;c=c.slice(0);for(var d=0;d<c.length;d++)if(c[d])try{c[d].call(this,t,n,r,o,i,s,u,a)}catch(t){console.info("%c%s %c(event error)","color: #06f",e,"color: #f00"),console.log(t.stack)}return this},o.prototype.unbind=function(t,e){if(t){var n,r=this._events[t];if(!r)return this;e?-1!==(n=r.indexOf(e))&&(1===r.length?delete this._events[t]:r.splice(n,1)):delete this._events[t]}else this._events={};return this},o);function o(){this._suspendEvents=!1,this._events={}}n.Events=r;var i=(s.prototype.unbind=function(){this.owner&&(this.owner.unbind(this.name,this.fn),this.owner=null,this.name=null,this.fn=null)},s.prototype.call=function(){this.fn&&this.fn.call(this.owner,arguments[0],arguments[1],arguments[2],arguments[3],arguments[4],arguments[5],arguments[6],arguments[7])},s.prototype.on=function(t,e){return this.owner.on(t,e)},s);function s(t,e,n){this.owner=t,this.name=e,this.fn=n}n.EventHandle=i},{}],3:[function(t,e,a){"use strict";var c=this&&this.__awaiter||function(t,s,u,a){return new(u=u||Promise)(function(n,e){function r(t){try{i(a.next(t))}catch(t){e(t)}}function o(t){try{i(a.throw(t))}catch(t){e(t)}}function i(t){var e;t.done?n(t.value):((e=t.value)instanceof u?e:new u(function(t){t(e)})).then(r,o)}i((a=a.apply(t,s||[])).next())})},d=this&&this.__generator||function(n,r){var o,i,s,u={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]},t={next:e(0),throw:e(1),return:e(2)};return"function"==typeof Symbol&&(t[Symbol.iterator]=function(){return this}),t;function e(e){return function(t){return function(e){if(o)throw new TypeError("Generator is already executing.");for(;u;)try{if(o=1,i&&(s=2&e[0]?i.return:e[0]?i.throw||((s=i.return)&&s.call(i),0):i.next)&&!(s=s.call(i,e[1])).done)return s;switch(i=0,s&&(e=[2&e[0],s.value]),e[0]){case 0:case 1:s=e;break;case 4:return u.label++,{value:e[1],done:!1};case 5:u.label++,i=e[1],e=[0];continue;case 7:e=u.ops.pop(),u.trys.pop();continue;default:if(!(s=0<(s=u.trys).length&&s[s.length-1])&&(6===e[0]||2===e[0])){u=0;continue}if(3===e[0]&&(!s||e[1]>s[0]&&e[1]<s[3])){u.label=e[1];break}if(6===e[0]&&u.label<s[1]){u.label=s[1],s=e;break}if(s&&u.label<s[2]){u.label=s[2],u.ops.push(e);break}s[2]&&u.ops.pop(),u.trys.pop();continue}e=r.call(n,u)}catch(t){e=[6,t],i=0}finally{o=s=0}if(5&e[0])throw e[1];return{value:e[0]?e[1]:void 0,done:!0}}([e,t])}}};Object.defineProperty(a,"__esModule",{value:!0}),a.login=a.getJsonConfig=a.upLoadJsonConfig=a.donwLoad=a.getThumbnailUrl=a.getUrl=a.getJsonAsset=a.uploadJsonAsset=a.uploadFile=void 0;function f(t){if(t){var e=t.split(".");return 1<e.length?e[e.length-1]:t}return""}var l=t("./ajax");a.uploadFile=function(i,t,s,u,e){return c(void 0,void 0,void 0,function(){return d(this,function(t){return[2,new Promise(function(r,o){return c(void 0,void 0,void 0,function(){var e,n;return d(this,function(t){try{(e=new FormData).append("file",i),e.append("fileName",s+"."+f(u)),n={url:"/api/uploadFile",method:"PUT",data:e,ignoreContentType:!0,headers:{Accept:"application/json"}},new l.Ajax(n).on("load",function(t,e){r()})}catch(t){o(t)}return[2]})})})]})})};a.uploadJsonAsset=function(s,t,u,a,e){return void 0===e&&(e=!0),c(void 0,void 0,void 0,function(){return d(this,function(t){return[2,new Promise(function(o,i){return c(void 0,void 0,void 0,function(){var e,n,r;return d(this,function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),[4,axios.post("/api/uploadJsonAsset",{jsonName:u+"."+f(a),jsonStr:s})];case 1:return e=t.sent(),"0000"===(n=e.data).code?o(n.data):i(n.message),[3,3];case 2:return r=t.sent(),i(r),[3,3];case 3:return[2]}})})})]})})},a.getJsonAsset=function(t,s,u,e){return c(void 0,void 0,void 0,function(){return d(this,function(t){return[2,new Promise(function(o,i){return c(void 0,void 0,void 0,function(){var e,n,r;return d(this,function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),[4,axios.post("/api/getJsonAsset",{jsonName:s+"."+f(u)})];case 1:return e=t.sent(),"0000"===(n=e.data).code?o(n.data):i(n.message),[3,3];case 2:return r=t.sent(),i(r),[3,3];case 3:return[2]}})})})]})})};a.getUrl=function(t,n,r,e){return c(void 0,void 0,void 0,function(){return d(this,function(t){return[2,new Promise(function(e,t){return c(void 0,void 0,void 0,function(){return d(this,function(t){return e("/assets/"+n+"."+f(r)),[2]})})})]})})},a.getThumbnailUrl=function(t,n,r,e){return c(void 0,void 0,void 0,function(){return d(this,function(t){return[2,new Promise(function(e,t){return c(void 0,void 0,void 0,function(){return d(this,function(t){return e("/assets/"+n+"."+f(r)),[2]})})})]})})},a.donwLoad=function(o,i,s,u){return c(void 0,void 0,void 0,function(){var e,n,r;return d(this,function(t){switch(t.label){case 0:return[4,a.getUrl(o,i,s,u)];case 1:return e=t.sent(),(n=document.createElement("a")).innerHTML=s,n.download=s,n.href=e,document.body.appendChild(n),(r=document.createEvent("MouseEvents")).initEvent("click",!1,!1),n.dispatchEvent(r),document.body.removeChild(n),[2]}})})},a.upLoadJsonConfig=function(s,u,a){return c(void 0,void 0,void 0,function(){return d(this,function(t){return[2,new Promise(function(o,i){return c(void 0,void 0,void 0,function(){var e,n,r;return d(this,function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),[4,axios.post("/api/uploadJsonConfig",{projectID:u,jsonName:a,jsonStr:s})];case 1:return e=t.sent(),"0000"===(n=e.data).code?o(n.data):i(n.message),[3,3];case 2:return r=t.sent(),i(r),[3,3];case 3:return[2]}})})})]})})},a.getJsonConfig=function(s,u){return c(void 0,void 0,void 0,function(){return d(this,function(t){return[2,new Promise(function(o,i){return c(void 0,void 0,void 0,function(){var e,n,r;return d(this,function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),[4,axios.post("/api/getJsonConfig",{projectID:s,jsonName:u})];case 1:return e=t.sent(),"0000"===(n=e.data).code?o(n.data):i(n.message),[3,3];case 2:return r=t.sent(),i(r),[3,3];case 3:return[2]}})})})]})})},a.login=function(u,t){return c(void 0,void 0,void 0,function(){return d(this,function(t){return[2,new Promise(function(i,s){return c(void 0,void 0,void 0,function(){var e,n,r,o;return d(this,function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),[4,axios.post("/api/getProject",{projectID:u})];case 1:return e=t.sent(),"0000"===(n=e.data).code?((r={code:"00000"}).data=n.data,i(r)):s(n.message),[3,3];case 2:return o=t.sent(),s(o),[3,3];case 3:return[2]}})})})]})})}},{"./ajax":1}],4:[function(t,e,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=t("./ossfile");e.exports={getJsonAsset:r.getJsonAsset,getJsonConfig:r.getJsonConfig,uploadFile:r.uploadFile,getUrl:r.getUrl,upLoadJsonConfig:r.upLoadJsonConfig,uploadJsonAsset:r.uploadJsonAsset,getThumbnailUrl:r.getThumbnailUrl,donwLoad:r.donwLoad,login:r.login}},{"./ossfile":3}]},{},[4])(4)});
//# sourceMappingURL=ossfile.js.map
